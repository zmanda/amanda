2016-11-23  Jean-Louis Martineau <JMartineau@carbonite.com>
	Fix race when using event_register in thread, the callback can be
	calback can before event_register return
	* */*.c : Use event_create and event_activate instead of
	  event_register

2016-11-22  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/dumper.c (retimeout): New function that change the
	  timeout_time but do create create the event
	* installcheck/Installcheck/Run.pm (check_amreport): Add an option to
	  skip the 'sendbackup: size' line
	* installcheck/failure-server-custom-compress.pl: Call check_amreport
	  with the skip_size bit set.

2016-11-21  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/amfetchdump.pl, server-src/amreport.pl: Do not add to
	  cfgerr_level

2016-11-21  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Amanda_Rest_Storages.pl: Fix check

2016-11-21  Jean-Louis Martineau <JMartineau@carbonite.com>
	* NEWS, ReleaseNotes: 3.4.1

2016-11-18  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/find.c (find_dump, search_holding_disk, search_logfile):
	  add added_todo argument
	* server-src/find.h (find_dump, search_holding_disk, search_logfile):
	  add added_todo argument
	* server-src/amadmin.c: Call find_dump with added_todo=1
	* server-src/amindexd.c: Call find_dump with added_todo=1
	* server-src/amtrmidx.c: Call find_dump with added_todo=1
	* server-src/driver.c: Call search_holding_disk with added_todo=1
	* server-src/planner.c: Use a dp with a todo bit set
	* server-src/server_util.c: Use a dp with a todo bit set
	* server-src/tapefile.c: Call find_dump with added_todo=0
	* perl/Amanda/Logfile.swg (search_logfile, search_holding_disk): Add
	  added_todo argument
	* perl/Amanda/DB/Catalog.pm: Call search_logfile with added_todo=1
	* perl/Amanda/Disklist.swg: Call search_holding_disk with added_todo=1
	* installcheck/Amanda_Logfile.pl: Call search_logfile with
	  added_todo=1

2016-11-16  Jean-Louis Martineau <JMartineau@carbonite.com>
	* application-src/amrandom.pl: Fix perl warning
	* device-src/amtapetype.pl: Fix perl warning
	* installcheck/success-dumper-chunker-2taper-by-level.pl: Fix test
	* perl/Amanda/Report.pm: Fix perl warning
	* perl/Amanda/Report/human.pm: Fix perl warning
	* server-src/amadmin_perl.pl: Fix perl warning
	* server-src/amstatus.pl: Fix perl warning

2016-11-15  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/amstatus.pl: Fix warning, do not print useless (:)
	* installcheck/failure-*.pl, installcheck/success-dumper-*.pl: fix

2016-11-15  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/conffile.c: Add tapedev in storage section
	* common-src/conffile.h: Add STORAGE_TAPEDEV
	* device-src/xfer-dest-taper-splitter.c: Fix to use mem_ring value
	* man/xml-source/amanda.conf.5.xml: Document tapedev in storage section
	* perl/Amanda/Changer.pm: Improve message 1150003
	* perl/Amanda/Config.swg: Add STORAGE_TAPEDEV
	* perl/Amanda/Rest/Storages.pm: Set status to 404 if create fail
	* perl/Amanda/Storage.pm: Use tapedev if tpchanger is not set
	* installcheck/Amanda_Rest_Storages.pl: Fix check
	* installcheck/taper.pl: Fix check

2016-11-14  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/planner.c: Set dp->todo to 0 if the dle is not skipped

2016-11-14  Jean-Louis Martineau <JMartineau@carbonite.com>
	* device-src/amtapetype.pl: Correctly check result of property_set

2016-11-11  Jean-Louis Martineau <JMartineau@carbonite.com>
	* config/amanda/components.m4 (AMANDA_WITHOUT_REST_SERVER): New
	  --without-rest-server option
	* Makefile.am: Do not build rest-server if --without-rest-server
	* config/amanda/libs.m4: Fix typo
	* man/Makefile.am: Do not build amanda-rest-server.8 if
	  --without-rest-server
	* perl/Makefile.am: Do not build Amanda::Rest modules if
	  --without-rest-server
	* server-src/Makefile.am: Do not build amanda-rest-server if
	  --without-rest-server

2016-11-11  Jean-Louis Martineau <JMartineau@carbonite.com>
	* device-src/s3.c: Correctly handle Region not found
	* device-src/s3.h: Add S3_ERROR_Region_Not_Found

2016-11-09  Jean-Louis Martineau <JMartineau@carbonite.com>
	* device-src/s3.c: Verify a publicURL is found

2016-11-09  Jean-Louis Martineau <JMartineau@carbonite.com>
	* device-src/s3.c: publicURl and region can be unordered

2016-11-04  Jean-Louis Martineau <JMartineau@carbonite.com>
	* device-src/s3.c: Use the publicURL from the good region

2016-11-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/amcheck.c: Fix

2016-11-01  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Status.pm: Set $dlet->{'wsize'} to $dlet->{'taped_size'}
	  if it is bigger
	* perl/Amanda/Taper/Scribe.pm (get_bytes_written): Do not set oldsize
	  to size if size==0
	* perl/Amanda/Taper/Worker.pm: Delete the statefile later

2016-11-01  Jean-Louis Martineau <JMartineau@carbonite.com>
	* device-src/xfer-dest-taper-splitter.c: ring buffer might never be
	  full

2016-10-31  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/amcheck.c: Print message 2800016 to mainfd

2016-10-31  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Service/Amidxtaped.pm: Do not send mesage 4900000 and
	  4900012 to client
	* recover-src/extract_list.c: Print size on EOF

2016-10-26  Jean-Louis Martineau <JMartineau@carbonite.com>
	* packaging/rpm/amanda.spec.src: Remove perl(Dancer2) from the Requires

2016-10-25  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/DB.pm: package Amanda::DB;
	* perl/Amanda/Recovery.pm: package Amanda::Recovery;
	* perl/Amanda/Service.pm: package Amanda::Service;

2016-10-24  Jean-Louis Martineau <JMartineau@carbonite.com>
	* config/amanda/dvdrw-device.m4, config/amanda/ndmp-device.m4,
	  config/amanda/s3-device.m4: Do not include the device if compiled
	  --without-server

2016-10-19  Jean-Louis Martineau <JMartineau@carbonite.com>
	* config/amanda/libs.m4: Do not link with libcurl if no se device or
	  no server
	* config/amanda/s3-device.m4: Re-order

2016-10-19  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Makefile.am: Amanda::FetchDump::*, Amanda::Recovery::* and
	  Amanda::Amservice are for client or server

2016-10-11  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Amanda_Device.pl: Reduce bucket name length

2016-10-08  Jean-Louis Martineau <JMartineau@carbonite.com>
	* config/amanda/amanda_configure.m4: Check for getservbyname_t and
	  sem_timedwait
	* common-src/security-util.c: Check HAVE_GETSERVBYNAME_R
	* common-src/shm-ring.c: Check HAVE_SEM_TIMEDWAIT
	* gnulib/regenerate/regenerate: Check configure.ac

2016-10-08  Jean-Louis Martineau <JMartineau@carbonite.com>
	* config/amanda/ssl-security.m4: Fix pkg-config argument

2016-10-04  Jean-Louis Martineau <JMartineau@carbonite.com>
	* application-src/amstar.c: Fix exclude pattern

2016-10-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	* config/amanda/amanda_configure.m4: Check if clock_gettime exists
	* common-src/debug.c (msg_timestamp): Use time/ctime_r if
	  clock_gettime do not exists

2016-09-29  Jean-Louis Martineau <JMartineau@carbonite.com>
	* packaging/common/test_sh_libs.sh: Fix for time

2016-09-29  Jean-Louis Martineau <JMartineau@carbonite.com>
	* many */*.c: Add call to glib_init()

2016-09-28  Jean-Louis Martineau <JMartineau@carbonite.com>
	* amandad-src/amandad.c: Do not free as
	* recover-src/extract_list.c: Check state_filename != NULL before
	  unlink

2016-09-28  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Amanda_MainLoop.pl: Increase timeout

2016-09-27  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/driver.c (file_taper_result): Check result of
	  g_hash_table_lookup

2016-09-27  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/glib-util.c: Initialize shm_ring_mutex
	* common-src/shm-ring.c: Use a hash to manage semaphore
	* common-src/shm-ring.h: Export shm_ring_mutex
	* perl/Amanda/Status.pm: Fix for runq
	* server-src/tapefile.c: Fix for storage not set
	* installcheck/Amanda_Rest_Runs.pl: Fix
	* installcheck/success-dumper-chunker+taper-flush.pl Fix

2016-09-26  Jean-Louis Martineau <JMartineau@carbonite.com>
	* config/amanda/syshacks.m4: Define GETSERVBYNAME_R5 on solaris
	* common-src/security-util.c: Use solaris getservbyname_r if
	  GETSERVBYNAME_R5 is defined
	* common-src/shm-ring.c: Cast pid_t to int
	* server-src/tapefile.c: Cast pid_t to int

2016-09-21  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/amadmin.c (find): Do not call find_log(), it is a cpu hog
	  and it print useless warning
	* server-src/tapefile.c (lookup_tapelabel): Use a hash

2016-09-21  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Report.pm: A Fail driver line must set the exit_status
	  to STATUS_FAILED
	* installcheck/Amanda_ClientService.pl: Fix test

2016-09-21  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Amanda_Device.pl: Fix a test

2016-09-20  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/planner.c (when_overwrite): Use the tapecycle
	* server-src/tapefile.c (nb_tape_in_storage): New function to compute
	  the number of tape in a storage
	* server-src/tapefile.h (nb_tape_in_storage): Add prototype
	* installcheck/success-dumper-chunker-2taper-by-level.pl: Fix test

2016-09-20  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/planner.c (when_overwrite): Fix off by 1 error
	* server-src/tapefile.c (tape_overwrite): Use tp1->retention

2016-09-20  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/ScanInventory.pm: Use storage_nme fro chg->storage
	* server-src/amadmin.c: Remove spurious print message
	* server-src/amreindex.pl: Remove spurious print message
	* server-src/dumper.c: Call g_mutex_new and g_cond_new before creating
	  the thread, this fix a race
	* server-src/infofile.c (read_txinfofile): return 0 on success
	* server-src/planner.c (when_overwrite): Use storage setting
	* server-src/tapefile.c (tape_overwrite): New function to return how
	  many tapes whould be reuse before this one
	* server-src/tapefile.h (tape_overwrite): Add prototype

2016-09-19  Jean-Louis Martineau <JMartineau@carbonite.com>
	* NEWS, ReleaseNotes: Update for 3.4

2016-09-19  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/driver.c: Do not call cleanup_shm_ring too often
	* common-src/shm-ring.c (cleanup_shm_ring): Do not remove new shm,
	  allow them the time to setup

2016-09-18  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/glib-util.c (glib_init): Call g_mutex_new after the thread
	  are initialized

2016-09-16  Jean-Louis Martineau <JMartineau@carbonite.com>
	Do not substitute $t in autolabel, meta-autolabel and pool,the value
	is not always available
	* common-src/conffile.c: Do not substitute $t in pool
	* common-src/match.c (make_template, match_labelstr_template,
	  match_labelstr):Add storage argument
	* common-src/match.h (match_labelstr_template, match_labelstr): Fix
	  prototype
	* perl/Amanda/Util.swg (match_labelstr_template, match_labelstr): Fix
	  prototype
	* perl/Amanda/Changer.pm (label_to_slot, make_new_tape_label): Do no
	  substitute $t in autolabel, meta-autolabel
	* perl/Amanda/Label.pm,  perl/Amanda/ScanInventory.pm,
	  perl/Amanda/Taper/Scan/oldest.pm,
	  perl/Amanda/Taper/Scan/traditional.pm: Add storage argument to
	  match_labelstr call
	* perl/Amanda/Taper/Scan.pm, server-src/tapefile.c: Add storage
	  argument to match_labelstr_template call
	* man/xml-source/amanda.conf.5.xml: Document the change

2016-09-16  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/file.c (areads_getbuf): Fix prototype

2016-09-16  Jean-Louis Martineau <JMartineau@carbonite.com>
	* application-src/ambsdtar.c, application-src/amgtar.c,
	  application-src/amstar.c, client-src/selfcheck.c,
	  client-src/sendsize.c: Call glib_init()
	* common-src/glib-util.c (glib_init): Initialize file_mutex.
	* common-src/file.c (areads_dataready, areads_relbuf, debug_areads):i
	  Thread safe
	* common-src/file.h (aclose): do not call areads_relbuf
	* common-src/file.h (aaclose): Same as old aclose
	* client-src/sendbackup.c, oldrecover-src/amrecover.c,
	  server-src/amtrmidx.c, server-src/driver.c: Call aaclose

2016-09-15  Jean-Louis Martineau <JMartineau@carbonite.com>
	* amandad-src/amandad.c: Send no more than one PREP by second

2016-09-14  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/security-util.c (find_port_for_service):Make it thread
	  safe

2016-09-14  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/event.c: Allow a EV_TIME to be 0, run in the next
	  iteration

2016-09-14  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/planner.c: Fix comment

2016-09-14  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/debug.c (msg_timestamp):Make it thread safe by providing
	  a buffer

2016-09-13  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/amarchiver.pl: Fix for size output
	* amar-src/amar-test.c: Fix for improved error message

2016-09-13  Jean-Louis Martineau <JMartineau@carbonite.com>
	* amar-src/amarchiver.c: Cast amar-size result ot (long long)

2016-09-13  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/FetchDump.pm: Print to STDERR
	* amar-src/amar.c: Improve error message
	* amar-src/amar.h (amar_record): New prototype
	* amar-src/amarchiver.c (do_list): Print the size of the archive
	* perl/Amanda/Archive.swg (amar_record): Swig it

2016-09-08  Jean-Louis Martineau <JMartineau@carbonite.com>
	* application-src/amrandom.pl: Do not check the device, set
	  size_level_1
	* common-src/shm-ring.c (cleanup_shm_ring, close_producer_shm_ring,
	  close_consumer_shm_ring): Close the shm memory

2016-09-06  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Restore.pm: Fix call to remove_for_restore_label and
	  remove_for_restore_holding

2016-09-01  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/shm-ring.c (cleanup_shm_ring): Use name without path

2016-09-01  Jean-Louis Martineau <JMartineau@carbonite.com>
	* device-src/device.c (default_device_property_set_ex): Return the
	  device error if it is set
	* device-src/s3-device.c (s3_device_set_use_subdomain_fn):
	  Improve error message
	* installcheck/Amanda_Device.pl: Test non DNS bucket name

2016-08-25  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Process.pm: Typo

2016-08-25  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/*.pl: Make sure they all log their results

2016-08-25  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Vault.pm: fix

2016-08-25  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Vault.pm: Log a 'STATS hostname' line
	* perl/Amanda/Report.pm: Parse the amvault 'STATS hostname' line
	* perl/Amanda/Report/json.pm: Always include the head section
	* installcheck/Amanda_Rest_Runs.pl: Add head section
	* installcheck/catalogs/bigestimate.cat,
	  installcheck/catalogs/doublefailure.cat,
	  installcheck/catalogs/longstrange.cat,
	  installcheck/catalogs/resultsmissing.cat,
	  installcheck/catalogs/retried-nofinish.cat,
	  installcheck/catalogs/retried.cat,
	  installcheck/catalogs/shortstrange.cat,
	  installcheck/catalogs/skipped.cat: Add 'STATS driver' and many
	  'INFO pid-done' lines

2016-08-24  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Extract.pm: Use 'eq' to compare string

2016-08-23  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Restore.pm: Do not chdir if not an absolute path

2016-08-19  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Changer.pm (make_new_tape_label): use the child slot
	* perl/Amanda/Changer/aggregate.pm: Add allow-missing-changer property

2016-08-18  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Makefile.am: Move some test to full_tests or
	  restore_tests
	* installcheck/failure-client-custom-compress-end.pl: Remove 1 test

2016-08-18  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Amanda_Device.pl: Fix test

2016-08-18  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/failure-client-custom-compress-end.pl: Remove 5 tests

2016-08-17  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/dumper.c:Fix compiler warning
	* installcheck/Installcheck/Run.pm: Improvement
	* installcheck/Makefile.am: Add new amcat* script and new test scripts
	* installcheck/amcat-error-end.pl: New script that fail on exit
	* installcheck/amcat-error-no-exec.pl: New script install without
	  execute bit
	* installcheck/amcat-error.pl: New script that fail after 65536 bytes
	* installcheck/amcat.sh: New script that do a cat
	* installcheck/failure-client-custom-compress-end.pl,
	  installcheck/failure-client-custom-compress-no-exec.pl,
	  installcheck/failure-client-custom-compress-not-found.pl,
	  installcheck/failure-client-custom-compress.pl,
	  installcheck/failure-client-encrypt-end.pl,
	  installcheck/failure-client-encrypt-no-exec.pl,
	  installcheck/failure-client-encrypt-not-found.pl,
	  installcheck/failure-client-encrypt.pl,
	  installcheck/failure-server-custom-compress-end.pl,
	  installcheck/failure-server-custom-compress-no-exec.pl,
	  installcheck/failure-server-custom-compress-not-found.pl,
	  installcheck/failure-server-custom-compress.pl,
	  installcheck/failure-server-encrypt-end.pl,
	  installcheck/failure-server-encrypt-no-exec.pl,
	  installcheck/failure-server-encrypt-not-found.pl,
	  installcheck/failure-server-encrypt.pl: New scripts to test various
	  error
	* installcheck/failure-xfer-dest-holding-file-first-close_chunk.pl,
	  installcheck/failure-xfer-dest-holding-file-open-first-header.pl,
	  installcheck/failure-xfer-dest-holding-file-open-second-header.pl,
	  installcheck/failure-xfer-dest-holding-file-second-close_chunk.pl,
	  installcheck/failure-xfer-dest-holding-file-write-first-data.pl,
	  installcheck/failure-xfer-dest-holding-file-write-first-header.pl,
	  installcheck/failure-xfer-dest-holding-file-write-second-data.pl,
	  installcheck/failure-xfer-dest-holding-file-write-second-header.pl,
	  installcheck/failure-xfer-dest-holding-shm-first-close_chunk.pl,
	  installcheck/failure-xfer-dest-holding-shm-open-first-header.pl,
	  installcheck/failure-xfer-dest-holding-shm-open-second-header.pl,
	  installcheck/failure-xfer-dest-holding-shm-second-close_chunk.pl,
	  installcheck/failure-xfer-dest-holding-shm-write-first-data.pl,
	  installcheck/failure-xfer-dest-holding-shm-write-first-header.pl,
	  installcheck/failure-xfer-dest-holding-shm-write-second-data.pl,
	  installcheck/failure-xfer-dest-holding-shm-write-second-header.pl:
	  New script to test error in xfer-dest-holding.c
	* installcheck/success-dumper-chunker+dumper-chunker-taper-flush.pl,
	  installcheck/success-dumper-chunker+taper-flush.pl,
	  installcheck/success-dumper-chunker-2taper-by-level.pl,
	  installcheck/success-dumper-chunker-2taper.pl,
	  installcheck/success-dumper-chunker-taper.pl,
	  installcheck/success-dumper-taper.pl: Update for improvement in
	  Installcheck/Run.pm

2016-08-17  Jean-Louis Martineau <JMartineau@carbonite.com>
	* amandad-src/amandad.c: Fix closing service
	* client-src/sendbackup.c (stderr_thread): Cancel the shm_ring
	* common-src/security-util.c: Do not free(rs)
	* common-src/security.c (security_seterror, security_stream_seterror):
	  Use g_strdup_vprintf
	* perl/Amanda/Report/human.pm: Do not report 'Aborted by driver' error
	* server-src/dumper.c: Take the shm_thread_mutex more often, add
	  FAILURE_CODE error
	* server-src/xfer-dest-holding.c: Add FAILURE_CODE error

2016-08-17  Jean-Louis Martineau <JMartineau@carbonite.com>
	* man/xml-source/amanda.8.xml: Add amanda-command-file.5

2016-08-17  Jean-Louis Martineau <JMartineau@carbonite.com>
	* man/Makefile.am: Add amanda-command-file.5.xml
	* man/xml-source/amanda-command-file.5.xml:Document the command-file
	  format
	* man/xml-source/amanda.conf.5.xml: Reorder entries

2016-08-10  Jean-Louis Martineau <JMartineau@carbonite.com>
	* device-src/s3-device.c (progress_func): Donot fail if the transfer
	  is not started

2016-08-09  Jean-Louis Martineau <JMartineau@carbonite.com>
	Add a --failure-code configure option that allow to inject error in
	the code
	* Makefile.am (DISTCHECK_CONFIGURE_FLAGS): Add --failure-code
	* common-src/alloc.c (safe_env_full): Keep all ENV if FAILURE_CODE is
	  define
	* config/amanda/amanda_configure.m4: Load AMANDA_WITH_FAILURE_CODE
	* config/amanda/failure_code.m4 (AMANDA_WITH_FAILURE_CODE): Define
	  FAILURE_CODE if --failure-code
	* perl/Amanda/Constants.pm.in.src: Add FAILURE_CODE
	* perl/Amanda/Rest/Configs.pm: Handle FAILURE parameter

2016-08-09  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/xfer-dest-holding.c (finish_chunk): Return a char *
	* server-src/xfer-server.h (finish_chunk): modify declaration
	* perl/Amanda/XferServer.swg (finish_chunk): modify declaration
	* perl/Amanda/Xfer.pod: Update documentation

2016-08-09  Jean-Louis Martineau <JMartineau@carbonite.com>
	* device-src/s3.c: Correctly compute the signature for AWS4 if
	  S3_SUBDOMAIN is set to OFF

2016-08-08  Jean-Louis Martineau <JMartineau@carbonite.com>
	* client-src/ambackup.pl: Wait for 'MESG END'

2016-08-08  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/ambackupd.pl: Fix string comparaison

2016-08-08  Jean-Louis Martineau <JMartineau@carbonite.com>
	* amandad-src/amandad.c: Wait for the child process to terminate

2016-08-08  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Chunker/Scribe.pm: fix bad variable name

2016-08-08  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Curinfo/Info.pm: Fix perl warning

2016-08-08  Jean-Louis Martineau <JMartineau@carbonite.com>
	* xfer-src/element-glue.c: Enable XFER_MECH_WRITEFD, XFER_MECH_MEM_RING
	  and XFER_MECH_WRITEFD, XFER_MECH_SHM_RING

2016-08-03  Jean-Louis Martineau <JMartineau@carbonite.com>
	* application-src/amrandom.pl: Fix perl warning

2016-08-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/ammessage.c: typo

2016-07-19  Jean-Louis Martineau <JMartineau@carbonite.com>
	* client-src/sendbackup.c: (childstr): check dumppid at last
	* client-src/sendbackup.c: (check_result):Increase the timeout to 600
	  seconds

2016-07-18  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Amdump.pm: Use POSIX::close
	* perl/Amanda/Chunker/Controller.pm, perl/Amanda/Chunker/Scribe.pm:
	  Improve error message
	* perl/Amanda/Config.swg: Add Message for code 1560000
	* perl/Amanda/Report.pm: Fix parsing of pid and fork L_INFO lines
	* perl/Amanda/Report/human.pm: Improve error message
	* perl/Amanda/Report/json.pm: Improve error message
	* perl/Amanda/Status.pm: Improve parsing
	* installcheck/Amanda_Rest_Runs.pl
	  installcheck/amstatus.pl
	  installcheck/chunker.pl
	  installcheck/pp-scripts.pl
	  installcheck/success-dumper-chunker+dumper-chunker-taper-flush.pl
	  installcheck/success-dumper-chunker+taper-flush.pl
	  installcheck/success-dumper-chunker-2taper-by-level.pl
	  installcheck/success-dumper-chunker-2taper.pl
	  installcheck/success-dumper-chunker-taper.pl
	  installcheck/success-dumper-taper.pl: Fix for changes

2016-07-14  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/dumper.c: Improve error reporting

2016-07-14  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/driver.c: Remove useless printf

2016-07-14  Jean-Louis Martineau <JMartineau@carbonite.com>
	* client-src/sendbackup.c: Read filter stderr and report them as error

2016-07-14  Jean-Louis Martineau <JMartineau@carbonite.com>
	* client-src/senddiscover.c: Do not include "pipespawn.h"

2016-07-14  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/file.c (debug_areads): Add a terminating '\n' on the
	  buffer

2016-07-14  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/event.c (event_release): Abort the main_loop is there is
	  no more event

2016-07-14  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/debug.c: Fix race in getting the thread id

2016-07-14  Jean-Louis Martineau <JMartineau@carbonite.com>
	* device-src/device.h (property_set_ex, device_property_set_ex):
	  Change prototype to return a (char *)
	* device-src/device.c (property_set_ex, device_property_set_ex):
	  Return a (char *) on error, NULL on success
	* perl/Amanda/Device.swg (property_set), Return a string on eror,
	  undef on success
	* device-src/amtapetype.pl, device-src/rait-device.c,
	  perl/Amanda/Changer.pm, perl/Amanda/Changer/disk.pm,
	  perl/Amanda/Changer/diskflat.pm, server-src/amadmin.c,
	  server-src/amrestore.pl: Change for new API
	* installcheck/Amanda_Device.pl: Test new API
	* installcheck/Amanda_Xfer.pl: Change for new API

2016-07-13  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/infofile.c: Make sure the infofile never have more more
	  than 100 history lines

2016-07-08  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Installcheck/Rest.pm (post): Set CURLOPT_POSTFIELDSIZE

2016-07-08  Jean-Louis Martineau <JMartineau@carbonite.com>
	Add message in NO-ROOM from chunker and ABORT from driver to chunker
	* perl/Amanda/Chunker/Controller.pm: Add message
	* perl/Amanda/Chunker/Protocol.pm: Add message
	* server-src/driver.c: Add message
	* server-src/driverio.c: Send message
	* server-src/xfer-dest-holding.c: Set message
	* installcheck/chunker.pl: Check message

2016-07-08  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Report/human.pm: Fix dealing with try, fix line spacing
	* perl/Amanda/Report.pm: Fix setting try
	* installcheck/success-dumper-chunker+dumper-chunker-taper-flush.pl,
	  installcheck/success-dumper-chunker+taper-flush.pl,
	  installcheck/success-dumper-chunker-2taper-by-level.pl,
	  installcheck/success-dumper-chunker-2taper.pl,
	  installcheck/success-dumper-chunker-taper.pl,
	  installcheck/success-dumper-taper.pl: Check report failure_summary,
	  fix for line spacing

2016-07-08  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Installcheck/Catalogs.pm: Set current version in amdump
	  log file

2016-07-08  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Status.pm:: Return an error if not for same version
	* server-src/amstatus.pl: Handle Message return from $status->current

2016-07-06  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/dump-client-custom-compress+amfetchdump.pl,
	  installcheck/dump-client-encrypt+amfetchdump.pl,
	  installcheck/dump-server-custom-compress+amfetchdump.pl,
	  installcheck/dump-server-encrypt+amfetchdump.pl: restore in a
	  testdir, check the dump is restored

2016-07-06  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Restore.pm: srvcompprog and clntcompprog are string
	* installcheck/Makefile.am (server_tests): Add new test scripts
	* installcheck/dump-client-custom-compress+amfetchdump.pl,
	  installcheck/dump-client-encrypt+amfetchdump.pl,
	  installcheck/dump-server-custom-compress+amfetchdump.pl,
	  installcheck/dump-server-encrypt+amfetchdump.pl: New test scripts

2016-07-05  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Amanda_Rest_Configs.pl, installcheck/amgetconf.pl:
	  Change for new value of send-amreport-on

2016-07-05  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Installcheck/Config.pm (new): Set send-amreport-on to
	  never

2016-07-05  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Process.pm (load_ps_table): Skip partial line

2016-07-05  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/amflock.c: Typo
	* perl/Amanda/Tapelist.swg (relaod): Take the lock before checking
	  force
	* perl/Amanda/Tapelist.swg (write): Verify we have the lock
	* perl/Amanda/Rest/Storages/Labels.pm: Take the tapelist lock
	* installcheck/Amanda_Rest_Storages_Labels.pl: Do not exit
	* installcheck/Amanda_Tapelist.pl: Reload the tapelist
	* installcheck/Amanda_Taper_Scan_lexical.pl: Reload the tapelist
	* installcheck/Amanda_Taper_Scan_oldest.pl: Reload the tapelist
	* installcheck/Amanda_Taper_Scan_traditional.pl: Reload the tapelist
	* installcheck/amlabel.pl: Reload the tapelist
	* installcheck/amreport.pl: unlink "$mail_mock.bogus"
	* installcheck/success-dumper-chunker+dumper-chunker-taper-flush.pl,
	  installcheck/success-dumper-chunker+taper-flush.pl,
	  installcheck/success-dumper-chunker-2taper-by-level.pl,
	  installcheck/success-dumper-chunker-2taper.pl,
	  installcheck/success-dumper-chunker-taper.pl,
	  installcheck/success-dumper-taper.pl: sleep before checking result

2016-07-04  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/amreport.pl: simpler error matching

2016-07-04  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/logfile.c (program_str): Add amtrmidx and amtrmlog
	* server-src/logfile.c (get_logtype_str, get_program_str): New
	  functions
	* server-src/logfile.h (program_t): Add P_AMTRMIDX and P_AMTRMLOG
	* server-src/logfile.h (get_logtype_str, get_program_str): Add
	  prototypes
	* perl/Amanda/Logfile.swg: Swig P_AMTRMIDX P_AMTRMLOG, get_logtype_str
	  and get_program_str
	* perl/Amanda/Amdump.pm (run_subprocess): Read stderr and log a
	  L_ERROR
	* perl/Amanda/Report.pm: Parse line from amreport, amtrmidx and
	  amtrmlog
	* perl/Amanda/Report/human.pm (PROGRAM_ORDER): Add amtrmidx and amtrmlog
	* server-src/amreport.pl: Print better error message
	* installcheck/amreport.pl: Check new error reporting

2016-07-04  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Installcheck/Run.pm (check_amreport): Remove double
	  space in date

2016-06-29  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Process.pm (load_ps_table): accept any process which
	  match /perl/ as a perl binary

2016-06-29  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/success-dumper-chunker+taper-flush.pl:
	  s/ 0:00:00/00:00:00/

2016-06-29  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Installcheck/Run.pm (setup_changer, setup_storage): New
	  methods
	* installcheck/Installcheck/Run.pm (check_amreport): Sort the
	  'USAGE BY TAPE' and 'NOTES' sections before comparing them
	* installcheck/Makefile.am (server_tests): Add 2 new tests
	* installcheck/success-dumper-chunker-2taper-by-level.pl: test a dump
	  where the full go to a storage and the incremental go to another
	  storage
	* installcheck/success-dumper-chunker-2taper.pl: test a dump that goto
	  2 different storages

2016-06-29  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Status.pm (show_time): Always print hours with 2 chars
	* server-src/amstatus.pl (busytime): Always print hours with 2 chars
	* installcheck/Installcheck/Run.pm (check_amstatus): Fix regex
	* installcheck/amstatus.pl: Fix
	* installcheck/success-dumper-chunker+dumper-chunker-taper-flush.pl,
	  installcheck/success-dumper-chunker+taper-flush.pl,
	  installcheck/success-dumper-chunker-taper.pl,
	  installcheck/success-dumper-taper.pl: Fix

2016-06-29  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Installcheck/Run.pm (check_amstatus): Remove not-idle
	  lines from amstatus result

2016-06-29  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Installcheck/Run.pm (check_amstatus): Remove not-idle
	  lines

2016-06-29  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Report/human.pm (get_summary_info): Do not add spurious
	  space

2016-06-29  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/conffile.c (update_derived_values): create a default CONF
	  policy

2016-06-29  Jean-Louis Martineau <JMartineau@carbonite.com>
	* application-src/amrandom.pl: Allow level 1 backup, add SIZE-LEVEL-1
	  property
	* installcheck/success-dumper-chunker+dumper-chunker-taper-flush.pl,
	  installcheck/success-dumper-chunker+taper-flush.pl,
	  installcheck/success-dumper-chunker-taper.pl,
	  installcheck/success-dumper-taper.pl: Use amrandom, it have
	  consistent size

2016-06-28  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/amstatus.pl:Fix indentation
	* installcheck/Installcheck/Run.pm (check_amstatus): Do not check
	  dumper busy stat

2016-06-28  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Installcheck/Run.pm: Subtitute hostname
	* installcheck/success-dumper-chunker+dumper-chunker-taper-flush.pl,
	  installcheck/success-dumper-chunker+taper-flush.pl,
	  installcheck/success-dumper-chunker-taper.pl,
	  installcheck/success-dumper-taper.pl: Increase time length

2016-06-28  Jean-Louis Martineau <JMartineau@carbonite.com>
	* config/amanda/libs.m4: Set LIBCURL_USE_GNUTLS_NETTLE or
	  LIBCURL_USE_GNUTLS_GCRYPT depending on which crypto library
	  gnutls use
	* common-src/glib-util.c: Initialize gcrypt only if
	  LIBCURL_USE_GNUTLS_GCRYPT

2016-06-28  Jean-Louis Martineau <JMartineau@carbonite.com>
	* device-src/xfer-dest-taper-splitter.c: Fix error path
	* perl/Amanda/Report.pm: Fix exit_status
	* perl/Amanda/Report/human.pm: Fix line spacing
	* server-src/amstatus.pl: Add dump_time
	* server-src/driver.c: Do not log 'too many taper retry'
	* server-src/xfer-source-holding.c (cancel_impl): Set eogf_flag on
	  the mem_ring
	* xfer-src/xfer.c: Add debugging statement
	* installcheck/Makefile.am (server_tests): Add new test file
	* installcheck/Makefile.am (catalogs): Add new catalog file
	* installcheck/Amanda_Report.pl,
	  installcheck/Amanda_Rest_Runs.pl,
	  installcheck/Installcheck/Run.pm,
	  installcheck/amdump.pl,
	  installcheck/amreport.pl: Add and fix test
	* installcheck/success-dumper-chunker+dumper-chunker-taper-flush.pl
	  installcheck/success-dumper-chunker+taper-flush.pl
	  installcheck/success-dumper-chunker-taper.pl
	  installcheck/success-dumper-taper.pl: New test
	* installcheck/catalogs/dumper-chunker-taper-success.cat,
	  installcheck/catalogs/dumper-taper-success.cat: New catalog

2016-06-28  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Report.pm: Fix race by loading the ps_table early

2016-06-27  Jean-Louis Martineau <JMartineau@carbonite.com>
	* application-src/amrandom.pl: Improve debugging
	* common-src/shm-ring.c: Improve debugging

2016-06-27  Jean-Louis Martineau <JMartineau@carbonite.com>
	* config/gettext-macros/gettext.m4,
	  config/gettext-macros/po.m4: s/AM_PROG_MKDIR_P/AC_PROG_MKDIR_P/

2016-06-27  Jean-Louis Martineau <JMartineau@carbonite.com>
	* config/amanda/libs.m4 (AMANDA_CHECK_LIBCURL): Check for
	  HMAC_CTX_init or HMAC_CTX_reset
	* common-src/glib-util.c, common-src/ssl-security.c,
	  device-src/s3-util.c, device-src/s3.c: Fix for openssl 1.1

2016-06-27  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Rest/Runs.pm (list one): Do not return emtpy string

2016-06-21  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Rest/Runs.pm (list): Do not set $status

2016-06-21  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Amdump.pm (message 2000000): use logfile
	* perl/Amanda/Amdump.pm (message 2000001): use tracefile
	* perl/Amanda/Amflush.pm (message 2200000): use logfile
	* perl/Amanda/Amflush.pm (message 2200001): use tracefile
	* perl/Amanda/Report.pm: Set status to 'running', 'done' or
	  'aborted'
	* perl/Amanda/Report/json.pm: Report the status in head->status
	* perl/Amanda/Rest/Runs.pm: Use tracefile and logfile
	* perl/Amanda/Rest/Status.pm:use tracefile
	* installcheck/Amanda_Report.pl: Add pids
	* installcheck/Amanda_Rest_Runs.pl: Add pids
	* installcheck/pp-scripts.pl: use tracefile and logfile
	* installcheck/catalogs/amflush.cat,
	  installcheck/catalogs/fatal.cat,
	  installcheck/catalogs/flush-noorigsize.cat,
	  installcheck/catalogs/flush-origsize.cat,
	  installcheck/catalogs/normal.cat,
	  installcheck/catalogs/plannerfail.cat,
	  installcheck/catalogs/retried-strange.cat,
	  installcheck/catalogs/skipped.cat,
	  installcheck/catalogs/spanned.cat,
	  installcheck/catalogs/strontium.cat,
	  installcheck/catalogs/taperr.cat: Add pid lines

2016-06-17  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/ScanInventory.pm, perl/Amanda/Taper/Scan/oldest.pm: Do
	  not 'use Time::HiRes'

2016-06-17  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Changer/robot.pm: Fix perl warning
	* perl/Amanda/ScanInventory.pm: Use all slots returned by analyze
	  before calling it again
	* perl/Amanda/Taper/Scan/lexical.pm (analyze),
	  perl/Amanda/Taper/Scan/oldest.pm (analyze): Return an array of slots
	* installcheck/Amanda_Taper_Scan_lexical.pl: Fix
	* installcheck/Amanda_Taper_Scan_oldest.pl: Fix
	* installcheck/Amanda_Taper_Scan_traditional.pl: Fix
	* installcheck/Installcheck/Changer.pm: Fix

2016-06-17  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Changer.pm: Call $rv->_valide()
	* perl/Amanda/Changer/disk.pm, perl/Amanda/Changer/diskflat.pm: Do not
	  call $self->_validate()

2016-06-17  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/driver.c (start_a_flush_taper): Use
	  TAPER_STATE_TAPE_STARTED && TAPER_STATE_RESERVATION

2016-06-17  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/amflock.c: Check the return status of mkdir

2016-06-17  Jean-Louis Martineau <JMartineau@carbonite.com>
	Maintain the C tapelist instead of reloading it after a write
	* device-src/diskflat-device.c (diskflat_device_seek_file): Return an
	  F_EMPTY header on DEVICE_STATUS_VOLUME_UNLABELED
	* perl/Amanda/Tapelist.swg (reset_tapelist): New method,
	  (reload): Do not call C_clear_tapelist,
	  (remove_tapelabel): Call C_remove_tapelabel,
	  (add_tapelabel): Call C_add_tapelabel,
	  (write): Do not call C_read_tapelist,
	* perl/Amanda/Taper/Scan.pm (quit): Do not quit the changer
	* server-src/tapefile.c (reset_tapelist, add_tapelabel): New function
	* server-src/tapefile.h (reset_tapelist, add_tapelabel): Add prototype
	* installcheck/Amanda_Taper_Scan_lexical.pl: Fix
	* installcheck/Amanda_Taper_Scan_oldest.pl: Fix
	* installcheck/Amanda_Taper_Scan_traditional.pl: Fix

2016-06-15  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Amanda_Taper_Scan_lexical.pl,
	  installcheck/Amanda_Taper_Scan_oldest.pl,
	  installcheck/Amanda_Taper_Scan_traditional.pl: Fix

2016-06-15  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/tapefile.c: Check result of symlink call and log error

2016-06-15  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/amflock.c: Improve debugging

2016-06-15  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Tapelist.swg: Do not reload the tapelist file if we
	  already have the last state
	* server-src/tapefile.c: Create the tapelist.last_write symlink
	* installcheck/Amanda_Tapelist.pl: Fix

2016-06-15  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/debug.c (msg_timestamp): Add sub-second time precision
	  to the timestamp

2016-06-15  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/driver.c (start_a_flush_taper): Use
	  TAPER_STATE_TAPE_STARTED or TAPER_STATE_RESERVATION

2016-06-15  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Taper/Scribe.pm: Fix perl warning

2016-06-10  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/driver.c (start_some_dumps): Do not wait for chunker PORT
	  or SHM-NAME
	* server-src/driver.c (handle_chunker_result): Handle PORT and
	  SHM-NAME reply

2016-06-09  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/find.c (make_dump_hash, dump_hash_exist): Fix for
	  host_hash

2016-06-09  Jean-Louis Martineau <JMartineau@carbonite.com>
	* application-src/amsamba.pl: Fix for newer samba version

2016-06-08  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/ammessage.c: typo

2016-06-08  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Changer.pm (label_to_slot): Fix for $r and $t
	  substitution
	* perl/Amanda/Changer/disk.pm: Do not create all num-slot directories,
	  inventory return only the slot with a directory + runtapes new slots
	* perl/Amanda/Changer/diskflat.pm: inventory return only the slot with
	  a label + runtapes new slots
	* installcheck/Amanda_Rest_Storages.pl: Set auto-create-slot

2016-06-08  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/amflock.c (common-src/amflock.c): Create the parent
	  directory

2016-06-07  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/conffile.c: Allow $t in changerfile and tpchanger from a
	  changer section
	* man/xml-source/amanda.conf.5.xml: Document it

2016-06-07  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Changer.pm: Allow $r and $t in autolabel and
	  meta-autolabel
	* man/xml-source/amanda.conf.5.xml: Document it

2016-06-07  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/conffile.c: Allow $o, $c, $r and $t in tapepool
	* man/xml-source/amanda.conf.5.xml: Document it

2016-06-03  Jean-Louis Martineau <JMartineau@carbonite.com>
	* device-src/xfer-dest-taper-splitter.c: Do not cancel twice
	* perl/Amanda/Taper/Worker.pm: Abort_setup on input_errors
	* server-src/dumper.c: Improve debugging

2016-06-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/ammessage.c (set_message): Fix typo in mesage 2800036

2016-06-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/shm-ring.c (cleanup_shm_ring): New function to remove
	  unused semaphore and shared memory
	* common-src/shm-ring.h (cleanup_shm_ring): Add prototype
	* server-src/driver.c: Call cleanup_shm_ring

2016-06-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/driver.c (handle_chunker_result): Set job on BOGUS

2016-06-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/amadmin.c: Fix out of bound

2016-06-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/amstatus.pl: Use 'dsize' if available

2016-06-01  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/mem-ring.c, common-src/shm-ring.c: Make sure the ring
	  size is at least twice the block size, otherwise the ring can hang

2016-06-01  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/security-util.c, common-src/shm-ring.c,
	  device-src/xfer-dest-taper-splitter.c,
	  server-src/xfer-source-holding.c: Allow to completely fill the ring

2016-05-31  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/shm-ring.c (shm_ring_to_security_stream),
	  device-src/xfer-dest-taper-splitter.c (device_thread_wait_for_block),
	  server-src/dumper.c (handle_shm_ring_to_fd_thread): set usable after
	  getting the semaphore
	* server-src/driver.c (handle_chunker_result): Fix for BOGUS

2016-05-31  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/conffile.c: displayunit default ot 'K' (uppercase)
	* installcheck/Amanda_Rest_Configs.pl: Fix for K uppercase
	* installcheck/Amanda_Rest_Runs.pl: Fix for K uppercase
	* xfer-src/xfer-test.c: Call config_init(0, NULL)
	* installcheck/catalogs/*.cat: Fix for K uppercase

2016-05-31  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Changer.pm (make_new_tape_label): Can take meta
	  from $self
	* perl/Amanda/Changer/diskflat.pm: Use meta from state
	* installcheck/Amanda_Changer_diskflat.pl: More meta check

2016-05-27  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/conffile.c: Check meta-autolabel, autolabel, labelstr and
	  tapepool do not conatisna space

2016-05-26  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/amadmin.c (import_db): Fix version parsing
	* server-src/amadmin.c: Fix for level > 9

2016-05-25  Jean-Louis Martineau <JMartineau@carbonite.com>
	* xfer-src/element-glue.c: #include "conffile.h"

2016-05-25  Jean-Louis Martineau <JMartineau@carbonite.com>
	* xfer-src/element-glue.c (do_directtcp_accept): Use dtimeout for the
	  timeout

2016-05-24  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/driver.c: Fix fro taper failure after SHM-NAME received

2016-05-20  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/stream.h (STREAM_BUFSIZE): Set to NETWORK_BLOCK_BYTES * 4

2016-05-20  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/security-util.c (tcpm_recv_token): Fix return value

2016-05-19  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/shm-ring.c (shm_ring_sem_wait): Return -1 if the shm-ring
	  is cancelled
	* device-src/xfer-dest-taper-splitter.c: s/!!/!/

2016-05-19  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/security-util.c: Improve error message
	* common-src/shm-ring.c (shm_ring_sem_wait): Faile only if the process
	  do not exists (ESRCH)
	* device-src/xfer-dest-taper-splitter.c: Improve debugging
	* perl/Amanda/Taper/Scribe.pm: Set started_writing only when we wrote
	  a part
	* server-src/dumper.c: Improve debugging
	* xfer-src/element-glue.c: Improve debugging
	* xfer-src/xfer.c: Improve debugging

2016-05-19  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/amtrmlog.c: Remove bogus g_free

2016-05-19  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/file.c (debug_pgets): Untaint the returned string
	* server-src/amtrmlog.c: Fix coverity warning

2016-05-18  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/pp-scripts.pl: Use amrandom to get consistent size

2016-05-18  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/amtrmlog.c: Use free_dump_hash()
	* server-src/find.c (free_dump_hash): Put in comment because infailon
	  some machine

2016-05-18  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/amrmtape.pl: Can remove multiple labels
	* man/xml-source/amrmtape.8.xml: Document new feature

2016-05-18  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/dumper.c: Fix dtimeout when using shm-ring (local auth)

2016-05-17  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/file.c (debug_pgets): New function to read a complete
	  line from a FILE*
	* common-src/file.h (debug_pgets, pgets): Add prototypes
	* common-src/amxml.c: Undo previous patch, use pgets instead of agets
	* application-src/amstar.c, client-src/client_util.c,
	  client-src/selfcheck.c, client-src/sendbackup.c,
	  client-src/senddiscover.c, client-src/sendsize.c,
	  common-src/amutil.c, common-src/krb5-security.c,
	  common-src/security-util.c, recover-src/extract_list.c,
	  server-src/amcheck.c, server-src/amindexd.c,
	  server-src/dumper.c: Use pgets instead of agets to read many files
	* installcheck/amdump.pl: Add check for '#' in dumptype property

2016-05-16  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/amxml.c (amxml_format_tag): The '#' character require raw
	  format

2016-05-16  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Tapelist.swg: Keep hash by label and barcode for faster
	  lookup
	* installcheck/Amanda_Tapelist.pl: Fix for new hash

2016-05-16  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/amtrmidx.c: Fix

2016-05-16  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/dumper.c (stop_dump): Call security_stream_read_cancel

2016-05-16  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/find.c: Find the find result in a hash
	* server-src/find.h (hash_find_log, make_dump_hash, free_dump_hash,
	  dump_hash_exist): Add prototypes
	* server-src/amtrmidx.c, server-src/amtrmlog.c: Use the hash

2016-05-16  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/driverio.h (chunker_t, wtaper_t): sendresult is a
	  gboolean
	* server-src/driver.c: Fix sending the result to taper twice

2016-05-12  Jean-Louis Martineau <JMartineau@carbonite.com>
	* man/xml-source/amanda-scripts.7.xml: Add notes on how to abort a
	  backup with exit status != 0

2016-05-12  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/pp-scripts.pl: Use $dbgdir

2016-05-12  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Installcheck/Rest.pm (cleanup_for_amdump): Clean
	  $body->[0]{report}{head}->{hostname}
	* installcheck/pp-scripts.pl: hostname is undef

2016-05-11  Jean-Louis Martineau <JMartineau@carbonite.com>
	* application-src/Makefile.am (applicationexec_SCRIPTS_SHELL): Add
	  script-fail
	* application-src/script-fail.sh: New script that always fail (for
	  testing)
	* installcheck/Installcheck/Rest.pm (cleanup_for_amdump): New function
	  to cleanup result for a report
	* installcheck/pp-scripts.pl: Check failing scripts

2016-05-11  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/holding.c: Accept level up to DUMP_LEVELS

2016-05-11  Jean-Louis Martineau <JMartineau@carbonite.com>
	* client-src/sendbackup.c: Fix delay in waiting for application

2016-05-11  Jean-Louis Martineau <JMartineau@carbonite.com>
	* client-src/client_util.c: Improve parsing of estimate scripts
	* client-src/sendsize.c: Fail estimate if script fail
	* server-src/planner.c: continue parsing after ERROR line

2016-05-10  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/amgtar.pl: Fix path

2016-05-10  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/amgtar.pl: Fix path
	* installcheck/amstar.pl: Add a STAR-TARDUMP property

2016-05-10  Jean-Louis Martineau <JMartineau@carbonite.com>
	* application-src/ambsdtar.c, application-src/amgtar.c
	  application-src/amstar.c: Define a AM_ERROR_RE
	* client-src/client_util.c (build_re_table): Keep DMP_ERROR
	* config/amanda/userid.m4: AC_SUBST(SINGLE_USERID)
	* perl/Amanda/Constants.pm.in.src: Add $SINGLE_USERID
	* installcheck/Installcheck/Application.pm: Parse negative size
	* installcheck/ambsdtar.pl, installcheck/amgtar.pl,
	  installcheck/amstar.pl: Resultdifer if $SINGLE_USERID is set

2016-05-09  Jean-Louis Martineau <JMartineau@carbonite.com>
	* application-src/ambsdtar.c: selfcheck output is JSON, improve error
	  reporting
	* application-src/amgtar.c: Improve error reporting
	* application-src/amstar.c: selfcheck output is JSON, improve error
	  reporting
	* client-src/client_util.c: Fix error reporting
	* client-src/sendbackup.c: Fix error reporting
	* common-src/ammessage.c: Add messages from amstar and ambsdtar
	* installcheck/Installcheck/Application.pm: Fix to get error
	* installcheck/Makefile.am (client_tests): Add amstar
	* installcheck/ambsdtar.pl: Add new checks
	* installcheck/amgtar.pl: Add new checks
	* installcheck/amstar.pl: New file to check amstar behaviour

2016-05-05  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Extract.pm (BSU): Fix for non-application
	* perl/Amanda/FetchDump.pm: Add message 3300005
	* perl/Amanda/FetchDump/Application.pm: Return a 3300005 message if it
	  don't know how to extract the dump
	* perl/Amanda/Restore.pm: Fix
	* server-src/amfetchdump.pl: Check -O and --directory are not
	  different

2016-05-05  Jean-Louis Martineau <JMartineau@carbonite.com>
	* device-src/s3.c: Fix AWS4 auth-string

2016-05-05  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Status.pm: Set status of failed dle to inew status
	  TERMINATED_*

2016-05-05  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/CheckDump.pm: Use Xfer::Dest::Null for destination when
	  amanda don't know how to validate the dump

2016-05-04  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Tapelist.swg: Change RETENTION_NO string to
	  'retention-no'
	* server-src/amtape.pl (inventory): Print the retention even if it is
	  RETENTION_NO
	* installcheck/Amanda_Rest_Labels.pl,
	  installcheck/Amanda_Rest_Storages.pl: Fix for 'retention-no' string

2016-05-04  Dustin J. Mitchell <dustin@mozilla.com>
	* man/xml-source/amanda-auth.7.xml: Improve doc

2016-05-04  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/security-util.c: Break after the first callback

2016-05-04  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/tapefile.c: Use g_hash_table_destroy

2016-05-03  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Amanda_Xfer.pl: Sort the crcs

2016-05-03  Jean-Louis Martineau <JMartineau@carbonite.com>
	* client-src/client_util.c (run_client_scripts): return the exit
	  status of the scripts
	* client-src/client_util.h (run_client_scripts): Change return type to
	  int
	* client-src/sendbackup.c: Do not run the application if a
	  PRE-DLE-BACKUP script failed
	* server-src/dumper.c: Fix hang

2016-05-03  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Amanda_Xfer.pl: 45 checks require the server

2016-05-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	* amandad-src/amandad.c, server-src/amcheck.c, server-src/driver.c,
	  server-src/dumper.c, server-src/planner.c,
	  common-src/amservice.c: Call glib_init()

2016-05-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/security-util.h (sec_stream): Add event_id
	* common-src/security-util.c: Use event_id from sec_stream

2016-05-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	* device-src/xfer-dest-taper-cacher.c, xfer-src/dest-buffer.c,
	  xfer-src/dest-null.c, xfer-src/filter-crc.c, xfer-src/filter-xor.c
	  (push_buffer_static_impl): The end is determined by either a NULL
	  buffer or a len of 0
	* xfer-src/element-glue.c (pull_and_push_static): Call
	  xfer_element_pull_buffer_static with a NULL buffer

2016-05-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	* client-src/sendbackup.c: Remove duplicate g_thread_join

2016-05-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	* config/amanda/amanda_configure.m4: AC_SEARCH_LIBS([shm_open], [rt])

2016-05-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	* xfer-src/source-shm-ring.c: Add the file

2016-05-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Status.pm: Fix for new shm-ring in protocol

2016-05-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	client use shm-ring between sendbackup and amandad
	shm-ring is use between client and server if using the local auth
	* amandad-src/amandad.c: handle data stream in a shm-ring
	* amandad-src/amandad.h (g_option_t): Add data_shm_control_name
	* amandad-src/amandad_util.c (parse_g_options): Parse the shm-ring
	  name
	* client-src/client_util.c: Remove debugging statement
	* client-src/sendbackup-dump.c: Compute crc, send data stream to a
	  shm-ring
	* client-src/sendbackup-gnutar.c: Compute crc, send data stream to a
	  shm-ring
	* client-src/sendbackup.c: send data stream to a shm-ring
	* client-src/sendbackup.h (handle_crc_thread,
	  handle_crc_to_shm_ring_thread): Add prototypes
	* common-src/amfeatures.c: add
	  fe_sendbackup_req_options_data_shm_control_name
	* common-src/amfeatures.h: add
	  fe_sendbackup_req_options_data_shm_control_name
	* server-src/dumper.c: Can access data stream from a shm-ring

2016-05-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	server use shm-ring beteeen dumper and chunker/taper
	Add new protocol between driver and dumper/chunker/taper
	* server-src/server_util.c (cmdstr): Add "SHM-WRITE", "SHM-DUMP",
	  "SHM-NAME"
	* server-src/server_util.h (cmd_t): Add SHM_WRITE, SHM_DUMP, SHM_NAME
	* server-src/driver.c: Handle new protocol with dumper, chunker and
	  taper
	* server-src/driverio.c: Send new command
	* server-src/dumper.c: Accept SHM_DUMP command
	* server-src/driverio.h (job_s):Add do_port_write
	* perl/Amanda/Chunker/Controller.pm: Accept SHM_WRITE command
	* perl/Amanda/Chunker/Protocol.pm (SHM_WRITE): Define it
	* perl/Amanda/Taper/Controller.pm: Accept SHM_WRITE command
	* perl/Amanda/Taper/Protocol.pm (SHM_WRITE): Define it
	* perl/Amanda/Taper/Scribe.pm: Various fix
	* perl/Amanda/Taper/Worker.pm: Handle SHM_WRITE
	* perl/Amanda/Xfer.swg: Add Amanda::Xfer::Source::ShmRing
	* installcheck/tape_action.pl: use amrandom and lexical taperscan

2016-05-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	Add a security_stream_read_to_shm_ring function, it require many
	change in the internal structure of the security layer
	* common-src/bsd-security.c (bsd_stream_read_to_shm_ring_callback,
	  bsd_stream_read_to_shm_ring): New function to implement
	  security_stream_read_to_shm_ring
	* common-src/bsdtcp-security.c: Use tcpm_stream_read_to_shm_ring
	* common-src/bsdudp-security.c: Use tcpm_stream_read_to_shm_ring
	* common-src/krb5-security.c: Use tcpm_stream_read_to_shm_ring
	* common-src/local-security.c: Use tcpm_stream_read_to_shm_ring
	* common-src/rsh-security.c: Use tcpm_stream_read_to_shm_ring
	* common-src/ssh-security.c: Use tcpm_stream_read_to_shm_ring
	* common-src/ssl-security.c: Use tcpm_stream_read_to_shm_ring
	* common-src/security-util.c (tcpm_stream_read_to_shm_ring) Add
	  fucntion
	* common-src/security-util.h (tcpm_stream_read_to_shm_ring) Add
	  prototype
	* common-src/security.h (security_driver): Add stream_read_to_shm_ring

2016-05-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	* device-src/xfer-dest-taper-cacher.c: Add the new push_buffer_static
	  xfer mechanism

2016-05-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	* device-src/xfer-dest-taper-splitter.c: Use the new mem-ring
	  internally, Can use the new mem_ring and shm_ring as input
	* installcheck/Amanda_Xfer.pl: Fix check

2016-05-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/xfer-dest-holding.c: Use the new mem-ring internally,
	  Can use the new mem_ring and shm_ring as input

2016-05-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/xfer-source-holding.c: Can use the new mem_ring and
	  pull_buffer_static xfer mechanism

2016-05-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	Add XFER_MECH_PULL_BUFFER_STATIC, XFER_MECH_PUSH_BUFFER_STATIC,
	XFER_MECH_MEM_RING and XFER_MECH_SHM_RING as new xfer mechanism
	* xfer-src/Makefile.am (libamxfer_la_SOURCES): Add source-shm-ring.c
	* xfer-src/amxfer.h: include "mem-ring.h" and "shm-ring.h"
	* xfer-src/dest-buffer.c: Add push_buffer_static_impl
	* xfer-src/dest-null.c: Add push_buffer_static_impl
	* xfer-src/element-glue.c
	* xfer-src/filter-crc.c: Add pull_buffer_static_impl and
	  push_buffer_static_impl
	* xfer-src/filter-xor.c: Add pull_buffer_static_impl and
	  push_buffer_static_impl
	* xfer-src/source-directtcp-connect.c: typo
	* xfer-src/source-directtcp-listen.c: typo
	* xfer-src/source-fd.c: typo
	* xfer-src/source-file.c: typo
	* xfer-src/source-pattern.c: Add pull_buffer_static_impl
	* xfer-src/source-random.c: Add pull_buffer_static_impl
	* xfer-src/source-shm-ring.c: New xfer source
	* xfer-src/xfer-element.c: Add various helper function
	* xfer-src/xfer-element.h (xfer_mech): Add the new xfer mechanism
	  definition
	* xfer-src/xfer.c (xfer_mech_name): Print the new xfer name

2016-05-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	Add the number of memory allocation by block in the xfer cost metric
	* xfer-src/xfer-element.h (XFER_NALLOC): New macro
	* xfer-src/xfer.c (PAIR_COST) Compute the new cost
	* device-src/xfer-dest-device.c, device-src/xfer-dest-taper-cacher.c,
	  device-src/xfer-dest-taper-directtcp.c,
	  device-src/xfer-dest-taper-splitter.c,
	  device-src/xfer-source-device.c, device-src/xfer-source-recovery.c,
	  server-src/xfer-dest-holding.c, server-src/xfer-source-holding.c,
	  xfer-src/dest-application.c, xfer-src/dest-buffer.c,
	  xfer-src/dest-directtcp-connect.c, xfer-src/dest-directtcp-listen.c,
	  xfer-src/dest-fd.c, xfer-src/dest-null.c,
	  xfer-src/element-glue.c, xfer-src/filter-crc.c,
	  xfer-src/filter-process.c, xfer-src/filter-xor.c,
	  xfer-src/source-directtcp-connect.c,
	  xfer-src/source-directtcp-listen.c, xfer-src/source-fd.c,
	  xfer-src/source-file.c, xfer-src/source-pattern.c,
	  xfer-src/source-random.c,
	  xfer-src/xfer-test.c: Add the new cost value

2016-05-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	Add a shared memory ring
	* common-src/Makefile.am (libamanda_la_SOURCES): Add shm-ring.c
	* common-src/security.h: include "shm-ring.h"
	* common-src/shm-ring.c: New file
	* common-src/shm-ring.h: New header

2016-05-02  Jean-Louis Martineau <JMartineau@carbonite.com>
	Add a memory ring
	* common-src/Makefile.am (libamanda_la_SOURCES): Add mem-ring.c
	* common-src/mem-ring.c: New file
	* common-src/mem-ring.h: New header

2016-04-29  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/server_util.c (putresult): Print the complete line in the
	  debug file

2016-04-29  Jean-Louis Martineau <JMartineau@carbonite.com>
	* amar-src/amarchiver.c: s/error/gerror/

2016-04-29  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/ammessage.c: typo
	* device-src/s3-util.c: Fix buffer overflow

2016-04-29  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Cmdfile.swg: Remove debugging statement

2016-04-26  Jean-Louis Martineau <JMartineau@carbonite.com>
	* client-src/sendbackup.c: Call application_api_info_tapeheader before
	  closing statefd

2016-04-25  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/tape_action.pl: Fix check

2016-04-25  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/file.c (areads_dataready): Check fd < 0

2016-04-25  Jean-Louis Martineau <JMartineau@carbonite.com>
	* recover-src/extract_list.c: Remove debugging statement

2016-04-25  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/file.c (areads_dataready): Also use select to find if
	  something can be read
	* server-src/server_util.c (getcmd): Use areads instead of agets
	* server-src/server_util.c (get_pending_cmd): Call areads_dataready

2016-04-21  Jean-Louis Martineau <JMartineau@carbonite.com>
	* application-src/amrandom.pl: A new application that generate a
	  random backup, useful for testing
	* application-src/Makefile.am (SCRIPTS_PERL): Add amrandom

2016-04-19  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/pp-scripts.pl: Print more info on failure

2016-04-19  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/tape_action.pl: Open a debug file

2016-04-19  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/diskfile.c (get_disklist): New function
	* server-src/diskfile.h (get_disklist): prototype

2016-04-19  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/tapefile.c (compute_retention): Fix if a dle is not in
	  the disklist

2016-04-19  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/amstatus.pl: typo

2016-04-19  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Amanda_ClientService.pl: Fix for new DATA_FD_OFFSET
	  value

2016-04-19  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/amanda.h, perl/Amanda/Constants.pm.in.src:Increase
	  DATA_FD_OFFSET to 150, it allow more paralled backup with bsd or
	  bsdudp auth

2016-04-19  Jean-Louis Martineau <JMartineau@carbonite.com>
	* application-src/amgtar.c: Compare unescaped filename with the DAR
	  state file

2016-04-15  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/security-util.c (sec_tcp_conn_read_callback): do not free
	  rc

2016-04-15  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/tape_action.pl: Fix test

2016-04-14  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/planner.c (promote_highest_priority_incremental): Was not
	  promote the correct ep (possible infinite loop)

2016-04-13  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/amutil.c (split_quoted_strings_for_amstatus): New
	  function to parse a line for Amanda::Status
	* common-src/amutil.h (split_quoted_strings_for_amstatus): Add
	  protoype
	* perl/Amanda/Util.swg:Swig split_quoted_strings_for_amstatus
	* perl/Amanda/Status.pm: Use split_quoted_strings_for_amstatus

2016-04-12  Jean-Louis Martineau <JMartineau@carbonite.com>
	* packaging/deb/amanda-backup-client.install,
	  packaging/deb/amanda-backup-server.install: Add etc/amanda/*

2016-04-12  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/driver.c (tape_action): Fix for parallel taper

2016-04-12  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Status.pm: Fix worker status

2016-04-12  Jean-Louis Martineau <JMartineau@carbonite.com>
	* Allow multiple connections to a client with different auth

2016-04-11  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Makefile.am: Typo

2016-04-11  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Report/human.pm: Remove multiple output line
	* server-src/driver.c: Fix after a TRY-AGAIN
	* installcheck/Makefile.am: Add catalogs/dumper-tryagain.cat
	* installcheck/amreport.pl: Add check for dumper-tryagain.cat
	* installcheck/catalogs/tapers.cat: Fix for new output
	* installcheck/catalogs/dumper-tryagain.cat: New test case

2016-04-08  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/amcrc32chw.c: Add fall through comment

2016-04-08  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/event.c (fire): Allow for NULL callback

2016-04-08  Jean-Louis Martineau <JMartineau@carbonite.com>
	* device-src/tape-device.c: improve error message on write fail

2016-04-07  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/planner.c: Remove for startq

2016-03-31  Jean-Louis Martineau <JMartineau@carbonite.com>
	* application-src/ambsdtar.c: use bsdtar_realpath

2016-03-31  Jean-Louis Martineau <JMartineau@carbonite.com>
	* config/amanda/syshacks.m4: accept *-apple-darwin*
	* common-src/conffile.c, common-src/conffile.h, common-src/match.c,
	  common-src/match.h, perl/Amanda/Config.swg, perl/Amanda/Util.swg,
	  server-src/amadmin.c, server-src/amcheck.c, server-src/planner.c,
	  server-src/tapefile.c: s/labeltsr_t/labelstr_s/ and
	  s/policy_t/policy_s/g because they are defined on OSX

2016-03-30  Jean-Louis Martineau <JMartineau@carbonite.com>
	* recover-src/extract_list.c: Use property from header instead of from
	  disklist

2016-03-28  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Amanda_Xfer.pl: Validate CRC and part size

2016-03-22  Jean-Louis Martineau <JMartineau@carbonite.com>
	* NEWS: Add new amadmin command and amtape inventory result

2016-03-22  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Rest/Labels.pm: Add the RentetionType in result
	* perl/Amanda/Rest/Storages.pm: Add the RentetionType in result
	* installcheck/Amanda_Rest_Labels.pl,
	  installcheck/Amanda_Rest_Storages.pl: Fix for new result

2016-03-22  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/amtape.pl: Add the RetentionType in the inventory result

2016-03-22  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/amadmin.c: Add retention command
	* server-src/amadmin_perl.pl: Implement retention command
	* man/xml-source/amadmin.8.xml: Document retention command

2016-03-22  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Taper/Worker.pm: Typo

2016-03-22  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/tapefile.h (tape_t): Add the RetentionType
	* server-src/tapefile.c: Comupte the RetentionType
	* perl/Amanda/Tapelist.swg: Swig the RetentionType

2016-03-21  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Taper/Worker.pm (scribe_notif_new_tape): Check for no
	  error

2016-03-21  Jean-Louis Martineau <JMartineau@carbonite.com>
	* device-src/vfs-device.c: Return some error instead of just logging a
	  warning

2016-03-18  Jean-Louis Martineau <JMartineau@carbonite.com>
	* xfer-src/element-glue.c (do_directtcp_accept): Increase timeout to
	  840

2016-03-18  Jean-Louis Martineau <JMartineau@carbonite.com>
	Add RESTORE command in the cmdfile
	* man/xml-source/amfetchdump.8.xml: Document new --reserve-tapes and
	  --release-tapes options
	* perl/Amanda/Cmdfile.swg: Add CMD_RESTORE
	* perl/Amanda/DB/Catalog.pm: Get the pool fromthe find result
	* perl/Amanda/FetchDump.pm: Add release-tapes and reserve-tapes
	* perl/Amanda/Recovery/Planner.pm: Add the pool
	* perl/Amanda/Restore.pm: Handle release-tapes and reserve-tapes
	* server-src/amfetchdump.pl: New --release-tapes and --reserve-tapes
	  options
	* server-src/cmdfile.c: Add CMD_RESTORE
	* server-src/cmdfile.h: Add CMD_RESTORE
	* server-src/find.h (find_result_t): Add pool in the struct
	* server-src/tapefile.c: Compute retention for CMD_RESTORE command

2016-03-18  Jean-Louis Martineau <JMartineau@carbonite.com>
	Add "POOL:pool" to many taper log lines
	* perl/Amanda/DB/Catalog.pm: Parse POOL:pool
	* perl/Amanda/Logfile.swg: Add pool
	* perl/Amanda/Report.pm: Parse POOL:pool
	* perl/Amanda/Taper/Worker.pm: Add "POOL:pool" to many taper log lines
	* server-src/find.c: Parse POOL:pool
	* installcheck/Amanda_Report.pl, installcheck/Amanda_Rest_Dumps.pl,
	  installcheck/Installcheck/Catalogs.pm, installcheck/taper.pl: Fix

2016-03-18  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Changer.pm (Reservation::set_device_error): New method
	* perl/Amanda/Changer/aggregate.pm (set_device_error): New method
	* perl/Amanda/Changer/multi.pm (set_device_error): New method
	* perl/Amanda/Changer/robot.pm (set_device_error): New method
	* perl/Amanda/ScanInventory.pm: Use a global seen hash
	* perl/Amanda/Taper/Scan/lexical.pm,
	  perl/Amanda/Taper/Scan/oldest.pm: Samll fix
	* perl/Amanda/Taper/Scribe.pm: Call $reservation->set_device_error
	* installcheck/Amanda_Taper_Scan_lexical.pl,
	  installcheck/Amanda_Taper_Scan_oldest.pl,
	  installcheck/taper.pl: Fix test

2016-03-17  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Makefile.am (catalogs): Add catalogs/tapers.cat and
	  catalogs/tapers1.cat

2016-03-14  Jean-Louis Martineau <JMartineau@carbonite.com>
	* common-src/ammessage.c: Fix parsing of NULL, true or false value

2016-03-14  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/Report/human.pm: Fix compression for partial result
	* installcheck/amreport.pl: Check partial result
	* installcheck/catalogs/tapers1.cat,
	  installcheck/catalogs/tapers.cat: New catalogs to check taper
	  partial result
	* installcheck/catalogs/taperr.cat: Typo

2016-03-01  Jean-Louis Martineau <JMartineau@carbonite.com>
	* perl/Amanda/ScanInventory.pm: A no-reuse is not a new labelled tape
	* installcheck/Amanda_Taper_Scan_lexical.pl,
	  installcheck/Amanda_Taper_Scan_oldest.pl,
	  installcheck/Amanda_Taper_Scan_traditional.pl: Add check

2016-02-29  Jean-Louis Martineau <JMartineau@carbonite.com>
	* installcheck/Amanda_Rest_Runs.pl: Fix for Report/json.pm fix

2016-02-29  Jean-Louis Martineau <JMartineau@carbonite.com>
	* server-src/driver.c: fix for last dle span two tapes
	* device-src/vfs-device.c: Add a SLOW-WRITE property (for testing)
	* device-src/vfs-device.h: Add a SLOW-WRITE property (for testing)
	* installcheck/Installcheck/Config.pm (rm_param): New fucntion
	* installcheck/Installcheck/Run.pm (clean_taperoot: New function
	* installcheck/Makefile.am: Add tape_action
	* installcheck/tape_action.pl: New installcheck script to check the
	  tape_action function

2016-02-29  Jean-Louis Martineau <JMartineau@carbonite.com>
	Patch by Micheal Burk
	* perl/Amanda/Report/json.pm: fixup

2016-02-25  Jean-Louis Martineau <martineau@zmanda.com>
	* all files: Update copyright notice

2016-02-24  Jean-Louis Martineau <martineau@zmanda.com>
	* config/libtool.m4: Fix for x86_64
	* contrib/libtool-for-x86_64.diff: Copy of the patch

2016-02-22  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/amstatus.pl: Test number printing
	* installcheck/Makefile.am: Add catalogs/number.cat
	* installcheck/catalogs/number.cat: New catalog file for testing
	  number

2016-02-22  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Give and error if MAX-RECV-SPEED or
	  MAX-SEND-SPEED is below 5120
	* man/xml-source/amanda-devices.7.xml: Document the minimum value for
	  MAX-RECV-SPEED and MAX-SEND-SPEED

2016-02-22  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda-security.conf.5.xml: Document permissions

2016-02-17  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Add SERVICE_AMBACKUPD
	* client-src/Makefile.am: Add ambackup
	* client-src/ambackup.pl: New client program to start a backup
	* man/Makefile.am: Add ambackup.8
	* man/xml-source/ambackup.8.xml: New man page
	* perl/Amanda/Logfile.swg: Add P_AMBACKUPD
	* perl/Amanda/Message.pm: Add message id for ambackupd
	* perl/Amanda/Report.pm: Handle ambackupd run
	* server-src/Makefile.am: Add ambackupd
	* server-src/ambackupd.pl: New server service to allow ambackup to run
	  a backup
	* server-src/amreport.pl: Handle ambackupd run
	* server-src/logfile.c: Add ambackupd
	* server-src/logfile.h: Add P_AMBACKUPD

2016-02-17  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Curinfo/Info.pm (update_dumper): New function

2016-02-17  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Send P_NAK with ERRIR message on some error

2016-02-17  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Holding.pm (filetmp_chunks): Renamed from
	  file_tmp_chunks

2016-02-17  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Chunker/Scribe.pm: Fix pod

2016-02-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindexd.c: Check recovery-limit

2016-02-17  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/amrecover.c (server_warning): New function
	* recover-src/amrecover.h (server_warning): Add prototype
	* recover-src/set_commands.c: Use server_warning()

2016-02-17  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Fix
	* client-src/selfcheck.c: Fix

2016-02-17  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ssl-security.c: s/remote_port/client_port/

2016-02-17  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/amdump_client.pl: Remove printing the config
	* installcheck/amdump_client.pl: Fix

2016-02-17  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/human.pm: Improve output
	* installcheck/catalogs/bigestimate.cat,
	  installcheck/catalogs/doublefailure.cat,
	  installcheck/catalogs/longstrange.cat,
	  installcheck/catalogs/resultsmissing.cat,
	  installcheck/catalogs/retried-nofinish.cat,
	  installcheck/catalogs/retried.cat,
	  installcheck/catalogs/shortstrange.cat,
	  installcheck/catalogs/skipped.cat: Fix for report change

2016-02-17  Jean-Louis Martineau <martineau@zmanda.com>
	* xfer-src/source-file.c: Cleanup
	* xfer-src/xmsg.h: Fix comment

2016-02-17  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Fix hang if receive partial packet from
	  network

2016-02-16  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm, perl/Amanda/Taper/Scribe.pm,
	  server-src/driver.c: s/writting/writing/g

2016-02-11  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup-gnutar.c, client-src/sendsize.c: Init mlist
	  to NULL

2016-02-11  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/amanda_configure.m4 (AM_INIT_AUTOMAKE): Add
	  subdir-objects
	* amandad-src/Makefile.am, amar-src/Makefile.am,
	  application-src/Makefile.am, client-src/Makefile.am,
	  common-src/Makefile.am, device-src/Makefile.am,
	  installcheck/Makefile.am, ndmp-src/Makefile.am,
	  oldrecover-src/Makefile.am, perl/Makefile.am,
	  perl/amglue/Makefile.am, po/Makefile.am,
	  recover-src/Makefile.am, server-src/Makefile.am,
	  xfer-src/Makefile.am: Cleanup
	  s/INCLUDES/AM_CPPFLAGS/
	  s/mkdir_p/MKDIR_P/

2016-02-11  Jean-Louis Martineau <martineau@zmanda.com>
	* config/ar-lib: Add file

2016-02-11  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ammessage.h (messagelist_t): New typedef for a GSList of
	  messages
	* common-src/ammessage.c: Add messages
	* client-src/client_util.c (build_exclude, build_include): return a
	  messagelist_t instead of printing error
	* client-src/client_util.c (build_exclude, build_include): Change
	  prototype
	* application-src/ambsdtar.c, application-src/amgtar.c,
	  client-src/selfcheck.c, client-src/sendbackup-gnutar.c,
	  client-src/sendsize.c: Print messages from build_exclude and
	  build_include
	* perl/Amanda/CheckDump.pm (); return undef on success

2016-02-11  Jean-Louis Martineau <martineau@zmanda.com>
	* gnulib/Makefile.am: Remove regenerate.swp

2016-02-11  Jean-Louis Martineau <martineau@zmanda.com>
	* config/gnulib/*, config/snipset/*, gnulib/*: Upgrade to gnulib
	  cd9ecca8812571fc443688d11148f2768ededfa4

2016-02-11  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c, server-src/amindexd.c: Check result of
	  fopen()

2016-02-11  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.ac: Renamed from configure.in
	* configure.in: Renamed to configure.ac
	* config/amanda/i18n.m4, config/amanda/progs.m4,
	  config/compile, config/config.guess,
	  config/macro-archive/ac_prog_swig.m4, packaging/README,
	  packaging/rpm/buildpkg: s/configure.in/configure.ac/

2016-02-09  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/amgetconf.pl: s/unknown/Unknown/

2016-02-09  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/amgetconf.pl: Test the result of 'amgetconf --platform'
	  and 'amgetconf --distro' are not "unknown"

2016-02-09  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amutil.c (get_platform_and_distro, get_platform,
	  get_distro): New functions toreturn platform and distro
	* common-src/amutil.h (get_platform_and_distro, get_platform,
	  get_distro): Add prototypes
	* client-src/selfcheck.c: Use get_platform_and_distro()
	* common-src/amgetconf.pl: Add --platform and --distro arguments
	* man/xml-source/amgetconf.8.xml: Document --platform and --distro
	* perl/Amanda/Util.swg: Swig get_platform and get_distro
	* NEWS: Add new --platform and --distro argument of amgetconf

2016-02-08  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Fix for taper FAILED
	* perl/Amanda/Taper/Worker.pm: Wait to get the device before checking
	  if it support the requested data_path
	* server-src/driver.c: Fix reporting
	* server-src/driver.c: Use any idle wtaper
	* server-src/dumper.c: Do not send the header to the taper until some
	  data is received

2016-02-05  Jean-Louis Martineau <martineau@zmanda.com>
	* config/libtool.m4, config/ltmain.sh, config/ltoptions.m4,
	  config/ltsugar.m4, config/ltversion.m4,
	  config/lt~obsolete.m4: Upgrade lintool to 2.4.6

2016-02-05  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ambsdtar.c, application-src/amgtar.c,
	  application-src/amstar.c (*_backup): Send message to mesgstream

2016-02-04  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/Makefile.am: s/CFLAGS/AM_CFLAGS/

2016-02-04  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amfetchdump.8.xml: Add --run-client-scripts

2016-02-04  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/defaults.m4: Add --with-security-file configure option
	* common-src/ammessage.c: Improve messages
	* common-src/security-file.c: Use DEFAULT_SECURITY_FILE, check the
	  path is secure
	* common-src/security-file.h (check_security_file_permission): Remove
	* NEWS, ReleaseNotes: Add --with-security-file configure option

2016-02-02  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: Do not use gnuish of realpath

2016-02-02  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/dumpers.m4: Use AM_READLINK
	* config/amanda/progs.m4: Verify that $READLINK is what we want and
	  set AM_READLINK

2016-02-02  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Fix for 32 bits perl

2016-02-02  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ammessage.c: Fix for errno in message
	* installcheck/Amanda_Rest_Services_senddiscover_amgtar.pl,
	  installcheck/Amanda_Rest_Amcheck.pl: Fix
	* man/xml-source/amssl.8.xml: Improve documentation

2016-02-01  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amutil.c: Fix for automatic test

2016-02-01  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c, common-src/amutil.c,
	  xfer-src/xfer-test.c: Fix bug found by coverity

2016-02-01  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-file.c: Fix small memory leak

2016-01-29  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/amanda_configure.m4: Invoke AMANDA_PROG_READLINK
	* config/amanda/dumpers.m4: use READLINK if REALPATH is not available
	* config/amanda/progs.m4: Find readlink

2016-01-29  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/make_security_file.c: Print '='

2016-01-29  Jean-Louis Martineau <martineau@zmanda.com>
	* Improve reporting of security message

2016-01-28  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS: Change in 3.3.9
	* ReleaseNotes: Change in 3.3.9

2016-01-27  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/rpm/amanda.spec.src: Use 'mkdirp -p'

2016-01-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/Makefile.am (EXTRA_DIST): Remove
	* recover-src/Makefile.am (EXTRA_DIST): Add uscan.c

2016-01-26  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-file.c: s/g_strcmp0/strcmp/
	* man/xml-source/amanda.8.xml: Add amanda-security.conf

2016-01-25  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/Makefile.am (EXTRA_DIST): Add make_security_file.c
	* common-src/make_security_file.c: Typo

2016-01-25  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-file.c: Fix security
	* installcheck/ambsdtar.pl, installcheck/amgtar.pl: Fix for non-root

2016-01-25  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: Check for SINGLE_USERID
	* common-src/Makefile.am: Install example amanda-security.conf in
	  CONFIG_DIR

2016-01-25  Jean-Louis Martineau <martineau@zmanda.com>
	* Add a /etc/amanda-security.conf file

2016-01-22  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ambsdtar.c, application-src/amgtar.c,
	  application-src/amstar.c: Filter option from COMMAND-OPTIONS
	* common-src/ammessage.c: Add message

2016-01-22  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c (check_exec_for_suid_message,
	  check_exec_for_suid): New functions to verify a binary is secure
	* client-src/client_util.h(check_exec_for_suid_message,
	  check_exec_for_suid): Add prototypes
	* application-src/ambsdtar.c, application-src/amgtar.c,
	  application-src/amstar.c, client-src/runtar.c: Call
	  check_exec_for_suid* before running a binary as root
	* common-src/ammessage.c: Add messages
	* installcheck/ambsdtar.pl: Fix check
	* installcheck/amgtar.pl: Fix check

2016-01-22  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/runtar.c: Filter tar arguments
	* installcheck/runtar.pl: Check runtar errorr
	* installcheck/Makefile.am: Add runtar.pl

2016-01-19  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/set_commands.c (set_host): Correctly setdump_hostname
	  when the input is quoted with double quote

2016-01-19  Jean-Louis Martineau <martineau@zmanda.com>
	* config/set_full_version: Fix for new URL path

2016-01-19  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS: Typo
	* ReleaseNotes: Typo

2016-01-19  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS: Change in 3.3.8
	* ReleaseNotes: Change in 3.3.8

2015-12-10  Xu Han <xhan@carbonite.com>
	* packaging/common/post_inst_functions.sh: Adding the correct
	  Amanda sbin path to Solaris Amandabackup user profile file

2015-12-09  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndma_tape.c (ndmta_read_quantum): Fix setting
	  ta->mover_state.record_num

2015-12-09  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Fir debugging message
	* common-src/glib-util.c: Improve error message
	* perl/Amanda/Extract.pm: Fix in error path

2015-12-09  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amlog-script.pl, application-src/ampgsql.pl,
	  application-src/amraw.pl, application-src/amsamba.pl,
	  application-src/amsuntar.pl, application-src/amzfs-sendrecv.pl,
	  application-src/amzfs-snapshot.pl,
	  application-src/script-email.pl: Log the arguments

2015-12-04  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Change message

2015-12-04  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/amrecover.c: Use the amanda-client.conf hostname setting

2015-12-04  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add amanda-client 'hostname' global setting
	* common-src/conffile.h: Add CNF_HOSTNAME
	* perl/Amanda/Config.swg: Add CNF_HOSTNAME
	* man/xml-source/amanda-client.conf.5.xml: Document hostname

2015-12-04  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Use getstatefname()

2015-12-04  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amutil.c (get_fsusage): New function to the filesystem
	  usage
	* common-src/amutil.h (get_fsusage): Add prototype.
	 common-src/amxml.c: Cleanup
	* server-src/diskfile.c (xml_optionstr_disk, xml_estimate_disk,
	  xml_application_disk): New functions to return anxnl string
	* server-src/diskfile.h (xml_optionstr_disk, xml_estimate_disk,
	  xml_application_disk): Add prototypes
	* perl/Amanda/Disklist.swg (xml_optionstr_disk, xml_application_disk,
	  xml_estimate_disk): Swig these functions
	* perl/Amanda/Logfile.swg (log_start_multiline, log_end_multiline):
	  Swig these functions
	* perl/Amanda/Util.swg (amxml_format_tag, get_fsusage,
	  get_time_from_timestamp): Swig these functions

2015-12-ouis Martineau <martineau@zmanda.com>
	* common-src/amfeatures.h: Add fe_restore_prev_next_level
	* common-src/amfeatures.c: Add fe_restore_prev_next_level
	* server-src/amfetchdump.pl: Add --prev-level and --next-level
	  arguments
	* man/xml-source/amfetchdump.8.xml: Document --prev-level and
	  --next-level argument
	* perl/Amanda/Extract.pm (run_scripts): New method to run scripts
	* perl/Amanda/FetchDump.pm: Keep copy of prev-level and next-level
	* perl/Amanda/FetchDump/Application.pm: Fix race
	* perl/Amanda/FetchDump/ClientApplication.pm: Send PREV-NEXT-LEVEL to
	  client, fix race
	* perl/Amanda/Restore.pm: Call feedback run_pre_scripts and
	  run_post_scripts
	* perl/Amanda/Service/Restore.pm: Get PREV-NEXT-LEVEL from server,
	  call $extract->run_scripts() to run the scrips

2015-11-30  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amfeatures.h (fe_restore_include,
	  fe_restore_include_glob, fe_restore_exclude,
	  fe_restore_exclude_glob): New amfeature to send include/exclude to
	  the restore service
	* common-src/amfeatures.c: Add new amfeature
	* server-src/amfetchdump.pl: New arguments: --include-file,
	  --include-list, --include-list-glob, --exclude-file, --exclude-list,
	  --exclude-list-glob
	* man/xml-source/amfetchdump.8.xml: Document new arguments.
	* perl/Amanda/Extract.pm: Add the various include/exclude arguments to
	  the restore_argv
	* perl/Amanda/FetchDump.pm: Keep local copy of the include/exclude
	  arguments
	* perl/Amanda/FetchDump/Application.pm: Pass the include/exclude
	  arguments to the Extract module
	* perl/Amanda/FetchDump/ClientApplication.pm: Send include/exclude
	  arguments to the restore service
	* perl/Amanda/Service/Restore.pm: Get include/exclude from the server,
	  Pass them to the Extract module

2015-11-27  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Restore.pm: Fix typo

2015-11-27  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Restore.pm: Fix Message handling

2015-11-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindex.c (getstatefname): New functionto return the name
	  of the state file
	* server-src/amindex.h (getstatefname): Add prototype
	* perl/Amanda/Logfile.swg: swig getstatefname
	* perl/Amanda/Extract.pm: Get the state file name as argument
	* perl/Amanda/FetchDump/Application.pm (transmit_state_file):
	  Uncompress de state file is required
	* perl/Amanda/FetchDump/ClientApplication.pm: Use getstatefname and
	  some fix
	* perl/Amanda/Restore.pm: Call start_read_dar after
	  notify_start_backup
	* perl/Amanda/Service/Amidxtaped.pm: Use getstatefname
	* perl/Amanda/Service/Restore.pm (transmit_dar): Fix

2015-11-26  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amanda.h: Remove define of _LARGEFILE64_SOURCE

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/syshacks.m4: Define _XOPEN_SOURCE and
	  _XOPEN_SOURCE_EXTENDED on solaris to get correct type for
	  'struct iovec'

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/human.pm: Fix crash if orig_size == 0

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: Install perl/Amanda/FetchDump files

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Extract.pm: Correctly check if program_path is an
	  Amanda::Message

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Service/Restore.pm: Remove unused code

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Log which conffile is read

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: Typo

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Util.swg: swig quote_string_always

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Runs.pm: Use new FetchDump API

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Extract.pm (set_validate_argv): New function

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Disklist.swg: Add all auth option to the host class

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ammessage.c: Add new message
	* perl/Amanda/Message.pm: Add new message

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amfeatures.c, common-src/amfeatures.h: Add new amfeatures
	  for amrecover/amidxtaped protocol change and for the new restore
	  service

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/senddiscover.c: use MSG_ERROR instead of 16

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Add the restore service

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amservice.8.xml: Document new amservice options

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Services_senddiscover.pl,
	  installcheck/ambsdtar.pl, installcheck/amcheckdump.pl,
	  installcheck/amfetchdump.pl,
	  installcheck/amidxtaped.pl: Fix for  changes

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Fix for security API fix

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amfetchdump.pl: use Amanda::Fetchdump subclass
	* perl/Amanda/FetchDump.pm: Generic class
	* perl/Amanda/FetchDump/Application.pm,
	  perl/Amanda/FetchDump/ClientApplication.pm,
	  perl/Amanda/FetchDump/Local.pm: Specific module for different
	  destination, use Amanda::Restore

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/restore.pl: New client service to restore on the client
	* client-src/Makefile.am: add restore.pl
	* perl/Amanda/Service/Restore.pm: Core of service, use Amanda::Restore
	* perl/Makefile.am: Add Amanda/Service/Restore.pm

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/CheckDump.pm: Use Amanda::Restore module
	* server-src/amcheckdump.pl: Use Amanda::CheckDump

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* xfer-src/dest-fd.c, xfer-src/filter-crc.c,
	  xfer-src/filter-process.c, xfer-src/source-fd.c,
	  xfer-src/xfer-element.h: Small fix

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Service/Amidxtaped.pm: New amidxtaped perl module, it
	  use Amanda::Restore
	* server-src/amidxtaped.pl: Use Amanda::Service::Amidxtaped
	* recover-src/amrecover.c, recover-src/extract_list.c: improve
	  amrecover-amidxtaped protocol

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Restore.pm: New module to to do a recovery, all program
	  will use it.
	* perl/Makefile.am: Add Amanda/Restore.pm

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Amservice.pm: New perl module to execute amservive
	* perl/Makefile.am: Add Amanda/Amservice.pm

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amservice.c: Add --stream and --config option, use
	  security_stream_write_async

2015-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsd-security.c, common-src/bsdtcp-security.c,
	  common-src/bsdudp-security.c, common-src/krb5-security.c,
	  common-src/local-security.c, common-src/rsh-security.c,
	  common-src/security-util.c, common-src/security-util.h,
	  common-src/security.c, common-src/security.h,
	  common-src/ssh-security.c,
	  common-src/ssl-security.c: Fix security API and add
	  security_stream_write_async and security_stream_close_async

2015-11-20  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/DB/Catalog.pm: Filter with the status
	* perl/Amanda/Recovery/Planner.pm: Pass the status to
	  Amanda::DB::Catalog::get_dumps
	* perl/Amanda/FetchDump.pm, perl/Amanda/CheckDump.pm,
	  perl/Amanda/Taper/Worker.pm, perl/Amanda/Vault.pm,
	  server-src/amreindex.pl: Call Amanda::Recovery::Planner::make_plan
	  with a "status => 'OK'" argument

2015-11-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (handle_taper_result): Set job to NULL
	* server-src/driverio.c: Improve debugging
	* file server-src/planner.c (est_dump_queue): Fix crash

2015-11-11  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amcryptsimple.pl: Use 'gpg-agent --use-standard-socket-p'
	  to find if gpg-agent must be used

2015-11-09  Orion Poplawski
	* perl/Amanda/Vault.pm: Add missing parens

2015-11-05  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Services_senddiscover.pl,
	* installcheck/Amanda_Rest_Services_senddiscover_amgtar.pl: Skip if
	  client is not compiled

2015-11-05  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/amvault.pl: Do not check the size, it varies on
	  different machines

2015-11-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amfetchdump.pl: Fix argument check
	* man/xml-source/amfetchdump.8.xml: Fix spacing

2015-11-05  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/amgtar.pl: Ignore SIGPIPE
	* installcheck/Installcheck/Application.pm: Do not fail on SIGPIPE if
	  allowed

2015-11-04  Orion Poplawski
	* perl/Amanda/Vault.pm: Output the size of each dump
	* installcheck/amvault.pl: Fix for new output

2015-11-04  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Services_senddiscover_amgtar.pl:
	  Workaround for File::Temp without newdir function

2015-11-03  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm (_volume_cb): Release the old
	  reservation when changing scribe

2015-10-29  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Label.pm: Fix severity
	* perl/Amanda/Message.pm: Fix for code 1 or 2
	* server-src/amlabel.pl: Severity of ERROR is always a failure

2015-10-29  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/amgtar.pl: Fix

2015-10-29  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ambsdtar.c (restore): Exit with 1 if BSDTAR-PATH
	  can't be executed
	* application-src/amgtar.c (amgtar_restore): Exit code of 1 is an
	  error
	* config/amanda/dumpers.m4 (AMANDA_PROG_BSDTAR): Fix BSDTAR default
	  value
	* installcheck/Installcheck/Application.pm (restore): Return the
	  stderr of the application
	* installcheck/Makefile.am (client_tests): Add ambsdtar
	* installcheck/amgtar.pl: Add check
	* installcheck/ambsdtar.pl: New file to check ambsdtar behavior

2015-10-27  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Services_senddiscover_amgtar.pl: Fix for
	  maximumm length f a socket path.

2015-10-26  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c (amgtar_discover): Implement the discover
	  API.
	* client-src/senddiscover.c: Pass --device only if device is provided.
	* common-src/ammessage.c: Add message for code 3100005, 3100006,
	  3700012 and 3700013
	* perl/Amanda/Rest/Configs.pm: Improve documentation
	* perl/Amanda/Rest/Services.pm (discover): Many fixes
	* rest-server/bin/app.pl.in: discover service can be called for a
	  config
	* rest-server/lib/Amanda/Rest.pm.in: discover service can be called
	  for a config
	* installcheck/Amanda_Rest_Services_senddiscover.pl: Test the REST
	  senddiscover service
	* installcheck/Amanda_Rest_Services_senddiscover_amgtar.pl: Test the
	  amgtar REST senddiscover service
	* installcheck/Makefile.am (server_tests): Add
	  Amanda_Rest_Services_senddiscover and
	  Amanda_Rest_Services_senddiscover_amgtar

2015-10-21  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amutil.c (swap): __builtin_bswap32 is defined only for
	  GCC >= 4.3.0

2015-10-21  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amutil.c (swap): Add missing function

2015-10-21  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm (inventory_unlocked): Can returen all
	  slot (even those not in use-slot)
	* perl/Amanda/Recovery/Scan.pm (find_volume): Use only allowed slot

2015-10-20  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Do not free current_block

2015-10-19  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda-devices.7.xml: Add STANDARD_IA storage_class

2015-10-19  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.h (StorageClass): Add S3_SC_STANDARD_IA.
	* device-src/s3.c: Fix for STANDARD_IA
	* server-src/amcheck.c: Fix message argument name.

2015-10-19  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c Default SPARSE value is NO if tar < 1.28

2015-10-16  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Use '--blocking-factor 64' when creating
	  a tar file

2015-10-15  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ammessage.c: Change message for 2800217. Allow
	  substitution in the hint field
	* common-src/amutil.c: Change the
	          "running as user \"%s\" instead of \"%s\""" message
	* server-src/amcheck.c: Fix for running user

2015-10-15  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/FetchDump.pm: Do not look for storage when recovery is
	  from a holding disk

2015-10-14  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Add debugging
	* perl/Amanda/FetchDump.pm: Send the statefile earlier, trap error

2015-10-13  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Remember the level of the last
	  backup and use it to find the corresponding statefile

2015-10-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Fix for taper crash
	* server-src/dumper.c: Fix compatibility issue

2015-10-07  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/FetchDump.pm: Filter /trailing garbage ignored/

2015-10-02  Jean-Louis Martineau <martineau@zmanda.com>
	* xfer-src/filter-process.c: gzip exit 2 is not an error
	* installcheck/Amanda_Xfer.pl: test it

2015-09-29  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Orion Poplawski
	* man/xml-source/tapelist.5.xml: Fix duplicate word

2015-09-28  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndmjob_main_util.c: Always quote log message.

2015-09-23  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Label.pm: Fix if the device can't be opened

2015-09-22  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/Makefile.am: Fix CFLAGS for compiling amcrc32c.c

2015-09-19  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/flags.m4: s/gcc/$CC/

2015-09-18  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: Fix compiler error

2015-09-18  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amutil.c (make_crc_table): Remove a bogus fprintf

2015-09-18  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amcrc32chw.c: Fix for 32 bits

2015-09-18  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amcrc32chw.c: Qualify crc32vc_add_hw argument as
	  G_GNUC_UNUSED
	* common-src/amutil.c: Define get_sse42 only if we use it
	* common-src/crc32-test.c: Fix if not in 64 bits mode

2015-09-18  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: Fix compiler warning
	* config/amanda/flags.m4: Fix egrep expresion for solaris

2015-09-18  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amutil.c: Fix asm code on i386

2015-09-17  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amutil.c: Use better asm code to detect sse4.2

2015-09-17  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amutil.c (have_sse42): Do not declare static
	* common-src/amutil.h (have_sse42): Add extern declaration
	* common-src/crc32-test.c: Do not run hardware crc32 test if the cpu
	  do not have sse4.2

2015-09-17  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/Makefile.am (noinst_HEADERS): Add amcrc32chw.h

2015-09-17  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amcrc32chw.c: New file to compute crc32c with sse4.2
	  instruction
	* common-src/amcrc32chw.h: New prototype file
	* common-src/Makefile.am: Code to build amcrc32chw
	* common-src/amanda.h: Define GCC_VERSION
	* common-src/amutil.c: Detect if processor hace sse4.2 and use it
	* common-src/crc32-test.c: Add test for hw version
	* config/amanda/amanda_configure.m4: Call AMANDA_CHECK_SSE42
	* config/amanda/flags.m4 (AMANDA_CHECK_SSE42) New macro to detext if
	  gcc have -msse4.2
	* installcheck/chunker.pl, installcheck/taper.pl: Fix for crc32c

2015-09-17  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amutil.c: Chagre the crc32 POLY to 0x82F63B78

2015-09-16  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amutil.c (crc32_add): Use software improvement on big
	  endian machine.

2015-09-15  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amutil.c: Fix compilation

2015-09-15  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amutil.c: Fix compilation

2015-09-15  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amutil.c (crc32_add_16bytes): New faster algorith to
	  compute crc 32
	* common-src/amutil.c (crc32_add): Call crc32_add_1byte or
	  crc32_add_16bytes.
	* common-src/amutil.h (crc32_add_1byte, crc32_add_16bytes): Add new
	  prototypes.
	* common-src/Makefile.am (TEST): Add crc32-test
	* common-src/crc32-test.c: New program to test crc32

2015-09-15  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/debug.c (debug_ressource_usage): New function to write
	  the system ressource utilization to the debug file
	* common-src/debug.c (debug_close): Call debug_ressource_usage

2015-09-10  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.h (no_yes_all_t, priority_t, execute_where_t):
	  New enum
	* common-src/conffile.c, server-src/amcheck.c, server-src/diskfile.c,
	  server-src/server_util.c: Use ne enum constants.
	* perl/Amanda/Config.swg: Add more function to return enum value
	* installcheck/Amanda_Config.pl: Add tests

2015-09-09  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/amglue/constants.swg (amglue_add_enum_and_string_tag_fns,
	  amglue_add_constant_and_string): New macro
	* perl/Amanda/Config.swg: Add functions to return enum value from a
	  string
	* installcheck/Amanda_Config.pl: Add tests

2015-09-09  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (tape_action): Improvement

2015-09-09  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Fix hang on failure

2015-09-03  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndma_comm_dispatch.c: Send all LOG_MESSAGE
	* ndmp-src/ndmjob_main_util.c: Quote LOG_MESSAGE
	* perl/Amanda/Report/human.pm: Fix output

2015-09-01  Jean-Louis Martineau <martineau@zmanda.com>
	* rest-server/bin/app-dancer2.pl.in: Correctly load multiple
	  applications.
	* server-src/amanda-rest-server.pl: Always load the same Dancer2
	  script.

2015-08-31  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/FetchDump.pm: Fix perl warning
	* server-src/amcheck-device.pl: Fix
	* installcheck/Amanda_Rest_Amcheck.pl: Fix

2015-08-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (tape_action): More improvement.

2015-08-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Improve message.

2015-08-24  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amzfs-sendrecv.pl: Fix compratio parsing.

2015-08-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Add the check_host_setting count in the
	  remote_errros when doing only the client check

2015-08-19  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/dumpers.m4: Default GNUTAR to /usr/bin/tar, STAR to
	  /usr/bin/star, BSDTAR to /usr/bin/bsdtar, SUNTAR to /usr/sbin/tar,
	  SAMBA_CLIENT to /usr/bin/smbclient.
	* config/amanda/progs.m4: Default SSH to /usr/bin/ssh
	* config/amanda/ssh-security.m4: Use AMANDA_PROG_SSH

2015-08-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (tape_action): Fix to not send
	  TAPE_ACTION_START_A_FLUSH if we can't guarantee a tape
	* server-src/driverio.h (struct taper_s): Add sent_first_write

2015-08-17  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.c (device_allow_take_scribe_from): New function
	  to return the allow_take_scribe_from setting
	* device-src/device.h (struct Device): Add a gboolean
	  allow_take_scribe_from
	* device-src/device.h (device_allow_take_scribe_from): Add new
	  prototype
	* device-src/ndmp-device.c: allow_take_scribe_from is FALSE
	* perl/Amanda/Device.swg (device_allow_take_scribe_from): swig it
	* perl/Amanda/Taper/Protocol.pm (TAPER_OK): add allow_take_scribe_from
	* perl/Amanda/Taper/Scribe.pm: Pass the allow_take_scribe_from value
	  to the callback
	* perl/Amanda/Taper/Worker.pm (_scribe_started_cb): Include the
	  allow_take_scribe_from in the TAPER_OK reply
	* server-src/driver.c (handle_taper_result): Parse the
	  *-TAKE-SCRIBE-FROM in the TAPER_OK reply
	* server-src/driver.c (tape_action): Do not return TAPE_ACTION_MOVE if
	  the taper do not handle allow_take_scribe_from
	* server-src/driverio.h (struct wtaper_s): Add a gboolean
	  allow_take_scribe_from
	* installcheck/taper.pl: Fix for *-TAKE-SCRIBE-FROM in TAPER-OK reply

2015-08-17  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amutil.c (interruptible_accept): Take a timeout as
	  argument
	* common-src/amutil.h (interruptible_accept): New prototype
	* common-src/stream.c (stream_client): Call interruptible_accept with
	  the timeout argument
	* xfer-src/element-glue.c (do_directtcp_accept): Call
	  interruptible_accept with the timeout argument

2015-08-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Configs.pm: Allow 'expand_*' in query parameter
	* perl/Amanda/Rest/Dles.pm: Allow 'expand_*' in query parameter
	* installcheck/Amanda_Rest_Configs.pl: Fix installcheck

2015-08-11  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Use 'eq' instead of '==' for filename

2015-08-11  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amcryptsimple.pl, common-src/amgpgcrypt.pl: Add sleep to
	  allow gpg-agent to exit
	* server-src/amrestore.pl: Add a --continue-on-filter-error option
	* man/xml-source/amrestore.8.xml: Document --continue-on-filter-error

2015-08-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Configs.pm (_fields): Must not load the config.

2015-08-10  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amrestore.8.xml: Document that -r do not decrypt dump

2015-08-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/human.pm: Fix compression computation.

2015-08-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/human.pm: Fix compression computation.

2015-08-07  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Configs.pl: Take MAILER form config

2015-08-07  Jean-Louis Martineau <martineau@zmanda.com>
	* rest-server/bin/app.pl.in: Undo bad change.

2015-08-07  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Configs.pm: Typo.
	* installcheck/Amanda_Rest_Configs.pl: Fix check.

2015-08-07  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c, common-src/amanda.h, common-src/match.c,
	  common-src/security-util.c, server-src/driver.c,
	  server-src/dumper.c: Coverity cleanup.

2015-08-07  Jean-Louis Martineau <martineau@zmanda.com>
	* rest-server/bin/app.pl.in, rest-server/lib/Amanda/Rest.pm.in:
	  Remove 'use Amanda::Rest::Changers;'

2015-08-07  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am (AmandaRest_DATA): Remove Amanda/Rest/Changers.pm

2015-08-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (*_key_to_name, *getconf_human,
	  custom_escape): New function
	* common-src/conffile.h (*_key_to_name, *getconf_human,
	  custom_escape): Add prototypes
	* perl/Amanda/Config.swg: Add amglue_add_enum_list(*_key)
	* perl/Amanda/Config.swg (val_t_to_print): Function to convert a
	  val_t to a printable format for human
	* perl/Amanda/Config.swg (*_key_to_name): Add declarations
	* perl/Amanda/Config.swg (*_getconf_human): Similar to *_getconf but
	  use val_t_to_print to return a human printable structure
	* perl/Amanda/Config.swg: Add messages 1500022 to 1500058
	* perl/Amanda/Disklist.swg: Add message 1400010
	* perl/Amanda/Rest/Configs.pm: Add API to return the list of section
	  and all fields of a named section
	* perl/Amanda/Rest/Dles.pm: Add API to return the list and setting
	  of Dles
	* perl/Amanda/Rest/Changers.pm: Remove file (API moved to Configs.pm).
	* perl/Amanda/Rest/Storages.pm: Remove some API (moved to Configs.pm).
	* perl/amglue/constants.swg (amglue_add_enum_list): New macro to
	  return an array of values
	* rest-server/bin/app.pl.in: Add new API
	* rest-server/lib/Amanda/Rest.pm.in: Add new API
	* server-src/diskfile.c: Use custom_escape to create custom name.
	* installcheck/Amanda_Rest_Changers.pl: Remove file
	* installcheck/Amanda_Rest_Configs.pl: Add many checks
	* installcheck/Amanda_Rest_Storages.pl: Remove some checks
	* installcheck/Makefile.am: Remove Amanda_Rest_Changers.pl

2015-08-06  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c, device-src/s3-device.h: Change default value
	  for S3-MULTI-DELETE
	* man/xml-source/amanda-devices.7.xml: Document it

2015-08-03  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Amdump.pm: Improve debugging.

2015-08-03  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ammessage.c: Add message 2800233 and 2800234
	* server-src/amcheck.c: Validate tag
	* server-src/driver.c: Validate tag

2015-07-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c (process_dumpline): Use full_write instead of
	  write and check the result.

2015-07-15  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Add krb5 to exit_on_qlength
	* application-src/amgtar.c: Improve debugging
	* perl/Amanda/FetchDump.pm: Uncompress the state file
	* server-src/amidxtaped.pl: Uncompress the state file
	* server-src/dumper.c: Compress the state file
	* xfer-src/dest-application.c: Improve XMSG
	* xfer-src/filter-process.c: Improve XMSG

2015-07-14  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (dump_match_selection): A dle without tag must
	  go on all storages

2015-07-14  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: chown of archive dir when restoring an
	  incr.

2015-07-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Start backup event if tape is not ready in
	  CNF_RESERVE == 0;

2015-07-13  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Add FULL-WAL property.
	* man/xml-source/ampgsql.8.xml: Document FULL-WAL property.

2015-07-13  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Add 'File shrank by \d* bytes; padding
	  with zeros' as normal message from tar.

2015-07-07  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/rait-device.c, device-src/tape-device.c,
	  device-src/vfs-device.c: Typo.

2015-06-23  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Util.swg: disable setenv_init.

2015-06-23  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/xfer-source-device.c (pull_buffer_impl): Call
	  device_read_block with a goot max_block value
	* perl/Amanda/Device.swg (verify_random_from_device): Call
	  device_read_block with a max_block of -1

2015-06-23  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Use g_ascii_strtoull.

2015-06-22  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Xfer.swg: break potential reference loop

2015-06-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amidxtaped.pl: Temporary fix for protocol bug.

2015-06-19  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Fix if not an application

2015-06-19  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndma_data.c: Undo patch.
	* recover-src/extract_list.c: Fix compilation

2015-06-18  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Fix compilation

2015-06-18  Jean-Louis Martineau <martineau@zmanda.com>
	* xfer-src/source-file.c: Fix compilation

2015-06-18  Jean-Louis Martineau <martineau@zmanda.com>
	* xfer-src/dest-application.c, xfer-src/source-file.c: Add files

2015-06-18  Jean-Louis Martineau <martineau@zmanda.com>
	* Implement DAR (Direct Access Recovery)

2015-06-16  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm (verify_unlocked): Reload the state and
	  use eject_unload

2015-06-15  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Take another tar of ./pg_tblspc by
	  keeping the symlink.

2015-06-10  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/ndmp-device.c: On recovery, set initial window to (0, -1)
	* installcheck/Installcheck/Mock.pm: Set verbose to YES

2015-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/ndmp-device.c: Set initial window correctly on recovery

2015-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amssl.pl: SSL_VERIFY_NONE is not defined on older
	  IO::Socket::SSL

2015-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.h (struct tcp_conn): Remove meth.
	* common-src/ssl-security.c: Do not use temporary variable for the
	  method.

2015-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: s/check_auth/check_host_setting/g, check
	  maxdumps is the same for all DLEs of a host
	* common-src/ammessage.c: Add message 2800232

2015-06-08  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/krb5-security.c (krb5_tcpm_recv_token): Remove the fd
	  argument.

2015-06-08  Jean-Louis Martineau <martineau@zmanda.com>
	* man/Makefile.am: Typo.

2015-06-08  Jean-Louis Martineau <martineau@zmanda.com>
	Add ssl auth.
	* config/amanda/amanda_configure.m4: Load AMANDA_SSL_SECURITY
	* config/amanda/ssl-security.m4 (AMANDA_SSL_SECURITY): Add
	  --with-ssl-security
	* amandad-src/amandad.c: Add code to support ssl auth,
	* common-src/Makefile.am (libamanda_la_SOURCES): Add ssl-security.c
	* common-src/Makefile.am (sbin_SCRIPTS_PERL): Add amssl
	* common-src/amgetconf.pl: Remove useless space
	* common-src/amssl.pl: New amssl program
	* common-src/conffile.c: Add CONF_SSL_FINGERPRINT_FILE,
	  CONF_SSL_CERT_FILE, CONF_SSL_KEY_FILE, CONF_SSL_CA_CERT_FILE,
	  CONF_SSL_CIPHER_LIST, CONF_SSL_CHECK_HOST,
	  CONF_SSL_CHECK_CERTIFICATE_HOST, CONF_SSL_CHECK_FINGERPRINT and
	  CONF_SSL_DIR
	* common-src/conffile.h: Add CNF_SSL_FINGERPRINT_FILE,
	  CNF_SSL_CERT_FILE, CNF_SSL_KEY_FILE, CNF_SSL_CA_CERT_FILE,
	  CNF_SSL_CIPHER_LIST, CNF_SSL_CHECK_HOST,
	  CNF_SSL_CHECK_CERTIFICATE_HOST, CNF_SSL_DIR and
	  DUMPTYPE_SSL_FINGERPRINT_FILE, DUMPTYPE_SSL_CERT_FILE,
	  DUMPTYPE_SSL_KEY_FILE, DUMPTYPE_SSL_CA_CERT_FILE,
	  DUMPTYPE_SSL_CIPHER_LIST, DUMPTYPE_SSL_CHECK_HOST,
	  DUMPTYPE_SSL_CHECK_CERTIFICATE_HOST, DUMPTYPE_SSL_CHECK_FINGERPRINT
	* common-src/glib-util.c: Load openssl.
	* common-src/security-util.c (generic_data_write, generic_data_read):
	  New functions.
	* common-src/security-util.h (generic_data_write, generic_data_read):
	  Add prototypes.
	* common-src/security.c: Load ssl_security_driver.
	* common-src/security.h (struct security_driver): Add data_write and
	data_read method.
	* common-src/bsd-security.c, common-src/bsdtcp-security.c,
	  common-src/bsdudp-security.c, common-src/krb5-security.c,
	  common-src/local-security.c, common-src/rsh-security.c,
	  common-src/ssh-security.c: Add generic_data_write and
	  generic_data_read
	* common-src/ssl-security.c: New ssl auth code
	* man/Makefile.am (COMMON_MAN_PAGES): Add amanda-auth-ssl.7 and
	  amssl.8
	* man/xml-source/amanda-auth-ssl.7.xml: New man page
	* man/xml-source/amanda-auth.7.xml: Link to amanda-auth-ssl
	* man/xml-source/amanda.8.xml: Link to amanda-auth-ssl
	* man/xml-source/amssl.8.xml: New man page
	* perl/Amanda/Config.swg: Add CNF_SSL_FINGERPRINT_FILE,
	  CNF_SSL_CERT_FILE, CNF_SSL_KEY_FILE, CNF_SSL_CA_CERT_FILE,
	  CNF_SSL_CIPHER_LIST, CNF_SSL_CHECK_HOST,
	  CNF_SSL_CHECK_CERTIFICATE_HOST, CNF_SSL_DIR
	* server-src/diskfile.h (struct disk_s): Add ssl setting
	* server-src/diskfile.c: Load ssl setting
	* server-src/driverio.c: Pass ssl setting.
	* server-src/dumper.c: Use ssl specific setting.
	* server-src/server_util.c (amhost_get_security_conf): Add
	  ssl setting.

2015-06-08  Jean-Louis Martineau <martineau@zmanda.com>
	* example/amanda.conf.in: Fix typo.
	* common-src/amgetconf.pl, man/xml-source/amanda-auth.7.xml,
	  man/xml-source/amgetconf.8.xml, perl/Amanda/Constants.pm.in.src:
	  Remove krb4 setting.
	* perl/Amanda/Amdump.pm, perl/Amanda/Amflush.pm,
	  perl/Amanda/CheckDump.pm, perl/Amanda/Chunker/Controller.pm,
	  perl/Amanda/Chunker/Protocol.pm, perl/Amanda/FetchDump.pm,
	  perl/Amanda/Label.pm, perl/Amanda/Message.pm,
	  perl/Amanda/Taper/Controller.pm: Remove useles @PERL@ and
	  @amperldir@;

2015-06-06  Jean-Louis Martineau <martineau@zmanda.com>
	* rest-server/bin/app-dancer2.pl.in,
	  rest-server/bin/app.pl.in: Use @PERL@

2015-06-02  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Vault.pm: Time::HiRes is not available everywhere.

2015-06-02  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/human.pm: Set total_time to the time of amvault
	  on an amvault run.
	* perl/Amanda/Report.pm: Parse amvault FINISH line.
	* perl/Amanda/Vault.pm: Log a FINISH line.

2015-06-02  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ammessage.c: Improve hint on message 2800231.

2015-06-01  Jean-Louis Martineau <martineau@zmanda.com>
	* oldrecover-src/extract_list.c: More fix if SAMBA_CLIENT is not
	  defined.

2015-06-01  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: More fix if SAMBA_CLIENT is not defined.

2015-06-01  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Tests.swg: #include "glib-util.h"
	* client-src/selfcheck.c, common-src/ammessage.c,
	  recover-src/extract_list.c, server-src/driver.c: Fix bug found by
	  coverity.

2015-06-01  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndmpconnobj.c: #include "glib-util.h",
	* ndmp-src/ndmpconnobj.c (ndmp_connection_mover_connect):  return a
	  gboolean.
	* perl/Amanda/Tests.swg: #include "glib-init.h"
	* perl/Amanda/Util.swg: #include "match.h"
	* perl/Amanda/Util.swg:  rename crc32 to crc32_add.

2015-06-01  Jean-Louis Martineau <martineau@zmanda.com>
	* config/compile, config/config.guess, config/config.sub,
	  config/depcomp, config/install-sh, config/missing,
	  config/test-driver, config/ylwrap: Newer version of files.

2015-05-29  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Check auth on both local and client check.

2015-05-28  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ammessage.c: Improve message 2800231.
	* server-src/amcheck.c: message 2800231 is an MSG_ERROR.

2015-05-27  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/ndmp-device.c: Fix previous patch.

2015-05-27  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/ndmp-device.c: Call ndmp_connection_mover_read with the
	  header size as the offset.

2015-05-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Check all dles of a host have the same auth.
	* common-src/ammessage.c: Add message 2800231.

2015-05-22  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Worker.pm: Fix $failure_from.

2015-05-21  Jean-Louis Martineau <martineau@zmanda.com>
	* rest-server/bin/app.pl.in: confdir is in amlibexecdir.

2015-05-21  Jean-Louis Martineau <martineau@zmanda.com>
	* rest-server/Makefile.am: Install the rest-server in amlibexecdir.
	* server-src/amanda-rest-server.pl, installcheck/Installcheck/Rest.pm:
	  rest-server installed in amlibexecdir.

2015-05-20  Jean-Louis Martineau <martineau@zmanda.com>
	* rest-server/Makefile.am (EXTRA_DIST): Add the *.in files

2015-05-20  Jean-Louis Martineau <martineau@zmanda.com>
	* rest-server/Makefile.am: typo.

2015-05-20  Jean-Louis Martineau <martineau@zmanda.com>
	* rest-server/Makefile.am (EXTRA_DIST): Add rest server.

2015-05-20  Jean-Louis Martineau <martineau@zmanda.com>
	* rest-server/Makefile.am: Missing \

2015-05-20  Jean-Louis Martineau <martineau@zmanda.com>
	* rest-server/Makefile.in, rest-server/Makefile,
	  rest-server/lib/Amanda/Rest.pm, rest-server/bin/app-dancer2.pl,
	  rest-server/bin/app.pl: Remove files.

2015-05-20  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: Fix.

2015-05-20  Jean-Louis Martineau <martineau@zmanda.com>
	* rest-server/*: Moved the rest-server
	* Makefile.am (SUBDIRS): Add rest-server
	* configure.in (AC_CONFIG_FILES): add rest-server/Makefile
	* server-src/amanda-rest-server.pl: Add --dancer and --dancer2 option.

2015-05-19  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Script_App.pm (print_to_server_and_die): Always FAILURE

2015-05-15  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.h: Add CNF_REST_SSL_CERT and CNF_REST_SSL_KEY
	* common-src/conffile.c: Parse rest-ssl-cert and rest-ssl-key
	* perl/Amanda/Config.swg: Add CNF_REST_SSL_CERT and CNF_REST_SSL_KEY
	* server-src/amanda-rest-server.pl: Start the REST server with
	  '--enable-ssl --ssl-cert $ssl_cert --ssl-key $ssl_key' if
	  CNF_REST_SSL_CERT and CNF_REST_SSL_KEY are set.
	* man/xml-so: Document the rest-api-port, rest-ssl-cert and
	  rest-ssl-key setting form /etc/amanda/amanda.conf

2015-05-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/FetchDump.pm: Do not pass a changer
	* perl/Amanda/Recovery/Planner.pm (make_plan): Accept storage instead
	  of changer
	* perl/Amanda/Vault.pm: Use src_storage_name and dest_storage_name
	* server-src/amvault.pl: Add --src-storage and --dest-storage
	  arguments
	* man/xml-source/amvault.8.xml: Document --src-storage and
	  --dest-storage
	* installcheck/Amanda_Recovery_Planner.pl: Fix for new api

2015-05-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Parse 'requeue write' line, set storage
	  will_retry.
	* server-src/driver.c: Write 'requeue write' line.
	* server-src/driver.c: Fix vaulting.
	* server-src/driverio.c (startup_dump_tape_process,
	  startup_vault_tape_process): New function to replace
	   startup_tape_process.
	* server-src/driverio.h (startup_dump_tape_process,
	  startup_vault_tape_process): Add prototype.
	* installcheck/Amanda_Rest_Runs.pl: Add 'will_retry' in status result.
	* installcheck/Installcheck/Dumpcache.pm: Force level when doing
	  backup.

2015-05-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amgetconf.pl: Do not load the disklist if a config is not
	  set.
	* common-src/conffile.c: load the cwd amanda.conf only if it exist.

2015-05-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Amanda/config.yml: Remove Dancer2 setting.

2015-05-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: Typo

2015-05-11  Jean-Louis Martineau <martineau@zmanda.com>
	* config/automake/scripts.am: Fix checking SCRIPTS_PERL_NO_CHECK.
	* perl/Makefile.am (SCRIPTS_PERL_NO_CHECK): Add Amanda/Rest.pm

2015-05-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest.pm: Remove
	* perl/Amanda/Rest.pm.in: Server for Dancer2
	* perl/Amanda/Rest/Amanda/bin/app-dancer2.pl.in: Start script for
	  using Dancer2
	* perl/Amanda/Rest/Amanda/config.yml: Add config for Dancer2
	* perl/Makefile.am: Install new files
	* server-src/amanda-rest-server.pl: Use Dancer2 if available
	* installcheck/Installcheck/Rest.pm: Use Dancer2 if available

2015-05-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Message.pm (TO_JSON): New method.
	* perl/Amanda/Rest/Amanda/bin/app.pl.in: Expect a status in function
	  result.
	* perl/Amanda/Rest/Amcheck.pm, perl/Amanda/Rest/Changers.pm,
	  perl/Amanda/Rest/Configs.pm, perl/Amanda/Rest/Dles.pm,
	  perl/Amanda/Rest/Dumps.pm, perl/Amanda/Rest/Labels.pm,
	  perl/Amanda/Rest/Report.pm, perl/Amanda/Rest/Runs.pm,
	  perl/Amanda/Rest/Services.pm, perl/Amanda/Rest/Status.pm,
	  perl/Amanda/Rest/Storages.pm, perl/Amanda/Rest/Storages/Labels.pm,
	  perl/Amanda/Rest/Version.pm: Function return status and array of
	  Message.

2015-05-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Amanda/bin/app.pl.in: Parse request body for POST
	  and DELETE request.

2015-05-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Improve worker output.

2015-05-07  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: check ARCHIVEDIR is not inside DATADIR.

2015-05-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amanda-rest-server.pl: Add a --development option
	* man/xml-source/amanda-rest-server.8.xml: Document --development

2015-05-07  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: More fix.

2015-05-06  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Runs.pl: Add retry, retry_level and
	  will_retry.

2015-05-06  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: VAULT-WRITE must reset the retry flag.

2015-05-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Add a 'requeue' line to the amdump log file.
	* perl/Amanda/Status.pm: Better handling of retry.

2015-05-06  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c, client-src/rundump.c,
	  client-src/runtar.c, client-src/selfcheck.c,
	  client-src/sendbackup.c, client-src/senddiscover.c,
	  xfer-src/filter-process.c: Always free the result of safe_env.

2015-05-06  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/amandates.c, client-src/sendsize.c,
	  common-src/ammessage.c: Fix bug found by coverity.
	* device-src/ndmp-device.c (ndmp_device_eject): Call open_connection.

2015-05-05  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Cleanup.

2015-04-30  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Cleanup.pm: Log the notes
	* perl/Amanda/Report.pm: Parse amcleanup log line
	* perl/Amanda/Report/human.pm (PROGRAM_ORDER): Add amcleanup
	* perl/Amanda/Rest/Runs.pmi (kill): Accept notes argument
	* server-src/amcleanup.pl: Add --note argument
	* server-src/logfile.h (logtype_e): Add P_AMCLEANUP
	* server-src/logfile.c (logtype_str): Add "amcleanup"
	* perl/Amanda/Logfile.swg: Add P_AMCLEANUP
	* man/xml-source/amcleanup.8.xml: Document --note argument

2015-04-29  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Fix progress_func and set timeout to 0.

2015-04-29  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS: ADD NEARLINE storage.
	* man/xml-source/amanda-devices.7.xml: Document NEARLINE storage.

2015-04-29  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c (progress_function): Fail on timeout.
	* device-src/s3-device.h (_S3_by_thread): Add tiemout.
	* device-src/s3.c (RESULT_HANDLING_ALWAYS_RETRY): Add
	  CURLE_ABORTED_BY_CALLBACK.

2015-04-28  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Fix wrong variable.

2015-04-28  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl (backup): Create an archive directory
	  with the same permission as the data directory.

2015-04-27  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Fix status.

2015-04-27  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: Add new messages.
	* perl/Amanda/Changer/multi.pm (update): Allow 'error' for the slot
	  range.
	* perl/Amanda/Changer/robot.pm (update): Allow 'error' for the slot
	  range.
	* installcheck/Amanda_Changer_robot.pl: Fix.
	* server-src/amtape.pl: Fix for new messages.
	* man/xml-source/amanda-changers.7.xml: Add error keyword.

2015-04-27  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm (set_error_to_unknown): New function
	  that allow the tapescan to reset all slots with given error.

2015-04-27  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Vault.pm: Create timer once.

2015-04-27  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Abort a restore if application fail.

2015-04-23  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Improve parsing if a line is misquoted.

2015-04-22  Xu Han <xhan@zmanda.com>
	* server-src/amanda-rest-server.pl: exit code 1 when start fails

2015-04-22  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amflock.c: Cleanup
	* server-src/cmdfile.c: Retry lock on 1.

2015-04-22  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Installcheck/Config.pm: Set inparallel to 2.
	* installcheck/Amanda_Rest_Configs.pl: Fix for inparallel value.

2015-04-21  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Retry on 429 or 503 error.

2015-04-21  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report.pm: Set $dumper->{status} to 'retry' on L_RETRY

2015-04-21  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Installcheck/Dumpcache.pm: Use --no-taper

2015-04-20  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Runs.pm: use File::Glob qw( :glob );

2015-04-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Do not send CLOSE_VOLUME request if the worker
	  have no volume.

2015-04-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driverio.c, server-src/planner.c: Fix bug found by
	  coverity.

2015-04-03  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Dumps.pl: Do not hardcoded path
	* installcheck/amoverview.pl: Increase --diskwidth to 200

2015-04-03  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Fix compilation

2015-04-03  Jean-Louis Martineau <martineau@zmanda.com>
	driver can do vault.
	* common-src/conffile.c: s/CONF_AMVAULT_STORAGE/CONF_VAULT_STORAGE/,
	  add CONF_VAULT
	* common-src/conffile.h: Add vault_list_t and CONFTYPE_VAULT_LIST
	* device-src/xfer-dest-taper-cacher.c: Improve debugging statement
	* device-src/xfer-dest-taper-directtcp.c: Improve debugging statement
	* device-src/xfer-dest-taper-splitter.c: Improve debugging statement
	* device-src/xfer-source-recovery.c: Improve debugging statement
	* server-src/xfer-dest-holding.c: Improve debugging statement
	* man/xml-source/amanda.conf.5.xml: Document storage and vault-storage
	* perl/Amanda/Amflush.pm: s/storage_dest/dst_storage/
	* perl/Amanda/Changer/disk.pm: Check $self->{'dir'} is defined
	* perl/Amanda/Changer/robot.pm: Check $info->{'state'} is defined
	* perl/Amanda/Cmdfile.swg: Change some field names.
	* perl/Amanda/Config.swg: Add CONFTYPE_VAULT_LIST.
	* perl/Amanda/DB/Catalog.pm (_load_tapelist): Always load.
	* perl/Amanda/Recovery/Clerk.pm (close_volume): New method
	* perl/Amanda/Recovery/Scan.pmA: Fix message
	* perl/Amanda/Report.pm: Fix for vault.
	* perl/Amanda/Report/human.pm: Fix for vault.
	* perl/Amanda/Status.pm: Fix for vault.
	* perl/Amanda/Taper/Controller.pm: Add msg_VAULT_WRITE and
	  msg_CLOSE_SOURCE_VOLUME
	* perl/Amanda/Taper/Protocol.pm: Add VAULT_WRITE, CLOSED_VOLUME,
	  OPENED_SOURCE_VOLUME, CLOSE_SOURCE_VOLUME, CLOSED_SOURCE_VOLUME
	* perl/Amanda/Taper/Scan.pm: Remove unused code
	* perl/Amanda/Taper/Scribe.pm (close_volume): Fix
	* perl/Amanda/Taper/Scribe.pm (close_source_volume): New method.
	* perl/Amanda/Taper/Worker.pm: Add VAULT_WRITE, CLOSE_SOURCE_VOLUME,
	  recovery_clerk_notif_open_volume, recovery_clerk_notif_close_volume.
	* perl/Amanda/Taper/Worker.pm: Add vault operation.
	* perl/Amanda/Vault.pm: Fix for multiple vault_storage.
	* server-src/amcheck-device.pl: Fix.
	* server-src/amcheck.c: s/up/status/
	* server-src/amvault.pl: Fix message.
	* server-src/cmdfile.c: Change a few names
	* server-src/cmdfile.h: Change a few names, many fixes
	* server-src/diskfile.c: Set status.
	* server-src/diskfile.h: Remove up, add status.
	* server-src/driver.c: Data struct change, handle vault command.
	* server-src/driverio.c: Add new taper commands.
	* server-src/driverio.h: Change many struct.
	* server-src/planner.c: Change many struct.
	* server-src/server_util.c: Add "VAULT-WRITE", "CLOSED-VOLUME",
	  "OPENED-SOURCE-VOLUME", "CLOSE-SOURCE-VOLUME" and
	  "CLOSED-SOURCE-VOLUME"
	* server-src/server_util.h: Add VAULT_WRITE, CLOSED_VOLUME,
	  OPENED_SOURCE_VOLUME, CLOSE_SOURCE_VOLUME, CLOSED_SOURCE_VOLUME.
	* server-src/tapefile.c: Fix retention.
	* installcheck/Amanda_Rest_Amcheck.pl: Fix
	* installcheck/Amanda_Rest_Dumps.pl: Fix sort.
	* installcheck/Installcheck/Dumpcache.pm: Force a FULL.
	* installcheck/amoverview.pl: Fix.
	* installcheck/amvault.pl: Fix.
	* installcheck/pp-scripts.pl: Fix.

2015-03-26  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Runs.pl: Check the {head}->{exit_status}

2015-03-26  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Send QUIT to chunker after receiving
	  ABORT-FINISHED.

2015-03-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report.pm (get_exit_status): New method
	* perl/Amanda/Report/json.pm: Add {head}->{exit_status}

2015-03-25  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/tape.m4: Add include for bsd.
	* device-src/device.c: Improve message

2015-03-24  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/json.pm: Add a timestamp in the head section.
	* installcheck/Amanda_Rest_Runs.pl: Add timestamp.

2015-03-24  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Report all size as bytes.
	* installcheck/Amanda_Rest_Runs.pl,
	* server-src/amstatus.pl,
	  installcheck/Amanda_Rest_Runs.pl: Fix for bytes size.

2015-03-24  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Runs.pl, perl/Amanda/Status.pm,
	  server-src/amstatus.pl, server-src/driver.c:
	  s/free_kps/network_free_kps/
	  s/free_space/holding_free_space/

2015-03-23  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Makefile.am: Do not run the gnutar installcheck

2015-03-20  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Improve documentation.

2015-03-19  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Fix double g_mutex_unlock.

2015-03-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindexd.c: Fix LISTHOST command.

2015-03-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/tapefile.c (compute_storage_retention): Fix retentionfor
	  retention_days.
	* installcheck/Amanda_Tapelist.pl: Add many installcheck for
	  list_retention, list_no_retention, list_new_tapes and
	  volume_is_reusable

2015-03-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: One line by worker.

2015-03-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/tapefile.c (list_retention, list_no_retention): Do not
	  list datestamp==0 or not in a listed storage.

2015-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c, perl/Amanda/Policy.pm,
	  perl/Amanda/Taper/Scan.pm,
	  server-src/tapefile.c: retention_tapes default to tapecycle-1.
	* man/xml-source/amanda.conf.5.xml: Document it.
	* installcheck/Amanda_Taper_Scan.pl,
	  installcheck/Amanda_Taper_Scan_lexical.pl,
	  installcheck/Amanda_Taper_Scan_oldest.pl,
	  installcheck/Amanda_Taper_Scan_traditional.pl: Fix.

2015-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/tapefile.c (list_retention, list_no_retention): Fix.

2015-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Config.pl: Fix: Remove append keyword.

2015-03-04  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Fix parsing dump-selection (remove append).
	* man/xml-source/amanda.conf.5.xml: Document change.

2015-02-26  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (config_print_errors_as_message): Fix message.

2015-02-18  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amadmin.8.xml: Document tape --days.
	* server-src/amadmin.c: Fix --days intape command.

2015-02-17  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsdtcp-security.c, common-src/krb5-security.c,
	* common-src/local-security.c, common-src/rsh-security.c,
	* common-src/ssh-security.c: Fix bug found by coverity.

2015-02-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c: Fix crash in tape command.

2015-02-15  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Xfer.swg: Fix for swig-3.0.5

2015-02-13  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/common/post_inst_functions.sh: Use 'command -v' instead of
	  which.

2015-02-13  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/common/post_inst_functions.sh: fix for gpg2 and gpg-agent

2015-02-12  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/common/common_functions.sh: Use systemctl to restart
	  xinetd.

2015-02-12  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Fix previous patch.

2015-02-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Fix race.

2015-02-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Amdump.pm: Remove amdump file older than 30 days if
	  there is no corresponding log file.
	* server-src/amtrmlog.c: Remove amdump file when removing log file.

2015-02-10  Jean-Louis Martineau <martineau@zmanda.com>
	* Makefile.am: Fix for Solaris find.

2015-02-04  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ssh-security.c (ssh_connect): Use the name from the
	  disklist, no need to find the canonical name.

2015-02-03  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-util.c: Fix memory allocation issue.

2015-02-03  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amstar.c: Support include in backup mode.

2015-01-30  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Fix state file update.

2015-01-29  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Parse new AWS4 STORAGE-API.
	* device-src/s3-util.c (s3_compute_sha256_hash_ba,
	  s3_compute_sha256_hash, EncodeHMACSHA256, s3_tohex): New function.
	* device-src/s3-util.h (s3_compute_sha256_hash_ba,
	  s3_compute_sha256_hash, EncodeHMACSHA256, s3_tohex): New prototypes.
	* device-src/s3.c: Compute signature for AWS4.
	* device-src/s3.h (S3_api): Add S3_API_UNKNOWN and S3_API_AWS4.
	* man/xml-source/amanda-devices.7.xml (STORAGE_API): Document AWS4.
	* server-src/amtape.pl: Fix perl warning.

2015-01-29  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Fix retry handling.

2015-01-28  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c: (print_platform): Do not execute
	  /usr/bin/sw_vers if it doesn't exists.
	* common-src/amutil.c: Fix debugging statement.

2015-01-27  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Runs.pl, installcheck/amreport.pl,
	  perl/Amanda/Amdump.pm, perl/Amanda/Amflush.pm,
	  perl/Amanda/CheckDump.pm, perl/Amanda/DB/Catalog.pm,
	  perl/Amanda/FetchDump.pm, perl/Amanda/Logfile.swg,
	  perl/Amanda/Process.pm, perl/Amanda/Rest/Report.pm,
	  perl/Amanda/Rest/Runs.pm, perl/Amanda/Status.pm,
	  perl/Amanda/Vault.pm, server-src/amstatus.pl,
	  server-src/driver.c: CNF_LOGIDR can be relative.

2015-01-27  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c (print_platform): Detect BSD variant.

2015-01-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Remove useless line.

2015-01-26  Jean-Louis Martineau <martineau@zmanda.com>
	* config/compile, config/config.guess,
	  config/config.sub, config/missing,
	  config/test-driver: Upgrade to automake 1.14.1

2015-01-26  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Cmdline.swg, perl/Amanda/Device.swg,
	  perl/Amanda/MainLoop.swg, perl/Amanda/NDMP.swg,
	  perl/Amanda/Util.swg: Fix linking issue.

2015-01-16  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Fix perl warning.

2015-01-14  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/components.m4: Remove AMANDA_JSON_SERVER and
	  WANT_JSON_SERVER.
	* config/amanda/json.m4: Remove file
	* perl/Amanda/JSON/*: Remove directory.
	* perl/Amanda/JSON.pm: Remove module.
	* perl/Makefile.am: Remove Amanda/JSON.pm and Amanda/JSON/*
	* server-src/Makefile.am: Remove amanda.psgi
	* server-src/amanda.psgi.pl: Remove file.

2015-01-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Vault.pm: Remove bogus print statement.

2015-01-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amvault.pl: Add --src-labelstr argument.
	* perl/Amanda/DB/Catalog.pm: Match the labelstr.
	* perl/Amanda/Recovery/Planner.pm: Match the labelstr.
	* perl/Amanda/Util.swg (match_labelstr_expr): New method.
	* perl/Amanda/Vault.pm: Match the labelstr.
	* NEWS: Add new amvault --src-labelstr argument.

2015-01-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amfeatures.h: Add fe_sendbackup_rep_retry.
	* common-src/amfeatures.c: Add fe_sendbackup_rep_retry.
	* server-src/dumper.c: Accept a RETRY in the REP packet.

2015-01-06  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/ndmp.pm: Remove bogus confess.

2015-01-06  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/debug.c: Add the pid of the process on each line.
	* perl/Amanda/Changer/disk.pm: Print the pid of the process using the
	  drive.
	* perl/Amanda/Report/human.pm: Fix perl warning.

2015-01-05  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: bumpdays can be 0.

2015-01-03  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Fix bad status error.

2015-01-02  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Amanda/bin/app.pl.in: Die if loading an extensions
	  fail.

2014-12-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/cmdfile.c (cmdfile_holding_file): Check it is a CMD_FLUSH

2014-12-19  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/human.pm: Report all FAIL.
	* perl/Amanda/Report/postscript.pm: Fix perl warning.
	* installcheck/amreport.pl: Change message.

2014-12-18  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Fix RETRY line.

2014-12-18  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report.pm: Set dumper filed on RETRY.
	* perl/Amanda/Report/human.pm: Print RETRY line.

2014-12-18  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Fix perl warning.

2014-12-17  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Curinfo/Info.pm (read_infofile_perfs): Report correct
	  error if $skip_blanks fail.

2014-12-17  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Curinfo/Info.pm (read_infofile): Handle empty file.

2014-12-17  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/DB/Catalog.pm: set $dumps{$dumpkey} on partnum==1.

2014-12-16  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Vault.pm: Get interactivity.
	* server-src/amvault.pl: Add --no-interactivity
	* man/xml-source/amvault.8.xml: Document --no-interactivity argument.

2014-12-16  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Runs.pm (list): Do not fail on empty file.

2014-12-15  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Set $sle->{'status'} on taper eof.
	* server-src/driverio.h (taper_t): Add down field.
	* server-src/driverio.c (startup_tape_process): Set down to false.
	* server-src/driver.c (start_some_dumps): Do not use a taper if it is
	  down.
	* server-src/driver.c (handle_taper_result): Set it to down on BOGUS.

2014-12-15  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c (support): Output
	  "MESSAGE-SELFCHECK-JSON YES".
	* client-src/client_util.c (run_client_scripts): Output script output
	  in meesage form.
	* client-src/client_util.h (run_client_scripts): Change proptotype.
	* client-src/selfcheck.c: Add  fprint_message argument to
	  run_client_scripts.
	* common-src/amfeatures.c: Add fe_sendsize_message,
	  fe_sendbackup_message.
	* common-src/amfeatures.h: Add fe_sendsize_message,
	  fe_sendbackup_message.
	* common-src/ammessage.c: Add error code 4600000 and 4600001.
	* perl/Amanda/Message.pm: Add many code range.
	* client-src/sendbackup.c: Add NULL argument to run_client_scripts.
	* client-src/sendsize.c: Add NULL argument to run_client_scripts.
	* recover-src/extract_list.c: Add NULL argument to run_client_scripts.

2014-12-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Print 'data in sum CRC' to debug file.

2014-12-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ammessage.c: Fix memory allocation.

2014-12-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Vault.pm: Continue to next dump if src device fail.

2014-12-11  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ammessage.c: Fix.
	* perl/Amanda/Logfile.swg: Include "amindex.h"

2014-12-11  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Fix message memory leak.
	* client-src/client_util.c: Fix message memory leak.
	* common-src/ammessage.c: Fix memory leak, fix for older glib2.

2014-12-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Dles.pm: allow set and unset command at the same
	  time.

2014-12-10  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Change debuging level.

2014-12-10  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ammessage.c: Fix for older glib2.

2014-12-10  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/senddiscover.c: fix json formating.
	* common-src/ammessage.c: Parse hash and array in message.

2014-12-09  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Process.pm (which_process_running): New method to return
	  the list of pid of the running amanda processes.
	* perl/Amanda/Cleanup.pm (message 3400002): Include the list of pid
	  running.

2014-12-09  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Fix status.

2014-12-08  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/senddiscover.c: Parse application stdout
	* common-src/ammessage.c: handle null in json message.

2014-12-04  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Use tapelist label only if the slot is
	  in SLOT_UNKNOWN state.

2014-12-04  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: Keep an $self->{'oldsize'}.
	* perl/Amanda/Taper/Scribe.pm (get_bytes_written): Return
	  $self->{'oldsize'} if the xfer is done.
	* perl/Amanda/Taper/Worker.pm: Truncate the status file after writting
	  to it.

2014-12-02  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck-device.pl: s/writablility/writability/.

2014-11-28  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amflock.c: Set errno.
	* perl/Amanda/Changer.pm: Print error on lock error.

2014-11-27  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Check with getuid since we are not root
	  there.
	* common-src/krb5-security.c: Drop root privileges, fix typos.

2014-11-26  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: fix status.

2014-11-24  Jean-Louis Martineau <martineau@zmanda.com>
	* Makefile.am: 'cp -av' => 'cp -fpR'  ,-av are not valid on solaris.

2014-11-24  Jean-Louis Martineau <martineau@zmanda.com>
	* amar-src/amar.c (amar_attr_add_data_fd_thread): Close the file
	  descriptor when there is nothing more to read from.
	* client-src/sendbackup.c (check_result): Fix a race bug. sendbackup
	  do not always report the exit status of the application.
	  Once amvmware close its socket, an immediate call to waitpid(-1,)
	  might not trap it exited.
	  The patch check all pid we forked until they exit (max 5 seconds),
	   after that they are killed.

2014-11-21  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Amanda/bin/app.pl.in: Convert request from utf-8 to
	  user locale.

2014-11-21  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Message.pm: Convert reply from user locale  to  utf-8.

2014-11-19  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/flags.m4: subst AMANDA_FILE_CFLAGS do that in generate
	  the basename of the file.
	* amandad-src/Makefile.am, amar-src/Makefile.am,
	  application-src/Makefile.am, client-src/Makefile.am,
	  common-src/Makefile.am, device-src/Makefile.am,
	  ndmp-src/Makefile.am, oldrecover-src/Makefile.am,
	  perl/Makefile.am, recover-src/Makefile.am,
	  server-src/Makefile.am, xfer-src/Makefile.am (AM_CFLAGS):
	  Add $(AMANDA_FILE_CFLAGS)
	* application-src/amgtar.c, client-src/client_util.c,
	  client-src/selfcheck.c, client-src/senddiscover.c,
	  common-src/conffile.c, server-src/amcheck.c: Use AMANDA_FILE in
	  build_message

2014-11-19  Jean-Louis Martineau <martineau@zmanda.com>
	* config/test-driver: New file for automake-1.14
	* config/missing, config/ylwrap, config/install-sh,
	  config/mkinstalldirs, config/depcomp, config/compile,
	  config/config.guess, config/config.sub: Update to automake-1.14

2014-11-19  Jean-Louis Martineau <martineau@zmanda.com>
	* Makefile.am: Add '-I /usr/share/aclocal' to ACLOCAL_AMFLAGS

2014-11-18  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Message.pm: Fix code number attribution.

2014-11-18  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amservice.c: Set remote_errors on "ERROR" from the
	  client. To get an exit code with error.

2014-11-18  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Services.pm: Add a waitpid of the amservice
	  process.
	* perl/Amanda/Service.pm: Add messages code.

2014-11-14  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Process.pm: '<defunct>' process are dead, process can be
	  "starman".
	* perl/Amanda/Rest/Runs.pm: Call process_alive with the $pname.

2014-11-13  Jean-Louis Martineau <martineau@zmanda.com>
	* amar-src/amar.c (amar_attr_add_data_fd): write eoa on size==0.

2014-11-12  Jean-Louis Martineau <martineau@zmanda.com>
	* autogen: Add "-I /usr/share/aclocal" to includes

2014-11-12  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Amdump.pm (run): set $self->{'pid'}
	* perl/Amanda/Amflush.pm (run): set $self->{'pid'}
	* perl/Amanda/CheckDump.pm (run): set $self->{'pid'}
	* perl/Amanda/Rest/Runs.pm: Log "fork" line.
	* perl/Amanda/Vault.pm: Small fix.
	* server-src/amflush.pl: Log "fork" line.
	* server-src/amvault.pl: s/config_name/config/g

2014-11-12  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Fix perl warning.

2014-11-08  Jean-Louis Martineau <martineau@zmanda.com>
	* xfer-src/filter-process.c (get_err_fd): Remove prototype.
	* xfer-src/xfer-element.h (get_err_fd): Add prototype.
	* perl/Amanda/Cmdline.swg: #include "match.h"

2014-11-08  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Fix BROKEN-DRIVE-LOADED-SLOT.

2014-11-08  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Script_App.pm (print_to_server): Print enssage to debug
	  file.
	* server-src/amfetchdump.pl: Add severity to messages.

2014-11-07  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Fix BROKEN-DRIVE-LOADED-SLOT.
	* installcheck/Amanda_Changer_robot.pl: Fix test.

2014-11-07  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Add a BROKEN-DRIVE-LOADED-SLOT
	  property.
	* man/xml-source/amanda-changers.7.xml: Document it.

2014-11-06  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/amrmtape.pl: Fix diskpath.

2014-11-06  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Generate an error if fopen of config fail.

2014-11-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amtrmidx.c: Do not delete index file newer than 7 days.
	* installcheck/amrmtape.pl: Fix check.

2014-11-05  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Script_App.pm (do) : Set action with special command.

2014-11-04  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/logfile.c: Do no create the log symlink for a
	  checkdump or fetchdump run.

2014-11-04  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report.pm: Parse checkdump and fetchdump line. new
	  return an Amanda::Message on error.
	* perl/Amanda/Rest/Report.pm: Handle Amanda::Report->new returning an
	  Amanda::Message.
	* server-src/amreport.pl: Handle Amanda::Report->new returning an
	  Amanda::Message.
	* server-src/logfile.c: Parse checkdump and fetchdump line.

2014-11-03  Jean-Louis Martineau <martineau@zmanda.com>
	* amar-src/amar.c: Fix hang on eof.
	* common-src/ammessage (ammessage_encode_json): Improve encoding.
	* perl/Amanda/Cleanup.pm: Remove trailing '\n'.
	* perl/Amanda/Rest/Runs.pm: Fix Message module
	* perl/Amanda/Status.pm: Fix.
	* server-src/amstatus.pl: Set $pwd before changing the cwd.

2014-10-31  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Cleanup.pm: Add message 34000010.
	* perl/Amanda/Process.pm: Return Message if can't open the trace_log.
	* perl/Amanda/Rest/Runs.pm: Accept multiple trace_log.

2014-10-31  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Changers.pm, perl/Amanda/Rest/Configs.pm,
	  perl/Amanda/Rest/Storages.pm: Do not accept comma in fields.
	* perl/Amanda/Rest/Storages/Labels.pm: Do not accept comma in labels.
	* installcheck/Amanda_Rest_Changers.pl,
	  installcheck/Amanda_Rest_Configs.pl,
	  installcheck/Amanda_Rest_Storages.pl: Do not use comma.

2014-10-31  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm (new): Return error if it can't open the
	  amdump_log file.
	* perl/Amanda/Rest/Status.pm, server-src/amstatus.pl: Handle error.

2014-10-31  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Fix perl warnings.

2014-10-31  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Changers.pm, perl/Amanda/Rest/Configs.pm,
	  perl/Amanda/Rest/Storages.pm: Parse multiple fields.

2014-10-31  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Always set argument.host

2014-10-30  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ammessage.c: Improve JSON escaping code.

2014-10-29  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ambsdtar.c: Handle 'x ' lines on stderr for bsdtar
	  restore.

2014-10-28  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Message.pm: Add Amanda::Extensions::Message

2014-10-28  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/FetchDump.pm: log pid-done line.
	* perl/Amanda/Rest/Runs.pm: Handle fork from rest server.
	* server-src/logfile.c: log pid line with pname.

2014-10-28  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Curinfo/Info.pm: Fix perl warning.

2014-10-28  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Fix perl warning.

2014-10-27  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Curinfo.pm (get_dle_info): New method.
	* perl/Amanda/Rest/Amanda/bin/app.pl.in: Add
	  get '/amanda/v1.0/configs/:CONF/dles/hosts/:HOST'
	* perl/Amanda/Rest/Dles.pm (info): New method.

2014-10-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amanda-rest-server.pl: Typo.
	* perl/Amanda/Status.pm: Fix.

2014-10-21  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Set nb_tape to 0.
	* server-src/amanda-rest-server.pl: print "Stoped the Amanda Rest
	  Server".

2014-10-17  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/FetchDump.pm: $self->{'message_file'}->autoflush,
	  Return $params{'finished_cb'}->(1);
	* perl/Amanda/Rest/Runs.pm: Add '=' to dumpspec argument.

2014-10-17  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm, server-src/amstatus.pl: Fix perl warning.

2014-10-17  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Runs.pm, perl/Amanda/CheckDump.pm,
	  perl/Amanda/Device.swg, perl/Amanda/Cleanup.pm,
	  perl/Amanda/Changer/diskflat.pm, perl/Amanda/Changer.pm,
	  perl/Amanda/Vault.pm, perl/Amanda/Index.pm,
	  perl/Amanda/Disklist.swg: Add severity to messages.

2014-10-16  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Set write_size, and $dle->{'dsize'}.

2014-10-16  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcleanup.pl: Some fixes.

2014-10-16  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c: Fix compilation if SAMBA_CLIENT is not
	  defined.
	* common-src/ammessage.c: Add Message 3600087.

2014-10-15  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/CheckDump.pm: Set severity on Message.

2014-10-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Use g_strdup.

2014-10-15  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Output message for selfcheck
	* client-src/client_util.c (backup_support_option): Parse
	  "MESSAGE-JSON".
	* client-src/client_util.h (backup_support_option_s): Add message_json.
	* client-src/selfcheck.c: Parse message from application.
	* common-src/ammessage.c: Add amgtar message.
	* perl/Amanda/Extract.pm (BSU): parse message-json
	* perl/Amanda/Message.pm: Add amgtar message (3700000).
	* server-src/amcheck.c: Remove unused code, small cleanup.
	* installcheck/Installcheck/Application.pm (selfcheck_message):
	  execute application selfcheck with '--message json'.
	* installcheck/amgtar.pl: Call selfcheck_message.

2014-10-15  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ammessage.h: #ifndef AMMESSAGE_H

2014-10-15  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ammessage.c: Do not use g_ptr_array_new_full.
	* server-src/amcheck.c: g_ptr_array_free(message_array, TRUE);

2014-10-14  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c (rfc3339_date): Use full_write and fill_read.

2014-10-14  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amfeatures.c: Add fe_selfcheck_message.
	* common-src/amfeatures.h: Add fe_selfcheck_message.
	* client-src/client_util.c (check_access_message, check_file_message,
	  check_dir_message, check_suid_message): New function that return a
	  message_t.
	* client-src/client_util.h: Add prototype.
	* client-src/selfcheck.c: Return message to server.
	* common-src/ammessage.c: Many improvement.
	* common-src/ammessage.c (delete_message_gpointer,
	  get_quoted_message, message_get_code, message_get_severity,
	  message_get_argument, message_add_argument, parse_json_message):
	  New function.
	* common-src/ammessage.h: Add prototype.
	* common-src/amservice.c: Take a --features argument.
	* perl/Amanda/Message.pm: selfcheck message are 3600000
	* server-src/amcheck.c: Parse message from selfcheck.
	* installcheck/Amanda_Rest_Amcheck.pl: Fix message.
	* installcheck/amservice.pl: Test --features argument.

2014-10-11  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/device.m4: AC_SUBST(AMANDA_DEVICES)
	* perl/Amanda/Constants.pm.in.src: Add AMANDA_DEVICES.
	* installcheck/Amanda_Device.pl: Do not check dvdrw device if it is
	  not compiled in.

2014-10-10  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Installcheck/Rest.pm: Check if Dancer is installed.

2014-10-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Amcheck.pm, perl/Amanda/Rest/Report.pm,
	  perl/Amanda/Rest/Runs.pm, perl/Amanda/Rest/Services.pm,
	  perl/Amanda/Rest/Status.pm, perl/Amanda/Rest/Version.pm:
	* installcheck/Amanda_Rest_Amcheck.pl: Call set_pname.
	  installcheck/Amanda_Rest_Runs.pl: Fix process.

2014-10-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Config.swg: Fix message.

2014-10-10  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Tag 'File removed before we read it' as
	  GOOD.

2014-10-09  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ammessage.c: Fix some messages.
	* perl/Amanda/CheckDump.pm: Use errnostr. Decode use base64 xml encoding
	* perl/Amanda/FetchDump.pm: Use errnostr. Decode use base64 xml encoding
	* perl/Amanda/Label.pm: Use errnostr.
	* perl/Amanda/Message.pm: Set errnostr.
	* perl/Amanda/Rest/Runs.pm: Fix open.
	* server-src/amreindex.pl: Decode use base64 xml encoding.
	* installcheck/Amanda_Rest_Configs.pl: Add errnostr.

2014-10-06  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/FetchDump.pm: Set severity on many message.
	* perl/Amanda/Rest/Runs.pm: Fix setting message_filename.

2014-10-06  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/human.pm: Fix perl format.

2014-10-03  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Makefile.am: Amanda_Rest_Amcheck must be run only if
	  client and sewrver are installed.

2014-10-03  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsdtcp-security.c: Free res.
	* common-src/bsdudp-security.c: Free res.
	* server-src/tapefile.c: Remove unused allocation.

2014-10-03  Jean-Louis Martineau <martineau@zmanda.com>
	* amar-src/amar.c: Fix loop.
	* common-src/bsdtcp-security.c: Free res.
	* common-src/bsdudp-security.c: Free res.
	* recover-src/extract_list.c: Remove duplicate code.
	* server-src/amindexd.c: Remove unused allocation.
	* server-src/dumper.c: Remove always TRUE check.
	* server-src/tapefile.c: Remove unused allocation.

2014-10-03  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Cleanup.pm: Add it.

2014-10-03  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Cleanup.pm: new perl module for amcleanup
	  functionnality.
	* perl/Makefile.am: Add Amanda/Cleanup.pm.
	* server-src/amcleanup.pl: Use Amanda::Cleanup
	* perl/Amanda/Holding.pm (_walk): Do not list 'pid' file.
	* perl/Amanda/Message.pm: Add Amanda::Cleanup::Message and
	  Amanda::Process::Message.
	* perl/Amanda/Process.pm: Send Amanda::Message.
	* perl/Amanda/Rest/Amanda/bin/app.pl.in: Add
	  DELETE /amanda/v1.0/config/:CONF/runs
	* perl/Amanda/Rest/Runs.pm: Add kill functionnality.

2014-10-02  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Fix type casting.

2014-10-02  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Amcheck.pm: Fix unshift.
	* perl/Amanda/Rest/Configs.pm: Fix severity.

2014-10-02  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Fix small bug found by coverity.
	* common-src/ammessage.c: typo.
	* server-src/amcheck.c: typo, remove unused variable.

2014-10-02  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ammessage.c : Print severity as name.
	* perl/Amanda/Message.pm: severity constant are name.
	* installcheck/Amanda_Rest_Amcheck.pl,
	   installcheck/Amanda_Rest_Changers.pl,
	   installcheck/Amanda_Rest_Configs.pl,
	   installcheck/Amanda_Rest_Dles.pl,
	   installcheck/Amanda_Rest_Dumps.pl,
	   installcheck/Amanda_Rest_Labels.pl,
	   installcheck/Amanda_Rest_Runs.pl,
	   installcheck/Amanda_Rest_Storages.pl,
	   installcheck/Amanda_Rest_Storages_Labels.pl,
	   installcheck/Amanda_Rest_Version.pl: Use symbol for the severity.

2014-10-02  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ammessage.h: Change severity values.
	* perl/Amanda/Message.pm: Change severity values.
	* perl/Amanda/Changer.pm, perl/Amanda/Changer/disk.pm,
	* perl/Amanda/Changer/diskflat.pm, perl/Amanda/Changer/multi.pm,
	  perl/Amanda/Changer/robot.pm, perl/Amanda/Curinfo.pm,
	  perl/Amanda/Curinfo/Info.pm, perl/Amanda/Label.pm,
	  perl/Amanda/Recovery/Scan.pm, perl/Amanda/Rest/Amcheck.pm,
	  perl/Amanda/Rest/Changers.pm, perl/Amanda/Rest/Configs.pm,
	  perl/Amanda/Rest/Dles.pm, perl/Amanda/Rest/Dumps.pm,
	  perl/Amanda/Rest/Labels.pm, perl/Amanda/Rest/Report.pm,
	  perl/Amanda/Rest/Runs.pm, perl/Amanda/Rest/Services.pm,
	  perl/Amanda/Rest/Storages.pm, perl/Amanda/Rest/Storages/Labels.pm,
	  perl/Amanda/Rest/Version.pm, perl/Amanda/Status.pm,
	  perl/Amanda/Storage.pm, perl/Amanda/Tapelist.swg,
	  perl/Amanda/Vault.pm, server-src/amcheck.c: Set severity.
	* installcheck/Amanda_Rest_Amcheck.pl,
	  installcheck/Amanda_Rest_Changers.pl,
	  installcheck/Amanda_Rest_Configs.pl,
	  installcheck/Amanda_Rest_Dles.pl,
	  installcheck/Amanda_Rest_Dumps.pl,
	  installcheck/Amanda_Rest_Labels.pl,
	  installcheck/Amanda_Rest_Runs.pl,
	  installcheck/Amanda_Rest_Storages.pl,
	  installcheck/Amanda_Rest_Storages_Labels.pl,
	  installcheck/Amanda_Rest_Version.pl: Change for new severity values.

2014-10-02  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ammessage.c: Change API. Add all messages for amcheck.
	* common-src/ammessage.h: Change prototype.
	* server-src/amcheck.c, client-src/senddiscover.c: Use new API.
	* perl/Amanda/Message.pm: Add message code 2850000.
	* perl/Amanda/Rest/Amcheck.pm: Add a message with exit_status of
	  amcheck
	* installcheck/Amanda_Rest_Amcheck.pl: Fix for new message.

2014-10-02  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Runs.pm (/amanda/v1.0/configs/:CONF/runs/messages):
	  change from post to get method.

2014-10-02  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Amanda/bin/app.pl.in
	  (/amanda/v1.0/configs/:CONF/runs/messages): change from post to get
	  method.

2014-10-01  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Fix perl warning.
	* server-src/amstatus.pl: Fix perl warning.

2014-10-01  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Labels.pm, perl/Amanda/Rest/Storages/Labels.pm
	  (list): add filter on datestamp.

2014-09-30  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/file.c (debug_agets): Fix parsing of comment.

2014-09-30  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scan/lexical.pm,
	  perl/Amanda/Taper/Scan/oldest.pm (last_use_label): Fix for empty
	  tapelist.

2014-09-29  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Dles.pl: Fix for new message format.

2014-09-29  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ammessage.c: Set component and module.
	* common-src/amutil.c (set_pcomponent, get_pcomponent, set_pmodule,
	  get_pmodule, push_component_module, pop_component_module):
	  New functions.
	* common-src/amutil.h: Add prototype.
	* perl/Amanda/Changer.pm: Call push_component_module and
	  pop_component_module.
	* perl/Amanda/Message.pm: Set component and module.
	* server-src/amcheck.c: Set component and module.
	* application-src/ambsdtar.c, application-src/amgtar.c
	  application-src/amstar.c: Call set_pcomponent and set_pmodule,
	* perl/Amanda/Util.swg (setup_application): Call set_pcomponent and
	  set_pmodule.
	* client-src/amdump_client.pl, common-src/amgetconf.pl,
	  device-src/amdevcheck.pl, device-src/amtapetype.pl,
	  perl/Amanda/Rest/Amanda/bin/app.pl.in, perl/Amanda/Script_App.pm,
	  server-src/amadmin_perl.pl, server-src/amanda-rest-server.pl,
	  server-src/amanda.psgi.pl, server-src/amcheck-device.pl,
	  server-src/amcheckdump.pl, server-src/amcleanup.pl,
	  server-src/amcleanupdisk.pl, server-src/amdump.pl,
	  server-src/amdumpd.pl, server-src/amfetchdump.pl,
	  server-src/amflush.pl, server-src/amidxtaped.pl,
	  server-src/amlabel.pl, server-src/amlogroll.pl,
	  server-src/amreindex.pl, server-src/amreport.pl,
	  server-src/amrestore.pl, server-src/amrmtape.pl,
	  server-src/amserverconfig.pl, server-src/amstatus.pl,
	  server-src/amtape.pl, server-src/amvault.pl,
	  server-src/chunker.pl,
	  server-src/taper.pl: Call setup_application with component and module.
	* installcheck/Amanda_Rest_Amcheck.pl,
	  installcheck/Amanda_Rest_Changers.pl,
	  installcheck/Amanda_Rest_Configs.pl,
	  installcheck/Amanda_Rest_Dumps.pl,
	  installcheck/Amanda_Rest_Labels.pl,
	  installcheck/Amanda_Rest_Runs.pl,
	  installcheck/Amanda_Rest_Storages.pl,
	  installcheck/Amanda_Rest_Storages_Labels.pl,
	  installcheck/Amanda_Rest_Version.pl: Fix for new message format.


2014-09-25  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (get_running_on): new function.
	* common-src/conffile.h (get_running_on): add prototype.
	* perl/Amanda/Config.swg (get_running_on): swig it.
	* common-src/ammessage.c, perl/Amanda/Changer.pm,
	  perl/Amanda/Message.pm,
	  server-src/amcheck.c: Add process and running_on in message.
	* perl/Amanda/Rest/Changers.pm, perl/Amanda/Rest/Configs.pm,
	  perl/Amanda/Rest/Dles.pm, perl/Amanda/Rest/Dumps.pm,
	  perl/Amanda/Rest/Labels.pm, perl/Amanda/Rest/Runs.pm,
	  perl/Amanda/Rest/Storages.pm, perl/Amanda/Rest/Storages/Labels.pm,
	  perl/Amanda/Rest/Version.pm: call Amanda::Util::set_pname.
	* installcheck/Amanda_Rest_Amcheck.pl,
	  installcheck/Amanda_Rest_Changers.pl,
	  installcheck/Amanda_Rest_Configs.pl,
	  installcheck/Amanda_Rest_Dles.pl,
	  installcheck/Amanda_Rest_Dumps.pl,
	  installcheck/Amanda_Rest_Labels.pl,
	  installcheck/Amanda_Rest_Runs.pl,
	  installcheck/Amanda_Rest_Storages.pl,
	  installcheck/Amanda_Rest_Storages_Labels.pl,
	  installcheck/Amanda_Rest_Version.pl: Fix for new field in message.

2014-09-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scan/traditional.pm: Check for
	  DEVICE_STATUS_VOLUME_UNLABELED without volume_header.

2014-09-24  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/*.pm, perl/Amanda/Rest/Storages/Labels.pm: Fix for
	  html generated pages.
	* perl/Makefile.am (html): Do not remove html-tmp.

2014-09-24  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/diskflat-device.c: Error is DEVICE_STATUS_VOLUME_UNLABELED
	  if the file do not exists.
	* device-src/vfs-device.c (vfs_device_read_label): Do not reset an
	  error when it is set.
	* installcheck/Amanda_Rest_Storages.pl: Fix fo device change.
	* perl/Amanda/Changer/diskflat.pm: Fix perl warning.
	* perl/Amanda/CheckDump.pm ,perl/Amanda/FetchDump.pm: Create a
	  log.<timestamp>.0 file can a checkdump.<timestamp> or
	  fetchdump.<timestamp>
	* perl/Amanda/Rest/Runs.pm: Do not create the checkdump.$$ or
	  fetchdump.$$. list also list checkdump and fetchdump run.

2014-09-24  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: Fix perl warning.
	* perl/Amanda/Taper/Worker.pm (TAKE_SCRIBE_FROM): Set
	  scribe1->{'cancelled'} to 0.

2014-09-23  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amanda-rest-server.pl: Add '--max-requests 1' to starman
	  arguments.

2014-09-22  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c (amgtar_restore): Exit on error if tar fail.
	* perl/Amanda/Changer/diskflat.pm: fix.
	* perl/Amanda/FetchDump.pm: New perl module to fetch a dump.
	* perl/Amanda/Message.pm (full_message): New function.
	* perl/Amanda/Rest/Amanda/bin/app.pl.in: Add
	  post /amanda/v1.0/configs/:CONF/runs/fetchdump
	* perl/Amanda/Rest/Runs.pm (fetchdump): New function.
	* perl/Makefile.am: Add Amanda/FetchDump.pm
	* server-src/amfetchdump.pl: Use new perl Amanda::Fetchdump module.
	* server-src/amidxtaped.pl: Use new perl Amanda::Fetchdump module.
	* installcheck/amfetchdump.pl: Fix for module use.

2014-09-22  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Storages_Labels.pl: Fix.

2014-09-19  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/diskflat-device.c: Unlink file on erase.
	* perl/Amanda/Changer.pm: Add message 1100066
	* perl/Amanda/Changer/diskflat.pm: Do not create files if slot not
	  used.
	* perl/Amanda/Label.pm: Fix.
	* installcheck/Amanda_Rest_Storages.pl: Fix.
	* installcheck/Amanda_Rest_Storages_Labels.pl: Fix.

2014-09-18  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scan/traditional.pm: Continue on invalid.

2014-09-16  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm (verify): Failure to read the label is not an
	  error.
	* perl/Amanda/Changer.pm: Add message for code 1100065.

2014-09-16  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Compute and print crc32 of each packet if
	  debug_auth >= 6.

2014-09-10  Xu Han <xhan@carbonite.com>
	* packaging/rpm/amanda.spec.src: CentOS 7 packaging.

2014-09-10  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/gnutar.pl: Fix for rhel7.

2014-09-10  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/amanda_configure.m4: Fix,
	  s/AMANDA_EXTENSIONS_HOOK/AMANDA_REST_EXTENSIONS/g

2014-09-10  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/rest-extensions.m4: Fix,
	  s/EXTENSIONS_HOOK_DIR/REST_EXTENSIONS_DIR/g

2014-09-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Amanda/bin/app.pl.in: Add changers URL.
	* installcheck/Amanda_Rest_Changers.pl: Typo

2014-09-10  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/amanda_configure.m4:
	  s/AMANDA_REST_HOOK/AMANDA_EXTENSIONS_HOOK/
	* config/amanda/rest-hook.m4: remove file
	* perl/Amanda/Constants.pm.in.src:
	  s/AMANDA_REST_HOOK/AMANDA_EXTENSIONS_HOOK/
	* perl/Amanda/Rest/Amanda/bin/app.pl.in: Use REST_EXTENSIONS_DIR
	* config/amanda/rest-extensions.m4: Copy of rest-hook.m4, rename
	  AMANDA_REST_HOOK to AMANDA_EXTENSIONS_HOOK, define REST_EXTENSIONS_DIR
	  instead of REST_HOOK_DIR.

2014-09-10  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (get_changer_list): New function.
	* common-src/conffile.h (get_changer_list): Add protoype.
	* perl/Amanda/Config.swg (get_changer_list) Swig it.
	* perl/Amanda/Config.swg: Add new message.
	* perl/Amanda/Changer.pm: Fix typo.
	* perl/Amanda/Rest/Storages.pm: Fix typo.
	* perl/Makefile.am: Add Amanda/Rest/Changers.pm
	* perl/Amanda/Rest/Changers.pm: Add new REST API
	* installcheck/Makefile.am: Add Amanda_Rest_Changers
	* installcheck/Amanda_Rest_Changers.pl: Test the new REST API.

2014-09-08  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Fix for dump to tape.
	* installcheck/Amanda_Rest_Runs.pl: Fix.

2014-09-08  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/ScanInventory.pm: Can changer set_error_to_unknown if a
	  slot previously in error succeed.
	* perl/Amanda/Taper/Scan/lexical.pm, perl/Amanda/Taper/Scan/oldest.pm:
	  Scan one slot for each error message.
	* perl/Amanda/Changer/multi.pm (set_error_to_unknown): new function to
	  mark as unknown all slot with a given error message.

2014-09-03  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/dvdrw-device.c: dvdrw_growisofs_command,
	  dvdrw_mount_command and dvdrw_umount_command property are
	  G_TYPE_STRING.
	* installcheck/Amanda_Device.pl: Test parsing dvd properties.

2014-09-03  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c (get_openstack_swift_api_v2_setting): Set
	  hdl->x_auth_token to NULL.

2014-09-02  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Fix mailto allocation.

2014-09-02  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/rait-device.c: Use int value instead of pointer value.

2014-08-28  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Message.pm: 32xxxxx are for amanda-extensions.

2014-08-27  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/xfer-dest-taper-cacher.c: Cast pointer.

2014-08-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c (check_user_amandahosts): Proceed to next
	  line if host and user match but not the service.

2014-08-27  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Bill Blough <devel@blough.us>
	* ndmp-src/ndmjob_args.c, device-src/tape-device.c,
	  server-src/amindexd.c, man/xml-source/amanda.conf.5.xml,
	  man/xml-source/amanda-auth.7.xml, man/xml-source/amzfs-sendrecv.8.xml,
	  man/xml-source/amanda-changers.7.xml,
	  man/xml-source/amzfs-snapshot.8.xml,
	  common-src/amutil.c: Fix typos.

2014-08-27  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/syshacks.m4: Define NEED_LD_LIBRARY_PATH_ENV on hpux.
	* common-src/alloc.c (safe_env_full): Add LD_LIBRARY_PATH.
	* amar-src/amar.c, common-src/ipc-binary.h, device-src/ndmp-device.c,
	  device-src/xfer-dest-device.c, device-src/xfer-dest-taper-cacher.c,
	  device-src/xfer-dest-taper-splitter.c: Change so gpointer to gchar*
	  because hpux compiler can't do arithmetic on gpointer.


2014-08-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amservice.c: Print arguments to the debug file.
	* common-src/conffile.c: Add ctimeout to client config file.
	* perl/Amanda/Rest/Configs.pm: Fix parsing of config_overrides.
	* perl/Amanda/Rest/Services.pm: Pass config_overrides to amservice.

2014-08-11  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/senddiscover.c: Fix memory use.

2014-08-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Amanda/config.yml: Add log_path

2014-08-07  Jean-Louis Martineau <martineau@zmanda.com>
	* example/inetd.conf.amandaclient.in,
	  example/inetd.conf.amandaserver.in
	  example/xinetd.amandaclient.in,
	  example/xinetd.amandaserver.in: Add senddicover service.

2014-08-06  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Amanda/bin/app.pl.in: Set log_path to
	  "@AMANDA_DBGDIR@/amanda-rest-server-log"
	* perl/Amanda/Rest/Amanda/config.yml: Set appname to "amanda".
	* perl/Makefile.am: Do not create ../Rest/Amanda/logs

2014-08-05  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Script_App.pm (print_to_server): print CRITICAL message
	  in [].

2014-08-04  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/senddiscover.c: fllush(stdout)
	* perl/Amanda/Service.pm: Add error code 3100005.

2014-08-04  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/senddiscover.c: Add the --device argument.
	* perl/Amanda/Rest/Services.pm: Do not read a config, set diskdevice
	  and esxpass property.

2014-08-01  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: Remove duplicate entry.

2014-08-01  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/senddiscover.c: Fix.
	* common-src/ammessage.c: Fix json output.
	* perl/Amanda/Message.pm: Add Amanda::Service::Message.
	* perl/Amanda/Rest/Amanda/bin/app.pl.in: Add
	  /amanda/v1.0/services/discover URL
	* perl/Makefile.am: Add Amanda/Service.pm and Amanda/Rest/Services.pm
	* perl/Amanda/Service.pm: New perl module
	* perl/Amanda/Rest/Services.pm: REST API for deicover service.

2014-08-01  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Application.swg (known_commands: Add discover.
	* perl/Amanda/Message.pm: Add Amanda::Amvmware::Message.

2014-07-31  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ammessage.c: Fix typedef.

2014-07-31  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/amanda_configure.m4: Call AMANDA_REST_HOOK
	* perl/Amanda/Constants.pm.in.src: Add $REST_HOOK_DIR.
	* config/amanda/rest-hook.m4 (AMANDA_REST_HOOK): --with-rest-hook
	* perl/Amanda/Rest/Amanda/bin/app.pl.in: Load rest-hook

2014-07-31  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c, server-src/amcheck.c: Fix bug found by
	  coverity.

2014-07-31  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Handle senddiscover service.
	* client-src/Makefile.am: Build senddiscover.
	* client-src/client_util.c: Parse DISCOVER backup support option.
	* client-src/client_util.h (backup_support_option_t): Add discover.
	* client-src/senddiscover.c: New client service.
	* common-src/Makefile.am: Add ammessage.
	* common-src/ammessage.c: Add struct and function to handle Message
	  and print them in JSON format.
	* common-src/ammessage.h: Add prototype.
	* common-src/conffile.c: Fix json indentation.
	* perl/Amanda/Message.pm: Add senddiscover.

2014-07-31  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/dumpers.m4: Improve error message for bsdtar.

2014-07-30  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (config_print_errors_as_message): New function.
	* common-src/conffile.h (config_print_errors_as_message): New
	  prototype.
	* perl/Amanda/Config.swg: Add error 1500016.
	* server-src/amanda-rest-server.pl: s/Amadna/Amanda/
	* server-src/amcheck.c: Use printf_message instead of error.

2014-07-30  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Amcheck.pm: Use '-c' for client check.

2014-07-29  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/bsd-security.m4: USE_AMANDAHOSTS must be defined even
	  without bsd security (for bsdudp and bsdtcp).

2014-07-29  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Nathan Stratton Treadway
	* man/xml-source/amgtar.8.xml:
	  Add ": directory is on a different filesystem; not dumped".
	* man/xml-source/amanda-devices.7.xml: Add amanda-changers man page.
	* man/xml-source/ambsdtar.8.xml: Typo.
	* man/xml-source/amanda.conf.5.xml: Typo.

2014-07-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amanda-rest-server.pl: Use Amanda::Paths::AMANDA_DBGDIR
	  instead of CNF_LOGDIR for the rest-api-pid file.

2014-07-24  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c (check_security): service is
	  unused in some compilation path.

2014-07-24  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsd-security.c, common-src/bsdtcp-security.c,
	  common-src/bsdudp-security.c, common-src/krb5-security.c:
	  Remove "\n" in security_seterror error message.
	* server-src/amanda-rest-server.pl: Improve error detection.

2014-07-24  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (config_is_initialized): Fix declaration.
	* common-src/conffile.h: Comment typo.

2014-07-24  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.h (config_is_initialized): Fix prototype.

2014-07-23  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c (check_security): Take a new service
	  argument.
	* common-src/amanda.h (check_security): Change prototype.
	* common-src/conffile.c (config_is_initialized): New functionto return
	  if the config is initialized.
	* common-src/conffile.h (config_is_initialized): New prototype.
	* common-src/debug.c: (debug_unlink_old): Return if config is not
	  initialized.
	* server-src/amidxtaped.pl: Add "amidxtaped" as argument to
	  check_bsd_security.
	* server-src/amindexd.c: Add "amindexd" as argument to check_security.
	* perl/Amanda/Util.swg (check_security_fd): Take a new service
	  argument, pass it to check_security.
	* perl/Amanda/ClientService.pm (check_bsd_security): Take a new
	  service argument, pass it to Amanda::Util::check_security.

2014-07-14  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/Makefile.am: Fix for building out of tree.

2014-07-14  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/Makefile.am: Fix for building out of tree.

2014-07-11  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Orion Poplawski <orion@cora.nwra.com>
	* ndmp-src/Makefile.am: Fix for building out of tree.

2014-07-10  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/script-email.pl: Remove $args.

2014-07-09  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/script-email.pl: Accept all characters in mailto.

2014-07-09  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Fix curl version check for
	  CURLE_SSL_CACERT_BADFILE.

2014-07-09  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Amcheck.pl: Fix for --without-client.

2014-07-09  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Use '.
	* server-src/amcheck.c: Encode " and / in json reply.

2014-07-08  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Disklist.swg: Fix perl warning.

2014-07-08  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Runs.pl: Fix.

2014-07-08  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/*.pm: Improve html formating.

2014-07-08  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: s/"/'/
	* installcheck/Amanda_Config.pl: Check '.
	* installcheck/Amanda_Rest_Configs.pl: Check '.
	* installcheck/Amanda_Rest_Dles.pl: Check '.
	* installcheck/Amanda_Rest_Runs.pl: Check Amanda::Rest::Runs module.
	* installcheck/Makefile.am (server_tests): Add Amanda_Rest_Runs.
	* perl/Amanda/Amdump.pm: Small Improvement.
	* perl/Amanda/Amflush.pm: Small Improvement.
	* perl/Amanda/Rest/Runs.pm: Add list method.
	* perl/Amanda/Status.pm: Improve documentation.
	* perl/Amanda/Vault.pm: Remove debugging statement.
	* server-src/amflush.pl: log pid-done line.
	* server-src/planner.c: s/--exact_match/--exact-match/

2014-07-08  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Move some declaration to s3-device.h
	* device-src/s3-device.h: New file.
	* device-src/Makefile.am: Add s3-device.h.

2014-07-04  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Amcheck.pl: Fix.

2014-07-04  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Amanda/bin/app.pl.in: Add Amcheck module.

2014-07-03  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Message.pm: Add amcheck message.
	* perl/Amanda/Rest/Amcheck.pm: Rest API endpoint to execute amcheck.
	* perl/Makefile.am (AmandaRest_DATA): Add Amanda/Rest/Amcheck.pm.
	* server-src/diskfile.c (match_disklist): return a GPtrArray.
	* server-src/diskfile.h (match_disklist): Change prototype.
	* server-src/driver.c, server-src/dumper.c: Fix argv0.
	* server-src/amadmin.c, server-src/planner.c: Use newest
	  match_disklist function.
	* server-src/amcheck.c, server-src/amcheck-device.pl: new --message
	  argument to format the output in json.
	* installcheck/Amanda_Rest_Amcheck.pl: Check the Amcheckrest api.
	* installcheck/Makefile.am: Add Amanda_Rest_Amcheck.

2014-07-03  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (handle_dumper_result): Call dumper_taper_result
	  if we already get the taper result.

2014-07-02  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driverio.c (update_info_dumper): Do not update if size or
	  csize is 0.
	* server-src/server_util.c: Do not uses history if size is 0.

2014-06-26  Strong Liang <strong@zmanda.com>
	* server-src/driver.c: Updated copyright-info.
	* ChangeLog: trimed trailing spaces.

2014-06-26  Jean-Louis Martineau <martineau@zmanda.com>
	* Makefile.am: Use ${MKDIR_P}
	* device-src/Makefile.am, ndmp-src/Makefile.am, xfer-src/Makefile.am:
	  Use ${SED}

2014-06-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Remove useless space.

2014-06-19  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/Makefile.am, ndmp-src/Makefile.am,
	  xfer-src/Makefile.am: Fix install-build-dependencies.

2014-06-18  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsdtcp-security.c: Use bloking connect.

2014-06-17  Jean-Louis Martineau <martineau@zmanda.com>
	* Makefile.am (install-build-dependencies): Copy include and config
	  for client.

2014-06-16  Jean-Louis Martineau <martineau@zmanda.com>
	* Makefile.am: Create the directory.

2014-06-16  Jean-Louis Martineau <martineau@zmanda.com>
	* Makefile.am: Fix for client/server install-build-dependencies
	  target.

2014-06-16  Jean-Louis Martineau <martineau@zmanda.com>
	* Makefile.am, common-src/Makefile.am, device-src/Makefile.am,
	  ndmp-src/Makefile.am, xfer-src/Makefile.am: Add
	  install-build-dependencies target.

2014-06-13  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Dumps.pl: Sort dumps in reply.

2014-06-12  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/taper.pl: Accept some log lines in varying order.

2014-06-11  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in: Split in two files.
	* config/amanda/amanda_configure.m4: All global settings.
	* device-src/s3-util.h: Undef _

2014-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Installcheck/Rest.pm (): Better error if starman can't
	  be forked.
	* installcheck/Amanda_Rest_Configs.pl,
	  installcheck/Amanda_Rest_Dles.pl,
	  installcheck/Amanda_Rest_Dumps.pl,
	  installcheck/Amanda_Rest_Labels.pl,
	  installcheck/Amanda_Rest_Storages.pl,
	  installcheck/Amanda_Rest_Storages_Labels.pl,
	  installcheck/Amanda_Rest_Version.pl: Improve error message.

2014-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Installcheck/Rest.pm (remove_source_line): Function to
	  remove the source_line from all Message of a json reply.
	* installcheck/Amanda_Rest_Configs.pl,
	  installcheck/Amanda_Rest_Dles.pl,
	  installcheck/Amanda_Rest_Dumps.pl,
	  installcheck/Amanda_Rest_Labels.pl,
	  installcheck/Amanda_Rest_Storages.pl,
	  installcheck/Amanda_Rest_Storages_Labels.pl,
	  installcheck/Amanda_Rest_Version.pl: Use remove_source_line.

2014-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Installcheck/Rest.pm: Improve rest server startup.

2014-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/diskflat-device.c: Fix erase method.
	* perl/Amanda/Changer.pm: Many new Amanda::Changer::Message.
	* perl/Amanda/Label.pm: Allow to assign comment.
	* perl/Amanda/Rest/Storages/Labels.pm: Allow to assign comment.
	* installcheck/Amanda_Rest_Storages.pl: source_line change.
	* installcheck/Amanda_Rest_Storages_Labels.pl: Check The
	  storages/:STORAGE/labels endpoint.
	* installcheck/Installcheck/Rest.pm: Allow DELETE, improve rest
	  server startup.
	* installcheck/Makefile.am: Add Amanda_Rest_Storages_Labels.

2014-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Dumps.pl: More typos.

2014-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Dumps.pl,
	  installcheck/Amanda_Rest_Storages.pl: Typos.

2014-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Storages.pl,
	  installcheck/Amanda_Rest_Dumps.pl: Add files.

2014-06-06  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Dumps.pl: Check the Dumps endpoint
	* installcheck/Amanda_Rest_Storages.pl: Check the Storages endpoint
	* installcheck/Installcheck/Config.pm: Add policy and storage.
	* installcheck/Makefile.am: Add Amanda_Rest_Dumps and
	  Amanda_Rest_Storages.
	* perl/Amanda/Changer.pm, perl/Amanda/Changer/diskflat.pm,
	  perl/Amanda/Storage.pm: Change many Amanda::Changer::Error to be
	  Amanda::Message compliant.
	* perl/Amanda/Rest/Storages.pm: Pass the tapelist to the storage.

2014-06-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amfetchdump.pl: Pass the tapelist to the Storage.

2014-06-04  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report.pm: Fix exit_status.
	* installcheck/Amanda_Report.pl: Add check for exit_status.
	* installcheck/amreport.pl: Fix exit_status check.

2014-06-02  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Configs.pl: Fix line number.

2014-06-02  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Configs.pl: Fix.
	* perl/Amanda/Rest/Configs.pm: Fix perl warning.
	* perl/Amanda/Rest/Labels.pm: Fix perl warning.

2014-06-02  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Add 'directory is on a different
	  filesystem; not dumped' as a normal message.

2014-05-30  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Amanda/bin/app.pl.in:
	  Remove 'use Data::Structure::Util'.

2014-05-30  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/gnutar.pl: Fix for SunOS
	* perl/Amanda/Interactivity.pm: Do not die if ->new return  undef.
	* perl/Amanda/Interactivity/stdin.pm: Add debugging if can't read
	  STDIN.

2014-05-29  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Version.pl.
	  installcheck/Amanda_Rest_Configs.pl.
	  installcheck/Amanda_Rest_Dles.pl,
	  installcheck/Amanda_Rest_Labels.pl: Typo.

2014-05-29  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Configs.pl,
	  installcheck/Amanda_Rest_Dles.pl,
	  installcheck/Amanda_Rest_Labels.pl,
	  installcheck/Amanda_Rest_Version.pl,
	  installcheck/Installcheck/Rest.pm: Use port 5001.
	* installcheck/amadmin.pl: Fix sort
	* perl/Amanda/Disklist.swg: Fix sort.

2014-05-29  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Installcheck/Rest.pm: Retrun error if can't fork
	  starman.
	* installcheck/Amanda_Rest_Configs.pl,
	  installcheck/Amanda_Rest_Dles.pl,
	  installcheck/Amanda_Rest_Labels.pl,
	  installcheck/Amanda_Rest_Version.pl: SKIP test if forking starman
	  failed.

2014-05-29  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Installcheck/Rest.pm: Fix to send starman stderr to the
	  debug file.

2014-05-29  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Configs.pl: Fix.

2014-05-28  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: Sort to get repeatable result.
	* perl/Amanda/Disklist.swg: Sort to get repeatable result.
	* perl/Amanda/Report.pm: Sort to get repeatable result.
	* perl/Amanda/Report/human.pm: Sort to get repeatable result.
	* installcheck/amadmin.pl: Fix for new order.
	* installcheck/catalogs/filesystemstaped.cat: Fix for new order.

2014-05-28  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/amglue/integers.swg: Fix compiler warnings.
	* installcheck/Makefile.am: Add Installcheck/Rest.pm

2014-05-28  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Configs.pl, installcheck/Amanda_Rest_Dles.pl,
	  installcheck/Amanda_Rest_Labels.pl,
	  installcheck/Amanda_Rest_Version.pl: Skip test if WWW::Curl::Easy is
	  not available.

2014-05-27  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Runs.pm: Remove Data::Structure::Util dependencies.

2014-05-27  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Rest_Configs.pl: Check Amanda::Rest::Configs
	* installcheck/Amanda_Rest_Dles.pl: Check Amanda::Rest:Dles
	* installcheck/Amanda_Rest_Labels.pl: Check Amanda::Rest::Labels
	* installcheck/Amanda_Rest_Version.pl: Check Amanda::Rest::Version
	* installcheck/Amanda_Tapelist.pl: Fix for reuse.
	* installcheck/Installcheck/Dumpcache.pm: Fix for 0_setupcache
	* installcheck/Installcheck/Rest.pm: New perl modules to start/stop
	  the Rest server.
	* installcheck/Makefile.am: Add Amanda_Rest_Configs, Amanda_Rest_Dles,
	  Amanda_Rest_Labels and Amanda_Rest_Version
	* perl/Amanda/Config.swg: Small fix.
	* perl/Amanda/Curinfo.pm: Add message code 1300030 and 1300031
	* perl/Amanda/Curinfo/Info.pm: Fix perl warning.
	* perl/Amanda/Disklist.swg: Add message code 1400009
	* perl/Amanda/Paths.pm.in: Add amperldir.
	* perl/Amanda/Rest/Dles.pm: Add check and generate message code
	  1400009, 1300030 and 1300031
	* perl/Amanda/Rest/Labels.pm: fix for defined $params.
	* perl/Amanda/Tapelist.swg: Set reuse to 0.

2014-05-26  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/CheckDump.pm: New perl module for checkdump.
	* server-src/amcheckdump.pl: Use new Amanda::Checkdump module.
	* perl/Amanda/JSON/Amdump.pm: Typo.
	* perl/Amanda/Message.pm: Add Amanda::CheckDump::Message
	* perl/Amanda/Rest/Amanda/bin/app.pl.in: Add
		/amanda/v1.0/configs/:CONF/runs/checkdump
		/amanda/v1.0/configs/:CONF/runs/messages
	* perl/Amanda/Rest/Runs.pm: Add checkdump and messages methods.
	* perl/Makefile.am: Add Amanda/CheckDump.pm

2014-05-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amtape.pl: Add relabeled case.

2014-05-12  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/rpm/amanda.spec.src: Add amazon.

2014-05-09  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendsize.c: Fix compiler warning.

2014-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Changer_diskflat.pl: Use File::Path::rmtree.

2014-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/diskflat-device.c: Check result of ftruncate.

2014-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amrmtape.pl: Add --external-copy argument.
	* man/xml-source/amrmtape.8.xml: Document --external-copy argument.
	* perl/Amanda/Label.pm: Implement external_copy argument.
	* perl/Amanda/Rest/Storages/Labels.pm: Ditto.

2014-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/diskflat-device.c (erase): Add method.
	* perl/Amanda/Changer/diskflat.pm: New chg-diskflat changer.
	* perl/Amanda/Changer.pm (label_to_slot): New method.
	* perl/Makefile.am: Add Amanda/Changer/diskflat.pm.
	* installcheck/Amanda_Changer_diskflat.pl: Test chg-diskflat.
	* installcheck/Makefile.am: Add Amanda_Changer_diskflat.
	* server-src/amreport.pl: Remove degugging.

2014-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/libs.m4: Search pkg-config in /opt/csw/bin.

2014-05-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/xfer-source-holding.c: Allow to rad s SPINT_DUMPFILE
	  from holding disk.

2014-05-07  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/sun-pkg/buildpkg: gmake is in /opt/csw/bin

2014-05-06  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/sun-pkg/buildpkg: Use /usr/csw/bin/gmake if available.

2014-05-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (start_some_dumps): Fix if a disk is moved to
	  directq.

2014-05-05  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Interactivity/stdin.pm, server-src/amcheckdump.pl,
	  server-src/amfetchdump.pl, server-src/amvault.pl: Disable
	  interactivity if STDIN can't be read.

2014-05-01  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c (xml_check_options): Set dumper_kencrypt.

2014-04-30  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/ScanInventory.pm: Reload the tapelist at every scan.

2014-04-30  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Improve error message.

2014-04-29  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Fix lock.
	* perl/Amanda/Changer/robot.pm (_get_state): Return "failed".
	* server-src/amlabel.pl (user_msg): Fix for string.

2014-04-25  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/uparse.y: Remove unused variable.

2014-04-25  Jean-Louis Martineau <martineau@zmanda.com>
	* amar-src/amar.c (amar_read_cb): Handle eof correctly.

2014-04-25  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/config.m4 (AMANDA_CONFIGURE_ARGS): New macro to set
	  CONFIGURE_ARGS.
	* configure.in: Call AMANDA_CONFIGURE_ARGS
	* common-src/genversion.c: Print CONFIGURE_ARGS.

2014-04-24  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck-device.pl: Typo.

2014-04-24  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsdtcp-security.c: Retry all IPs on connection refused.
	* common-src/security-util.h (struct sec_handle): Add res, next_res,
	  connect_callback, connect_arg, src_ip and port.
	* common-src/stream.c (stream_client_addr): New function to open a
	  connection to a 'struct addrinfo'.
	* common-src/stream.h (stream_client_addr): Add prototype.

2014-04-23  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Interactivity/email.pm: Check permission of the
	  check-file.

2014-04-23  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Interactivity/email.pm: Do not call remove if
	  resend_delay is 0.

2014-04-23  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck-device.pl: Fix output from tape scan.

2014-04-17  Jean-Louis Martineau <martineau@zmanda.com>
	* amar-src/amar.c (read_done): Call done_cb withthe error.
	* amar-src/amar.c (amar_read_cb): Call read_done on error.
	* amar-src/amar.h (amar_done_callback_t): Add error in prototype.
	* perl/Amanda/Archive.swg: (read_done_cb): Get error.

2014-04-16  Jean-Louis Martineau <martineau@zmanda.com>
	* amar-src/amar.c (amar_read_cb): Call amar_stop_read.
	* amar-src/amar.c (set_amar_read_cb): Call amar_start_read.

2014-04-15  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Fix compiler warning.
	* config/amanda/syshacks.m4: Compile on s390x-8-linux-*

2014-04-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Tapelist.swg: Fix perl warning.

2014-04-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Fix.
	* perl/Amanda/Interactivity/email.pm: Try to fix memory leak.
	* perl/Amanda/ScanInventory.pm: Abort the scan on inventory error.

2014-04-10  Jean-Louis Martineau <martineau@zmanda.com>
	* amar-src/amar.c: Do not use newer glib function.

2014-04-07  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Taper_Scribe.pl (set_write_timestamp): Add method.
	* perl/Amanda/Taper/Scan.pm: Fix perl warning.

2014-04-07  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Tapelist.swg (lookup_by_barcode): New method to return a
	  tle from a barcode.

2014-04-07  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm (_get_state): Lookupo label in tapelist
	  file if it is not availbale in bc2lb.

2014-04-01  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scan.pm: Do not se the same tape twice in the same
	  run.
	* perl/Amanda/Taper/Scribe.pm: Set taperscan write_timestamp.

2014-03-31  Jean-Louis Martineau <martineau@zmanda.com>
	* amar-src/amar.c (amar_read, set_amar_read_cb): Add a done_cb.
	* amar-src/amar.c (amar_set_error): New function to set an error.
	* amar-src/amar.h: New prototype.
	* amar-src/amarchiver.c: Use NULL done_cb.
	* amar-src/amar-test.c: Pass a NULL done_cb.
	* installcheck/Amanda_Archive.pl: Test set_read_cb with done_cb.
	* perl/Amanda/Archive.swg: Handle done_cb and error.
	* perl/Amanda/MainLoop.swg (run_until_empty): Remove method.

2014-03-28  Jean-Louis Martineau <martineau@zmanda.com>
	* amar-src/amar.c: Stop processing input file on stopped mode.

2014-03-28  Jean-Louis Martineau <martineau@zmanda.com>
	* amar-src/amar.c: Fix memory leak.

2014-03-28  Jean-Louis Martineau <martineau@zmanda.com>
	* amar-src/amar.c (amar_stop_read, amar_start_read): New function.
	* amar-src/amar.h (amar_stop_read, amar_start_read): Add prototype.
	* perl/Amanda/Archive.swg: Swig them.

2014-03-27  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Do not close STDIN and STDERR.

2014-03-27  Jean-Louis Martineau <martineau@zmanda.com>
	* amar-src/amar.c: Add read function that use the mainloop.
	* amar-src/amar.h: Add read function that use the mainloop.
	* amar-src/amarchiver.c: Use new event interface.
	* perl/Amanda/Archive.swg: Swig new event interface.
	* perl/Amanda/MainLoop.swg (run_until_empty): New method.

2014-03-25  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add CNF_REST_API_PORT
	* common-src/conffile.h: Add CNF_REST_API_PORT
	* perl/Amanda/Config.swg: Add CNF_REST_API_PORT
	* server-src/amanda-rest-server.pl: New script to start/stop the rest
	  server.
	* server-src/Makefile.am (sbin_SCRIPTS_PERL): Add amanda-rest-server.
	* man/xml-source/amanda-rest-server.8.xml: New man page.
	* man/Makefile.am (SERVER_MAN_PAGES): Add amanda-rest-server.8

2014-03-25  Jean-Louis Martineau <martineau@zmanda.com>
	* amar-src/amar.c (amar_file_size, amar_attr_size): New function to
	  return file and attribute size.
	* amar-src/amar.h (amar_file_size, amar_attr_size): Add prototype.
	* perl/Amanda/Archive.swg: Make them available to perl.
	* perl/Amanda/Archive.pod: Document them.
	* installcheck/Amanda_Archive.pl: Test the new method.

2014-03-24  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amtrmidx.c, server-src/planner.c: Fix memmory leak.

2014-03-24  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Warn if tapecycle <= runtapes.

2014-03-24  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/taper.pl: Fix count of test.

2014-03-21  Jean-Louis Martineau <martineau@zmanda.com>
	* amar-src/amarchiver.c: Create parent directory on extraction.

2014-03-14  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Do not try to find holding space when no
	  holding disk are used.

2014-03-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsdtcp-security.c: Make a non blocking connection.

2014-03-12  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: Log empty part.
	* server-src/amreport.pl: Fix.
	* installcheck/Amanda_Taper_Scribe.pl: Fix for Scribe change.
	* installcheck/taper.pl: Fix for Scribe change.

2014-03-11  Jean-Louis Martineau <martineau@zmanda.com>
	* amar-src/amar.h: Fix constant.
	* amar-src/amarchiver.c: Do not append attribute id (16) to filename
	  on extraction.
	* installcheck/Amanda_Archive.pl: Add check.
	* installcheck/amarchiver.pl: Add check.
	* perl/Amanda/Archive.swg: Document and export attribute id.

2014-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/diskflat-device.c: Check lseek result.

2014-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Util.swg (setup_application): Call glib_init.

2014-03-04  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.h (struct disk_s): Add orig_holdingdisk.
	* server-src/diskfile.c: Set orig_holdingdisk.
	* server-src/driver.c: Use orig_holdingdisk to report error.
	* server-src/planner.c: Improve message.

2014-03-03  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/Makefile.am: Add diskflat-device.c and diskflat-device.h
	* device-src/device.c: Call diskflat_device_register
	* device-src/diskflat-device.c: New diskflat device.
	* device-src/diskflat-device.h: New diskflat device header file.
	* device-src/vfs-device.c: Refactoring.
	* device-src/vfs-device.h: Refactoring.
	* installcheck/Amanda_Device.pl: Check the diskflat device.
	* man/xml-source/amanda-devices.7.xml: Document the diskflat device.

2014-02-28  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/ndmp-device.c, device-src/s3-device.c,
	  device-src/tape-device.c, device-src/xfer-dest-device.c,
	  device-src/xfer-source-device.c, device-src/xfer-source-recovery.c,
	  xfer-src/element-glue.c,
	  xfer-src/filter-crc.c: Correctly report memory allocation error for
	  large buffer.

2014-02-28  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Protocol.pm: Add READY Message.
	* perl/Amanda/Taper/Scribe.pm: Call
	  $self->{'feedback'}->scribe_ready();
	* perl/Amanda/Taper/Worker.pm (scribe_ready): New method to send the
	  READY message.
	* perl/Amanda/Vault.pm (scribe_ready): New method that do nothing.
	* server-src/driver.c: Send dumper result to taper only after it sent
	  the READY message.
	* server-src/driverio.h (wtaper_t): Add ready.
	* server-src/server_util.c (cmdstr): Add READY.
	* server-src/server_util.h (enum): Add READY.
	* installcheck/Amanda_Taper_Scribe.pl,
	  installcheck/taper.pl: Fix check.

2014-02-25  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/Makefile.am: Do not fail if ../perl/Amanda already
	  exists.

2014-02-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: Fix intallation in DESTDIR.

2014-02-14  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/dvdrw-device.c: Fix.

2014-02-14  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amflock.c: Check return value of truncate.

2014-02-13  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amfeatures.c, common-src/amfeatures.h,
	  perl/Amanda/Logfile.swg: Add fe_sendbackup_retry,
	  fe_sendbackup_retry_delay, fe_sendbackup_retry_level,
	  fe_sendbackup_retry_message.
	* perl/Amanda/Report.pm: Handle RETRY line from dumper.
	* perl/Amanda/Report/human.pm: Handle RETRY line from dumper.
	* perl/Amanda/Status.pm: Handle RETRY line from dumper.
	* server-src/amstatus.pl: Remove unneeded print statement.
	* server-src/driver.c: Handle RETRY result from dumper.
	* server-src/dumper.c: Handle 'sendbackup: retry' line.
	* server-src/logfile.c, server-src/logfile.h: Add L_RETRY
	* server-src/server_util.c, server-src/server_util.h: Add RETRY

2014-02-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Check the size section of the CRC.

2014-02-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amflock.c: Detect failure to write the file and ftruncate
	  it to 0.
	* perl/Amanda/Changer.pm: Detect failure to read the state file and do
	  like if it was empty.

2014-02-06  Jean-Louis Martineau <martineau@zmanda.com>
	* amar-src/amar.c, application-src/ambsdtar.c: Coverity fix.

2014-02-05  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Amflush.pm: Fix message.
	* perl/Amanda/Rest/Runs.pm: Add amdump and amflush
	* perl/Amanda/Rest/Storages.pm: Fix documentation.
	* perl/Amanda/Rest/Storages/Labels.pm: Fix documentation.
	* perl/Amanda/Rest/Amanda/bin/app.pl.in: Add many methods.

2014-02-05  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/human.pm (divzero, divzero_wide, divzero_col,
	  hrmn, mnsc):  Function must be dalled from the package.
	* perl/Amanda/Report/json.pm (divzero, divzero_wide, divzero_col,
	  hrmn, mnsc):  Add functions in package.
	* perl/Amanda/Rest/Amanda/config.yml: Add allow_nonref
	* perl/Amanda/Rest/Report.pm: Fix documentation.

2014-02-05  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Status.pm: Fix documentation.

2014-02-05  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Dumps.pm: Fix documentation.

2014-02-04  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/ndmp-device.c, ndmp-src/ndmpconnobj.c,
	  ndmp-src/ndmpconnobj.h: Undo previous patch.
	* device-src/ndmp-device.c: ndmp_connection_wait_for_notify_with_cond
	  returning 1 is a valid result.

2014-02-04  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/ndmp-device.c: Call ndmp_connection_mover_get_state
	  before calling ndmp_connection_wait_for_notify_with_cond to verify
	  the mover state.
	* ndmp-src/ndmpconnobj.c (ndmp_connection_mover_get_state): Return
	  pause_reason and halt_reason
	* ndmp-src/ndmpconnobj.h (ndmp_connection_mover_get_state): Change
	  prototype.

2014-02-03  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/amlabel.pl: Fix.

2014-02-03  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (get_storage_list): New function.
	* common-src/conffile.h (get_storage_list): Add prototype.
	* perl/Amanda/Config.swg (get_storage_list): Swig function.
	* perl/Amanda/Changer/aggregate.pm,
	  perl/Amanda/Changer/multi.pm
	  perl/Amanda/Changer/robot.pm: Fix for some arguments.
	* perl/Amanda/Curinfo/Info.pm: Fix.
	* perl/Amanda/DB.pm: New module.
	* perl/Amanda/Label.pm: Add messages.
	* perl/Amanda/Message.pm: Add messages.
	* perl/Amanda/Rest.pm: New module.
	* perl/Amanda/Rest/Amdump.pm: Fix message.
	* perl/Amanda/Rest/Configs.pm, perl/Amanda/Rest/Dles.pm,
	  perl/Amanda/Rest/Dumps.pm, perl/Amanda/Rest/Labels.pm,
	  perl/Amanda/Rest/Runs.pm, perl/Amanda/Rest/Status.pm,
	  perl/Amanda/Rest/Storages.pm, perl/Amanda/Rest/Storages/Labels.pm,
	  perl/Amanda/Rest/Version.pm: Implement REST API and document it.
	* perl/Amanda/ScanInventory.pm: Fix.
	* perl/Amanda/Tapelist.swg: Fix messages.
	* perl/Makefile.am: Add Amanda/DB.pm and Amanda/Rest.pm.

2014-01-30  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Rest/Storages.pm: Fix update command.
	* perl/Makefile.am: Fix installation of Amanda/Rest/Amanda/config.yml

2014-01-29  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/Makefile.am, perl/Makefile.am: Fix build.

2014-01-29  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am (EXTRA_DIST): Add Amanda/Constants.pm.in.src

2014-01-29  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.c (device_create): New function.
	* device-src/device.h (device_create): Add prototype.
	* device-src/s3-device.c (s3_device_create): New function.
	* perl/Amanda/Device.swg: Swig device_create.
	* perl/Amanda/Changer.pm (create): New method.
	* perl/Amanda/Changer/disk.pm (create): New create method.
	* perl/Amanda/Changer/multi.pm (create): New create method.
	* perl/Amanda/JSON/Changer.pm: Add create method.
	* perl/Amanda/Rest/Storages.pm (create): Add method to the Rest API.
	* perl/Amanda/Rest/Storages/Labels.pm: Remove debugging message.
	* perl/Amanda/Storage.pm: Add no_validate argument.
	* server-src/amtape.pl: Add create subcommand that call the changer
	  create method.
	* man/xml-source/amtape.8.xml: Document create subcommand.

2014-01-28  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c: fix for /usr/bin/lsb_release

2014-01-28  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Do not uncompress/decrypt if server do not
	  have fe_amrecover_receive_unfiltered.

2014-01-28  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c: Fix distro.

2014-01-28  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: Fix check and installation of dancer module

2014-01-28  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/calcsize.c: Take root privilege to call get_fs_usage.

2014-01-27  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: Install Dancer generated file only.

2014-01-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/Makefile.am: Make perl/Amanda/Constants.pm.in from
				  perl/Amanda/Constants.pm.in.src
	* config/amanda/config.m4: Set BUILT_REV and BUILR_BRANCH
	* perl/Amanda/Constants.pm.in: Removed
	* perl/Amanda/Constants.pm.in.src: New file
	* perl/Amanda/Rest/Version.pm: Return BYUILT_DARA, BUILT_REV and
	  BUILT_BRANCH.
	* perl/Makefile.am: Make perl/Amanda/Constants.pm.in from
			    perl/Amanda/Constants.pm.in.src

2014-01-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (config_init_with_global): New function.
	* common-src/conffile.h: Add CONFIG_INIT_GLOBAL and
	  config_init_with_global prototype.
	* man/xml-source/amanda.conf.5.xml: Document /etc/amanda/amanda.conf
	  is loaded.
	* perl/Amanda/Config.swg: Swig CONFIG_INIT_GLOBAL and
	  config_init_with_global.
	* installcheck/Amanda_Config.pl: Use CONFIG_INIT_GLOBAL and/or
	  config_init_with_global.
	* installcheck/amgetconf.pl: Fix for amandates.
	* */*.c, */*.pl: Use CONFIG_INIT_GLOBAL and/or
	  config_init_with_global.

2014-01-22  Jean-Louis Martineau <martineau@zmanda.com>
	* Amanda/Rest/Amanda/bin/app.pl.in: Replace app.pl  with substituted
	  value.
	* Amanda/Rest/Amanda/bin/app.pl: Remove
	* Amanda/Rest/Amanda/logs/deployment.log: Remove
	* Amanda/Rest/Dumps.pm: Fix.

2014-01-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amvault.pl: Use the perl Amanda::Vault Module.
	* perl/Amanda/Vault.pm: New module for vaulting.
	* perl/Amanda/Report/human.pm: Fix for vaulting.
	* perl/Amanda/Message.pm: Add Message number for Amanda::Vault.
	* perl/Amanda/Amflush.pm: Remove unused module.
	* perl/Amanda/Label.pm: Fix typo.
	* perl/Amanda/Status.pm: Fix for vaulting.
	* perl/Amanda/Config.swg: Add messages.
	* perl/Amanda/Rest/*: The new REST-API
	* perl/Amanda/JSON/Config.pm: Add list.
	* perl/Amanda/JSON/Label.pm: Fix typo.
	* perl/Makefile.am: Add Amanda/Rest
	* installcheck/amvault.pl: Fix for stdout/stderr change.
	* installcheck/Installcheck/Run.pm: Add run_out.

2014-01-16  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c (print_platform): Run /usr/bin/lsb_release if
	  it exist.

2014-01-14  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amcleanup.8.xml: Add amvault.
	* server-src/amcleanup.pl: Add amvault.

2014-01-11  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/glib-util.c: Fix for curl and gnutls.

2014-01-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Retry on MTX 'No Sense'.

2014-01-09  Jean-Louis Martineau <martineau@zmanda.com>
	* amar-src/amar.c, amar-src/amar.h, perl/Amanda/Archive.pod,
	  perl/Amanda/Archive.swg: Add amar_size and
	  amar_attr_add_data_fd_in_thread
	* installcheck/Amanda_Archive.pl: Test amar_size.

2014-01-06  Jean-Louis Martineau <martineau@zmanda.com>
	* gnulib/group-member.c, gnulib/xalloc-oversized.h,
	  gnulib/euidaccess.c, gnulib/getgroups.c, gnulib/root-uid.h,
	  config/gnulib/getgroups.m4, config/gnulib/group-member.m4,
	  config/gnulib/euidaccess.m4: Missing file gnulib euidaccess.

2014-01-03  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Check gnutar_listdir before uid to 0.
	* client-src/client_util.c: Use EUIDACCESS.
	* common-src/amanda.h: Define EUIDACCESS.
	* configure.in: Check for euidaccess and eaccess.
	* config/gnulib/euidaccess.m4, config/gnulib/getgroups.m4,
	  config/gnulib/gnulib-cache.m4, config/gnulib/gnulib-comp.m4,
	  config/gnulib/group-member.m4, gnulib/Makefile.am,
	  gnulib/euidaccess.c, gnulib/getgroups.c, gnulib/group-member.c,
	  gnulib/regenerate/regenerate, gnulib/root-uid.h,
	  gnulib/xalloc-oversized.h: Add euidaccess module.

2014-01-02  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Use server estimate on estimate timeout.

2014-01-02  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/catalogs/chunker-partial.cat,
	  installcheck/catalogs/normal.cat, installcheck/catalogs/quoted.cat,
	  installcheck/catalogs/taper-parallel-write.cat: Fix for maxdumps in
	  PORT-DUMP line.

2014-01-02  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Fix for maxdumps in PORT-DUMP line.

2014-01-02  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driverio.c: Send maxdumps to dumper.
	* server-src/dumper.c: Parse maxdumps, add maxdumps in REQ packet.

2013-12-30  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Do not report DATA-PATH error if a device is
	  not found.

2013-12-20  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ambsdtar.c: Add a trailling '/' on directory entry
	  in the index.
	* man/xml-source/ambsdtar.8.xml: Say that restore never remove files.

2013-12-20  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/multi.pm: Get current slot from
	  current_slot_csc.
	* server-src/driver.c: Correctly parse PARTDONE message.

2013-12-20  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Fix for CURLE_SSL_CACERT_BADFILE.

2013-12-18  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c: Run sw_vers to find Mac platform.

2013-12-18  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Change state if now loaded.
	* server-src/amtape.pl (inventory): Print empty slot.

2013-12-18  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ambsdtar.c: Some fixes.

2013-12-16  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/Makefile.am: Add ambsdtar.
	* application-src/ambsdtar.c: New application script for BSD tar
	* application-src/amgtar.c: Call dbclose()
	* application-src/amstar.c: Call dbclose()
	* client-src/calcsize.c: Handle BSDTAR
	* config/amanda/dumpers.m4 (AMANDA_PROG_BSDTAR): function to find
	  bsdtar binary.
	* configure.in: Call AMANDA_PROG_BSDTAR
	* man/Makefile.am: Add ambsdtar.8
	* man/entities/global.entities.in: Add bsdtar.
	* man/xml-source/ambsdtar.8.xml: New ambsdtar man page
	* perl/Amanda/Constants.pm.in: Add $BSDTAR
	* NEWS, ReleaseNotes: Add ambsdtar

2013-12-16  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c (backup_support_option): Do pass pass the
	  --config, --host, --disk and --device
	* client-src/client_util.h (backup_support_option): Change prototype.
	* client-src/selfcheck.c, client-src/sendbackup.c,
	  client-src/sendsize.c,  recover-src/extract_list.c: Use new
	  backup_support_option arguments.

2013-12-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amfetchdump.pl: Fix if header have only one
	  application property.

2013-12-12  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Fix read from applicaiton stderr.

2013-12-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/disk_history.c: Fix storage setting.

2013-12-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driverio.c(update_info_taper): Log a message if label is
	  not set.

2013-12-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amflush.pl: Fix parsing of letter argument.

2013-11-27  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Always use the prefix when accessing the
	  bucket.
	* device-src/s3.c (s3_is_bucket_exists): Add prefix as argument.
	* device-src/s3.h (s3_is_bucket_exists): Change prototype.

2013-11-21  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm, perl/Amanda/Changer,
	  perl/Amanda/JSON/Changer.pm: s/look to be/looks to be/.

2013-11-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindexd.c: Fix bug found by coverity.

2013-11-21  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Speedup by checking all devices.

2013-11-20  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: Add message 1100025
	* perl/Amanda/Changer/robot.pm (verify): Report drive error.
	* server-src/amtape.pl: Handle message 1100025.

2013-11-20  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: Add message 1100024
	* perl/Amanda/Changer/robot.pm (verify): Report non-existant drive.
	* server-src/amtape.pl: Handle message 1100024.

2013-11-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amfetchdump.pl: Allow multiple values for the one
	  property.

2013-11-18 Dan Locks <dwlocks@zmanda.com>
	* example/Makefile.am: update xml file names
	* example/amandaclient-tcp.xml.in: rename this
	* example/amandaclient.xml.in: to this
	* example/amandaserver-tcp.xml.in: rename this
	* example/amandaserver.xml.in: to this

2013-11-18 Dan Locks <dwlocks@zmanda.com>
	* example/Makefile.am: include new files in dist tarball
	* example/amandaclient-tcp.xml.in, example/amandaserver-tcp.xml.in:
	  smf manifests for solaris >= 10

2013-11-18  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/progs.m4: AC_SUBST(SORT_PATH)
	* perl/Amanda/Constants.pm.in: Add SORT_PATH
	* perl/Amanda/Logfile.swg: Add getindexfname
	* perl/Amanda/Message.pm: Add Amanda::Index::Message
	* perl/Amanda/Status.pm:: s/Message/Amanda::Status::Message/
	* perl/Amanda/Index.pm: New perl module to return index file and
	  header from index directory.
	* perl/Amanda/JSON/Index.pm: New JSON module.
	* perl/Amanda/JSON.pm: Add missing JSON modules.
	* perl/Makefile.am: Add Amanda/JSON/Index.pm and Amanda/Index.pm
	* server-src/amanda.psgi.pl: Add Amanda::JSON::Index::* methods.

2013-11-15  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c, application-src/ampgsql.pl,
	* application-src/amraw.pl, application-src/amsamba.pl,
	* application-src/amstar.c, application-src/amsuntar.pl,
	* application-src/amzfs-sendrecv.pl: Implement index command.
	* perl/Amanda/Application.swg: Enable index command
	* server-src/amcheckdump.pl, server-src/amreindex.pl: Pass --config,
	  --host, --disk, --device and --level to the application.

2013-11-15  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/fileheader.c (parse_heredoc): print message to debug if
	  end of heredoc is not found.
	* server-src/amfetchdump.pl: Trap failure on XML::Simple::XMLin.

2013-11-14  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Curinfo/Info.pm: Small fix.

2013-11-14  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amreindex.pl: Compress the index file if compress-index
	  is set.

2013-11-14  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS: Add erase-on-full And many missing storage setting.
	* common-src/conffile.c: Add CONF_ERASE_ON_FULL in storage.
	* common-src/conffile.h: Add STORAGE_ERASE_ON_FULL.
	* device-src/device.c: Add device_reset(), device_write_block() now
	  return DeviceWriteResult.
	* device-src/device.h: Add DeviceWriteResult and prototype.
	* device-src/ndmp-device.c, device-src/null-device.c,
	  device-src/rait-device.c, device-src/s3-device.c,
	  device-src/tape-device.c (*_device_write_block): return WRITE_FAILED
	  or WRITE_SUCCEED.
	* device-src/vfs-device.c (vfs_device_write_block): return
	  WRITE_FAILED, WRITE_SUCCEED, WRITE_FULL or WRITE_SPACE.
	* device-src/xfer-dest-device.c, device-src/xfer-dest-taper-cacher.c:
	  Handle new return value from device_write_block.
	* device-src/xfer-dest-taper-splitter.c: Also handle WRITE_FULL or
	  WRITE_SPACE.
	* device-src/xfer-dest-taper.c (xfer_dest_taper_new_space_available):
	  New method
	* device-src/xfer-dest-taper.h: Add prototype
	* man/xml-source/amanda.conf.5.xml: Document erase-on-full storage
	  setting
	* perl/Amanda/Changer/aggregate.pm: Add slot_in_same_changer method.
	* perl/Amanda/Changer/disk.pm: Set global_space to 1.
	* perl/Amanda/Config.swg: Add STORAGE_ERASE_ON_FULL.
	* perl/Amanda/Device.swg: Add device_reset().
	* perl/Amanda/Curinfo/Info.pm: Fix.
	* perl/Amanda/Label.pm: Some fix.
	* perl/Amanda/Storage.pm: Set erase_on_full.
	* perl/Amanda/Taper/Scribe.pm: Handle XMSG_NO_SPACE, try to erase
	  volume and call element new_space_available method.
	* perl/Amanda/Xfer.swg: Add XMSG_NO_SPACE.
	* perl/Amanda/XferServer.swg: Add xfer_dest_taper_new_space_available
	* server-src/tapefile.c (read_tapelist): Set retention_computed=FALSE
	* xfer-src/xmsg.c (xmsg_repr): Add XMSG_NO_SPACE
	* xfer-src/xmsg.h (xmsg_type): Add XMSG_NO_SPACE

2013-11-14  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amtrmidx.c: Do not use temporary files.
	* server-src/dumper.c: Always compress the index if required.

2013-11-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindexd.c: Fix gcc warnings.

2013-11-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: Fix pod.

2013-11-11  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindexd.c: More fix.

2013-11-11  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindexd.c: Fix typo.

2013-11-08  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Implement the index command.
	* man/Makefile.am: Add amreindex.8
	* man/xml-source/amanda.8.xml: Add amreindex.8
	* man/xml-source/amreindex.8.xml: Document the new amreindex program.
	* perl/Amanda/Logfile.swg: Add getindex_*_fname and getheaderfname
	  methods.
	* server-src/Makefile.am: Add amreindex.
	* server-src/amreindex.pl: New program to reindex dumps.
	* server-src/amtrmidx.c: Unlink a few more index files.

2013-11-08  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add compress-index and sort-index
	* common-src/conffile.h: Add CNF_COMPRESS_INDEX and CNF_SORT_INDEX
	* perl/Amanda/Config.swg: Add CNF_COMPRESS_INDEX and CNF_SORT_INDEX
	* man/xml-source/amanda.conf.5.xml: Document compress-index and
	  sort-index
	* server-src/amindex.c (getindex_unsorted_fname,
				getindex_unsorted_gz_fname,
				getindex_sorted_fname,
				getindex_sorted_gz_fname): New methods to
	  retrieve the various names of the index files.
	* server-src/amindex.h: Add prototype.
	* server-src/amindexd.c: Read un/sorted un/compressed index file.
	* server-src/amtrmidx.c: sort and un/compress index files.
	* server-src/dumper.c: Do not compress the index stream if it must
	  be sorted.
	* NEWS: Document it.

2013-11-06  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c (delete_file): Check for no objects.
	* installcheck/Amanda_Device.pl: Use different bucket name for each
	  test.

2013-11-06  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/human.pm (USAGE BY TAPE): Add more space for the
	  Time.

2013-11-05  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Check for S3_ERROR_NoSuchBucket error.
	* device-src/s3.c: Do not free hdl->user_token twice.

2013-11-05  Jean-Louis Martineau <martineau@zmanda.com>
	* */*.c: Cleanup found by cppcheck.

2013-11-04  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Xfer.pl, installcheck/Installcheck/Mock.pm,
	  installcheck/amvault.pl: installcheck do not do indirect ndmp.

2013-11-04  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Use full_write instead of write.

2013-11-01  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Check return value of fdopen,
	  fclose(dev_outf).
	* server-src/driver.c, server-src/planner.c: Check return value of
	  holding_file_get_dumpfile.

2013-10-31  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c: Use hash table instead of re-scanning a list.

2013-10-31  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck-device.pl: Output DATA-PATH
	* server-src/amcheck.c: Check device data-path against dle data-path.

2013-10-30  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/ndmp-device.c: Unlock the abort_mutex when wait waiting
	  for the wait_thread thread.

2013-10-29  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/ndmp-device.c: INDIRECT property default ot yes.
	* man/xml-source/amanda-devices.7.xml: Document it.

2013-10-28  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amfeatures.h: Change features order to match 3.3 branch.

2013-10-28  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: Fix perl warning.
	* perl/Amanda/ScanInventory.pm: Check for label not in tapelist.

2013-10-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: amandaify property name.

2013-10-22  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/Makefile.am: Add dependencis for genversion.$(OBJEXT)

2013-10-16  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Tag 'file changed as we read it' as GOOD.

2013-10-16  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c: Do not load the config for version subcommand.

2013-10-16  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amcryptsimple.pl: Fix for no gpg-agent or gpg2.

2013-10-15  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/gnutar.pl: Fix for fc19.

2013-10-15  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Benjamin Kerensa
	* oldrecover-src/extract_list.c: Typo.

2013-09-18  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Process.pm: Use Amanda::Debug.

2013-09-18  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Add SESSION-TOKEN property.
	* device-src/s3.h (s3_open): Add session_token argument.
	* device-src/s3-device.c: Add SESSION-TOKEN property.
	* man/xml-source/amanda-devices.7.xml: Document the new property.

2013-09-18  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Fix parsing of config override.

2013-09-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Amflush.pm: Fix.
	* perl/Amanda/Cmdfile.swg: Fix for newer swig.
	* server-src/cmdfile.c: Cleanup.

2013-09-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Amflush.pm: Perl module with amflush functionnality.
	* perl/Amanda/JSON/Amflush.pm: New JSON module for running a flush.
	* perl/Amanda/Message.pm: Add Amanda::Amflush::Message.
	* perl/Makefile.am: Add Amanda/Amflush.pm, Amanda/JSON/Amflush.pm
	* server-src/amflush.c: Remove.
	* server-src/amflush.pl: New amflush programthat use the perl module.
	* server-src/Makefile.am: Add amflush perl script.
	* server-src/amanda.psgi.pl: Register Amanda::JSON::Amflush::run.

2013-09-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Amdump.pm: Add message code 2000002.
	* perl/Amanda/Config.swg: Add message code 1500002.
	* perl/Amanda/JSON/Amdump.pm: Use message code 2000002.
	* perl/Amanda/JSON/Config.pm: Use message code 1500002.
	* perl/Amanda/Message.pm: Fix documentation.

2013-09-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Disklist.swg: Fix.

2013-09-12  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Cmdfile.swg: Fix.

2013-09-12  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/amglue/integers.swg: Add pid_t.

2013-09-12  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Holding.pm: Typo.

2013-09-12  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Disklist.swg (match_disklist, reset_disklist,
	  add_holding_to_disklist): New methods.
	* perl/Amanda/Disklist.pod: Document them.
	* installcheck/Amanda_Disklist.pl: Create a debug file.

2013-09-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/cmdfile.c (add_cmd_in_memory,
	  cmdfile_get_ids_for_holding): New functions.
	* server-src/cmdfile.h (add_cmd_in_memory,
	  cmdfile_get_ids_for_holding): Prototype for new functions.
	* perl/Amanda/Cmdfile.swg: Perlify server-src/cmdfile.c
	* perl/Amanda/Cmdfile.pod: Document it.
	* perl/Makefile.am: Add Cmdfile module.

2013-09-11  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Handle displayunit,
	  add --detail, --summary --stats and --locale-independent-date-format,
	  remove --dumping, --waitdumping, --waittaper, --dumpingtape,
	  --writingtape, --finished, --failed, --estimate, --gestimate
	* perl/Amanda/Status.pm: Set $self->{'starttime-locale-independent'}
	* man/xml-source/amstatus.8.xml: Document them.

2013-09-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Label.pm: Fix.
	* server-src/tapefile.c: Speedup parsing.

2013-09-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Fix use of NULL pointer.

2013-09-05  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Amdump.pm: cleanup.
	* server-src/amanda.psgi.pl: Add Amanda::JSON::Amdump::run
	* server-src/amdump.pl: cleanup.

2013-09-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amfetchdump.pl: Fix previous patch.

2013-09-05  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/JSON/Report.pm: Take a trace_log as argument.
	* perl/Amanda/JSON/Status.pm: Take a amdump_log as argument.
	* perl/Amanda/Message.pod: Amndmp use 200000 message code.
	* perl/Makefile.am: Add perl/Amanda/Amdump.pm and
			        perl/Amanda/JSON/Amdump.pm
	* server-src/amdump.pl: Move all codes to a perl module.
	* perl/Amanda/Amdump.pm: New module for running a dump.
	* perl/Amanda/JSON/Amdump.pm: New JSON module for running a dump.

2013-09-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amfetchdump.pl: Parse header without dle_str.

2013-09-04  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Label.pm: Merge Label.pod.
	* perl/Amanda/Message.pm: Merge Message.pod.
	* perl/Amanda/Label.pod, perl/Amanda/Message.pod: Remove files.
	* perl/Makefile.am (EXTRA_DIST): Remove Label.pod and Message.pod.

2013-09-03  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amvault.pl: Add the "ST:storage" in many taper log lines.

2013-08-30  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Remove double increment of count.
	* server-src/amcheck.c: Do not set pw which is never used.
	* server-src/find.c: Do not set dp which is never used.

2013-08-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amrmtape.pl, server-src/taper.pl: Remove useless
	  debugging.

2013-08-28  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Fix STORAGE_DEVICE_OUTPUT_BUFFER_SIZE init.
	* device-src/xfer-dest-taper-splitter.c: Abort with better message if
	  memory allocation fail.
	* server-src/amcheck.c: Check device-output-buffer-size is nmot larger
	  than physical memory.

2013-08-28  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Message.pm: Add a 'severity' to a message.
	* perl/Amanda/Message.pod: Document severity.
	* perl/Amanda/Tapelist.swg (new): Return an array of two elements,
	  The first is the Amanda::Tapelist object, the second is a message.
	* server-src/amadmin_perl.pl, server-src/amtape.pl: Handle new return
	  value of Amanda::Tapelist->new, continue if it is a warning
	  severity.
	* perl/Amanda/DB/Catalog.pm, perl/Amanda/JSON/Tapelist.pm,
	  perl/Amanda/Recovery/Planner.pm, perl/Amanda/Report/human.pm,
	  perl/Amanda/Report/json.pm, server-src/amcheck-device.pl,
	  server-src/amcheckdump.pl, server-src/amidxtaped.pl,
	  server-src/amlabel.pl, server-src/amreport.pl,
	  server-src/amrestore.pl, server-src/amrmtape.pl,
	  server-src/amvault.pl, server-src/taper.pl: Handle new return
	  value of Amanda::Tapelist->new, abort on any message.
	* installcheck/Amanda_Changer.pl, installcheck/Amanda_Logfile.pl,
	  installcheck/Amanda_Recovery_Clerk.pl,
	  installcheck/Amanda_Tapelist.pl, installcheck/Amanda_Taper_Scan.pl,
	  installcheck/Amanda_Taper_Scan_lexical.pl,
	  installcheck/Amanda_Taper_Scan_oldest.pl,
	  installcheck/Amanda_Taper_Scan_traditional.pl,
	  installcheck/amlabel.pl, installcheck/amrmtape.pl,
	  installcheck/amtape.pl: Handle new return value of
	  Amanda::Tapelist->new.

2013-08-27  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Check error result from _get_state.

2013-08-26  Jean-Louis Martineau <martineau@zmanda.com>
	* xfer-src/element-glue.c (do_directtcp_connect): Do not free
	  unallocated memory.

2013-08-23  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amvault.pl: s/g_debug/debug/

2013-08-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amvault.pl: Print progress to debug file if not on a tty.

2013-08-21  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: Add REGEX-MATCH property.
	* man/xml-source/amsamba.8.xml: Document REGEX-MATCH property.

2013-08-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amvault.pl: Print progress status.

2013-08-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (start_some_dumps): Set dumper->job and
	  wtaper->job for dup direct to tape.

2013-08-19  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c: fix double free.

2013-08-14  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c: Fix for not supported platform.

2013-08-14  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c, client-src/client_util.c,
	  client-src/selfcheck.c, client-src/sendbackup.c,
	  client-src/sendsize.c, common-src/conffile.c,
	  server-src/diskfile.c, server-src/driver.c,
	  server-src/driverio.c: Fix memory leak.

2013-08-14  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c: Get in error state if the tape drive is in
	  fixed block size and it is different than the tapetype size.

2013-08-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amfetchdump.pl: Print applicationstdout to debug file and
	  stderr.

2013-08-12  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Process.pm: Be less scrict on perl binary name.

2013-08-09  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/cmdfile.c (cmdfile_write): Cast pid_t to int for printf.

2013-08-09  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c (tape_device_check_writable): Declare get
	  conditionaly.

2013-08-09  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c, server-src/holding.c: Cast getpid() to int
	  before printing it.

2013-08-09  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/holding.c: s/g_slist_free_full/slist_free_full/

2013-08-05  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c, common-src/conffile.c,
	  perl/Amanda/Header.swg, perl/Amanda/Logfile.swg, server-src/dumper.c,
	  server-src/find.c, server-src/holding.c,
	  server-src/planner.c: Fix memory leak.

2013-08-01  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindexd.c: Initialize invalid_stotage to NULL.

2013-08-01  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amfeatures.h: Add fe_amindexd_STORAGE.
	* common-src/amfeatures.c: Add fe_amindexd_STORAGE.
	* recover-src/amrecover.h (add_storage_value, set_storage): Add
	  prototype.
	* recover-src/help.c: Add storage command.
	* recover-src/set_commands.c (add_storage_value, set_storage): New
	  function.
	* recover-src/uparse.y: Parse storage command.
	* recover-src/uscan.l: Parse storage keyword,
	* server-src/amadmin.c (find): Add new 's' sort order for storage.
	* server-src/amidxtaped.pl: Fix filter issue.
	* server-src/amindexd.c: Accept STORAGE command from amrecover.
	* server-src/disk_history.c: Check storage.
	* server-src/find.c: Sort by storage.
	* server-src/find.h (DEFAULT_SORT_ORDER): Now "hkdlspbfw".
	* man/xml-source/amadmin.8.xml (find): Add new 's' sort order.
	* man/xml-source/amrecover.8.xml: Add new storage command.

2013-08-01  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/aggregate.pm: Small fix.
	* server-src/amadmin_perl.pl: Do not use XML::Simple.

2013-08-01  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Disklist.swg: Fix perl warning.
	* perl/Amanda/Report.pm: Set the storage.
	* perl/Amanda/Report/human.pm: Fix perl warning.
	* perl/Amanda/Status.pm: Fix perl warning.
	* server-src/amstatus.pl: Fix perl warning.
	* installcheck/Amanda_Curinfo.pl: Fix perl warning.
	* installcheck/Amanda_Report.pl: Add the storage.
	* installcheck/catalogs/filesystemstaped.cat,
	  installcheck/catalogs/multi-taper.cat.
	  installcheck/catalogs/normal.cat: Add the storage in taper DONE.

2013-08-01  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (handle_chunker_result): Remove dumper variable.

2013-08-01  Jean-Louis Martineau <martineau@zmanda.com>
	Add a job_t struct tolink dumper/chunker and taper.
	* server-src/driver.c: Use it.
	* server-src/driverio.c: Use it.
	* server-src/driverio.h: Define job_t.

2013-08-01  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm (show): fix.
	* perl/Amanda/Changer/robot.pm: Set slot on some error.

2013-08-01  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/aggregate.pm, perl/Amanda/Changer/disk.pm,
	  perl/Amanda/Changer/multi.pm, perl/Amanda/Changer/null.pm,
	  perl/Amanda/Changer/rait.pm, perl/Amanda/Changer/robot.pm,
	  perl/Amanda/Changer/single.pm: info can return the slots list.
	* perl/Amanda/Changer.pm (show): Use the slot list returned by info.

2013-08-01  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm: Some fix.

2013-07-31  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: Set storage_name to "NO-STORAGE" if there is
	  no storage.
	* perl/Amanda/Changer/aggregate.pm, perl/Amanda/Changer/disk.pm,
	  perl/Amanda/Changer/multi.pm, perl/Amanda/Changer/robot.pm:
	  Keep a current slot by config/storage/changer.

2013-07-31  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm (set_dump_cb): New method.
	* perl/Amanda/Taper/Worker.pm: return FAILED if
	  $self->{'xfer_source'}->get_addrs failed.
	* server-src/driver.c: Accept a FAILED immediately after a PORT-WRITE.

2013-07-30  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amanda.psgi.pl: Add missing JSON method.

2013-07-30  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/json.pm: Fix doc formating.

2013-07-30  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/JSON.pm: Add missing Amanda::JSON modules.

2013-07-30  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/amglue/bigint.c (amglue_Sv*): Theses functions take a new err
	  argument to be able to return error message.
	* perl/amglue/amglue.h (amglue_Sv*): Change prototypes.
	* perl/amglue/integers.swg: Add new amglue_Sv* argument and croak on
	  error.
	* perl/Amanda/Device.swg (set_gvalue_from_sv): return FALSE if
	  amglue_Sv* return an error.
	* perl/Amanda/NDMP.swg: Use new amglue_SvU64 err argument.

2013-07-29  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/JSON/Report.pm: add it.

2013-07-29  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/JSON/Device.pm, perl/Amanda/JSON/Dle.pm,
	  perl/Amanda/JSON/Label.pm, perl/Amanda/JSON/Status.pm: Fix Copyright
	  to 2013.
	* perl/Amanda/JSON/RPC/Dispatcher.pm: Use pretty json output.
	* perl/Amanda/JSON/Report.pm: New perl module.
	* perl/Amanda/Message.pod: Report use 190000 message code.
	* perl/Amanda/Report.pm: Add Amanda::Report::Message.
	* perl/Amanda/Report/human.pm: Use new
	  Amanda::Tapelist::list_new_tapes output.
	* perl/Amanda/Report/json.pm: Document json format, add a
	  generate_report method, jsonify the output_tapeinfo method.
	* perl/Amanda/Tapelist.swg: New binding for list_new_tapes.
	* perl/Makefile.am: Add Amanda/JSON/Report.pm
	* server-src/amadmin.c: Use new list_new_tapes output.
	* server-src/tapefile.c (list_new_tapes): Output an array of string.
	* server-src/tapefile.h: new prototype for list_new_tapes.

2013-07-29  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Status.pm, server-src/amstatus.pl: Fix for perl 5.10

2013-07-29  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amfetchdump.pl: Run application after filters.

2013-07-29  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsuntar.pl (command_estimate): Change order for
	  reading the pipe. Fix perl warnings.

2013-07-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Use Amanda::Status module
	* perl/Amanda/Status.pm: New perl module, rewrite of amstatus.
	* perl/Amanda/Config.swg: require Amanda::Config::FoldingHash.
	* perl/Amanda/Config/FoldingHash.pm: s/use/require/
	* perl/Amanda/JSON/RPC/Dispatcher.pm: Handle streaming reply.
	* perl/Amanda/JSON/Status.pm: New JSON perl module.
	* perl/Amanda/Message.pod: 1800000  Amanda::Status::Message
	* perl/Amanda/Taper/Protocol.pm: Add taper_name and storage on
	 START-TAPER.
	* perl/Amanda/Taper/Worker.pm (new): Taper taper_name as argument.
	* perl/Amanda/Taper/Controller.pm: Add taper_name argument to
	 Controller.
	* perl/Makefile.am: Add Amanda/Status.pm and Amanda/JSON/Status.pm
	* server-src/amanda.psgi.pl: Register Amanda::JSON::Status::current
	* server-src/amflush.c: Add storage in FLUSH line.
	* server-src/planner.c: Add storage in FLUSH line.
	* server-src/driver.c: Add more date in stdout file.
	* server-src/driverio.c: Add taper and storage in START-TAPER line.
	* installcheck/amstatus.pl: Fix for new amstatus output.
	* installcheck/catalogs/chunker-partial.cat,
	  installcheck/catalogs/normal.cat,
	  installcheck/catalogs/taper-parallel-write.cat,
	  installcheck/catalogs/quoted.cat: Fix for new amdump.X format.
	* installcheck/taper.pl: Fx for new amdump.X format.

2013-07-18  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Undo previous patch.
	* device-src/s3-device.c: Verify the bucket can be used as a subdomain
	  if S3-SUBDOMAIN is set.

2013-07-17  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: lowercase the bucket for the auth_string.

2013-07-16  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/JSON/*: json server interface.
	* perl/Amanda/*: Add many functionnalities of the servewr program.
			 Modified to return Amanda::Message
	* server-src/*: Mv functionalities to perl Modules.
	* installcheck/*: Change for modified interface.

2013-07-04  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.c: register types at initialization.

2013-07-03  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Remove from correct queue.

2013-06-28  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS, ReleaseNotes: Changes in 3.3.4

2013-06-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Fix use of NULL dereference.

2013-06-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/holding.c (holding_cleanup_dir): fclose pid_FILE.

2013-06-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/holding.c: Fix.

2013-06-28  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/multi.pm: Keep a current_slot by config.

2013-06-27  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/rait.pm: Fix perl warning.

2013-06-27  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/rait.pm: Set barcode in a reservation.

2013-06-27  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/rait.pm: Set chg in a reservation.

2013-06-27  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/progs.m4: Set LPRFLAG.

2013-06-26  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amflush.c, server-src/planner.c: Call holding_cleanup.
	* server-src/holding.c: ignore tmp file, add pid file in holding disk
	  to prevent parallel use.

2013-06-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amreport.pl: Fix send-amreport-on.

2013-06-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Always get a status initially.

2013-06-17  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/glib-util.c, device-src/s3-device.c, device-src/s3.c,
	  ndmp-src/ndmpconnobj.h, perl/Amanda/Util.swg, server-src/amflush.c,
	  server-src/driver.c, server-src/holding.c, server-src/tapefile.c:
	  Fix memory leak.

2013-06-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Fail with good error message if the
	  dataport-list is empty.

2013-06-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/ndmp.pm: s/destiation/destination/
	* perl/Amanda/Changer/robot.pm: (eject) Return an error if the drive
	  is empty.

2013-06-13  Jean-Louis Martineau <martineau@zmanda.com>
	* xfer-src/filter-process.c (xfer_filter_process): Add must_drain,
	  cancel_on_success and ignore_broken_pipe flag).
	* xfer-src/filter-process.c (child_watch_callback): Send XMSG_INFO.
	* xfer-src/xfer-element.c: Initialize new flags.
	* xfer-src/xfer-element.h (XferElement): Add must_drain, drain_mode,
	  cancel_on_success and ignore_broken_pipe.
	* xfer-src/element-glue.c: Handle new flags.
	* perl/Amanda/Xfer.swg (xfer_filter_process): Add new flags.
	* installcheck/Amanda_Xfer.pl: Test new flags.
	* server-src/amcheckdump.pl: Use new flags.
	* server-src/amfetchdump.pl: Use new flags.
	* server-src/amidxtaped.pl: Use new flags.
	* server-src/amrestore.pl: Use new flags.

2013-06-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Global changerfile is deprecated.
	* device-src/vfs-device.c: Add USE-DATA property.
	* device-src/vfs-device.h (VfsDevice): Add use_data.
	* man/xml-source/amanda-devices.7.xml: Document USE-DATA property.
	* man/xml-source/amanda.conf.5.xml: Global changerfile is deprecated.
	* perl/Amanda/Changer.pm: Do not set changerfile from global.
	* perl/Amanda/Changer/disk.pm: Do not create symlink.
	* perl/Amanda/Changer/multi.pm: Use global changerfile.
	* installcheck/Amanda_Changer_disk.pl,
	* installcheck/Amanda_Changer_multi.pl,
	* installcheck/Amanda_Changer_rait.pl,
	* installcheck/Amanda_Taper_Scan_traditional.pl,
	* installcheck/amdevcheck.pl: Fixes for changes.

2013-06-12  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Call
	  curl_easy_setopt(hdl->curl, CURLOPT_NOSIGNAL, TRUE)))

2013-06-11  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Do not save catalog if not label or header.
	* perl/Amanda/Changer/multi.pm (reset): Remove th slots hash.

2013-06-11  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/glib-util.c: Undo previous patch, debugging is not
	  yet enabled.
	* device-src/s3-device.c: Do it here.

2013-06-11  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/glib-util.c: Print to debug the ssl version amanda is
	  compiled for.

2013-06-11  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/catalogs/*.cat: Fix for previous change.

2013-06-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/human.pm: Center 'DUMPER STATS'.

2013-06-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c: Do not enqueue_disk, add_disk already do it.

2013-06-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Degraded dles only for degraded storage.
	* server-src/driverio.c: Set default degraded_mode.
	* server-src/driverio.h (taper_t): Add degraded_mode.

2013-06-06  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/ndmp-device.c, device-src/null-device.c,
	  device-src/rait-device.c, device-src/s3-device.c,
	  device-src/tape-device.c, device-src/vfs-device.c
	  (*device__finish_file): Set in_file even when already on error.
	* device-src/xfer-dest-taper-directtcp.c: Always call
	  device_finish_file().

2013-06-05  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm (make_new_tape_label): Return a not_fatal bit
	  for some error.
	* perl/Amanda/ScanInventory.pm: Continue the scan on not_fatal
	  make_new_tape_label error.

2013-06-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amrmtape.pl: Use the itapelist pool to find the storage
	  if the storage is not in the tapelist.

2013-06-05  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Taper_Scan_lexical.pl,
	  installcheck/Amanda_Taper_Scan_oldest.pl,
	  installcheck/Amanda_Taper_Scan_traditional.pl: Quit the storage.
	* perl/Amanda/Report/human.pm: Fix perl warning.
	* perl/Amanda/Storage.pm: Do not create the storage on failure.
	* perl/Amanda/Taper/Controller.pm: Keep the storage, quit the storage.
	* perl/Amanda/Taper/Worker.pm: Use controller's storage.
	* server-src/amcheck-device.pl, server-src/amidxtaped.pl,
	  server-src/amlabel.pl, server-src/amrmtape.pl,
	  server-src/amtape.pl, server-src/amvault.pl: Quit the Storage.

2013-06-05  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add ERASE_ON_FAILURE storage setting.
	* common-src/conffile.h: Add STORAGE_ERASE_ON_FAILURE.
	* man/xml-source/amanda.conf.5.xml: add erase-on-failure.
	* perl/Amanda/Config.swg: Add STORAGE_ERASE_ON_FAILURE.
	* perl/Amanda/Report.pm: Parse new taper line, add storage in %part.
	* perl/Amanda/Report/human.pm: Take care of storage.
	* perl/Amanda/Storage.pm: Set erase_on_failure.
	* perl/Amanda/Taper/Scribe.pm: Erase a volume if nothing good written
	  to it.
	* perl/Amanda/Util.swg (marshal_tapespec): Fix storage.
	* server-src/driver.c: Fix to not do two flush in parallel.
	* server-src/driverio.c: Add comment.
	* installcheck/Amanda_Report.pl: Fix for new report format.

2013-06-03  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c (unload_disklist): New function.
	* server-src/diskfile.h (unload_disklist): New prototype.
	* perl/Amanda/Disklist.swg: swig unload_disklist.
	* server-src/amadmin.c, server-src/amtrmidx.c,
	  server-src/amtrmlog.c: Call unload_disklist().
	* installcheck/Amanda_Disklist.pl: Test unload_disklist.

2013-05-31  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Add TIMEOUT property.
	* device-src/s3.c: Set CURLOPT_TIMEOUT with timeout value.
	* device-src/s3.h (s3_open): Add timeout argument.
	* man/xml-source/amanda-devices.7.xml: Add TIMEOUT property.

2013-05-30  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Add --dereference to all gtar command.

2013-05-29  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/tapelist.c: Do not use g_strcmp0.

2013-05-29  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Util.pl, installcheck/amidxtaped.pl: Fix.

2013-05-29  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amfeatures.h: Add fe_amrecover_storage_in_marshall and
	  fe_amrecover_storage_in_marshall amfeatures.
	* common-src/amfeatures.c: Add fe_amrecover_storage_in_marshall and
	  fe_amrecover_storage_in_marshall amfeatures.
	* common-src/tapelist.h (tapelist_t): Add storage.
	* common-src/tapelist.h: Many prototy change for storage.
	* common-src/tapelist.c: Marshall and unmarshall storage.
	* oldrecover-src/extract_list.c: Handle storage in marshall list.
	* recover-src/extract_list.c: Handle storage in marshall list.
	* perl/Amanda/Chunker/Scribe.pm: Typo.
	* perl/Amanda/DB/Catalog.pm: handle storage.
	* perl/Amanda/Logfile.swg (find_result_t): Add storage.
	* perl/Amanda/Recovery/Planner.pm (make_plan): Add storage_list,
	  all_copy and only_in_storage parameters.
	* perl/Amanda/Recovery/Scan.pm: Handle Storage in log line.
	* perl/Amanda/Report.pm: Handle Storage in log lines.
	* perl/Amanda/Storage.pm: Add DESTROY method.
	* perl/Amanda/Taper/Scribe.pm: Typo.
	* perl/Amanda/Taper/Worker.pm: Add Storage to log lines.
	* perl/Amanda/Util.swg (marshal_tapespec, unmarshal_tapespec): Handle
	  storage, new with_storage argument.
	* server-src/amcheckdump.pl: Check the dumps on all storages.
	* server-src/amfetchdump.pl: Fetch from the specified storage.
	* server-src/amidxtaped.pl: Fetch from the specified storage.
	* server-src/amindexd.c: Send storage to amrecover.
	* server-src/disk_history.h (DUMP_ITEM): Add storage.
	* server-src/disk_history.c: Handle storage.
	* server-src/find.c: Return storage, print storage.
	* server-src/find.h (find_result_t): Add storage and storage_id.
	* installcheck/Amanda_DB_Catalog.pl,
	  installcheck/Amanda_Recovery_Planner.pl,
	  installcheck/Amanda_Report.pl,
	  installcheck/Amanda_Util.pl,
	  installcheck/Installcheck/Catalogs.pm,
	  installcheck/amidxtaped.pl,
	  installcheck/catalogs/amflush.cat,
	  installcheck/catalogs/bigdb.cat,
	  installcheck/catalogs/bigestimate.cat,
	  installcheck/catalogs/doublefailure.cat,
	  installcheck/catalogs/filesystemstaped.cat,
	  installcheck/catalogs/flush-noorigsize.cat,
	  installcheck/catalogs/flush-origsize.cat,
	  installcheck/catalogs/longstrange.cat,
	  installcheck/catalogs/multi-taper.cat,
	  installcheck/catalogs/normal.cat,
	  installcheck/catalogs/resultsmissing.cat,
	  installcheck/catalogs/retried-nofinish.cat,
	  installcheck/catalogs/retried-strange.cat,
	  installcheck/catalogs/retried.cat,
	  installcheck/catalogs/shortstrange.cat,
	  installcheck/catalogs/skipped.cat,
	  installcheck/catalogs/spanned.cat,
	  installcheck/catalogs/strontium.cat,
	  installcheck/taper.pl: Change for new log format and API.

2013-05-24  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (start_some_dumps): Fix when multiple storage in
	  use.

2013-05-23  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndmpconnobj.c: Fix SU_SET_PORT argument.

2013-05-22  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Parse psql version with four numbers.

2013-05-21  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/gnutar.pl: Fix for fc18.

2013-05-21  Jean-Louis Martineau <martineau@zmanda.com>
	 * device-src/ndmp-device.c: Parse the LEOM property.

2013-05-17  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/ndmp.pm (get_device): Return the
	  Amanda::Changer::Error on error.

2013-05-17  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c (s3_make_bucket): Init add_create to FALSE.

2013-05-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amrmtape.pl: Try to locate the label in all storage if
	  the storage is not in the tapelist.

2013-05-17  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Do not abort partial upload if
	  multi-part-upload is not set.
	* device-src/s3.c: Handle DURABLE_REDUCED_AVAILABILITY for OAUTH2.
	* man/xml-source/amanda-devices.7.xml: Document
	  DURABLE_REDUCED_AVAILABILITY for google storage.

2013-05-16  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amidxtaped.pl: untaint input variable.

2013-05-16  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Add a VERBOSE property.
	* man/xml-source/ampgsql.8.xml: Document VERBOSE property.

2013-05-15  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/ps.m4: use one AC_MSG_RESULT.

2013-05-15  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/json.m4: Improve check for perl module.

2013-05-15  Jean-Louis Martineau <martineau@zmanda.com>
	* xfer-src/element-glue.c: Add debugging statement.

2013-05-15  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: Do not confess if device not available.
	* perl/Amanda/Taper/Worker.pm: Fix device_errors.

2013-05-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Fix data_host memory handling.

2013-05-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/tapefile.c: Memory leak.

2013-05-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/cmdfile.c: Memory leak.

2013-05-15  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/ampgsql.8.xml: Add disklist example.

2013-05-13  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsuntar.pl: Remove perl warning.

2013-05-13  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Check return value of system calls.
	* oldrecover-src/extract_list.c: Check return value of system calls.
	* oldrecover-src/amrecover.c: Call dbrename after config is set.

2013-05-13  Jean-Louis Martineau <martineau@zmanda.com>
	* gnulib/*, config/gnulib/*: upgrade gnulib to
	  3fe906e98202a591a6a14010aec1538adfd821b6.

2013-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Add that both flush-threshold-dumped
	  and flush-threshold-scheduled must be met.

2013-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Recovery/Planner.pm (make_plan): Handle latest_fulls.
	* server-src/amvault.pl: Add --latest-fulls option, pass latest_fulls
	  to Amanda::Recovery::Planner::make_plan().
	* man/xml-source/amvault.8.xml: Document --latest-fulls option.

2013-05-07  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/ampgsql.8.xml: Add an example.

2013-05-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Cleanup.

2013-04-29  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Config.swg (val_t_to_sv): Do not set tag if not set.
	* installcheck/Amanda_Config.pl: Fix for tag not set instead of undef.

2013-04-29  Jean-Louis Martineau <martineau@zmanda.com>
	* config/automake/scripts.am: Add SCRIPTS_PERL_NO_CHECK
	* config/amanda/json.m4: Define AMANDA_JSON_SERVER. Add --with-json-server, check for json-server
	  and check perl module rependencies.
	* config/amanda/components.m4: Invoke AMANDA_JSON_SERVER
	* perl/Makefile.am: Check json server module conditionally.
	* server-src/Makefile.am: Check amanda.psgi conditionally.
	* perl/Amanda/JSON/RPC/Dispatcher.pm,
	  perl/Amanda/JSON/RPC/Dispatcher/App.pm,
	  perl/Amanda/JSON/RPC/Dispatcher/Procedure.pm,
	  server-src/amanda.psgi.pl: Undo previous patches.

2013-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/JSON/RPC/Dispatcher/Procedure.pm: Do not require Moose.

2013-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/JSON/RPC/Dispatcher.pm: Do not require Moose.

2013-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amanda.psgi.pl: Do not require Dispacher.pm

2013-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: CURLE_SSL_CACERT_BADFILE is not defined on older
	  curl.

2013-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/JSON/RPC/Dispatcher.pm: Do not require Log::Any.
	* perl/Amanda/JSON/RPC/Dispatcher/App.pm: Do not require Dispatcher.pm.

2013-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/JSON/RPC/Dispatcher.pm: Do not require Plack::Request
	  at compile time.

2013-04-25  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Retry on CURLE_SSL_CACERT_BADFILE.

2013-04-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/JSON/Config.pm, perl/Amanda/JSON/Changer.pm: Remove
	  dependency of Digest/SHA1.

2013-04-24  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amvault.pl: Add --incrs-only argument.
	* man/xml-source/amvault.8.xml: Document --incrs-only argument.

2013-04-23  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Do not hopelessly wait 5 seconds if waitpid
	  return -1.

2013-04-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amvault.pl: Use DLE allow-split and device LEOM property.

2013-04-18  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Fix parsing command overwrite with '-'.
	  Fix small --print-source bug.

2013-04-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amdump.pl: Keep amflush as a relative symlink.
	* server-src/logfile.c: Keep log as a relative symlink.

2013-04-13 Dan Locks <dwlocks@zmanda.com>
	* packaging/sun-pkg/buildpkg: remove "use warnings" for solaris 8 compatibility

2013-04-12  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Document many storage setting.

2013-04-12  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Config.pl: Add append keyword for dump-selection check.

2013-04-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add APPEND keyword to tag and dump-selection.
	* man/xml-source/amanda.conf.5.xml: Document tag and dump-selection.

2013-04-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Parse erase-volume in a storage.
	* common-src/conffile.h: Add STORAGE_ERASE_VOLUME.
	* man/xml-source/amanda.conf.5.xml: Document erase-volume.
	* perl/Amanda/Config.swg: Add STORAGE_ERASE_VOLUME.
	* perl/Amanda/Changer.pm: Fix warning when meta not set.
	* perl/Amanda/IPC/LineProtocol.pm:Allow delayed start of reading.
	* perl/Amanda/Storage.pm: New erase_no_retention method.
	* perl/Amanda/Taper/Controller.pm: Call $storage->erase_no_retention().
	* perl/Amanda/Taper/Scan.pm: Use Debug qw( debug ).
	* server-src/amrmtape.pl: hanlde multiple storage.

2013-04-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c: Add force-level-1 command.
	* man/xml-source/amadmin.8.xml: Document force-level-1 command.
	* server-src/infofile.h: Add FORCE_LEVEL_1.
	* server-src/planner.c: Handle FORCE_LEVEL_1.

2013-04-11  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c, common-src/conffile.h: Add tag in dumptype
	  and dump-selection in storage.
	* perl/Amanda/Config.swg: Add new configuration setting.
	* installcheck/Amanda_Config.pl: Check parsing dump-selection.
	* server-src/diskfile.h: Add tags to disk_t.
	* server-src/diskfile.c: set disk_t->tags.
	* server-src/driver.c: Use tags and dump-selection.
	* perl/Amanda/Storage.pm: Set $self->{'dump_selection'}.

2013-04-09  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: Add await_device method and handle
	  cancelling a dump before the device is set.
	* perl/Amanda/Taper/Worker.pm: Call scribe wait_device before starting
	  the dump.

2013-04-09  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/Makefile.am: Fix for solaris sed.
	* packaging/sun-pkg/buildpkg: Do not run rpcgen, just remove the file
	  and let make do it.

2013-04-08  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Declare flush_ptr locally.

2013-04-08  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amflush.c
	  server-src/planner.c: NULL terminate the flush_ptr array.

2013-04-08  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c,
	  common-src/conffile.h: Change val_t.size to be a size_t.

2013-04-08  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c, common-src/amutil.c,
	  common-src/amutil.h, device-src/xfer-dest-taper-cacher.c,
	  device-src/xfer-dest-taper-splitter.c,
	  device-src/xfer-source-recovery.c, recover-src/extract_list.c,
	  server-src/dumper.c, server-src/xfer-dest-holding.c,
	  server-src/xfer-source-holding.c, xfer-src/dest-null.c,
	  xfer-src/element-glue.c,
	  xfer-src/filter-crc.c: Rename crc32 to crc32_add.

2013-04-05  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/glib-util.c: Use g_list_alloc.

2013-04-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amflush.c, server-src/cmdfile.c,
	  server-src/planner.c: Do not use g_ptr_array_new_full.

2013-03-28  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add set-no-reuse in the storage.
	* common-src/conffile.h: Add STORAGE_SET_NO_REUSE and
	  storage_get_set_no_reuse.
	* perl/Amanda/Config.swg: Add STORAGE_SET_NO_REUSE.
	* perl/Amanda/Storage.pm: Set $self->{'set_no_reuse'}.
	* perl/Amanda/Taper/Scribe.pm: Mark the tape as no-reuse and call the
	  changer no_reuse method if set-no-reuse is set in the storage.

2013-03-28  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Print the curl version to the debug file.
	* common-src/conffile.c, server-src/amcheck.c,
	  server-src/cmdfile.c, server-src/diskfile.c,
	  server-src/driver.c: Fix bug found by coverity.

2013-03-27  Jean-Louis Martineau <martineau@zmanda.com>
	* Many files: Add eject-volume, device-output-buffer-size,
	  autoflush, flush-threshold-dumped, flush-threshold-scheduled,
	  taperflush, report-use-media, report-next-media and interactivity to
	  the storage section.
	* perl/Amanda/Taper/Worker.pm: Add the storage name to the START
	  log line.

2013-03-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/cmdfile.c, server-src/cmdfile.h: Add files.

2013-03-25  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS, common-src/amflock.c, common-src/conffile.c,
	* common-src/conffile.h, common-src/glib-util.c,
	* common-src/glib-util.h, common-src/match.c,
	* installcheck/Amanda_Changer.pl, installcheck/Amanda_Taper_Scan.pl,
	* installcheck/Installcheck/Dumpcache.pm
	* installcheck/amcheck-device.pl, installcheck/amcheckdump.pl
	* installcheck/amreport.pl, installcheck/amrmtape.pl,
	* installcheck/catalogs/chunker-partial.cat,
	* installcheck/catalogs/normal.cat, installcheck/catalogs/quoted.cat,
	* installcheck/catalogs/taper-parallel-write.cat,
	* installcheck/taper.pl, perl/Amanda/Config.swg,
	* perl/Amanda/Disklist.swg, perl/Amanda/Report.pm,
	* perl/Amanda/Report/human.pm, perl/Amanda/Report/postscript.pm,
	* perl/Amanda/Storage.pm, perl/Amanda/Tapelist.swg,
	* perl/Amanda/Taper/Controller.pm, perl/Amanda/Taper/Protocol.pm,
	* perl/Amanda/Taper/Worker.pm, server-src/Makefile.am,
	* server-src/amadmin.c, server-src/amcheck-device.pl,
	* server-src/amcheck.c, server-src/amflush.c,
	* server-src/amindexd.c, server-src/amreport.pl,
	* server-src/amstatus.pl, server-src/amtrmidx.c,
	* server-src/cmdfile.c, server-src/cmdfile.h,
	* server-src/diskfile.c, server-src/diskfile.h,
	* server-src/driver.c, server-src/driverio.c,
	* server-src/driverio.h, server-src/planner.c,
	* server-src/server_util.c, server-src/server_util.h,
	* server-src/tapefile.c, server-src/tapefile.h,
	* server-src/taper.pl: Set multiple storage.
	Use a 'command_file' in the config directory to keep track of what
	must be done.


2013-03-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin_perl.pl: Add pool, storage and config arguments
	  to the add_tapelabel method.

2013-03-19  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: Improve error message,
	* perl/Amanda/Config.swg, perl/Amanda/Util.swg: EXTEND stack when
	 returning an array.

2013-03-18  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/glib-util.c: Checkrunning version of glib instaed of
	  compiled version.

2013-03-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/human.pm: typo.

2013-03-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Parse CRC in amdump file.

2013-03-08  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/taper.pl: PARTIAL reply can compute the CRC from
	  varying size.

2013-03-07  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/taper.pl: PARTIAL reply can compute the CRC from
	  varying size.

2013-03-06  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amutil.c: Renamed from common-src/util.c
	* common-src/amutil.h: Renamed from common-src/util.h
	  To avoid conflich with perl util.h
	* *.*: #include "amutil.h"

2013-03-06  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Storage.pm: Add file.
	* perl/Amanda/Policy.pm: Add file.

2013-03-06  Jean-Louis Martineau <martineau@zmanda.com>
	* Too many files to list them.
	* tape pool
	    label are assigned to a tape pool,
	    the 'labelstr' is used only for tape that are not in a pool.
	* retention policies
	    amanda will never rewrite a tape if it is required to satisfy a
	    retention policies.
	* storage, include many global setting.
	* tapelist file: include POOL, STORAGE and CONFIG.

2013-03-06  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amanda.h: Remove the debug variable.
	* common-src/util.c: Use maxint_t to parse the crc size.

2013-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndmjob_job.c: Call jndex_merge_environment() after reading
	  the index file.

2013-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.c: Add the device_sync_catalog function.
	* device-src/device.h: Add prototype for the sync_catalog function.
	* device-src/property.c: Add global properties
	* device-src/property.h: Add global properties
	* device-src/s3-device.c: Remove local properties.
	* device-src/xfer-dest-taper-splitter.c: indentation fix.
	* perl/Amanda/Changer.pm: Add the sync_catalog method.
	* perl/Amanda/Changer/multi.pm:Add the sync_catalog method.
	* perl/Amanda/Device.swg: Add the sync_catalog method.
	* server-src/amrmtape.pl: Do not die if erase() fail.
	* server-src/amtape.pl: Add the sync-catalog subcommand.
	* man/xml-source/amtape.8.xml: Document the sync-catalog subcommand.

2013-03-04  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/taper.pl: PARTIAL reply can compute the CRC from
	  varying size.

2013-02-26  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/ScanInventory.pm: Remove leading and trailing space in
	  message from interactivity module. Use $self->{'chg'} instead of
	  $self->{'changer'},
	* perl/Amanda/Taper/Scribe.pm: Fix perl warning.

2013-02-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/single.pm: Keep an inventory.
	* perl/Amanda/Interactivity/email.pm: Some fix.
	* perl/Amanda/Recovery/Scan.pm: Update the changer if required.
	* perl/Amanda/ScanInventory.pm: Update the changer if required.
	* installcheck/Amanda_Changer_single.pl: Test changes.
	* installcheck/Amanda_Recovery_Scan.pl: Test changes.

2013-02-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c: Do not empties what is al;ready read when
	  doing an includefile in the disklist.

2013-02-22  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c: Do not retry if !self->leom.
	* perl/Amanda/Taper/Protocol.pm: PARTIAL reply include de server-crc.

2013-02-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/logfile.c (make_logname): Fix race.

2013-02-22  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: close(compout).

2013-02-22  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Add debugging statement.
	* common-src/sockaddr-util.c (str_sockaddr_r, str_sockaddr_no_port_r):
	  New thread safe function.
	* common-src/sockaddr-util.h (str_sockaddr_r, str_sockaddr_no_port_r):
	  New prototype.
	* server-src/dumper.c: Open indirecttcp connection.
	* xfer-src/element-glue.c (do_directtcp_connect): Open indirecttcp
	  connection.

2013-02-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Handle holdingdisk NEVER and taperflush > 0.

2013-02-20  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amfeatures.c: Add fe_sendbackup_state amfeature.
	* common-src/amfeatures.h: Add fe_sendbackup_state amfeature.
	* client-src/client_util.c: Parse RECOVER-DUMP-STATE-FILE application
	  feature.
	* ndmp-src/ndma_noti_calls.c (ndma_send_logmsg): return if !from_conn.
	* perl/Amanda/Extract.pm: Parse recover-dump-state-file application
	  feature.
	* server-src/amfetchdump.pl: Pass --recover-dump-state-file to
	  application.
	* server-src/driver.c (short_dump_state): Add directq.
	* server-src/dumper.c: Parse 'sendbackup state' line and put them in
	  the dump state file.

2013-02-18  Jean-Louis Martineau <martineau@zmanda.com>
	* gnulib/regenerate/regenerate: Add the nanosleep module.
	* config/gnulib/dup2.m4, config/gnulib/gnulib-cache.m4,
	  config/gnulib/gnulib-comp.m4, config/gnulib/nanosleep.m4,
	  config/gnulib/select.m4, config/gnulib/sigaction.m4,
	  config/gnulib/signalblocking.m4,
	  config/gnulib/sys_select_h.m4: New config files.
	* gnulib/Makefile.am: Update for new modules.
	* gnulib/alloca.c, gnulib/dup2.c, gnulib/intprops.h,
	  gnulib/nanosleep.c, gnulib/select.c, gnulib/sig-handler.c,
	  gnulib/sig-handler.h, gnulib/sigaction.c, gnulib/sigprocmask.c,
	  gnulib/sys_select.in.h: New files.

2013-02-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Do not crash if stdin if closed while a backup
	  is running.

2013-02-11  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/logfile.c (get_logname): Return a new allocated string.
	* server-src/logfile.c (set_logname): Store a new allocated string.

2013-02-11  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/logfile.c: Check return of symlink.

2013-02-11  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Check return of ftruncate.

2013-02-11  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Deprecate usetimestamps, it is always "yes"
	* example/amanda.conf.in: Remove usetimestamps.
	* example/template.d/advanced.conf.in: Remove usetimestamps.
	* man/xml-source/amanda.conf.5.xml: Deprecate usetimestamps.
	* server-src/logfile.c (make_logname, get_logname, set_logname) New
	  function.
	* server-src/logfile.h (make_logname, get_logname, set_logname) Add
	  prototype.
	* perl/Amanda/Logfile.swg (make_logname, get_logname, set_logname) Add
	  function.
	* server-src/amdump.pl, server-src/amflush.c, server-src/amvault.pl:
	  Create a log.<datastamps>.0 file and use it. Do not check for a
	  'log' file.
	* server-src/amcheck.c: Do not check for a 'log' file.
	* server-src/driverio.c: Pass --log-filename argument to sub process.
	* server-src/driverio.h: add log_filename variable.
	* server-src/chunker.pl, server-src/driver.c,
	  server-src/dumper.c, server-src/planner.c,
	  server-src/taper.pl: Use logfile from --log-filename argument.
	* installcheck/Amanda_Config.pl, installcheck/Amanda_Logfile.pl,
	  installcheck/amdump.pl, installcheck/chunker.pl,
	  installcheck/taper.pl: Fix.

2013-02-11  Jean-Louis Martineau <martineau@zmanda.com>
	* Many Files: Compute CRC on backup and verify it on restore.

2013-02-11  Jean-Louis Martineau <martineau@zmanda.com>
	* autogen: Invoke automake with --add-missing.
	* config/compile, config/config.guess, config/config.sub,
	* config/depcomp, config/install-sh, config/missing,
	* config/mkinstalldirs, config/ylwrap: Upgrade from automake-1.11.6

2013-02-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/disk.pm: Return slot with invalid slot.
	* perl/Amanda/Changer/robot.pm: Return slot with invalid slot.
	* server-src/amtape.pl: Continue on invalid slot.

2013-02-07  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/amdump_client.pl: Pass the -o arguments to amservice.

2013-02-06  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/0_setupcache.pl: Rename from =setupcache.pl
	* installcheck/Makefile.am: Ditto.

2013-02-05  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: s/g_slist_free_full/slist_free_full/

2013-01-29  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amraw.pl: Check return value of POSIX::open.

2013-01-25  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Fix memory leak and check return value of
	  mkdir.
	* device-src/s3.c: Fix dereferencing NULL pointer.

2013-01-25  Jean-Louis Martineau <martineau@zmanda.com>
	* gnulib/regenerate/regenerate, config/gnulib/gnulib-cache.m4,
	  config/gnulib/gnulib-comp.m4, gnulib/Makefile.am: Remove ftruncate.

2013-01-25  Jean-Louis Martineau <martineau@zmanda.com>
	* config/snippet: Add directory.

2013-01-25  Jean-Louis Martineau <martineau@zmanda.com>
	* gnulib/* config/gnulib/*: UPgrade gnulib to
	  09b8fa6cb737f6e091931c494cbd56d12b3ad08d.
	* gnulib/regenerate/regenerate: Remove ftruncate module.
	* ndmp-src/Makefile.am: Workaround to '#include "config.h"' in
	  ndmp?_xdr.c

2013-01-24  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Use nanosleep.

2013-01-24  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c: Add a --prepend-prefix argument.
	* common-src/conffile.c (config_dir_relative): Prepend prepend-prefix
	  to path.
	* common-src/conffile.h: extern char *prepend_prefix;

2013-01-24  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Do not use a default DB.

2013-01-23  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: Amanda/Feature.c depend on
	  ../common-src/amfeatures.h

2013-01-22  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Check result of fgets.

2013-01-22  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Installcheck/Dumpcache.pm: Fix for exit status of
	  amdump.

2013-01-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amdump.pl: Exit with the ored value of the exit code of
	  all subprocess.

2013-01-21  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Keep a catalog of the labels.
	  New READ-FROM-GLACIER and TRANSITION-TO-GLACIER properties.
	  Implement set_reuse and set_no_reuse to remove/add lifecycle.
	* device-src/device.c: New device_have_set_reuse and device_set_reuse
	  functions.
	* device-src/device.h: new set_reuse and set_no_reuse.
	* device-src/s3.c: Implement init_restore, get and set lifecycle.
	* device-src/s3.h: Lifecycle.
	* man/xml-source/amanda-devices.7.xml: Document new READ-FROM-GLACIER
	  and TRANSITION-TO-GLACIER S3 properties.
	* perl/Amanda/Changer.pm: Add set_reuse and set_no_reuse method.
	* perl/Amanda/Changer/multi.pm: Implement set_reuse and set_no_reuse.
	* perl/Amanda/Device.swg: Add set_reuse and set_no_reuse method.
	* server-src/Makefile.am (amlibexec_SCRIPTS_PERL) Add amadmin_perl.
	* server-src/amadmin.c: Call perl program for the reuse and no-reuse
	  commands.
	* server-src/amadmin_perl.pl: Implementthe reuse and no-reuse commands
	  of amadmin.

2013-01-21  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amraw.pl: Correctly parse the --directory argument.

2013-01-16  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.h (struct tcp_conn): Add child_watch.
	* common-src/rsh-security.c: Add a child_watch for the rsh process.
	* common-src/ssh-security.c: Add a child_watch for the ssh process.

2013-01-15  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Fix for chunked transfer-encoding.

2013-01-15  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.h: Add all S3 error.
	* perl/Amanda/ScanInventory.pm: Set err.

2013-01-14  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add CONF_REPORT_FORMAT.
	* common-src/conffile.h: Add CNF_REPORT_FORMAT.
	* man/xml-source/amanda.conf.5.xml: Document report-foramt.
	* man/xml-source/amreport.8.xml: Document new --format argument.
	* perl/Amanda/Config.swg: Add CNF_REPORT_FORMAT.
	* perl/Amanda/Report.pm (xml_output): Remove function.
	* perl/Amanda/Report/human.pm: change api
	* perl/Amanda/Report/json.pm: New report format.
	* perl/Amanda/Report/json_raw.pm: New report format.
	* perl/Amanda/Report/xml.pm: Change api
	* perl/Makefile.am (AmandaReport_DATA): Add Amanda/Report/json.pm and
	  Amanda/Report/json_raw.pm
	* server-src/amreport.pl: New --format argument, change API to call
	  module.

2013-01-11  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/Makefile.am, client-src/Makefile.am,
	  installcheck/Makefile.am, server-src/Makefile.am: Use '+=' to set
	  DISTCLEANFILES
	* gnulib/regenerate/no-error.patch: Improved patch.
	* gnulib/Makefile.am: Applied patch.

2013-01-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Extract.pm: Change Zmanda licensing to GPLv2+.

2013-01-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/JSON/Config.pm: Fix perl warning.

2013-01-08  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndmjob_args.c: Handle more than 1000 arguments.

2013-01-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Set labelstr template from autolabel.
	* perl/Amanda/ScanInventory.pm: Use the labelstr template.
	* perl/Amanda/Taper/Scan.pm: Check for match_labelstr.

2013-01-07  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scan.pm (oldest_reusable_volume): Check the
	  labelstr.
	* installcheck/Amanda_Taper_Scan.pl: Test it.

2013-01-04  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amrmtape.pl: Do not check the 'log' file.

2013-01-03  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Return slot in error for:
		the requested volume is in drive $drive, which this
		changer instance cannot access
	* perl/Amanda/Taper/Scan/traditional.pm: Continue scan if this error.
	* perl/Amanda/Taper/Scribe.pm: log message.
	* installcheck/Amanda_Taper_Scan_lexical.pl,
	  installcheck/Amanda_Taper_Scan_oldest.pl,
	  installcheck/Amanda_Taper_Scan_traditional.pl: Check it.

2013-01-03  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c, device-src/s3.c: hanlde chunked
	  transfer-encoding,
	* device-src/s3.h (s3_upload): Add chunked argument.
	* man/xml-source/amanda-devices.7.xml: Document new CHUNKER s3
	  device-property.

2013-01-03  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Display the size restored.

2012-12-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amrmtape.pl: Add the pid on the temporary filename.

2012-12-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c (make_amanda_tmpdir): New function to create the
	  AMANDA_TMPDIR directory.
	* common-src/util.h (make_amanda_tmpdir): Add prototype.
	* common-src/debug.c (debug_open): Call make_amanda_tmpdir().


2012-12-24  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (tape_action): Do not count free tape space if
	  exceed max-dle-by-volume.

2012-12-19  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add a new RETRY-DUMP setting in a dumptype.
	* common-src/conffile.h: Define DUMPTYPE_RETRY_DUMP.
	* man/xml-source/amanda.conf.5.xml: Document it
	* perl/Amanda/Config.swg: Add DUMPTYPE_RETRY_DUMP.
	* server-src/diskfile.h (disk_t): Add retry_dump.
	* server-src/diskfile.c: Set disk->retry_dump.
	* server-src/driver.c: Use retry_dump
	* NEWS: Add it.

2012-12-19  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS: Add MATCH-AUTOLABEL labelstr.

2012-12-19  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: labelstr can be the MATCH-AUTOLABEL keyword.
	  Add all hook to handle the new labelstr_t typedef.
	* common-src/conffile.h: Add new labelstr_t typedef.
	* perl/Amanda/Config.swg: Handle new labelstr_t typedef.
	* common-src/match.c (match_labelstr): New method. The labelstr
	  template can have all autolabel variable.
	* common-src/match.h (match_labelstr): Add prototype.
	* perl/Amanda/Util.swg: Add match_labelstr and the required typemap.
	* installcheck/Amanda_Changer.pl: Remove test for emoved Changer method
	  volume_is_labelable
	* man/xml-source/amanda.conf.5.xml: Explain new labelstr setting
	* perl/Amanda/Changer.pm: Remove volume_is_labelable method, handle
	  new autolabel setting, use match_labelstr.
	* perl/Amanda/Changer/disk.pm: Add meta to the reservation.
	* perl/Amanda/ScanInventory.pm, perl/Amanda/Taper/Scan/lexical.pm,
	* perl/Amanda/Taper/Scan/oldest.pm,
	* perl/Amanda/Taper/Scan/traditional.pm, server-src/amlabel.pl,
	* server-src/amtape.pl, server-src/tapefile.c: Handle new autolabel
	  setting, use match_labelstr.

2012-12-18  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Fix for older perl.

2012-12-18  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS, ReleaseNotes: Changes in 3.3.3

2012-12-18  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Worker.pm: Ignore duplicate DONE/FAILED messages.

2012-12-14  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: Pass the %params to changer.
	* perl/Amanda/Changer/aggregate.pm: Pass the %params to child changer.
	* perl/Amanda/Changer/aggregate.pm (make_new_tape_label,
	  make_new_meta_label): Call the child changer.

2012-12-14  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amtape.pl: Add a verify subcommand.
	* man/xml-source/amtape.8.xml: Document the verify subcommand.
	* perl/Amanda/Changer.pm: Add default verify method.
	* perl/Amanda/Changer/robot.pm (verify): Verify the drive and device
	  matches.
	* perl/Amanda/Device.pod: Typo.

2012-12-13 Dan Locks <dwlocks@zmanda.com>
	* packaging/common/post_inst_functions.sh: revoke rw permissions for
	  group and other
	* packaging/common/post_rm_functions.sh: fix function name to match
	  usage.
	* packaging/common/test_sh_libs.sh: update test.

2012-12-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amrmtape.pl: Die if opening CURINFO for writing fail.

2012-12-12 Dan Locks <dwlocks@zmanda.com>
	* packaging/common/post_inst_functions.sh: don't use uuencode -m for
	  solaris 8 compatibility.

2012-12-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/multi.pm, server-src/amcheck-device.pl: Fix perl
	  warning.

2012-12-10  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/logfile.c (log_rename): Donot abort if the log do not
	  exists.

2012-12-10  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda-devices.7.xml: Typo, s/SWITF/SWIFT/.

2012-12-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: Log FAILED if nothing is written to
	  tape.
	* server-src/amstatus.pl: Check ntape is defined.

2012-12-07 Dan Locks <dwlocks@zmanda.com>
	* packaging/common/post_inst_functions.sh: use amandausers's .gnupg/
	  instead of installing user's, and suppress warnings about
	  permissions.

2012-12-07 Dan Locks <dwlocks@zmanda.com>
	* common_z/post_inst_functions.sh: head and tail invocation may only
	  use "-#", not "-n #" for solaris 8 compatibility

2012-12-07  Jean-Louis Martineau <martineau@zmanda.com>
	* contrib/convert-zd-mtx-to-robot.sh: set tpchanger instead of
	  tapedev.

2012-12-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Fix 32 bits overflow.

2012-12-06 Dan Locks <dwlocks@zmanda.com>
	* packaging/common/post_inst_functions.sh: use --passphrase-fd to
	  support older versions of gpg.

2012-12-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Parse new PORT-DUMP format.

2012-12-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Fix exit status.
	* installcheck/amstatus.pl: Fix for previous patch.

2012-12-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Show taping status after dump failure.

2012-12-05  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/taper.pl: Add check for previous patch.

2012-12-05  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Worker.pm: Do it at the right place.

2012-12-05  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Worker.pm: Use header is_partial to get dump
	  status for FILE-WRITE.

2012-12-04 Dan Locks <dwlocks@zmanda.com>
	* common_z/post_inst_functions.sh: in get_random_lines(): fix line padding, use dd instead of
	  head -c
	* common_z/test_common.sh: fix quoting so blank test condition is
	  still printed.

2012-12-04  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: print script output for backup with the
	  "| " prefix.

2012-12-04  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amvault.pl: Missing return statement.

2012-12-03 Dan Locks <dwlocks@zmanda.com>
	* packaging/common/post_inst_functions.sh: add get_random_lines() and
	  use it to generate random passwords
	* packaging/common/test_sh_libs.sh: test and use get_random_lines(),
	  use static log file name, enforce order on tests using
	  (get_random_lines, create_gnupg, create_ampassphrase, and
	  create_amkey.
	* packaging/deb/postinst.src, packaging/rpm/amanda.spec.src,
	  packaging/sun-pkg/client/postinstall.src: use command -v instead of
	  unportable which.

2012-12-03  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/logfile.c (get_logline): Parse each line separately.

2012-11-28  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add a SRC-IP in the interface section.
	* common-src/conffile.h: Define INTER_SRC_IP.
	* man/xml-source/amanda.conf.5.xml: Add src-ip.
	* common-src/sockaddr-util.h: Define SU_SET_INADDR.
	* common-src/stream.c (stream_client_internal, stream_client_privileged,
	  stream_client_internal): Add a src_ip argument.
	* common-src/stream.h: Changed prototype,
	* client-src/sendbackup.c, common-src/bsd-security.c,
	  common-src/bsdtcp-security.c, common-src/security-util.c,
	  oldrecover-src/amrecover.c, oldrecover-src/extract_list.c: Use new
	  stream_client.
	* server-src/driverio.c (dumper_cmd): Add src-ip in PORT-WRITE command.
	* server-src/dumper.c: Parse src-ip.
	* server-src/server_util.c (amhost_get_security_conf): Return src-ip.

2012-11-28  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Force new connection after RequestTimeout.

2012-11-24 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec.src: fix comparison operator

2012-11-23  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Config.pl, installcheck/Amanda_DB_Catalog.pl,
	  installcheck/Installcheck/Config.pm, perl/Amanda/Report/human.pm,
	  perl/Amanda/Taper/Worker.pm, server-src/amtape.pl: Fix perl warning.

2012-11-23 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec.src: fix awk SuSE detection syntax

2012-11-23 Dan Locks <dwlocks@zmanda.com>
	* common_z/post_inst_functions.sh: add --no-use-agent option to gpg
	  invocation to avoid problems with uninitialized gpg keyrings.

2012-11-23  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/null-device.c: Return DEVICE_STATUS_VOLUME_UNLABELED |
	  DEVICE_STATUS_VOLUME_ERROR on open for reading.
	* installcheck/amdevcheck.pl: Fix.

2012-11-22  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/flags.m4: Swig is always compiled with
	  -Wno-deprecated-declarations
	* common-src/amflock.h: s/file_lock_/file_lock/
	* device-src/directtcp-connection.h:
	  s/DirectTCPConnection_/DirectTCPConnection/
	* ndmp-src/ndmpconnobj.h: s/NDMPConnection_/NDMPConnection/
	* server-src/cmdline.h: s/dumpspec_s/dumpspec_t/

2012-11-22  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Cmdline.swg: Undo previous patch.

2012-11-22  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/libs.m4: remove deprecated warning for glib > 2.34.0
	* perl/Amanda/Cmdline.swg: s/dumpspec_t/dumpspec_s/

2012-11-22  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: return 'all slots are empty'.
	* perl/Amanda/Taper/Scan/traditional.pm: Call _user_msg on error.

2012-11-22  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Keep a different current_slot for each
	  config.

2012-11-21  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsd-security.c (stream_read_callback): Do not cancel the
	  event in case of successful read.
	* common-src/security-util.c: Typo.

2012-11-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amfetchdump.pl: Add --init --no-restore arguments.
	* man/xml-source/amfetchdump.8.xml: Document them.

2012-11-15  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/aggregate.pm, perl/Amanda/Changer/disk.pm,
	  perl/Amanda/Changer/multi.pm,
	  perl/Amanda/Changer/robot.pm: Add LOCK-TIMEOUT property.
	* perl/Amanda/Changer.pm: Handle lock-timeout property.
	* man/xml-source/amanda-changers.7.xml: Document new LOCK-TIMEOUT
	  properties.

2012-11-14  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: Password can be encoded.

2012-11-14  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/human.pm: Do not print failure for config
	  setting.
	* perl/Amanda/Taper/Worker.pm: Send TAPE-CONFIG.
	* server-src/amflush.c: Do not add L_DISK if nothing to flush.
	* server-src/amstatus.pl: Parse TAPE-CONFIG and print appropriate
	  message.
	* server-src/driver.c: Parse TAPE-CONFIG.
	* installcheck/taper.pl: Check new TAPE-CONFIG in protocol.
	* installcheck/catalogs/amflush.cat: Fix for new format.

2012-11-05  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda-devices.7.xml: Add 'OAUTH2' and 'CASTOR' for
	  value of the storage-api property.

2012-10-25  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/event.c: Disable -Wmissing-field-initializers when using
	  G_STATIC_MUTEX_INIT because of warning with glib-2.32.

2012-10-25  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amfetchdump.8.xml: Document --extract, --directory,
	  --data-path and --application-property.

2012-10-25  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/event.c: Use a GStaticMutex.

2012-10-25  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndmpconnobj.c: Use a GStaticMutex.

2012-10-24  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Device.pl: Fix count.

2012-10-23  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndmpconnobj.c: Use event_create and event_activate.
	  Create static notify_data_t.

2012-10-23  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/event.c (event_create, event_activate): New function, it
	  split event_register in two.
	* common-src/event.h (event_create, event_activate): New prototype.

2012-10-22  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.c (device_accept, device_connect,
	  device_write_from_connection, device_read_to_connection): They take
	  (int *, GMutex *, GCond  *) new arguments to be able to interupt
	  them.
	* device-src/device.h: Change prototype.
	* device-src/ndmp-device.c: Implement new functionnality.
	* device-src/xfer-dest-taper-directtcp.c,
	  device-src/xfer-source-recovery.c: Use the new API.
	* installcheck/Amanda_Device.pl: Remove directtcp test.
	* ndmp-src/ndmpconnobj.c (ndmp_connection_wait_for_notify_with_cond):
	  Allow to be cancelled.
	* ndmp-src/ndmpconnobj.h: Change prototype.
	* perl/Amanda/Device.swg: Remove accept, connect,
	  write_from_connection and read-to_connection.

2012-10-22  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm (abort_setup): New method.
	* perl/Amanda/Taper/Scribe.pm (_dump_done): Return if $dump_cb is not
	  set.
	* perl/Amanda/Taper/Worker.pm: Call abort_setup if setup failed.

2012-10-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amfetchdump.pl: typo, remove '.' in argv.

2012-10-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c (do_dump): Make the header file only
	  HEADER_DONE.

2012-10-22  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Controller.pm: Reverse taper/driver in log.

2012-10-22  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndmjob_args.c (handle_long_option): Close the fd.

2012-10-22  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/event.c: Make the code thread safe.

2012-10-19  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/match.c: Handle '=' as first characters of expression.
	* man/xml-source/amanda-match.7.xml: Document new '=' as first
	  character of expression.
	* man/xml-source/amadmin.8.xml, man/xml-source/amcheck.8.xml,
	* man/xml-source/amdump.8.xml, man/xml-source/amfetchdump.8.xml,
	* man/xml-source/amflush.8.xml, man/xml-source/amrestore.8.xml,
	* man/xml-source/amvault.8.xml: Document new '--exact-match' argument.
	* perl/Amanda/Cmdline.swg: Add CMDLINE_EXACT_MATCH
	* server-src/diskfile.c (match_disklist, match_dumpfile):
	  New exact_match argument.
	* server-src/diskfile.h (match_disklist, match_dumpfile):
	  Change prototype.
	* server-src/cmdline.c (cmdline_parse_dumpspecs): CMDLINE_EXACT_MATCH.
	* server-src/cmdline.h: New CMDLINE_EXACT_MATCH.
	* server-src/amadmin.c, server-src/amcheck.c,
	  server-src/amdump.pl, server-src/amfetchdump.pl,
	  server-src/amflush.c, server-src/amrestore.pl,
	  server-src/amvault.pl, server-src/planner.c: Add --exact-match
	  argument.
	* installcheck/Amanda_Cmdline.pl: Check '='.
	* installcheck/amadmin.pl: Check --exact-match and '='.

2012-10-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amfetchdump.pl: Fix for compressed dump.

2012-10-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amfetchdump.pl: Add [--extract --directory directory
			[--data-path (amanda|directtcp)]
			[--application-property='NAME=VALUE']*]
	* man/xml-source/amfetchdump.8.xml: Document them.
	* perl/Amanda/Extract.pm: New utilities torun application from perl.
	* perl/Makefile.am: Add Amanda/Extract.pm
	* perl/Amanda/Recovery/Clerk.pm: Small fix.

2012-10-18  Jean-Louis Martineau <martineau@zmanda.com>
	* All files: Change Zmanda licensing to GPLv2+ and LGPLv2+, Add Zmanda
	  copyright to files modified by Zmanda.

2012-10-15  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: New REPORT-USE-MEDIA and REPORT-NEXT-MEDIA.
	* common-src/conffile.h: And CNF_REPORT_USE_MEDIA and
	  CNF_REPORT_NEXT_MEDIA
	* man/xml-source/amanda.conf.5.xml: Document REPORT-USE-MEDIA and
	  REPORT-NEXT-MEDIA.
	* perl/Amanda/Config.swg: Add CNF_REPORT_USE_MEDIA and
	  CNF_REPORT_NEXT_MEDIA.
	* perl/Amanda/Report/human.pm: Use them.

2012-10-15  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.c (device_init_seek_file): New method to do setup
	  before a seek_file.
	* device-src/device.h (init_seek_file): Add method.
	* perl/Amanda/Device.pod (init_seek_file): Document it.
	* perl/Amanda/Device.swg (init_seek_file): New method.

2012-10-15  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.c: Load a device driver at run time.

2012-10-15  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndma_comm_session.c, perl/Amanda/Util.swg: Use inet_ntop
	  instead of inet_ntoa.

2012-10-15  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amanda.h: Remove MAX_DUMPERS.
	* common-src/conffile.c (validate_inparallel): Remov function.
	* example/amanda.conf.in: Remove comment for MAX_DUMPERS.
	* server-src/driverio.c: Allocation dynamic table for dmptable and
	  chktable.
	* server-src/driverio.h (init_driverio): New prototype.
	* server-src/driver.c: Use new init_driverio.

2012-10-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl (showtime): Use calandar days.

2012-10-12  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Always set CURLOPT_CAINFO.

2012-10-12  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Worker.pm: Add data_path to %splitting_args.
	* perl/Amanda/Taper/Scribe.pm: Correctly set part_* for DIRECTTCP
	  data_path.

2012-10-11  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Add a timeout.
	* common-src/event.c: List all event in debug mode.
	* common-src/security-util.c: Call the accept_fn on connection close.

2012-10-11  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amcryptsimple.pl: Add '-z 0' to gpg argument when
	  encrypting.

2012-10-11  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amservice.c, device-src/ndmp-device.c,
	  server-src/dumper.c, xfer-src/xfer-test.c: Fix bug found by Coverity.

2012-10-10  Jean-Louis Martineau <martineau@zmanda.com>
	* */*.c: Fix bug found by Coverity.

2012-10-10  Jean-Louis Martineau <martineau@zmanda.com>
	* */*.c: Fix bug found by Coverity.

2012-10-09  Jean-Louis Martineau <martineau@zmanda.com>
	* oldrecover-src/amrecover.c: Solaris do not have sa_restorer.

2012-10-09  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c, amar-src/amarchiver.c,
	  client-src/selfcheck.c, common-src/bsd-security.c,
	  common-src/util.c, device-src/device.c,
	  device-src/ndmp-device.c, device-src/s3.c,
	  device-src/tape-device.c, oldrecover-src/amrecover.c,
	  recover-src/extract_list.c, recover-src/set_commands.c,
	  server-src/diskfile.c, server-src/driver.c,
	  server-src/planner.c: Fix bug found by Coverity.

2012-10-09  Jean-Louis Martineau <martineau@zmanda.com>
	* example/Makefile.am: Build amanda-CAStor.conf from
	  amanda-CAStor.conf.in
	* example/template.d/amanda-CAStor.conf: Remove
	* example/template.d/amanda-CAStor.conf.in: New file.

2012-10-05  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Change the security_stream_read callback
	  to not release the event if the read succeed.
	* amandad-src/amandad.c, common-src/amservice.c,
	  recover-src/extract_list.c, server-src/dumper.c: Do not restart
	  security_stream_read if the read succeeded.
	* server-src/dumper.c: Handle timeout without starting too much event.

2012-10-05  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c: Solaris do not have GMT_WR_PROT.

2012-10-05  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.c (device_check_writable): New method.
	* device-src/device.h (device_check_writable): Prototype.
	* device-src/tape-device.c (tape_device_check_writable): Implement new
	  method.
	* perl/Amanda/Device.swg (check_writable): New method.
	* server-src/amcheck-device.pl: Call check_writable.
	* server-src/amtape.pl: Call check_writable.

2012-10-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (tape_action): Fix handling of
	  taper-parallel-write.
	* server-src/driver.c: Go in degraded mode only after all taper failed.

2012-10-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Fix for TAKE-SCRIBE-FROM command, handle
	  multiple taper status files.

2012-10-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Missing space.

2012-10-02  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c, device-src/s3-device.c: Typo.

2012-10-02  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Handle multi-part write
	* device-src/s3.c: Handle multi-part write
	* device-src/s3.h: Handle multi-part write
	* man/xml-source/amanda-devices.7.xml: Document new
	  S3_MULTI_PART_UPLOAD property.
	* perl/Amanda/Recovery/Clerk.pm: do not call seek_file two times.

2012-10-02  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Fix for (eof) from dumper/chunker or taper.

2012-09-27 Dan Locks <dwlocks@zmanda.com>
	* Bug reported by Jon LaBadie for fedora 17: spurious requirement
	  of libtermcap.so.2.
	* packaging/rpm/amanda.spec.src: massage fedora detection to remove
	  spurious requirement

2012-09-27  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Fix reps and reps_bucket name.

2012-09-26  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (get_multiplier): Fix for for CONF_END.

2012-09-25  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/xfer-dest-taper-splitter.c: Do not increase partnum if
	  the size is 0.
	* installcheck/Amanda_Xfer.pl: Fix partnum check.
	* perl/Amanda/Taper/Scribe.pm: Improve debugging.

2012-09-25  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amflock.c, common-src/util.c,
	  perl/Amanda/Header.swg, perl/Amanda/Taper/Worker.pm,
	  perl/Amanda/Util.swg,
	  server-src/xfer-dest-holding.c: Fix small memory leak.

2012-09-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scan/lexical.pm,
	  perl/Amanda/Taper/Scan/oldest.pm: Fix perl warning.

2012-09-24  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Fix for header not read.

2012-09-24  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml (part-size): Improve documentation.

2012-09-24  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm (device_started): Can get non-numeric
	result.

2012-09-21  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/tapelist.5.xml: Add BLOCKSIZE.

2012-09-21  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Tapelist.swg: die() if tapelist is not valid.
	* server-src/tapefile.c: exit if tapelist is not valid.
	* installcheck/Amanda_Tapelist.pl: Add more check.
	* perl/Amanda/Changer.pm: Add $err->device
	* perl/Amanda/Changer/robot.pm: Return error if barcode do not match
	  with tapelist.
	* server-src/amtape.pl (inventory): Print if barcode do not match.

2012-09-21  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Makefile.am (catalogs): Add
	  catalogs/taper-parallel-write.cat.

2012-09-21  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Fix date_sync_regex.

2012-09-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Fix for taper-parallel-write > 1.
	* installcheck/amstatus.pl: Checkit.
	* installcheck/catalogs/taper-parallel-write.cat: New catalog.

2012-09-19  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Castor require libcurl 7.19.1.

2012-09-18  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c, device-src/s3.c: Castor require libcurl
	  7.19.1.

2012-09-17  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c, device-src/s3.c
	  device-src/s3.h: Add CASTOR S3_API.
	* example/template.d/amanda-CAStor.conf: Example config for castor.

2012-09-17  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Set gnutar_listdir after the config for
	  the backup set is read.

2012-09-17  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amxml.c (amstart_element): Set data_user->dle->property.

2012-09-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheckdump.pl: s/correclty/correctly/g

2012-08-24  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Correctly set f_type and device_error
	  in state.
	* perl/Amanda/ScanInventory.pm (volume_is_labelable): Set labelstr for
	  does_not_match_labelstr.
	* perl/Amanda/Taper/Scan/lexical.pm,
	  perl/Amanda/Taper/Scan/oldest.pm (analyze): Check label match
	  labelstr.
	* server-src/amcheck-device.pl (_user_msg_fn): print message when res
	  is not set.
	* server-src/amtape.pl: Fix for device returning empty error.
	* installcheck/Amanda_Changer_ndmp.pl,
	  installcheck/Amanda_Changer_robot.pl: Fix for f_type set.

2012-08-24  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/gnutar.pl: fc17 gnutar is like fc15.

2012-08-24  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Device.pl: Print error if nc, nc6 or netcat is
	not installed.

2012-08-23  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/disk.pm: Use the changerfile for the statefile.

2012-08-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amdump.pl: Create amdump.<timestamp>, amdump and amdump.1
	  are maintained as symlink.

2012-08-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c (handle_result): Correctly log some error.

2012-07-24  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: New REUSE-CONNECTION property.
	* device-src/s3.c: Do not reuse connection if REUSE-CONNECTION is
	  FALSE.
	* device-src/s3.h (s3_open): New reuse_connection argument.
	* man/xml-source/amanda-devices.7.xml: Document REUSE-CONNECTION
	  property.
	* ReleaseNotes, NEWS: Add REUSE-CONNECTION.

2012-07-24  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Fix a big memory leak.

2012-07-23  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Typo.

2012-07-23  Jean-Louis Martineau <martineau@zmanda.com>
	* ReleaseNotes, NEWS: Add new features in 3.3.2.

2012-07-20 Dan Locks <dwlocks@zmanda.com>
	* perl/Amanda/Feature.pod, perl/Amanda/MainLoop.swg,
	  perl/Amanda/Script.pm, perl/Amanda/NDMP.pod,
	  perl/Amanda/Logfile.swg, perl/Amanda/Curinfo.pm,
	  perl/Amanda/Changer.pm, perl/Amanda/Tests.pod,
	  perl/Amanda/Application.pod, perl/Amanda/Debug.swg,
	  perl/Amanda/Disklist.swg, perl/Amanda/Report.pm,
	  perl/Amanda/Config.pod, perl/Amanda/Header.swg,
	  perl/Amanda/Feature.swg, perl/Amanda/BigIntCompat.pm,
	  perl/Amanda/NDMP.swg, perl/Amanda/Recovery/Scan.pm,
	  perl/Amanda/Recovery/Planner.pm, perl/Amanda/Recovery/Clerk.pm,
	  perl/Amanda/Util.pod, perl/Amanda/Tests.swg,
	  perl/Amanda/Archive.pod, perl/Amanda/Application.swg,
	  perl/Amanda/Config.swg, perl/Amanda/Curinfo/Info.pm,
	  perl/Amanda/Tapelist.pod, perl/Amanda/Changer/disk.pm,
	  perl/Amanda/Changer/multi.pm, perl/Amanda/Changer/null.pm,
	  perl/Amanda/Changer/ndmp.pm, perl/Amanda/Changer/rait.pm,
	  perl/Amanda/Changer/single.pm,
	  perl/Amanda/Changer/robot.pm, perl/Amanda/Changer/aggregate.pm,
	  perl/Amanda/Report/human.pm, perl/Amanda/Report/postscript.pm,
	  perl/Amanda/Report/xml.pm, perl/Amanda/IPC/Binary.swg,
	  perl/Amanda/IPC/LineProtocol.pm, perl/Amanda/IPC/Binary.pod,
	  perl/Amanda/XferServer.pod, perl/Amanda/Util.swg,
	  perl/Amanda/ScanInventory.pm, perl/Amanda/Script_App.pm,
	  perl/Amanda/Device.pod, perl/Amanda/Archive.swg,
	  perl/Amanda/Tapelist.swg, perl/Amanda/Xfer.pod,
	  perl/Amanda/DB/Catalog.pm, perl/Amanda/Process.pm,
	  perl/Amanda/XferServer.swg, perl/Amanda/Constants.pm.in,
	  perl/Amanda/Cmdline.pod, perl/Amanda/Device.swg,
	  perl/Amanda/Interactivity/stdin.pm,
	  perl/Amanda/Interactivity/email.pm,
	  perl/Amanda/Interactivity/tty_email.pm,
	  perl/Amanda/Interactivity/tty.pm, perl/Amanda/MainLoop.pod,
	  perl/Amanda/Holding.pm, perl/Amanda/Paths.pm.in,
	  perl/Amanda/Logfile.pod, perl/Amanda/Application/Zfs.pm,
	  perl/Amanda/Xfer.swg, perl/Amanda/Debug.pod,
	  perl/Amanda/Disklist.pod, perl/Amanda/Interactivity.pm,
	  perl/Amanda/Header.pod, perl/Amanda/Cmdline.swg,
	  perl/Amanda/ClientService.pm, perl/Amanda/Taper/Protocol.pm,
	  perl/Amanda/Taper/Controller.pm, perl/Amanda/Taper/Scan.pm,
	  perl/Amanda/Taper/Scribe.pm, perl/Amanda/Taper/Scan/oldest.pm,
	  perl/Amanda/Taper/Scan/traditional.pm,
	  perl/Amanda/Taper/Scan/lexical.pm,
	  perl/Amanda/Taper/Worker.pm, perl/amglue/objwrap.c,
	  perl/amglue/bigint.c, perl/amglue/amglue.h,
	  perl/amglue/dumpspecs.swg, perl/amglue/exports.swg,
	  perl/amglue/amglue.swg, perl/amglue/constants.swg,
	  perl/amglue/glib.swg, perl/amglue/filehandles.swg,
	  perl/amglue/integers.swg, perl/amglue/xferwrap.c,
	  perl/amglue/directtcp.swg, perl/amglue/source.c,
	  perl/amglue/ghashtable.c, perl/make_html.pl,
	  installcheck/amoverview.pl, installcheck/Amanda_Holding.pl,
	  installcheck/Amanda_Disklist.pl,
	  installcheck/Amanda_Taper_Scan_oldest.pl,
	  installcheck/amlabel.pl, installcheck/Amanda_NDMP.pl,
	  installcheck/amflush.pl, installcheck/Amanda_ClientService.pl,
	  installcheck/run-ndmp.pl, installcheck/amstatus.pl,
	  installcheck/Amanda_Taper_Scribe.pl,
	  installcheck/Amanda_Recovery_Scan.pl,
	  installcheck/Amanda_Curinfo.pl, installcheck/Amanda_Changer.pl,
	  installcheck/Amanda_Changer_single.pl,
	  installcheck/Amanda_Taper_Scan_traditional.pl,
	  installcheck/bigint.pl, installcheck/Amanda_Cmdline.pl,
	  installcheck/Amanda_Changer_robot.pl, installcheck/amservice.pl,
	  installcheck/Amanda_Recovery_Clerk.pl,
	  installcheck/Amanda_Taper_Scan_lexical.pl,
	  installcheck/amarchiver.pl, installcheck/amrecover.pl,
	  installcheck/Amanda_Changer_ndmp.pl,
	  installcheck/Installcheck/ClientService.pm,
	  installcheck/Installcheck/Application.pm,
	  installcheck/Installcheck/Run.pm,
	  installcheck/Installcheck/Config.pm,
	  installcheck/Installcheck/Changer.pm,
	  installcheck/Installcheck/Dumpcache.pm,
	  installcheck/Installcheck/Mock.pm,
	  installcheck/Installcheck/Catalogs.pm, installcheck/example.pl,
	  installcheck/gnutar.pl, installcheck/amrestore.pl,
	  installcheck/amgetconf.pl, installcheck/pp-scripts.pl,
	  installcheck/Amanda_IPC_LineProtocol.pl, installcheck/amtape.pl,
	  installcheck/amraw.pl, installcheck/amserverconfig.pl,
	  installcheck/amgtar.pl, installcheck/taper.pl,
	  installcheck/Amanda_Util.pl,
	  installcheck/Amanda_Recovery_Planner.pl,
	  installcheck/mock/mail.pl, installcheck/mock/mtx.pl,
	  installcheck/mock/lpr.pl, installcheck/Amanda_IPC_Binary.pl,
	  installcheck/=setupcache.pl, installcheck/amcheckdump.pl,
	  installcheck/amdump_client.pl, installcheck/Amanda_Tapelist.pl,
	  installcheck/Amanda_Debug.pl, installcheck/Amanda_Changer_rait.pl,
	  installcheck/amcheck-device.pl, installcheck/Amanda_Header.pl,
	  installcheck/amdevcheck.pl, installcheck/Amanda_Device.pl,
	  installcheck/Amanda_Changer_null.pl, installcheck/ampgsql.pl,
	  installcheck/Installcheck.pm, installcheck/amadmin.pl,
	  installcheck/amvault.pl,
	  installcheck/Amanda_Report.pl, installcheck/amidxtaped.pl,
	  installcheck/mock_mtx.pl, installcheck/Amanda_Changer_disk.pl,
	  installcheck/Amanda_Logfile.pl,
	  installcheck/Amanda_Changer_multi.pl,
	  installcheck/amdump.pl, installcheck/catalogs/bigdb.cat,
	  installcheck/amreport.pl, installcheck/amcheck.pl,
	  installcheck/Amanda_Feature.pl, installcheck/amfetchdump.pl,
	  installcheck/chunker.pl, installcheck/Amanda_Xfer.pl,
	  installcheck/amrmtape.pl, installcheck/Amanda_Config.pl,
	  installcheck/amtapetype.pl, installcheck/noop.pl,
	  installcheck/Amanda_Config_FoldingHash.pl,
	  installcheck/Amanda_Process.pl,
	  installcheck/Amanda_MainLoop.pl, installcheck/Amanda_DB_Catalog.pl,
	  installcheck/Amanda_Archive.pl, amar-src/amar.c,
	  amar-src/amarchiver.c, amar-src/amar.h,
	  config/automake/scripts.am, config/automake/vars.am,
	  config/macro-archive/docbook-xslt.m4,
	  config/macro-archive/docbook-dtd.m4,
	  config/macro-archive/docbook-xslt-min.m4,
	  config/macro-archive/xsltproc.m4,
	  common-src/directtcp.h, common-src/amgetconf.pl,
	  common-src/sockaddr-util.c, common-src/sockaddr-util.h,
	  common-src/glib-util.c, common-src/glib-util.h,
	  common-src/ipc-binary.c, common-src/event-test.c,
	  common-src/ipc-binary.h, common-src/match-test.c,
	  common-src/amsemaphore-test.c, common-src/simpleprng.c,
	  common-src/simpleprng.h, common-src/amsemaphore.c,
	  common-src/quoting-test.c, common-src/fileheader-test.c,
	  common-src/amsemaphore.h, common-src/amcryptsimple.pl,
	  common-src/amaespipe.sh, common-src/testutils.c,
	  common-src/match.h, common-src/testutils.h,
	  common-src/amgpgcrypt.pl, application-src/script-email.pl,
	  application-src/amsuntar.pl, application-src/amzfs-snapshot.pl,
	  application-src/amlog-script.pl, application-src/amsamba.pl,
	  application-src/ampgsql.pl, application-src/amraw.pl,
	  application-src/amzfs-sendrecv.pl, contrib/amreport.rnc,
	  client-src/amdump_client.pl, ndmp-src/ndmpconnobj.c,
	  ndmp-src/ndmpconnobj.h, device-src/xfer-device.h,
	  device-src/s3-device.c, device-src/property.c,
	  device-src/s3.c, device-src/property.h,
	  device-src/xfer-dest-taper-directtcp.c, device-src/s3.h,
	  device-src/rait-device.c, device-src/device.c,
	  device-src/amtapetype.pl, device-src/device.h,
	  device-src/null-device.c, device-src/xfer-dest-taper.c,
	  device-src/directtcp-connection.c,
	  device-src/xfer-dest-taper-splitter.c,
	  device-src/xfer-dest-taper.h, device-src/amdevcheck.pl,
	  device-src/directtcp-connection.h, device-src/tape-device.c,
	  device-src/ndmp-device.c, device-src/vfs-device.c,
	  device-src/xfer-dest-taper-cacher.c, device-src/xfer-dest-device.c,
	  device-src/xfer-source-recovery.c, device-src/xfer-source-device.c,
	  device-src/s3-util.c, device-src/vfs-device.h,
	  device-src/s3-util.h, packaging/rpm/amanda.spec.src,
	  xfer-src/xfer-element.h, xfer-src/filter-process.c,
	  xfer-src/xfer.c, xfer-src/dest-directtcp-connect.c,
	  xfer-src/dest-buffer.c, xfer-src/source-directtcp-connect.c,
	  xfer-src/dest-null.c, xfer-src/xfer.h,
	  xfer-src/dest-directtcp-listen.c, xfer-src/source-pattern.c,
	  xfer-src/source-directtcp-listen.c, xfer-src/source-random.c,
	  xfer-src/xmsg.c, xfer-src/xfer-test.c,
	  xfer-src/xmsg.h, xfer-src/element-glue.c,
	  xfer-src/dest-fd.c, xfer-src/amxfer.h,
	  xfer-src/source-fd.c, xfer-src/element-glue.h,
	  xfer-src/filter-xor.c, xfer-src/xfer-element.c,
	  server-src/amcheckdump.pl, server-src/amoverview.pl,
	  server-src/amdumpd.pl, server-src/amcheck-device.pl,
	  server-src/amlogroll.pl, server-src/xfer-source-holding.c,
	  server-src/amlabel.pl, server-src/amvault.pl,
	  server-src/amcleanupdisk.pl, server-src/amidxtaped.pl,
	  server-src/cmdline.c, server-src/amdump.pl,
	  server-src/xfer-server.h, server-src/cmdline.h,
	  server-src/amreport.pl, server-src/amfetchdump.pl,
	  server-src/amrestore.pl, server-src/amcleanup.pl,
	  server-src/amaddclient.pl, server-src/amrmtape.pl,
	  server-src/amtape.pl, server-src/amserverconfig.pl,
	  server-src/taper.pl: update copyright dates

2012-07-20  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/timestamp.c (get_time_from_timestamp): Initialize to 0.

2012-07-19  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by crocket.
	* perl/Makefile.am: Fix cygwin build.

2012-07-18  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Parse application/json reply from cloudena.

2012-07-18  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_IPC_LineProtocol.pl: Add synchonization to fix
	  race.

2012-07-17  Dan Locks <dwlocks@zmanda.com>
	* packaging/sun-pkg/buildpkg:
	* packaging/sun-pkg/client/postremove.src,
	  packaging/sun-pkg/server/postremove.src: remove redundant usage of
	  basedir.
	* packaging/sun-pkg/client/postinstall.src,
	  packaging/sun-pkg/server/postinstall.src: same as above, plus fix
	  case statement.
	* packaging/sun-pkg/server/preinstall.src,
	  packaging/sun-pkg/client/preinstall.src: remove redundant basedir,
	  use new check_user_* functions.
	* packaging/rpm/amanda.spec.src: refactor to use common functions
	* packaging/rpm/buildpkg: check for ./configure, and exit if
	  substitute.pl fails.
	* packaging/deb/rules: use FULL_VERSION file to fill AMVER var, use
	* concatenation trick for postinst, rm trailing whitespace
	* packaging/deb/buildpkg: process postinst.src postrm.src preinst.src with substitute.pl
	* packaging/deb/postinst.src: refactor to use common functions.
	* packaging/deb/amanda-backup-server.postrm,
	  packaging/deb/amanda-backup-client.postrm,
	  packaging/deb/amanda-backup-client.postinst,
	  packaging/deb/amanda-backup-server.postinst: delete everything, add
	  variables pkg_type and other_pkg_type.
	* packaging/deb/preinst: moved to...
	* packaging/deb/preinst.src: here. refactor using common functions
	* packaging/deb/postrm: moved to...
	* packaging/deb/postrm.src: here. refactor using common functions.
	* packaging/common/common_functions.sh: remove trailing whitespace,
	  remove redundant usage of ${BASEDIR} in solaris functions, avoid
	  potentially non-portable test invocations.
	* packaging/common/test_sh_libs.sh: fix some log messages, redirect
	  some unused output, split check_user_* tests into shorter testsr,
	  add tests for supplemental groups, fix running single test.
	* packaging/common/mock_utils.sh: change id to error if any flags are
	  given, add mock for groups.
	* packaging/common/post_inst_functions.sh: remove redundant leading /
	* packaging/common/post_rm_functions.sh: rm trailing whitespace.
	* packaging/common/pre_inst_functions.sh: use variable for user
	  shell, clarify log messages regarding user accounts, split
	  check_user into separate functions, mostly to ease testing, add
	  check_user_supplemental_group.

2012-07-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheckdump.pl: Wait for all filters to terminate before
	  going to next image.  Do not use '--ignore-zeros' for SMBCLIENT
	  backup.  Pass the dump size to $xfer->start().
	* server-src/amfetchdump.pl: Wait for all filters to terminate before
	  going to next image.

2012-07-12  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Do not free ca_info if use_ssl is not set.
	* device-src/s3.c:: Set CURLOPT_CAINFO even if use_ssl is not set.

2012-07-10  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Print 'dump done' if the dump succeeded.

2012-07-09  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (val_t_display_strs): Add a print_unit argument.
	* common-src/conffile.h (val_t_display_strs): Change prototype.
	* perl/Amanda/Config.swg (getconf_byname_strs): Use val_t_display_strs
	  with a FALSE print_unit.

2012-07-09  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Correctly parse byte suffix.
	* common-src/conffile.h: Add confunit_t.
	* installcheck/amgetconf.pl: Fix for byte parsing.

2012-07-09  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (tape_action): Fix for flush_*.
	  Change debug level.

2012-06-29  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/JSON.pm: Fix comment.

2012-06-29  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scan/traditional.pm,
	  perl/Amanda/Taper/Scribe.pm: Correctly report error.

2012-06-29  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in: Small fix.
	* perl/Amanda/BigIntCompat.pm: Add TO_JSON to return anumber.
	* perl/Amanda/JSON.pm: documention
	* perl/Amanda/JSON/Changer.pm,
	  perl/Amanda/JSON/Config.pm,
	  perl/Amanda/JSON/DB/Catalog.pm,
	  perl/Amanda/JSON/Tapelist.pm: amanda SON perl modules.
	* perl/Amanda/JSON/RPC/Dispatcher.pm
	  perl/Amanda/JSON/RPC/Dispatcher/App.pm
	  perl/Amanda/JSON/RPC/Dispatcher/Procedure.pm: perl modules for JSON.
	* perl/Amanda/Tapelist.swg: Set $datestamp to 0 if !defined.
	* perl/Makefile.am: Compile new modules.
	* server-src/Makefile.am: Compile amanda.psgi.
	* server-src/amanda.psgi.pl: The amanda psgi.

2012-06-29  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/glib-util.c: Remove debug statements.

2012-06-28  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/glib-util.c: Do not compile ssl initialization code if
	  libcurl is not linked.

2012-06-28  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Fix compiler warning.

2012-06-28  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/glib-util.c: Fix for openssl and preprocessor.

2012-06-28  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/glib-util.c: Add initialization code for openssl and
	  gnutls.
	* config/amanda/libs.m4: Detect ssl library used by libcurl.

2012-06-28  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Renew swift v2 x-auth-token before it expires, use
	  glib if >= 2.26.

2012-06-27 Dan Locks <dwlocks@zmanda.com>
	* configure.in: update ac_prereq to 2.64

2012-06-27  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: remove code to Renew swift v2 x-auth-token, it
	  require glib 2.26.

2012-06-27  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: New CREATE-BUCKET property.
	* device-src/s3.c: Improving error message parsing.
	* man/xml-source/amanda-devices.7.xml: document new CREATE-BUCKET
	  property.

2012-06-26  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Remove bogus code.

2012-06-26  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Renew swift v2 x-auth-token before it expires.

2012-06-26  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Fix crash when parsing an invalid config file.

2012-06-26  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Cloudena do not have xml_version of html tag in
	  their reply.

2012-06-26  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Renew OAUTH2 token.

2012-06-21  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/human.pm: Change the default columspec to: HostName=0:-12:12,Disk=1:-11:11,Level=1:-1:1,OrigKB=1:-7:0,OutKB=1:-7:0,Compress=1:-6:1,DumpTime=1:-7:7,Dumprate=1:-6:1,TapeTime=1:-6:6,TapeRate=1:-6:1
	* man/xml-source/amanda.conf.5.xml: Document new default columnspec.
	* installcheck/catalogs/bigestimate.cat,
	  installcheck/catalogs/doublefailure.cat,
	  installcheck/catalogs/filesystemstaped.cat,
	  installcheck/catalogs/longstrange.cat,
	  installcheck/catalogs/multi-taper.cat,
	  installcheck/catalogs/normal.cat,
	  installcheck/catalogs/plannerfail.cat,
	  installcheck/catalogs/resultsmissing.cat,
	  installcheck/catalogs/retried-nofinish.cat,
	  installcheck/catalogs/retried-strange.cat,
	  installcheck/catalogs/retried.cat,
	  installcheck/catalogs/shortstrange.cat,
	  installcheck/catalogs/skipped.cat,
	  installcheck/catalogs/spanned.cat,
	  installcheck/catalogs/strontium.cat: fix for new default columnspec.

2012-06-21  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: OAUTH2 use 'max-keys'.

2012-06-20  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Worker.pm: Fix update of the status file.

2012-06-20  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Fix memory corruption.

2012-06-20  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: Cancel call dump_cb.
	* perl/Amanda/Taper/Worker.pm: Cancel the header xfer.

2012-06-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Fix 32 bits overflow.

2012-06-19  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c, common-src/amxml.c,
	  common-src/security-util.c, common-src/util.c,
	  server-src/tapefile.c: Fix small memory leak.
	* perl/Amanda/Config.swg: Mark amandaify_property_name as %newobject
	* perl/Amanda/Header.swg: Mark C_from_string as %newobject
	* perl/Amanda/Tapelist.swg: Mark list_new_tapes as %newobject
	* perl/Amanda/Util.swg: Mark sanitise_filename, quote_string,
	  unquote_string and split_quoted_strings as %newobject
	* xfer-src/xfer-element.c: lock elt->xfer->status_mutex before looking
	  at elt->xfer->status.
	* device-src/device.h (Device): Add a GMutex device_mutex to protect
	  method with concurent access.
	* device-src/device.c, device-src/ndmp-device.c,
	  device-src/null-device.c, device-src/rait-device.c,
	  device-src/s3-device.c, device-src/tape-device.c,
	  device-src/vfs-device.c: Use the mutex to protext some Device field.

2012-06-18  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Coorectly delay full dump if it doesn't fit in
	  the schedule.

2012-06-14 Dan Locks <dwlocks@zmanda.com>
	* packaging/common/mock_utils.sh: update id mock to handle -Gn flags,
	  add groupadd mock, add usermod mock, correct silent errors in inetd
	  and install mocks
	* packaging/common/pre_inst_functions.sh: add_group now attempts to
	  create a potentially missing suppmemental group, add_group does not
	  use -A or -a, instead generates a list of current groups from id -Gn,
	  update error_group_member to use the name of the group passed to
	  add_group.
	* packaging/common/test_sh_libs.sh: add 2 add_group unit tests, update
	  check_user_group test.

2012-06-13  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Check gtar support --no-check-device.

2012-06-08  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/aggregate.pm, perl/Amanda/Changer/disk.pm,
	  perl/Amanda/Changer/ndmp.pm perl/Amanda/Changer/rait.pm,
	  perl/Amanda/Changer/robot.pm, perl/Amanda/Changer/single.pm,
	  perl/Amanda/Chunker/Controller.pm, perl/Amanda/Chunker/Scribe.pm,
	  perl/Amanda/Recovery/Clerk.pm, perl/Amanda/Recovery/Planner.pm,
	  perl/Amanda/Recovery/Scan.pm, perl/Amanda/Report/human.pm,
	  perl/Amanda/Taper/Scribe.pm,
	  perl/Amanda/Taper/Worker.pm: Change many die by confess.

2012-06-07  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Parse message attribute in cloudena error reply.
	  Parse details in HP error reply.

2012-06-04  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amrestore.pl: Typo.

2012-06-01  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amrestore.pl: Use the blocksize argument.

2012-06-01  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Print to debug if bc2lb change the
	  label for a barcode. Print to debug the mtx output.
	* perl/Amanda/Taper/Scribe.pm: Do not use a tape if the barcode from
	  tapelist differ from the changer.

2012-05-28  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amzfs-sendrecv.pl: fix print_to_server argument.

2012-05-24  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: Do not send a chomped line to index.

2012-05-24  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Application.swg: Use IO::Handle to open mesgout.

2012-05-23  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Add project_id.
	* device-src/s3.c: Add project_id. Add x-goog-project-id and
	  x-goo-api-version to headers.
	* device-src/s3.h (s3_make_bucket, s3_is_bucket_exists) Add project_id
	  argument.
	* man/xml-source/amanda-devices.7.xml: Document project-id property.

2012-05-23  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Call s3_open2 after setting properties.
	* device-src/s3.c (s3_open2): New function.
	* device-src/s3.h (s3_open2): Prototype.

2012-05-17 Dan Locks <dwlocks@zmanda.com>
	* packaging/sun-pkg/buildpkg: add missing --with-libcurl= for server

2012-05-17  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/event.c: Add missing "\n" in debugging.
	* perl/Amanda/Application.swg: Make mesgout autoflush.

2012-05-15  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Device.pl: Correctly count NDMP test.

2012-05-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amvault.pl: Abort if log file already exists.

2012-05-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c: Fix crash when log are corrupted.

2012-05-15  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Recovery/Planner.pm (make_plan_from_filelist): Use the
	  changer inventory to try to use an already available dump.
	* server-src/amidxtaped.pl: Pass the changer to make_plan.

2012-05-14  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c, device-src/s3.c: Fix for pragma and gcc-4.5.2.

2012-05-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Worker.pm (FAILED): Do it correctly.

2012-05-11  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Improve output on taper error.

2012-05-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Worker.pm (FAILED): Ignore if dump is already
	  cancelled.

2012-05-11  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/event.c: Improve debugging.
	* server-src/dumper.c: Close data output in stop_dump.

2012-05-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Constants.pm.in: Add NC, NC6 and NETCAT.

2012-05-10 Dan Locks <dwlocks@zmanda.com>
	* configure.in: update AC_INIT usage, specify tar-ustar and minimum
	  automake version.
	* config/amanda/version.m4: create new AMANDA_INIT_VERSION macro to
	  read FULL_VERSION or VERSION before AC_INIT.

2012-05-10  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/progs.m4: Define AMANDA_PROG_NC, set NC, NC6 and
	  NETCAT.
	* configure.in: use AMANDA_PROG_NC.
	* installcheck/Amanda_Device.pl: Use them.

2012-05-10 Dan Locks <dwlocks@zmanda.com>
	* Makefile.am: update required automake version

2012-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Device.pl: sleep to allow other process the time
	  to start listening.

2012-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amflock.c, common-src/match.c, common-src/util.c,
	  device-src/s3.c: Fix for deprecated G_STATIC_MUTEX_INIT.

2012-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Handle indirect tcp.
	* device-src/ndmp-device.c: Add INDIRECT property.
	* installcheck/Amanda_Device.pl: Test indirect tcp.
	* man/xml-source/amanda-devices.7.xml: Document INDIRECT property.
	* ndmp-src/ndmp4_translate.c: remove debugging statement.

2012-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amzfs-snapshot.pl: Typo.

2012-05-02  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/*.pl: use lib '@amperldir@';

2012-05-01  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amfetchdump.8.xml: Add --decrypt, --no-decrypt,
	  --server-decrypt, --client-decrypt, --compress, --no-compress,
	  --server-compress, --client-compress.
	* server-src/amfetchdump.pl: Document new options.

2012-05-01  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/s3-device.m4: Improve output.
	* config/amanda/device.m4: Add AMANDA_CHECK_DEVICES and
	  AMANDA_SHOW_DEVICES_SUMMARY
	* config/amanda/summary.m4: Use AMANDA_SHOW_DEVICES_SUMMARY.
	* configure.in: Use AMANDA_CHECK_DEVICES.

2012-04-25  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndmos.h: Define NDMOS_MACRO_FREE
	* ndmp-src/ndmos_glib.h: Define NDMOS_MACRO_FREE
	* ndmp-src/ndmp_translate.h: define CNVT_FREE.
	* ndmp-src/ndmp4_translate.c:#Add many free function.

2012-04-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amfetchdump.pl: Fix.

2012-04-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c: Fix handling of optional arguments.
	* installcheck/amadmin.pl: Check it.

2012-04-19  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/amdump_client.pl: Fix warning.

2012-04-18  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amfetchdump.pl: add --decompress and --decrypt options.
	* man/xml-source/amfetchdump.8.xml: Document new options.

2012-04-18  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Parse MAX_WARNINGS in dumptype.
	* common-src/conffile.h: Add DUMPTYPE_MAX_WARNINGS and
	  dumptype_get_max_warnings
	* man/xml-source/amanda.conf.5.xml: Document max_warning in dumptype.
	* perl/Amanda/Config.swg: Add DUMPTYPE_MAX_WARNINGS.
	* server-src/diskfile.c (add_disk): Copy max_warnings from dumptype.
	* server-src/diskfile.h: Add max_warnings in disk_t.
	* server-src/driverio.c (dumper_cmd): Send max_warnings to dumper.
	* server-src/dumper.c: Use max_warnings.

2012-04-18  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndmpconnobj.c: Remove useless g_source_is_destroyed check.

2012-04-17  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amgetconf.pl: Read the disklist.
	* common-src/conffile.h (seen_t): Add block.
	* common-src/conffile.c: Set seen.block
	* common-src/conffile.c (dump_configuration): New print_default and
	  print_source arguments.
	* installcheck/Amanda_Config.pl: Fix dump_configuration call.
	* server-src/amadmin.c: Add --no-default and --print-source arguments
	  for config and disklist command.
	* man/xml-source/amadmin.8.xml: Document new arguments.
	* perl/Amanda/Chunker/Scribe.pm: Do load Amanda::Device.
	* perl/Amanda/Config.swg: Fix for new dump_configuration arguments.

2012-04-16  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amstar.c: Remove spurious space on directory entry.

2012-04-13  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add TMPDIR.
	* common-src/conffile.h: Add CNF_TMPDIR.
	* man/xml-source/amanda.conf.5.xml: Document TMPDIR.
	* perl/Amanda/Config.swg: Add CNF_TMPDIR.
	* server-src/amindexd.c: Use CNF_TMPDIR.

2012-04-12  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: Create incremental empty archive.

2012-04-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm (make_new_tape_label): Fix error return.
	* perl/Amanda/Taper/Scribe.pm ($_user_msg_fn): Improve message if tape
	  is relabeled with a new label.
	* perl/Amanda/ScanInventory.pm: Set relabeled.
	* installcheck/Amanda_Changer.pl: Fix for new message.

2012-04-11  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Nathan Stratton Treadway
	* device-src/vfs-device.c: Improve message for MAX_VOLUME_USAGE.
	* installcheck/taper.pl: Fix.

2012-04-11  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amgtar.8.xml: s/APPLCIATION/APPLICATION/

2012-04-06  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: psql /could not connect to server/
	  message result in STRANGE.

2012-04-06  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/ScanInventory.pm: Fix for label not matching labelstr.

2012-04-06  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.c (device_get_bytes_written): New function.
	* device-src/device.h (device_get_bytes_written): New prototype.
	* device-src/ndmp-device.c, device-src/rait-device.c,
	  device-src/s3-device.c, device-src/tape-device.c,
	  device-src/vfs-device.c: Implement get_bytes_written.
	* device-src/xfer-dest-taper-cacher.c,
	  device-src/xfer-dest-taper-splitter.c: Use device_get_bytes_written.
	* perl/Amanda/Device.swg: Swig device_get_bytes_written.

2012-04-05  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: New CLIENT_ID, CLIENT_SECRET and
	  REFRESH_TOKEN properties. Handle OAUTH2.
	* device-src/s3.c: Handle OAUTH2.
	* device-src/s3.h (S3_api): Add S3_API_OAUTH2.
	* man/xml-source/amanda-devices.7.xml: Document new CLIENT_ID,
	  CLIENT_SECRET and REFRESH_TOKEN properties.

2012-04-05  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amfetchdump.8.xml: Document -l do not unencrypt.

2012-04-05  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.c (device_accept_with_cond,
	  device_connect_with_cond): New functions.
	* device-src/device.h (device_accept_with_cond,
	  device_connect_with_cond): New prototypes.
	* device-src/ndmp-device.c (accept_with_cond_impl,
	  connect_with_cond_impl): new functions.
	* device-src/xfer-dest-taper-directtcp.c: Use device_accept_with_cond.
	* ndmp-src/ndmpconnobj.c (ndmp_connection_wait_for_notify_with_cond):
	  new function.
	* ndmp-src/ndmpconnobj.h (ndmp_connection_wait_for_notify_with_cond):
	  new prototype.
	* perl/Amanda/Device.swg: swig accept_with_cond and connect_with_cond.
	* perl/Amanda/Taper/Worker.pm: Ignore duplicate DONe message.
	* server-src/driver.c (handle_dumper_result): Always send dumper
	  result to taper.
	* server-src/dumper.c: Remove debugging statement.
	* xfer-src/element-glue.c: Add debugging statement.
	* xfer-src/xfer.c (xfer_cancel): Ignore duplicate cancel.
	* xfer-src/xfer.h (struct Xfer): Add cancelled field.

2012-04-05  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amcryptsimple.pl: Use gpg if available.
	* common-src/amgpgcrypt.pl: Use gpg-agent and/or gpg2 if available.
	* server-src/dumper.c: Log compression/encryption executed.

2012-04-05  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: New S3_MULTI_DELETE property.
	* device-src/s3.c: New S3_MULTI_DELETE property.
	* device-src/s3.h (s3_multi_delete): New prototype.
	* man/xml-source/amanda-devices.7.xml: Document new S3_MULTI_DELETE s3
	  device property.

2012-04-05  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: New PASSWORD, USERNAME, TENANT_ID,
	  TENANT_NAME and STORAGE_API property. Handle SWIFT-2.
	* device-src/s3.c: Handle SWIFT-2.
	* device-src/s3.h (s3_open): New prototype.
	* device-src/s3.h (S3_api): New enum.
	* man/xml-source/amanda-devices.7.xml: Document new PASSWORD,
	  USERNAME, TENANT_ID, TENANT_NAME and STORAGE_API S3 device
	  properties.

2012-04-03  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: Do not set unc prematurely.

2012-03-29 Dan Locks <dwlocks@zmanda.com>
	* packaging/sun-pkg/buildpkg: add missing GLIB_LIBS variable to intel
	  builds. Add flags to make invocation to reduce output.

2012-03-29  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Fix hang if taper crash.

2012-03-29  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Retry on {500, S3_ERROR_None} error.
	  Improving debugging.

2012-03-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c: Fix bumpsize.

2012-03-22  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/fileheader.c: header type for non-amanda header is
	  F_WEIRD.
	* server-src/amcheck-device.pl,
	  server-src/amtape.pl: Improve output for non-Amanda volume.

2012-03-22  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Chunker/Scribe.pm: do not call _start_chunk if the
	  transfer is finished.
	* server-src/driver.c: Fix hang.

2012-03-19  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Use "TAR-BLOCKSIZE" on restore.

2012-03-16  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Use statefile to find end_wal on
	  estimate.

2012-03-15  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Add IGNORE-ZEROS property.
	* man/xml-source/amgtar.8.xml: Document IGNORE-ZEROS property.

2012-03-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: touch $@

2012-03-13  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Do not Execute pg_start_backup for
	  estimate.

2012-03-11  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/glib-util.c: g_thread_supported always return TRUE on
	  newer version.

2012-03-10  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/glib-util.c, common-src/glib-util.h: Remove
	  g_queue_free_full.

2012-03-09  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/Makefile.am, common-src/am_sl.c: typo.

2012-03-09  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c, client-src/selfcheck.c,
	  client-src/sendbackup-dump.c, client-src/sendbackup-gnutar.c,
	  client-src/sendbackup.c, client-src/sendsize.c,
	  common-src/amxml.c, common-src/amxml.h,
	  recover-src/extract_list.c: s/level_t/am_level_t/g
	* client-src/calcsize.c, common-src/amxml.h,
	  common-src/conffile.c, common-src/conffile.h,
	  common-src/sl.c, common-src/sl.h,
	  perl/Amanda/Header.swg: s/sl_t/am_sl_t/g
	* amandad-src/amandad.h, client-src/calcsize.c,
	  client-src/client_util.h, common-src/Makefile.am: s/sl.h/am_sl.h
	* common-src/am_sl.h: renamed from common-src/sl.h
	* common-src/am_sl.c: renamed from common-src/sl.c

2012-03-09  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amfetchdump.pl: Print progress.
	* device-src/device.c (device_get_bytes_read ): New API method.
	* device-src/device.h (Device): Add bytes_read.
	* device-src/device.h (_DeviceClass): Add get_bytes_read.
	* device-src/device.h (device_get_bytes_read): Add prototype.
	* device-src/ndmp-device.c: Set bytes_read.
	* device-src/rait-device.c: Set bytes_read.
	* device-src/s3-device.c: Use curl progress callback to set bytes_read.
	* device-src/s3.c: Set a progress callback.
	* device-src/tape-device.c: Set bytes_read.
	* device-src/vfs-device.c: Set bytes_read.
	* device-src/xfer-device.h (xfer_source_recovery_get_bytes_read): Add
	  prototype.
	* device-src/xfer-source-recovery.c
	  (xfer_source_recovery_get_bytes_read): new function.
	* perl/Amanda/Device.swg (device_get_bytes_read): New function.
	* perl/Amanda/Recovery/Clerk.pm: Call get_bytes_read.
	* perl/Amanda/XferServer.swg: (xfer_source_holding_get_bytes_read,
	* xfer_source_recovery_get_bytes_read): New prototypes.
	* server-src/xfer-server.h (xfer_source_holding_get_bytes_read): New
	  protoype.
	* server-src/xfer-source-holding.c (xfer_source_holding_get_bytes_read):
	  New function.

2012-03-09  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Recovery/Scan.pm: Do not rescan the same slot
	  indefinitely.

2012-03-09  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/multi.pm: Fix warning.

2012-03-09  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: New PROXY property.
	* device-src/s3.c: Set CURLOPT_PROXY from PROXY property.
	* device-src/s3.h (s3_open): Add proxy argument.
	* man/xml-source/amanda-devices.7.xml: Document PROXY property.

2012-03-08  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Header.swg (get_dle): Return undef if not set.
	* server-src/amidxtaped.pl: Check dle is set.

2012-03-08  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amvault.pl: Use the write-timestamp, not the
	  dump-timestamp.

2012-03-08  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ssh-security.c: use default port if client-port is not
	  set.

2012-03-07  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl:  Fix use of subdir for restore,
	  prepend subdir on include for restore.

2012-03-07  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndmjob_args.c: Add '-o D-agent-fd' argument.

2012-03-07  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Do not execute pg_start_backup and
	  pg_stop_backup on selfcheck.

2012-02-23  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amzfs-sendrecv.8.xml: Typo.

2012-02-23  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/disklist.5.xml: Document includefile directive.

2012-02-16  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c (disklist_one): print the filename.
	* server-src/diskfile.c: Add includefile directive.
	* server-src/diskfile.h (disk_t): Add filename.

2012-02-14  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: Add '--homeurl "$(POD_HOME_URL)"' to make_html
	* perl/make_html.pl: Improved modules list.

2012-02-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/make_html.pl: Add link to index page.

2012-02-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/make_html.pl: More fix.

2012-02-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/make_html.pl: Make relative link.

2012-02-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/make_html.pl: Fix for beta release.

2012-02-13  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Fix default netusage.

2012-02-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Recovery/Clerk.pm: Typo.

2012-02-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/make_html.pl: Fix html for relative link.

2012-02-10  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Do not print the data to the debug file.

2012-02-08  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Do not use temporary disk space while
	  doing backup or recovery.

2012-02-08  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/DB/Catalog.pm: filenum must be sorted numerically.

2012-02-07  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: pg_version 802000 => 80200.

2012-02-01  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Do not print normal
	  pg_xlogfile_name_offset output to MESG stream.

2012-01-31 Dan Locks <dwlocks@zmanda.com>
	* packaging/deb/preinst, packaging/rpm/amanda.spec.src: change /bin/sh
	  to /bin/bash.

2012-01-27  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Call pg_switch_xlog() only for backup.

2012-01-27  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Run pg_switch_xlog() and wait for the
	  archived WAl before doing an incremental backup.

2012-01-26  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Fix compilation.

2012-01-23  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Set xmlns for IIJ.

2012-01-23  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm, server-src/amlabel.pl:use the
	  block_size instead of the header-block_size to write the BLOCK_SIZE
	  in the tapelist.

2012-01-19  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Add support for openstack swift api.
	* device-src/s3.c: Add support for openstack swift api.
	* device-src/s3.h: Add support for openstack swift api.
	* man/xml-source/amanda-devices.7.xml: Add openstack-swift-api
	  property.

2012-01-13  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Fix deleting files.

2012-01-09  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amtape.pl: Fix amtape show for non numeric slot.

2012-01-04  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Fix for compilation on AIX.

2012-01-04 Dan Locks <dwlocks@zmanda.com>
	*  packaging/sun-pkg/buildpkg: Add GLIB_* flags to sun packages
	*  config/amanda/libs.m4: fix "exit when explicit flags are given"
	   error, and require all flags when one is given.

2012-01-03  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Report DEVICE ERROR if s3_is_bucket_exists
	  response with curl error CURLE_COULDNT_CONNECT or
	  CURLE_COULDNT_RESOLVE_HOST.

2012-01-02  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/multi.pm: Print the state filename to the debug
	  file.

2012-01-02  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/ScanInventory.pm: Correctly set 'err'.
	* server-src/amtape.pl: quit the changer even on error.

2011-12-24  Dustin J. Mitchell <dustin@mozilla.com>
	Patch by Nathan Stratton Treadway.
	* man/xml-source/amgetconf.8.xml: a typo in the amgetconf.8 man page

2011-12-24  Dustin J. Mitchell <dustin@mozilla.com>
	Patch by Nathan Stratton Treadway.
	* common-src/conffile.c: minor problem with an error message in
	  conffile.c, this time in the read_confline() function.  It's just a
	  mention of "APPLICATION-TOOL"/"SCRIPT-TOOL" that was missed in SVN
	  revision 2028/git commit d0d9425b5d1e5a535719e754243c8f9f12a0ecf1 (in
	  which those names were changed to "APPLICATION" and "SCRIPT" instead).

2011-12-23  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Nathan Stratton Treadway.
	* common-src/conffile.c (read_int_or_str): Fix error message.

2011-12-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Fix force-bump with overdue filesystem.

2011-12-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amlabel.pl: --asign require --meta or --barcode.

2011-12-20  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/amserverconfig.pl: Remove holding disk and vtapes.

2011-12-14  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Xfer.pl: Load Amanda::Changer only with server
	  component.

2011-12-14  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Installcheck/Run.pm (load_vtape): Use $sbindir to
	  execute amtape.

2011-12-14  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c (s3_is_bucket_exists): Set max-keys=1.

2011-12-14  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Recovery/Scan.pm (new): Return changer error.

2011-12-12  Jean-Louis Martineau <martineau@zmanda.com>
	* Makefile.am (SERVER_SUBDIRS): Remove changer-src.
	* changer-src: Remove subdirectoy.
	* configure.in (AC_CONFIG_FILES): Remove changer-src/Makefile.
	* man/xml-source/amanda-changers.7.xml: Remove all older changer api.
	* perl/Amanda/Changer.pm: Remove check for older changer api.
	* perl/Amanda/Changer/compat.pm: Remove file.
	* perl/Makefile.am (AmandaChanger_DATA): Remove Amanda/Changer/compat.pm
	* installcheck/Amanda_Changer.pl: Remove test of older changer api.
	* installcheck/Amanda_Changer_compat.pl: Remove file.
	* installcheck/Amanda_DB_Catalog.pl: Fix typo.
	* installcheck/Amanda_Recovery_Planner.pl: Fix typo.
	* installcheck/Amanda_Recovery_Scan.pl: Use new changer api.
	* installcheck/Amanda_Xfer.pl: Use new changer api.
	* installcheck/Installcheck/Run.pm: Remove code to create older vtapes.
	* installcheck/Makefile.am (server_tests): Remove Amanda_Changer_compat.
	* installcheck/amdevcheck.pl: Use new changer api.
	* installcheck/amlabel.pl: Use new changer api.
	* installcheck/amtape.pl: Use new changer api.
	* installcheck/amtapetype.pl: Use new changer api.
	* installcheck/taper.pl: Use new changer api.

2011-12-12  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/amdevcheck.pl: Use current slot.

2011-12-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amfeatures.c: Add fe_dumptype_property.
	* common-src/amfeatures.h: Add fe_dumptype_property.
	* common-src/amxml.c: Parse dumptype properties.
	* common-src/amxml.h (dle_t): Add property field.
	* perl/Amanda/Disklist.swg: Add clean_dle_str_for_client.
	* perl/Amanda/Feature.pod: Add fe_dumptype_property.
	* perl/Amanda/Feature.swg: Add Amanda::Feature::Set::features
	* server-src/amidxtaped.pl: Call clean_dle_str_for_client.
	* server-src/diskfile.c (xml_dumptype_properties): New function toi
	  return dumptype propertyes.
	* server-src/diskfile.h (xml_dumptype_properties) Add prototype.
	* server-src/driverio.c: Add xml_dumptype_properties to dumper cmd.
	* server-src/dumper.c: Call clean_dle_str_for_client.

2011-12-09  Jean-Louis Martineau <martineau@zmanda.com>
	* config/config.guess config/config.sub: new updates from FSF.

2011-12-08  Jean-Louis Martineau <martineau@zmanda.com>
	* example/template.d/amanda-harddisk.conf.in: fix for installcheck.

2011-12-08  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS, ReleaseNotes: Update for 3.3.1

2011-12-08  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindex.c (getheaderfname): New function.
	* server-src/amindex.h (getheaderfname): New prototype.
	* server-src/dumper.c: Wrtie header to a file in indexdir.

2011-12-07  Jean-Louis Martineau <martineau@zmanda.com>
	* example/template.d/amanda-S3.conf.in,
	  example/template.d/amanda-harddisk.conf.in,
	  example/template.d/amanda-single-tape.conf.in,
	  example/template.d/amanda-tape-changer.conf.in: Use new changer api.
	* server-src/amserverconfig.pl: Use new changer api.

2011-12-07  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amvault.8.xml: Improve.

2011-12-07  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/ScanInventory.pm (volume_is_labelable): New method.
	* perl/Amanda/Taper/Scan/lexical.pm, perl/Amanda/Taper/Scan/oldest.pm:
	  Use volume_is_labelable from ScanInventory.
	* perl/Amanda/Taper/Scan/traditional.pm: Fix bad logging.
	* perl/Amanda/Taper/Scribe.pm: Print "autolabel disabled".
	* perl/Amanda/Taper/Worker.pm: Add debugging.
	* server-src/amvault.pl: Quit both changer, add debugging.

2011-12-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcleanup.pl, server-src/amcleanupdisk.pl: use
	Amanda::Debug.

2011-12-05  Jean-Louis Martineau <martineau@zmanda.com>
	Fix for previous patch.
	* application-src/amlog-script.pl, application-src/ampgsql.pl,
	  application-src/amraw.pl, application-src/amsamba.pl,
	  application-src/amsuntar.pl, application-src/amzfs-sendrecv.pl,
	  application-src/amzfs-snapshot.pl,
	  application-src/script-email.pl: Undo previous patch,
	* perl/Amanda/Script_App.pm: Do it here instead.
	  server-src/amlogroll.pl, server-src/amvault.pl
	  server-src/chunker.pl,
	  server-src/taper.pl: Import the debug method.
	* server-src/amoverview.pl, server-src/amserverconfig.pl,
	  server-src/amstatus.pl: Undo previous patch, they do not use the
	  debug file.

2011-12-05  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amlog-script.pl, application-src/ampgsql.pl,
	  application-src/amraw.pl, application-src/amsamba.pl,
	  application-src/amsuntar.pl, application-src/amzfs-sendrecv.pl,
	  application-src/amzfs-snapshot.pl, application-src/script-email.pl,
	  client-src/amdump_client.pl, common-src/amgetconf.pl,
	  device-src/amdevcheck.pl, device-src/amtapetype.pl,
	  server-src/amcheckdump.pl, server-src/amcleanup.pl,
	  server-src/amcleanupdisk.pl, server-src/amdump.pl,
	  server-src/amfetchdump.pl, server-src/amlabel.pl,
	  server-src/amlogroll.pl, server-src/amoverview.pl,
	  server-src/amreport.pl, server-src/amrestore.pl,
	  server-src/amrmtape.pl, server-src/amserverconfig.pl,
	  server-src/amstatus.pl, server-src/amtape.pl,
	  server-src/amvault.pl, server-src/chunker.pl,
	  server-src/taper.pl: Print command line arguments to debug file.

2011-12-05  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.c, device-src/ndmp-device.c,
	  device-src/tape-device.c: Call device_set_error if setting a
	  property fail.
	* perl/Amanda/Changer.pm: Use device error message.

2011-12-02  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c, device-src/vfs-device.c (*_device_erase):
	  set the device state to unlabeled.
	* perl/Amanda/Changer/compat.pm, perl/Amanda/Changer/multi.pm
	  (set_label):  works with undefined label.
	* perl/Amanda/Changer/robot.pm: small cleanup.
	* server-src/amrmtape.pl: Call reservation set_label method to remove
	  the label from the state.

2011-12-02  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml (autolabel): Document it must match
	  labelstr.

2011-12-01  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c (delete_file): Use multiple threads.

2011-11-30  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/xfer-dest-taper-splitter.c: Set the xmsg even if the xfer
	  is cancelled.
	* perl/Amanda/Taper/Scribe.pm: result is PARTIAL|FAILED if
	  !last_part_successful.

2011-11-30  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/xfer-source-recovery.c (pull_buffer_impl): Release lock
	  before calling wait_until_xfer_cancelled.

2011-11-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amfetchdump.pl: Fix usage.
	* man/xml-source/amfetchdump.8.xml: Fix synopsis.

2011-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Makefile.am: Fix typo.

2011-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/gnutar.pl: Change expectations to an array that can be
	  scanned in order, fix for tar-1.25 on fc15.

2011-11-22  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Makefile.am: rm with '-f'.

2011-11-22  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c (build_url): curl is G_GNUC_UNUSED.

2011-11-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amtape.pl: Fix 'amtape show' with one slot.
	* installcheck/amtape.pl: Test it.

2011-11-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amreport.pl: Check if executable before open3().
	* installcheck/amreport.pl: Fix for new message.

2011-11-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amtape.pl: Add [slots] argument to amtape show.
	* man/xml-source/amtape.8.xml: Document it.

2011-11-21  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Disable the service_path if it is set to an empty
	  string or '/', also remove trailing slash.

2011-11-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amdump.pl: Log a 'START planner date' line on error'.

2011-11-15  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Use curl_easy_escape.

2011-11-15  Jean-Louis Martineau <martineau@zmanda.com>
	* amplot/Makefile.am, application-src/Makefile.am,
	  client-src/Makefile.am, common-src/Makefile.am,
	  device-src/Makefile.am, server-src/Makefile.am: Add $(SCRIPTS_PERL)
	  $(SCRIPTS_SHELL) and $(SCRIPTS_AWK) to CLEANFILES.
	  Add config.log to DISTCLEANFILES.
	* installcheck/Makefile.am: Add $(all_tests) $(mocks)
	  $(noinst_SCRIPTS) to CLEANFILES. Add config.log to DISTCLEANFILES
	  (installcheck-local): Remove $(CONFIG_DIR)/amanda-client.conf,
	  $(CONFIG_DIR)/template.d/dumptypes and
	  $(CONFIG_DIR)/template.d/tapetypes is they were not present.

2011-11-14  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/gnutar.pl: Fix for fc16.

2011-11-10  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/mock/mtx.pl: Fix qw.

2011-11-10  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Use Getopt::Long

2011-11-10  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Use CURLOPT_MAX_RECV_SPEED_LARGE.

2011-11-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Logfile.pod: Remove match_* functions
	* perl/Amanda/Logfile.swg: Remove match_* functions
	* perl/Amanda/Util.pod: Add match_* functions
	* perl/Amanda/Util.swg: Add match_* functions
	* client-src/amdump_client.pl, perl/Amanda/DB/Catalog.pm,
	  server-src/amdumpd.pl, server-src/amidxtaped.pl,
	  server-src/amvault.pl: Use match_* functions for Amanda::Util

2011-11-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report.pm: Always report the first 100 strange lines.
	* installcheck/catalogs/longstrange.cat: Fix test.

2011-11-09  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amreport.pl: Fix for perl-5.14
	* installcheck/amreport.pl: Add test.

2011-11-09  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Installcheck/Changer.pm: Fix warnign for perl 5.14.

2011-11-09  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Print state filename to debug file.

2011-11-07  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Add S3_SERVER_SIDE_ENCRYPTION property.
	* device-src/s3.c: Add server_side_encryption.
 	* device-src/s3.h: Add server_side_encryption.
	* man/xml-source/amanda-devices.7.xml: Document
	  S3_SERVER_SIDE_ENCRYPTION property

2011-11-07  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm (release): Always call finished_cb.
	* installcheck/amcheck-device.pl: Add a check.

2011-10-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driverio.c (update_info_dumper): Set date to 0 if
	  datestamp is 0.

2011-10-07  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: If datadir is not set, use the disk
	  argument.

2011-10-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Do not free cwd.
	* common-src/amgetconf.pl: Allow to get one property.
	* installcheck/amgetconf.pl: Test it.

2011-10-05  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Retry in case of CURLE_SSL_CONNECT_ERROR error.

2011-10-04  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/gnutar.pl: Add support for fc14 and fc15.

2011-10-04  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Do not crahs if amidxtaped close the
	  connection.

2011-10-04  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Correctly set thunk->next_marker.

2011-09-30 Dan Locks <dwlocks@zmanda.com>
	*  packaging/common/substitute.pl: fix PKG_REV missing message.
	*  packaging/sun-pkg/buildpkg, packaging/deb/buildpkg,
	   packaging/rpm/buildpkg: create PKG_REV file until the machinery to
	   process svn tags for PKG_REV is in place

2011-09-29 Dan Locks <dwlocks@zmanda.com>
	*  packaging/sun-pkg: sun package subdirectories
	*  packaging/sun-pkg/buildpkg: sun package building script
	*  packaging/common/mock_utils.sh: mocked utilities used by pre/post
	   scripts
	*  packaging/common/post_inst_functions.sh,
	   packaging/common/post_rm_functions.sh,
	   packaging/common/pre_inst_functions.sh,
	   packaging/common/common_functions.sh: shared shell functions for
	   pre/post scripts.
	*  packaging/common/substitute.pl: update to handle sun packages and
	   shell functions
	*  packaging/common/test_sh_libs.sh: unit tests for shell functions
	*  packaging/common/shunit2: unit test framework
	*  packaging/Makefile.am: add sun package to dist tarball.
	*  note: S3 device is not enabled; solaris compilation has me stumped.

2011-09-21  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Sam Stuck
	* man/xml-source/amanda-changers.7.xml: Typo.

2011-09-20  Jean-Louis Martineau <martineau@zmanda.com>
	* man/Makefile.am (SERVER_MAN_PAGES): Add amcleanupdisk.8
	* man/xml-source/amcleanup.8.xml:Add -r option.
	* man/xml-source/amcleanupdisk.8.xml: New man page.
	* perl/Amanda/Holding.pm (all_files, merge_all_files, rename_tmp):
	  New methods.
	* server-src/Makefile.am (amlibexec_PROGRAMS): Remove amcleanupdisk.
	* server-src/Makefile.am (sbin_SCRIPTS_PERL): Add amcleanupdisk.
	* server-src/amcleanup.pl: Add -r option.
	* server-src/amcleanupdisk.c: Remove file
	* server-src/amcleanupdisk.pl: New perl version.
	* server-src/holding.c: Fix max level to 399.

2011-09-07  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Device.pl: Check setting a property with an
	  invalid name.

2011-09-07  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Device.swg: Do not g_value_unset an uninitialized value.

2011-09-07  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amzfs-sendrecv.pl: restore works without --device.

2011-09-06  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amcryptsimple.pl: Do not use gpg-agent if it is not
	  available.

2011-09-02  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c (print_platform): Another fix.

2011-09-02  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amcryptsimple.pl: Use gpg-agent.

2011-09-02  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c (print_platform): Fix.

2011-09-01  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c (export) parse version without patch number.

2011-09-01  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/ScanInventory.pm: Get the meta label before
	  calling make_new_tape_label.
	* perl/Amanda/Taper/Scan/traditional.pm: Get the meta label before
	  calling make_new_tape_label.
	* perl/Amanda/Taper/Scribe.pm: Return the reservation on error.
	* server-src/amcheck-device.pl: Release the reservation on error.
	* server-src/amtape.pl: Release the reservation on error,
	  change 'amtape taper' output to be the same as amcheck.
	* installcheck/amtape.pl: Fix for new amtape output.

2011-08-31  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/debug.c (debug_printf): Print a thread id.
	* device-src/xfer-dest-taper-cacher.c,
	  device-src/xfer-dest-taper-directtcp.c,
	  device-src/xfer-dest-taper-splitter.c,
	  device-src/xfer-source-recovery.c,
	  server-src/xfer-dest-holding.c: Remove printing of thread id.

2011-08-31  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: filter stderr make result strange,
			       filter exit_code != 0 make it fail.


2011-08-31  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Do not rename gnutar-list if record is not
	  set.

2011-08-31  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/tapefile.h (struct tape_s): Add blocksize.
	* server-src/tapefile.c: Print and parse blocksize in tapelist file.
	* perl/Amanda/Tapelist.swg: Print and parse blocksize in tapelist file.
	* perl/Amanda/Taper/Scribe.pm: Add blocksize argument to add_tapelabel.
	* server-src/amlabel.pl: Add blocksize argument to add_tapelabel.
	* installcheck/Amanda_Tapelist.pl: Fix for tapelist file format.
	* installcheck/amlabel.pl: Fix for tapelist file format.

2011-08-31  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.h (struct Device): Add header_block_size.
	* device-src/null-device.c, device-src/rait-device.c,
	  device-src/s3-device.c, device-src/tape-device.c,
	  device-src/vfs-device.c: Set header_block_size.
	* perl/Amanda/Device.swg: Swig header_block_size.

2011-08-31  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Device.pl: Fix number of skipped test for S3.

2011-08-31  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Print why a disk is skip if DS_NOINC.

2011-08-30  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Device.pl: Check invalid location on s3 device.

2011-08-30  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c (s3_is_bucket_exists): Do not retry if bucket do
	  not exists.

2011-08-30  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c (s3_is_bucket_exists): New function to check if a
	  bucket exists.
	* device-src/s3.h (s3_is_bucket_exists): Prototype.
	* device-src/s3-device.c: Call s3_is_bucket_exists before
	  s3_make_bucket.

2011-08-29  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/multi.pm: Keep the device_error in the state file.
	* perl/Amanda/Changer/robot.pm: Keep the device_error in the state file.
	* server-src/amtape.pl (inventory): Print inventory device error.
	* installcheck/Amanda_Changer_multi.pl,
	  installcheck/Amanda_Changer_ndmp.pl,
	  installcheck/Amanda_Changer_robot.pl: Fix for device_error in
	  state file.

2011-08-29  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: Fix warning.

2011-08-29  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Changer_ndmp.pl,
	  installcheck/Amanda_Changer_robot.pl: Fix for previous patch.

2011-08-29  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: return a reservation even on error.

2011-08-29  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Gunar Gunnarsson
	* server-src/amvault.pl: Cast $dump->{'kb'} to int.

2011-08-24  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda-devices.7.xml: Update S3 location url.

2011-08-24  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/match.c: Fix for 'Trailing backslash' error
	* common-src/match-test.c: Add test

2011-07-27  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c, client-src/calcsize.c,
	  client-src/killpgrp.c, client-src/noop.c,
	  client-src/rundump.c, client-src/runtar.c,
	  client-src/selfcheck.c, client-src/sendbackup.c,
	  client-src/sendsize.c, ndmp-src/amndmjob_main.c,
	  server-src/amcleanupdisk.c, server-src/amindexd.c,
	  server-src/amtrmidx.c, server-src/amtrmlog.c,
	  server-src/driver.c, server-src/dumper.c,
	  server-src/planner.c: Add a --version argument.

2011-07-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amservice.c, recover-src/amrecover.c,
	  server-src/amflush.c: #include "getopt.h"

2011-07-27  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: add ARCHIVEDIR, CLEANUPWAL, DB,
	  HOST, MAX-WAL-WAIT, PASSFILE, PORT, PSQL-PATH and USER
	  properties.
	* man/xml-source/ampgsql.8.xml: Document them.

2011-07-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amservice.c, recover-src/amrecover.c,
	  server-src/amcheck.c, server-src/amflush.c: Add a --version argument.

2011-07-27  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c: Check return value of fgets.

2011-07-27  Jean-Louis Martineau <martineau@zmanda.com>
	* many */*.pl: add --version option.

2011-07-27  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: print to debug file and server if unlink
	  fail.

2011-07-25  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amgtar.8.xml, man/xml-source/amraw.8.xml,
	  man/xml-source/amsamba.8.xml, man/xml-source/amstar.8.xml,
	  man/xml-source/amsuntar.8.xml,
	  man/xml-source/amzfs-sendrecv.8.xml: Document the diskdevice.

2011-07-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: new '--client-verbose' option.
	* man/xml-source/amcheck.8.xml: Document --client-verbos
	* config/amanda/progs.m4 (AMANDA_PROG_UNAME): new macro to find uname
	  path.
	* configure.in: call AMANDA_PROG_UNAME.
	* client-src/client_util.c (check_access, check_file, check_dir,
	  check_suid): return a gboolean.
	* client-src/client_util.h: Change prototypes.
	* client-src/selfcheck.c: Print the platform.
	* common-src/util.c (get_first_line): new function to return the first
	  output line of a command.
	* common-src/util.h (get_first_line): add prototype.
	* application-src/amgtar.c, application-src/ampgsql.pl,
	  application-src/amraw.pl, application-src/amsamba.pl,
	  application-src/amstar.c, application-src/amsuntar.pl,
	  application-src/amzfs-sendrecv.pl: print version of program.

2011-07-22  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: Fix warning if $s is not used.

2011-07-22  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: Support minimun number of digit in $3s
	  autolabel template.
	* man/xml-source/amanda.conf.5.xml: Document it.

2011-07-21  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/multi.pm (do_release): Support eject params.
	* perl/Amanda/Changer/single.pm (do_release): Do the eject correctly.

2011-07-21  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda-taperscan.7.xml: Typo.

2011-07-20  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.h: Add CONF_EJECT_VOLUME
	* common-src/conffile.c: Add CNF_EJECT_VOLUME
	* man/xml-source/amanda.conf.5.xml: Document eject-volume.
	* perl/Amanda/Config.swg: Add CNF_EJECT_VOLUME.
	* perl/Amanda/Changer/single.pm: Eject the device if the eject
	  params is set in $res->release()
	* perl/Amanda/Taper/Scribe.pm (new): Get eject_volume params.
	* perl/Amanda/Taper/Scribe.pm (_release_reservation): Call
	  $res->release with the eject params if needed.
	* perl/Amanda/Taper/Worker.pm: Make the Scribe with the eject_volume
	  params set to $CNF_EJECT_VOLUME

2011-07-20  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm (make_error): callback is optional.
	* perl/Amanda/Changer/disk.pm: Check if disk is mounted before locking.
	* perl/Amanda/ScanInventory.pm (_scan): fail only on fatal error.
	* perl/Amanda/Taper/Controller.pm: Put error message in double quote.
	* perl/Amanda/Taper/Worker.pm: Put message in double quote.

2011-07-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (tape_action): consider number of dle on volume
	  and max-dle-by-volume for allowing use of new volume.

2011-07-15  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda-changers.7.xml: Add chg-single documentation.

2011-07-14  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c:Increase S3_DEVICE_MAX_BLOCK_SIZE to 3GiB.

2011-07-14  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c:Increase S3_DEVICE_MAX_BLOCK_SIZE to 5TiB.

2011-07-13  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add CONF_MAX_DLE_BY_VOLUME.
	* common-src/conffile.h: Add CNF_MAX_DLE_BY_VOLUME.
	* man/xml-source/amanda.conf.5.xml: Document max-dle-by-volume.
	* perl/Amanda/Config.swg: Add CNF_MAX_DLE_BY_VOLUME.
	* perl/Amanda/Taper/Controller.pm: Add msg_CLOSE_VOLUME method.
	* perl/Amanda/Taper/Protocol.pm: Add CLOSE_VOLUME.
	* perl/Amanda/Taper/Scribe.pm: Add close_volume method, call
	  _get_new_volume() is close_volume was called.
	* perl/Amanda/Taper/Worker.pm: Add CLOSE_VOLUME method.
	* server-src/driver.c: Send CLOSE_VOLUME command to taper if the
	  number of dle on a volume is larger than max-dle-by-volume
	* server-src/driverio.c: Send CLOSE_VOLUME command.
	* server-src/driverio.h: Add nb_dle to taper_t.
	* server-src/server_util.c: Add "CLOSE-VOLUME" to cmdstr.
	* server-src/server_util.h: Add CLOSE_VOLUME.

2011-07-12  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/libs.m4: Fix use of AC_LINK_IFELSE.

2011-07-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/match.c (match_word): better matching for anchored
	  expression.
	* common-src/match-test.c: Add new tests.

2011-07-11  Jean-Louis Martineau <martineau@zmanda.com>
        Add '$s' substitution to autolabel.
	* perl/Amanda/Changer.pm (make_new_tape_label): Handle $s.
	* perl/Amanda/Taper/Scan/lexical.pm, perl/Amanda/Taper/Scan/oldest.pm,
	  perl/Amanda/Taper/Scribe.pm: Call make_new_tape_label with the slot.
	* man/xml-source/amanda.conf.5.xml: Document $s substitution.

2011-07-08  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: Fix compuation of npercents and
	  nexclamations.

2011-07-07  Jean-Louis Martineau <martineau@zmanda.com>
	* config/ltmain.sh, config/lt~obsolete.m4, config/ltoptions.m4,
	  config/ltsugar.m4, config/ltversion.m4: Upgrade libtool to 2.4

2011-07-07  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/libs.m4: Fix for newer aclocal
	* config/libtool.m4: Upgrade for compatibility with newwe aclocal

2011-07-07  Jean-Louis Martineau <martineau@zmanda.com>
	* Many *.c files: Fix for gcc-4.6.0 warning: variable NAME set but
	  not used.

2011-07-07  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: Keep the barcode when relabeling a tape

2011-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Retry up to 120 seconds if the sense
	  key is 'Not Ready'

2011-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: Add letter based sequence to autolabel
	  and meta-autolabel.
	* man/xml-source/amanda.conf.5.xml: Document them.

2011-06-29  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amstar.c: s/stralloc/g_strdup/

2011-06-29  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amstar.c: typo.

2011-06-29  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Call short_dump_state on all state change.

2011-06-29  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by p_michalczyk
	* application-src/amstar.c: Place command_options at the and of
	  command line.

2011-06-29  Jean-Louis Martineau <martineau@zmanda.com>
	Replace semaphore by amsemaphore.
	* common-src/Makefile.am: Remove semaphore.*, add amsemaphore.*
	* common-src/amsemaphore-test.c: New copy of semaphore-test.c
	* common-src/amsemaphore.c: New copy of semaphore.c
	* common-src/amsemaphore.h: New copy of semaphore.h
	* common-src/semaphore-test.c: Removed file.
	* common-src/semaphore.c: Removed file.
	* common-src/semaphore.h: Removed file.
	* device-src/rait-device.c: s/semaphore_/amsemaphore_/g
	* xfer-src/element-glue.c: s/semaphore_/amsemaphore_/g
	* xfer-src/element-glue.h: s/semaphore_/amsemaphore_/g

2011-06-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Check holding file is in a holding directory.

2011-06-27  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda-devices.7.xml: s/Witout/Without/

2011-06-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/xfer-dest-holding.c: Check return value of ftruncate.
	* perl/Amanda/Logfile.swg: Remove debugging statement.

2011-06-21  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amanda.h: Remove KAMANDA_SERVICE_NAME, SERVICE_SUFFIX,
	  AMANDA_SERVICE_DEFAULT and KAMANDA_SERVICE_DEFAULT.
	* common-src/bsd-security.c: Use AMANDA_SERVICE_NAME.
	* common-src/bsdtcp-security.c: Use AMANDA_SERVICE_NAME.
	* common-src/bsdudp-security.c: Use AMANDA_SERVICE_NAME.
	* common-src/util.c: Use AMANDA_SERVICE_NAME.
	* config/amanda/debugging.m4: Remove AMANDA_WITH_TESTING
	* configure.in: Remove AMANDA_WITH_TESTING.
	* oldrecover-src/amrecover.c: Remove SERVICE_SUFFIX.
	* oldrecover-src/extract_list.c: Remove SERVICE_SUFFIX.
	* client-src/patch-system.sh: Set SERVICE_SUFFIX to "".

2011-06-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/chunker.c: Remove file.
	* server-src/chunker.pl: New perl chunker.
	* perl/Amanda/Chunker/Controller.pm,
	  perl/Amanda/Chunker/Protocol.pm,
	  perl/Amanda/Chunker/Scribe.pm: Perl object for chunker.
	* perl/Amanda/Logfile.swg (make_chunker_stats): New function.
	* perl/Amanda/XferServer.swg: Add Amanda::Xfer::Dest::Holding.
	* perl/Amanda/Xfer.pod: Document Amanda::Xfer::Dest::Holding.
	* perl/Amanda/Xfer.swg: Add XMSG_CHUNK_DONE and new xmsg arguments.
	* perl/Makefile.am: Add Amanda::Chunker::*
	* server-src/Makefile.am (amlibexec_PROGRAMS): Remove chunker.
	* server-src/Makefile.am (amlibexec_SCRIPTS_PERL): Add chunker.
	* server-src/driver.c: Fix for new protocol with chunker.
	* server-src/driverio.c: Fix for new protocol with chunker.
	* server-src/driverio.h: Add sendresult in chunker_t.
	* server-src/xfer-dest-holding.c: New xfer destination for holding disk
	* server-src/xfer-server.h: Add function for xfer_dest_holding.
	* xfer-src/xmsg.h: Add XMSG_CHUNK_DONE in xmsg_type.
	  Add header_size, data_size and no_room in XMsg.
	* installcheck/chunker.pl: Check new chunker protocol.

2011-06-21  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda-client.conf.5.xml: Add amdump-server.
	* man/xml-source/amdump_client.8.xml: Fix doc.

2011-06-21  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: Fix add_tapelabel call.

2011-06-20  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: Correcly make label with meta and barcode

2011-06-20  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amrecover.8.xml: Document new settranslate command.
	* recover-src/amrecover.c: Add disk_tpath,
	* recover-src/amrecover.c (translate_octal): New function.
	* recover-src/amrecover.h: Add tpath to DIR_ITEM.
	* recover-src/display_commands.c: Set and use tpath.
	* recover-src/extract_list.c: Use tpath
	* recover-src/help.c: Add settranslate command.
	* recover-src/set_commands.c: Set and tpath.
	* recover-src/uparse.y: Parse settranslate command.
	* recover-src/uscan.l: Add SETTRANSLATE keyword.

2011-06-17  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm, perl/Amanda/Recovery/Planner.pm,
	  perl/Amanda/Recovery/Clerk.pm,
	  perl/Amanda/Taper/Scribe.pm: Fix for qw syntax in perl 5.14.

2011-06-13  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: implement regex caching with two mutex-protected
	  GHashTables (one for REG_NEWLINE, one for !REG_NEWLINE)

2011-06-13  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: rename do_validate_regex() to do_regex_compile()

2011-06-13  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: match_word(): earlier init of static data

2011-06-13  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: static corner case regex definitions for
	  match_word()

2011-06-13  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: match_word(): push down nglob variable, rename it
	  to glob_copy

2011-06-13  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: move word wrapping out of match_word() into new
	  helper wrap_word()

2011-06-13  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: ambloc_to_regex(): calculate worst case expansion
	  dynamically

2011-06-13  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: ambloc_to_regex(): pass beginning and end of regex
	  as arguments

2011-06-13  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: group functions logically together, add comments

2011-06-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Worker.pm: s/messsage/message/.

2011-06-09  Dustin J. Mitchell <dustin@mozilla.com>
	* client-src/selfcheck.c: Push down tmpbuf and remove some duplicate
	  code; fixes compiles with SAMBA_VERSION not defined

2011-06-09  Francis Galiegue <fgaliegue@gmail.com>
	* gnulib/*: revert blind perl one-liner replacement of alloc to
	  g_malloc, by doing the reverse transform exactly

2011-06-09  Francis Galiegue <fgaliegue@gmail.com>
	* oldrecover-src/amrecover.c: fix one more wrong g_str_has_prefix()
	  usage

2011-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* oldrecover-src/extract_list.c,
	  recover-src/extract_list.c: Fix g_str_has_prefix.
	* server-src/amtrmlog.c: Revert g_str_has_prefix. fix.

2011-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindexd.c: Fix g_str_has_prefix.

2011-06-09  Francis Galiegue <fgaliegue@gmail.com>
	* Many files (77): use g_str_equal() insteadl of strcmp(...) == 0 (and
	  reverse),use g_str_has_prefix() instead of strncmp(...) == 0 (and
	  reverse)

2011-06-09  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/alloc.c, common-src/amanda.h: goodbye vstrextend() and
	  internal_vstralloc()

2011-06-09  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/tapefile.c: list_new_tapes(): replace vstrextend() usage
	  with a GString; rework exit paths

2011-06-09  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/dumper.c: delay_one_dump(): replace vstrextend() with a
	  GPtrArray/GString combination; create one local variable

2011-06-09  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/dumper.c: startup_dump(): replace vstrextend() with a
	  GString; fix boolean usage

2011-06-09  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/driverio.c: dumper_cmd(): replace vstrextend() usage with a
	  GPtrArray, and replace some g_strjoin() usages with g_strdup_printf()

2011-06-09  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/diskfile.c: match_disklist(): replace vstrextend() with a
	  GString; fix spelling mistake
	* installcheck/amadmin.pl: account for spelling mistake

2011-06-09  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/diskfile.c: xml_scripts(): replace vstrextend() with a
	  GString

2011-06-09  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/diskfile.c: xml_application(): replace vstrextend() with a
	  GString

2011-06-09  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/diskfile.c: xml_property(): replace vstrextend() with a
	  GString

2011-06-09  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/diskfile.c: xml_estimate(): replace vstrextend() with a
	  GString

2011-06-09  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/diskfile.c: xml_optionstr(): replace vstrextend() with a
	  GPtrArray and a GString

2011-06-09  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/diskfile.c: optionstr(): replace vstrextend() with a
	  GPtrArray

2011-06-09  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/amindexd.c: main(): replace vstrextend() with a GString

2011-06-09  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/amcheck.c: start_host(): replace vstrextend() with a
	  GString

2011-06-09  Francis Galiegue <fgaliegue@gmail.com>
	* recover-src/extract_list.c: read_amidxtaped_data(): replace
	  vstrextend() with g_strdup_printf()

2011-06-07  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Do not check optarg, we know it is not null
	* common-src/conffile.c: Do not check key_ovr, we know it is not null

2011-06-06  Satya Ganga <gsat@zmanda.com>
	* perl/Amanda/Application/Zfs.pm: Use correct device name, we have to
	use user provided Disk device name.

2011-06-06  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/rundump.c: Fix cast of g_ptr_array_free to (gchar **).

2011-06-04  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/util.c: remove usage of vstrextend() by using a GString. No
	  choice here, we have to peek into the GPtrArray.

2011-06-04  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/tapelist.c: remove usages of vstrextend() with a
	  GPtrArray/GString combination

2011-06-04  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/pipespawn.c: remove usage of vstrextend() with a GPtrArray

2011-06-04  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/fileheader.c: remove usage of vstrextend() with a GPtrArray

2011-06-04  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/conffile.c: replace the third and final usage of vstrextend()
	  in exinclude_display_str()

2011-06-04  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/conffile.c: replace the second usage of vstrextend() in
	  proplist_display_str_foreach_fn() using a GPtrArray

2011-06-04  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/conffile.c: replace one usage of vstrextend() in
	  val_t_display_strs() with a GString

2011-06-04  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/amservice.c: use a GString in replacement of vstrextend()

2011-06-04  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/planner.c: use a GPtrArray to collect client estimate
	  strings

2011-06-04  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/planner.c: shortcut when no client estimates are to be done
	  - one less indendation level

2011-06-04  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/planner.c: get text-based estimate string generation out of
	  getsize()

2011-06-04  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/planner.c: remove variables qname and qdevice

2011-06-04  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/planner.c: push down variables qname and qdevice

2011-06-04  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/planner.c: use the previously create GString all along to
	  append to the request

2011-06-04  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/planner.c: check for the number of estimates available
	  rather than the string concatenation of them

2011-06-04  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/planner.c: push up optionstr() check

2011-06-04  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/planner.c: rework DLE estimate string generation in the non
	  XML case

2011-06-04  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/planner.c: extripate XML DLE estimate generation out of
	  getsize() into a new helper function

2011-06-03  Francis Galiegue <fgaliegue@gmail.com>
	* client-src/sendsize.c: remove the second usage of vstrextend() by
	  using g_ptr_array_free(..., FALSE) and g_strjoinv() on an existing
	  GPtrArray; avoid accessing its ->ptr member: you shouldn't do that

2011-06-03  Francis Galiegue <fgaliegue@gmail.com>
	* client-src/sendsize.c: remove one usage of vstrextend() by using
	  g_ptr_array_free(..., FALSE) and g_strjoinv() on an existing GPtrArray;
	  avoid accessing its ->ptr member: you shouldn't do that

2011-06-03  Francis Galiegue <fgaliegue@gmail.com>
	* client-src/selfcheck.c: build the command line using a GPtrArray
	  instead of vstrextend(); don't peek into the original GPtrArray

2011-06-03  Francis Galiegue <fgaliegue@gmail.com>
	* client-src/runtar.c: build the command line using a GPtrArray
	  instead of vstrextend()

2011-06-03  Francis Galiegue <fgaliegue@gmail.com>
	* client-src/rundump.c: build the command line using a GPtrArray
	  instead of vstrextend()

2011-06-03  Francis Galiegue <fgaliegue@gmail.com>
	* client-src/client_util.c: don't peek into the GPtrArray directly, but
	  use g_ptr_array_free(..., FALSE) and g_strjoinv() instead; this
	  removes a usage of vstrextend()

2011-06-03  Francis Galiegue <fgaliegue@gmail.com>
	* application-src/amgtar.c: use a GString to build the error buffer
	  instead of vstrextend()

2011-06-03  Francis Galiegue <fgaliegue@gmail.com>
	* amandad-src/amandad.c: replace vstrextend() usage by using a GString

2011-06-03  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/planner.c: variable renaming and type change: "time_t
	  estimates" is now "int total_estimates"; new local variable
	  "estimates_for_client" as placeholder for "i" when appropriate

2011-06-03  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/planner.c: use g_strdup_printf() instead of g_strjoin() to
	  build various strings; remove 4 local variables in the process

2011-06-03  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/planner.c: write the beginning of a request using a GString
	  instead of using g_strjoin()

2011-06-03  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/planner.c: deal with noop first, jump to a new label
	  "send", and reindent - one less indentation level

2011-06-03  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/planner.c: Define nb_client, nb_server and has_* earlier.
	  This is a preparation for the next commit.

2011-06-03  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/planner.c: remove two unused variables

2011-06-02  Francis Galiegue <fgaliegue@gmail.com>
	* client-src/sendbackup-dump.c: fix compile error due to undeclared
	  tmpbuf, remove tmpbuf entirely

2011-06-02  Francis Galiegue <fgaliegue@gmail.com>
        * Many files (12): remove unndeeded uses of the temporary variable
	  tmpbuf in the g_strdup_printf(e1, e2, ..., NULL) case

2011-06-02  Francis Galiegue <fgaliegue@gmail.com>
        * Many files (15): remove unndeeded uses of the temporary variable
	  tmpbuf in the g_strconcat(e1, e2, ..., NULL) case

2011-06-02  Francis Galiegue <fgaliegue@gmail.com>
        * Many files (14): remove unndeeded uses of the temporary variable
	  tmpbuf in the g_strconcat(e1, e2, NULL) case

2011-06-02  Francis Galiegue <fgaliegue@gmail.com>
	* Many files (14): Get rid of newvstrallocf()
	* common-src/amanda.h, common-src/alloc.c: remove macro, prototypes,
	  implementation

2011-06-02  Francis Galiegue <fgaliegue@gmail.com>
	* Many files (20): Get rid of newvstralloc()
	* common-src/amanda.h, common-src/alloc.c: remove macro, prototypes,
	  implementation

2011-06-02  Francis Galiegue <fgaliegue@gmail.com>
	* Many files (6): Get rid of newstralloc2()
	* common-src/amanda.h: remove macro

2011-06-02  Francis Galiegue <fgaliegue@gmail.com>
	* Many files (28): Get rid of stralloc2()
	* common-src/amanda.h: remove macro

2011-06-02  Francis Galiegue <fgaliegue@gmail.com>
	* Many files (30): Get rid of newstralloc()
	* common-src/alloc.c, common-src/amanda.h: remove macros, prototypes,
	  implementation

2011-06-02  Francis Galiegue <fgaliegue@gmail.com>
	* client-src/getfsent.c: remove dev2rdev() and remnant artifacts in
	  search_fstab() and samefile()
	* common-src/genversion.c, installcheck/catalogs/chunker-partial.cat:
	  remove RDEV_PREFIX references
        * config/amanda/devprefix.m4: remove RDEV_PREFIX detection

2011-06-02  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/conffile.c: use execute_on_to_string() in
	  val_t_display_strs()

2011-06-02  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/conffile.c: use execute_on_to_string() in
	  val_t_display_strs()

2011-06-02  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/conffile.c: add execute_on_to_string() helper

2011-06-02  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/conffile.h: harden EXECUTE_ON_* macro definitions

2011-06-02  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/dumper.c: fix a missing switch of default auth to BSDTCP

2011-06-01  Dustin J. Mitchell <dustin@mozilla.com>
	* perl/Amanda/Holding.pm: fix _is_datestamp regexp to be anchored and
	  handle errors better (logging and ignoring)

2011-06-01  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/diskfile.c: fix a memory leak in xml_scripts()

2011-06-01  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/diskfile.c: fix a memory leak in xml_application()

2011-06-01  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/cmdline.c: fix braino with g_strjoinv() usage,
	  g_strjoinv("xx", {   NULL, }) will return an empty string, not NULL

2011-05-31  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/diskfile.[ch]: change method signature for
	  validate_optionstr(), it now returns a gchar ** instead of a
	  GPtrArray *, and the result is dynamicallu allocated
	* server-src/amcheck.c, server-src/amindexd.c, server-src/driver.c,
	  server-src/planner.c: adapt call sites; fix memory leak for the two
	  latter, and wrong behaviour for all of them (you cannot
	  g_ptr_array_free(..., TRUE) on statically allocated members)

2011-05-31  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in: Move AMANDA_S3_DEVICE to do libcurl detection later.

2011-05-31  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS, ReleaseNotes: Update for 3.3.0 release.

2011-05-31  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/diskfile.c: fix unbalanced tag in xml_estimate()

2011-05-31  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/diskfile.c: avoid potential SIGSEGV by trying to assign to
	  local variables "their_features" too soon in optionstr() and
	  xml_optionstr(); also remove an unneeded local variable in both
	  functions

2011-05-31  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/diskfile.c: remove unneeded if(var) test in
	  xml_optionstr(), the variable tested was never NULL

2011-05-30  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/list_dir.c: fix add_dir_list_item.

2011-05-27 Dan Locks <dwlocks@zmanda.com>
	*  packaging/rpm/amanda.spec.src: replace enable-as-needed rpm macro
	   with enable_as_needed.

2011-05-24 Dan Locks <dwlocks@zmanda.com>
	*  packaging/deb/rules: use --enable-as-needed
	*  packaging/rpm/amanda.spec.src: use --enable-as-needed except on
	   sles9, where ld does not have the --as-needed flag.

2011-05-23  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/debug.c: debug_unlink_old(): the realloc was meant to
	  happen each time the loop was entered and dbfilename was not NULL, fix

2011-05-24  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Parse and filter stdout/stderr of
	  commands.

2011-05-23  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/conffile.c: the prototype for str_keyword() was defined
	  twice, remove one definition

2011-05-23  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/krb5-security.c: use cpp's #error to signal the lack of
	  atexit()

2011-05-23  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/genversion.c: use do { ... } while(0) to #define
	  the startline() macro

2011-05-23  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/cmdline.c: [GLib] rewrite
	  cmdline_format_dumpspec_components() using a GPtrArray and
	  g_strjoinv()

2011-05-23  Francis Galiegue <fgaliegue@gmail.com>
	* client-src/sendbackup-dump.c, common-src/debug.c,
	  common-src/krb5-security.c, common-src/security-util.c,
	  recover-src/amrecover.c, recover-src/extract_list.c,
	  server-src/dumper.c, server-src/planner.c: use newstralloc() where
	  possible instead of /^newvstrallocf?/()

2011-05-23  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/debug.c: remove tests for failled allocations and allocate
	  directly, failed allocations would make the program abort anyway

2011-05-23  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/amanda.h, common-src/alloc.c: remove dead function and
	  prototypes of newalloc()

2011-05-23  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/arglist.h: remove
	* common-src/amanda.h: define the arglist_{start,val,end} macros here
	* various *.[ch]: redeclare header/static function prototypes using
	  G_GNUC_PRINTF()

2011-05-22  Dustin J. Mitchell <dustin@mozilla.com>
	* installchecks/Amanda_Config.pl: add columnspec validation tests

2011-05-22  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/conffile.c: implement columnspec validation
	* server-src/amcheck.c: remove columnspec validation in
	  start_server_check()
	* common-src/columnar.[ch]: remove; update Makefile.am accordingly

2011-05-18  Jean-Louis Martineau <martineau@zmanda.com>
	* Fix for default BSDTCP auth.

2011-05-18  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c,
	  common-src/conffile.c: Change default auth to bsdtcp.
	* NEWS, ReleaseNotes: Change default auth to bsdtcp.
	* example/amanda-client.conf.in,
	  example/amanda.conf.in: Change default auth to bsdtcp.
	* man/xml-source/amanda-auth.7.xml,
	  man/xml-source/amanda-client.conf.5.xml,
	  man/xml-source/amanda.conf.5.xml,
	  man/xml-source/amrecover.8.xml: Change default auth to bsdtcp.

2011-05-18  Dustin J. Mitchell <dustin@mozilla.com>
	* common-src/event.c common-src/event.h: add event_loop_run and
	  event_loop_quit to mirror g_main_loop_run/quit
	* perl/Amanda/MainLoop.swg: use them from Amanda::MainLoop

2011-05-18  Francis Galiegue <fgaliegue@gmail.com>
	* amandad-src/amandad.c: remove a stralloc() leftover :(

2011-05-18  Francis Galiegue <fgaliegue@gmail.com>
	* amandad-src/amandad.c: use switch instead of if ... else if ... to
	  handle error buffer appends

2011-05-18  Francis Galiegue <fgaliegue@gmail.com>
	* amandad-src/amandad.c: append to errbuf when a read error occurs on
	  errfd - the message was created but never used

2011-05-18  Francis Galiegue <fgaliegue@gmail.com>
	* amandad-src/amandad.c: ensure NETWORK_BLOCK_BYTES are available to
	  read replies

2011-05-18  Francis Galiegue <fgaliegue@gmail.com>
	* amandad-src/amandad.c: factorize reply buffer offset handling, it is
	  the same for n >= 0

2011-05-18  Francis Galiegue <fgaliegue@gmail.com>
	* amandad-src/amandad.c: handle reply buffer extension in only one place

2011-05-18  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/file.c: GLib: rewrite sanitise_filename() as a simple
	  wrapper over g_strdelimit()

2011-05-18  Francis Galiegue <fgaliegue@gmail.com>
	* Many files (51): GLib: change vstralloc(...) for g_strjoin(NULL, ...)
	* common-src/alloc.c, common-src/amanda.h: remove prototypes/macros of
	  vstralloc()
	* server-src/driverio.c: add one missing NULL to the list of arguments
	  along the way

2011-05-18  Francis Galiegue <fgaliegue@gmail.com>
	* Many files (31): GLib: change vstrallocf() for g_strdup_printf();
	  change to a simple g_strup() when possible
	* common-src/alloc.c, common-src/amanda.h: remove prototypes/macros of
	  vstrallocf()

2011-05-18  Francis Galiegue <fgaliegue@gmail.com>
	* Many files (54): GLib: change alloc() for g_malloc()
	* common-src/alloc.c, common-src/amanda.h: remove prototypes/macros of
	  alloc()

2011-05-18  Francis Galiegue <fgaliegue@gmail.com>
	* Many files (79): GLib: change stralloc() for g_strdup()
	* common-src/alloc.c, common-src/amanda.h: remove prototypes/macros of
	  stralloc()

2011-05-17  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/gnutar.pl: Fix gnutar pattern matching for gtar 1.25.

2011-05-17  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/ndmp-device.c: s/NDMP4_/NDMP9_/g

2011-05-17  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amrecover.8.xml: Add an AUTH section.

2011-05-13  Francis Galiegue <fgaliegue@gmail.com>
	* amandad-src/amandad.c: in recv_errfd(): two more NETWORK_BLOCK_BYTES
	  usages and a fix: g_snprintf() conforms to C99 and the C99 standard
	  states that the result string will always be nul terminated

2011-05-13  Francis Galiegue <fgaliegue@gmail.com>
	* amandad-src/amandad.c: in recv_errfd(): fix 'buf' local variable
	  handling (you should write to buf, not &buf, and when n bytes have
	  been read, you should zero byte[n], not byte[n+1])

2011-05-13  Francis Galiegue <fgaliegue@gmail.com>
	* amandad-src/amandad.c: use the NETWORK_BLOCK_BYTES constant to declare
	  the size of local variable 'buf' in recv_errfd()

2011-05-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Controller.pm, perl/Amanda/Taper/Protocol.pm,
	  perl/Amanda/Taper/Worker.pm: Remove uneeded '#! @PERL@' first line.

2011-05-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amdump.pl: s/Catched/Caught/

2011-05-11  Francis Galiegue <fgaliegue@gmail.com>
	* Many files (19): get rid of custom array size calculations, use
	  GLib's G_N_ELEMENTS() instead; some minor cleanups along the way.
	  NOTE: gnulib's sources UNTOUCHED

2011-05-11  Francis Galiegue <fgaliegue@gmail.com>
	* Many files (63): get rid of the SIZEOF() macro, replace with sizeof()
	  everywhere

2011-05-11  Francis Galiegue <fgaliegue@gmail.com>
	* device-src/device.c: further simplify device name validation; the
	  errmsg argument to validate_device_name() was not necessary anymore,
	  remove and adapt device_open() accordingly

2011-05-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amdump.pl: Trap ctrl-c while backup is running, resume by
	  sending email and log rotation.

2011-05-11  Francis Galiegue <fgaliegue@gmail.com>
	* server-src/chunker.c: in do_chunk(): full_read() error checking was
	  done only after two calls to amclose(), which potentially sets errno;
	  fix by using read_fully(), capture a possible read error, and check it
	  at the correct place instead

2011-05-11  Francis Galiegue <fgaliegue@gmail.com>
	* ndmp-src/amndma_tape_simulator.c: "full_read() vs read(2)" behavior
	  confusion fix; check only for errors

2011-05-11  Francis Galiegue <fgaliegue@gmail.com>
	* device-src/xfer-dest-taper-splitter.c: "full_read() vs read(2)"
	  behavior confusion fix; ignore error checking

2011-05-11  Francis Galiegue <fgaliegue@gmail.com>
	* amar-src/amar.c: fix "full_read() vs read(2)" behavior confusion,
	  full_read does NOT return -1 on error. Rework the function as to
	  avoid goto. Comment on the fact that we want to read as much as
	  possible even if an error occurs.

2011-05-11  Francis Galiegue <fgaliegue@gmail.com>
	* xfer-src/element-glue.c: use read_fully(), and modify error reporting.
	  Since the read operation output can be captured straight on by
	  read_fully(), use that opportunity here instead of grabbing a saved
	  errno

2011-05-11  Francis Galiegue <fgaliegue@gmail.com>
	* amar-src/amar.c, common-src/amflock.c,
	  device-src/xfer-dest-taper-cacher.c, server-src/amcheck.c,
	  server-src/chunker.c, server-src/driver.c, server-src/holding.c,
	  server-src/xfer-source-holding.c, xfer-src/element-glue.c,
	  xfer-src/xfer-element.c, xfer-src/xfer-test.c: straight replacement of
	  full_read(...) with read_fully(..., NULL) since in these usages error
	  checking was not done

2011-05-11  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/file.[ch]: new read_fully() function, designed to replace
	  usages of full_read() which, even though it shares its prototype with
	  read(2), behaves very differently and leads (and has led) to
	  convoluted codes in some places, and bugs in other places

2011-05-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Script_App.pm: Call finish_application before exit,
	  exit as last statement of the do method.
	* application-src/amlog-script.pl, application-src/ampgsql.pl,
	  application-src/amraw.pl, application-src/amsamba.pl,
	  application-src/amsuntar.pl, application-src/amzfs-sendrecv.pl,
	  application-src/amzfs-snapshot.pl,
	  application-src/script-email.pl: Add --version option, do not exit
	  at end of command_* method.

2011-05-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: Call $device->finish() before
	  $device->read_label(), A device must be in ACCESS_NULL for read_label.

2011-05-09  Francis Galiegue <fgaliegue@gmail.com>
	* device-src/device.c: rework full device name validation

2011-05-08  Francis Galiegue <fgaliegue@gmail.com>
	* device-src/device.c: add missing regfree() in case or regex compile
	  failure

2011-05-07  Francis Galiegue <fgaliegue@gmail.com>
	* device-src/ndmp-device.c: fix gcc 4.5.x warnings with enums

2011-05-06  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Fix errors/warnings found by klocwork
	* application-src/amstar.c: Fix errors/warnings found by klocwork

2011-05-06  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Fix klocwork bug.

2011-05-05  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Do not crash on unterminated quoted string.

2011-05-05  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amzfs-sendrecv.pl: Implement restore.
	  Generate index with only '/'.
	* perl/Amanda/Application/Zfs.pm: Add $self->{filesystem} on some
	  command, improve zfs_build_snapshotname.
	* server-src/list_dir.c (add_dir_list_item): Check if same dump.

2011-05-05  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/local-security.c: Call initgroups before executing amandad

2011-05-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Do not count dup to tape when checking space
	  on holdingdisk.

2011-05-02  Jean-Louis Martineau <martineau@zmanda.com>
	Fix many errors/warnings found by klocwork
	* Many files.

2011-04-29  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3.c: Do not get "location" if bucket_location is not set.

2011-04-29  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Reply immediately a NO_NEW_TAPE if taper ask
	  REQUEST_NEW_TAPE after it is in TAPER_STATE_DONE.

2011-04-27  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Device.swg: Do not crash if an unknown device-property
	  is set.

2011-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	Fix many errors/warnings found by klocwork
	* Many files.

2011-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Split the threads property in
	  nb_threads_backup and nb_treads_recovery.
	* man/xml-source/amanda-devices.7.xml: Document it.

2011-04-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Improve balancing if some dle have strategy
	  noinc or a smaller dumpcycle.

2011-04-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amidxtaped.pl: Do the uncompress if client can't do it.

2011-04-19  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: new changer error: empty.
	* perl/Amanda/Changer/robot.pm: return empty slot.
	* perl/Amanda/Taper/Scan/traditional.pm: Handle empty slot.

2011-04-19  Jean-Louis Martineau <martineau@zmanda.com>
	Make s3 works with Eucalyptus.
	* device-src/s3-device.c: Add S3_HOST, S3_SERVICE_PATH and
	  S3_SUBDOMAIN properties. Handle NoSuchEntity and
	  BucketAlreadyOwnedByYou error.
	* device-src/s3.c: Build url from new properties.
	* device-src/s3.h: New s3_open prototype.
	* man/xml-source/amanda-devices.7.xml: Document S3_HOST,
	  S3_SERVICE_PATH and S3_SUBDOMAIN properties.

2011-04-18  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: Check generated label and meta-label.

2011-04-18  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amlabel.8.xml: Improve doc.
	* server-src/amlabel.pl: Remove spurious print.

2011-04-16  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Remove volative for s3.

2011-04-15  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Use multiple threads to do read ahead.

2011-04-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c: Do not free find result string.
	* server-src/find.c: Use GStringChunk to store all find_dump string.

2011-04-11  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Check NULL before freeing self->thread_pool,
	  free self->thread_idle_mutex and self->thread_idle_cond.

2011-04-11  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in: Use AMANDA_AS_NEEDED.
	* config/amanda/as_needed.m4: Add --as-needed, set AS_NEEDED_FLAGS.
	* client-src/Makefile.am, amandad-src/Makefile.am,
	  ndmp-src/Makefile.am, device-src/Makefile.am,
	  application-src/Makefile.am, xfer-src/Makefile.am,
	  server-src/Makefile.am, amar-src/Makefile.am,
	  common-src/Makefile.am: Add AS_NEEDED_FLAGS to many *_LDFLAGS.

2011-04-11  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Call device_set_error only from main thread.

2011-04-11  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Add S3 "THREADS" property, use multiple
	  threads to write to the s3 device.
	* man/xml-source/amanda-devices.7.xml: Document "THREADS" property for
	  s3 device.

2011-04-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/DB/Catalog.pm: Parse negative kb and orig-kb.
	* perl/Amanda/Logfile.swg: Do not write negative orig-kb.

2011-04-06  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda-devices.7.xml: Typo.

2011-04-06  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Interactivity.pm: Add documentation.

2011-04-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Fix Computation of data_lost on current and
	  next tape.

2011-04-01  Jean-Louis Martineau <martineau@zmanda.com>
	* amplot/amplot.awk: Fix for new log format, fix small -t display,
	  fix 'set key' syntax.
	* amplot/amplot.g: Fix 'set data' and 'plot' syntax.

2011-03-30  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/taper.pl: Fix installcheck for 'splitting not enabled'.

2011-03-30  Jean-Louis Martineau <martineau@zmanda.com>
	* VERSION: 4.0.0alpha

2011-03-30  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/vfs-device.c: LEOM property default to TRUE.

2011-03-30  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: Log 'splitting not enabled' on write
	  failure.

2011-03-30  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS, ReleaseNotes: Update for 3.3.0

2011-03-30  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add client-name option to application and
				 script
	* common-src/conffile.h: Add client-name option to application and
				 script
	* perl/Amanda/Config.swg: Add APPLICATION_CLIENT_NAME and
				  PP_SCRIPT_CLIENT_NAME.
	* common-src/amfeatures.c: Add fe_application_client_name and
				   fe_script_client_name.
	* common-src/amfeatures.h: Add fe_application_client_name and
				   fe_script_client_name.
	* common-src/amxml.c: Pares client_name
	* common-src/amxml.h: Add application_client_nake in dle_t and
			      client_name in script_t.
	* server-src/diskfile.c: Put client-name in xml output.
	* server-src/amcheck.c: Check client-name and fe_*_client_name.
	* client-src/client_util.c (merge_properties, merge_dles_properties):
				    new function.
	* client-src/client_util.h (merge_properties, merge_dles_properties):
				    new prototype.
	* client-src/selfcheck.c, client-src/sendbackup.c,
	  client-src/sendsize.c: Call merge_dles_properties to merge properties
	* man/xml-source/amanda-client.conf.5.xml,
	  man/xml-source/amanda.conf.5.xml: Document client-name.
	* recover-src/extract_list.c: merge properties.
	* NEWS: Add new features.

2011-03-28  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amlog-script.pl: Remove warning of unused variable.

2011-03-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheckdump.pl, server-src/amfetchdump.pl,
	  server-src/amidxtaped.pl, server-src/amrestore.pl: Use int().

2011-03-28  Jean-Louis Martineau <martineau@zmanda.com>
	* xfer-src/filter-process.c: Call g_critical if pipe() fail.

2011-03-28  Jean-Louis Martineau <martineau@zmanda.com>
	Change the Amanda:Xfer::Filter::Process api, it always create a pipe
	for the process stderr, the callers must read from it. Callers can send
	it to debug file, stderr or to amrecover.
	* installcheck/Amanda_Xfer.pl: Change for new AXF::Process API.
	* perl/Amanda/Xfer.pod: Document new AXF::Process API.
	* perl/Amanda/Xfer.swg: Change for new AXF::Process API.
	* server-src/amcheckdump.pl, server-src/amfetchdump.pl,
	  server-src/amrestore.pl: Use new AXF::Process API, send it to stderr
	  and debug file.
	* server-src/amidxtaped.pl: Use new AXF::Process API, send it to debug
	  file and amrecover.
	* xfer-src/filter-process.c: Remove log_stderr argument of
	  xfer_filter_process, add new get_err_fd method.
	* xfer-src/xfer-element.h: Change xfer_filter_process prototype.

2011-03-27  Dustin J. Mitchell <dustin@mozilla.com>
	* perl/Amanda/Util.swg: revert previous patch
	* gnulib/Makefile.am gnulib/fsusage.h
	  gnulib/regenerate/fsusage-no-bool.patch gnulib/regenerate/regenerate:
	  patch fsusage.h to not use stdbool
	* device-src/vfs-device.c: don't use 'false' and 'true' (from stdbool)

2011-03-26  Dustin J. Mitchell <dustin@mozilla.com>
	* perl/Amanda/Util.swg: include fsusage.h early in the generated C
	  to avoid problems with SWIG #undefine-ing 'bool' on Mac OS X with
	  the system-installed Perl

2011-03-25  Jan Grig <jgorig@redhat.com>
	* config/amanda/krb5-security.m4: fix linking against wrong libraries
	  on systems where krb5 directory is libdir and amanda is installed

2011-03-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Fix iteration over a list it modify.

2011-03-22  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amstar.c: read include_list and pass each line as
	  argument for restore operation.

2011-03-22  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Cast with off_t.
	* application-src/amstar.c: Cast with off_t.

2011-03-21  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amstar.c: Add ACL property.
	* man/xml-source/amstar.8.xml: Document ACL property.

2011-03-21  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/dumpers.m4: Add AMANDA_PROG_SUNTAR, --with-suntar=??
	* configure.in: Use AMANDA_PROG_SUNTAR.
	* perl/Amanda/Constants.pm.in: Define $Amanda::Constants::SUNTAR
	* application-src/amsuntar.pl: Use $Amanda::Constants::SUNTAR,
				       Add SUNTAR-PATH property.
	* man/xml-source/amsuntar.8.xml: Document SUNTAR-PATH property.

2011-03-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c: Compute maxparts from the list of part.

2011-03-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: If leom is supported by device,
	  then the dle can be split.
	* perl/Amanda/Taper/Worker.pm: Send leom setting to
	  get_splitting_args_from_config.
	* server-src/planner.c: dle can use more than one tape if allow-split
	  is set, this is to handle leom device where splitsize can be 0.

2011-03-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/disk.pm: Use -l to check symlink existance.

2011-03-10  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c: export quote host and disk name, import parse
	  quoted host and disk name.

2011-03-09  Jean-Louis Martineau <martineau@zmanda.com>
        * ReleaseNotes, NEWS: Add changes for 3.2.2 and 3.3.0.

2011-03-08  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: Use smbclient -TF for restore.

2011-03-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amtrmidx.c: Fix memory leak.

2011-03-02  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amservice.c; Moved from server-src/amservice.c
	* server-src/amservice.c: Moved to server-src/amservice.c
	* common-src/Makefile.am: Add amservice
	* man/Makefile.am: Install amservice man page on client.
	* server-src/Makefile.am: Remove amservice

2011-03-01  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm (make_new_tape_label): Fix if $tle is undef.
	* perl/Amanda/ScanInventory.pm: Call _user_msg with label argument.
	* perl/Amanda/Taper/Scan.pm: Document new user_msg_fn argument.
	* perl/Amanda/Taper/Scan/traditional.pm: Call _user_msg on various
	  tape error.
	* perl/Amanda/Taper/Scribe.pm (_user_msg_fn): Call
	  scribe_notif_log_info with error message.
	* perl/Amanda/Taper/Worker.pm: Log error in scribe_notif_new_tape.
	* installcheck/Installcheck/Config.pm: Add taperscan definition.
	* installcheck/taper.pl: Test new log.

2011-03-01  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Header.swg: Remove bogus %module.

2011-03-01  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amfeatures.c: Add fe_amrecover_receive_unfiltered.
	* common-src/amfeatures.h: Add fe_amrecover_receive_unfiltered.
	* perl/Amanda/Feature.pod: Add fe_amrecover_receive_unfiltered.
	* perl/Amanda/Header.swg: Add get_dle method, handle dle_t.
	* recover-src/extract_list.c: Pipe decompression or decyption.
	* server-src/amidxtaped.pl: Do not decompress/decrypt if amrecover
				    can do it.

2011-02-14  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: flush even if flush threshold are not met if
	  it save tape space.

2011-02-03  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: get_splitting_args_from_config() always
	  return 'allow_split', get_xfer_dest() take a allow_split param,
	  set $self->{'allow_split'}, Abort a dump on EOM if splitting is
	  not allowed.
	* perl/Amanda/Taper/Worker.pm: Do not set can_cache_inform if splitting
	  is not allowed.
	* installcheck/Amanda_Taper_Scribe.pl: Fix for previous change.
	* installcheck/taper.pl: Test that dump are aborted on EOM.

2011-02-01  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Jan Grig
	* server-src/amrestore.pl: Allow to go to next file with -p.

2011-01-26  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Logfile.swg: "%lld" do not works with perl-5.6.

2011-01-26  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amdumpd.pl: Add CHECK command.
	* client-src/amdump_client.pl: Add check command.
	* man/xml-source/amdump_client.8.xml: Document check command.

2011-01-26  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Parse 'bytes' in reply.

2011-01-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Fix taperalog *FIT no going to second volume.

2011-01-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Logfile.swg: print 'bytes' with 64 bits type.

2011-01-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Logfile.swg: kb must be integer.

2011-01-24  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheckdump.pl: Do not quit the clerk if it is not defined

2011-01-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amdumpd.pl: Execute "$sbindir/amdump"

2011-01-22  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Config.pl: Check recovery-limit, dump-limit,
	  amdump-server, index-server, tape-server.
	* installcheck/Makefile.am: Add amdump_client.
	* installcheck/amdump_client.pl: Test new amdump_client program.

2011-01-22  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/Makefile.am: Add amdump_client.
	* client-src/amdump_client.pl: New client program.
	* common-src/conffile.c: Add amdump-server in client config file.
	* common-src/conffile.h: Add CNF_AMDUMP_SERVER
	* perl/Amanda/Config.swg: Add CNF_AMDUMP_SERVER
	* man/Makefile.am: Add amdump_client.8.
	* man/xml-source/amdump_client.8.xml: New man page for amdump_client.

2011-01-22  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Add SERVICE_AMDUMPD, All service are active
	  by default for rsh, ssh and local auth.
	* common-src/conffile.c: Add dump-limit dumptype option.
	* common-src/conffile.h: Add dump-limit dumptype option.
	* man/xml-source/amanda.conf.5.xml: Document new dump-limit option.
	* common-src/local-security.c, common-src/rsh-security.c,
	  common-src/ssh-security.c: Do not add the service on the command line
	* perl/Amanda/Config.swg: swig dump-limt
	* server-src/Makefile.am: Add amdumpd perl script.
	* server-src/amadmin.c (disklist_one): Print dump-limit.
	* server-src/amdumpd.pl: New deamon script.
	* server-src/amdump.pl: New --from-client option.
	* server-src/diskfile.h: Add dump_limit in disk_t.
	* server-src/diskfile.c: Set dump_limit.
	* server-src/driver.c: New --from-client option.
	* server-src/planner.c: New --from-client option.

2011-01-22  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Rename *recovery_limit* *host_limit*,
	  add 'server' in a host-limit.
	* common-src/conffile.h: Rename.
	* common-src/local-security.c: Use
	  sec_get_authenticated_peer_name_gethostname.
	* common-src/security-util.c:
	  New sec_get_authenticated_peer_name_gethostname function to return
	  gethostname.
	* common-src/security-util.h: New prototype.
	* man/xml-source/amanda.conf.5.xml: Document 'server' for
	  recovery-limit.
	* perl/Amanda/Config.swg: Return $Amanda::Config::LIMIT_SAMEHOST
	  same-host, return $Amanda::Config::LIMIT_SERVER for server.
	* server-src/amidxtaped.pl: Use $Amanda::Config::LIMIT_SAMEHOST and
	  $Amanda::Config::LIMIT_SERVER.
	* server-src/amindexd.c: Use 'server' value.
	* installcheck/Amanda_Config.pl: Fix for change.

2011-01-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Fix driver doing nothing if taper crash early.

2011-01-20  Francis Galiegue <fgaliegue@gmail.com>
	* xfer-src/source-pattern.c: remove duplicate test

2011-01-20  Dustin J. Mitchell <dustin@mozilla.com>
	* man/xml-source/amanda-interactivity.7.xml
	  man/xml-source/amanda-taperscan.7.xml
	  man/xml-source/amanda.conf.5.xml: copyediting
	* perl/Amanda/Interactivity/tty_email.pm: fix POD to indicate
	  the nature of the class

2011-01-20  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amservice.8.xml: typo, </programlisting> must be at
	  the beginning of a line.

2011-01-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amservice.c: Use full_write, check for error.

2011-01-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c: Do not report error if a dle is listed twice
	  in argument list.
	* installcheck/amadmin.pl: Test it.

2011-01-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amservice.c: Add -s option.
	* man/xml-source/amservice.8.xml: Document -s option.

2011-01-20  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Taper_Scan_lexical.pl,
	  installcheck/Amanda_Taper_Scan_oldest.pl: Fix for perl-5.6.

2011-01-20  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add interactivity and taperscan section.
	* common-src/conffile.h: Add interactivity and taperscan section.
	* perl/Amanda/Config.swg: Add interactivity and taperscan.
	* example/amanda.conf.in: Add interactivity and taperscan example.
	* man/Makefile.am: Add new amanda-interactivity.7
	* man/xml-source/amanda-interactivity.7.xml: Document interactivity.
	* man/xml-source/amanda-taperscan.7.xml: Document new taperscan.
	* man/xml-source/amanda.8.xml: Add link to amanda-interactivity man
				       page.
	* man/xml-source/amanda.conf.5.xml: Document interactivity and
					    taperscan section.
	* perl/Amanda/Changer.pm (new): Take tapelist, labelstr, autolabel and
	  meta_autolabel arguments.
	* perl/Amanda/Changer.pm (volume_is_labelable, make_new_meta_label,
	  make_new_tape_label, have_inventory: New method.
	* perl/Amanda/Interactive.pm: Renamed
	* perl/Amanda/Interactive/stdin.pm: Renamed
	* perl/Amanda/Interactivity.pm: Copy of Interactive.pm:
	* perl/Amanda/Interactivity/stdin.pm: Copy of Interactive/stdin.pm.
	* perl/Amanda/Interactivity/email.pm: New interactivity module.
	* perl/Amanda/Interactivity/tty.pm: New interactivity module.
	* perl/Amanda/Interactivity/tty_email.pm: New interactivity module.
	* perl/Amanda/Recovery/Scan.pm: s/Interactive/Interactivity/.
	* perl/Amanda/ScanInventory.pm: Base class for scan algorithm.
	* perl/Amanda/Tapelist.swg (add_tapelabel): Do the add in order.
	* perl/Amanda/Taper/Controller.pm: Use interactivity and taperscan.
	* perl/Amanda/Taper/Scan.pm: Allow plugable module.
	* perl/Amanda/Taper/Scan/lexical.pm: new scan algorithm.
	* perl/Amanda/Taper/Scan/oldest.pm: new scan algorithm.
	* perl/Makefile.am: Add new files.
	* server-src/amcheck-device.pl: Use interactivity and taperscan.
	* server-src/amcheckdump.pl: Use interactivity and taperscan.
	* server-src/amfetchdump.pl: Use interactivity and taperscan.
	* server-src/amidxtaped.pl: Use interactivity and taperscan.
	* server-src/amtape.pl: Use interactivity and taperscan.
	* server-src/amvault.pl: Use interactivity and taperscan.
	* installcheck/Amanda_Changer.pl: Test new methods.
	* installcheck/Amanda_Changer_compat.pl: Test have_inventory.
	* installcheck/Amanda_Changer_disk.pl: Test have_inventory.
	* installcheck/Amanda_Changer_multi.pl: Test have_inventory.
	* installcheck/Amanda_Changer_ndmp.pl: Test have_inventory.
	* installcheck/Amanda_Changer_null.pl: Test have_inventory.
	* installcheck/Amanda_Changer_rait.pl: Test have_inventory.
	* installcheck/Amanda_Changer_robot.pl: Test have_inventory.
	* installcheck/Amanda_Config.pl: Test new interactivity and taperscan
	  section.
	* installcheck/Amanda_Recovery_Scan.pl: s/Interactive/Interactivity/
	* installcheck/Amanda_Tapelist.pl: test new add_tapelabel behavior.
	* installcheck/Amanda_Taper_Scan_lexical.pl: Test new module.
	* installcheck/Amanda_Taper_Scan_oldest.pl: Test new module.
	* installcheck/Installcheck/Config.pm (add_interactivity,
	  add_taperscan): New methods.
	* installcheck/Makefile.am: Add new files.

2011-01-17  Francis Galiegue <fgaliegue@gmail.com>
	* xfer-src/element-glue.c: fix memory leak in read_and_push()

2011-01-16  Francis Galiegue <fgaliegue@gmail.com>
	* xfer-src/element-glue.c xfer-src/filter-xor.c
	  xfer-src/xfer-element.c xfer-src/xfer-element.h: xfer: rename
	  xfer_element_drain* utility functions - Both functions are used to
	  pulling data from an upstream element, either buffers or reading a
	  file descriptor, until it is "empty".

2011-01-14  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/amndma_tape_simulator.c: Use full_read.
	* ndmp-src/ndma_tape.c: Use ndmchan_n_avail_record to guarantee space
	  for a record.
	* ndmp-src/ndml_chan.c (ndmchan_n_avail_record): New function.
	* ndmp-src/ndmlib.h  (ndmchan_n_avail_record): New prototype.

2011-01-13  Francis Galiegue <fgaliegue@gmail.com>
	* xfer-src/source-pattern.c: xfer-src/source-pattern.c: externalize
	  pattern copying

2011-01-13  Francis Galiegue <fgaliegue@gmail.com>
	* xfer-src/element-glue.c: xfer-src/element-glue.c: fix memory leak in
	  pull_buffer_impl()

2011-01-11  Francis Galiegue <fgaliegue@gmail.com>
	* xfer-src/xfer-element.h: xfer: define XFER_NROPS() and
	  XFER_NTHREADS() macros
	* xfer-src/dest-buffer.c xfer-src/dest-directtcp-connect.c
	  xfer-src/dest-directtcp-listen.c xfer-src/dest-fd.c
	  xfer-src/dest-null.c xfer-src/element-glue.c xfer-src/filter-process.c
	  xfer-src/filter-xor.c xfer-src/source-directtcp-connect.c
	  xfer-src/source-directtcp-listen.c xfer-src/source-fd.c
	  xfer-src/source-pattern.c xfer-src/source-random.c
	  xfer-src/xfer-test.c: use them

2011-01-11  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: match.c: rename ammtch_to_regex() into
	  amglob_to_regex()

2011-01-11  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: match.c: rename full_regex_from_expression() to
	  full_amglob_from_expression()

2011-01-11  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Change message of "timeout waiting for REP" to
	  "Some estimate timeout on %s, using server estimate if possible".

2011-01-11  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda-scripts.7.xml: Document script output property.

2011-01-10  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: match.c: rework regex generation from globs

2011-01-10  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: match.c: match_word(): change the way regex
	  begin and end are calculated/copied

2011-01-10  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: match.c: better handling of "separator only"
	  globs in match_word()

2011-01-10  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: match.c: move glob/disk backslash substitution
	  out of match_word()

2011-01-10  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: match.c: factorize regex construction from
	  expression

2011-01-10  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: match.c: factorize character escaping in
	  make_exact_*_expression()

2011-01-10  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: match.c: factorize regex matching
	* common-src/match.h: make match and match_no_newline into
	  macros calling do_match

2011-01-10  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: match.c: factorize regex compile

2011-01-10  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: match.c: match_host(): use g_ascii_strdown() to
	  convert to lowercase

2011-01-10  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: match.c: fix '*' and '?' expansion in
	  match_word()

2011-01-10  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: match.c: define a macro to recognize regex
	  metacharacters

2011-01-10  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: match.c: match_host(): remove unneeded cast

2011-01-10  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: match.c: match_word(): rename "i" local variable
	  to "ret"

2011-01-10  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: match.c: match_word(): rename two local
	  variables. Rename r to dst, and w to src, in order to clarify their
	  roles.

2011-01-10  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/match.c: match.c: match_word(): remove unused assignment

2011-01-07  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c, application-src/amstar.c: Do not call
	  amname_to_dirname.

2011-01-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsd-security.c: Check input fd is a socket.

2011-01-07  Dustin J. Mitchell <dustin@mozilla.com>
	* common-src/testutils.c: use %ju instead of %lu to print big numbers

2011-01-07  Francis Galiegue <fgaliegue@gmail.com>
	* testutils.c: report time of execution for each test

2011-01-07  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/testutils.c: add -c <count> option to run tests more than
	  once

2011-01-07  Francis Galiegue <fgaliegue@gmail.com>
	* testutils.c: create a run_one_test() function The way to run a test
	  is the same, whether we fork() or not. Make that a function.

2011-01-06  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/testutils.c: testutils.c: externalize test behaviour
	  variables

2011-01-06  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/amflock-test.c common-src/event-test.c
	  common-src/fileheader-test.c common-src/hexencode-test.c
	  common-src/ipc-binary-test.c common-src/match-test.c
	  common-src/quoting-test.c: Ensure all tests return gbooleans.  Most,
	  if not all, tests returned ints, and quite a few of them returned TRUE
	  or FALSE. While the effect is basically the same as a gboolean, make
	  all tests return a gboolean for coherency, since this is what
	  callinfork() expects anyway.
	* common-src/testutils.c: Also enforce that callinfork() return that
	  type, which, in turn, allows the "success" local variable in
	  testutil_run_tests() to also be converted.

2011-01-06  Francis Galiegue <fgaliegue@gmail.com>
	* common-src/testutils.c: convert ints to gbooleans where appropriate;
	  run_all, tu_debugging_enabled and ignore_timeouts are all used as
	  gbooleans in the code even though they are declared as ints. Convert
	  them to booleans, and also change declarations.

2011-01-05  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Xfer.pod: new offset and size arguments of xfer->start.
	* perl/Amanda/Xfer.swg: Add xfer_element_set_size.

2011-01-04  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/xfer-source-recovery.c: Never send more than the number
	  of bytes requested.
	* perl/Amanda/Xfer.swg (xfer_start): New offset and size arguments.
	* xfer-src/xfer-element.c: Add set_size method.
	* xfer-src/xfer-element.h (XferElement): Add size field.
	* xfer-src/xfer-test.c: Add offset=0 and size=0 to xfer_start call.
	* xfer-src/xfer.c (xfer_start): Add offset and size arguments. Call
	  xfer_element_set_size for the first element if size is set.
	* xfer-src/xfer.h (xfer_start): New prototype.
	* server-src/amfetchdump.pl, server-src/amidxtaped.pl,
	  server-src/amvault.pl: Call xfer->start() with offset and size
	  arguments.

2011-01-04  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Logfile.swg: Print size in bytes for taper log.
	* server-src/find.h (find_result_t): Add bytes.
	* server-src/find.c: Parse 'bytes' in 'log' file.
	* perl/Amanda/Report.pm: Parse 'bytes' in 'log' file.
	* perl/Amanda/DB/Catalog.pm: Parse 'bytes' in 'log' file.
	* server-src/amstatus.pl: Parse 'bytes' in 'amdump' log file.
	* installcheck/Amanda_DB_Catalog.pl: Fix for log file format change.
	* installcheck/taper.pl: Fix for log file format change.

2011-01-03  Jean-Louis Martineau <martineau@zmanda.com>
	* example/template.d/advanced.conf.in: Remove dumpuser.
	* server-src/amaddclient.pl: mkdir -p
	* server-src/amserverconfig.pl: Print dumpuser, Print the
	  authorized_keys file location based on $amhomedir

2010-12-27 Dan Locks <dwlocks@zmanda.com>
	*  packaging/deb/rules, packaging/rpm/amanda.spec.src: add missing
	   amservice entry to set perms at install time. Thanks to vpatton for
	   finding this.

2010-12-23  Dustin J. Mitchell <dustin@mozilla.com>
	* client-src/client_util.c: improve error message when no includes
	  match on disk

2010-12-23  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Script_App.pm: Add FAILURE.

2010-12-21  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: Use 'blocksize' to compute the
	  available space.

2010-12-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c: Fix parsing 'PARTIAL taper' line with no part.
	* perl/Amanda/DB/Catalog.pm: Ditto

2010-12-16  Jean-Louis Martineau <martineau@zmanda.com>
	* amar-src/amar.c: Don't fail on trailing NUL bytes.

2010-12-14  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ssh-security.c: Use client_port.

2010-12-14  Daniel Nri <dne@mayonnaise.net>
	* application-src/ampgsql.pl: Don't assume that gtar is configured to
	  use stdin/stdout as default archive.

2010-12-14  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amidxtaped.pl: Don't crash if same-host doesn't match.

2010-12-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Interactive.pm: rename finished_cb to request_cb.
	* installcheck/Amanda_Recovery_Scan.pl,
	  perl/Amanda/Interactive/stdin.pm,
	  perl/Amanda/Recovery/Scan.pm, server-src/amcheckdump.pl,
	  server-src/amfetchdump.pl, server-src/amidxtaped.pl,
	  server-src/amvault.pl: s/finished_cb/request_cb/

2010-12-12  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/disk.pm: inventory must return the same as
				       read_label.
	* server-src/amtape.pl: Fix for new inventory.
	* installcheck/Amanda_Changer_disk.pl: Fix for new inventory.
	* installcheck/Amanda_Changer_rait.pl: Fix for new inventory.

2010-12-11  Daniel Nri <dne@mayonnaise.net>
	* application-src/ampgsql.pl: Don't assume that gtar is configured to
	  use stdin/stdout as default archive

2010-12-11  Daniel Nri <dne@mayonnaise.net>
	* application-src/ampgsql.pl: Use diskname, not devicename, as prefix
	  when checking for properties. Now works as documented in the ampgsql
	  man page.

2010-12-10 Dan Locks <dwlocks@zmanda.com>
	*  packaging/deb/control: move gnuplot to Suggests: and swap the order

2010-12-10  David Bogen <bogen@wisc.edu>
	* server-src/amoverview.pl: fix amoverview's argument parsing

2010-12-10  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck-device.pl: Fix possible hang if
	  Amanda::MainLoop::quit is called before Amanda::MainLoop::run.
	* perl/Amanda/Changer.pm: Return the error.

2010-12-09  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Check if taper is flushing something before
	  moving a dle to directq.

2010-12-09  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/xfer-dest-taper-cacher.c: Print why the malloc failed.

2010-12-08  Dustin J. Mitchell <dustin@mozilla.com>
	* common-src/glib-util.c common-src/glib-util.h: do not define
	  symbol g_slist_free_full, as it exists in glib-2.27 and higher;
	  use slist_free_full, and alias that to g_slist_free_full when
	  building against glib-2.28 or higher.
	* client-src/client_util.c: make g_slist_free_full_gpointer into
	  a local, static function
	* common-src/amxml.c common-src/conffile.c recover-src/extract_list.c
	  server-src/amadmin.c server-src/amflush.c server-src/cmdline.c
	  server-src/cmdline.h server-src/find.c server-src/holding.c
	  server-src/planner.c: rename function

2010-12-07 Dan Locks <dwlocks@zmanda.com>
	*  packaging/rpm/amanda.spec.src: remove manual library requires and
	   set curl vs libcurl based on distro.

2010-12-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c: s/HAVE_READLINE/HAVE_LIBREADLINE/
	* config/amanda/readline.m4: s/HAVE_READLINE/HAVE_LIBREADLINE/

2010-12-07  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/readline.m4: Merge with latest AX_LIB_READLINE.
	* common-src/util.h: Fix for latest AX_LIB_READLINE.

2010-12-06 Dan Locks <dwlocks@zmanda.com>
	*  packaging/rpm/amanda.spec.src: remove libtermcap.so.2 requirement
	   for newer distros.

2010-12-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/server_util.c (internal_server_estimate): Do not use
	  level 0 estimate if is not available.

2010-12-04  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Put them in AMANDA_DBGDIR/log.error

2010-12-03  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Put error message in separate files to
	  reduce the size of the log file.

2010-12-01  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/chunker.c, xfer-src/element-glue.c: Prefer IPV4 over IPV6.

2010-12-01  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/directtcp.h: DirectTCPAddr is a sockaddr_union.
	* common-src/sockaddr-util.c (str_sockaddr_no_port): new function.
	* common-src/sockaddr-util.h (str_sockaddr_no_port): New prototype.
	* perl/amglue/directtcp.swg: Swig new DirectTCPAddr.
	* server-src/dumper.c: Parse IPV6 in dataport_list.
	* ndmp-src/ndmpconnobj.c, perl/Amanda/Device.swg,
	  perl/Amanda/Taper/Worker.pm, perl/Amanda/Xfer.swg,
	  server-src/chunker.c, xfer-src/dest-directtcp-connect.c,
	  xfer-src/element-glue.c, xfer-src/source-directtcp-connect.c,
	  xfer-src/source-directtcp-listen.c, xfer-src/xfer-element.h,
	  xfer-src/xfer-test.c: Use new DirectTCPAddr.

2010-11-30  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add pre-amcheck, post-amcheck, pre-estimate,
	  post-estimate, pre-backup and post-backup to execute-on of script.
	* common-src/conffile.h: Add EXECUTE_ON_* constants.
	* application-src/amlog-script.pl: Add new execute-on.
	* common-src/amxml.c: Parse new execute-on.
	* man/xml-source/amanda.conf.5.xml: Document them.
	* perl/Amanda/Config.swg: Add new EXECUTE_ON_* constants.
	* perl/Amanda/Script.pm: Add new execute-on.
	* server-src/amcheck.c: Call run_server_global_scripts.
	* server-src/diskfile.c (get_hostlist): Return the host list.
	* server-src/diskfile.h (get_hostlist): Add prototype.
	* server-src/driver.c: Call run_server_global_scripts.
	* server-src/planner.c: Call run_server_global_scripts.
	* server-src/server_util.c (run_server_global_scripts): New function.
	* server-src/server_util.h (run_server_global_scripts): Prototype.

2010-11-30  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/server_util.c: Search scripts in APPLICATION_DIR,
	  CONFIG_DIR/<conf>/application and CONFIG_DIR/application.

2010-11-30  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add SINGLE-EXECUTION in scripts.
	* common-src/conffile.h: Add pp_script_get_single_execution.
	* installcheck/pp-scripts.pl: Test single-execution.
	* man/xml-source/amanda.conf.5.xml: Document single-execution.
	* perl/Amanda/Config.swg: Add PP_SCRIPT_SINGLE_EXECUTION.
	* server-src/server_util.c: Add run_server_host_scripts,
	  rename run_server_scripts to run_server_dle_scripts.
	* server-src/server_util.h: New prototype.
	* server-src/amcheck.c, server-src/driver.c,
	  server-src/planner.c: Call new functions.

2010-11-26  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/amreport.pl: Fix for previous patch.

2010-11-26  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amadmin.8.xml, man/xml-source/amcheck.8.xml,
	  man/xml-source/amcheckdump.8.xml, man/xml-source/amdevcheck.8.xml,
	  man/xml-source/amdump.8.xml, man/xml-source/amfetchdump.8.xml,
	  man/xml-source/amflush.8.xml, man/xml-source/amgetconf.8.xml,
	  man/xml-source/amlabel.8.xml, man/xml-source/amoverview.8.xml,
	  man/xml-source/amrecover.8.xml, man/xml-source/amreport.8.xml,
	  man/xml-source/amservice.8.xml, man/xml-source/amstatus.8.xml,
	  man/xml-source/amtape.8.xml: Fix synopsis.
	* device-src/amdevcheck.pl, server-src/amadmin.c,
	  server-src/amcheckdump.pl, server-src/amlabel.pl,
	  server-src/amoverview.pl, server-src/amreport.pl,
	  server-src/amstatus.pl, server-src/amtape.pl: Fix usage.

2010-11-26  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Print configuration option with '-'.
	* installcheck/Amanda_Config.pl: Fix for '-'.

2010-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/make_html.pl: make relative url in index.html.

2010-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/make_html.pl: Add amanda version in html headers and footers.

2010-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xslt/html.xsl.in: Include Amanda version in HTML headers.

2010-11-22  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/Makefile.am: activate-devpay needs gnulib.

2010-11-18 Dan Locks <dwlocks@zmanda.com>
	*  packaging/rpm/amanda.spec.src: quote both items in boolean
	   comparison to avoid type mismatch.

2010-11-17  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add CONFTYPE_NO_YES_ALL, change type for
	  autoflush.
	* common-src/conffile.h: Add CONFTYPE_NO_YES_ALL.
	* man/xml-source/amanda.conf.5.xml: New autoflush option.
	* perl/Amanda/Config.swg: Add CONFTYPE_NO_YES_ALL.
	* server-src/amcheck.c: Use new value of autoflush.
	* server-src/planner.c: Use new value of autoflush.

2010-11-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Correctly handle INPUT-ERROR and TAPE-ERROR.

2010-11-17  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/xfer-dest-taper-cacher.c,
	  device-src/xfer-dest-taper-splitter.c: Cancel in correct order.
	  Other thread own self->state_mutex while it wait for self->ring* or
	  self->slab*

2010-11-17  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/xfer-dest-taper-cacher.c,
	  device-src/xfer-dest-taper-splitter.c: Always call device_finish_file
	  if device_start_file succeed.

2010-11-16 Dan Locks <dwlocks@zmanda.com>
	*  packaging/rpm/amanda.spec.src: add rhel6 stanza to distro detection

2010-11-16  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Changer_single.pl: Typo.
	* server-src/amtape.pl: Typo.

2010-11-16  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c: Keep the complete error message.

2010-11-16  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/disk.pm: new MOUNT, UMOUNT, UMOUNT-LOCKFILE and
				       UMOUNT-IDLE properties.
	* man/xml-source/amanda-changers.7.xml: Add new chg-disk property.
	* NEWS: Add new chg-disk property.

2010-11-16  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: Add quit method.
	* perl/Amanda/Changer/aggregate.pm: Add quit method.
	* perl/Amanda/Changer/rait.pm: Add quit method.
	* perl/Amanda/Recovery/Clerk.pm: Call scan quit method.
	* perl/Amanda/Recovery/Scan.pm: Add quit method.
	* perl/Amanda/Taper/Controller.pm: Call scan quit method.
	* perl/Amanda/Taper/Scan.pm: Add quit method.
	* perl/Amanda/Taper/Scribe.pm: finished_cb to Add scribe_notif_tape_done
	* server-src/amcheck-device.pl, server-src/amcheckdump.pl,
	  server-src/amidxtaped.pl, server-src/amlabel.pl,
	  server-src/amrestore.pl, server-src/amrmtape.pl,
	  server-src/amtape.pl: Call scan/changer quit method.
	* server-src/amvault.pl scribe_notif_tape_done with finished_cb.
	* installcheck/Amanda_Changer.pl,
	  installcheck/Amanda_Changer_compat.pl,
	  installcheck/Amanda_Changer_disk.pl,
	  installcheck/Amanda_Changer_multi.pl,
	  installcheck/Amanda_Changer_ndmp.pl,
	  installcheck/Amanda_Changer_null.pl,
	  installcheck/Amanda_Changer_rait.pl,
	  installcheck/Amanda_Changer_robot.pl,
	  installcheck/Amanda_Changer_single.pl,
	  installcheck/Amanda_Recovery_Clerk.pl,
	  installcheck/Amanda_Recovery_Scan.pl,
	  installcheck/Amanda_Taper_Scan.pl,
	  installcheck/Amanda_Taper_Scan_traditional.pl,
	  installcheck/Amanda_Taper_Scribe.pl,
	  installcheck/amvault.pl: Add call to scan/changer quit method.

2010-11-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driverio.c: Don't update last_level/consecutive_runs if
	  the dump failed.

2010-11-11  Nikhil Bhupale <nikhilb@zmanda.com>
	* server-src/amtape.pl: Remove call to set_label.
	* server-src/amrestore.pl: Remove call to set_label.

2010-11-10  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/progs.m4(AMANDA_PROG_MOUNT, AMANDA_PROG_UMOUNT):
	  find mount and umount binaries
	* configure.in: Use AMANDA_PROG_MOUNT and AMANDA_PROG_UMOUNT.
	* perl/Amanda/Constants.pm.in: Define MOUNT and UMOUNT.

2010-11-10  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c: Accept LEOM property.

2010-11-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Fix use of Amanda::Changer->make_error

2010-11-10  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amflock.c (lock_wr, lock_rd, lock_locked): New function
	* common-src/amflock.h: Add their prototype.
	* perl/Amanda/Util.swg: Swig them.
	* perl/Amanda/Util.pod: Docuemnt them.

2010-11-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: Remove the changer cache.
	* installcheck/Amanda_Taper_Scan_traditional.pl,
	  installcheck/Amanda_Changer_robot.pl,
	  installcheck/Amanda_Changer_ndmp.pl: Do not reset the changer cache.

2010-11-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/MainLoop.swg: Add finalize in define_step.
	* perl/Amanda/MainLoop.pod: Document finalize.

2010-11-10  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amstar.c: Support 'exclude file' and 'exclude list'.
	* man/xml-source/amstar.8.xml: Document exclude limitation.

2010-11-08  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Better handling of dump to tape.
	  Set force_flush to 0 as soon as the runq is empty.
	* server-src/dumper.c: Improving debugging.

2010-11-08  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report.pm: Report driver FAIL as FAILED (not missing).
	* perl/Amanda/Report/human.pm: Do not report driver error if there
				       is a try.

2010-11-05  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/tapelist.5.xml: Document BARCODE and META.

2010-11-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amdump.pl: Execute subprocess with the config overwrite.
	* server-src/amvault.pl: Execute subprocess with the config overwrite.

2010-11-04  Jean-Louis Martineau <martineau@zmanda.com>
        * server-src/amreport.pl: Set date correctly for amvault run.
        * perl/Amanda/Report/human.pm: Fix warning.

2010-11-04  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/aggregate.pm: New changer.
	* man/xml-source/amanda-changers.7.xml: Document chg-aggregate.
	* perl/Makefile.am: Add it.
	* server-src/amtape.pl: Print better message if inventory is not
				implemented.

2010-11-04  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: $o $c $m $b in autolabel.
	* perl/Amanda/Changer.pm: $o $c in meta-autolabel.
	* server-src/amlabel.pl: New --barcode option, <label> is no longer
	  required, an autolabel can be generated.
	* server-src/find.c: Fix for quoted label.
	* man/xml-source/amanda.conf.5.xml: Document new autolable variable.
	* man/xml-source/amlabel.8.xml: Document new amlabel features.
	* installcheck/Amanda_Tapelist.pl: Test it.
	* installcheck/Installcheck/Run.pm (setup): Argument to set the number
						    of slot.
	* installcheck/amlabel.pl: Test it.

2010-11-04  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/tapefile.c: Add barcode intapelist.
	* server-src/tapefile.h: Add barcode intapelist.
	* perl/Amanda/Tapelist.swg: Add barcode intapelist.
	* perl/Amanda/Taper/Scribe.pm: Set the barcode.
	* server-src/amlabel.pl: Set the barcode.
	* installcheck/Amanda_Tapelist.pl: Test it.
	* installcheck/amlabel.pl: Test it.

2010-11-04  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scan.pm (new): Take a tapelist argument, not a
					   filename.
	* perl/Amanda/Taper/Scan.pm: Remove make_new_tape_label and
				     make_new_meta_label methods.
	* perl/Amanda/Changer.pm (new): Take a tapelist argument.
	* perl/Amanda/Changer.pm: Add make_new_tape_label and
	  make_new_meta_label methods to Amanda::Changer::Reservation.
	* installcheck/Amanda_Taper_Scan.pl,
	  installcheck/Amanda_Taper_Scan_traditional.pl,
	  installcheck/amdevcheck.pl, perl/Amanda/Taper/Controller.pm,
	  perl/Amanda/Taper/Scan/traditional.pm, perl/Amanda/Taper/Scribe.pm,
	  server-src/amcheck-device.pl, server-src/amcheckdump.pl,
	  server-src/amidxtaped.pl, server-src/amlabel.pl,
	  server-src/amrestore.pl, server-src/amrmtape.pl,
	  server-src/amtape.pl, server-src/amvault.pl,
	  server-src/taper.pl: Change for new tapelist argument.

2010-11-02  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c (quote_string_maybe): Don't use match.
	* common-src/util.c (len_quote_string_maybe): New function.
	* common-src/util.h (len_quote_string): Define.
	* server-src/amadmin.c: Don't call find_dump twice.
	* server-src/find.c (search_logfile): Don't use regex.
	* server-src/find.c (print_find_result): Use len_quote_string.

2010-11-02  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: debug-recovery default to 1.
	* man/xml-source/amanda.conf.5.xml: Document it.

2010-11-02  Nikhil Bhupale <nikhilb@zmanda.com>
	* server-src/amtape.pl: Remove call to set_label.
	* server-src/amcheck-device.pl: Remove call to set_label.

2010-10-29  Dustin J. Mitchell <dustin@mozilla.com>
	* man/xml-source/amanda-changers.7.xml: improve chg-disk properties
	  documentation

2010-10-29  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/chunker.c: Close listening socket are accepted socket.
	* xfer-src/element-glue.c: Close listening socket are accepted socket.

2010-10-29  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amflush.c: Open 'amflush' log file in append mode.

2010-10-29  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amdump.pl: Open 'amdump' log file in append mode.

2010-10-28  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Fix quoting in recovery-limit output.
	* server-src/amadmin.c (disklist_one): Print recovery-limit.

2010-10-28  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: Don't free script->result.

2010-10-27  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: What is a meta label.

2010-10-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Typo.

2010-10-26  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: New meta-autolabel.
	* common-src/conffile.h: CNF_META_AUTOLABEL.
	* perl/Amanda/Config.swg: CNF_META_AUTOLABEL.
	* man/xml-source/amanda.conf.5.xml: Document meta-autolabel
	* server-src/tapefile.c: Read/write meta-label to tapelist file
	* server-src/tapefile.h (struct tape_s): Add meta.
	* perl/Amanda/Tapelist.swg: Read/write meta-label to tapelist file
	* perl/Amanda/Changer.pm (get_meta_label, set_meta_label): New methods
	  in A::Changer and A::Changer::Reservation.
	* perl/Amanda/Changer/disk.pm: Keep meta-label in state file.
	* perl/Amanda/Changer/disk.pm (get_meta_label, set_meta_label):
	  New methods
	* perl/Amanda/Taper/Scan.pm (make_new_meta_label): New method.
	* perl/Amanda/Taper/Scribe.pm: get/set meta label.
	* server-src/amlabel.pl: New --meta and --assign option.
	* server-src/amtape.pl (inventory): Print meta-label.
	* man/xml-source/amlabel.8.xml: Document --meta and --assign options.
	* installcheck/Amanda_Tapelist.pl: Test tapelist with meta-label.
	* installcheck/amlabel.pl: Check meta.

2010-10-26  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda-changers.7.xml: Document new NUM-SLOT,
	  AUTO-CREATE-SLOT and REMOVABLE chg-disk properties.
	* perl/Amanda/Changer.pm (get_boolean_property) Moved from A::Changer
	  to A::Changer::Config.
	* perl/Amanda/Changer/disk.pm: New NUM-SLOT, AUTO-CREATE-SLOT and
	  REMOVABLE properties. Use new get_boolean_property.
	* perl/Amanda/Changer/robot.pm: Use new get_boolean_property.

2010-10-26  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/fileheader.c (parse_file_header): Print buf.
	* recover-src/extract_list.c: Read header in multiple
						    block.

2010-10-26  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/human.pm: Use chunker size to find big estimate.
	* installcheck/catalogs/bigestimate.cat: Fix.

2010-10-25  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Worker.pm: Use 4*block_size for
	  device_output_buffer_size if it is not set by the user.
	* server-src/amcheck-device.pl: Check device_output_buffer_size is at
	  least 2*block_size.

2010-10-25 Dan Locks <dwlocks@zmanda.com>
	*  config/amanda/libs.m4: update AMANDA_CHECK_CURL to add runtime link
	   flags for all solaris platforms, remove our AC_PATH_PROG for curl-config,
	   and trust LIBCURL_CHECK_CONFIG (which is now fixed)

2010-10-25 Dan Locks <dwlocks@zmanda.com>
	*  packaging/rpm/amanda.spec.src: exclude sles9 from
	   LDFLAGS=-Wl,--as-needed

2010-10-21 Dan Locks <dwlocks@zmanda.com>

2010-10-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amtape.pl: Typo.

2010-10-19 Dan Locks <dwlocks@zmanda.com>
	*  packaging/deb/rules, packaging/rpm/amanda.spec.src: add
	   -Wl,--as-needed to ./configure invocation in packages

2010-10-19  Jean-Louis Martineau <martineau@zmanda.com>
	* ReleaseNotes NEWS: amdump --no-taper option.

2010-10-19  Nikhil Bhupale <nikhilb@zmanda.com>
	* device-src/vfs-device.h device-src/vfs-device.c:
	  add enforce_max_volume_usage
	* device-src/s3-device.c: Added support for MAX_VOLUME_USAGE and
	  ENFORCE_MAX_VOLUME_USAGE
	* device-src/property.h device-src/property.c: Added property
	  ENFORCE_MAX_VOLUME_USAGE
	* device-src/s3.h device-src/s3.c: Calculate total volume usage for
	  s3 device
	* installcheck/Amanda_Device.pl: Test it
	* man/xml-source/amanda-devices.7.xml: Document it

2010-10-18  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Give an error if client property
	  pg-datadir is different than diskdevice. Use diskdevice if client
	  property pg-datadir is not set.

2010-10-17  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Quote error message for invalid size.

2010-10-17  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (read_size_byte/get_size_byte):
	  CNF_DEVICE_OUTPUT_BUFFER_SIZE is in bytes.

2010-10-14  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amtape.pl (inventory): print current slot.
	* installcheck/amtape.pl: check it.

2010-10-14 Dan Locks <dwlocks@zmanda.com>
	*  packaging/deb/rules, packaging/deb/buildpkg,
	   packaging/rpm/amanda.spec.src: remove port range limits for
	   rpm and deb packages

2010-10-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/amglue/ghashtable.c: Define PERL_MAGIC_tied.

2010-10-12  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Don't check 'self->use_ssl && !self->ca_info'.

2010-10-12  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndma_comm_session.c: add a g_debug message
	* ndmp-src/ndmjob_main.c: remove redundant exit-on-stdin-eof

2010-10-12 Dan Locks <dwlocks@zmanda.com>
	*  config/amanda/progs.m4: add comment about sysloc- and locsys- path,
	   make MTX a precious variable.

2010-10-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Set default netusage to 80000 kbps.

2010-10-12  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Util.pod: fix typo
	* server-src/amserverconfig.pl: don't specify duplicate 'dumpuser'
	  parameter in amserverconfig (it's also in advanced.conf); use
	  get_fs_usage; include weird size requirements in error message
	* installcheck/amserverconfig.pl: test for this arrangement (used in
	  the template + custom options case, I think)

2010-10-12  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/amndmjob_main.c: remove exit on eof thread
	* ndmp-src/ndmjob_main.c: add it here, in the right place

2010-10-12  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/ssh-security.c: don't munge $SSH_CONNETION

2010-10-12  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/swig.m4: add '.' to freebsd versions
	* perl/Makefile.am: spell it -pthread

2010-10-08  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amvault.pl: add fake driver finish first

2010-10-08  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amflush.c: write a "pid done" line when cancelling
	* server-src/amcleanup.pl: run amlogroll internally

2010-10-08  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Taper/Worker.pm: remove cont_filename from header before
	  writing to a real volume
	* perl/Amanda/Recovery/Clerk.pm: remove it when restoring, too

2010-10-08  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amvault.pl: update the tests to use --autolabel=any

2010-10-08  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amvault.pl: --autolabel any, not --autolabel all

2010-10-08  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: Don't give an error is ssl_ca_info is set
	  and ssl is not used.

2010-10-07  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: Use property_add_to_argv.
	* client-src/client_util.h (application_property_argv_size):
	  Remove prototype.
	* common-src/conffile.c: Use g_str_amanda_hash and g_str_amanda_equal
	  for property hash.
	* common-src/conffile.c (property_add_to_argv): Remove function
	* common-src/conffile.h (property_add_to_argv): Remove prototype.
	* common-src/glib-util.c (g_str_amanda_hash, g_str_amanda_equal):
	  Add function
	* common-src/glib-util.h (g_str_amanda_hash, g_str_amanda_equal):
	  Add prototype.
	* common-src/util.c (proplist_add_to_argv, property_add_to_argv):
	  Add function.
	* common-src/util.h (proplist_add_to_argv, property_add_to_argv):
	  Add prototype.
	* perl/Amanda/Config.pod: Document amandaify_property_name.
	* perl/Amanda/Config.swg: Add amandaify_property_name.
	* perl/Amanda/Config/FoldingHash.pm: New class.
	* perl/Makefile.am: Add perl/Amanda/Config/FoldingHash.pm
	* perl/amglue/ghashtable.c: Use A::C::FoldingHash.pm for property hash.
	* recover-src/extract_list.c: Use property_add_to_argv
	* installcheck/Amanda_Config.pl: Check property case matching.
	* installcheck/Amanda_Config_FoldingHash.pl:
	  Check Amanda::Config::FoldingHash.
	* installcheck/Makefile.am:
	  Add installcheck/Amanda_Config_FoldingHash.pl

2010-10-07  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amoverview.8.xml: fix typos in usage
	* server-src/amoverview.pl: config is mandatory; --config is not

2010-10-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Log packet sent and received.

2010-10-07  Dustin J. Mitchell <dustin@zmanda.com>
	* amandad-src/amandad.c: don't wait 5 seconds if the service has
	  already exited

2010-10-06 Dan Locks <dwlocks@zmanda.com>
	*  config/amanda/libs.m4: update LIBCURL_CHECK_CONFIG help string,
	   fix AC_PATH_PROG usage.

2010-10-06  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am: only run the threading test after install

2010-10-06  Jean-Louis Martineau <martineau@zmanda.com>
	* VERSION: 3.3.0alpha

2010-10-06  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am: fix the FreeBSD threading test to actually fail

2010-10-06  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/dvdrw-device.c: Always call parent_class->finish(dself).
	* device-src/ndmp-device.c: Always call close_tape_agent and
				    close_connection.
	* device-src/null-device.c: Always set pself->access_mode to
				    ACCESS_NULL.
	* device-src/rait-device.c: Always call child finish.
	* device-src/s3-device.c: Always set pself->access_mode to ACCESS_NULL.
	* device-src/tape-device.c: Always close self->fd.
	* device-src/vfs-device.c: Always set pself->access_mode to ACCESS_NULL.

2010-10-06  Nandan Athawale <nandan.athawale@gmail.com>
	* device-src/s3.c: replaced deprecated functions g_strncasecmp
	  and g_strcasecmp with g_ascii_strncasecmp and g_ascii_strcasecmp.

2010-10-05  Dustin J. Mitchell <dustin@zmanda.com>
	* man/entities/global.entities.in: better formatting for config
	  overrides
	* man/xml-source/amvault.8.xml: better synopsis formatting
	* server-src/amvault.pl: better synopsis formatting

2010-10-05  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Logfile.swg: don't produce negative durations
	* perl/Amanda/DB/Catalog.pm: but handle them when they occur

2010-10-05  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/human.pm: Correctly print "Level:#".

2010-10-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Use last_level to compute the bump level.

2010-10-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Fix memory allocation.

2010-10-04  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amidxtaped.pl: exact match for same-host, allow dumps
	  that are not in the disklist
	* server-src/amindexd.c: fix trivially permissive same-host

2010-10-04  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amxml.c: set the correct fields (encryption or
	  compression)
	* server-src/dumper.c: strdup strings so they are not gone after
	  free_dle

2010-10-04  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Report.pm: fix autovivification bug
	* perl/Amanda/Report/human.pm: detect re-flushing; fix a lot of
	  undefined's

2010-10-04  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amtape.pl: Add a 'return' for every usage() call.
	  Add step in main.

2010-10-01  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amvault.8.xml: mention that DLE splitting parameters
	  are ignored by amvault
	* server-src/amvault.pl: use tapetype parameters for splitting
	* perl/Amanda/Taper/Scribe.pm: support splitting parameters straight
	  from Amanda::Config

2010-10-01  Dustin J. Mitchell <dustin@zmanda.com>
	* packaging/deb/rules: remove misleading comment about automake-1.2

2010-10-01  Dustin J. Mitchell <dustin@zmanda.com>
	* contrib/convert-zd-mtx-to-robot.sh: set default for driveslot, ask
	  user to clear out 'tapedev' too

2010-09-30  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/event.c: Set the priority of EV_TIME to 10.

2010-09-30  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/postscript.pm: print all dles that have a part
	  on the volume.
	* installcheck/catalogs/spanned.cat: Check it.

2010-09-30  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Taper/Scan/traditional.pm: use set_current in stage 1,
	  too

2010-09-29  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/dumper.c: fix prints; use the correct disk_t fields

2010-09-29  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/alloc.c: Remove a print to stderr.

2010-09-29  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS, ReleaseNotes: Update.

2010-09-28  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amvault.pl: fix tests for total size

2010-09-28  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/util.c: remove debugging call
	* installcheck/Amanda_Util.pl: fix tests on perl-5.6

2010-09-28  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amvault.pl: print total size on --dry-run

2010-09-28  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Config.pl: fix test

2010-09-28  Dustin J. Mitchell <dustin@zmanda.com>
	* NEWS: update NEWS about it
	* common-src/conffile.c common-src/conffile.h: add recovery-list
	  parameters
	* man/xml-source/amanda.conf.5.xml: document them
	* perl/Amanda/Config.pod perl/Amanda/Config.swg: SWIG them
	* installcheck/Amanda_Config.pl: test them
	* server-src/amidxtaped.pl: check recovery limits
	* installcheck/amidxtaped.pl
	  installcheck/Installcheck/ClientService.pm: test it
	* server-src/amindexd.c: check recovery limits

2010-09-28  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Print number of bytes read.

2010-09-28 Dan Locks <dwlocks@zmanda.com>
	*  config/amanda/progs.m4: remove first instance of
	   AMANDA_PROG_GNUPLOT

2010-09-27  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amanda.h common-src/alloc.c: add save_env_full
	* amandad-src/amandad.c: set $AMANDA_AUTHENTICATED_PEER for services

2010-09-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amxml.c: Fix unallocating NULL g_hash.
	* server-src/chunker.c: Don't free cmdargs.

2010-09-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Fix pointer arithmetic.

2010-09-27  Dustin J. Mitchell <dustin@zmanda.com>
	* man/Makefile.am man/xml-source/amanda-match.7.xml: new manpage with
	  descriptions of match expressions
	* man/xml-source/amadmin.8.xml man/xml-source/amanda.8.xml
	  man/xml-source/amdump.8.xml man/xml-source/amfetchdump.8.xml
	  man/xml-source/amflush.8.xml man/xml-source/amrestore.8.xml
	  man/xml-source/amvault.8.xml: reference it

2010-09-27  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/util.c common-src/util.h: support ##.## in braced
	  alternates
	* installcheck/Amanda_Util.pl: test it
	* perl/Amanda/Util.pod man/xml-source/amanda-changers.7.xml
	  man/xml-source/amanda-devices.7.xml: document it

2010-09-27  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c, client-src/client_util.c,
	  client-src/selfcheck.c, client-src/sendsize.c, common-src/amxml.c,
	  common-src/amxml.h, common-src/glib-util.c, common-src/glib-util.h,
	  common-src/security-util.c, common-src/util.c,
	  perl/Amanda/Tapelist.swg, server-src/amcheck.c, server-src/amtrmidx.c,
	  server-src/chunker.c, server-src/diskfile.c, server-src/driver.c,
	  server-src/driverio.c, server-src/dumper.c, server-src/find.c,
	  server-src/holding.c, server-src/planner.c, server-src/server_util.c,
	  server-src/xfer-source-holding.c: Fix memory leak.

2010-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/alloc.c: remove amtable functions
	* common-src/amanda.h: remove prototypes

2010-09-24  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amstar.c: Check root can cd to the directory.

2010-09-24  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/human.pm: Correctly print new tapes to use.
	* installcheck/catalogs/filesystemstaped.cat: write the tapelist file
	* installcheck/amreport.pl: Test it.

2010-09-24  Dustin J. Mitchell <dustin@zmanda.com>
	* NEWS: amvault and other new news
	* server-src/amvault.pl: support --dry-run
	* man/xml-source/amvault.8.xml: docs
	* installcheck/amvault.pl: tests

2010-09-24  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/security.h: add get_authenticated_peer_name method
	* common-src/security-util.c common-src/security-util.h: add two
	  implementations
	* common-src/sockaddr-util.c common-src/sockaddr-util.h: add
	  str_to_sockaddr
	* amandad-src/amandad.c: log authenticated peer name
	* common-src/bsd-security.c common-src/bsdtcp-security.c
	  common-src/bsdudp-security.c common-src/krb5-security.c
	  common-src/local-security.c common-src/rsh-security.c
	  common-src/ssh-security.c: implement get_authenticated_peer_name
	* common-src/util.h: fix comments
	* config/gnulib/gnulib-cache.m4 config/gnulib/gnulib-comp.m4
	  config/gnulib/inet_pton.m4 gnulib/Makefile.am gnulib/c-ctype.c
	  gnulib/c-ctype.h gnulib/inet_pton.c gnulib/regenerate/regenerate: add
	  inet_pton module
	* man/xml-source/amanda-auth.7.xml: update manual to describe
	  authenticated peer names

2010-09-24  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Check size before allocating.

2010-09-24  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda-devices.7.xml: LEOM property is not read-only

2010-09-24  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/xfer-dest-taper-splitter.c (device_thread_write_part):
	  Don't write more than the block size.

2010-09-23  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amreport.pl: update checks to match amreport change

2010-09-23  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Cmdline.pod perl/Amanda/Cmdline.swg: update POD, add
	  exports
	* server-src/amreport.pl: don't print anything in script mode when
	  there is nothing to do
	* perl/Amanda/Report.pm: handle ERROR and FATAL from amvault
	* server-src/amvault.pl: make dst-changer and src-timestamp into
	  --options and add support for dumpspecs
	* man/xml-source/amvault.8.xml: document
	* installcheck/amvault.pl: test changes
	* installcheck/Amanda_Cmdline.pl: remove TODO

2010-09-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (startaflush_tape): Use tape_length if the
	  tape is not started.

2010-09-22  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xslt/html.xsl.in: include Amanda version in HTML footers

2010-09-22  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amvault.pl: add an INFO line for every source volume read

2010-09-22  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amvault.pl: add extra logging for amreport, and invoke
	  amreport at the end of a run
	* perl/Amanda/Logfile.swg server-src/logfile.c server-src/logfile.h:
	  add P_AMVAULT
	* perl/Amanda/Report.pm perl/Amanda/Report/human.pm
	  server-src/amreport.pl: handle amvault logs, too

2010-09-21  Orion Poplawski <orion@cora.nwra.com>
	* server-src/amoverview.pl: fix remaining uninitialized value warnings

2010-09-21  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/DB/Catalog.pm: add a status even for dumps with no
	  successful parts on tape; comments and POD

2010-09-21  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/catalogs/amflush.cat
	  installcheck/catalogs/bigestimate.cat
	  installcheck/catalogs/doublefailure.cat
	  installcheck/catalogs/fatal.cat
	  installcheck/catalogs/filesystemstaped.cat
	  installcheck/catalogs/flush-noorigsize.cat
	  installcheck/catalogs/flush-origsize.cat
	  installcheck/catalogs/longstrange.cat
	  installcheck/catalogs/multi-taper.cat installcheck/catalogs/normal.cat
	  installcheck/catalogs/plannerfail.cat
	  installcheck/catalogs/resultsmissing.cat
	  installcheck/catalogs/retried-nofinish.cat
	  installcheck/catalogs/retried-strange.cat
	  installcheck/catalogs/retried.cat
	  installcheck/catalogs/shortstrange.cat
	  installcheck/catalogs/skipped.cat installcheck/catalogs/spanned.cat
	  installcheck/catalogs/strontium.cat installcheck/catalogs/taperr.cat:
	  update expected reports to match updated amreport output

2010-09-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c, server-src/driver.c, server-src/planner.c:
	  Don't print warning for 'holdingdisk auto' and directtcp data path.

2010-09-21  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Add VERBOSE property,
	  unlink include/exclude file if VERBOSE if NO.
	* man/xml-source/amgtar.8.xml: Document VERBOSE property.

2010-09-21  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am: make the thread check mandatory on FreeBSD
	* config/amanda/swig.m4: detect FreeBSD

2010-09-21  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Report/human.pm: change some strings, and make
	  the statistics section more succinct; suggested by Jon LaBadie

2010-09-20  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amadmin.c: add 'dles' and 'hosts' subcommands
	* man/xml-source/amadmin.8.xml: document them

2010-09-20  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Script_App.pm: Call _set_mesgout.
	* perl/Amanda/Application.swg, perl/Amanda/Script.pm (_set_mesgout):
	  Set $self->{mesgout}.
	* application-src/amraw.pl, application-src/amsamba.pl
	  application-src/amsuntar.pl, application-src/amzfs-sendrecv.pl,
	  Don't set $self->{mesgout}.

2010-09-20  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/DB/Catalog.pm: docs changes + defensive programming

2010-09-20  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/find.c: only expect partnum/totalparts in taper log lines
	* installcheck/catalogs/bigdb.cat: tests

2010-09-20  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/xfer-source-recovery.c: add XFER_MECH_DIRECTTCP_LISTEN to
	  XferSourceRecovery

2010-09-19  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/disk.pm: but still return stringy slot names

2010-09-19  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/disk.pm: sort slots numerically; patch by
	  'ghosts' on forums.zmanda.com

2010-09-18  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda-devices.7.xml: more detail on LEOM handling in
	  tape device

2010-09-18  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Xfer.swg: conditionalize loading XferServer on server
	  component

2010-09-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Send filter STDERR to log file, backup is
	  marked as failed.

2010-09-17  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/ndmp-device.c, device-src/tape-device.c,
	* device-src/vfs-device.c: Don't set the header if nothing is read.
	* device-src/vfs-device.c: Set header to F_EMTPY if file 0 doesn't
	  exists
	* perl/Amanda/Taper/Scan/traditional.pm: Correctly check device
	  status and header.
	* installcheck/Amanda_Changer_multi.pl: Updated.
	* installcheck/amcheck-device.pl: Updated.
	* installcheck/amdevcheck.pl: Updated.

2010-09-17  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/driver.c: start up correctly with --no-taper
	* server-src/driverio.c server-src/driverio.h: take no_taper as
	  argument to startup_tape_process

2010-09-17  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/DB/Catalog.pm: new methods to determine the type of
	  a run
	* installcheck/Amanda_DB_Catalog.pl: test them
	* server-src/amvault.pl: 'latest' excludes amvault runs; add START
	  amvault to identify such runs
	* installcheck/catalogs/bigdb.cat: add 'START planner' where missing
	* installcheck/amvault.pl: cleanup after tests

2010-09-16  Dustin J. Mitchell <dustin@zmanda.com>
	* NEWS: mention improvements to amvault
	* server-src/amvault.pl: Add --autolabel=.. and --label-template=..
	* installcheck/amvault.pl: update tests
	* man/xml-source/amvault.8.xml: update manpage

2010-09-16  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amreport.pl: support more than one email address
	* installcheck/amreport.pl: change error message

2010-09-16  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: Generate new label and reserved them
	  in the tapelist file.
	  Remove the "Will write new label `$LABEL' to new tape" message.
	* perl/Amanda/Taper/Scan.pm (make_new_tape_label): Canget the tapelist
	   in the argument.
	* perl/Amanda/Taper/Worker.pm: Don't update the tapelist file.
	* server-src/amvault.pl: Don't update the tapelist file.
	* installcheck/Amanda_Report.pl: Remove 'Will write ...' message.
	  installcheck/Amanda_Taper_Scribe.pl: Remove 'Will write ...' message.
	  installcheck/taper.pl: Remove 'Will write ...' message.

2010-09-16  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Tapelist.swg: New Amanda::Tapelist API with lock.
	* perl/Amanda/Tapelist.pod: Document new API.
	  perl/Amanda/DB/Catalog.pm, perl/Amanda/Recovery/Planner.pm,
	  perl/Amanda/Taper/Scan.pm, perl/Amanda/Taper/Scan/traditional.pm,
	  perl/Amanda/Taper/Worker.pm, server-src/amcheckdump.pl,
	  server-src/amlabel.pl, server-src/amreport.pl,
	  server-src/amrmtape.pl, server-src/amvault.pl: Use new API
	* installcheck/Amanda_Logfile.pl,
	  installcheck/Amanda_Tapelist.pl, installcheck/amlabel.pl,
	  installcheck/amrmtape.pl, installcheck/amtape.pl,
	  installcheck/Amanda_Recovery_Clerk.pl: Fix for new API.

2010-09-16  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/xfer.c xfer-src/xfer.h: add xfer_atomic_swap_fd
	* xfer-src/xfer-element.c xfer-src/xfer-element.h: add
	  xfer_element_swap_input_fd and xfer_element_swap_output_fd and
	  use them to access input_fd and output_fd atomically
	* xfer-src/element-glue.c: add get_read_fd and get_write_fd to handle
	  taking ownership of fd's even in pull_and_write and read_and_push
	* xfer-src/filter-process.c xfer-src/source-fd.c xfer-src/xfer-test.c
	  xfer-src/dest-fd.c: use xfer_element_swap_*_fd

2010-09-16  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Worker.pm: Use 'our $tape_num'.
	* installcheck/taper.pl: Fix for correct tape_num.

2010-09-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Use many worker.
	* server-src/driverio.c: Init many worker.
	* server-src/driverio.h (TaperState): New taper state.
	* server-src/server_util.c: Add "TAKE-SCRIBE-FROM".
	* server-src/server_util.h: Add TAKE_SCRIBE_FROM.

2010-09-15  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Protocol.pm (TAKE_SCRIBE_FROM): New in protocol.
	* perl/Amanda/Taper/Controller.pm (msg_TAKE_SCRIBE_FROM): New function.
	* perl/Amanda/Taper/Scribe.pm: Add scribe parameter in perm_cb.
	  transfert the xfer to a new scribe.
	* perl/Amanda/Taper/Worker.pm (TAKE_SCRIBE_FROM): New method.
	* perl/Amanda/Xfer.swg (xfer_set_callback): New method.
	* installcheck/taper.pl: Test TAKE-SCRIBE-FROM command.

2010-09-15  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Changer_compat.pl: Fix Installcheck::Run::setup.
	* installcheck/Installcheck/Run.pm (setup): Take an argument to set
						    new vtapes.
	* installcheck/Amanda_Taper_Scribe.pl: Fix for start_scan and perm_cb.
	* installcheck/taper.pl: Fix and test for START_SCAN cmd.
	* perl/Amanda/Taper/Controller.pm (msg_START_SCAN): New function.
	* perl/Amanda/Taper/Protocol.pm (START_SCAN): New in protocol.
	* perl/Amanda/Taper/Scribe.pm: Doesn't automaticaly start a scan,
	  new perm_cb argument, new start_scan method.
	* perl/Amanda/Taper/Worker.pm (START_SCAN): New method,
	  call perm_cb with new argument.
	* server-src/amvault.pl: Call start_scan and perm_cb with new argument.
	* server-src/driver.c: Send START_SCAN command to taper.
	* server-src/driverio.c (taper_cmd): Add START_SCAN.
	* server-src/server_util.c (cmdstr): add "START-SCAN".
	* server-src/server_util.h: Add START_SCAN.

2010-09-15  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Protocol.pm: Add worker_name in protocol.
	* perl/Amanda/Taper/Controller.pm,
	* perl/Amanda/Taper/Worker.pm: Use worker_name.
	* server-src/driverio.c (taper_cmd): Send worker_name to taper.
	* server-src/driver.c: New argument to taper_cmd.
	* server-src/amstatus.pl: Parse worker_name.
	* installcheck/catalogs/chunker-partial.cat,
	  installcheck/catalogs/normal.cat,
	  installcheck/catalogs/quoted.cat: Add worker_name.
	* installcheck/taper.pl: Add worker_name.

2010-09-14  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.pl: Split in many files, add the worker.
	* perl/Amanda/Taper/Controller.pm: Splitted from taper.pl
	* perl/Amanda/Taper/Protocol.pm: Splitted from taper.pl
	* perl/Amanda/Taper/Worker.pm: New class
	* perl/Makefile.am: Add Controller.pm, Protocol.pm and Worker.pm.

2010-09-14  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: update 'tapecycle' description

2010-09-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amflush.c: Don't include driverio.h
	* server-src/driver.c, server-src/driverio.c, server-src/driverio.h:
	  Put all taper variables in a taper_t structure.

2010-09-13  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/amreport.pl: Load the config instead of using amgetconf.

2010-09-13  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/amreport.pl: Use full path to amgetconf.

2010-09-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c: Parse log with taper lines mixed.
	* perl/Amanda/Report.pm: Parse log with taper lines mixed.
	* installcheck/Amanda_DB_Catalog.pl: Check it.
	* installcheck/Makefile.am (catalogs) : Add catalogs/multi-taper.cat.
	* installcheck/amreport.pl: Check it;
	* installcheck/catalogs/multi-taper.cat: Catalog with taper lines mixed.

2010-09-13  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amoverview.8.xml: document long options
	* server-src/amoverview.pl: fix bugs, stop using perl formats, and
	  give long options in the usage message
	* installcheck/catalogs/bigdb.cat: add disklist
	* installcheck/amoverview.pl: more thorough tests based on bigdb

2010-09-13  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amdump.8.xml: document --no-taper
	* server-src/Makefile.am: rename amdump.sh -> .pl
	* server-src/amdump.sh server-src/amdump.pl: rewrite in perl, add
	  --no-taper
	* server-src/driver.c: support --no-taper by not starting taper
	* server-src/planner.c: support --no-taper by not sending flushes

2010-09-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c (find_dump): Don't print the
					 'log files found for tape' warning.
	* server-src/amadmin.c: Call find_log to print the warning.

2010-09-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amserverconfig.pl: Use $pw[0].

2010-09-13  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add taper-parallel-write.
	* common-src/conffile.h: Add taper-parallel-write.
	* man/xml-source/amanda.conf.5.xml:: Add taper-parallel-write.

2010-09-10  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am installcheck/amflush.pl: new installcheck

	* server-src/amflush.c: flush DLEs that aren't in the disklist anymore
	* server-src/diskfile.c server-src/diskfile.h: add match_dumpfile,
	  based on match_disklist
	* server-src/driver.c: load holding-disk pseudo-DLEs at startup
	* server-src/driverio.c: survive configuration-free DLEs
	* server-src/holding.c server-src/holding.h: search_holding_file no
	  longer checks against disklist
	* server-src/planner.c: use match_dumpfile for holding-disk DLEs

2010-09-10  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Device.pl: use srcdir
	* installcheck/Installcheck.pm: set srcdir from env
	* installcheck/Installcheck/Catalogs.pm: use srcdir
	* installcheck/Makefile.am: set $srcdir for tests

2010-09-09  Lyndon Nerenberg <lyndon@orthanc.ca>
	* Makefile.am: fix to enable builds outside srcdir

2010-09-09  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amvault.pl: add --export
	* man/xml-source/amvault.8.xml: doc it
	* installcheck/amvault.pl: test it

2010-09-09  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/find.c: fix segfault and bug in failed-dumps-in-catalog
	  hack

2010-09-08  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: include
	  installcheck/catalog/retried-strange.cat in distribution

2010-09-08  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/catalogs/retried-strange.cat: add a retried dump
	  where the retry is strange
	* installcheck/amreport.pl: test it
	* perl/Amanda/Report/human.pm: fix the bug it reveals

2010-09-08  Dustin J. Mitchell <dustin@zmanda.com>
	* gnulib/regenerate/regenerate: add 'environ' module
	* config/gnulib/gnulib-cache.m4 config/gnulib/gnulib-comp.m4
	  gnulib/Makefile.am config/gnulib/environ.m4: new module

2010-09-08  Dustin J. Mitchell <dustin@zmanda.com>
	* config/gnulib/* gnulib/*: upgrade to get a fix to getopt.m4
	* gnulib/regenerate/regenerate: change gnulib sha1

2010-09-08  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amreport.8.xml: describe the format of the dump, with
	  notes and details

2010-09-08  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: add scribe_notif_tape_done
	* installcheck/Amanda_Taper_Scribe.pl: test it

2010-09-08  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Send tar stderr to the server.

2010-09-08  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amserverconfig.pl: use RUNNING_AS_ANY and
					set dumpuser in amanda.conf.

2010-09-07  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/alloc.c: remove unnecessary declaration of 'environ'

2010-09-07  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/robot.pm: allow move to move loaded volumes
	* installcheck/Amanda_Changer_robot.pl: test it

2010-09-07  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndmpconnobj.c: When listening for a notify, do not hog the
	  ndmlib_mutex

2010-09-07  Dustin J. Mitchell <dustin@zmanda.com>
	* config/gnulib/* gnulib/*: Gnulib fix reflected into Amanda; see
	  http://www.mail-archive.com/bug-gnulib@gnu.org/msg19345.html

2010-09-07  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Recovery_Clerk.pl: re-use already-full changer
	  slots, to save space

2010-09-07  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm: fix make_combined_error
	* perl/Amanda/Changer/robot.pm: correctly set up polling for device
	  ready; use 'unknown', not 'device', as a reason; always return a
	  changer error, not a string

2010-09-07  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tape-aix.c device-src/tape-uware.c
	  device-src/tape-xenix.c: remove unmaintained, and apparently unused,
	  implementations
	* device-src/tape-posix.c device-src/tape-device.c: merge tape-posix.c
	* device-src/tape-device.h: remove
	* device-src/tape-ops.h: remove

	* config/amanda/tape.m4: don't look for AIX, Uware, or Xenix anymore
	* device-src/Makefile.am: remove tape ops conditionals

2010-09-01  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in: add check for unsetenv

2010-09-01  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: add Installcheck::Catalog and the
	  catalogs to the distribution

2010-08-31  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amserverconfig.pl: skip the correct number of tests

2010-08-31  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amserverconfig.pl: don't try running tape-changer if
	  MTX is not installed
	* server-src/amserverconfig.pl: create $CONFIG_DIR if required.  This
	  passes on my system and should pass on the Mac systems.

2010-08-31  Dustin J. Mitchell <dustin@zmanda.com>
	* config/.gitignore: don't ignore these files
	* config/arg-nonnull.h config/c++defs.h config/warn-on-use.h: add
	  ignored, but required, gnulib files

2010-08-31  Dustin J. Mitchell <dustin@zmanda.com>
	* NEWS: note removal of changers
	* changer-src/Makefile.am changer-src/chg-chio.pl
	  changer-src/chg-chs.sh changer-src/chg-iomega.pl
	  changer-src/chg-juke.sh changer-src/chg-mcutil.sh
	  changer-src/chg-mtx.sh changer-src/chg-null.sh changer-src/chg-rait.sh
	  changer-src/chg-rth.pl changer-src/chg-scsi-chio.c
	  changer-src/chg-scsi.c changer-src/libscsi.h changer-src/scsi-aix.c
	  changer-src/scsi-bsd.c changer-src/scsi-cam.c
	  changer-src/scsi-changer-driver.c changer-src/scsi-chio.c
	  changer-src/scsi-defs.h changer-src/scsi-hpux.c
	  changer-src/scsi-hpux_new.c changer-src/scsi-irix.c
	  changer-src/scsi-linux.c changer-src/scsi-proto.c
	  changer-src/scsi-solaris.c changer-src/sense.c: remove changers and
	  system-specific SCSI code
	* config/amanda/changer.m4: remove unnecessary checks
	* config/amanda/progs.m4: remove checks for chio, chs, and mcutil
	* configure.in: remove changer invocations

2010-08-31  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/driverio.c: Don't write negative origsizes to the taper

2010-08-31  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amcheck.c: drop root privs during the server check, so
	  that access() will test the dumpuser's perms, not root's perms

2010-08-31  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Taper_Scribe.pl: spell it part-cache-dir
	* installcheck/amtapetype.pl: spell it device-property
	* server-src/amcheckdump.pl: tar requires -tf, not tf, after a long
	  option
	* server-src/amserverconfig.pl: use Amanda::Util and mkpath instead of
	  mkdir

2010-08-31  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: new tests
	* installcheck/amserverconfig.pl: run amserverconfig
	* installcheck/example.pl: test that templates parse properly
	* server-src/amserverconfig.pl: minor cleanup of old perl

2010-08-31  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/dumper.c changer-src/chg-scsi.c: use fseeko
	* config/.gitignore config/config.rpath config/gnulib/* gnulib/*:
	  upgrade gnulib
	* gnulib/regenerate/no-error.patch: updated patch
	* gnulib/regenerate/regenerate: drop visibility module; specify new
	  git hash

2010-08-31  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/catalogs/normal.cat: add orig-size -1 and orig-size 0
	  to logfiles to check handling of those cases
	* perl/Amanda/Report.pm: fix (egregious) typo
	* perl/Amanda/Report/human.pm: handle compression better, handle
	  printing non-contiguous levels

2010-08-31  Dustin J. Mitchell <dustin@zmanda.com>
	* application-src/ampgsql.pl: remove check for a directory that
	  should not be readable to the amanda user

2010-08-31  Dustin J. Mitchell <dustin@zmanda.com>
	* application-src/amgtar.c application-src/ampgsql.pl
	  recover-src/extract_list.c server-src/amcheckdump.pl: Use
	  --ignore-zeros in all -t or -x invocations of gtar

2010-08-31  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda-auth.7.xml
	  man/xml-source/amanda-changers.7.xml
	  man/xml-source/amanda-client.conf.5.xml
	  man/xml-source/amanda-compatibility.7.xml
	  man/xml-source/amanda-devices.7.xml
	  man/xml-source/amanda-taperscan.7.xml man/xml-source/amanda.conf.5.xml
	  man/xml-source/amcheck.8.xml man/xml-source/amrecover.8.xml: remove
	  references to krb4 and to the pre-spanning days, and canonicalize
	  all configuration parameters to use -, not _
	* common-src/conffile.c device-src/activate-devpay.c
	  device-src/amtapetype.pl perl/Amanda/Application/Zfs.pm
	  perl/Amanda/Taper/Scribe.pm server-src/amadmin.c server-src/amcheck.c
	  server-src/amreport.pl server-src/driver.c server-src/planner.c:
	  canonicalize configuration parameter names in error messages to use -,
	  not _

2010-08-31  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Catalogs.pm: tool to install catalogs
	  dynamically, rather than including them in __DATA__
	* installcheck/catalogs/*: new catalog files
	* installcheck/Amanda_DB_Catalog.pl
	  installcheck/Amanda_Recovery_Planner.pl installcheck/amreport.pl
	  installcheck/amstatus.pl: use Installcheck::Catalog
	* perl/Amanda/Recovery/Planner.pm: check that parameters exist

2010-08-25 Dan Locks <dwlocks@zmanda.com>
	*  packaging/deb/control: Fix missing line break so dpkg can parse the
	   control file

2010-08-23  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amvault.pl: add --fulls-only option
	* man/xml-source/amvault.8.xml: document

2010-08-23 Dan Locks <dwlocks@zmanda.com>
	*  packaging/deb/control: add ca-certificates and procps

2010-08-21  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/fileheader.c: remove incorrect validations for
	  CONT_FILENAME and APPLICATION

2010-08-20 Dan Locks <dwlocks@zmanda.com>
	*  The error fixed here was reported by ssgelm.
	*  packaging/common/substitute.pl: Use FULL_VERSION instead of
	   VERSION.
	*  packaging/rpm/amanda.spec.src: renamed from amanda.spec, added
	   %%VERSION%% macro for substitute.pl, fixed glib2 requires typo
	*  packaging/rpm/buildpkg: refactored into "do_thing" functions, added
	   substitute.pl machinery.

2010-08-20 Dan Locks <dwlocks@zmanda.com>
	*  packaging/rpm/amanda.spec: add openSuSE 11 detection and
	   buildrequires glib2-devel, as written by ssgelm

2010-08-13  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/debugging.m4: make the default for syntax-checks
	  "disabled", add a warning when enabling
	* perl/Makefile.am config/automake/scripts.am: don't do any checks
	  that require linking perl extension modules unless SYNTAX_CHECKS is
	  set
	* installcheck/Makefile.am: always skip syntax checks
	* application-src/amlog-script.pl application-src/amraw.pl
	  application-src/amsamba.pl application-src/amsuntar.pl
	  application-src/amzfs-sendrecv.pl application-src/amzfs-snapshot.pl
	  application-src/script-email.pl common-src/amgetconf.pl
	  device-src/amdevcheck.pl device-src/amtapetype.pl
	  installcheck/Amanda_Changer.pl installcheck/Amanda_Changer_ndmp.pl
	  installcheck/Amanda_Changer_null.pl
	  installcheck/Amanda_Changer_rait.pl
	  installcheck/Amanda_Changer_robot.pl
	  installcheck/Amanda_Changer_single.pl installcheck/Amanda_Cmdline.pl
	  installcheck/Amanda_Config.pl installcheck/Amanda_Curinfo.pl
	  installcheck/Amanda_Debug.pl installcheck/Amanda_Device.pl
	  installcheck/Amanda_Disklist.pl installcheck/Amanda_Feature.pl
	  installcheck/Amanda_Header.pl installcheck/Amanda_Logfile.pl
	  installcheck/Amanda_NDMP.pl installcheck/Amanda_Process.pl
	  installcheck/Amanda_Recovery_Scan.pl installcheck/Amanda_Tapelist.pl
	  installcheck/Amanda_Taper_Scribe.pl installcheck/Amanda_Xfer.pl
	  installcheck/amadmin.pl installcheck/amarchiver.pl
	  installcheck/amcheck-device.pl installcheck/amcheck.pl
	  installcheck/amcheckdump.pl installcheck/amdevcheck.pl
	  installcheck/amdump.pl installcheck/amgetconf.pl
	  installcheck/amlabel.pl installcheck/amoverview.pl
	  installcheck/amrmtape.pl installcheck/amservice.pl
	  installcheck/amstatus.pl installcheck/amtape.pl
	  installcheck/amtapetype.pl installcheck/amvault.pl
	  installcheck/bigint.pl installcheck/mock_mtx.pl installcheck/taper.pl
	  server-src/amcheckdump.pl server-src/amcleanup.pl
	  server-src/amlabel.pl server-src/amtape.pl server-src/amvault.pl: add
	  strict and/or warnings, and fix (trivial) resulting warnings

2010-08-13  Nikhil Bhupale <nikhilb@zmanda.com>
	* AUTHORS: add Nikhil
	* device-src/ndmp-device.c: add READ_BLOCK_SIZE support
	* installcheck/Amanda_Device.pl: test it
	* man/xml-source/amanda-devices.7.xml: document it

2010-08-11  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Util.pod perl/Amanda/Util.swg: add split_quoted_strings_friendly
	* installcheck/Amanda_Util.pl: test it
	* application-src/amsamba.pl: use it to parse amandapass

2010-08-10  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/find.c: parse old SUCCESS lines properly
	* perl/Amanda/DB/Catalog.pm: same
	* installcheck/Amanda_DB_Catalog.pl: test old SUCCESS lines

2010-08-10  Dustin J. Mitchell <dustin@zmanda.com>
	* amandad-src/amandad.c: unset SUN_PERSONALITY on startup
	* client-src/rundump.c client-src/runtar.c: remove unsetenvs for SUN_PERSONALITY

2010-08-10  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amlogroll.pl: ignore arguments after the first

2010-08-06  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amvault.pl: correct test count
	* perl/Amanda/Taper/Scribe.pm: fix nparts calculation

2010-08-06  Stephen Gelman <ssgelm@gmail.com>
	* AUTHORS: add Stephen
	* client-src/rundump.c client-src/runtar.c: unset
	  SUN_PERSONALITY in runtar and rundump, to shut off
	  Nexenta's tendency to magically run Sun binaries

2010-08-05  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amvault.pl: rewrite to use scribe, clerk
	* installcheck/amvault.pl: check results better
	* server-src/logfile.c server-src/logfile.h: add log_add_full
	* perl/Amanda/Logfile.pod perl/Amanda/Logfile.swg: add log_add_full
	  and make_stats methods
	* perl/Amanda/MainLoop.pod: POD typos
	* perl/Amanda/Recovery/Planner.pm: add shift_dump method
	* perl/Amanda/Taper/Scan.pm: add POD, fix typos
	* perl/Amanda/Taper/Scribe.pm: fix POD, add nparts argument to dump_cb
	* server-src/taper.pl: use nparts, move make_stats to Amanda::Logfile

2010-08-05  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda-changers.7.xml: add chg-ndmp VERBOSE
	  property

2010-08-04  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Recovery/Clerk.pm: rename notif_* to clerk_notif_*
	* perl/Amanda/Taper/Scribe.pm: rename notif_* to scribe_notif_*
	* installcheck/Amanda_Recovery_Clerk.pl
	  installcheck/Amanda_Taper_Scribe.pl server-src/amcheckdump.pl
	  server-src/amfetchdump.pl server-src/amidxtaped.pl
	  server-src/taper.pl: use renamed methods

2010-08-04  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Logfile.pod perl/Amanda/Logfile.swg: add log_rename
	  and a method to find the proper timestamp for the current log
	* installcheck/Amanda_Logfile.pl: test it
	* server-src/Makefile.am server-src/amlogroll.c
	  server-src/amlogroll.pl: rewrite in perl

2010-08-03  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/ipv6.m4: fix config messages to not use the
	  autoconf-specific word "target"

2010-08-03  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: add more info about appropriate
	  settings for autolabel

2010-08-03  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/security.h: move comments from wiki, reorder functions

2010-08-03  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amdump.sh: Check it own the log file.

2010-08-02  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c (interruptible_accept): Set the read set and
	  timeout before each select call.

2010-07-29  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amvault.pl: only run as dumpuser

2010-07-29  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda-auth.7.xml: consistently use the same
	  username in examples (thanks to Amar Takhar)

2010-07-29  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/filter-process.c: handle fd's <= 2 correctly

2010-07-28  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/krb5-security.c (krb5_tcpm_recv_token): New function, a
	  copy of tcpm_recv_token.
	* common-src/security-util.c: New tcpm_recv_token without a timeout.
	* common-src/security-util.h: Add field to keep a buffer in tcp_conn.

2010-07-28  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Script_App.pm: Print restore message to STDERR.

2010-07-28  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/progs.m4: require SWIG-1.3.39
	* (all .c files): #include amanda.h first
	* perl/amglue/amglue.swg: use %begin to include config.h first

2010-07-28  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/amtapetype.pl: detect LEOM and add appropriate
	  comments
	* device-src/xfer-dest-device.c device-src/xfer-device.h: add
	  cancel_at_leom constructor arg
	* installcheck/Amanda_Device.pl installcheck/Amanda_Recovery_Clerk.pl
	  installcheck/Amanda_Xfer.pl installcheck/amrestore.pl
	  perl/Amanda/Xfer.pod perl/Amanda/XferServer.swg
	  server-src/amvault.pl: pass new argument

2010-07-28  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tape-device.c device-src/tape-device.h: autodetect
	  the LEOM property, and handle various operating systems' LEOM
	  indications
	* device-src/tape-aix.c device-src/tape-posix.c
	  device-src/tape-uware.c device-src/tape-xenix.c: set LEOM property to
	  FALSE by default

2010-07-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c (find_result_t): Add a write_timestamp.
	* server-src/find.h: Set the write_timestamp.
	* server-src/amcheckdump.pl: Use the write_timestamp.
	* server-src/amidxtaped.pl: write_timestamp is undef.
	* server-src/cmdline.h (dumpspec_t): Add a write_timestamp.
	* server-src/cmdline.c (dumpspec_new): New write_timestamp argument.
	* perl/Amanda/Logfile.swg (find_result_t): Add a write_timestamp.
	* perl/Amanda/Cmdline.swg (dumpspec_t): Add a write_timestamp.
	* perl/Amanda/Cmdline.pod: Document write_timestamp.
	* perl/Amanda/DB/Catalog.pm (get_parts_and_dumps): Filter with dumpspec
	  write_timestamp.
	* installcheck/Amanda_Cmdline.pl: Fix and check new api.
	* installcheck/Amanda_DB_Catalog.pl: Fix and check new api.
	* installcheck/Amanda_Logfile.pl: Fix and check new api.
	* installcheck/Amanda_Recovery_Planner.pl: Fix and check new api.

2010-07-27  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in perl/amglue/Makefile.am: new Makefile for
	  libamglue
	* perl/Makefile.am: use SUBDIRS to build libamglue before
	  any SWIG modules, as automake does not get inter-library
	  dependencies right at install time if the libraries are
	  all built in the same directory

2010-07-27  Dustin J. Mitchell <dustin@zmanda.com>
	* application-src/ampgsql.pl: also check PG-DATADIR

2010-07-26  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_DB_Catalog.pl
	  installcheck/Amanda_Recovery_Planner.pl installcheck/amidxtaped.pl
	  installcheck/taper.pl server-src/amrestore.pl: skip perl's stdio
	  buffering when writing holding-file headers

2010-07-26  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Ignore the FORCE command if strategy is
	  INCRONLY.

2010-07-26  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Xfer.pl: *real* correct number of tests for
	  --without-server

2010-07-25  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Xfer.pl: correct number of tests for
	  --without-server

2010-07-25  Orion Poplawski <orion@cora.nwra.com>
	* server-src/amoverview.pl: fix host iteration and handle case of only
	  one write_timestamp

2010-07-24  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/vfs-device.c: announce LEOM one byte later
	* installcheck/Amanda_Xfer.pl: set device properties before starting

2010-07-24  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/robot.pm: use correct device field volume_header

2010-07-23  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/ndmp.pm: increase the REQUEST ELEMENT STATUS
	  timeout to 60s and set CURDATA=1 to use cached state

2010-07-23  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/disk.pm: unlink drive if pid not in state file.
	* perl/Amanda/Taper/Scribe.pm: Release scribe reservation and
				       devhandling reservation.
	* server-src/taper.pl: Write quit error meesage to debug file.

2010-07-22  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/vfs-device.c device-src/vfs-device.h: add support for
	  monitoring free space to generate LEOM before ENOSPC hits; set LEOM
	  property to TRUE by default
	* installcheck/Amanda_Device.pl: test monitor_free_space prop
	* man/xml-source/amanda-devices.7.xml: document VFS device LEOM
	  support and the MONITOR_FREE_SPACE property

2010-07-22  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/vfs-test.c device-src/Makefile.am: remove vfs-test
	* device-src/property.c device-src/property.h: remove FREE_SPACE
	  property, QualifiedSize, and SizeAccuracy
	* device-src/vfs-device.c device-src/rait-device.c: remove FREE_SPACE
	  support
	* man/xml-source/amanda-devices.7.xml: remove docs
	* perl/Amanda/Device.swg: remove SWIG interface for QualifiedSize

2010-07-22  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/Makefile.am: add reference to new header file

2010-07-22  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/xfer-dest-taper-cacher.c: remove support for
	  cache_inform, simplify disk cache
	* device-src/xfer-dest-taper-splitter.c: add support for cache_inform,
	  use it even when LEOM is available
	* device-src/xfer-dest-taper.c device-src/xfer-dest-taper.h
	  device-src/xfer-device.h: move common methods to new header file; add
	  instance_init
	* installcheck/Amanda_Xfer.pl perl/Amanda/Taper/Scribe.pm: always use
	  splitter for cache_inform
	* perl/Amanda/Xfer.pod perl/Amanda/XferServer.swg: change function
	  signatures
	* perl/amglue/glib.swg: take any perl true or flase value to make
	  a gboolean

2010-07-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.h (disk_t) Add allow_split and splitsize.
	* server-src/diskfile.c: Set allow_split and splitsize.
	* server-src/driver.c: Use allow_split and splitsize.
	* server-src/planner.c: Use allow_split and splitsize.
	* server-src/amadmin.c (disklist_one): Print allow_split.

2010-07-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.pl: Use ' to quote label in 'wrote label' line.
	* server-src/amstatus.pl: Parse it.
	* installcheck/amstatus.pl: Check it.

2010-07-16  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/Makefile.am: use += with BUILT_SOURCES

2010-07-16  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amrecover.8.xml recover-src/amrecover.c: add a -h
	  parameter that sets the initial host
	* installcheck/amrecover.pl: use it, so tests run even at 30,000 feet
	  with no net connection

2010-07-16  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/syshacks.m4: Mac OS X 10.6 (Snow Leopard) supported
	* config/amanda/tape.m4: fix bugs causing tape support to always be
	  built (symbols aren't defined in Snow Leopard)
	* device-src/device.c: fix bug
	* perl/Amanda/Device.swg: return undef for undefined properties,
	  rather than crashing
	* installcheck/Amanda_Changer_single.pl installcheck/amdevcheck.pl: do
	  not assume tape device is defined

2010-07-16  Dustin J. Mitchell <dustin@zmanda.com>
	* config/macro-archive/ac_prog_swig.m4: fix swig version detection
	  - swig-2.0.0 works fine

2010-07-16  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Tapelist.swg: better fix for temp filename

2010-07-15  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/human.pm: Correcly compute 'Filesystem taped' for
				       incremental.
	* installcheck/amreport.pl: Test it.

2010-07-15  Satya Ganga  <gast@zmanda.com>
	* config/amanda/progs.m4: Use correct search path for mt binary.

2010-07-14  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Tapelist.swg: append a slash to dirname() and make error
	  messages better

2010-07-14  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in config/amanda/shmem.m4: remove unnecessary config
	  checks

2010-07-13  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Report.pm: parse the planner's skipping a dump
	* perl/Amanda/Report/human.pm: present it correctly
	* installcheck/amreport.pl: adjust tests accordingly

2010-07-12  Nandan Athawale <nandan.athawale@gmail.com>
	* perl/Amanda/Taper/Scribe.pm: enable debugging whenever debug_taper
	  is set

2010-07-12  Orion Poplawski <orion@cora.nwra.com>
	* server-src/amoverview.pl: fix variable references in evals

2010-07-12  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am installcheck/amoverview.pl: basic installcheck
	  for amoverview

2010-07-12  Orion Poplawski <orion@cora.nwra.com>
	* server-src/amoverview.pl: update to use Amanda::DB::Catalog
	* perl/Amanda/DB/Catalog.pm: add dump_timestamp to the unique dump keys
	* installcheck/Amanda_DB_Catalog.pl: update tests to check uniqueness
	* AUTHORS: add Orion

2010-07-12  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c: fix error message

2010-07-12  Dustin J. Mitchell <dustin@zmanda.com>
	* example/amanda.conf.in example/template.d/advanced.conf.in
	  example/template.d/amanda-S3.conf.in: replace label_new_tapes with
	  autolabel

2010-07-12  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Xfer.pl: fix test counts under -without-server

2010-07-10  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/userid.m4: apply the default value for --with-group
	  to the correct variable

2010-07-08  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amcheck.c: small bugfixes
	* perl/Amanda/Taper/Scribe.pm: change get_xfer_dest args to support
	  LEOM configurations
	* server-src/taper.pl: use new args; log warnings with L_WARNING, not
	  L_FAIL
	* installcheck/Amanda_Taper_Scribe.pl installcheck/taper.pl: test
	  changes

2010-07-08  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/xfer-dest-taper-splitter.c: new, non-caching taper dest
	* device-src/xfer-dest-taper-cacher.c: new name for old .._splitter
	* perl/Amanda/Xfer.pod perl/Amanda/XferServer.swg: SWIG new class
	  and renamed class
	* device-src/xfer-dest-taper-directtcp.c
	  device-src/xfer-dest-taper.c: move null cach_inform to parent class
	* device-src/xfer-device.h: prototypes
	* device-src/Makefile.am: new file
	* installcheck/Amanda_Device.pl: LEOM tests
	* installcheck/Amanda_Xfer.pl: tests for new taper dest
	* perl/Amanda/Taper/Scribe.pm: use new name (..::Cacher)

2010-07-08  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/property.c device-src/property.h device-src/device.c: add
	  LEOM property
	* perl/Amanda/Device.pod man/xml-source/amanda-devices.7.xml
	  man/xml-source/amanda.conf.5.xml: document it
	* installcheck/Amanda_Device.pl: test it
	* device-src/dvdrw-device.c device-src/ndmp-device.c
	  device-src/null-device.c device-src/rait-device.c
	  device-src/s3-device.c device-src/tape-device.c: set LEOM property
	  appropriately
	* device-src/vfs-device.c device-src/vfs-device.h: set LEOM support
	  property, and allow it to be changed for testing
	* server-src/taper.pl: small bugfix

2010-07-08  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: add docs, comments for cancel_dump

2010-07-08  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/amglue/constants.swg: new SWIG precompiler magic to allow
	  flexible handling of lists of constants
	* perl/Amanda/Config.pod: add section header
	* perl/Amanda/Config.swg: include all config param constants in the
	  POD

2010-07-07  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Device.pl: erase each S3 volume after the tests
	  are finished with it

2010-07-07  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Taper_Scribe.pl: stringify changer errors

2010-07-07  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: more consistent handling of denial
	  of use of a second tape due to user configuration; dump_cb adds
	  the config_denial_message parameter
	* server-src/taper.pl: use new parameter
	* installcheck/Amanda_Taper_Scribe.pl: updated tests

2010-07-06  Orion Poplawski <orion@cora.nwra.com>
	* server-src/amoverview.pl: fix parsing for newer amadmin find output

2010-07-06  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3.c: fix typo (that I added, not Nandan)

2010-07-06  Nandan Athawale <nandan.athawale@gmail.com>
	* device-src/s3.c: use Amazon's HTTP response headers to calculate a
	  time offset for the local clock, to automatically work around time
	  skew

2010-06-29  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am installcheck/chunker.pl: new check
	* perl/Amanda/Header.swg: bug fix
	* server-src/chunker.c: bug fixes, add support for a fake ENOSPC for
	  testing

2010-06-28  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/driverio.c: fix format specifies

2010-06-28  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Config.swg common-src/conffile.c common-src/conffile.h:
	  add new tapetype params: PART_SIZE, PART_CACHE_TYPE, PART_CACHE_DIR,
	  and PART_CACHE_MAX_SIZE and dumptype param ALLOW_SPLIT; only print
	  deprecation warnings once per process; deprecate TAPE_SPLITSIZE,
	  FALLBACK_SPLITSIZE, and SPLIT_DISKBUFFER
	* example/amanda.conf.in example/template.d/amanda-S3.conf.in
	  example/template.d/amanda-harddisk.conf.in
	  example/template.d/dumptypes: remove old params
	* installcheck/Amanda_Config.pl
	  installcheck/Amanda_Taper_Scribe.pl
	  installcheck/Installcheck/Dumpcache.pm
	  installcheck/taper.pl: update tests
	* man/xml-source/amanda-compatibility.7.xml: document deprecations
	  and what to do about them
	* man/xml-source/amanda.conf.5.xml: document deprecations and new
	  params
	* perl/Amanda/Device.pod: add doc about size=0 for
	  write_from_connection, fix typo
	* perl/Amanda/Taper/Scribe.pm: add get_splitting_args_from_config
	* server-src/diskfile.c server-src/diskfile.h: add dumptype->config
	* server-src/amcheck.c: checks for the new params
	* server-src/driverio.c server-src/taper.pl: add all config params to
	  the driver/taper protocol

2010-06-28  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/xfer-dest-taper-directtcp.c: round part size to a
	  multiple of the block size
	* installcheck/Amanda_Xfer.pl: test it

2010-06-24  Dustin J. Mitchell <dustin@zmanda.com>
	* application-src/ampgsql.pl: use conditionals to skip useless
	  selfcheck checks

2010-06-23  Dustin J. Mitchell <dustin@zmanda.com>
	* application-src/ampgsql.pl: conditionalize some checks on property
	  being set

2010-06-22  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amfetchdump.pl: fix parsing levels and -p

2010-06-22  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amaespipe.sh: change head to dd; thanks to Angelo Hngens
	 and Marco Poli

2010-06-22  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c: Handle write returning 0 for LEOM.

2010-06-21  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am: list libamglue in _SOURCES variables, too,
	  so that dependencies are correct and parallel makes do not
	  fail

2010-06-18  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/IPC/LineProtocol.pm: Fix for multiline.

2010-06-17  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/Makefile.am changer-src/Makefile.am: remove READLINE_LIBS

2010-06-17  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: update tapedev and tpchanger docs
	  to match new changer API

2010-06-17  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/bsd-security.c common-src/bsdtcp-security.c
	  common-src/bsdudp-security.c common-src/local-security.c
	  common-src/security-util.c common-src/ssh-security.c: zero out new
	  structures, and protect logtime messages from NULL dereferences

2010-06-16  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: use chmod a-x instead of chmod -x

2010-06-16  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: remove comment from Makefile rule

2010-06-16  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.pl: Don't call check_data_path for a FILE-WRITE.

2010-06-16  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: add chmod -x for more recent Test::Harness
	  implementations that are confused by executable tests

2010-06-15  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report.pm, perl/Amanda/Report/human.pm: 'FAIL planner'
	  line should result in FAILED dump (not MISSING dump).
	* installcheck/amreport.pl: Test it.

2010-06-14  Dustin J. Mitchell <dustin@zmanda.com>
	* config/automake/installperms.am: add new special cases

	* application-src/Makefile.am client-src/Makefile.am
	  oldrecover-src/Makefile.am recover-src/Makefile.am
	  server-src/Makefile.am: only use installperms for setuid executables

2010-06-12  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Report.pm: POD overhaul

2010-06-12  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/amglue/directtcp.swg: fix unterminated array

2010-06-11  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/net.m4: remove use of AS_HELP_STRING

2010-06-11  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/fileheader-test.c: don't expect partnum=0 on dumpfiles
	* common-src/fileheader.c: don't put partnum=1 on tape headers, etc.

2010-06-11  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/fileheader.c: fix inaccurate partnum in such headers
	* installcheck/Amanda_Recovery_Clerk.pl: add test for recovering with
	  DUMPFILE headers

2010-06-11  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndma_comm_dispatch.c ndmp-src/ndma_cops_query.c: fix
	  NDMOS_OPTION_NO_NDMPvX precompiler conditionals

2010-06-11  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Device.pl: test the connect method

2010-06-11  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndma_comm_dispatch.c: uncomment and update code
	  to support NDMP_MOVER_CONNECT via ndmta.

2010-06-11  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Device.pod perl/Amanda/Device.swg device-src/device.c
	  device-src/device.h: add a device_connect method
	* device-src/ndmp-device.c: implement it
	* ndmp-src/ndmpconnobj.c ndmp-src/ndmpconnobj.h: add
	  ndmp_connection_mover_connect
	* perl/Amanda/Xfer.pod: update documentation using the word
	  "initiator"

2010-06-11  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3-device.c: add S3_STORAGE_CLASS property
	* device-src/s3.c device-src/s3.h: add storage_class
	* installcheck/Amanda_Device.pl: set the property
	* man/xml-source/amanda-devices.7.xml: document it

2010-06-10  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Recovery/Planner.pm: fix matching on filelists - fixes
	  problems with amidxtaped: "Specified file list matches multiple
	  dumps"

2010-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report.pm: Set dump_failed and dump_strange flags.
	* server-src/amreport.pl: Add STRANGE or MISSING to email subject.
	* installcheck/Amanda_Report.pl: Test new flags.

2010-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report.pm: Rename 'tries' to 'dumps', it is a hash of
	  timestamps, each value is an array of try.
	* perl/Amanda/Report/human.pm: Use 'dumps'.
	* perl/Amanda/Report/postscript.pm: Use 'dumps'.
	* perl/Amanda/Report/xml.pm: Use 'dumps'.
	* contrib/amreport.rnc: Add 'dumps'
	* server-src/amreport.pl: Use 'dumps'
	* installcheck/amreport.pl: Check 'dumps'
	* installcheck/Amanda_Report.pl: Check 'dumps'

2010-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm (check_data_path): New method to check
	  the data_path.
	* server-src/driver.c: Check FAILED result after PORT command.
	* server-src/driverio.c: Send data_path in taper PORT-WRITE command.
	* server-src/taper.pl: Parse data_path in PORT-WRITE command, call the
	  scribe check_data_path method.
	* installcheck/taper.pl: Test it.

2010-06-09 Dan Locks <dwlocks@zmanda.com>
	*  packaging/rpm/amanda.spec: remove Provides from main section,
	   remove amanda-client from server provides section.

2010-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_DB_Catalog.pl, installcheck/Amanda_Logfile.pl,
	  installcheck/Amanda_Recovery_Planner.pl,
	  installcheck/Amanda_Taper_Scribe.pl, installcheck/amreport.pl,
	  installcheck/taper.pl, perl/Amanda/Report.pm,
	  perl/Amanda/Report/human.pm, perl/Amanda/Taper/Scribe.pm,
	  server-src/find.c, server-src/taper.pl: taper log a "config|error"
	  keyword in the "ERROR no-tape" line.

2010-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Allow negative etimeout.

2010-06-08  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndmp4_enum_strs.c: add missing enum

2010-06-07  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndml_agent.c: add INADDR_NONE
	* ndmp-src/ndmos_glib.h: remove solaris-specific conditional

2010-06-04  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Device.swg: fix uninitialized variable

2010-06-04  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amfeatures.h: New fe_amindexd_quote_label.
	* common-src/amfeatures.c: fe_amindexd_quote_label.
	* perl/Amanda/Feature.pod: fe_amindexd_quote_label.
	* server-src/amindexd.c: Quote label if fe_amindexd_quote_label.
	* recover-src/amrecover.c: Add debugging statement.
	* recover-src/display_commands.c: Parse quoted label.
	* recover-src/extract_list.c: Parse quoted label.

2010-06-04  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/xfer-element.h common-src/Makefile.am
	  common-src/queueing-test.c common-src/queueing.c
	  common-src/queueing.h: remove queueing support
	* installcheck/Amanda_Device.pl device-src/Makefile.am
	  device-src/device-queueing.c device-src/device-queueing.h
	  device-src/device.c device-src/device.h device-src/property.h: remove
	  queue_fd, device_write_from_fd and device_read_to_fd
	* perl/Amanda/Device.pod perl/Amanda/Device.swg: remove queue_fd,
	  write_from_fd, and read_to_fd; add test utilities to move random data
	  onto and off of devices

2010-06-04  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Xfer.pl perl/Amanda/Xfer.pod
	  perl/Amanda/Xfer.swg perl/Amanda/Recovery/Planner.pm
	  server-src/amfetchdump.pl server-src/amidxtaped.pl
	  server-src/amrestore.pl xfer-src/filter-process.c
	  xfer-src/xfer-element.h: add a log_stderr argument to
	  Amanda::Xfer::Filter::Process
	* server-src/amcheckdump.pl: use the transfer architecture

2010-06-04  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Recovery/Scan.pm: Subsitute "all slots have been loaded"
	  by "label '$label' not found" for old changer scripts.

2010-06-03  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/find.c: zero-pad timestamps out to 14 digits for
	  comparison
	* perl/Amanda/Recovery/Clerk.pm: same

2010-06-03 Dan Locks <dwlocks@zmanda.com>
	*  packaging/deb/buildpkg: remove TMPDIR, use SRCDIR instead.

2010-06-03  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/gnutar.pl: always set LC_CTYPES=C for -t output; detect
	  redhat systems that change the wildcard default for include; and
	  consider 1.15.91 >= 1.16

2010-06-03  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Fix printf format.

2010-06-03  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/ampgsql.8.xml: suggestively document the ampgsql
	  restore process

2010-06-03  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Tapelist.swg (write): Safely write the tapelist file.
	* server-src/amrmtape.pl: Rely on A::Tapelist::write to do it safely.
	* installcheck/amrmtape.pl: Fix.

2010-06-03  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcleanupdisk.c: Use CLR and SET.
	* server-src/planner.c: Use CLR, SET and ISSET.
	  Don't update csize if level < 0.

2010-06-03  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Tapelist.swg: Return empty array if tapelist doesn't
	  exists.

2010-06-02  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Print a debug message every 10 minutes if
	  something is transmitted.
	* common-src/security-util.h (tcp_conn): Add logstamp.

2010-06-02  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Drop root privilege before executing compression
	  or encryption program.

2010-06-02  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/gnutar.pl: fix version regex, and use utf-8 friendly
	  high-ascii characters in -t test

2010-05-31  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/gnutar.pl: gnutar exclude in 1.22.90 is like 1.23.

2010-05-31  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c(print_find_result): Quote label.

2010-05-31  Jean-Louis Martineau <martineau@zmanda.com>
	* config/set_full_version: Add comments.

2010-05-28  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/gnutar.pl: tests for gnutar globbing behavior
	* installcheck/Makefile.am: run them

2010-05-28 Dan Locks <dwlocks@zmanda.com>
	*  packaging/Makefile.am: include common in EXTRA_DIST

2010-05-28 Dan Locks <dwlocks@zmanda.com>

2010-05-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c: Don't report taper line with filenum=0.

2010-05-27  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/taper.pl: test for a new write after EOM without
	  splitting
	* perl/Amanda/Taper/Scribe.pm: handle the case correctly by tracking
	  this condition and switching to a new volume appropriately

2010-05-26  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/libs.m4: Allow user to specify glib config explicitly

2010-05-25  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am: add libamxfer as a dependency of libamglue

2010-05-25  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amtapetype.pl: use force for subsequent runs

2010-05-25  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/amtapetype.pl: close and re-open devices between tests
	* device-src/xfer-dest-device.c: fix memory leak
	* man/xml-source/amtapetype.8.xml: fix -f docs

2010-05-21  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndma_cops_backreco.c: Log 'fetch post backup env failed'
	  with level if NDMP9_ILLEGAL_STATE_ERR.

2010-05-21  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/amtapetype.pl: get the block_size property earlier
	* device-src/device.c: allow property_get after a DEVICE_ERROR

2010-05-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Always report "taperflush criteria not met".

2010-05-20  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Changer.pl: test more configs
	* man/xml-source/amanda.conf.5.xml: point users to
	  amanda-changers(7)
	* perl/Amanda/Changer.pm: support either tpchanger or
	  tapedev in changer defs

2010-05-20  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/progs.m4: always use rpcgen
	* ndmp-src/Makefile.am: always build rpc outputs
	* ndmp-src/ndmp0.h ndmp-src/ndmp0_xdr.c ndmp-src/ndmp2.h
	  ndmp-src/ndmp2_xdr.c ndmp-src/ndmp3.h ndmp-src/ndmp3_xdr.c
	  ndmp-src/ndmp4.h ndmp-src/ndmp4_xdr.c ndmp-src/ndmp9.h
	  ndmp-src/ndmp9_xdr.c: remove from version control (and dist)

2010-05-19  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/fileheader.c: don't print to stderr anymore

2010-05-19  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/Makefile.am: use BUILT_SOURCES to build rpcgen products
	  first, since they are not solaris-compatible

2010-05-19  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: filter "Server not using user level ..."

2010-05-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amtape.pl (inventory): print barcode from unknown state.

2010-05-19  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Application.swg (default_validate): Use sysread.

2010-05-18  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/amtapetype.pl: don't fail when fsf_after_filemark is
	  required

2010-05-18  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/rait.pm: add debug message when child slot
	  counts differ

2010-05-18  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/net.m4: correct help messages

2010-05-18  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: fix typo

2010-05-17  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amfetchdump.pl: use syswrite so the filehandle gets
	  properly flushed

2010-05-17  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/ndmp.pm: add verbose property
	* installcheck/Amanda_Changer_ndmp.pl: use it

2010-05-14  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndmpconnobj.c ndmp-src/ndmpconnobj.h: add window_length and
	  window_offset to mover_get_state
	* device-src/ndmp-device.c: insert corresponding NULLs

2010-05-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheckdump.pl: Check subprocess exit status and print
	  their stderr.

2010-05-13  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amcryptsimple.pl: Exit on error if gpg fail.

2010-05-13  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndml_scsi.c: Increase length of amndmjob -r argument.

2010-05-13  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: fix exclude-file.

2010-05-12  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Device.pl: add regression test
	* device-src/tape-device.c: set self->fd to -1 when closing; add
	  better error messages

2010-05-11 Dan Locks <dwlocks@zmanda.com>
	*  packaging/common/substitute.pl: added.  contains much machinery not
	   yet used in packaging.
	*  packaging/deb/changelog.src: added %%DEB_REL%%,%%DISTRO%% and
	   %%DATE%% macros which are expanded by substitute.pl.
	*  packaging/deb/changelog: renamed to above
	*  packaging/deb/rules: fix stray configure option
	*  packaging/deb/buildpkg: adjust to use substitute.pl instead of
	   figuring VERSION out directly.

2010-05-10  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsd-security.c: Use global buffer for bsd_stream_read_sync

2010-05-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Use global buffer for
	  security_stream_read_sync.
	* recover-src/amrecover.c, recover-src/extract_list.c: Free buffer
	  returnned by security_stream_read_sync.

2010-05-07  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/rait-device.c: fix assertion failure when a child device
	  gives an error
	* perl/Amanda/Changer/rait.pm: add support for braced drive specs
	* perl/Amanda/Changer/robot.pm: bail out if the drive is not allowed
	  for an eject operation
	* man/xml-source/amanda-changers.7.xml: document rait changer drive
	  specifications

2010-05-06  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: New INCLUDE-LIST-GLOB and EXCLUDE-LIST-GLOB
	  for restore, escape the non glob include and exclude.
	* client-src/client_util.h: Add include_list_glob and exclude_list_glob
	  to backup_support_option_t.
	* client-src/client_util.c: Parse new support option.
	* man/xml-source/amgtar.8.xml: Ducument new properties.
	* server-src/amindexd.c: Don't clean_backslash, indexd should be sent
	  asis to amrecover.

2010-05-05  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/rait.pm: eliminate warning when device does not
	  have a valid status

2010-05-05  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3-device.c: fix several fatal flaws in the
	  read_block implementation

2010-05-05  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Report/human.pm: don't assume parts are defined

2010-05-04  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda-devices.7.xml: add more regions
	* man/xml-source/amcheckdump.8.xml: remove duplicate section

2010-05-04  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Free packet on close.

2010-05-03  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/glib-util.c: reorgnize glib_init to be compatible with
	  glib-2.24+

2010-05-03  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amlabel.pl: change the text to be less ambiguous

2010-05-03  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/disk_history.c: Keep all parts.

2010-05-03  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Recovery_Clerk.pl: fix skip counts

2010-05-03  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Recovery_Clerk.pl: test a multi-volume
	  recovery
	* device-src/ndmp-device.c: add extra assertion
	* device-src/xfer-dest-device.c: remove debug print
	* device-src/xfer-device.h device-src/xfer-source-recovery.c
	  installcheck/Amanda_Xfer.pl perl/Amanda/XferServer.swg
	  perl/Amanda/Xfer.pod: add use_device method, fix bugs in cancellation
	* perl/Amanda/Recovery/Clerk.pm: call use_device

2010-04-30  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Changer_robot.pl: fix installchecks
	  to pass after previous change

2010-04-29  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Default state file is in
					$localstatedir/amanda
	* man/xml-source/amanda-changers.7.xml: Document new location.

2010-04-29  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/directtcp-connection.c: Typo.

2010-04-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amreport.pl: Print "FAIL" in email subject header if run
				  failed.
	* installcheck/amreport.pl: Test it.

2010-04-27  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report/human.pm: better per-tape stat labels
	* installcheck/amreport.pl: updated tests

2010-04-27  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Logfile.swg (find_all_logs): Sort the list.

2010-04-27  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/planner.c: change degraded-mode messages to make more
	  sense to the user

2010-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Recovery/Scan.pm: Call _find_volume_no_inventory if new
	  changer have no inventory.

2010-04-26  Paul C. Mantz <pcmantz@zmanda.com>
	* server-src/amreport.pl: print org & config in xml output

2010-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Recovery/Scan.pm: Use default change if message is
					$DEFAULT_CHANGER
	* server-src/amidxtaped.pl: Use DEFAULT_CHANGER if message eq
				    AMRECOVER_CHANGER

2010-04-26  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: give total time from
	  dump start to dump end as total_duration
	* server-src/taper.pl: use total_duration

2010-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Do not promote if no full estimate.

2010-04-26  Paul C. Mantz <pcmantz@zmanda.com>
	* installcheck/Amanda_Report.pl: changed part to partnum

2010-04-23  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheckdump.pl: Check all process status.

2010-04-23  Paul C. Mantz <pcmantz@zmanda.com>
	* server-src/amreport.pl perl/Amanda/Report.pm
 	  perl/Amanda/Report/xml.pm.orig perl/Amanda/Report/human.pm
	  perl/Amanda/Report/postscript.pm perl/Amanda/Report/xml.pm: fixed
 	  location of tape parts in Amanda::Report
	* installcheck/Amanda_Report.pl: installchecks

2010-04-23  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndmagents.h: prototype of exit_on_stdin_eof_thread.
	* ndmp-src/amndmjob_main.c: Create exit_on_stdin_eof_thread thread.
	* ndmp-src/ndma_comm_session.c: exit_on_stdin_eof_thread is not static.

2010-04-23  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndml_nmb.c: Don't log successful halt.
	* server-src/dumper.c: Don't log no-op command.

2010-04-23  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda-devices.7.xml: more detail for
	  STREAMING property

2010-04-23  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/xfer-dest-taper-splitter.c: fix assertion failure
	  reported by Wojciech Giel <wojciech.giel@cimr.cam.ac.uk>

2010-04-23  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Header.pl: add checks for all fields

2010-04-23  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/util.c: add debugging check to interruptible_accept
	* server-src/taper.pl: don't use IO::Socket, as it is badly broken
	  and not thread-safe on Solaris 8
	* xfer-src/element-glue.c: add debugging checks

2010-04-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcleanup.pl: Fix running command with system.

2010-04-22  Jean-Louis Martineau <martineau@zmanda.com>
	* example/Makefile.am: fix 'make clean' to not erase source files.

2010-04-22  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/progs.m4: check for, and reject, Solaris's
	  SGU lex, which is badly broken
	* configure.in: use AMANDA_PROG_LEX

2010-04-22  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda-changers.7.xml: fix typo, thanks to
	  Jean-Francois Malouin

2010-04-22  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report/xml.pm: use bytes as data unit

2010-04-22  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report/xml.pm: tries need to show all programs

2010-04-22  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/ndmp.pm: $conn = undef

2010-04-22  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/match-test.c: lots of new tests
	* common-src/match.c: fix comments, minor bugs in tar_to_regex and
	  match_level
	* common-src/match.h: comments to describe each function
	* man/xml-source/amanda.8.xml: update expression docs

2010-04-21  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amlabel.pl: add warning when the old label is in the
	  tapelist

2010-04-20  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Device.pl: test rait's MAX_VOLUME_USAGE
	* device-src/rait-device.c: fix bugs

2010-04-19  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/compat.pm: Stop scan when the first is slot is
	  seen a second time.

2010-04-16  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Config.swg: move val_t output typemap to a function

2010-04-16  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amadmin.c: show all custom compression/encryption options
	  in amadmin disklist
	* man/xml-source/amanda.conf.5.xml: document undocumented params

2010-04-15  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amcleanup.pl: don't fail when run with no args

2010-04-15  Paul C. Mantz <pcmantz@gmail.com>
	* perl/Amanda/Curinfo/Info.pm: fixed header parsing
	* perl/Amanda/Curinfo.pm: corrected paths and infofile writing
	* installcheck/Amanda_Curinfo.pl: installchecks

2010-04-15  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Recovery_Scan.pl: don't use a system-global path

2010-04-15  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/xfer-dest-device.c: don't use queueing anymore; this
	  removes the max_memory constructor argument
	* perl/Amanda/XferServer.swg device-src/xfer-device.h: prototype
	  change
	* perl/Amanda/Xfer.pod: docs
	* device-src/amtapetype.pl installcheck/Amanda_Device.pl
	  installcheck/Amanda_Recovery_Clerk.pl installcheck/Amanda_Xfer.pl
	  installcheck/amrestore.pl server-src/amvault.pl: change constructor
	  invocation

2010-04-15  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/util.c common-src/util.h: new interruptible_accept that
	  uses a prolong function to stop waiting
	* common-src/stream.c: use interruptible_accept in stream_accept
	* xfer-src/element-glue.c: use interruptible_accept to allow
	  directtcp_accept to be cancelled
	* installcheck/Amanda_Xfer.pl: test xfer cancellation

2010-04-14  Jean-Louis Martineau <martineau@zmanda.com>
	    Satya Ganga <gsat@zmanda.com>
	* application-src/amsamba.pl: Fix use of include/exclude list.

2010-04-14  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Taper_Scribe.pl perl/Amanda/Taper/Scribe.pm
	  server-src/taper.pl: rename dump_timestamp -> write_timestamp

2010-04-14  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndml_nmb.c: Always log NOTIFY_MOVER_HALTED.

2010-04-13  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c common-src/conffile.h: make file-pad and
	  tapebufs parameters errors
	* perl/Amanda/Config.swg: remove parameters
	* server-src/taper.pl: don't check tapebufs
	* installcheck/Amanda_Config.pl: adjust testing
	* man/xml-source/amanda-compatibility.7.xml: add deprecation
	  note about amrecover_do_fsf and amrecover_check_label

2010-04-13  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/xfer-dest-taper-splitter.c
	  device-src/xfer-dest-taper-directtcp.c: make sure duration is positive

2010-04-13  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c: fix derived value for autolabel

2010-04-13  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda-applications.7.xml: info about properties
	* man/xml-source/amanda-devices.7.xml: info about properties
	* man/xml-source/amanda-scripts.7.xml: info about properties
	* man/xml-source/amzfs-snapshot.8.xml: fix typo

2010-04-13  Dustin J. Mitchell <dustin@zmanda.com>
	* NEWS: add info about deprecations in 2.6.1
	* man/xml-source/amanda-compatibility.7.xml: update manpage to
	  reflect info in NEWS

2010-04-13  Paul C. Mantz <pcmantz@zmanda.com>
	* server-src/amreport.pl: load holding disk before making report
	* perl/Amanda/Report/human.pm: report holding disk correctly
	* installcheck/amreport.pl: installcheck

2010-04-13  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndml_conn.c, ndmp-src/ndml_nmb.c:
	  Always log NOTIFY_DATA_HALTED.

2010-04-12  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c: deprecate amrecover_do_fsf and
	  amrecover_check_label
	* example/amanda.conf.in example/template.d/advanced.conf.in: remove
	* man/xml-source/amanda.conf.5.xml: indicate deprecation
	* NEWS: mention deprecation

2010-04-12  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/human.pm: typo.

2010-04-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.pl: Check hdr_buf, cancel_dump on error.
	* perl/Amanda/Taper/Scribe.pm (cancel_dump): New method.
	* perl/Amanda/Report/human.pm: Print taper error message.
	* server-src/find.c: Set current_label to "".

2010-04-08  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Logfile.swg: added find_all_logs and find_latest log
	  which search the logdir instead of the tapelist
	* perl/Amanda/Logfile.pod: documentation
	* server-src/amreport.pl: use find_latest_log insted of find_log

2010-04-08  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/MainLoop.swg: introduce define_steps and step, to
	  eliminate reference loops created by use of %subs
	* perl/Amanda/MainLoop.pod: document it
	* installcheck/Amanda_Changer.pl installcheck/Amanda_Changer_compat.pl
	  installcheck/Amanda_Changer_disk.pl
	  installcheck/Amanda_Changer_multi.pl
	  installcheck/Amanda_Changer_ndmp.pl
	  installcheck/Amanda_Changer_rait.pl
	  installcheck/Amanda_Changer_robot.pl
	  installcheck/Amanda_ClientService.pl installcheck/Amanda_Device.pl
	  installcheck/Amanda_MainLoop.pl installcheck/Amanda_Recovery_Clerk.pl
	  installcheck/Amanda_Recovery_Scan.pl
	  installcheck/Amanda_Taper_Scribe.pl installcheck/Amanda_Xfer.pl
	  installcheck/amfetchdump.pl installcheck/amidxtaped.pl
	  installcheck/amlabel.pl perl/Amanda/Changer.pm
	  perl/Amanda/Changer/compat.pm perl/Amanda/Changer/multi.pm
	  perl/Amanda/Changer/ndmp.pm perl/Amanda/Changer/robot.pm
	  perl/Amanda/Interactive/stdin.pm perl/Amanda/Recovery/Clerk.pm
	  perl/Amanda/Recovery/Scan.pm perl/Amanda/Taper/Scan/traditional.pm
	  server-src/amcheck-device.pl server-src/amfetchdump.pl
	  server-src/amidxtaped.pl server-src/amlabel.pl server-src/amrestore.pl
	  server-src/amtape.pl server-src/amvault.pl server-src/taper.pl: use it

2010-04-08  Jean-Louis Martineau <martineau@zmanda.com>
	* config/automake/scripts.am: comment double quote 'use lib'.

2010-04-08  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: Use tarmode.

2010-04-08  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/amrecover.c: Print to debug what is sent to amindexd.
	* recover-src/uparse.y: Parse setdate correctly.

2010-04-08  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndma_comm_dispatch.c:
	  Comment "Second add_dir entry is non-conforming".

2010-04-08  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/planner.c: fix two bugs that caused planner to generate a
	  bogus schedule; remove a redundant assignment

2010-04-07 Dan Locks <dwlocks@zmanda.com>
	*  packaging/rpm/amanda.spec: specify mandir explicitly to work around
	   old autoconf

2010-04-07  Paul C. Mantz <pcmantz@zmanda.com>
	* server-src/amreport.pl perl/Amanda/Report.pm
	perl/Amanda/Report/human.pm perl/Amanda/Report/postscript.pm
	perl/Amanda/Report/xml.pm installcheck/amreport.pl
	installcheck/Amanda_Report.pl: taped segments called parts, not chunks


2010-04-07  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Improve strategy "skip" man.

2010-04-07  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/userid.m4: CHECK_USERID conditional
	* config/automake/scripts.am: add SCRIPTS_EXTRA_DIST
	* installcheck/Makefile.am: use it

2010-04-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Don't exit on match_disklist error.
	* server-src/diskfile.c (match_disklist): Generate better message for
	  strategy "skip" or ignore dle.

2010-04-06  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Set restore_dir to NULL.

2010-04-06  Paul C. Mantz <pcmantz@zmanda.com>
	* ndmp-src/ndmpconnobj.c: send NDMP4_LOG_* messages to debug log
	* ndmp-src/ndma_tape.c ndmp-src/ndma_tape_simulator.c: added
	  NDMP4_LOG_* messages for testing

2010-04-05  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Fix USE-DATA-PATH offset and directory
	  property.

2010-04-05  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/disk.pm: reply with 'invalid' on invalid slots
	* perl/Amanda/Taper/Scan/traditional.pm: skip invalid slots when
	  loading slot 'current'
	* installcheck/Amanda_Taper_Scan_traditional.pl: test it

2010-04-05  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amidxtaped.pl: send changer error with MESSAGE
	* installcheck/amidxtaped.pl: test for it

2010-04-05  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/version.m4: be resilient to all but the first
	  digit of the version number missing

2010-04-05  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm perl/Amanda/Changer/robot.pm: clean up
	  reference loop in %subs (interim solution -- this arrangement
	  leaks everywhere)

2010-04-05  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/ndmp.pm: close the NDMP connection after
	  every Interface operation, so that objects are not unreffed
	  during Perl's global cleanup.

2010-04-05  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Taper/Scan.pm: POD fixes, add user_msg_fn key
	* perl/Amanda/Taper/Scan/traditional.pm: call user_msg_fn on
	  search failure; check for failure before printing "slot N"
	  prefix
	* server-src/amcheck-device.pl: implement new user_msg_fn key
	  to print expected volume on failure

2010-04-05  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Device.pod: document that finish() can be called even
	  if start() was not, to release resources
	* device-src/ndmp-device.c: implement
	* device-src/tape-device.c: implement
	* perl/Amanda/Changer.pm: always finish() a device in $res->release()

2010-04-05  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/run-ndmp.pl: development util to run ndmjob test daemon
	* installcheck/Makefile.am: add util

2010-04-05  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/infofile.c: use %lld in scanning instead of %jd,
	  since Solaris 8 doesn't have %j support; also fix handling
	  of parse errors

2010-04-05  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/ndmp-device.c: treat NDMP9_DEVICE_BUSY_ERR as
	  DEVICE_STATUS_DEVICE_BUSY

2010-04-05  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm: check $err->failed before returning reason

2010-04-02  Paul C. Mantz <pcmantz@zmanda.com>
	* server-src/amreport.pl: honor SEND_AMREPORT_ON in script mode
	* perl/Amanda/Config.swg: swig CNF_SEND_AMREPORT_ON
	* installcheck/amreport.pl: installchecks

2010-04-02  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Util.pod: correct inaccurate claims in burp

2010-04-02  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Application.swg: fix situation where sizeof(IV) >
	  sizeof(gint)

2010-04-02  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: '$size{$hostpart} = 0' in taper cmd.

2010-04-01  Paul C. Mantz <pcmantz@gmail.com>
	* server-src/amreport.pl: accepts and ignores disk args in script mode
	* installcheck/amreport.pl: checks

2010-04-01  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/userid.m4: AM_CONDITIONAL(WANT_CHECK_USERID
	* installcheck/Makefile.am: Do not check amrecover if WANT_CHECK_USERID.
	* installcheck/amrecover.pl: Check 'localhost' hostname,
	                             remove '^' from expect regex
	* recover-src/uscan.l: Add [[:space:]]* in LINEFEED.

2010-04-01  Dustin J. Mitchell <dustin@zmanda.com>
	* application-src/ampgsql.pl: check permissions on archive dir, and
	  fail selfcheck if they are not sufficient.  Also implement the
	  wal-max-wait=0 that's already documented
	* man/xml-source/ampgsql.8.xml: document required permissions

2010-03-31  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amrecover.pl: fix diag()

2010-03-31  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: use Carp qw( confess cluck );
	* perl/Amanda/Changer/robot.pm: $self->make_error("failed",...

2010-03-31  Jean-Louis Martineau <martineau@zmanda.com>
	* config/set_full_version: fix.
	* config/amanda/config.m4: fix.

2010-03-31  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/config.m4: Use -a.

2010-03-31  Jean-Louis Martineau <martineau@zmanda.com>
	* config/set_full_version: Use -a.

2010-03-31  Jean-Louis Martineau <martineau@zmanda.com>
	* config/set_full_version: Use grep.

2010-03-31  Jean-Louis Martineau <martineau@zmanda.com>
	* config/Makefile.am: Add set_full_version to EXTRA_DIST.
	* config/set_full_version: Add the file.

2010-03-31  Jean-Louis Martineau <martineau@zmanda.com>
	* config/set_full_version: New script to update FULL_VERSION from
				   VERSION, svn and git
	* autogen: Execute config/set_full_version
	* Makefile.am: Add dependencies to execute set_full_version if VERSION
	  change, and to re-run configure if FULL_VERSION change.
	* config/amanda/version.m4: Use FULL_VERSION.
	* packaging/deb/buildpkg: Use FULL_VERSION.
	* packaging/rpm/amanda.spec: Use FULL_VERSION.
	* packaging/rpm/buildpkg: Use FULL_VERSION.

2010-03-30  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Run.pm: be selective in import from POSIX
	* server-src/amvault.pl: fix duplicate variable

2010-03-30  Dustin J. Mitchell <dustin@zmanda.com>
	* Makefile.am: add VERSION to EXTRA_DIST
	* config/amanda/version.m4: use $srcdir/VERSION

2010-03-30  Jean-Louis Martineau <martineau@zmanda.com>
	* VERSION: 3.2.0alpha.
	* configure.in: Call AMANDA_VERSION.
	* config/amanda/version.m4: Add AMANDA_VERSION.
	* config/amanda/config.m4: Add AMANDA_GET_GIT_INFO.

2010-03-30  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Retry direct to tape all aborted dump because
			       of missing holdingdisk space.

2010-03-29  Paul C. Mantz <pcmantz@zmanda.com>
	* server-src/amcleanup.pl server-src/amflush.c: updated amreport usage

2010-03-28  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amvault.pl: update with Changer and Catalog API changes

2010-03-26  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: don't run amrecover test under
	  --without-restore

2010-03-26  Dustin J. Mitchell <dustin@zmanda.com>
	* application-src/ampgsql.pl: don't die when gnutar issues non-fatal
	  errors, e.g., "file changed as we read it"

2010-03-26  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amrecover.pl: fix stupid error in installcheck

2010-03-26  Dustin J. Mitchell <dustin@zmanda.com>
	* application-src/ampgsql.pl: change 'confess' to 'die' and add a hack
	  to force WAL file archives on ancient postgres versions
	* installcheck/ampgsql.pl: don't skip tests on ancient versions

2010-03-26  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/Makefile.am common-src/match-test.c: test (some) match
	  functions
	* common-src/match.c: add make_exact_disk_expression and
	  make_exact_host_expression
	* installcheck/Installcheck/Dumpcache.pm: add amrecover_changer
	* installcheck/Makefile.am installcheck/amrecover.pl: new integration
	  tests
	* oldrecover-src/extract_list.c recover-src/extract_list.c: use the
	  make_exact_.. functions
	* common-src/amanda.h common-src/match.h application-src/amgtar.c
	  application-src/amstar.c client-src/calcsize.c client-src/sendbackup.c
	  client-src/sendsize.c common-src/amxml.c common-src/fileheader.c
	  common-src/local-security.c common-src/util.c
	  oldrecover-src/set_commands.c recover-src/set_commands.c
	  server-src/amflush.c server-src/cmdline.c server-src/diskfile.c
	  server-src/find.c server-src/tapefile.c: move match.c prototypes from
	  amanda.h to match.h

2010-03-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Don't exit with non-zero if '-l' and amdump
				or amflush is running.

2010-03-25  Paul C. Mantz <pcmantz@zmanda.com>
	* server-src/amreport.pl: amreport exits w/o error if mailer fails
	* installchecks/amreport.pl: installcheck

2010-03-25  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/compat.pm: err on the side of caution when
	  emulating except_slots in chg-compat, preventing an infinite
	  loop

2010-03-23  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: check open failure correctly,
				      improve debugging message.

2010-03-23  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS, ReleaseNotes: Change for 3.1.0

2010-03-23  Dustin J. Mitchell <dustin@zmanda.com>
	* application-src/ampgsql.pl: handle empty incrementals, wait for WAL
	  files to be archived during full backup, don't backup postmaster.pid
	  or pg_xlog
	* man/xml-source/ampgsql.8.xml: new property, fix typos, add a section
	  describing the operation
	* installcheck/ampgsql.pl: test restores more carefully, including
	  an empty incremental

2010-03-22  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amfeatures.c common-src/amfeatures.h
	  perl/Amanda/Feature.pod: add a new feature to indicate that
	  amrecover quotes disks right: fe_amrecover_correct_disk_quoting
	* common-src/match.c common-src/amanda.h: add an 'anchor' arg to
	  clean_regex
	* oldrecover-src/extract_list.c oldrecover-src/set_commands.c
	  recover-src/extract_list.c recover-src/set_commands.c
	  server-src/diskfile.c: use it
	* server-src/amidxtaped.pl: ignore DISK if it's not quoted correctly
	* installcheck/amidxtaped.pl: test that

2010-03-19  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amxml.c: data_path default ot DATA_PATH_AMANDA.

2010-03-19  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/amrecover.c: Do add_config_override before loading the
				   config.

2010-03-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Continue flush on new tape if holdingdisk is
			       full.

2010-03-18  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report.pm: updated POD

2010-03-18  Dustin J. Mitchell <dustin@zmanda.com>
	* application-src/ampgsql.pl: add a die_cb in command_validate and
	  command_selfcheck

2010-03-17  Paul C. Mantz <pcmantz@zmanda.com>
	* server-src/amreport.pl: added new command line options
	* server-src/amdump.sh: updated usage of amreport
	* installchecks/amreport.pl: installchecks
	* man/xml-source/amreport.8.xml: usage doc update
	* NEWS: added info about rewrite

2010-03-17  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report/human.pm: fixed premature disk truncation in
         dump summary

2010-03-16  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Tests.swg: add a simple threaded function
	* perl/Makefile.am: and invoke it from 'make check'

2010-03-16  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amcryptsimple.8.xml: Fix formatting

2010-03-16  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/ampgsql.8.xml: Fix formatting.

2010-03-16  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/debug.c: Set open_time in debug_setup_1.

2010-03-15  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amsamba.8.xml: document include/exclude expressions

2010-03-15  Dustin J. Mitchell <dustin@zmanda.com>
	* UPGRADING: add note about accidentally linking new versions against old

2010-03-15  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Util.pod: added POD for slurp and burp

2010-03-15  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amreport.pl: add tests for exit status for planner
	  failure

2010-03-15  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: remove input_errors, as that's now the
	  caller's responsibility
	* installcheck/Amanda_Taper_Scribe.pl: corresponding changes
	* server-src/taper.pl: handle input errors directly

2010-03-15  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tape-aix.c device-src/tape-ops.h device-src/tape-posix.c
	  device-src/tape-uware.c device-src/tape-xenix.c: add tape_fileno
	  function
	* installcheck/Amanda_Device.pl: add lots of tape-positioning
	  installcehcks
	* device-src/tape-device.c: fix positioning (adjust for funny bsf
	  behavior only in tape_device_seek_file)

2010-03-15  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c: rename the default tapetype, since EXABYTE
	  sounds like it might actually be useful, but it's only 2M
	* man/xml-source/amanda.conf.5.xml: remove default
	* server-src/amcheck.c: only check whether fallback_splitsize < tape
	  length if splitting is enabled; check for a missing tapetype param

2010-03-14 Dan Locks <dwlocks@zmanda.com>
	*  configure.in: update to rc06.  NOTEST

2010-03-11 Dan Locks <dwlocks@zmanda.com>
	*  configure.in: update to rc05.

2010-03-11  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report.pm: fixed order that messages are reported

2010-03-10  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/null.pm: note that constructor will not fail
	* server-src/amidxtaped.pl: use chg-null if the changer constructor
	  fails

2010-03-10  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Report.pm: count DLEs on the first tape
	* perl/Amanda/Report/postscript.pm: display total part count
	* installcheck/amreport.pl: changed output

2010-03-10  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/progs.m4: add a define if LPR is found
	* server-src/amcheck.c: check it

2010-03-09  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report.pm: fixed caching of hostnames and dles

2010-03-09  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda-applications.7.xml: add brief example of
	  setting properties for an application

2010-03-09  Paul C. Mantz
	* perl/Amanda/Report.pm: L_PARTPARTIAL handles the same as L_PART

2010-03-08 Dan Locks <dwlocks@zmanda.com>
	*  packaging/deb/rules: add chmod lines for etc/amanda
	*  packaging/rpm/amanda.spec: move ${SYSCONFDIR}/amanda to 750
	   section, specify directories in 750 section to also be 750.

2010-03-08  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report.pm: record DLEs in seen order in the cache
	* installcheck/Amanda_Report.pm: installcheck fixes

2010-03-08 Dan Locks <dwlocks@zmanda.com>
	*  packaging/rpm/amanda.spec, packaging/deb/changelog: change version
	   number to %%VERSION%%
	*  packaging/rpm/buildpkg, packaging/deb/buildpkg: pull correct
	   version from configure.in, substitute version in appropriate files
	*  packaging/README: correct list of packages, add note on debian
	   package creation.

2010-03-07  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/ClientService.pm: process error from fork
	  correctly

2010-03-07  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Dumpcache.pm: don't automatically generate
	  cached dumps - it causes more problems than it solves

2010-03-07  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Report/postscript.pm perl/Amanda/Report/human.pm: use %f
	  instead of %lf

2010-03-07  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amfetchdump.pl: fix usage message
	* man/xml-source/amanda.conf.5.xml common-src/conffile.c: remove
	   default for mailto, as it is ignored
	* installcheck/Amanda_Report.pl installcheck/amreport.pl
	  perl/Amanda/Report.pm perl/Amanda/Report/human.pm
	  perl/Amanda/Report/postscript.pm perl/Amanda/Report/xml.pm
	  server-src/amreport.pl: misc cleanup; replace orig-kb with orig_kb,
	  add --help and --version, remove unused functions
	* installcheck/mock/lpr.pl: use 'lpr' instead of 'printer'

2010-03-07  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amreport.pl perl/Amanda/Report/postscript.pm: sort
	  postscript output by filenum, not hostname/diskname

2010-03-07  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amreport.pl perl/Amanda/Report/human.pm
	  perl/Amanda/Report/postscript.pm: stop counting an extra filemark per
	  dumpfile when calculating tape used

2010-03-07  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amreport.pl perl/Amanda/Report/postscript.pm: always
	  print the on-medi size of a dumpfile, not its total size

2010-03-07  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amreport.pl perl/Amanda/Report/human.pm
	  perl/Amanda/Report/postscript.pm: remove rounding when orig and
	  outsize are within 32k

2010-03-06  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amreport.pl: don't use undef for stdout, stderr when
	  invoking mail or lpr - some don't like to have their std streams
	  closed

2010-03-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amreport.pl: fix use of relative path for -l argument.

2010-03-06  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/human.pm: Report orig_size for FLUSH line.
	* installcheck/amreport.pl: check it.

2010-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/amndmjob_main.c, ndmp-src/ndmjob_main.c:
	  include conffile.h, not config.h.

2010-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/version.m4: Allow 2 digits version.

2010-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/deb/changelog, packaging/deb/rules,
	  packaging/deb/buildpkg, packaging/rpm/buildpkg,
	  packaging/rpm/amanda.spec,
	  configure.in: Change version to 3.2alpha.

2010-03-05  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in config/amanda/progs.m4: AC_SUBST LPR-related
	  variables, and don't define them
	* perl/Amanda/Constants.pm.in: add LPR-related constants
	* installcheck/amreport.pl: lots of new tests, all hand-verified to
	  pass for the C amreport as well, sometimes with minor differences
	* installcheck/mock/lpr.pl: mock 'lpr' for installchecks
	* installcheck/mock/mail.pl: mock 'mail' for installchecks
	* installcheck/Makefile.am: new mocks
	* perl/Makefile.am perl/Amanda/Report/postscript.pm: postscript output
	  support for amreport
	* server-src/Makefile.am server-src/amreport.pl
	  server-src/amreport_new.pl server-src/reporter.c:
	  make the perl amreport "live"

2010-03-05  Dustin J. Mitchell <dustin@zmanda.com>,
	    Jean-Louis Martineau <martineau@zmanda.com>,
	    Paul C. mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report.pm perl/Amanda/Report/human.pm
	  server-src/amreport_new.pl installcheck/Amanda_Report.pl: major
	  overhaul to perl reporting framework (collaborative effort of three
	  developers)

2010-03-02  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/human.pm: Remove leading 0 on day date.
	* server-src/amreport_new.pl: Remove leading 0 on day date.

2010-03-02  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report.pm: Set $self->{hostname}.
	* perl/Amanda/Report/human.pm: Use $report->{hostname}.

2010-03-03  Paul C. mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report/human.pm: tape num. blocks print as 0 if undefined

2010-03-02  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report.pm; added three-arg form of get_program_info()
	* perl/Amanda/Report/human.pm: usage of three-arg form
	* installcheck/Amanda_Report.pl: tests

2010-03-02  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/human.pm: Remove coma.

2010-03-02  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Correctly set autolabel from command line
				 '-olabel_new_tapes=' options.

2010-03-02  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amidxtaped.pl: Exit if receive ABORT message.
	* recover-src/extract_list.c: Send abort message on user request.
	* common-src/amfeatures.c: Add fe_amidxtaped_abort.
	* common-src/amfeatures.h: Add fe_amidxtaped_abort.
	* perl/Amanda/Feature.pod: Add fe_amidxtaped_abort.

2010-03-02  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Wait up to 5 seconds for children termination.

2010-03-02  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amflush.c: Delay creation of log file.

2010-03-02  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Correctly set autolabel from label_new_tapes.

2010-03-02  Paul C. Mantz <pcmantz@zmanda.com>
	* server-src/amreport_new.pl perl/Amanda/Report/human.pm : fixed
	  tapelist loading

2010-03-02  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report.pm: added tape_labels field for preserving tape
	  order
	* perl/Amanda/Report/human.pm: use of tape_labels
	* installcheck/Amanda_report.pl: installcheck, cleanup

2010-03-01  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Set and check repdata.

2010-03-01  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amcheck.c: adjust split-size warnings for more
	  detail with less overall verbosity

2010-03-01  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Print FLUSH for failed flush.

2010-03-01  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/fileheader.c: fix typos
	* server-src/amfetchdump.pl: add support for decryption
	* server-src/amidxtaped.pl: same
	* server-src/amrestore.pl: same

2010-03-01  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm perl/Amanda/Feature.pod
	  perl/Amanda/MainLoop.pod perl/Amanda/Recovery/Clerk.pm
	  perl/Amanda/Report.pm perl/Amanda/Taper/Scan.pm
	  perl/Amanda/Util.pod: fix bad POD formatting
	* perl/make_html.pl: fix perl warnings

2010-03-01  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: add more detail about
	  include/exclude
	* man/xml-source/amgtar.8.xml: and specific documentation of the
	  patterns for amgtar

2010-03-01  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Feature.pod: document known features

2010-03-01  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Xfer.pod: no need to remove sources
	* perl/Amanda/Xfer.swg: remove reference loop, call correct callback

2010-03-01  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/Makefile.am changer-src/chg-glue.pl: remove chg-glue
	* man/xml-source/amanda-changers.7.xml: no longer "in transition"
	* server-src/Makefile.am server-src/changer.c server-src/changer.h:
	  remove changer.[ch]
	* server-src/amcheck.c: remove unused include

2010-03-01  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c: remove debug message

2010-03-01 Dan Locks <dwlocks@zmanda.com>
	*  packaging/rpm/amanda.spec: remove Provides: librestore

2010-03-01  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c, application-src/amstar.c:
	  new COMMAND-OPTIONS property.
	* man/xml-source/amgtar.8.xml, man/xml-source/amstar.8.xml:
	  document new COMMAND-OPTIONS property.

2010-02-28  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: Add dependendcy to build Amanda::Feature.pm if
			    common-src/amfeatures.h is modified.

2010-02-27  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/amndmjob_main.c: #include "config.h"
	* ndmp-src/ndma_cops_backreco.c: #include "util.h"
	* ndmp-src/ndmjob_main.c: #include "config.h"

2010-02-26  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/amidxtaped.pl: Fix for datapath eq "none".

2010-02-26  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/ps.m4: Set PS_ARGUMENT_ARGS.
	* perl/Amanda/Constants.pm.in: export PS_ARGUMENT_ARGS.
	* perl/Amanda/Process.pm (set_master_process): New function.
	* server-src/amcleanup.pl: Use set_master_process.

2010-02-26  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: AVAIL-DATAPATH, USE-DATAPATH and
				      DATAPATH-OK.
	* server-src/amidxtaped.pl: AVAIL-DATAPATH, USE-DATAPATH and
				    DATAPATH-OK.
	* installcheck/amidxtaped.pl: Test them.

2010-02-26  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/ClientService.pm: fix to wait for streams
	  to empty and hit EOF after exit
	* installcheck/amidxtaped.pl: reorder bad_cmd test, remove bogus
	  comment, and use -1 to signal no data EOF received

2010-02-26  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report/human.pm: added quoting of disks in per-disk
	  summary

2010-02-26  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Changer_robot.pl: log test output too
	* installcheck/Installcheck.pm: typo
	* perl/Amanda/Changer.pm: note about member variables
	* perl/Amanda/Changer/robot.pm: make debug callable during constructor

2010-02-26  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c: Compute dump_status and message.
	* server-src/find.c (print_find_result): Output dump_status and message.
	* server-src/find.c (search_logfile): Check if label is in tapelist.
	* server-src/find.h: Add dump_status and message to find_result_t.
	* perl/Amanda/Logfile.swg: Swig it.
	* perl/Amanda/DB/Catalog.pm: Set dump_status and message.
	* installcheck/Amanda_DB_Catalog.pl: Test it.
	* installcheck/Amanda_Logfile.pl: Test it.
	* server-src/amcheckdump.pl: Use new search_logfile behaviour.
	* server-src/amindexd.c: Use dump_status.
	* server-src/amoverview.pl: Use new 'amadmin find' output.
	* server-src/disk_history.c: Remove code no longer needed.
	* server-src/tapefile.c (lookup_tapelabel): const the label argument.
	* server-src/tapefile.h (lookup_tapelabel): const the label argument.

2010-02-26  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (set_config_overrides): new config override api.
	* common-src/conffile.h (set_config_overrides): New prototype.
	* perl/Amanda/Config.swg (set_config_overrides): Swigged.
	* changer-src/chg-glue.pl, common-src/amgetconf.pl,
	* common-src/file.c, device-src/amdevcheck.pl,
	* device-src/amtapetype.pl, installcheck/Amanda_Config.pl,
	* installcheck/Amanda_Tapelist.pl, installcheck/Installcheck/Config.pm,
	* installcheck/amgetconf.pl, recover-src/amrecover.c,
	* server-src/amadmin.c, server-src/amcheck-device.pl,
	* server-src/amcheck.c, server-src/amcheckdump.pl,
	* server-src/amcleanup.pl, server-src/amfetchdump.pl,
	* server-src/amflush.c, server-src/amlabel.pl,
	* server-src/amlogroll.c, server-src/amreport_new.pl,
	* server-src/amrestore.pl, server-src/amrmtape.pl,
	* server-src/amservice.c, server-src/amtape.pl,
	* server-src/amtrmidx.c, server-src/amtrmlog.c,
	* server-src/amvault.pl, server-src/chunker.c,
	* server-src/driver.c, server-src/dumper.c,
	* server-src/planner.c, server-src/reporter.c,
	* server-src/taper.pl: Use new config override api.

2010-02-25  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amcheck.c: add warning if the config might generate >1000
	  parts on a volume

2010-02-25  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/robot.pm: don't use a base-class attribute name,
	  and use an appropriate prefix for debug messages

2010-02-25  Dustin J. Mitchell <dustin@zmanda.com>
	* Makefile.am: remove restore-src from lint rule
	* configure.in: remove restore-src/Makefile
	* restore-src/: remove
	* perl/Makefile.am server-src/Makefile.am: remove -Irestore-src

2010-02-25  Dustin J. Mitchell <dustin@zmanda.com>
	* Makefile.am: stop building restore-src
	* common-src/amfeatures.c: remove no-longer-supported
	  fe_amidxtaped_nargs (this hasn't been supported since 2.5.0!)
	* perl/Amanda/Util.swg perl/Amanda/Util.pod: tapespec marhsalling edge case
	* installcheck/Amanda_Util.pl: tests
	* server-src/amidxtaped.pl server-src/Makefile.am: new perl amidxtaped

2010-02-25  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Dumpcache.pm: include more compressible
	  data and clean up afterward
	* installcheck/Installcheck/ClientService.pm: handle 0 bytes of data
	  better, and fix handling of failures to not loop forever
	* installcheck/amidxtaped.pl: test that compressed dumps come back at
	  their orig_size; check for a holding device without a trailing ":0";
	  send DATA-PATH AMANDA DIRECT-TCP; check LABEL containing only a label,
	  and even missing FSF=; check failure on unrecognized command lines

2010-02-24  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amidxtaped.pl: installcheck improvements:
	  create a "real" holding file; send a DATESTAMP= command

2010-02-24  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Recovery/Planner.pm: add support for predefined plans
	* installcheck/Amanda_Recovery_Planner.pl: test

2010-02-24  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Xfer.swg: fix != override
	* installcheck/Amanda_Xfer.pl: test
	* perl/Amanda/Changer/robot.pm: don't use bogus 'device' failure type
	* perl/Amanda/MainLoop.pod: POD tweaks
	* perl/Amanda/Recovery/Clerk.pm installcheck/Amanda_Recovery_Clerk.pl
	  server-src/amfetchdump.pl: add directtcp_supported arg to
	  xfer_src_cb; finish device when quitting clerk
	* perl/Amanda/Recovery/Scan.pm: add error handling
	* perl/Amanda/Header.swg perl/Amanda/Header.pod: add orig_size
	* recover-src/extract_list.c: fix header debugging

2010-02-24  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amanda.h installcheck/Installcheck/ClientService.pm
	  perl/Amanda/Constants.pm.in: move stream constants to
	  Amanda::Constants
	* perl/Makefile.am perl/Amanda/ClientService.pm: new package
	* installcheck/Makefile.am installcheck/Amanda_ClientService.pl: tests

2010-02-24  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Util.pod perl/Amanda/Util.swg: stream support and
	  tapespec marhsalling support
	* installcheck/Amanda_Util.pl: tests (for tapespec anyway)

2010-02-23  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report/human.pm: fixed hostname truncation

2010-02-19  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Recovery_Clerk.pl: use an unbuffered write to
	  make fake holding files; don't try to load a dumpcache unless both
	  server and client components are present
	* installcheck/Amanda_Xfer.pl: count tests right in skip

2010-02-19  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report/human.pm: percents not displayed at 100%, print
	  the end of a string in per-dump summary

2010-02-19  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/xfer-element.c xfer-src/xfer-element.h: setup now returns a
	  boolean
	* xfer-src/xfer.c: if any setup operation fails, skip the starts and
	  return
	* device-src/xfer-dest-taper-directtcp.c
	  device-src/xfer-source-recovery.c xfer-src/dest-directtcp-connect.c
	  xfer-src/element-glue.c xfer-src/source-directtcp-connect.c
	  xfer-src/xfer-test.c: change setup() methods to return a boolean
	* device-src/ndmp-device.c: clean up listen_addrs if not null

2010-02-19  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/file.c (mkpdir): Fix.

2010-02-19  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/file.c (mkpdir): Don't use access.

2010-02-18  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report/human.pm: fixed columnspec handling, removed POD

2010-02-18  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/xfer-source-recovery.c: add XFER_MECH_DIRECTTCP_CONNECT,
	  with attendant API changes (constructor takes a device; sends
	  XMSG_READY)
	* device-src/xfer-device.h: prototype changes
	* xfer-src/element-glue.c: remove debug message
	* perl/Amanda/Xfer.pod: docs
	* perl/Amanda/XferServer.swg: SWIG new parameters
	* perl/Amanda/Recovery/Clerk.pm: use new API
	* installcheck/Amanda_Xfer.pl: test
	* installcheck/Amanda_Recovery_Clerk.pl: test some more
	* installcheck/Installcheck/Dumpcache.pm: add code to determine
	  the timestamps for a cached dump after loading it

2010-02-18  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/xfer.c xfer-src/xfer-element.c xfer-src/xfer-element.h:
	  add a get_xfer_mechs method to xfer elements so that elements can
	  dynamically specify their mech pairs

2010-02-18  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/ndmp-device.c: check for fatal errors in directtcp
	  methods
	* device-src/xfer-dest-taper-directtcp.c: track device_listen
	  failures better
	* installcheck/Amanda_Xfer.pl: test setup cancellation
	* perl/Amanda/Taper/Scribe.pm: remove leftover debug code
	* xfer-src/element-glue.c: always send XMSG_DONE, even on error

2010-02-17  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/ndmp-device.c: sanity-check file number
	* device-src/xfer-dest-taper-directtcp.c: same
	* device-src/xfer-dest-taper-splitter.c: same

2010-02-17  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Util.swg (finish_application): Don't check $config_name.

2010-02-17  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report/human.pm: fixed output of 'incr dump only'
	  fields

2010-02-17  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndmjob_main.c, ndmp-src/amndmjob_main.c:
	  add config_init(0, NULL);
	* recover-src/extract_list.c: Typo.

2010-02-16  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c: Set a config for version subcommand.

2010-02-16  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amfeatures.c: New fe_amrecover_origsize_in_header.
	* common-src/amfeatures.h: New fe_amrecover_origsize_in_header.
	* common-src/fileheader.c: Parse/read 'ORIGSIZE=' in header.
	* common-src/fileheader.h (dumpfile_t): Add orig_size.
	* common-src/timestamp.c (get_time_from_timestamp): New function to
	  convert a char timestamp to time_t.
	* common-src/timestamp.h (get_time_from_timestamp): Prototype.
	* restore-src/restore.c: Check fe_amrecover_origsize_in_header.
	* server-src/driver.c: Protoocl change to send orig_kb to taper.
	* server-src/driverio.c: Protoocl change to send orig_kb to taper.
	* server-src/find.c: Get orig_kb from log files.
	* server-src/find.h (find_result_t): add orig_kb.
	* server-src/holding.c (holding_set_origsize): New function to seti
	  'ORIGSIZE' in an holding file.
	* server-src/holding.h (holding_set_origsize): Prototype.
	* server-src/infofile.c: '(char *)0' to NULL.
	* server-src/taper.pl: Parse orig-kb in protocol, log it.
	* perl/Amanda/DB/Catalog.pm: Set orig_kb.
	* perl/Amanda/Logfile.swg (find_result_t): Add orig_kb.
	* installcheck/Amanda_DB_Catalog.pl: Check orig-kb in taper stats.
	* installcheck/taper.pl: Fix for orig-kb in protocol.

2010-02-16  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Fix crash for non application restore.

2010-02-16  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheckdump.pl: Less verbose, add --verbose option.
	* man/xml-source/amcheckdump.8.xml: Document new --verbose option.

2010-02-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.pl: Log 'no-tape' if the changer creation failed.

2010-02-12  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Put stderr of tar in the debug file.

2010-02-12  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report.pm: get per-tape info from L_PART instead of
	  L_INFO lines
	* perl/Amanda/Report/human.pm: widen text field for tape usage
	* installcheck/Amanda_Report.pl: installchecks

2010-02-11  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Assert if a config is not set.
	* common-src/amgetconf.pl, client-src/calcsize.c,
	  client-src/client_util.c, client-src/killpgrp.c,
	  client-src/rundump.c, client-src/runtar.c,
	  installcheck/Amanda_Debug.pl: Set a default config.

2010-02-11  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: New debug_days option.
	* common-src/conffile.h: New debug_days option.
	* man/xml-source/amanda-client.conf.5.xml: Document debug_days option.
	* man/xml-source/amanda.conf.5.xml: Document debug_days option.
	* common-src/debug.c: Don't do unlink in debug_open.
	* common-src/Makefile.am: Fix for test program.
	* common-src/amgetconf.pl: Correctly do dbopen and dbclose.
				   Call Amanda::Util::finish_application.
	* perl/Amanda/Util.swg: Add get_pname, get_ptype and get_pcontext.
	* perl/Amanda/Util.pod: Document.
	* common-src/file.c, client-src/getfsent.c,
	  server-src/infofile.c: Call dbclose();
	* changer-src/chg-glue.pl, device-src/amdevcheck.pl,
	  device-src/amtapetype.pl, server-src/amcheckdump.pl,
	  server-src/amcleanup.pl, server-src/amfetchdump.pl,
	  server-src/amrestore.pl, server-src/amrmtape.pl,
	  server-src/amvault.pl,
	  server-src/taper.pl: Call Amanda::Util::finish_application.

2010-02-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scan/traditional.pm,
	  perl/Amanda/Taper/Scan.pm: user_msg_fn take a hash as argument.
	* perl/Amanda/Recovery/Scan.pm: Fix doc.
	* server-src/amcheck-device.pl: New user_msg_fn.
	* server-src/amlabel.pl: New user_msg_fn.
	* server-src/amtape.pl: New user_msg_fn.
	* installcheck/amlabel.pl: Fix installcheck.

2010-02-11  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/xfer.c xfer-src/xfer-element.h: add
	  XFER_MECH_DIRECTTCP_CONNECT
	* xfer-src/source-directtcp-connect.c: element that uses it
	* xfer-src/dest-directtcp-listen.c: element that uses it
	* xfer-src/element-glue.c: glue for it
	* xfer-src/xfer-test.c: test it
	* perl/Amanda/Xfer.pod perl/Amanda/Xfer.swg: SWIG it
	* installcheck/Amanda_Xfer.pl: test it some more
	* xfer-src/Makefile.am: new files
	* xfer-src/dest-directtcp-connect.c: check addrs is not empty
	* perl/amglue/directtcp.swg: handle empty address lists better

2010-02-11  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: don't run amidxtaped on
	  --without-restore
	* installcheck/Installcheck/ClientService.pm
	  installcheck/amidxtaped.pl: kill amidxtaped on timeout
	* restore-src/amidxtaped.c: don't call safe_fd after the
	  app has already started - it closes fd's in use by
	  system libraries for e.g., LDAP access

2010-02-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Application.swg: Add read_magic_block and
				       write_magic_block.
	* perl/Amanda/Application.pod: Document them.

2010-02-10  Paul C. Mantz <pcmantz@gmail.com>
	* perl/Amanda/Report/human.pm: fixed columnspec code

2010-02-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Recovery/Scan.pm: user_msg_fn take a hase as argument.
	* server-src/amtape.pl: New user_msg_fn.

2010-02-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: Document undef state.
	* perl/Amanda/Changer/multi.pm: Set state to SLOT_UNKNOWN.
	* perl/Amanda/Changer/single.pm: Set state to undef.
	* perl/Amanda/Recovery/Scan.pm: Handle undef state.

2010-02-10  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.pl: Log no-tape error if no available tape.

2010-02-10  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amidxtaped.pl: skip DirectTCP tests if
	  --without-ndmp

2010-02-10  Dustin J. Mitchell <dustin@zmanda.com>
	* restore-src/restore.c: fix double-free error

2010-02-09  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.pl installcheck/amidxtaped.pl: amidxtaped
	  tests
	* amandad-src/amandad.c: comments
	* common-src/amanda.h: comments
	* restore-src/amidxtaped.c: don't check security when invoked with
	  'installcheck' as argv[1]

2010-02-09  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/ClientService.pm: utility to test
	  client services (noop, sendbackup, etc.)
	* installcheck/Makefile.am installcheck/noop.pl: new test
	* perl/Amanda/Util.pod perl/Amanda/Util.swg: new set_blocking

2010-02-09  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/amidxtaped.c: Check from_amandad before
				    fe_recover_splits.

2010-02-09  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Fix note for tapecycle.

2010-02-09  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report/human.pm: renamed variables to be more descriptive

2010-02-09  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xslt/expand-sambadoc.xsl: Define amkeyword, amtype and amdefault.
	* man/xml-source/amanda-client.conf.5.xml,
	  man/xml-source/amanda.conf.5.xml: Use them.

2010-02-09 Dan Locks <dwlocks@zmanda.com>
	*  amar-src/Makefile.am: add installperms stanza

2010-02-08  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Fix emphasis for keyword and type.

2010-02-08  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: New AMFEATURES application support option,
	  application_property_add_to_argv take a amfeatures argument.
	* client-src/client_util.h: New protoype.
	* client-src/selfcheck.c, client-src/sendbackup.c,
	  client-src/sendsize.c,
	  recover-src/extract_list.c: Pass the server amfeatures as argument
	  to application_property_add_to_argv.
	* common-src/amfeatures.c: New fe_sendbackup_noop.
	* common-src/amfeatures.h: New fe_sendbackup_noop.
	* server-src/dumper.c: Ignore "sendbackup: no-op' message.

2010-02-08  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am perl/Amanda/Feature.pod perl/Amanda/Feature.swg:
	  SWIG amfeatures
	* common-src/Makefile.am common-src/amfeatures.c: remove old hand-run
	  tests
	* common-src/amfeatures.h: add SWIG conditionals
	* installcheck/Makefile.am installcheck/Amanda_Feature.pl: test it

2010-02-06  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Config.pod: document autolabel format
	* perl/Amanda/Config.swg: don't use PL_sv_undef as a hash val

2010-02-06  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add autolabel config option.
	* common-src/conffile.h: Add autolabel config option.
	* man/xml-source/amanda.conf.5.xml: Document autolabel.
	* perl/Amanda/Config.swg: Swig autolabel.
	* perl/Amanda/Taper/Scan/traditional.pm,
	  perl/Amanda/Taper/Scan.pm: Use autolabel.
	* installcheck/Amanda_Config.pl, installcheck/Amanda_Taper_Scan.pl,
	  installcheck/Amanda_Taper_Scan_traditional.pl,
	  installcheck/Installcheck/Dumpcache.pm,
	  installcheck/Installcheck/Run.pm, installcheck/amcheck-device.pl,
	  installcheck/amcheck.pl, installcheck/amdevcheck.pl,
	  installcheck/amdump.pl, installcheck/pp-scripts.pl,
	  installcheck/taper.pl: Fix to use autolabel.

2010-02-05  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Device.pod, perl/Amanda/DB/Catalog.pm,
	* perl/Amanda/Xfer.pod, perl/Amanda/Process.pm,
	* perl/Amanda/BigIntCompat.pm, perl/Amanda/Cmdline.pod,
	* perl/Amanda/Constants.pm.in, perl/Amanda/Logfile.pod,
	* perl/Amanda/Tapelist.pod, perl/Amanda/Debug.pod: removed "API
	STATUS" pod header

2010-02-05  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report/human.pm: made fixed appearance of per-level
  	  column in output_stats

2010-02-04  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Fix crash in gnutar_listdir doesn't exist.

2010-02-04  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: Fix bad merge.

2010-02-03  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report/human.c: increased width of output_stats
  	  fields

2010-02-03  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c: Use %jd for gint.

2010-02-03  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c: Add 'estimate' command'.
	* man/xml-source/amadmin.8.xml: Document estimate command.
	* server-src/planner.c, server-src/server_util.c,
	  server-src/server_util.h: Move internal_server_estimate and
	  server_can_do_estimate from planner.c to server_util.c

2010-02-03  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Recovery/Clerk.pm: Use Amanda::Recovery::Scan
	* installcheck/Amanda_Recovery_Clerk.pl: Test it.

2010-02-03  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amfetchdump.pl: Use Amanda::Recovery::Scan.

2010-02-03  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Recovery_Scan.pl: Test Amanda::Recovery::Scan
	* installcheck/Makefile.am (server_tests): Add Amanda_Recovery_Scan.
	* perl/Amanda/Changer/compat.pm: Print device_name.
	* perl/Amanda/Interactive.pm: Base class for interactivity.
	* perl/Amanda/Interactive/stdin.pm: Interactivity on stdin/stdout.
	* perl/Amanda/Recovery/Scan.pm: Scan changers
	* perl/Makefile.am: Add Amanda/Interactive.pm,
	  Amanda/Interactive/stdin.pm, Amanda/Recovery/Scan.pm.
	* server-src/amcheckdump.pl: Use Amanda::Recovery::Scan.
	* server-src/amtape.pl: Use Amanda::Recovery::Scan.

2010-02-03  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Run.pm: export $taperoot and $holdingdir
	* installcheck/Installcheck/Dumpcache.pm: use new (much faster!) chg-disk
	* installcheck/amdevcheck.pl: give an explicit device name, now that
	  tapedev is not set

2010-02-03  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Config.swg common-src/conffile.c common-src/conffile.h:
	  add debug_recovery
	* perl/Amanda/Recovery/Clerk.pm: use it
	* perl/Amanda/Recovery/Planner.pm: use it

2010-02-03  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Recovery_Planner.pl: fix perl-5.6 bigint compat

2010-02-03  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/Makefile.am device-src/xfer-device.h
	  device-src/xfer-source-recovery.c device-src/xfer-source-taper.c
	  installcheck/Amanda_Xfer.pl perl/Amanda/Recovery/Clerk.pm
	  perl/Amanda/Xfer.pod perl/Amanda/XferServer.swg: rename
	  Amanda::Taper::Source to Amanda::Recovery::Source

2010-02-03  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am: check all .pm files (some had been missed)

2010-02-03  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm: fix bogus POD

2010-02-03  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: Fix parsing of unc if disk is noti
				      defined.

2010-02-03  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: Set $chg->{'chg_name'}

2010-02-02  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amtape.8.xml: add a suggestion to use -otpchanger=

2010-02-02  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amfetchdump.pl: only output a filename with a partnum
	  when -n was given

2010-02-02  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/ndmp-device.c: fix failure to check for fatal errors, use
	  signed 'delta'
	* device-src/tape-device.c: rewind correctly, even to the current file
	* device-src/vfs-device.c: set in_file=FALSE on finish()
	* installcheck/Amanda_Device.pl: check reading file header twice

2010-02-02  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/amtapetype.pl installcheck/Amanda_DB_Catalog.pl
	  installcheck/Amanda_Device.pl installcheck/Amanda_Recovery_Clerk.pl
	  installcheck/Amanda_Recovery_Planner.pl installcheck/Amanda_Xfer.pl
	  installcheck/amrestore.pl perl/Amanda/Recovery/Clerk.pm
	  perl/Amanda/Taper/Scribe.pm perl/Amanda/Xfer.pod server-src/amvault.pl
	  xfer-src/xfer-test.c: detect a finished xfer by XMSG_DONE, instead
	  of xfer_state == XFER_DONE

2010-02-02  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda-auth.7.xml: reduce circular references

2010-02-01  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm: add a :constants tag, clean up POD

2010-01-31  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Never return SLOT_UNKNOWN.

2010-01-30  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Allow multiple scripts on one line.

2010-01-29 Dan Locks <dwlocks@zmanda.com>
	*  packaging/rpm/amanda.spec: move manpages to
	   defattr(644,root,root,..) section

2010-01-29  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/DB/Catalog.pm: inculde dumps on holding
	* installcheck/Amanda_DB_Catalog.pl: tests
	* perl/Amanda/Recovery/Planner.pm: plan for dumps on holding
	* installcheck/Amanda_Recovery_Planner.pl: tests
	* perl/Amanda/Recovery/Clerk.pm: recover from holding with
	  Amanda::Xfer::Source::Holding when appropriate
	* installcheck/Amanda_Recovery_Clerk.pl: tests
	* server-src/amfetchdump.pl: give better messaging when recovering
	  from holding, don't append partnum unless it's a multipart dump
	* installcheck/amfetchdump.pl: tests

2010-01-29  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amfetchdump.8.xml: remove amfetchdump -s, -b,
	  and -w options
	* restore-src/Makefile.am restore-src/amfetchdump.c: remove
	* server-src/Makefile.am server-src/amfetchdump.pl: new version
	  of amfetchdump that uses Clerk and Planner
	* installcheck/amfetchdump.pl: updates to tests (change 'tape'
	  to 'volume', no more -b, add quotes around labels

2010-01-29  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am perl/Amanda/Recovery/Planner.pm: new package
	* installcheck/Amanda_Recovery_Planner.pl
	  installcheck/Makefile.am: tests

2010-01-29  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am perl/Amanda/Recovery/Clerk.pm: new perl module
	* installcheck/Makefile.am installcheck/Amanda_Recovery_Clerk.pl:
	  tests

2010-01-29  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_MainLoop.pl: a call_after test that is more
	  stable when the system clock is stepping
	* perl/Amanda/Util.pod perl/Amanda/Util.swg: add gettimeofday()

2010-01-29  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Logfile.pl: note about checks
	* perl/Amanda/Logfile.pod perl/Amanda/Logfile.swg: SWIG it
	* server-src/find.c server-src/find.h: add dynamic_disklit param
	  to search_holding_disk

2010-01-28  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/multi.pm: Fix current in inventory result.
	* installcheck/Amanda_Changer_multi.pl: Test it.

2010-01-27  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amfetchdump.pl: don't use an END block for cleanup

2010-01-27  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/DB/Catalog.pm: also check dumpspecs for get_dumps
	* installcheck/Amanda_DB_Catalog.pl: test it
	* perl/Amanda/Logfile.pod perl/Amanda/Logfile.swg: add match_level

2010-01-27  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-glue.pl: fix chg-glue to be more careful about
	  releasing the device first

2010-01-27  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Dumpcache.pm: add 'parts' and 'compress'
	  cached dumps
	* installcheck/amfetchdump.pl: more/better tests
	* man/xml-source/amfetchdump.8.xml: formatting

2010-01-27  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Config.pod perl/Amanda/DB/Catalog.pm
	  perl/Amanda/Taper/Scribe.pm perl/Amanda/Xfer.pod:
	  fix typos

2010-01-27  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Util.pm: added safe_overwrite_file
	* installcheck/Amanda_Util.pl: installcheck

2010-01-27  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/single.pm: Undo bogus chunk from previous patch.

2010-01-27  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: Document new inventory result.
	* perl/Amanda/Changer/disk.pm, perl/Amanda/Changer/multi.pm,
	  perl/Amanda/Changer/ndmp.pm, perl/Amanda/Changer/rait.pm,
	  perl/Amanda/Changer/robot.pm,
	  perl/Amanda/Changer/single.pm: Generate new inventory result.
	* installcheck/Amanda_Changer_disk.pl,
	  installcheck/Amanda_Changer_multi.pl,
	  installcheck/Amanda_Changer_ndmp.pl,
	  installcheck/Amanda_Changer_rait.pl,
	  installcheck/Amanda_Changer_robot.pl: Fix for new inventory result.
	* server-src/amtape.pl: Use new inventory result.

2010-01-26  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Util.swg: added slurp and burp subs
	* installcheck/Amanda_Util.pl: installcheck for slurp and burp
	* installcheck/Installcheck/Run.pm: use of slurp in production

2010-01-26  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report.pm: Add notes, time, dle. Many improvements.
	* perl/Amanda/Report/human.pm: Many improvements.
	* installcheck/Amanda_Report.pl: Fix for new data.
	* perl/Makefile.am: Check AmandaReport_DATA.

2010-01-26  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.h: Add getconf_linenum.
	* perl/Amanda/Config.swg: Add getconf_linenum.
	* perl/Amanda/Config.pod: Document getconf_linenum.
	* perl/Amanda/Changer.pm: Accept tapedev or tpchanger from command
	  line without setting the other to ''.

2010-01-25  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/amglue/bigint.c: call SPAGAIN after loading
	  Math::BigInt, in case the stack base has moved
	* perl/amglue/integers.swg: don't place a bigint on
	  the stack until the stack pointer has been restored
	* perl/Amanda/Header.swg: use static

2010-01-22  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_DB_Catalog.pl: remove recursive links that
	  confuse old is_deeply implementations

2010-01-22  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/DB/Catalog.pm: Use the terms 'dump' and 'part' a bit
	  more carefully; add ability to query and sort dumps; use weak refs to
	  break reference loops
	* installcheck/Amanda_DB_Catalog.pl: tests
	* perl/Amanda/Util.pod perl/Amanda/Util.swg: add weaken_ref
	* server-src/amvault.pl: update to match
	* perl/Amanda/Logfile.pod perl/Amanda/Logfile.swg: add match_host,
	  match_disk, and match_datestamp, and document dumps_match_dumpspecs

2010-01-21  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/ndmp-device.c, device-src/rait-device.c,
	  device-src/s3-device.c, device-src/tape-device.c,
	  device-src/vfs-device.c: Set volume_header with the written header
	  when opened in write mode.

2010-01-21  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Report/human.pm: Many fix.
	* server-src/amreport_new.pl: Many fix.

2010-01-18  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndma_cops_backreco.c: Output "DATA SIZE" lines.
	* server-src/dumper.c: Set dumpsize from origsize for DIRECTTCP
			       data path.

2010-01-19  Paul C. Mantz <pcmantz@zmanda.com>
	* installcheck/amreport.pl: made output checks ignore spacing

2010-01-18  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndmpconnobj.c: even better logging for connection setup and
	  close

2010-01-18  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndmp2_xmt.c ndmp-src/ndmp3_xmt.c ndmp-src/ndmp4_xmt.c
	  ndmp-src/ndmp9_xmt.c: fix sign-bit extension error in *_xdr_u_quad

2010-01-18  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/Makefile.am: fix (apparently innocuous) Makefile typo

2010-01-18  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: add an xfer argument to start_dump, so
	  that the scribe can cancel a transfer in an error situation
	* installcheck/Amanda_Taper_Scribe.pl: git it an xfer
	* server-src/taper.pl: git it an xfer

2010-01-18  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndma_tape_simulator.c: maintain a 'lock file' per device,
	  and return NDMP_DEVICE_BUSY_ERR on a collision
	* device-src/ndmp-device.c: close the tape agent before switching
	  connections, and before closing a device, to avoid
	  NDMP_DEVICE_BUSY_ERR; do not set the record size when opening the
	  tape agent, as the mover may already be active

2010-01-18  Dustin J. Mitchell <dustin@zmanda.com>
	* restore-src/restore.c: add another htonl invocation for ipv4 address

2010-01-17  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Xfer.pod: fix POD typo

2010-01-17  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/robot.pm: Set drive state to unknown.

2010-01-17  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/compat.pm: allow multiline responses
	* installcheck/Amanda_Changer_compat.pl: test

2010-01-17  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Curinfo.pl: remove spurious diag()

2010-01-17  Dustin J. Mitchell <dustin@zmanda.com>
	* gnulib/regenerate/regenerate: add regex module, for Mac OS X
	  compatibility; no change in gnulib version
	* config/gnulib/* gnulib/*: resulting gnulib updates

2010-01-17  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amreport.8.xml: fix typo in manpage

2010-01-17  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: $chg->load always read ther label.
	* perl/Amanda/Changer/compat.pm, perl/Amanda/Changer/disk.pm,
	* perl/Amanda/Changer/multi.pm, perl/Amanda/Changer/rait.pm,
	* perl/Amanda/Changer/single.pm: $chg->load always read ther label.
	* perl/Amanda/Taper/Scan/traditional.pm, perl/Amanda/Taper/Scribe.pm,
	* server-src/amcheck-device.pl, server-src/amcheckdump.pl,
	* server-src/amlabel.pl, server-src/amrestore.pl,
	* server-src/amtape.pl, server-src/amvault.pl: Don't read the label.

2010-01-15  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report/human.pm: changed usage of 'constant' for perl
	  5.6 compatibility

2010-01-15  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Changer_robot.pl: Typo.

2010-01-15  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: iread errfd and close it on termination.

2010-01-15  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/multi.pm, perl/Amanda/Changer/robot.pm: Add
	  update '1-4=' syntax to mark slot as being in unknown state.
	* man/xml-source/amanda-changers.7.xml: Document new syntax.
	* installcheck/Amanda_Changer_multi.pl: Test new syntax.
	* installcheck/Amanda_Changer_robot.pl: Test new syntax.

2010-01-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c (parse_diskline): Don't set todo to 0 for
	                                          skip disk.
	* server-src/diskfile.c (disable_skip_disk): New function to set todo
	                                             to 0 for skip disk.
	* server-src/diskfile.h (disable_skip_disk): Add prototype.
	* server-src/amcheck.c, server-src/driver.c, server-src/planner.c
	  server-src/reporter.c: Call disable_skip_disk.

2010-01-14  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: typo.

2010-01-14  Paul C. Mantz <pcmantz@zmanda.com>
	* server-src/amreport_new.pl: amreport rewrite in perl
	* perl/Amanda/Report.pm perl/Amanda/Report/human.pm
          perl/Amanda/Report/xml.pm: factored out output formats and
	  added legacy format
	* perl/Makefile.am server-src/Makefile.am: makefile changes
	* contrib/amreport.rnc: amreport xml spec in RelaxNG

2010-01-13  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/device.c perl/Amanda/Device.pod perl/Amanda/Device.swg:
	  make device_listen and device_accept callable anywhere; be explicit
	  about conn refcount from accept
	* device-src/ndmp-device.c: don't call device_use_connection, as
	  that method requires ACCESS_NULL
	* restore-src/restore.c: fix typo

2010-01-13  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/taper.pl: fix taper writing status too quickly

2010-01-13  Dustin J. Mitchell <dustin@zmanda.com>
	* client-src/client_util.c: fix to send the --direct-tcp and
	  --data-path arguments to applications
	* client-src/sendbackup.c: add a bit of debugging to sendbackup

2010-01-13  Dustin J. Mitchell <dustin@zmanda.com>
	* restore-src/restore.c: add missing htonl to restore.c for ipv4
	  address; fix typo

2010-01-13  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndmpconnobj.c ndmp-src/ndmpconnobj.h: better debugging
	  messages, including a fancy connection ID to help debug problems
	  using the wrong NDMP connection at the wrong time

2010-01-13  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/ndmp-device.c: work around record_size bug in ndmjob

2010-01-13  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amfetchdump.pl: check restored files more closely

2010-01-13  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/taper.pl: taper installcheck to run multiple dumps
	  on a spanned NDMP device

2010-01-13  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Dumpcache.pm: Add an 'ndmp' dumpcache
	* installcheck/Installcheck/Mock.pm: add a way to revive it for
	  recovery tests
	* installcheck/amfetchdump.pl: use it

2010-01-13  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/ndmp-device.c: correctly handle devices while they are
	  coming online after a load

2010-01-13  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/scsiconst.h: fix typo in constant name

2010-01-13  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/robot.pm: don't mark unknown but loaded tapes as
	  'blank', mark them as unknown

2010-01-13  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/ndmp.pm: use the first MTE found, in systems
	  with several

2010-01-13  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/ndmp.pm: add more SCSI error handling

2010-01-13  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/ndmp.pm: use scsi data dir 'none' for MOVE
	  MEDIUM

2010-01-13  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/ndmp-device.c: fix parsing of device node in ndmp-device

2010-01-13  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/ndmp-device.c: fix dangling reference

2010-01-11  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/Makefile.am common-src/fileheader-test.c: new test
	* common-src/fileheader.c common-src/fileheader.h: validate a lot
	  of inputs; use g_debug; handle compressed/comp_suffix and
	  encrypted/encr_suffix in a sane way; remove unused encrypt_cmd; fix
	  bug in parsing empty heredoc
	* device-src/amtapetype.pl: add 'program' to header
	* installcheck/Amanda_Xfer.pl: add 'program' to header
	* perl/Amanda/Header.pod perl/Amanda/Header.swg: remove encrypt_cmd
	  and document interrelationships of fields

2010-01-08  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am: don't build useless static versions of perl libs

2010-01-08  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/xfer-source-taper.c: make element cancellation work

2010-01-08  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Xfer.swg: allow xfer elements to be compared for
	  identity

2010-01-08  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/simpleprng.c common-src/simpleprng.h: add a method to
	  extract the current seed from the PRNG state
	* xfer-src/source-random.c xfer-src/xfer-element.h: add get_seed()
	* perl/Amanda/Xfer.pod perl/Amanda/Xfer.swg: SWIG it

2010-01-07  Paul C. Mantz <pcmantz@zmanda.com>
	* installcheck/Amanda_Curinfo.pl: fixed optional dependency on
          Text::Diff

2010-01-07  Paul C. Mantz <pcmantz@zmanda.com>
        * perl/Amanda/Curinfo.pm: perl implementation of server-src/infofile.h
        * perl/Amanda/Curinfo/Info.pm: container classes for Amanda::Curinfo
	* installcheck/Amanda_Curinfo.pl: installcheck
	* perl/Makefile.am installcheck/Makefile.am: makefile additions

2010-01-06  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndma_tape.c: halt on media error
	* ndmp-src/ndmp4_translate.c ndmp-src/ndmp4_enum_strs.c
	  ndmp-src/ndmp4.h ndmp-src/ndmp4.x: remove
	  NDMP4_MOVER_PAUSE_MEDIA_ERROR and add NDMP4_MOVER_HALT_MEDIA_ERROR
	* ndmp-src/ndmp9.h ndmp-src/ndmp9.x: add
	  NDMP9_MOVER_HALT_MEDIA_ERROR

2010-01-06  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: add a dependency to run swig if the .pod is modified.

2010-01-06  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/NDMP.pod: fix %}.

2010-01-06  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/amndma_tape_simulator.c: Ignore ftruncate error.

2010-01-06  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/NDMP.pod: typo
	* perl/Amanda/NDMP.swg: actually include POD

2010-01-05  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/device.c device-src/device.h: remove conn argument from
	  read_to_connection and write_from_connection; check for ACCESS_NULL
	* device-src/ndmp-device.c: remove conn argument, call use_connection
	  from accept_impl
	* installcheck/Amanda_Device.pl installcheck/Amanda_Xfer.pl
	  perl/Amanda/Device.pod perl/Amanda/Device.swg restore-src/restore.c
	  device-src/xfer-dest-taper-directtcp.c: don't supply conn argument,
	  call use_connection at the appropriate time

2010-01-05  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/ndmp-device.c: add an eject() implementation

2010-01-04  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndma_robot_simulator.c: increase logging levels, so that
	  ndmjob does not output logging info to stdout during installchecks

2010-01-04  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/amglue/directtcp.swg: don't use inet_ntoa until in is
	  initialized

2010-01-04  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndmpconnobj.c ndmp-src/ndmpconnobj.h: remove singleton
	  pattern and the identifiers that supported it
	* device-src/ndmp-device.c: don't worry about idents
	* perl/Amanda/Changer/ndmp.pm: don't worry about idents
	* perl/Amanda/NDMP.pod perl/Amanda/NDMP.swg: SWIG and document
	* installcheck/Amanda_NDMP.pl: change tests

2010-01-04  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/device.c device-src/device.h: change can_use_connection
	  to the imperative use_connection
	* device-src/ndmp-device.c: implement use_connection
	* device-src/xfer-device.h device-src/xfer-dest-taper-directtcp.c
	  device-src/xfer-dest-taper-splitter.c device-src/xfer-dest-taper.c:
	  add a use_device method, start_part no longer needs a device
	* perl/Amanda/Device.pod perl/Amanda/Device.swg perl/Amanda/Xfer.pod
	  perl/Amanda/XferServer.swg: SWIG it
	* perl/Amanda/Taper/Scribe.pm: call new use_device and start_part
	* installcheck/Amanda_Xfer.pl installcheck/taper.pl: test it

2010-01-04  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: conditionalize Amanda_Changer_ndmp tests
	  on WANT_NDMP

2010-01-04  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/amglue/directtcp.swg: initialize the other struct in_addr by
	  member name, too (see 2009-12-29)

2010-01-04  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndmpconnobj.c device-src/ndmp-device.c: debugging tweaks
	* installcheck/Installcheck/Mock.pm: use chg-ndmp directly
	* installcheck/mock/chg-ndmjob.pl: remove
	* installcheck/Amanda_Changer_ndmp.pl: new test
	* installcheck/Amanda_Device.pl installcheck/Amanda_NDMP.pl
	  installcheck/Amanda_Xfer.pl installcheck/Makefile.am
	  installcheck/amrestore.pl installcheck/taper.pl: use chg-ndmp for
	  tests via I::Mock
	* perl/Amanda/Changer/ndmp.pm: open and close the scsi device every
	  time, process sense data correctly, use correct element addresses
	  for MOVE MEDIUM

2010-01-04  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsd-security.c, common-src/bsdtcp-security.c,
	  common-src/bsdudp-security.c: Check service != NULL.

2010-01-04  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndma_comm_session.c ndmp-src/ndma_robot.c
	  ndmp-src/ndmagents.h ndmp-src/ndmlib.h ndmp-src/ndmos.h
	  ndmp-src/ndmos_common.c ndmp-src/Makefile.am
	  ndmp-src/ndma_robot_simulator.c: add robot simulator
	* ndmp-src/ndmos_glib.h: use robot simulator
	* ndmp-src/scsiconst.h: fix typo

2009-12-29  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndma_tape.c: remove ndmta_belay
	* ndmp-src/ndmagents.h ndmp-src/ndmos.h: use
	  NDMOS_MACRO_TAPE_AGENT_ADDITIONS for tape simulator

2009-12-29  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Taper/Scan/traditional.pm: only open 'current' on the
	  scan

2009-12-29  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/amglue/directtcp.swg: initialize struct in_addr by member name

2009-12-29  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: sort tests
	* installcheck/=setupcache.pl: rename _setupcache so it sorts first

2009-12-29  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Config.swg: fix return type for config_init
	* perl/amglue/glib.swg: use PL_sv_yes and PL_sv_no for booleans

2009-12-24  Charles Curley <charlescurley@charlescurley.com>
	* README: rewrite

2009-12-23  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3-device.c: don't set the throttling properties unless
	  they are nonzero

2009-12-23  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am: only build chg-ndmp when WANT_NDMP

2009-12-23  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/ndmp.pm: set device authentication properties
	* perl/Makefile.am: actually include ndmp.pm
	* perl/Amanda/Device.pod: doc extended property_get
	* man/xml-source/amanda-changers.7.xml: document properties

2009-12-23  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/fileheader.c: try to generate parsable headers
	* perl/Amanda/Header.swg: add default values
	* server-src/amrestore.pl: fix typo
	* installcheck/amrestore.pl: ndmp-device test (not using directtcp
	  yet)

2009-12-23  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3.c: recent versions of curl switched from #define
	  to enum, so #ifdef no longer works; test specific versions
	  instead

2009-12-23  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndma_ctrl_robot.c: show error messages

2009-12-23  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_NDMP.pl: work around perl-5.6's bad BigInt

2009-12-22  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3.c: remove debugging info

2009-12-22  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3.c: only including throttling code if the precompiler
	  symbols are present

2009-12-22  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/ndmp-device.c: fix TAPEEND handling in seek_file
	* installcheck/Amanda_Device.pl: test it

2009-12-22  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/Makefile.am: compile ndmp-src without warnings again - the
	  source generated with rpcgen contains constructs that cause
	  warnings for which earlier gcc's have no -Wno-xxx option
	* configure.in: revert disabled warnings

2009-12-22  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/NDMP.swg: correct argument size to SWIG_AsCharPtrAndSize

2009-12-22  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3.c device-src/s3.h: add max send and receive speeds
	* device-src/s3-device.c: add PROPERTY_MAX_SEND_SPEED and
	  PROPERTY_MAX_RECV_SPEED
	* man/xml-source/amanda-devices.7.xml: document

2009-12-21  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/Makefile.am configure.in: conditionalize warnings which
	  are not present on all gcc version
	* ndmp-src/amndma_tape_simulator.c ndmp-src/ndma_tape_simulator.c
	  ndmp-src/ndmjob_main_util.c: fix warnings
	* ndmp-src/ndmp9.h ndmp-src/ndmp9.x ndmp-src/ndmp9_xdr.c: unsigned
	  long long constant should end in 'ull'

2009-12-21  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_NDMP.pl: add auth parameter here too

2009-12-21  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndmpconnobj.c ndmp-src/ndmpconnobj.h: add an auth
	  parameter with four options
	* perl/Amanda/NDMP.pod perl/Amanda/NDMP.swg: SWIG it
	* device-src/ndmp-device.c: add NDMP_AUTH property
	* man/xml-source/amanda-devices.7.xml: doc it
	* perl/Amanda/Changer/ndmp.pm: add NDMP-AUTH property
	* man/xml-source/amanda-changers.7.xml: doc it

2009-12-21  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/Makefile.am: skip some warnings that are endemic to ndmjob
	* ndmp-src/*.c: fix warnings, mostly sign differences

2009-12-21  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndmpconnobj.c ndmp-src/ndmpconnobj.h: add resid_count
	  return value to ndmp_connection_tape_mtio
	* perl/Amanda/NDMP.pod perl/Amanda/NDMP.swg: SWIG it
	* installcheck/Amanda_NDMP.pl: test it
	* installcheck/Makefile.am: actually run Amanda_NDMP tests
	* device-src/ndmp-device.c: compatible change

2009-12-21  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.8.xml: remove amdd

2009-12-21  Dustin J. Mitchell <dustin@zmanda.com>

	* changer-src/Makefile.am changer-src/chg-rait.sh
	  changer-src/chg-null.sh: restore deleted files

2009-12-21  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda-devices.7.xml: update NDMP Device docs

2009-12-21  Dustin J. Mitchell <dustin@zmanda.com>
	* autogen: do not use sed --in-place

2009-12-20  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amgetconf.8.xml: fix formatting error by putting
	  <note> on its own line

2009-12-18  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck.pm: disable log_test_output on perl-5.6

2009-12-18  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am perl/Amanda/Changer/ndmp.pm: new changer
	* man/xml-source/amanda-changers.7.xml: docs
	* perl/Amanda/Changer.pm: better error handling
	* perl/Amanda/Changer/robot.pm: changes for subclassing

2009-12-18  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Don't call validate_optionstr for flush dles.

2009-12-18  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/components.m4: AC_SUBST AMANDA_COMPONENTS
	* perl/Amanda/Constants.pm.in: include AMANDA_COMPONENTS
	* perl/Amanda/Util.pod perl/Amanda/Util.swg: add built_with_component
	* installcheck/Amanda_Device.pl: add ndmp-only tests
	* installcheck/Amanda_Xfer.pl: add server-only tests
	* installcheck/Amanda_Device_ndmp.pl: remove
	* installcheck/Amanda_Xfer_serveronly.pl: remove
	* installcheck/Makefile.am: remove files
	* installcheck/taper.pl: conditionalize ndmp tests
	* perl/Makefile.am: link Amanda::NDMP to libndmlib and libamanda

2009-12-18  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amtrmidx.c: Check index entry will all dles using the
				 same index directory.

2009-12-17  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm, perl/Amanda/Changer/compat.pm,
	  perl/Amanda/Changer/disk.pm, perl/Amanda/Changer/multi.pm,
	  perl/Amanda/Changer/robot.pm, perl/Amanda/Changer/single.pm,
	  perl/Amanda/Taper/Scan/traditional.pm, server-src/amtape.pl,
	  Split the 'inuse' code into 'driveinuse' and 'volinuse'.
	* installcheck/Amanda_Changer_compat.pl,
	  installcheck/Amanda_Changer_disk.pl,
	  installcheck/Amanda_Changer_multi.pl,
	  installcheck/Amanda_Changer_rait.pl,
	  installcheck/Amanda_Changer_robot.pl,
	  installcheck/Amanda_Changer_single.pl:
	  Use 'driveinuse' and 'volinuse'.

2009-12-17  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: etimeout must be positive.
	* common-src/protocol.c: Fix possible timeout of 0.

2009-12-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcleanup.pl: Use CONTEXT_CMDLINE to get a debug file.
	  Add a few debugging output.

2009-12-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheckdump.pl: Call $res->release() with a callback.

2009-12-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck-device.pl, server-src/amcheckdump.pl,
	  server-src/amrestore.pl,
	  server-src/amvault.pl: Call $res->set_label after $dev->read_label.

2009-12-16  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Changer_robot.pl: fix installchecks

2009-12-16  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/robot.pm: make chg-robot's Interface easier to
	  subclass

2009-12-16  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda-changers.7.xml: add docs for old chg-multi,
	  based on example/chg-multi.conf

2009-12-15  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/ndmp-device.c: use err_code, instead of err_msg, to
	  detect an NDMPConnection error

2009-12-15  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/ndmp-device.c: fix use of ndmp4_* enumerated types

2009-12-15  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/disk.pm: Keep track of pid, automatically remove
	  drive if the pid is dead.

2009-12-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c: Add validate_optionstr,  optionstr and
	  xml_optionstr no longer do validation..
	* server-src/diskfile.h: Add validate_optionstr, change prototype for
	  optionstr and xml_optionstr.
	* server-src/amadmin.c: Add missing case.
	* server-src/amcheck.c, server-src/amindexd.c, server-src/planner.c:
	  Use validate_optionstr, Change for new *_optionstr prototype.
	* server-src/driver.c: Use validate_optionstr.
	* server-src/driverio.c: Change for new *_optionstr prototype.
	* installcheck/amdump.pl: Check planner error from validate_optionstr.

2009-12-15  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_NDMP.pl device-src/ndmp-device.c
	  ndmp-src/ndmpconnobj.c ndmp-src/ndmpconnobj.h: return an object with
	  an error set instead of just returning an error from the constructor
	* perl/Makefile.am perl/Amanda/NDMP.swg: SWIGging of ndmpconnobj
	* perl/Amanda/NDMP.pod: docs for same

2009-12-15  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndmpconnobj.c ndmp-src/ndmpconnobj.h: add ndmp_scsi_*

2009-12-15  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/amglue/amglue.h: amglue_newSv[iu]64 requires special care
	  when used in an outgoing typemap, due to stack stomping
	* perl/Amanda/Archive.swg perl/Amanda/Config.swg
	  perl/Amanda/Device.swg perl/Amanda/Util.swg perl/amglue/bigint.c
	  perl/amglue/integers.swg: exercise care as directed

2009-12-15  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Wait to parse the header before
	  confirming destination directory. Unlink files only for GNUTAR
	  and amgtar.
	* client-src/client_util.c: Parse RECOVER-PATH application support
				    result.
	* client-src/client_util.h: Add recover_path_t.

2009-12-14  Dustin J. Mitchell <dustin@zmanda.com>
	* contrib/convert-zd-mtx-to-robot.sh: useful conversion script
	* NEWS man/xml-source/amanda-changers.7.xml: mention conversion script
	* perl/Amanda/Changer/robot.pm: allow spaces between times and units

2009-12-14  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amtape.pl: Call $res->set_label after reading a label.

2009-12-13  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/taper.pl: put header socket in blocking mode

2009-12-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Process.pm: Remove unneded 'use'.
	* perl/Makefile.am: Build Amanda::Process on client.

2009-12-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/disk.pm: 'next' always set current_slot.

2009-12-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/multi.pm: New changer.
	* perl/Makefile.am: Build Amanda::Changer::multi
	* man/xml-source/amanda-changers.7.xml: Document Amanda::Changer::multi
	* installcheck/Amanda_Changer_multi.pl: installcheck for multi.
	* installcheck/Makefile.am: build and test Amanda_Changer_multi.
	* perl/Amanda/Util.swg: Add is_pid_alive.
	* perl/Amanda/Util.pod: Document is_pid_alive.

2009-12-11  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Use wrong indice.
	* server-src/driver.c: run POST_HOST_BACKUP scripts for all hosts.

2009-12-11  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm server-src/taper.pl: support DirectTCP
	* server-src/driverio.c: do not send datapath to taper
	* installcheck/Amanda_Taper_Scribe.pl installcheck/taper.pl: test DirectTCP
	* installcheck/amfetchdump.pl installcheck/amrestore.pl: handle
	  changed on-tape format
	* installcheck/Amanda_Xfer_serveronly.pl: fix cleanup
	* ndmp-src/ndma_tape.c: fix typos
	* NEWS: document behavior changes

2009-12-11  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/chunker.c server-src/diskfile.c server-src/diskfile.h
	  server-src/driver.c server-src/driverio.c server-src/dumper.c
	  server-src/taper.pl: Change protocol between chunker/taper and dumper:
	  "PORT header_port  data_host:data_port", and dumper sends the header
	  completely before sending the data

2009-12-10  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndmpconnobj.c: fix uninitialized variable

2009-12-10  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/xfer-device.h device-src/xfer-dest-taper-directtcp.c
	  device-src/Makefile.am: new class
	* perl/Amanda/Xfer.pod perl/Amanda/XferServer.swg: SWIG and document
	* installcheck/Amanda_Xfer_serveronly.pl: tests
	* perl/amglue/directtcp.swg: return undef for null addrs array
	* xfer-src/xmsg.h xfer-src/xmsg.c perl/Amanda/Xfer.swg : add XMSG_READY

2009-12-10  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/ndmp-device.c: finish reading, writing, and directtcp implementation
	* ndmp-src/ndmpconnobj.h ndmp-src/ndmpconnobj.c: add methods and args
	* installcheck/Amanda_Device_ndmp.pl: new tests

2009-12-10  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/element-glue.c: element-glue shouldn't complain when the
	  xfer's already been cancelled

2009-12-09  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndma_comm_dispatch.c ndmp-src/ndma_tape.c: set record_num
	  according to the spec (even though it's inconsistent)

2009-12-09  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndma_comm_dispatch.c: follow the spec regarding window
	  offset+length = G_MAXUINT64

2009-12-09  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndma_tape.c: properly update bytes_moved when reading to
	  connection

2009-12-09  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndma_comm_dispatch.c ndmp-src/ndma_tape.c
	  ndmp-src/ndmagents.h: make mover seek to correct block number

2009-12-09  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/simpleprng.c: better error message from simpleprng on
	  random number mismatch
	* common-src/simpleprng.h: simpleprng_state_t is now a real struct
	* xfer-src/dest-null.c: no need to give buffer offset anymore

2009-12-08  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Fix for GNUTAR/DUMP.
	* restore-src/restore.c: Fix DATA-PATH excahnge with amrecover for
	  reading from a holding disk.

2009-12-08  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.c, device-src/device.h:
	  Add device_unaliassed_name function.
	* perl/Amanda/Device.swg: Add unaliassed_name function.

2009-12-07  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c: Fix read_to_connection argument.

2009-12-07  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndmagents.h: use PATH_MAX for drive_name; remove
	  unnecessary include

2009-12-07  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/directtcp.h: mention IP byte order
	* perl/amglue/directtcp.swg device-src/device.c device-src/device.h
	  perl/Amanda/Device.swg: use guint64 instead of gsize for read/write
	  lengths; directtcp_supported is a boolean class attribute instead of a
	  method; listen takes a for_writing argument; SWIG directtcp methods
	* perl/Amanda/Device.pod: document LEOM handling, new methods
	* device-src/directtcp-connection.c: call parent's finalize
	* restore-src/restore.c: pass correct for_writing to listen

2009-12-07  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndma_tape_simulator.c: use g_strlcpy to be safe
	* ndmp-src/ndmagents.h: expand drive_name to 256 bytes

2009-12-07  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/Makefile.am ndmp-src/ndmpconnobj.c ndmp-src/ndmpconnobj.h:
	  new class to encapsulate all of the NDMP transactions without
	  requiring weird precompiler macros

2009-12-07  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndma_tape_simulator.c: fix buffer overflow in NDMJOB code
	  triggered by long filenames in buildbots

2009-12-07  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/element-glue.c: one more uninitialized variable

2009-12-07  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.h, device-src/device.c,
	  man/xml-source/amanda-changers.7.xml, perl/Amanda/Device.pod
	  perl/Amanda/Device.swg: Add an eject method to the device-api.
	* device-src/tape-device.c, device-src/tape-ops.h,
	  device-src/tape-posix.c, device-src/tape-uware.c,
	  device-src/tape-aix.c,
	  device-src/tape-xenix.c: Implement eject method.
	* perl/Amanda/Changer/robot.pm: Use new eject method.

2009-12-07  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/dvdrw-device.c: fix uninitialized variable, don't use
	  G_DEFINE_DEVICE

2009-12-07  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/element-glue.c: fix uninitialized use of variable

2009-12-07  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/element-glue.c xfer-src/element-glue.h: full glue for
	  XFER_MECH_DIRECTTCP_LISTEN (source reorganized)
	* xfer-src/xfer-test.c: tests for same
	* xfer-src/dest-directtcp-connect.c perl/Amanda/Xfer.pod
	  perl/Amanda/Xfer.swg: new class
	* xfer-src/source-directtcp-listen.c: bugfix
	* xfer-src/xfer-element.c xfer-src/xfer-element.h xfer-src/xfer.c
	  xfer-src/xfer.h: reorganize xfer error handling, fix ref leaks
	* common-src/testutils.c: support for leak-checking
	* xfer-src/dest-buffer.c xfer-src/dest-null.c
	  server-src/xfer-source-holding.c device-src/xfer-dest-device.c
	  device-src/xfer-dest-taper-splitter.c device-src/xfer-source-device.c
	  device-src/xfer-source-taper.c: use revised error-handling
	* perl/amglue/source.c: fix refcount problem
	* xfer-src/Makefile.am: new files

2009-12-07  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/mock/chg-ndmjob.pl installcheck/Installcheck/Mock.pm
	  installcheck/Makefile.am: new mock changer for ndmjob
	* ndmp-src/ndma_tape_simulator.c ndmp-src/ndmagents.h
	  ndmp-src/ndmjob.h ndmp-src/ndmjob_args.c: add EOM (both LEOM and
	  PEOM) support to the tape simulator

2009-12-07  Sam Couter <sam@couter.id.au>
	* AUTHORS: add Sam to AUTHORS
	* device-src/device.c device-src/Makefile.am
	  device-src/dvdrw-device.c: new dvd-rw device
	* configure.in config/amanda/dvdrw-device.m4: config
	  for it
	* device-src/vfs-device.c device-src/vfs-device.h: enable
	  subclassing of VFS device
	* man/xml-source/amanda-devices.7.xml: documentation
	* server-src/amcheck-device.pl: add usage() sub

2009-12-07  Sam Couter <sam@couter.id.au>
	* man/Makefile.am man/xml-source/*: fix documentation so out-of-tree
					  builds work

2009-12-07  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/calcsize.c: fix check_running_as.

2009-12-06  Dustin J. Mitchell <dustin@zmanda.com>
	* client-src/client_util.c: revert previous change

2009-12-05  Sam Couter <sam@couter.id.au>
	* client-src/client_util.c: Free correct memory

2009-12-05  Dustin J. Mitchell <dustin@zmanda.com>
	* config/automake/scripts.am: remove unnecessary -T
	* perl/Amanda/BigIntCompat.pm: remove unused $stringify

2009-12-04  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Give error if pre-host-backup or
				post-host-backup are executed on client.
	* man/xml-source/amanda.conf.5.xml: Document it.

2009-12-03  Paul C. Mantz <pcmantz@zmanda.com>
	* server-src/tapefile.c server-src/tapefile.h
          perl/Amanda/Tapelist.swg installcheck/Amanda_Tapelist.pl:
          added and swigged get_last_reusable_tape_label().

2009-12-02  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scan/traditional.pm: continue the scan on inuse
						 error.

2009-12-02  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Taper/Scan/traditional.pm: Release reservation on error.

2009-12-01  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Device.swg: #include "glib-util.h".

2009-12-01  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Fix conf_init_data_path argument type.
	* common-src/debug.c: Use gpointer.
	* ndmp-src/ndmjob_main.c, ndmp-src/amndmjob_main.c:
	  #include "util.h" for set_pname prototype.
	* ndmp-src/ndma_cops_backreco.c: Add prototype.
	* ndmp-src/ndmjob.h, ndmp-src/ndmjob_args.c:
	  Rename version_info to ndmjob_version_info to avoid conflict.

2009-12-01  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/DB/Catalog.pm: Fix for new find_result_t api.
	* installcheck/Amanda_Logfile.pl: Fix for perl-5.6.
	* installcheck/Amanda_DB_Catalog.pl: Fix for perl-5.6.

2009-12-01  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/Makefile.am: amndmjob_SOURCES = amndmjob_main.c

2009-12-01  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c: Fix for older log entry.
	* perl/Amanda/DB/Catalog.pm: Fix for new totalparts in find_result_t.
	* perl/Amanda/Logfile.pod: Add totalparts.
	* installcheck/Amanda_Logfile.pl: Fix for new totalparts in
					  find_result_t.

2009-12-01  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Changer_single.pl: Fix for not fast searchable.

2009-12-01  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/single.pm: Use except_slot,
					 It is not fast searchable.

2009-12-01  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.h: Keep partnum and totalparts as int.
	* server-src/find.c: Compute totalparts if -1.
	* perl/Amanda/Logfile.swg: Change api.
	* restore-src/amfetchdump.c, restore-src/restore.c,
	  server-src/amcheckdump.pl, server-src/amindexd.c: Use new api.

2009-12-01  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/Makefile.am: Build ndmjob with original tape simulator.
				Build amndmjob with modifier tape simulator.
	* ndmp-src/amndma_tape_simulator.c: The modified tape simulator.
	* ndmp-src/amndmjob_main.c: Main amndmjob program.
	* ndmp-src/ndma_tape_simulator.c: The original tape simulator.

2009-11-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Small fix.

2009-11-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.pl: Fix quote_string use.

2009-11-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Display % done on port-write.
	* device-src/xfer-device.h: New get_part_bytes_written method in
				    XferDestTaperClass.
	* device-src/xfer-dest-taper.c: new
			xfer_dest_taper_get_part_bytes_written function.
	* device-src/xfer-dest-taper-splitter.c: New
			get_part_bytes_written_impl function.
	* perl/Amanda/Taper/Scribe.pm: New get_bytes_written method.
	* perl/Amanda/XferServer.swg: swig
				      xfer_dest_taper_get_part_bytes_written.
	* server-src/taper.pl: Update status file every 5 seconds.
	* perl/Amanda/Xfer.pod: Document get_part_bytes_written.

2009-11-27  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Holding.pl: add one more unary +

2009-11-27  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_IPC_LineProtocol.pl: use , instead
	  of => when the left-hand-side shouldn't be quoted

2009-11-27  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Config.pl installcheck/taper.pl
	  perl/Amanda/Config.swg server-src/amrestore.pl
	  server-src/taper.pl: handle older perls' bad conversions
	  from BigInt to integers or strings

2009-11-27  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Holding.pl installcheck/amrestore.pl:
	  use unary + before the arguments to sort, since perl-5.6's
	  parser gets confused otherwise

2009-11-27  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Taper_Scribe.pl: flatten changer errors
	  to strings, since older perls' Test::More::is_deeply do not
	  handle this well

2009-11-27  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/IPC/LineProtocol.pm: remove per-message callbacks
	  from the constructor, since => quotes its left-hand side
	* installcheck/Amanda_IPC_LineProtocol.pl: don't use per-message
	  callbacks

2009-11-27  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Mock.pm: perl-5.6's abs_path
	  expects the path to point to a directory, not a file

2009-11-27  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_IPC_Binary.pl perl/Amanda/Changer/robot.pm
	  perl/Amanda/IPC/Binary.pod: perl-5.6 does not support use
	  constant with a hash of constants.

2009-11-26  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/*.pl: Remove $action from all function arguments.
	* installcheck/pp-scripts.pl: Fix for new output of amlog-script.
	* perl/Amanda/Application/Zfs.pm: Remove $action from all function
					  arguments.
	* perl/Amanda/Script_App.pm: Set $self->{action}.

2009-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c: Always do data_path exchange.

2009-11-25  Dustin J. Mitchell <dustin@zmanda.com>
	* client-src/calcsize.c: fix check_running_as

2009-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amcheckdump.pl: Fix hang in MainLoop.

2009-11-24  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindexd.c: Reduce logging.

2009-11-23  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/amglue/amglue.swg: Remove %begin section, we don't want to
				  require swig 1.3.39.

2009-11-23  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c: First include "amanda.h".
	* perl/Amanda/Cmdline.swg: include "amanda.h".
	* perl/amglue/amglue.h: include "../config/config.h"
	* perl/amglue/amglue.swg: %begin include ../config/config.h"

2009-11-20  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndml_bstf.c, ndmp-src/ndmlib.h: Use fseeko and ftello.

2009-11-20  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/stream.c common-src/util.c: use g_debug instead
	  of dbprintf

2009-11-20  Jean-Louis Martineau <martineau@zmanda.com>
	* Revert to previous gnulib, keep fseeko, ftello.

2009-11-20  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndmjob_args.c: add "-o test-daemon"
	* ndmp-src/ndma_comm_session.c: add a thread to kill the daemon
	  when stdin closes
	* ndmp-src/ndmjob_main.c ndmp-src/ndmagents.h: change prototype
	* installcheck/Installcheck/Mock.pm: use "-o test-daemon" to
	  automatically kill the daemon when the test finishes

2009-11-19  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amanda.h: Remove define of _LARGE_FILES.
	* ndmp-src/ndmlib.h: Remove define of _LARGE_FILES.

2009-11-19  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/MainLoop.swg perl/Amanda/Xfer.swg: fix refcounting for
	  callback_sv, and hang onto the src through the callback invocation

2009-11-19  Jean-Louis Martineau <martineau@zmanda.com>
	* gnulib/Makefile.am (EXTRA_DIST): Remove regenerate/.regenerate.swp

2009-11-19  Jean-Louis Martineau <martineau@zmanda.com>
	* gnulib/*, config/gnulib/*: Update gnulib
				     Use getopt-gnu instead of getopt
				     Add fseeko and ftello
				     Remove visibility

2009-11-19  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/progs.m4: require swig-1.3.32, as previous versions
	  don't handle empty C strings correctly

2009-11-13  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Device.pod perl/Amanda/Device.swg
	  device-src/device.c device-src/device.h: add is_eom
	* device-src/rait-device.c
	  device-src/s3-device.c device-src/tape-device.c
	  device-src/vfs-device.c device-src/null-device.c: set is_eom
	  and is_eof correctl
	* perl/Amanda/Xfer.pod perl/Amanda/Xfer.swg xfer-src/xmsg.h:
	  add an eom attribute to XMsgs
	* device-src/xfer-dest-taper-splitter.c: set the attribute
	* perl/Amanda/Taper/Scribe.pm: handle EOM separately from !success

2009-11-19  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c, application-src/amstar.c: Print restore
	  and validate command with debug_executing.
	* common-src/util.c: New debug_executing function.
	* common-src/util.h: New debug_executing prototype.

2009-11-18  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/amfetchdump.c: Small memory leak.
	* restore-src/restore.c, restore-src/restore.h: Many change to fix
	  what was broken in previous patch.

2009-11-18  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c,
	  application-src/amstar.c: Fix if none of --disk or --device is set.

2009-11-18  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/tapefile.c: Fix if list_new_tapes return NULL.

2009-11-18  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c, server-src/driver.c,
	  server-src/planner.c: Do sanity check for DIRECT-TCP data-path.

2009-11-18  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c, application-src/ampgsql.pl,
	* application-src/amraw.pl, application-src/amsamba.pl,
	* application-src/amstar.c, application-src/amsuntar.pl,
	* application-src/amzfs-sendrecv.pl, application-src/amzfs-snapshot.pl:
	  They can get either --disk or --device or both.

2009-11-18  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/tapefile.c: New list_new_tapes function.
	* server-src/tapefile.h: Prototype for list_new_tapes function.
	* perl/Amanda/Tapelist.swg: swig of list_new_tapes.

2009-11-18  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndmjob.h, ndmp-src/ndmjob_main.c,
	  ndmp-src/ndmjob_main_util.c: Use g_debug for logging.

2009-11-18  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/directtcp-target.c
	  device-src/directtcp-target.h: Removed files.
	* device-src/device.c,
	  device-src/device.h: New device directtcp api.
	* device-src/directtcp-connection.c,
	  device-src/directtcp-connection.h: directtcp_connection and
	  directtcp_connection_socket object.
	* device-src/Makefile.am: Remove directtcp-target.*
				  Add directtcp-connection.*
	* restore-src/restore.c,
	  restore-src/restore.h: Fix for new device directtcp api.

2009-11-18  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/chunker.c: Fix checking result of full_write.

2009-11-18  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c,
	  common-src/security-util.c: Correctly report write error.

2009-11-13 Dan Locks <dwlocks@zmanda.com>
	*  packaging/deb/control: update to use shlibs:Depends and
	   perl:Depends
	*  packaging/deb/rules: tweak build dirs for clarity, update shlibs
	   invocation, remove unneeded debhelper commands.
	*  packaging/deb/amanda-backup-server.substvars,
	   packaging/deb/amanda-backup-client.substvars: delete. These files
	   are generated at build time

2009-11-13 Dan Locks <dwlocks@zmanda.com>
	*  packaging/deb/buildpkg: delete unused functions, detect and add
	   distro/release tag to version number changelog prior to build

2009-11-12  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Enable DATA-PATH.
	* restore-src/restore.c: Enable DATA-PATH.
	* restore-src/restore.h: Enable DATA-PATH.
	* common-src/amfeatures.c: Add fe_amidxtaped_datapath.
	* common-src/amfeatures.h: Add fe_amidxtaped_datapath
	* common-src/conffile.c: Improve error message.
	* device-src/directtcp-target.h: Improve comment.

2009-11-12  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c, common-src/util.c,
	  server-src/changer.c: Fix memory leak.

2009-11-11  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndma_tape.c: Fix crash.

2009-11-09  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: assume that the filetype and totalparts
	  in the header are set by the caller
	* server-src/taper.pl: set them
	* installcheck/taper.pl: test that on-device headers are correct

2009-11-09  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c: Handle directtcp device.
	* restore-src/restore.h: Handle directtcp device.
	* device-src/directtcp-target.h (read_to_connection): Fix comment.

2009-11-09  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/directtcp-target.c (directtcp_target_listen,
	  directtcp_target_accept): don't assert for !self->in_file or
				    self->access_mode == ACCESS_NULL.

2009-11-06  Dustin J. Mitchell <dustin@zmanda.com>
	* AUTHORS: add Ben Slusky
	* common-src/amcrypt-ossl-asym.sh common-src/amcrypt-ossl.sh: change
	  to UMD license, with Ben's permission

2009-11-05  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup-dump.c, client-src/sendsize.c:
	  Fix compiler error if VXDUMP or VDUMP is defined.

2009-11-05  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: close FILE instead of fd.
	* client-src/selfcheck.c: fix fd leak with app_stderr.

2009-11-05  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c (merge_property, merge_properties):
						 New functions.
	* client-src/client_util.h: New prototypes.
	* common-src/conffile.c (amandaify_property_name): New function.
	* common-src/conffile.h (amandaify_property_name): New prototypes.
	* recover-src/extract_list.c: Call merge_properties, it merge property
	  from amanda header with property set in amrecover.
	  Report the directory property if set.
	* recover-src/set_commands.c: Call amandaify_property_name.

2009-11-03  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/xfer-dest-taper-splitter.c: make disk_cache_thread wait
	  to be un-paused before starting to cache a part
	* xfer-src/dest-null.c: add additional debugging info

2009-11-03  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/Makefile.am device-src/directtcp-target.c
	  device-src/directtcp-target.h: add new DirectTCPTarget interface, for
	  use by devices supporting DirectTCP

2009-11-03  Paul C. Mantz  <pcmantz@zmanda.com>
	* perl/Amanda/Report.pm: added state flags
	* instalcheck/Amanda_Report.pl: tests

2009-11-02  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/testutils.c: fix uninitialized variable, only run one
	  test in non-fork mode

2009-11-02  Dustin J. Mitchell <dustin@zmanda.com>

	* device-src/xfer-dest-taper-splitter.c: eliminate deadlock, take
	  'first_device' and calculate slab size immediately instead of waiting
	  for start_part
	* device-src/xfer-device.h: first_device parameter
	* perl/Amanda/XferServer.swg: swig
	* perl/Amanda/Xfer.pod: docs
	* installcheck/Amanda_Xfer_serveronly.pl: send first_device properly
	* perl/Amanda/Taper/Scribe.pm: send first_device properly

2009-10-30  Satya Ganga <gsat@zmanda.com>
	* application-src/amsuntar.pl: Validate include and exclude lists
	  before using them at restore time.

2009-10-30  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/testutils.c: do not fork if -n is given (aids debugging)

2009-10-29  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/robot.pm: add barcodes to reservations
	* perl/Amanda/Changer.pm: document
	* installcheck/Amanda_Changer_robot.pl: test

2009-10-29  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndml_log.c: use static to eliminate unnecessary global

2009-10-29  Satya Ganga <gsat@zmanda.com>
	* application-src/amgtar.c,application-src/amstar.c: Correct validation
	  of directory property for existence and access.

2009-10-29  Satya Ganga <gsat@zmanda.com>
	* application-src/amsamba.pl: In command line use correct
					application property names

2009-10-29  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendsize.c: Fix error reporting.

2009-10-29  Satya Ganga <gsat@zmanda.com>
	* ndmp-src/ndmos_glib.h: On Solaris platforms create platform specific
				 environment for NDMP

2009-10-28  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (free_property_t): not static.
	* common-src/conffile.h (free_property_t): not static.
	* recover-src/amrecover.c, recover-src/amrecover.h,
	  recover-src/help.c, recover-src/set_commands.c,
	  recover-src/uparse.y,
	  recover-src/uscan.l: New setproperty and listproperty commands.
	* man/xml-source/amrecover.8.xml: Document setproperty and
					  listproperty commands.

2009-10-27  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Application/Zfs.pm: Use diskname for the snapshot name.

2009-10-27  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/Makefile.am common-src/directtcp.h: new file to
	  handle common directtcp-related code
	* perl/amglue/amglue.swg perl/amglue/directtcp.swg: amglue for
	  DirectTCPAddr
	* xfer-src/Makefile.am
	  xfer-src/xfer-element.h: new XFER_MECH_DIRECTTCP_LISTEN
	* xfer-src/source-directtcp-listen.c: new source element
	  implementing it
	* xfer-src/element-glue.c: stubs - no glue yet for the new mech
	* perl/Amanda/Xfer.pod perl/Amanda/Xfer.swg
	  perl/Makefile.am: SWIG new element

2009-10-27  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: Add data-path and directtcp argument to
				    application
	* client-src/selfcheck.c: Check application support the requested
				  data-path
	* client-src/sendsize.c: Check application support the requested
				 data-path
	* common-src/amfeatures.h: Add fe_xml_data_path and
				   fe_xml_directtcp_list.
	* common-src/amfeatures.c: Add fe_xml_data_path and
				   fe_xml_directtcp_list.
	* common-src/amxml.c: Parse <datapath> and <directtcp> tag.
	* common-src/amxml.h (dle_t): Add data_path and directtcp_list.
	* server-src/amcheck.c: Check client accpet datapath and directtcp tag
				in xml.
	* server-src/diskfile.c: Add datapath and directtcp tag
	* server-src/diskfile.h (disk_t): Add directtcp_list.
	* server-src/driver.c: Set dp->directtcp_list.

2009-10-27  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c, application-src/ampgsql.pl,
	  application-src/amraw.pl, application-src/amsamba.pl,
	  application-src/amstar.c, application-src/amsuntar.pl,
	  application-src/amzfs-sendrecv.pl: Handle directory, include-list
	 		and exclude-list inrestore command.
	* man/xml-source/amgtar.8.xml, man/xml-source/ampgsql.8.xml,
	  man/xml-source/amraw.8.xml, man/xml-source/amsamba.8.xml,
	  man/xml-source/amstar.8.xml,
	  man/xml-source/amsuntar.8.xml: Document them.
	* perl/Amanda/Application/Zfs.pm (zfs_set_value): Handle directory.

2009-10-23  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c (backup_support_option): Parse DATA-PATH.
	* client-src/client_util.h (backup_support_option_t): Add data_path_set
	* common-src/conffile.h: (data_path_t): Change for bit value.

2009-10-22  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/xfer-dest-taper-splitter.c: slab_source_prebuffer is
	  now always called with the slab_mutex held; both invocations of
	  the function guarantee this.

2009-10-22  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Device_ndmp.pl: use 127.0.0.1, not localhost
	* installcheck/Installcheck.pm: close SOCK after using it
	* installcheck/Installcheck/Mock.pm: handle kernel bug in getppid()

2009-10-22  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Config.swg: Swig data_path_from_string.
	* server-src/diskfile.c: Add dirrecti-tcp property to application.
	* server-src/diskfile.h (disk_s): Add directtcp.
	* server-src/driver.c: handle DIRECTTCP_PORT reply form taper.
	* server-src/server_util.c (cmdstr): Add "DIRECTTCP-PORT".
	* server-src/server_util.h: Add DIRECTTCP_PORT.
	* server-src/taper.pl: Reply with DIRECTTCP-PORT.

2009-10-22  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/Makefile.am: Add version info in libndmlib and libndmjob.

2009-10-21  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/alloc.c: Increase MAX_VSTRALLOC_ARGS.
	* common-src/conffile.c: Add DATA-PATH config.
	* common-src/conffile.h: Add DATA-PATH config.
	* installcheck/taper.pl: Add AMANDA data-path.
	* perl/Amanda/Config.swg: Add DATA-PATH config.
	* server-src/amadmin.c (disklist_one): print data-path.
	* server-src/diskfile.c: Add dp argument to xml_application.
	* server-src/diskfile.h: New prototype for xml_application.
	* server-src/amcheck.c: Use new xml_application.
	* server-src/amindexd.c: Use new xml_application.
	* server-src/driverio.c: Send data-path to the dumper and taper,
				 Use new xml_application.
	* server-src/dumper.c: Parse data-path, handle DIRECTTCP_DATA_PATH.
	* server-src/planner.c: Use new xml_application.
	* server-src/taper.pl: Parse data-path in PORT-WRITE command.

2009-10-21  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndma_cops_backreco.c, ndmp-src/ndma_ctrl_calls.c,
	  ndmp-src/ndmagents.h, ndmp-src/ndmjob.h,
	  ndmp-src/ndmjob_args.c, ndmp-src/ndmjob_job.c:
		Add '-o tape-tcp=HOST:PORT' option.

2009-10-21  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/Makefile.am ndmp-src/ndma_comm_proxy.c
	  ndmp-src/ndma_comm_session.c ndmp-src/ndmagents.h
	  ndmp-src/ndmp-proxy_main.c: remove ndmp-proxy
	* common-src/ndmp-proxy.c common-src/ndmp-proxy.h
	  common-src/Makefile.am: remove ndmp-proxy.*
	* man/xml-source/amanda.conf.5.xml perl/Amanda/Config.swg
	  common-src/conffile.h common-src/conffile.c: remove ndmp-proxy-port
	* installcheck/Amanda_NDMP.pl installcheck/Makefile.am: remove test
	* perl/Makefile.am perl/Amanda/NDMP.swg perl/Amanda/NDMP.pod: remove
	  module

2009-10-21  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Taper/Scribe.pm: get a device before starting
	  the xfer

2009-10-21  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/Makefile.am (amlib_LTLIBRARIES): Fix order.

2009-10-21  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/Makefile.am: split ndmp-src into libndmjob.la and
	  libndmlib.la
	* ndmp-src/ndml_conn.c: remove calls to libndmjob function
	* device-src/Makefile.am: compile without strict prototypes
	* device-src/ndmp-device.c: build against libndmlib, speaking
	  NDMP natively to the NDMP server instead of via the proxy
	* installcheck/Amanda_Device_ndmp.pl: no need for a proxy

2009-10-21  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/Makefile.am device-src/xfer-dest-taper-splitter.c
	  device-src/xfer-dest-taper.c device-src/xfer-device.h: make
	  XferDestTaper an abstract base class, with XferDestTaperSplitter its
	  only subclass (for now)
	* perl/Amanda/Xfer.swg: SWIG it
	* perl/Amanda/XferServer.swg: SWIG it
	* installcheck/Amanda_Xfer_serveronly.pl: adjust tests
	* perl/Amanda/Taper/Scribe.pm: use subclass

2009-10-20  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Installcheck.pm: $0 in double quote "$0".

2009-10-20  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Device_ndmp.pl: Remove set_pname call.
	* installcheck/Amanda_Logfile.pl: Fix for changed name in log.
	* installcheck/Installcheck.pm: Call set_pname($0) in INIT section.
	* installcheck/amadmin.pl: Remove set_pname call.

2009-10-20  Paul C. Mantz <pcmantz@zmanda.com>
	* server-src/amrmtape.pl: added config override option
	* installcheck/amrmtape.pl: regression test

2009-10-20  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/xfer-dest-taper.c: add detailed debugging
	* perl/Amanda/IPC/LineProtocol.pm: add protocol debugging
	* perl/Amanda/Taper/Scribe.pm: pass debugging flags around
	* server-src/taper.pl: pass debugging flags around

2009-10-20  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/dest-buffer.c: fix Solaris cc compile errors

2009-10-20  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/xfer-element.h xfer-src/Makefile.am xfer-src/dest-buffer.c:
	  new element
	* perl/Amanda/Xfer.pod perl/Amanda/Xfer.swg: SWIG it
	* installcheck/Amanda_Xfer.pl: tests
	* xfer-src/source-pattern.c: fix typo

2009-10-19  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report.pm: error handling for logfile reading.
	* perl/Amanda/Logfile.pod: documentation of open_logfile error
	behavior

2009-10-19  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Makefile.am (full_tests): Add amadmin.
	* installcheck/amadmin.pl: Check diskname matching argument.

2009-10-19  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/match.c: Fix match_word function.

2009-10-16 Dan Locks <dwlocks@zmanda.com>
	*  example/xinetd.amandaclient.in, example/xinetd.amandaserver.in:
	   replace IPv6 with IPv4

2009-10-16  Nikolas Coukouma <atrus@zmanda.com>
	* amar-src/amar.c, amar-src/amar.h, amar-src/amarchiver.c,
	  application-src/amlog-script.pl, application-src/ampgsql.pl,
	  application-src/amraw.pl, application-src/amsamba.pl,
	  application-src/amsuntar.pl, application-src/amzfs-sendrecv.pl,
	  application-src/amzfs-snapshot.pl, application-src/script-email.pl,
	  changer-src/chg-glue.pl, common-src/amaespipe.sh,
	  common-src/amcryptsimple.pl, common-src/amgetconf.pl,
	  common-src/amgpgcrypt.pl, common-src/event-test.c,
	  common-src/glib-util.c, common-src/glib-util.h,
	  common-src/hexencode-test.c, common-src/ipc-binary.c,
	  common-src/ipc-binary.h, common-src/queueing-test.c,
	  common-src/queueing.c, common-src/queueing.h,
	  common-src/quoting-test.c, common-src/semaphore-test.c,
	  common-src/semaphore.c, common-src/semaphore.h,
	  common-src/simpleprng.c, common-src/simpleprng.h,
	  common-src/sockaddr-util.c, common-src/sockaddr-util.h,
	  common-src/testutils.c, common-src/testutils.h,
	  config/automake/scripts.am, config/automake/vars.am,
	  config/macro-archive/docbook-dtd.m4,
	  config/macro-archive/docbook-xslt-min.m4,
	  config/macro-archive/docbook-xslt.m4,
	  config/macro-archive/xsltproc.m4, device-src/amdevcheck.pl,
	  device-src/amtapetype.pl, device-src/device-queueing.c,
	  device-src/device-queueing.h, device-src/device.c,
	  device-src/device.h, device-src/ndmp-device.c,
	  device-src/null-device.c, device-src/property.c,
	  device-src/property.h, device-src/rait-device.c,
	  device-src/s3-device.c, device-src/s3-util.c, device-src/s3-util.h,
	  device-src/s3.c, device-src/s3.h, device-src/tape-aix.c,
	  device-src/tape-device.c, device-src/tape-device.h,
	  device-src/tape-ops.h, device-src/tape-posix.c,
	  device-src/tape-uware.c, device-src/tape-xenix.c,
	  device-src/vfs-device.c, device-src/vfs-test.c,
	  device-src/xfer-dest-device.c, device-src/xfer-dest-taper.c,
	  device-src/xfer-device.h, device-src/xfer-source-device.c,
	  device-src/xfer-source-taper.c, installcheck/Amanda_Archive.pl,
	  installcheck/Amanda_Changer.pl, installcheck/Amanda_Changer_compat.pl,
	  installcheck/Amanda_Changer_disk.pl,
	  installcheck/Amanda_Changer_null.pl,
	  installcheck/Amanda_Changer_rait.pl,
	  installcheck/Amanda_Changer_robot.pl,
	  installcheck/Amanda_Changer_single.pl, installcheck/Amanda_Cmdline.pl,
	  installcheck/Amanda_Config.pl, installcheck/Amanda_DB_Catalog.pl,
	  installcheck/Amanda_Debug.pl, installcheck/Amanda_Device.pl,
	  installcheck/Amanda_Device_ndmp.pl, installcheck/Amanda_Disklist.pl,
	  installcheck/Amanda_Header.pl, installcheck/Amanda_Holding.pl,
	  installcheck/Amanda_IPC_Binary.pl,
	  installcheck/Amanda_IPC_LineProtocol.pl,
	  installcheck/Amanda_Logfile.pl, installcheck/Amanda_MainLoop.pl,
	  installcheck/Amanda_NDMP.pl, installcheck/Amanda_Process.pl,
	  installcheck/Amanda_Report.pl, installcheck/Amanda_Tapelist.pl,
	  installcheck/Amanda_Taper_Scan.pl,
	  installcheck/Amanda_Taper_Scan_traditional.pl,
	  installcheck/Amanda_Taper_Scribe.pl, installcheck/Amanda_Util.pl,
	  installcheck/Amanda_Xfer.pl, installcheck/Amanda_Xfer_serveronly.pl,
	  installcheck/Installcheck.pm,
	  installcheck/Installcheck/Application.pm,
	  installcheck/Installcheck/Changer.pm,
	  installcheck/Installcheck/Config.pm,
	  installcheck/Installcheck/Dumpcache.pm,
	  installcheck/Installcheck/Mock.pm, installcheck/Installcheck/Run.pm,
	  installcheck/_setupcache.pl, installcheck/amarchiver.pl,
	  installcheck/amcheck-device.pl, installcheck/amcheck.pl,
	  installcheck/amcheckdump.pl, installcheck/amdevcheck.pl,
	  installcheck/amdump.pl, installcheck/amfetchdump.pl,
	  installcheck/amgetconf.pl, installcheck/amgtar.pl,
	  installcheck/amlabel.pl, installcheck/ampgsql.pl,
	  installcheck/amraw.pl, installcheck/amreport.pl,
	  installcheck/amrestore.pl, installcheck/amrmtape.pl,
	  installcheck/amservice.pl, installcheck/amstatus.pl,
	  installcheck/amtape.pl, installcheck/amtapetype.pl,
	  installcheck/bigint.pl, installcheck/mock/mtx.pl,
	  installcheck/mock_mtx.pl, installcheck/pp-scripts.pl,
	  installcheck/taper.pl, ndmp-src/ndma_comm_proxy.c,
	  packaging/rpm/amanda.spec, perl/Amanda/Application.pod,
	  perl/Amanda/Application.swg, perl/Amanda/Application/Zfs.pm,
	  perl/Amanda/Archive.pod, perl/Amanda/Archive.swg,
	  perl/Amanda/BigIntCompat.pm, perl/Amanda/Changer.pm,
	  perl/Amanda/Changer/compat.pm, perl/Amanda/Changer/disk.pm,
	  perl/Amanda/Changer/null.pm, perl/Amanda/Changer/rait.pm,
	  perl/Amanda/Changer/robot.pm, perl/Amanda/Changer/single.pm,
	  perl/Amanda/Cmdline.pod, perl/Amanda/Cmdline.swg,
	  perl/Amanda/Config.pod, perl/Amanda/Config.swg,
	  perl/Amanda/Constants.pm.in, perl/Amanda/Debug.pod,
	  perl/Amanda/Debug.swg, perl/Amanda/Device.pod, perl/Amanda/Device.swg,
	  perl/Amanda/Disklist.pod, perl/Amanda/Disklist.swg,
	  perl/Amanda/Header.pod, perl/Amanda/Header.swg,
	  perl/Amanda/Holding.pm, perl/Amanda/IPC/Binary.pod,
	  perl/Amanda/IPC/Binary.swg, perl/Amanda/IPC/LineProtocol.pm,
	  perl/Amanda/Logfile.pod, perl/Amanda/Logfile.swg,
	  perl/Amanda/MainLoop.pod, perl/Amanda/MainLoop.swg,
	  perl/Amanda/NDMP.pod, perl/Amanda/NDMP.swg, perl/Amanda/Paths.pm.in,
	  perl/Amanda/Process.pm, perl/Amanda/Report.pm, perl/Amanda/Script.pm,
	  perl/Amanda/Script_App.pm, perl/Amanda/Tapelist.pod,
	  perl/Amanda/Tapelist.swg, perl/Amanda/Taper/Scan.pm,
	  perl/Amanda/Taper/Scan/traditional.pm, perl/Amanda/Taper/Scribe.pm,
	  perl/Amanda/Tests.pod, perl/Amanda/Tests.swg, perl/Amanda/Util.pod,
	  perl/Amanda/Util.swg, perl/Amanda/Xfer.pod, perl/Amanda/Xfer.swg,
	  perl/Amanda/XferServer.pod, perl/Amanda/XferServer.swg,
	  perl/amglue/amglue.h, perl/amglue/amglue.swg, perl/amglue/bigint.c,
	  perl/amglue/constants.swg, perl/amglue/dumpspecs.swg,
	  perl/amglue/exports.swg, perl/amglue/filehandles.swg,
	  perl/amglue/gerror.c, perl/amglue/ghashtable.c, perl/amglue/glib.swg,
	  perl/amglue/integers.swg, perl/amglue/objwrap.c, perl/amglue/source.c,
	  perl/amglue/xferwrap.c, perl/make_html.pl, server-src/amaddclient.pl,
	  server-src/amcheck-device.pl, server-src/amcheckdump.pl,
	  server-src/amcleanup.pl, server-src/amlabel.pl,
	  server-src/amrestore.pl, server-src/amrmtape.pl,
	  server-src/amserverconfig.pl, server-src/amtape.pl,
	  server-src/amvault.pl, server-src/cmdline.c, server-src/cmdline.h,
	  server-src/taper.pl, server-src/xfer-server.h,
	  server-src/xfer-source-holding.c, xfer-src/amxfer.h,
	  xfer-src/dest-fd.c, xfer-src/dest-null.c, xfer-src/element-glue.c,
	  xfer-src/element-glue.h, xfer-src/filter-process.c,
	  xfer-src/filter-xor.c, xfer-src/source-fd.c,
	  xfer-src/source-pattern.c, xfer-src/source-random.c,
	  xfer-src/xfer-element.c, xfer-src/xfer-element.h,
	  xfer-src/xfer-test.c, xfer-src/xfer.c, xfer-src/xfer.h,
	  xfer-src/xmsg.c, xfer-src/xmsg.h: correct address in copyright headers

2009-10-16  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/hexencode-test.c: avoid compiler warnings and a potential
	  crash on test failure

2009-10-16  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: fix restore.

2009-10-15  Nikolas Coukouma <atrus@zmanda.com>
	* application-src/ampgsql.pl, common-src/Makefile.am,
	  common-src/hexencode-test.c, common-src/util.c, common-src/util.h,
	  installcheck/Amanda_Util.pl, perl/Amanda/Archive.swg,
	  perl/Amanda/Util.pod, perl/Amanda/Util.swg, perl/Makefile.am,
	  perl/amglue/amglue.h, perl/amglue/gerror.c: move URL-style hex encoding
	  and decoding functions into C. SWIG, document, and test them. Also add
	  exception-generating typemap for GErrors.

2009-10-14  Nikolas Coukouma <atrus@zmanda.com>
	* perl/Amanda/Changer.pm: forgot to import function

2009-10-14  Jean-Louis Martineau <martineau@zmanda.com>
	    Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/ndma_comm_proxy.c: Use NDMP_PROXY_CMD_NOOP command.
	* ndmp-src/ndma_tape_simulator.c: Allow rewind mtio command.
	* device-src/ndmp-device.c: Keep track if a device is openned, don't
	  close the connection to the proxy in ndmp_device_finish().
	* installcheck/Amanda_Device_ndmp.pl: More check.
	* installcheck/Installcheck/Mock.pm: tapefile based on pid number.
	* common-src/ndmp-proxy.c: Use NDMP_PROXY_CMD_NOOP.
	* common-src/ndmp-proxy.h: Define NDMP_PROXY_CMD_NOOP.

2009-10-13  Nikolas Coukouma <atrus@zmanda.com>
	* perl/Amanda/Config.pod, perl/Amanda/Config.swg,
	  installcheck/Amanda_Config.pl: SWIG string_to_boolean, document,
	  and test it
	* application-src/ampgsql.pl, perl/Amanda/Changer.pm:
	  use string_to_boolean
	* perl/Amanda/MainLoop.pod: correct spelling

2009-10-09  Jean-Louis Martineau <martineau@zmanda.com>
	Revert previous patch.

2009-10-09  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/alloc.c: Increae to MAX_VSTRALLOC_ARGS to 40.
	* common-src/conffile.c: Add data_path
	* common-src/conffile.h: Add data-path
	* common-src/ndmp-proxy.c: Improve.
	* common-src/ndmp-proxy.h: Improve.
	* device-src/device.c (device_start_dump, device_finish_dump
			       device_write_from_data_path) New method.
	* device-src/device.h (device_start_dump, device_finish_dump
			       device_write_from_data_path) New method.
	* device-src/ndmp-device.c: Improve
	* device-src/xfer-dest-taper.c: data-path
	* device-src/xfer-device.h: data-path
	* ndmp-src/Makefile.am (ndmp_proxy_SOURCES): Add files.
	* ndmp-src/ndma_comm_proxy.c: Improve.
	* ndmp-src/ndma_comm_session.c: #include "ndmjob.h"
	* ndmp-src/ndmjob_main.c: Open debug file.
	* ndmp-src/ndml_log.c: Check for deliver..
	* perl/Amanda/Config.swg: Add data-path
	* perl/Amanda/Device.swg: Add new device api
	* perl/Amanda/Taper/Scribe.pm: data-path
	* perl/Amanda/XferServer.swg: data-path
	* server-src/amadmin.c: print data-path
	* server-src/amcheck.c: data-path and xml_application change
	* server-src/amindexd.c: xml_application change
	* server-src/diskfile.c: new xml_application
	* server-src/diskfile.h: xml_application prototype change.
	* server-src/driver.c: data-path
	* server-src/driverio.c: data-path
	* server-src/driverio.h (taper_device): new global variable.
	* server-src/dumper.c: data-path
	* server-src/planner.c: xml_application change
	* server-src/taper.pl: data-path

2009-10-08  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/IPC/Binary.pod: finish docs

2009-10-08  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/ipc-binary.h common-src/ipc-binary.c: many fixes
	* perl/Makefile.am perl/Amanda/IPC/Binary.swg: perl interface to
	  ipc-binary
	* installcheck/Makefile.am installcheck/Amanda_IPC_Binary.pl: checks
	* perl/Amanda/IPC/Binary.pod: stub documentation
	* perl/Amanda/IPC/LineProtocol.pm: whitespace

2009-10-08  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/ndmp-device.c ndmp-src/ndma_comm_proxy.c
	  ndmp-src/ndmjob_args.c: tweaks suggested by Nikolas Coukouma
	  <atrus@zmanda.com>

2009-10-08  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/ndmp-proxy.c common-src/ndmp-proxy.h: separate use and
	  pass parameters
	* device-src/ndmp-device.c: bugfixes; open and close the conneciton
	  for each service request, to avoid deadlocking the proxy
	* installcheck/Amanda_Device_ndmp.pl: check the NDMP device against the
	  ndmjob tape simulator
	* installcheck/Installcheck/Mock.pm: add run_ndmjob
	* installcheck/Makefile.am: new checks
	* ndmp-src/ndma_comm_proxy.c: formulate the agent string better
	* ndmp-src/ndma_comm_session.c ndmp-src/ndmagents.h: daemon should take a port
	* ndmp-src/ndmjob.h: p_port
	* ndmp-src/ndmjob_args.c: add -p PORT
	* ndmp-src/ndmjob_main.c: use -p PORT
	* ndmp-src/ndmp-proxy_main.c: listen for more than one incoming
	  connection

2009-10-07 Dan Locks <dwlocks@zmanda.com>
	*  packaging/deb/control: add mailx|bsd-mailx (also missing
	   |gnuplot-nox)

2009-10-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c: Fix initialization of xml_app.result.

2009-10-06  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Config.swg common-src/conffile.c common-src/conffile.h:
	  remove ndmp-proxy-log-file and ndmp-proxy-debug-level
	* man/xml-source/amanda.conf.5.xml: document ndmp-proxy-port
	* common-src/ipc-binary.h: don't recommend static allocation
	* common-src/ndmp-proxy.c common-src/ndmp-proxy.h: start the proxy on
	  demand; it will shut down when all of the connections are closed
	* installcheck/Amanda_NDMP.pl: check Amanda::NDMP
	* installcheck/Installcheck.pm: add get_unused_port()
	* installcheck/Makefile.am: new check
	* ndmp-src/Makefile.am ndmp-src/ndma_comm_proxy.c
	  ndmp-src/ndma_comm_session.c ndmp-src/ndmagents.h ndmp-src/ndmjob.h
	  ndmp-src/ndmjob_args.c ndmp-src/ndmjob_job.c ndmp-src/ndmjob_main.c
	  ndmp-src/ndmjob_main_util.c ndmp-src/ndmp-proxy_main.c: split the NDMP
	  proxy into a different executable, and reference count the connections
	  to it
	* perl/Makefile.am perl/Amanda/NDMP.swg: rename and SWIG the new interface
	* perl/Amanda/NDMP.pod: add POD
	* server-src/amlabel.pl server-src/amcheck-device.pl: remove
	  ndmp_stop_proxy()

2009-10-06  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Reporter.pm: added log handling of amdump and
	amflush
	* installcheck/Amanda_Report.pl: regression tests

2009-10-06  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/amraw.pl: Use File::Path::mkpath.

2009-10-05  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/Makefile.am (SCRIPTS_PERL): Add amraw.
	* application-src/amraw.pl: New application.
	* installcheck/Makefile.am (client_tests): Add amraw.
	* installcheck/amraw.pl: Check amraw functionnality.
	* man/Makefile.am (CLIENT_MAN_PAGES): Add amraw.8.
	* man/xml-source/amanda-applications.7.xml: Add amraw.8.
	* man/xml-source/amanda.8.xml: Add amraw.8.
	* man/xml-source/amraw.8.xml: New man page for amraw application.
	* perl/Amanda/Constants.pm.in: Add DD.

2009-10-05  Paul C. Mantz <pcmantz@zmanda.com>
	* server-src/reporter.c: exit code 0 with no output format
	specified, fixed default output destination

2009-10-02  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/debug.c (msg_timestamp): Print time in human readable
					      format.

2009-10-01  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/ndmp-device.c:  remove some includes, remove recycle and
	  erase, streaming desired, close the tape service on finish(), rewind
	  less, and be more careful about setting errors exactly once
	* man/xml-source/amanda-devices.7.xml: document the device

2009-10-01  Paul C. Mantz <pcmantz@zmanda.com>
	* server-src/reporter.c: no report made unless destination
	argument given

2009-10-01  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c (build_re_table, add_type_table,
				    add_list_table): Remove function.
	* application-src/amstar.c: Use NORNAL, IGNORE and STRANGE properties.
	* client-src/client_util.c (build_re_table, add_type_table,
				   add_list_table): Add function.
	* client-src/client_util.h (build_re_table, add_type_table,
				    add_list_table): Add prototype.
	* client-src/client_util.h (dmpline_t, amregex_t, AM_*_RE):
		Add declaration.
	* client-src/sendbackup.h (dmpline_t, amregex_t, AM_*_RE):
		Remove declaration.
	* client-src/sendsize.c: Rename 'struct regex_s' to
					'struct regex_scale_s'.
	* man/xml-source/amstar.8.xml: Document new NORNAL, IGNORE and STRANGE
				       properties.

2009-10-01  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c (bsd_prefix_packet): Use geteuid login
							  name.

2009-10-01  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Add --no-wildcards argument to gtar extract
				    command.
	* restore-src/amidxtaped.c: Set rst_flags->header_to_fd to -1.

2009-09-30  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/dumper.c: runs setuid root
	* common-src/local-security.c: drop root privs
	* common-src/rsh-security.c: drop root privs
	* common-src/ssh-security.c: drop root privs

2009-09-29  Dustin J. Mitchell <dustin@zmanda.com>
	* amandad-src/amandad.h common-src/amanda.h: move constants
	  to amanda.h
	* common-src/util.c common-src/util.h: add openbsd_fd_inform, to
	  inform the OpenBSD pthread library about high-numbered fd's created
	  by amandad
	* client-src/noop.c client-src/selfcheck.c client-src/sendbackup.c
	  client-src/sendsize.c restore-src/amidxtaped.c server-src/amindexd.c:
	  use openbsd_fd_infom

2009-09-28  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/util.h: fix comment
	* server-src/planner.c: planner runs setuid, so tell check_running_as

2009-09-28  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c: fix day of the week in Date header

2009-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amflock.c: set the return value
	* device-src/xfer-dest-taper.c: lock the slab mutex when prebuffering
	* perl/Amanda/Changer.pm: check for locking errors in Changer.pm
	* perl/Amanda/Changer/robot.pm: handle the lru driveorder better, and
	  handle configurations where no tape device is specified better
	* server-src/amtape.pl: handle the case where loaded_in == 0

2009-09-25  Nikolas Coukouma <atrus@zmanda.com>
	* ndmp-src/ndmlib.h: apply Amanda's "force large file support" to NDMP

2009-09-24  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda-devices.7.xml: fix typo

2009-09-24  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report.pm: added accessor functions
	* installcheck/Amanda_Report.pl: tests

2009-09-24  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/property.c: remove old property instance

2009-09-24  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda-devices.7.xml: update property documentation
	  and rename READ_BUFFER_SIZE to READ_BLOCK_SIZE
	* perl/Amanda/Changer.pm restore-src/restore.c restore-src/restore.h
	  device-src/property.c device-src/property.h device-src/device.c
	  man/xml-source/amanda-changers.7.xml: rename property
	* device-src/tape-device.c: accept old and new property names
	* installcheck/Amanda_Device.pl: tests

2009-09-10  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: accept INCLUDE-LIST, EXCLUDE-LIST, and
	  DIRECTORY properties on restore

2009-09-09  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Device.pl: fix skip count

2009-09-09  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/util.c common-src/util.h: allow to drop root privs
	  entirely
	* common-src/pipespawn.c: drop root
	* amandad-src/amandad.c: check effective userid
	* common-src/krb5-security.c: check effective userid
	* server-src/amcheck.c: check effective userid

2009-09-08  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3-device.c: handle EOT correctly
	* installcheck/Amanda_Device.pl: check for it

2009-09-08  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-glue.pl common-src/amgetconf.pl
	  common-src/conffile.c common-src/conffile.h device-src/amdevcheck.pl
	  device-src/amtapetype.pl installcheck/Amanda_Config.pl
	  installcheck/amcheck-device.pl perl/Amanda/Cmdline.pod
	  perl/Amanda/Config.pod perl/Amanda/Config.swg recover-src/amrecover.c
	  restore-src/amfetchdump.c server-src/amadmin.c
	  server-src/amcheck-device.pl server-src/amcheck.c
	  server-src/amcheckdump.pl server-src/amcleanup.pl server-src/amflush.c
	  server-src/amlabel.pl server-src/amlogroll.c server-src/amrestore.pl
	  server-src/amservice.c server-src/amtape.pl server-src/amtrmidx.c
	  server-src/amtrmlog.c server-src/amvault.pl server-src/chunker.c
	  server-src/driver.c server-src/dumper.c server-src/planner.c
	  server-src/reporter.c server-src/taper.pl: change "config_overwrite"
	  to "config_override"

2009-09-05  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amvault.pl: use destination volume filenums in amvault

2009-09-04  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/util.c: setuid(0) initially, so that we can release
	  and acquire root privs

2009-09-03  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/ndmp-device.c: Include "ndmp-proxy.h".

2009-09-03  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/ipc-binary.c common-src/ipc-binary.h: new, generic
	  binary communication protocol
	* common-src/ipc-binary-test.c: tests for same
	* common-src/ndmp-protocol.h: removed
	* common-src/ndmp-proxy.c common-src/ndmp-proxy.h: code to interact
	  with ndmp-proxy, including protocol
	* common-src/util.c common-src/util.h: remove ndmp-proxy stuff
	* common-src/Makefile.am: rename/add files
	* ndmp-src/ndma_comm_proxy.c ndmp-src/ndma_comm_session.c
	  ndmp-src/ndmagents.h perl/Amanda/Ndmp.swg device-src/ndmp-device.c:
	  use new protocol

2009-09-03  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Header.pl: remove reference to Amanda::Cmdline

2009-09-03  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/ndmp-device.c: remove spurious #include of stream.c

2009-09-02  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/debug.c: Improve debugging.
	* restore-src/restore.h (rst_flags_t): Add header_to_fd.
	* restore-src/amidxtaped.c: set header_to_fd to 1.
	* restore-src/restore.c: Write header to header_to_fd.
	* restore-src/amfetchdump.c: Add --header-fd and --header-file
				     arguments.
	* man/xml-source/amfetchdump.8.xml: Document new --header-fd and
					    --header-file argument.

2009-09-02  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Header.swg: remove spurious references to cmdline.h

2009-09-02  Dustin J. Mitchell <dustin@zmanda.com>
	* ndmp-src/Makefile.am: fix dumb typos

2009-08-31  Dustin J. Mitchell <dustin@zmanda.com
	* ndmp-src/ndmjob_main.c ndmp-src/ndmjob_job.c: don't use fopen64

2009-08-31  Dustin J. Mitchell <dustin@zmanda.com>
	* man/entities/global.entities.in man/xml-source/amadmin.8.xml
	  man/xml-source/amcheck.8.xml man/xml-source/amcheckdump.8.xml
	  man/xml-source/amdevcheck.8.xml man/xml-source/amdump.8.xml
	  man/xml-source/amflush.8.xml man/xml-source/amgetconf.8.xml
	  man/xml-source/amlabel.8.xml man/xml-source/amreport.8.xml
	  man/xml-source/amrestore.8.xml man/xml-source/amservice.8.xml
	  man/xml-source/amtape.8.xml man/xml-source/amtapetype.8.xml
	  man/xml-source/amvault.8.xml: use entities to represent config
	  overwrites consistently

2009-08-31  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Cmdline.swg perl/Amanda/Header.swg: don't depend on
	  cmdline.h in a client-only package
	* perl/Amanda/Cmdline.pod perl/Amanda/Header.pod: adjust docs
	* installcheck/Amanda_Cmdline.pl installcheck/Amanda_Header.pl: adjust
	  tests

2009-08-31 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: add amstar and amgtar to suid section of
	  %files for server.

2009-08-31  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/dumpers.m4: Give only a warning if user specified path
				    is not correct for gtar and star.

2009-08-28  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Device.pod: be explicit: finish_file is not for read
	  mode

2009-08-26  Paul C. Mantz <pcmantz@zmanda.com>
	* xfer-src/filter-process.c: fixed write warnings which were
  	  breaking Ubuntu builds

2009-08-26  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Logfile.swg: added four previously omitted program
	types
	* installcheck/Amanda_Logfile.pl: regression tests for the program
	types

2009-08-26  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/dumpers.m4 (AMANDA_PROG_STAR): New macro to find star.
	* configure.in: Use AMANDA_PROG_STAR.

2009-08-25  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/components.m4: Fix --with-amrecover=yes

2009-08-25  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndmp-protocol.h: Remove file.
	* ndmp-src/Makefile.am (noinst_HEADERS): Remove ndmp-protocol.h.
	* common-src/Makefile.am (noinst_HEADERS): Add ndmp-protocol.h.

2009-08-25  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/ndmp-device.m4: Add AMANDA_NDMP_DEVICE.
	* configure.in: Use AMANDA_NDMP_DEVICE.
	* common-src/conffile.c: Add ndmp_proxy_port, ndmp_proxy_debug_file
				 andndmp_proxy_debug_level.
	* common-src/conffile.h: CNF_NDMP_PROXY_PORT, CNF_NDMP_PROXY_DEBUG_FILE
				 and CNF_NDMP_PROXY_DEBUG_LEVEL
	* common-src/ndmp-protocol.h: Define protocol between amanda and
				      ndmp-proxy.
	* common-src/util.c (start_ndmp_proxy, stop_ndmp_proxy,
			     connect_to_ndmp_proxy): New functions.
	* common-src/util.h: Add prototype for new functions.
	* device-src/Makefile.am: Build ndmp-device.
	* device-src/device.c: Use ndmp-device.
	* device-src/ndmp-device.c: New ndmp device.
	* device-src/tape-device.c: Small fix.
	* ndmp-src/ndma_comm_proxy.c: Convert to network byte order.
	* perl/Amanda/Config.swg: Export new CNF_* constants.
	* perl/Amanda/Ndmp.swg: New module for ndmp function.
	* perl/Amanda/Util.pod: Document Amanda::Util::finish_application.
	* perl/Amanda/Util.swg: New finish_application function.
	* perl/Makefile.am: Build Amanda::Ndmp
	* server-src/amcheck-device.pl, server-src/amlabel.pl: Call
	  stop_ndmp_proxy and finish_application.

2009-08-25  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amfetchdump.8.xml: Document -h option.
	* restore-src/amfetchdump.c: Document -h option, pass the server
				     feature set to search_tapes.

2009-08-24  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Report.pm: Module for abstracting amreport data
	* perl/Makefile.am: compile the module
	* installcheck/Amanda_Report.pl: test for Amanda::Report
	* installcheck/Makefile.am: add the test to installcheck

2009-08-21  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amgtar.8.xml: changes suggested by Christopher
	  <chrismcc@pricegrabber.com>

2009-08-20  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/ndma_comm_proxy.c: include "ipc-protocol.h"
	* ndmp-src/Makefile.am: Link with libamanda
	* ndmp-src/ndmos_glib.h: Use strtoll.

2009-08-20  Jean-Louis Martineau <martineau@zmanda.com>
	* ndmp-src/*: Import of ndmjob + ndmp-proxy.
	* common-src/ndmp-protocol.h: Protocol between amanda and ndmp-proxy.
	* configure.in: AMANDA_PROG_RPCGEN, build ndmp-src.
	* config/amanda/progs.m4: AMANDA_PROG_RPCGEN.
	* config/amanda/components.m4: AMANDA_WITHOUT_NDMP.
	* Makefile.am: Build ndmp-src.

2009-08-20  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ipc-binary.c: New protocol
	* common-src/ipc-binary.h: New protocol header
	* common-src/Makefile.am: Compile it.

2009-08-20  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda-changers.7.xml: Typo.

2009-08-20  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda-devices.7.xml: tweak
	* perl/Amanda/Changer.pm: fix configuration to also include device
	  alias configuration
	* perl/Amanda/Device.pod: deprecate $dev->configure()
	* man/xml-source/amanda-changers.7.xml: better documentation
	  of device configuration via changers

2009-08-18  Dustin J. Mitchell <dustin@zmanda.com>
	* restore-src/Makefile.am restore-src/amrestore.c: remove
	* common-src/fileheader.c common-src/fileheader.h: add
	  summarize_header
	* common-src/match.c: fix match_level bugs
	* installcheck/Amanda_Header.pl: test matches_dumpspecs
	* server-src/Makefile.am server-src/amrestore.pl: new perl version
	* installcheck/amrestore.pl: remove TODO's, don't expect -p to go
	  on to the next dumpfile
	* man/xml-source/amrestore.8.xml: update docs
	* perl/Amanda/Cmdline.pod: typo
	* perl/Amanda/Header.pod perl/Amanda/Header.swg: add summary and
	  matches_dumpspec
	* installcheck/Amanda_Util.pl: test sanitise_filename
	* perl/Amanda/Util.pod: add sanitise_filename

2009-08-18  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/filter-process.c: new xfer element
	* xfer-src/xfer-element.h: declare it
	* perl/Amanda/Xfer.swg: SWIG it
	* perl/Amanda/Xfer.pod: doc it
	* xfer-src/Makefile.am: build it
	* installcheck/Amanda_Xfer.pl: test it

2009-08-18  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Xfer.pod perl/Amanda/Xfer.swg: add a callback argument
	  to start(), and make the get_source method "low-level"
	* perl/Amanda/Taper/Scribe.pm installcheck/Amanda_Xfer.pl
	  installcheck/Amanda_Xfer_serveronly.pl server-src/amvault.pl
	  device-src/amtapetype.pl: don't use get_source
	* perl/Amanda/MainLoop.pod: documentation tweak

2009-08-17  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/compat.pm perl/Amanda/Changer/disk.pm
	  perl/Amanda/Changer/rait.pm perl/Amanda/Changer/robot.pm
	  perl/Amanda/Changer/single.pm: set $self->{'device'} to undef in
	  release()
	* server-src/amcheck-device.pl: fix stupid bug

2009-08-14 Dan Locks <dwlocks@zmanda.com>
	* example/Makefile.am: split example into server and client
	  installperms statements.

2009-08-14  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amlabel.pl: handle error in Amanda::Changer->new

2009-08-14  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amrestore.pl installcheck/Makefile.am: new installcheck
	* installcheck/Installcheck/Dumpcache.pm installcheck/_setupcache.pl:
	  add a 'multi' dumpcache and refactor Dumpcache.pm
	* installcheck/Installcheck/Run.pm: better diagnostics, better access
	  to stderr from successful runs

2009-08-12  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/taper.pl: add a check for taper startup err
	* server-src/taper.pl: properly send a startup err instead of die()ing
	* perl/Amanda/IPC/LineProtocol.pm: fix typos

2009-08-05  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amdevcheck.8.xml: manpage tweaks

2009-08-05 Dan Locks <dwlocks@zmanda.com>
	* Thanks to Jim Barber for pointing out these bugs.
	* packaging/deb/amanda-backup-client.postinst, packaging/deb/rules,
	  packaging/deb/amanda-backup-server.postinst: replace all instances
	  of AMHOMEDIR with AMANDAHOMEDIR, install .am_passphrase 0600.
	* packaging/deb/control: add build-depends for libglib2.0-dev

2009-08-04  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amcheck.pl: fix typo

2009-08-04  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amcheck.pl: put options before args for old getopts
	* installcheck/Makefile.am: only run amcheck check on full install

2009-08-04  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am installcheck/amcheck.pl: new tests
	* server-src/amcheck.c: fix usage message

2009-08-04  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amlabel.pl: do not call exit() from inside a MainLoop callback

2009-08-04  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amcheck.c: initialize success properly
	* installcheck/mock/mtx.pl: another workaround for bad perl parser

2009-08-04  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amlabel.pl: update tests for new messages
	* server-src/Makefile.am server-src/amlabel.c server-src/amlabel.pl:
	  rewrite amlabel in perl to use new changer API
	* man/xml-source/amlabel.8.xml: overhaul manpage
	* perl/Amanda/Util.pod perl/Amanda/Util.swg: add version_opt

2009-08-04  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amlabel.c server-src/amcheck.c: remove include of
	  taperscan.h

2009-08-04  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/Makefile.am server-src/amcheck-device.pl
	  server-src/amcheck.c: break out device-checking into a perl script
	  invoked from amcheck
	* installcheck/Makefile.am installcheck/amcheck-device.pl: check new
	  script
	* perl/Amanda/Taper/Scan/traditional.pm: be willing to overwrite
	  volumes explicitly marked as blank (timestamp="X")
	* server-src/taperscan.c server-src/taperscan.h: remove

2009-08-04  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/device.h: remove some comments that are now redundant
	* perl/Amanda/Device.pod: put primary Device documentation here,
	  centralizing what used to be in the header file and on the wiki

2009-08-04  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Mock.pm: change syntax that perl-5.8.0 finds
	  confusing

2009-08-04  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amlabel.pl installcheck/Makefile.am: new unit tests

2009-08-03  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tape-posix.c: use g_debug instead of dbprintf

2009-08-03  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Taper/Scan/traditional.pm: don't try a particular slot
	  more than once in a scan object's lifetime
	* man/xml-source/amanda-taperscan.7.xml: document this

2009-08-03  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/Makefile.am server-src/amtape.c server-src/amtape.pl:
	  rewrite amtape in perl
	* NEWS: describe changes
	* man/xml-source/amtape.8.xml: document behavior
	* perl/Amanda/Changer.pm perl/Amanda/Changer/compat.pm
	  perl/Amanda/Changer/robot.pm perl/Amanda/MainLoop.swg
	  perl/Amanda/Taper/Scan.pm perl/Amanda/Taper/Scan/traditional.pm: add
	  user_msg_fn
	* installcheck/Amanda_Changer_compat.pl installcheck/amtape.pl: update
	  tests to match new behavior

2009-08-03  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm perl/Amanda/Changer/compat.pm
	  perl/Amanda/Changer/disk.pm perl/Amanda/Changer/rait.pm
	  perl/Amanda/Changer/robot.pm perl/Amanda/Changer/single.pm: add
	  except_slots, to allow slot scanning
	* installcheck/Amanda_Changer_compat.pl
	  installcheck/Amanda_Changer_disk.pl
	  installcheck/Amanda_Changer_rait.pl
	  installcheck/Amanda_Changer_robot.pl: test each implementation

2009-08-03  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am perl/Amanda/Changer/robot.pm:
	  new changer
	* example/amanda.conf.in: adjust to correspond to new changers
	* installcheck/Amanda_Changer_robot.pl installcheck/Makefile.am: tests
	* installcheck/Installcheck/Mock.pm: add $mock_mtx_path
	* man/xml-source/amanda-changers.7.xml: documentation for new changer
	* perl/Amanda/Changer.pm: POD tweak

2009-07-31 Dan Locks <dwlocks@zmanda.com>
	* packaging/deb/control, packaging/rpm/amanda.spec: add native
	  package names to conflict list

2009-07-30 Dan Locks <dwlocks@zmanda.com>
	* example/Makefile.am: separates client from server example,
	  label, and template files.

2009-07-30  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/Makefile.am device-src/xfer-source-taper.c
	  device-src/xfer-device.h: new xfer element
	* device-src/xfer-source-device.c: typos
	* xfer-src/xmsg.h: XMSG_PART_DONE is used by XferSourceTaper, too
	* perl/Amanda/XferServer.swg: SWIG it
	* perl/Amanda/Xfer.pod: docs
	* installcheck/Amanda_Xfer_serveronly.pl: test it

2009-07-30  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsuntar.pl: Fix open of fd3.

2009-07-30  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/xfer-dest-taper.c: open disk cache twice instead of
	  incorrectly relying on dup(); use a local variable to stop the
	  disk cacher for sure at the end of each part

2009-07-29  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm: add an inventory() method
	* perl/Amanda/Changer/disk.pm: implement
	* perl/Amanda/Changer/rait.pm: implement
	* installcheck/Amanda_Changer.pl installcheck/Amanda_Changer_compat.pl
	  installcheck/Amanda_Changer_disk.pl
	  installcheck/Amanda_Changer_rait.pl: test

2009-07-29  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm: do not release() reservations automatically
	  when they go out of scope
	* server-src/amrmtape.pl installcheck/Amanda_Changer.pl
	  installcheck/Amanda_Changer_compat.pl installcheck/Amanda_Changer_disk.pl
	  installcheck/Amanda_Changer_null.pl installcheck/Amanda_Changer_rait.pl
	  installcheck/Amanda_Changer_single.pl: don't depend on auto-release

2009-07-29  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/mock/mtx.pl: mock fixes - count IE slots in 'Slots',
	  shuffle vtapes instead of linking, and support 'nobarcode'
	* installcheck/mock_mtx.pl: test it

2009-07-28  Nikolas Coukouma <atrus@zmanda.com>
	* installcheck/Installcheck.pm: Add a function for including Test::More
	  messages in debug logs (and document it). Move mkpath($TMP) into an
	  INIT block.
	* installcheck/Amanda_Changer.pl, installcheck/Amanda_Changer_compat.pl,
	  installcheck/Amanda_Changer_disk.pl,
	  installcheck/Amanda_Changer_null.pl,
	  installcheck/Amanda_Changer_rait.pl,
	  installcheck/Amanda_Changer_single.pl, installcheck/Amanda_Config.pl,
	  installcheck/Amanda_Debug.pl, installcheck/Amanda_Device.pl,
	  installcheck/Amanda_Header.pl, installcheck/Amanda_Holding.pl,
	  installcheck/Amanda_IPC_LineProtocol.pl,
	  installcheck/Amanda_Process.pl, installcheck/Amanda_Taper_Scan.pl,
	  installcheck/Amanda_Taper_Scan_traditional.pl,
	  installcheck/Amanda_Taper_Scribe.pl, installcheck/Amanda_Xfer.pl,
	  installcheck/Amanda_Xfer_serveronly.pl,
	  installcheck/amrmtape.pl, installcheck/amtape.pl,
	  installcheck/taper.pl: use Installcheck::log_test_output()

2009-07-27  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm: add a get_boolean_property helper method

2009-07-27  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/defaults.m4: remove --with-changer-device
	* common-src/conffile.c: make NULL the default
	* example/amanda.conf.in: remove reference to the default
	* NEWS: note that option is no longer available

2009-07-27  Dustin J. Mitchell <dustin@zmanda.com>
	* config/automake/scripts.am: remove the CHECK_FOO vs. SCRIPTS_FOO
	  variables, and just syntax-check everything
	* amar-src/Makefile.am application-src/Makefile.am
	  changer-src/Makefile.am client-src/Makefile.am common-src/Makefile.am
	  device-src/Makefile.am installcheck/Makefile.am xfer-src/Makefile.am:
	  adjust makefiles to match
	* perl/Amanda/Changer/rait.pm: fix some warnings

2009-07-24  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Fix fd allocation.

2009-07-21 Dan Locks <dwlocks@zmanda.com>
	* example/Makefile.am: add missing trailing slash

2009-07-18  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/taper.pl: one more check for the taper's DONE

2009-07-17  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/taper.pl: add a check for the taper's DONE

2009-07-17  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/xfer-source-holding.c: fix a race condition with
	  self->dest_taper

2009-07-17  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/Makefile.am: fix to distribute taper.pl

2009-07-17  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Taper_Scribe.pl: fix test

2009-07-17  Nikolas Coukouma <atrus@zmanda.com>
	* installcheck/taper.pl: remove cruft
	* server-src/Makefile.am: remove cruft
	* server-src/taper.pl: fix copyright statement

2009-07-17  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/taper.pl: new taper (in perl)
	* installcheck/taper.pl: update tests
	* server-src/Makefile.am server-src/taper-disk-port-source.c
	  server-src/taper-disk-port-source.h server-src/taper-file-source.c
	  server-src/taper-file-source.h server-src/taper-mem-port-source.c
	  server-src/taper-mem-port-source.h server-src/taper-port-source.c
	  server-src/taper-port-source.h server-src/taper-source-test.c
	  server-src/taper-source.c server-src/taper-source.h
	  server-src/taper.c: deleted

2009-07-17  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am perl/Amanda/Taper/Scribe.pm: new package
	* installcheck/Makefile.am installcheck/Amanda_Taper_Scribe.pl: tests

2009-07-16  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/diskfile.c: add missing _()

2009-07-16  Dustin J. Mitchell <dustin@zmanda.com>
	* man/Makefile.am man/xml-source/amanda.8.xml
	  man/xml-source/amanda-compatibility.7.xml: add new manpage describing
	  inter-version compatibility
	* man/xml-source/amanda-taperscan.7.xml: fix use of &A;

2009-07-16  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-lib.sh.in: Fix MESSAGE parsing for Solaris sed.

2009-07-15  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm perl/Amanda/Changer/compat.pm
	  perl/Amanda/Changer/disk.pm perl/Amanda/Changer/null.pm
	  perl/Amanda/Changer/rait.pm perl/Amanda/Changer/single.pm:
	  remove $res->{'next_slot'} in favor of $chg->load(relative_slot
	  => 'next', slot => $slot)
	* perl/Amanda/Taper/Scan/traditional.pm changer-src/chg-glue.pl
	  server-src/amvault.pl: use new form
	* installcheck/Amanda_Changer.pl installcheck/Amanda_Changer_compat.pl
	  installcheck/Amanda_Changer_disk.pl
	  installcheck/Amanda_Changer_rait.pl: test it

2009-07-15  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.h common-src/conffile.c: remove 'rawtapedev'
	* NEWS: describe removed keyword
	* installcheck/Amanda_Config.pl: don't test for it anymore

2009-07-15  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm: new with_locked_state method to help
	  subclasses access a locked statefile
	* installcheck/Amanda_Changer.pl: test new method
	* perl/Amanda/Changer/disk.pm: use new method

2009-07-15  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amflock.h common-src/amflock.c: new fcntl-based
	  file locking support
	* common-src/amflock-test.c: test them
	* perl/Amanda/Util.pod perl/Amanda/Util.swg: SWIG them
	* installcheck/Amanda_Util.pl: test that too

2009-07-15  Dustin J. Mitchell <dustin@zmanda.com>
	* gnulib/regenerate/regenerate: add ftruncate and lseek modules
	* config/config.rpath config/gnulib/* gnulib/*: new modules

2009-07-14  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/DB/Catalog.pm: sort numeric values numerically
	* installcheck/Amanda_DB_Catalog.pl: test same

2009-07-14  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driverio.c: Print strerror if update of infofile failed.

2009-07-14  Jean-Louis Martineau <martineau@zmanda.com>
 	* config/automake/scripts.am: Fix *.nouselib creation.

2009-07-13  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm: use 'relative_slot' for 'next' and 'current'
	* perl/Amanda/Changer/compat.pm perl/Amanda/Changer/disk.pm
	  perl/Amanda/Changer/rait.pm perl/Amanda/Taper/Scan/traditional.pm:
	  implement
	* changer-src/chg-glue.pl installcheck/Amanda_Changer.pl
	  installcheck/Amanda_Changer_compat.pl
	  installcheck/Amanda_Changer_disk.pl
	  installcheck/Amanda_Changer_null.pl
	  installcheck/Amanda_Changer_rait.pl
	  installcheck/Amanda_Changer_single.pl
	  server-src/amvault.pl: use new key

2009-07-13  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: Fix parsing domain in amandapass.

2009-07-11  Dustin J. Mitchell <dustin@zmanda.com>
	* example/Makefile.am: fix typo (lbtempl vs. lbltempl)

2009-07-10  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3-device.c: fix calls to erase() before start()
	* installcheck/data/aws-bundle.crt: use a larger certificate bundle
	* installcheck/Amanda_Device.pl: test operations on s3.amazonaws.com
	  with custom certificate bundle, test erase() before start(),
	  try to do more with an invalid certificate bundle

2009-07-10  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in: don't generate all of the example/ files here
	* example/Makefile.am: generate them here
	* example/chg-mcutil.conf.in: removed
	* example/config.site: removed

2009-07-09  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Taper_Scan_traditional.pl: use 'data' symlink
	  instead of 'current', as required by previous change

2009-07-09  Alan Hodgson <ahodgson@simkin.ca>
	* application-src/amgtar.c: add ACLS, SELINUX, and XATTRS properties
	* man/xml-source/amgtar.8.xml: document them

2009-07-09  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/util.c common-src/util.h: add quote_string_always
	* common-src/conffile.c: use it to quote strings on output from config

2009-07-09  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/version.m4: deprecate --with-suffix and AC_DEFINE
	  VERSION_MAJOR, _MINOR, etc.
	* common-src/version.h: remove everything but version_info
	* client-src/versionsuffix.c client-src/Makefile.am: remove
	  versionsuffix app
	* configure.in: remove versuff.c
	* perl/Amanda/Constants.pm.in man/xml-source/amgetconf.8.xml: remove
	  USE_VERSION_SUFFIXES
	* other source files: change version() to VERSION, remove
	  versionsuffix() calls, remove unnecessary #include "version.h",
	  and remove other uses of suffixes

2009-07-09  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/disk.pm: use a symlink named 'data' instead
	 of 'current', so the vtape root works as a device
	* man/xml-source/amanda-changers.7.xml: document

2009-07-09  Dustin J. Mitchell <dustin@zmanda.com>
	* amandad-src/amandad.c: conditionalize UID checks

2009-07-09  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Config.swg perl/Amanda/Config.pod common-src/conffile.c:
	  prefer 'application' and 'script' to 'application-tool' and
	  'script-tool', but accept both
	* common-src/amgetconf.pl: accept both
	* installcheck/Installcheck/Config.pm: add_text()
	* installcheck/Amanda_Config.pl: test changes
	* installcheck/amgetconf.pl: test changes
	* man/xml-source/amanda-client.conf.5.xml: document
	* man/xml-source/amanda.conf.5.xml: document

2009-07-09  Dustin J. Mitchell <dustin@zmanda.com>
	* AUTHORS: update, add notes about contribution licensing

2009-07-06  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-glue.pl: unref the device, in hopes it will
	  close the open file descriptor so that tape devices can be used
	  from the process that invoked chg-glue

2009-07-03  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.8.xml: add link to amanda-taperscan(7)

2009-06-30  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am: change "Scribe.pm" to "Scan.pm"

2009-06-30  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Taper/Scan.pm perl/Amanda/Taper/Scan/traditional.pm
	  perl/Makefile.am: add Perl implementation of the traditional taperscan
	  algorithm
	* installcheck/Amanda_Taper_Scan.pl
	  installcheck/Amanda_Taper_Scan_traditional.pl
	  installcheck/Makefile.am: test
	* perl/Amanda/Changer/disk.pm: test support tweak
	* man/Makefile.am man/xml-source/amanda-taperscan.7.xml: new manpage
	  with a full description of the traditional algo
	* man/xml-source/amanda-changers.7.xml: mention which changers are fast-search

2009-06-30  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/MainLoop.swg: add synchronized()
	* perl/Amanda/MainLoop.pod: document it
	* installcheck/Amanda_MainLoop.pl: test it
	* perl/Amanda/Changer/compat.pm: and use it

2009-06-29  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c, installcheck/Amanda_Device.pl:
	  Don't allow dots in bucket names, for compatability with
	  libcurl built against NSS.

2009-06-29  Nikolas Coukouma <atrus@zmanda.com>
	* Amanda_Device.pl, Makefile.am, data/aws-bundle.crt:
	  Test using a certificate bundle with the S3 device

2009-06-26  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: New ORDER keyword in script section.
	* common-src/conffile.h: New ORDER keyword in script section.
	* man/xml-source/amanda.conf.5.xml: Document ORDER keyword.
	* perl/Amanda/Config.swg: Bing ORDER keyword.
	* application-src/amlog-script.pl: Add --text parameter.
	* installcheck/pp-scripts.pl: Check execution order.

2009-06-26  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/amfetchdump.c, restore-src/amrestore.c,
	  restore-src/restore.c: Add debugging.

2009-06-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amlabel.c: Relabel VOLUME_ERROR tape if -f.

2009-06-19 Dan Locks <dwlocks@zmanda.com>
	* packaging/deb/rules, packaging/rpm/amanda.spec: apply "quiet"
	  changes to packages.

2009-06-19 Dan Locks <dwlocks@zmanda.com>
	* packaging/deb/server/control, packaging/deb/client/control: update
	  depends to list libcurl3 or 4.

2009-06-19  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Tapelist.swg: add tapes at the beginning and be
	  explicit about maintaining tape order with a stable sort
	* perl/Amanda/Tapelist.pod: document it
	* man/xml-source/tapelist.5.xml: manpages too
	* installcheck/Amanda_Tapelist.pl: test it
	* installcheck/Makefile.am: sort alphabetically

2009-06-19  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Util.swg: expose get_fs_usage in perl
	* installcheck/Amanda_Util.pl: test it
	* perl/Amanda/Util.pod: document it

2009-06-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Use the filenum from the PART line.
	                         Keep the filenum of the first part.

2009-06-19  Nikolas Coukouma <atrus@zmanda.com>
	* amar-src/amar.c, amar-src/amar.h, amar-src/amarchiver.c,
	  application-src/amlog-script.pl, application-src/ampgsql.pl,
	  application-src/amsamba.pl, application-src/amsuntar.pl,
	  application-src/amzfs-sendrecv.pl, application-src/amzfs-snapshot.pl,
	  application-src/script-email.pl, changer-src/chg-glue.pl,
	  common-src/amaespipe.sh, common-src/amcryptsimple.pl,
	  common-src/amgetconf.pl, common-src/amgpgcrypt.pl,
	  common-src/event-test.c, common-src/glib-util.c,
	  common-src/glib-util.h, common-src/queueing-test.c,
	  common-src/queueing.c, common-src/queueing.h,
	  common-src/quoting-test.c, common-src/semaphore-test.c,
	  common-src/semaphore.c, common-src/semaphore.h,
	  common-src/simpleprng.c, common-src/simpleprng.h,
	  common-src/sockaddr-util.c, common-src/sockaddr-util.h,
	  common-src/testutils.c, common-src/testutils.h,
	  config/automake/scripts.am, config/automake/vars.am,
	  config/macro-archive/docbook-dtd.m4,
	  config/macro-archive/docbook-xslt-min.m4,
	  config/macro-archive/docbook-xslt.m4,
	  config/macro-archive/xsltproc.m4, device-src/amdevcheck.pl,
	  device-src/amtapetype.pl, device-src/device-queueing.c,
	  device-src/device-queueing.h, device-src/device.c,
	  device-src/device.h, device-src/null-device.c, device-src/property.c,
	  device-src/property.h, device-src/rait-device.c,
	  device-src/s3-device.c, device-src/s3-util.c, device-src/s3-util.h,
	  device-src/s3.c, device-src/s3.h, device-src/tape-aix.c,
	  device-src/tape-device.c, device-src/tape-device.h,
	  device-src/tape-ops.h, device-src/tape-posix.c,
	  device-src/tape-uware.c, device-src/tape-xenix.c,
	  device-src/vfs-device.c, device-src/vfs-test.c,
	  device-src/xfer-dest-device.c, device-src/xfer-dest-taper.c,
	  device-src/xfer-device.h, device-src/xfer-source-device.c,
	  installcheck/Amanda_Archive.pl, installcheck/Amanda_Changer.pl,
	  installcheck/Amanda_Changer_compat.pl,
	  installcheck/Amanda_Changer_disk.pl,
	  installcheck/Amanda_Changer_null.pl,
	  installcheck/Amanda_Changer_rait.pl,
	  installcheck/Amanda_Changer_single.pl, installcheck/Amanda_Cmdline.pl,
	  installcheck/Amanda_Config.pl, installcheck/Amanda_DB_Catalog.pl,
	  installcheck/Amanda_Debug.pl, installcheck/Amanda_Device.pl,
	  installcheck/Amanda_Disklist.pl, installcheck/Amanda_Header.pl,
	  installcheck/Amanda_Holding.pl,
	  installcheck/Amanda_IPC_LineProtocol.pl,
	  installcheck/Amanda_Logfile.pl, installcheck/Amanda_MainLoop.pl,
	  installcheck/Amanda_Process.pl, installcheck/Amanda_Tapelist.pl,
	  installcheck/Amanda_Util.pl, installcheck/Amanda_Xfer.pl,
	  installcheck/Amanda_Xfer_serveronly.pl, installcheck/Installcheck.pm,
	  installcheck/Installcheck/Application.pm,
	  installcheck/Installcheck/Changer.pm,
	  installcheck/Installcheck/Config.pm,
	  installcheck/Installcheck/Dumpcache.pm,
	  installcheck/Installcheck/Mock.pm, installcheck/Installcheck/Run.pm,
	  installcheck/_setupcache.pl, installcheck/amarchiver.pl,
	  installcheck/amcheckdump.pl, installcheck/amdevcheck.pl,
	  installcheck/amdump.pl, installcheck/amfetchdump.pl,
	  installcheck/amgetconf.pl, installcheck/amgtar.pl,
	  installcheck/ampgsql.pl, installcheck/amreport.pl,
	  installcheck/amrmtape.pl, installcheck/amservice.pl,
	  installcheck/amstatus.pl, installcheck/amtape.pl,
	  installcheck/amtapetype.pl, installcheck/bigint.pl,
	  installcheck/mock/mtx.pl, installcheck/mock_mtx.pl,
	  installcheck/pp-scripts.pl, installcheck/taper.pl,
	  perl/Amanda/Application.pod, perl/Amanda/Application.swg,
	  perl/Amanda/Application/Zfs.pm, perl/Amanda/Archive.pod,
	  perl/Amanda/Archive.swg, perl/Amanda/BigIntCompat.pm,
	  perl/Amanda/Changer.pm, perl/Amanda/Changer/compat.pm,
	  perl/Amanda/Changer/disk.pm, perl/Amanda/Changer/null.pm,
	  perl/Amanda/Changer/rait.pm, perl/Amanda/Changer/single.pm,
	  perl/Amanda/Cmdline.pod, perl/Amanda/Cmdline.swg,
	  perl/Amanda/Config.pod, perl/Amanda/Config.swg,
	  perl/Amanda/Constants.pm.in, perl/Amanda/DB/Catalog.pm,
	  perl/Amanda/Debug.pod, perl/Amanda/Debug.swg, perl/Amanda/Device.pod,
	  perl/Amanda/Device.swg, perl/Amanda/Disklist.pod,
	  perl/Amanda/Disklist.swg, perl/Amanda/Header.pod,
	  perl/Amanda/Header.swg, perl/Amanda/Holding.pm,
	  perl/Amanda/IPC/LineProtocol.pm, perl/Amanda/Logfile.pod,
	  perl/Amanda/Logfile.swg, perl/Amanda/MainLoop.pod,
	  perl/Amanda/MainLoop.swg, perl/Amanda/Paths.pm.in,
	  perl/Amanda/Process.pm, perl/Amanda/Script.pm,
	  perl/Amanda/Script_App.pm, perl/Amanda/Tapelist.pod,
	  perl/Amanda/Tapelist.swg, perl/Amanda/Tests.pod,
	  perl/Amanda/Tests.swg, perl/Amanda/Util.pod, perl/Amanda/Util.swg,
	  perl/Amanda/Xfer.pod, perl/Amanda/Xfer.swg,
	  perl/Amanda/XferServer.pod, perl/Amanda/XferServer.swg,
	  perl/amglue/amglue.h, perl/amglue/amglue.swg, perl/amglue/bigint.c,
	  perl/amglue/constants.swg, perl/amglue/dumpspecs.swg,
	  perl/amglue/exports.swg, perl/amglue/filehandles.swg,
	  perl/amglue/ghashtable.c, perl/amglue/glib.swg,
	  perl/amglue/integers.swg, perl/amglue/objwrap.c, perl/amglue/source.c,
	  perl/amglue/xferwrap.c, perl/make_html.pl, server-src/amaddclient.pl,
	  server-src/amcheckdump.pl, server-src/amcleanup.pl,
	  server-src/amrmtape.pl, server-src/amserverconfig.pl,
	  server-src/amvault.pl, server-src/cmdline.c, server-src/cmdline.h,
	  server-src/taper-disk-port-source.c,
	  server-src/taper-disk-port-source.h, server-src/taper-file-source.c,
	  server-src/taper-file-source.h, server-src/taper-mem-port-source.c,
	  server-src/taper-mem-port-source.h, server-src/taper-port-source.c,
	  server-src/taper-port-source.h, server-src/taper-source.c,
	  server-src/taper-source.h, server-src/taperscan.c,
	  server-src/taperscan.h, server-src/xfer-server.h,
	  server-src/xfer-source-holding.c, xfer-src/amxfer.h,
	  xfer-src/dest-fd.c, xfer-src/dest-null.c, xfer-src/element-glue.c,
	  xfer-src/element-glue.h, xfer-src/filter-xor.c, xfer-src/source-fd.c,
	  xfer-src/source-pattern.c, xfer-src/source-random.c,
	  xfer-src/xfer-element.c, xfer-src/xfer-element.h,
	  xfer-src/xfer-test.c, xfer-src/xfer.c, xfer-src/xfer.h,
	  xfer-src/xmsg.c, xfer-src/xmsg.h:
	  update/correct copyright notice years

2009-06-17  Dustin J. Mitchell <dustin@zmanda.com>
	* config/automake/scripts.am: support scripts with subdirs

2009-06-17  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/mock/mtx.pl: new "mock" mtx for testing
	* installcheck/mock_mtx.pl: test the test mtx
	* installcheck/Installcheck/Mock.pm: support for using mtx
	* installcheck/Installcheck/Run.pm: don't apply sbindir if there
	  are any slashes in the app name
	* installcheck/Makefile.am: new files

2009-06-16  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Fix for bump from level 9 to 10.

2009-06-13  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Changer_compat.pl: add test case for concurrent
	  calls to chg-compat's info() (tests the fix committed 2009-06-01)

2009-06-12  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/flags.m4: fix --enable-werror macro

2009-06-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Print how tape_length is computed.

2009-06-12  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Fix for configured with CLIENT_LOGIN=root
	* man/xml-source/amanda-client.conf.5.xml: Typo.
	* man/xml-source/amanda.conf.5.xml: Add ssh_keys.

2009-06-11  Nikolas Coukouma <atrus@zmanda.com>
	* amar-src/amar.c, amar-src/amar.h, amar-src/amarchiver.c,
	  common-src/glib-util.c, common-src/glib-util.h, common-src/queueing.c,
	  common-src/queueing.h, common-src/semaphore-test.c,
	  common-src/semaphore.c, common-src/semaphore.h,
	  config/automake/scripts.am, config/automake/vars.am,
	  device-src/device-queueing.c, device-src/device-queueing.h,
	  device-src/device.c, device-src/device.h, device-src/null-device.c,
	  device-src/property.c, device-src/property.h,
	  device-src/rait-device.c, device-src/s3-device.c,
	  device-src/s3-util.c, device-src/s3-util.h, device-src/s3.c,
	  device-src/s3.h, device-src/tape-aix.c, device-src/tape-device.c,
	  device-src/tape-device.h, device-src/tape-ops.h,
	  device-src/tape-posix.c, device-src/tape-uware.c,
	  device-src/tape-xenix.c, device-src/vfs-device.c,
	  device-src/vfs-test.c, device-src/xfer-dest-device.c,
	  device-src/xfer-dest-taper.c, device-src/xfer-device.h,
	  device-src/xfer-source-device.c, perl/Amanda/Application.pod,
	  perl/Amanda/Application.swg, perl/Amanda/Application/Zfs.pm,
	  perl/Amanda/Archive.pod, perl/Amanda/Archive.swg,
	  perl/Amanda/BigIntCompat.pm, perl/Amanda/Changer.pm,
	  perl/Amanda/Changer/compat.pm, perl/Amanda/Changer/disk.pm,
	  perl/Amanda/Changer/null.pm, perl/Amanda/Changer/rait.pm,
	  perl/Amanda/Changer/single.pm, perl/Amanda/Cmdline.pod,
	  perl/Amanda/Cmdline.swg, perl/Amanda/Config.pod,
	  perl/Amanda/Config.swg, perl/Amanda/Constants.pm.in,
	  perl/Amanda/Debug.pod, perl/Amanda/Debug.swg, perl/Amanda/Device.pod,
	  perl/Amanda/Device.swg, perl/Amanda/Disklist.pod,
	  perl/Amanda/Disklist.swg, perl/Amanda/Header.pod,
	  perl/Amanda/Header.swg, perl/Amanda/Holding.pm,
	  perl/Amanda/IPC/LineProtocol.pm, perl/Amanda/Logfile.pod,
	  perl/Amanda/Logfile.swg, perl/Amanda/MainLoop.pod,
	  perl/Amanda/MainLoop.swg, perl/Amanda/Paths.pm.in,
	  perl/Amanda/Process.pm, perl/Amanda/Script.pm,
	  perl/Amanda/Script_App.pm, perl/Amanda/Tapelist.pod,
	  perl/Amanda/Tapelist.swg, perl/Amanda/Tests.pod,
	  perl/Amanda/Tests.swg, perl/Amanda/Util.pod, perl/Amanda/Util.swg,
	  perl/Amanda/Xfer.pod, perl/Amanda/Xfer.swg,
	  perl/Amanda/XferServer.pod, perl/Amanda/XferServer.swg,
	  perl/amglue/amglue.h, perl/amglue/amglue.swg, perl/amglue/bigint.c,
	  perl/amglue/constants.swg, perl/amglue/dumpspecs.swg,
	  perl/amglue/exports.swg, perl/amglue/filehandles.swg,
	  perl/amglue/ghashtable.c, perl/amglue/glib.swg,
	  perl/amglue/integers.swg, perl/amglue/objwrap.c, perl/amglue/source.c,
	  perl/amglue/xferwrap.c, server-src/taper-disk-port-source.c,
	  server-src/taper-disk-port-source.h, server-src/taper-file-source.c,
	  server-src/taper-file-source.h, server-src/taper-mem-port-source.c,
	  server-src/taper-mem-port-source.h, server-src/taper-port-source.c,
	  server-src/taper-port-source.h, server-src/taper-source.c,
	  server-src/taper-source.h, server-src/xfer-server.h,
	  server-src/xfer-source-holding.c, xfer-src/amxfer.h,
	  xfer-src/dest-fd.c, xfer-src/dest-null.c, xfer-src/element-glue.c,
	  xfer-src/element-glue.h, xfer-src/filter-xor.c, xfer-src/source-fd.c,
	  xfer-src/source-pattern.c, xfer-src/source-random.c,
	  xfer-src/xfer-element.c, xfer-src/xfer-element.h, xfer-src/xfer.c,
	  xfer-src/xfer.h, xfer-src/xmsg.c, xfer-src/xmsg.h:
	  relincense LGPL files under the GPL

2009-06-10  Paul C. Mantz <pcmantz@zmanda.com>
	* perl/Amanda/Application.pod: moved from .swg file
	* perl/Amanda/Application.swg: removed pod documentation
	* perl/Amanda/Archive.pod: moved from .swg file
	* perl/Amanda/Archive.swg: removed pod documentation
	* perl/Amanda/Cmdline.pod: moved from .swg file
	* perl/Amanda/Cmdline.swg: removed pod documentation
	* perl/Amanda/Config.pod: moved from .swg file
	* perl/Amanda/Config.swg: removed pod documentation
	* perl/Amanda/Debug.pod: moved from .swg file
	* perl/Amanda/Debug.swg: removed pod documentation
	* perl/Amanda/Device.pod: moved from .swg file
	* perl/Amanda/Device.swg: removed pod documentation
	* perl/Amanda/Disklist.pod: moved from .swg file
	* perl/Amanda/Disklist.swg: removed pod documentation
	* perl/Amanda/Header.pod: moved from .swg file
	* perl/Amanda/Header.swg: removed pod documentation
	* perl/Amanda/Logfile.pod: moved from .swg file
	* perl/Amanda/Logfile.swg: removed pod documentation
	* perl/Amanda/MainLoop.pod: moved from .swg file
	* perl/Amanda/MainLoop.swg: removed pod documentation
	* perl/Amanda/Tapelist.pod: moved from .swg file
	* perl/Amanda/Tapelist.swg: removed pod documentation
	* perl/Amanda/Tests.pod: moved from .swg file
	* perl/Amanda/Tests.swg: removed pod documentation
	* perl/Amanda/Util.pod: moved from .swg file
	* perl/Amanda/Util.swg: removed pod documentation
	* perl/Amanda/Xfer.pod: moved from .swg file
	* perl/Amanda/Xfer.swg: removed pod documentation
	* perl/Amanda/XferServer.pod: moved from .swg file
	* perl/Amanda/XferServer.swg: removed pod documentation
	* perl/Makefile.am: added pod files to tar dist

2009-06-05  Nikolas Coukouma <atrus@zmanda.com>
	* installcheck/Amanda_Device.pl: test device named just "s3:"

2009-06-03  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/dumpers.m4: fix more quoting, thanks again to Eric
	  Olsen <herolsen@alumni.upenn.edu>

2009-06-03  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/dumpers.m4: fix quoting for shell portability

2009-06-02  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c: retry S3 uploads on DNS failure

2009-06-01  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Config.pm: add remove_param
	* installcheck/Makefile.am installcheck/amtape.pl: new installcheck

2009-06-01  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Header.swg: add :constant tag
	* server-src/amvault.pl: use it

2009-06-01  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3-device.c: start delete at file 1

2009-06-01  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/compat.pm: handle concurrent calls to _get_info

2009-06-01  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_IPC_LineProtocol.pl: make children wait for a
	  message before existing; fixes problems on OS X

2009-05-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindexd.c: fix sscanf.

2009-05-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Print only the first 100 lines in FAiL and
				 STRANGE detail section.

2009-05-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/match.c: Match UNC name diskname.
	* man/xml-source/amanda.8.xml: Document UNC matcher.

2009-05-27  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: Improve error reporting.
	* client-src/sendsize.c: Typo
	* client-src/selfcheck.c: Execute application with --calcsize even if
	                          it not the first estimate.
	* application-src/amgtar.c: Check calcsize binary.
	* application-src/amstar.c: Check calcsize binary.
	* server-src/planner.c: log sendsize error as warning if a server
	                        estimate is available.

2009-05-26  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Set MAX_LEVEL to 399.
	* common-src/amanda.h: Set DUMP_LEVELS to 400.
	* client-src/amandates.h: Remove DUMP_LEVELS.
	* server-src/infofile.h: Remove DUMP_LEVELS
	* server-src/amtrmidx.c: Fix for level with more than one digit.
	* server-src/amindexd.c, server-src/find.c
	  server-src/reporter.c: Use DUMP_LEVELS.

2009-05-25  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/xfer-dest-taper.c: make the pointers, not the objects,
	  volatile

2009-05-25  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/fileheader.c: use %zu for a size_t argument.

2009-05-25  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in: Use AMANDA_WERROR_FLAGS and AMANDA_SWIG_ERROR.
	* perl/Makefile.am: Add AMANDA_SWIG_PERL_CFLAGS to AM_CFLAGS.
	* config/amanda/flags.m4: New AMANDA_WERROR_FLAGS and AMANDA_SWIG_ERROR.

2009-05-24  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am perl/Amanda/IPC/LineProtocol.pm: new package
	* perl/Amanda/Util.swg: add split_quoted_strings
	* common-src/util.c: handle NULL string correctly
	* installcheck/Amanda_IPC_LineProtocol.pl installcheck/Amanda_Util.pl
	  installcheck/Makefile.am: tests for all

2009-05-24  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amservice.pl: call $testconfig->write();

2009-05-24  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/xfer-dest-taper.c: make sure max_slabs >1; improve slab
	  size heuristic; handle the case where extra slabs are still in memory
	  when rewinding a disk-cached part; add 'volatile' and make memory
	  access safer; use a cache directory, not file
	* device-src/xfer-device.h: use a cache directory, not file
	* installcheck/Amanda_Xfer_serveronly.pl: use cache directory
	* perl/Amanda/Xfer.swg: use cache directory
	* perl/Amanda/XferServer.swg: use cache directory

2009-05-23  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/fileheader.c: use %zd for a size_t argument

2009-05-23  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/fileheader.c: don't automatically call dump_fileheader_t
	  in build_header
	* server-src/dumper.c server-src/holding.c server-src/taper.c
	  server-src/chunker.c: add debug messages as necessary

2009-05-23  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/amdevcheck.pl: move from server-src/
	* device-src/Makefile.am server-src/Makefile.am: move script

2009-05-23  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/compat.pm: run a full manual scan on update()
	* installcheck/Amanda_Changer_compat.pl: test it

2009-05-23  Dustin J. Mitchell <dustin@zmanda.com>
	* amandad-src/Makefile.am application-src/Makefile.am
	  oldrecover-src/Makefile.am recover-src/Makefile.am
	  restore-src/Makefile.am: remove LIB_EXTENSION
	* config/amanda/defaults.m4 config/amanda/devprefix.m4
	  config/amanda/dumpers.m4 config/amanda/flags.m4 config/amanda/ipv6.m4
	  config/amanda/lfs.m4 config/amanda/libs.m4 config/amanda/progs.m4
	  config/amanda/ps.m4 config/amanda/swig.m4 config/amanda/syshacks.m4
	  config/amanda/tape.m4 config/amanda/userid.m4 configure.in: use
	  AC_CANONICAL_HOST, rather than AC_CANONICAL_TARGET (which is for
	  compilers!)

2009-05-22  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/amfetchdump.c: Fix sort_needed_tapes_by_write_timestamp.

2009-05-22  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Compatibity with 2.4.2 server.

2009-05-22  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/vfs-device.c: close the tapelabel file after reading it

2009-05-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Fix for 'estimate calcsize server' with older
				client.

2009-05-21  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/queueing.c: set queue_fd->errmsg.
	* restore-src/restore.c: report queue_fd.errmsg
	* server-src/amcheckdump.pl: report $queue_fd->{errmsg}
          Check validation status before reporting status.


2009-05-21  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-zd-mtx.sh: make -search errors non-fatal

2009-05-20  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c: Report error.

2009-05-20  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm: check for tpchanger="" even if getconf_seen
	  is true; same for tapedev

2009-05-20  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/changer.c: revert a change (from 2009-02-20) which caused
	  taperscan to not do a sequential scan if stage one fails

2009-05-20  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm perl/Amanda/Changer/compat.pm
	  perl/Amanda/Changer/disk.pm perl/Amanda/Changer/null.pm
	  perl/Amanda/Changer/rait.pm perl/Amanda/Changer/single.pm:
	  add a fast_search info key
	* installcheck/Amanda_Changer_compat.pl
	  installcheck/Amanda_Changer_disk.pl
	  installcheck/Amanda_Changer_null.pl
	  installcheck/Amanda_Changer_rait.pl
	  installcheck/Amanda_Changer_single.pl: test it
	* changer-src/chg-glue.pl: and use it to reflect searchability to old
	  changer API users

2009-05-20  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm perl/Amanda/Changer/compat.pm
	  perl/Amanda/Changer/disk.pm perl/Amanda/Changer/null.pm
	  perl/Amanda/Changer/rait.pm perl/Amanda/Changer/single.pm:
	  changers return full devices, not just device names, and
	  configure those devices based on device_property parameters
	  specified in 'changer' configuration sections
	* changer-src/chg-glue.pl: return the device_name from the device
	  (thereby losing the config info)
	* perl/Amanda/Config.swg common-src/conffile.c common-src/conffile.h:
	  add changer properties and device_properties
	* installcheck/Amanda_Changer.pl installcheck/Amanda_Changer_compat.pl
	  installcheck/Amanda_Changer_disk.pl
	  installcheck/Amanda_Changer_null.pl
	  installcheck/Amanda_Changer_rait.pl
	  installcheck/Amanda_Changer_single.pl installcheck/Amanda_Config.pl
	  installcheck/amrmtape.pl: test changer changes
	* server-src/amrmtape.pl server-src/amcheckdump.pl: do not instantiate
	  device manually

2009-05-19  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/MainLoop.swg: Solaris doesn't return async_read errors
	* installcheck/Amanda_MainLoop.pl: ..so don't test it

2009-05-19  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am: revert -Werror change - SWIG output is invalid C
	  in many cases

2009-05-19  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add reapply_config_overwrites.
	* common-src/conffile.h: Add prototype of reapply_config_overwrites.
	* perl/Amanda/Config.swg: Add reapply_config_overwrites.
	* recover-src/amrecover.c: Call reapply_config_overwrites.

2009-05-18  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/MainLoop.swg: new high-level call_after,
	  call_on_child_termination, async_read, async_write; POD for new functions; and
	  description of good async style
	* installcheck/Amanda_MainLoop.pl: test new functions
	* perl/amglue/filehandles.swg: use SvIOK

2009-05-18  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am: add -Werror on gcc

2009-05-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Fix crash in amflush.

2009-05-15  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amgtar.8.xml perl/Amanda/Changer.pm
	  perl/Amanda/Changer/compat.pm perl/Amanda/Changer/disk.pm
	  perl/Amanda/Changer/null.pm perl/Amanda/Changer/rait.pm
	  perl/Amanda/Changer/single.pm perl/Amanda/Disklist.swg
	  perl/Amanda/Holding.pm perl/make_html.pl: documentation cleanup

2009-05-15  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck.pm:always create $Installcheck::TMP;
	  package returns 1
	* installcheck/Installcheck/Run.pm: export run_expect
	* installcheck/amarchiver.pl: quote a path

2009-05-15  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/compat.pm: qualify one last debug message

2009-05-15  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/XferServer.swg: include xfer-server.h

2009-05-15  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/debug.c common-src/debug.h: refactor set_logerr
	  and erroutput_type into a more flexible amanda_log_handler system
	* server-src/logfile.c server-src/logfile.h: provide
	  amanda_log_trace_log
	* perl/Amanda/Debug.swg perl/Amanda/Logfile.swg: SWIG it
	* installcheck/Amanda_Debug.pl installcheck/Amanda_Logfile.pl: test it
	* amandad-src/amandad.c application-src/amgtar.c
	  application-src/amstar.c client-src/calcsize.c client-src/selfcheck.c
	  client-src/sendbackup.c client-src/sendsize.c
	  restore-src/amfetchdump.c restore-src/amrestore.c server-src/amadmin.c
	  server-src/amcheck.c server-src/amflush.c server-src/amlabel.c
	  server-src/amlogroll.c server-src/amservice.c server-src/amtape.c
	  server-src/chunker.c server-src/driver.c server-src/dumper.c
	  server-src/planner.c server-src/reporter.c server-src/taper.c: use new
	  system

2009-05-15  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/debug.c: Fix memory leak.

2009-05-13  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/rait.pm: better handling of "ERROR", small
	  refactoring
	* installcheck/Amanda_Changer_rait.pl: update tests to expect it

2009-05-13  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Device.swg: parse string values for properties
	* installcheck/Amanda_Device.pl: test

2009-05-12  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-glue.pl: Fix typo Amanda:Changer::Error

2009-05-08  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Logfile.swg: add log_add
	* installcheck/Amanda_Logfile.pl: test it

2009-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Fix for clnt_decrypt_opt == NULL.

2009-05-07  Chris Hoogendyk <hoogendyk@bio.umass.edu>
	* man/xml-source/amanda-auth.7.xml: explain default for amandahosts
	  "service"

2009-05-07  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/changer.c: remove unused variable

2009-05-07  Dustin J. Mitchell <dustin@zmanda.com>
	    Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/debug.c: do not use a mutex in debug_printf
	* client-src/sendbackup.c common-src/pipespawn.c server-src/changer.c:
	  do not call debug_printf after fork()

2009-05-06  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/taper.c: check for division by zero and don't print 'nan'
	  for kbps
	* installcheck/taper.pl: don't expect 'nan'

2009-05-04  Nikolas Coukouma <atrus@zmanda.com>
	* server-src/amrmtape.pl: try loading disklist before erasing,
	  before amadmin tries (and possibly fails)

2009-05-04  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amdevcheck.8.xml: Document exit code.
	* server-src/amdevcheck.pl: change exit code.

2009-05-04  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am installcheck/taper.pl: new installcheck for
	  taper
	* installcheck/Installcheck/Config.pm: cleanup
	* installcheck/Installcheck/Run.pm: cleanup

2009-05-04  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/taper-mem-port-source.c
	  server-src/taper-disk-port-source.c: continue reading from the port
	  after the cache is exhausted, instead of terminating the part abruptly
	  (which can lead to insertion of spurious zeros into the dumpfile);
	  also remove some unnecessary assertions (g_return_val_if_fail)
	* server-src/taper-file-source.c: use correct unit on part size;
	  correctly calculate estimated number of parts
	* server-src/taper-port-source.c: replace assertion with 'if'

2009-05-04  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amdevcheck.pl: Add '--label' option.
	* man/xml-source/amdevcheck.8.xml: Document '--label' option.

2009-05-04  Nikolas Coukouma <atrus@zmanda.com>
	* application-src/ampgsql.pl: accept gnutar-path option;
	  use absolute path when calling unlink()

2009-05-04  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: do not include a partial part in the size
	  calculation

2009-04-30  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Fix deadlock.

2009-04-30  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c, application-src/amstar.c: Validate if
	  binary not available.

2009-04-30  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amstar.c: Compile pattern once.
	                            Remove a superfluous '\n'.

2009-04-30  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amstar.c: Handle hard link.

2009-04-29  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/changer.c: s/execve/execv

2009-04-29  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/changer.c: Pass command override to chg-glue.
	* changer-src/chg-glue.pl: Parse command override.

2009-04-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c: Fix error reporting in find subcommand.

2009-04-28  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/amrecover.h: Change prototype.
	* recover-src/extract_list.c: merge_path, abort if cd_* failed.
	* recover-src/set_commands.c: Many functions return 0 or 1.

2009-04-28  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsuntar.pl: Fix redirection in validate command.

2009-04-28  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amcheck.8.xml, man/xml-source/amfetchdump.8.xml,
	  man/xml-source/amflush.8.xml,
	  man/xml-source/amrestore.8.xml: Fix order of -o argument.
	* restore-src/amfetchdump.c, restore-src/amrestore.c,
	  server-src/amcheck.c,
	  server-src/amflush.c: Fix order of -o argument in usage function.

2009-04-28  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.8.xml: Document [...] and [!...] in host & disk
				       expression section.

2009-04-28  Nikolas Coukouma <atrus@zmanda.com>
	* application-src/ampgsql.pl: remove checks for PG-DATADIR

2009-04-27  Nikolas Coukouma <atrus@zmanda.com>
	* application-src/ampgsql.pl: lowercase property names when accessing them

2009-04-27  Nikolas Coukouma <atrus@zmanda.com>
	* application-src/ampgsql.pl: fix debug printing of property names,
	  add parent directory checks to selfcheck command,
	  check psql binary path, fix whitespace
	* perl/Amanda/Application.swg: update usage docs
	* installcheck/Installcheck/Application.pm: fix formatting tags
	  remove 'level' argument from selfcheck command
	* installcheck/ampgsql.pl: test selfcheck command a bit

2009-04-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Remove "Usage of fully qualified hostname
	  recommended for Client" warning.

2009-04-27  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: Use device if specified.

2009-04-27  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Fix dbprintf statements.

2009-04-24  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsuntar.pl: Add LANG property.
	* man/xml-source/amsuntar.8.xml: Document LANG property.

2009-04-23  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsuntar.pl: Fix order of $ext_attrib and $ext_header,
	  add strange regex for UTF-8, estimate fail only if an output match
	  an error regex or if an output match nothing.

2009-04-23  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amcheckdump.pl: request tapes manually when using
	  Amanda::Changer::single

2009-04-23  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsuntar.pl: Fix validate command.

2009-04-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheckdump.pl: Wait for an input before reading tape.

2009-04-22  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: Parse username ending with '%'.

2009-04-22  Sam Couter <sam@couter.id.au>
	* changer-src/chg-glue.pl: return a helpful error message when
	  Amanda::Changer->new() fails

2009-04-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Print percentage done when writing to tape.

2009-04-21  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/Makefile.am server-src/xfer-server.h
	  server-src/xfer-source-holding.c: new module reading from holding
	  files
	* perl/Makefile.am perl/Amanda/Xfer.swg perl/Amanda/XferDevice.swg
	  perl/Amanda/XferServer.swg: rename XferDevice to XferServer; add
	  Amanda::Xfer::Source::Holding
	* device-src/xfer-dest-taper.c: make class macros public; ignore
	  cache_inform when part_size == 0
	* device-src/xfer-device.h: xfer-dest-taper class macros
	* xfer-src/amxfer.h: include element-glue.h
	* installcheck/Amanda_Xfer_serveronly.pl: updated tests

2009-04-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c: Typo.

2009-04-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c: Print ", quoting may not be correct".

2009-04-21  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda-devices.7.xml: Add 'FSF_AFTER_FILEMARK'
	  property to 'tape:' driver.
	* device-src/tape-device.c: Add code for new 'FSF_AFTER_FILEMARK'
	  property, set is_eof to FLASE where needed.
	* device-src/tape-device.h: Add fsf_after_filemark to _TapeDevice.
	* device-src/tape-aix.c, device-src/tape-uware.c,
	  device-src/tape-xenix.c, device-src/tape-posix.c: Set default value
	  for FSF_AFTER_FILEMARK.
	* config/amanda/defaults.m4: Find default value for 'FSF_AFTER_FILEMARK'
	  property.
	* xfer-src/dest-null.c: Remove bogus assert.
	* device-src/amtapetype.pl: New -p option to discover driver properties,
	  it can find value for the 'FSF_AFTER_FILEMARK' property.
	* man/xml-source/amtapetype.8.xml: Document -p options

2009-04-20  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendsize.c: Typo
	* server-src/planner.c: Don't log failed estimate message.

2009-04-20  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c: handle EROFS in open.

2009-04-20  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-zd-mtx.sh: Improve error message.

2009-04-20  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tape-device.c: improve error messages on reading/writing

2009-04-17  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/device.c: fix error message for unparsable property
	* installcheck/Amanda_Device.pl: test error message

2009-04-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/cmdline.c: host, disk and timestamp argument are not regex

2009-04-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheckdump.pl: Print 'volume image' if it doesn't match.

2009-04-16  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsuntar.pl: New NORMAL, IGNORE, STRANGE and ERROR
	                               properties.
	* man/xml-source/amsuntar.8.xml: Document them.

2009-04-16  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/MainLoop.swg: get call_later order right, more useful
	  sub names
	* installcheck/Amanda_MainLoop.pl: tests for same

2009-04-16  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheckdump.pl: Fix three typos.

2009-04-16  Nikolas Coukouma <atrus@zmanda.com>
	* server-src/amcheckdump.pl: Print per-image status messages,
	  with detailed error info

2009-04-15  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: Fix parsing of username...

2009-04-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheckdump.pl: Validate image if all part are available.

2009-04-15  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendsize.c: Don't report "can't estimate level" error.

2009-04-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taperscan.c: Make find_brand_new_tape_label return an
	  error message instead of printing it to stderr.  Make scan_read_label
	  use the error message from find_brand_new_tape_label.

2009-04-15  Dustin J. Mitchell <dustin@zmanda.com>
	* restore-src/amfetchdump.c: keep the order of tapes within a
	  particular run of Amanda

2009-04-15  Nikolas Coukouma <atrus@zmanda.com>
	* perl/Amanda/MainLoop.swg: add make_cb to make callbacks easier to use
	  and more pleasant to debug.
	* installcheck/Amanda_Changer.pl,
	  installcheck/Amanda_Changer_compat.pl,
	  installcheck/Amanda_Changer_disk.pl,
	  installcheck/Amanda_Changer_null.pl,
	  installcheck/Amanda_Changer_rait.pl,
	  installcheck/Amanda_Changer_single.pl,
	  perl/Amanda/Changer.pm,
	  perl/Amanda/Changer/compat.pm,
	  perl/Amanda/Changer/disk.pm,
	  perl/Amanda/Changer/null.pm,
	  perl/Amanda/Changer/rait.pm,
	  perl/Amanda/Changer/single.pm,
	  perl/Amanda/MainLoop.swg,
	  server-src/amrmtape.pl,
	  server-src/amvault.pl: use make_cb, expect callbacks to be wrapped in it

2009-04-14  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: Default amandapass file is
	                              CONFIG_DIR/amandapass.

2009-04-14  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Fix inheriting properties.
	* installcheck/Amanda_Config.pl: Test it.

2009-04-14  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Improve error message.

2009-04-14  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Remove spurious debug message.

2009-04-14  Jean-Louis Martineau <martineau@zmanda.com>,
	    Satya Ganga <gsat@zmanda.com>
	* application-src/amzfs-sendrecv.pl: Use complete compress ratio.

2009-04-14  Jean-Louis Martineau <martineau@zmanda.com>,
	    Dustin J. Mitchell <dustin@zmanda.com>
	Bug found by Gene Heskett.
	* server-src/planner.c: Set dp before using it.

2009-04-11  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: Add ALLOW-ANONYMOUS property.
	                              Allow '\' in diskname and amandapass.
	* man/xml-source/amsamba.8.xml: Document ALLOW-ANONYMOUS property.

2009-04-11  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsuntar.pl: Exit gracefully if suntar exit with != 0
	                               Parse hard link in index.
	* server-src/amstatus.pl: Fix amstatus for partial chunker.
	* installcheck/amstatus.pl: Test it.
	* installcheck/Installcheck/Run.pm: export an $exit_code variable.

2009-04-10  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c: fix handling of double-backslash in quoted
	  strings

2009-04-09  Ray Tracer <RayTracer@irc.freenode.net>
	* application-src/amgtar.c: add missing 'break'

2009-04-09  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c: store properties in lower-case
	* perl/Amanda/Config.swg: document data formats for config values
	* installcheck/Amanda_Config.pl: test case-sensitivity

2009-04-09  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/rait-device.c: add rait_device_new_from_children
	* device-src/device.h: prototype
	* perl/Amanda/Device.swg: wrap into perl
	* installcheck/Amanda_Device.pl: test

2009-04-08  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tape-device.c: fix typo to get device_name right

2009-04-08  Nikolas Coukouma <atrus@zmanda.com>, Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda-devices.7.xml: clarify meaning of s3_bucket location

2009-04-08  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/fileheader.c: fix early return if PROGRAM not given
	* perl/Amanda/Disklist.swg: do not free the C disklist
	* perl/Makefile.am perl/Amanda/Holding.pm: new pure-perl package with
	  functionality similar to server-src/holding.[ch]
	* server-src/holding.h: clarify comments
	* installcheck/Amanda_Holding.pl installcheck/Installcheck/Config.pm
	  installcheck/Makefile.am: tests

2009-04-08  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/xfer-dest-taper.c: fix uninitialized-value warnings

2009-04-07  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Xfer_serveronly.pl: unmerged test tweaks

2009-04-07  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/xfer-dest-taper.c: new xfer element to handle splitting
	  dumpfiles over multiple volumes, with retry of failed split parts
	* device-src/Makefile.am: new file
	* device-src/xfer-device.h: new prototype
	* installcheck/Amanda_Xfer_serveronly.pl: new tests
	* installcheck/Installcheck/Run.pm: increase default vtape size
	* perl/Amanda/Xfer.swg: POD for new element
	* perl/Amanda/XferDevice.swg: wrap new element
	* xfer-src/xmsg.h xfer-src/xmsg.c: add XMSG_PART_DONE

2009-04-07  Jean-Louis Martineau <martineau@zmanda.com>
	* client-drc/sendbackup.c: Init result.

2009-04-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper-source.c (default_taper_source_seek_to_part_start):
	  returns FALSE on not splitted dump.
	* server-src/driverio.c: info.last_level should not be set on error
	                 if level >= info.last_level.
	* server-src/driver.c: Rename update_failed_dump_to_tape to
	  update_failed_dump.
	  Call update_failed_dump on failed dump to holding disk.
	* application-src/amgtar.c: Don't update statefile if the backup failed.
	* client-drc/sendbackup.c: Don't update amandates if backup failed.

2009-04-07  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda-changers.7.xml: Document changerfile for
	                                        chg-disk.

2009-04-03  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/compat.pm: always configure devices while
	  scanning
	* server-src/amcheckdump.pl: configure devices returned from the
	  changer

2009-04-03  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: Allow empty username.
	* man/xml-source/amsamba.8.xml: Document empty username and password.

2009-04-03  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Fix isdigit use.

2009-04-03  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: New client_port option.
	* common-src/conffile.h: New client_port option.
	* man/xml-source/amanda-auth.7.xml,
	  man/xml-source/amanda-client.conf.5.xml,
	  man/xml-source/amanda.conf.5.xml: New client_port option.
	* perl/Amanda/Config.swg: Add CNF_CLIENT_PORT and DUMPTYPE_CLIENT_PORT.
	* common-src/bsd-security.c,
	  common-src/bsdtcp-security.c,
	  common-src/bsdudp-security.c: Use client_port option.
	* common-src/security-util.c: New find_port_for_service function.
	* common-src/security-util.h: Prototype for find_port_for_service.
	* installcheck/Amanda_Config.pl: Check reaad_int_or_str function.
	* recover-src/amrecover.c: Remove amindexd_client_get_security_conf.
	* recover-src/extract_list.c: Remove amidxtaped_client_get_security_conf
	* server-src/amadmin.c (disklist_one): Print client_port.
	* server-src/amcheck.c: Fix remote_errors;
	* server-src/diskfile.h (disk_t): Add client_port.
	* server-src/diskfile.c: Set client_port.
	* server-src/driverio.c: Send client_port to dumper.
	* server-src/dumper.c: Parse client_port.
	* server-src/server_util.c: return client_port.

2009-04-03  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3-device.c, installcheck/Amanda_Device.pl:
	  don't require location-compatible name for ignored value

2009-04-03  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: Allow empty password.
	* perl/Amanda/Util.swg: Small fix in skip_quoted_string.
	* installcheck/Amanda_Util.pl: Check skip_quoted_string fix.

2009-04-02  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: prefix error message with "backup failed:"
	  if a dump to holding disk failed.

2009-04-02  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Print a taper status.
	* server-src/taper.c: Quote TAPE-ERROR reply.

2009-04-02  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amsamba.8.xml: clarify "CIFS host" vs. "client"

2009-04-02  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: Typo.

2009-04-01  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3-device.c: always send errors from setup_handle

2009-04-01  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3-device.c: don't clobber errors from setup_handle

2009-04-01  Nikolas Coukouma <atrus@zmanda.com>
	* NEWS: Note change to Amazon S3, add ampgsql

2009-03-31  Jean-Louis Martineau <martineau@zmanda.com>
        * server-src/amcheck.c: Set l on error path.

2009-03-31  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c: don't send empty location constraint,
	  allocate error messages, fix constraint check in case of wildcard
	* installcheck/Amanda_Device.pl: actually test location constraints

2009-03-31  Nikolas Coukouma <atrus@zmanda.com>
	* application-src/ampgsql.pl: add newline to end of index entry

2009-03-31  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: Set $self->{mesgout} before calling
	                              method that use it.

2009-03-31  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/Makefile.am: Remove amgtar_perl.
	* application-src/amgtar_perl.pl: Remove file.

2009-03-30  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amsamba.8.xml: Document amandapass file location.

2009-03-30  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: allow relative AMANDAPASS property.
	* man/xml-source/amsamba.8.xml: Document amandapass file location.
	* ReleaseNotes: amsamba

2009-03-30  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: exit(1) if match_disklist() return an error.
	* server-src/planner.c: Better logging if match_disklist() return an
	                        error.

2009-03-30  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Use new one_est_t,
	                        print warning for server guessed estimate.

2009-03-29 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: change a number of %if conditionals to
	  macros which expand if they are defined.

2009-03-29  Nikolas Coukouma <atrus@zmanda.com>
	* man/xml-source/amanda-devices.7.xml: add more notes

2009-03-27  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c, installcheck/Amanda_Device.pl:
	  ignore s3_bucket_location if set to "", pass "*" as "" (wildcard),
	  pass others as-is

2009-03-27  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Util.pl: fix warning
	* perl/Amanda/Util.swg: fix typos

2009-03-27  Nikolas Coukouma <atrus@zmanda.com>
	* application-src/ampgsql.pl, installcheck/ampgsql.pl:
	  use a different dummy entry

2009-03-27  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Add --level argument to application.

2009-03-27  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsuntar.pl: Check for 'symbolic link' in index.

2009-03-27  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Device.pl: counting Amanda_Device tests is hard.

2009-03-26  Nikolas Coukouma <atrus@zmanda.com>
	* installcheck/Amanda_Device.pl: fix test counts
	* installcheck/Amanda_Util.pl: fix shadow variable warning

2009-03-26  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c: ignore empty s3_user_token
	* installcheck/Amanda_Device.pl: test empty s3_user_token

2009-03-26  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: document new estimate changes made
	  2009-02-04

2009-03-26  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Remove logging of guessed estimate.

2009-03-26  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendsize.c: Typo.

2009-03-25  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/ampgsql.pl: Add command_validate.
	* application-src/amgtar_perl.pl, application-src/amsamba.pl,
	  application-src/amsuntar.pl: Sanity check for command_validate.
	* perl/Amanda/Application.swg: Add a default_validate function.
	* perl/Amanda/Script_App.pm: Execute defulat_validate if
	                             command_validate is not defined.

2009-03-25  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm: add a 'cmp' operator for
	  Amanda::Changer::Error objects, to make testing easier

2009-03-25  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm: add Amanda::Changer::Error
	  class to give more detail in changer errors
	* perl/Amanda/Changer/compat.pm perl/Amanda/Changer/disk.pm
	  perl/Amanda/Changer/null.pm perl/Amanda/Changer/rait.pm
	  perl/Amanda/Changer/single.pm: use it
	* changer-src/chg-glue.pl: handle new errors
	* installcheck/Makefile.am installcheck/Installcheck/Changer.pm:
	  (chg_err_like) utility function
	* installcheck/Amanda_Changer.pl
	  installcheck/Amanda_Changer_compat.pl
	  installcheck/Amanda_Changer_disk.pl
	  installcheck/Amanda_Changer_null.pl
	  installcheck/Amanda_Changer_rait.pl
	  installcheck/Amanda_Changer_single.pl: change tests

2009-03-25  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm: remove unused import() and export()

2009-03-25  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3.c: fix segfault in s3_make_bucket with location
	  constraint

2009-03-25  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Util.swg: add full_read and full_write
	* installcheck/Amanda_Util.pl: test 'em

2009-03-25  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsuntar.pl: Generate valid index stream.

2009-03-24  Nikolas Coukouma <atrus@zmanda.com>
	* man/xml-source/amanda-applications.7.xml,
	  man/xml-source/amanda.8.xml: add missing references to applications

2009-03-24  Nikolas Coukouma <atrus@zmanda.com>
	* application-src/ampgsql.pl: older versions of perl don't like
	  mixing functions and export tags

2009-03-24  Nikolas Coukouma <atrus@zmanda.com>
	* application-src/ampgsql.pl, installcheck/ampgsql.pl:
	  generate more-complete index, improve debugging and error handling

2009-03-24  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Fix line counting, Remove check for plugin.
	* server-src/diskfile.c: Add check for plugin.

2009-03-24  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Default server estimate not larger than half
	                        a tape. log a warning.

2009-03-24  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amsamba.pl: Fix typo and check if smbclient is set.

2009-03-24  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c, application-src/amstar.c:
	  Do sanity check if required arguments are not provided.

2009-03-23  Nikolas Coukouma <atrus@zmanda.com>
	* AUTHORS: remove "active" status if not committed in over 2 years
	* ChangeLog: clean up some messiness
	* contrib/changelog_parse.pl: simple parser for ChangeLog

2009-03-23  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Add NO-UNQUOTE to restore.

2009-03-23  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c, application-src/amgtar_perl.pl,
	  client-src/sendbackup-gnutar.c, client-src/sendsize.c,
	  recover-src/extract_list.c: Undo: '--no-unquote' to gtar arguments.
	* application-src/amgtar.c: add NO-UNQUOTE property.
	* man/xml-source/amgtar.8.xml: Document NO-UNQUOTE property.

2009-03-23  Nikolas Coukouma <atrus@zmanda.com>
	* application-src/ampgsql.pl, installcheck/ampgsql.pl:
	  fix ampgsql installchecks

2009-03-23  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c, application-src/amgtar_perl.pl,
	  client-src/sendbackup-gnutar.c, client-src/sendsize.c,
	  recover-src/extract_list.c: Add '--no-unquote' to gtar arguments.

2009-03-23  Jean-Louis Martineau <martineau@zmanda.com>
        * application-src/amgtar.c, application-src/amstar.c,
          client-src/client_util.c, client-src/client_util.h,
          client-src/selfcheck.c, client-src/sendbackup-gnutar.c,
          client-src/sendbackup.c, client-src/sendsize.c,
	  common-src/conffile.c, common-src/conffile.h,
	  common-src/util.c, oldrecover-src/extract_list.c,
	  recover-src/extract_list.c,
          server-src/server_util.c: Use GPtrArray instead of my_argv[].

2009-03-23  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml, man/xml-source/disklist.5.xml:
	  Document the fact that: The { must appear at the end of a line,
	                          and the } on its own line.

2009-03-21  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Fix sec_tcp_conn_get ot not always match.

2009-03-20  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/Makefile.am: Add dependencies for uscan.o and uparse.o
	* recover-src/amrecover.h: Add verbose to many prototype.
	* recover-src/extract_list.c: Allow to use path for many command.
	* recover-src/set_commands.c: Add verbose to many function.
	* recover-src/uparse.y, recover-src/uscan.l: Improve parser.

2009-03-19  Dustin J. Mitchell <dustin@zmanda.com>
	(thanks to Peter Kunst <peter.kunst@swissrisk.com>)
	* common-src/Makefile.am: don't include genversion.h in distribution
	  tarballs

2009-03-19  Jean-Louis Martineau <martineau@zmanda.com>
	* man/Makefile.am: Add .SECONDARY target.

2009-03-19  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xslt/expand-sambadoc.xsl:
	* man/entities/global.entities.in
	  man/xml-source/*.xml: add a handy <manref> tag and a <seealso> tag
	  for 'SEE ALSO' sections
	* man/xml-source/amanda.conf.5.xml: remove bogus unicode "times"
	  symbol; tweak tapecycle description

2009-03-19  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/Makefile.am: add -release to libamxfer

2009-03-18  Nikolas Coukouma <atrus@zmanda.com>
	* server-src/amrmtape.pl, installcheck/amrmtape.pl:
	  re-label tapes if we --erase them and --keep-label is present

2009-03-18  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Process.pl: Fix for OS return perl.

2009-03-18  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Process.pm: Better match of argument.
	                          Match 'perl' to any process name.

2009-03-18  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Amanda_Process.pl: Check second argument if first
	                                  argument start with a dash.
	* perl/Amanda/Process.pm: The process name is now returned, not perl.

2009-03-18  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amrmtape.8.xml: Fix.
	* perl/Amanda/Process.pm: Find the process name if it is a perl script.
	* server-src/amrmtape.pl: Check and create the "log" file if --erase.

2009-03-18  Nikolas Coukouma <atrus@zmanda.com>
	* application-src/ampgsql.pl: fix numerous bugs, improve debug info

2009-03-17  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: fix typo causing check-device to be
	  interpreted incorrectly

2009-03-17  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm: introduce info_key and info_setup to ease
	  implementation of the info() method
	* perl/Amanda/Changer/compat.pm perl/Amanda/Changer/disk.pm
	  perl/Amanda/Changer/null.pm perl/Amanda/Changer/rait.pm
	  perl/Amanda/Changer/single.pm: use them
	* installcheck/Amanda_Changer.pl installcheck/Amanda_Changer_rait.pl:
	  test the results

2009-03-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amlabel.c: give correct exit status on failure

2009-03-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: dump in "writing to tape" mode should also
	                          be included in the "dumped" summary.

2009-03-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c: Fix listing of partial dump in holding disk.

2009-03-12  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/amreport.pl: New file.

2009-03-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/columnar.c: New defaults, allow precision to be set.
	* man/xml-source/amanda.conf.5.xml: Document new columnspec format.
	* installcheck/Installcheck/Config.pm: Always set org to "DailySet1".
	* installcheck/Makefile.am: add amreport.
	* installcheck/amreport.pl: Check different value of columnspec.
	* installcheck/Amanda_Config.pl: Check with dumporder instead of org.

2009-03-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Log quoted qname.

2009-03-11  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/amtapetype.pl: do not produce broken 'bytes' units
	* installcheck/amtapetype.pl: test changes
	* man/xml-source/amanda.conf.5.xml: tapetype:length is not in bytes!
	* common-src/conffile.c: fix default for tapetype:length

2009-03-11  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amfeatures.c: improve error handling in
	  am_string_to_feature, return NULL on error
	* amandad-src/amandad_util.c recover-src/amrecover.c
	  server-src/amcheck.c server-src/amindexd.c server-src/chunker.c
	  server-src/driver.c server-src/dumper.c server-src/planner.c: always
	  terminate the string passed to am_string_to_feature

2009-03-10  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: return DONE if input file is partial.

2009-03-10  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c, application-src/amstar.c: Validate YES/NO
	  value for boolean properties.

2009-03-10  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Print "failed: process terminated while" for
				  dead run. Change "wait for" for "waiting for".

2009-03-10  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amstar.c: ONE-FILE-SYSTEM is deprecated.
	* man/xml-source/amstar.8.xml: Document it.

2009-03-10  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c: Set default TAPETYPE_FILEMARK to 1.

2009-03-09  Nikolas Coukouma <atrus@zmanda.com>
	* man/xslt/html.xsl.in: use UTF-8 when generating man page HTML

2009-03-09  Nikolas Coukouma <atrus@zmanda.com>
	* application-src/ampgsql.pl:
	  set environment variables when running psql (from selfcheck)

2009-03-07  Nikolas Coukouma <atrus@zmanda.com>
	* application-src/ampgsql.pl: add selfcheck to ampgsql

2009-03-06  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/rait.pm: replace die() with a proper error
	  return

2009-03-06  Dustin J. Mitchell <dustin@zmanda.com>
	* Makefile.am config/libtool.m4 config/ltmain.sh config/ltoptions.m4
	  config/ltsugar.m4 config/ltversion.m4 config/lt~obsolete.m4
	  configure.in: upgrade to libtool-2.2.4

2009-03-06  Dustin J. Mitchell <dustin@zmanda.com>
	* restore-src/restore.c: remove incorrect assertion

2009-03-06  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amfeatures.c: fix am_string_to_feature to fail correctly
	  on a bad feature string

2009-03-06  Dustin J. Mitchell <dustin@zmanda.com>
	* Makefile.am: always build xfer-src, on client or server
	* xfer-src/Makefile.am xfer-src/xfer-element.h device-src/Makefile.am
	  device-src/xfer-device.h device-src/xfer-dest-device.c
	  device-src/xfer-source-device.c: move device-specific xfer elts to
	  device-src
	* perl/amglue/amglue.h perl/amglue/objwrap.c perl/amglue/xferwrap.c:
	  generic glue
	* perl/Makefile.am perl/Amanda/Xfer.swg perl/Amanda/XferDevice.swg:
	  only import server-specific symbols if they are available
	* installcheck/Makefile.am installcheck/Amanda_Xfer.pl
	  installcheck/Amanda_Xfer_serveronly.pl: split into general and
	  server-specific checks

2009-03-05  Nikolas Coukouma <atrus@zmanda.com>
	* application-src/ampgsql.pl: use older-style (<perl 5.10) mkpath
	  options so we don't print "mkdir ..." lines into our backup data

2009-03-05  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Device.pl: only perform property tests when we
	  have a working S3 device; and get test counts right

2009-03-05  Dustin J. Mitchell <dustin@zmanda.com>, Nikolas Coukouma <atrus@zmanda.com>
	* man/xml-source/amanda.conf.5.xml,
	  man/xml-source/amanda-devices.7.xml,
	  installcheck/Amanda_Config.pl,
	  installcheck/Amanda_Device.pl,
	  common-src/util.c,
	  common-src/glib-util.c,
	  common-src/conffile.c,
	  common-src/conffile.h:
	  be consistent in the various names for 'true' and 'false' we allow,
	  specifically in device properties

2009-03-05  Nikolas Coukouma <atrus@zmanda.com>
	* application-src/ampgsql.pl: call pg_stop_backup() if a problem occurs
	  while backing up data dir

2009-03-05  Nikolas Coukouma <atrus@zmanda.com>
	* application-src/ampgsql.pl, man/xml-source/ampgsql.8.xml:
	  make ampgsql use runtar (so it can access PostgreSQL's files)

2009-03-04  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/rait.pm: add a slot-name shorthand
	* installcheck/Amanda_Changer_rait.pl: test it
	* man/xml-source/amanda-changers.7.xml: document it

2009-03-04  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/rait-device.c: fix failure when parity (last) child
	  has failed
	* installcheck/Amanda_Device.pl: test the fix

2009-03-04  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-glue.pl: add debugging
	* perl/Amanda/Changer/compat.pm: add debugging

2009-03-03  Nikolas Coukouma <atrus@zmanda.com>
	* application-src/ampgsql.pl: don't hang if .backup file never appears

2009-03-02  Nikolas Coukouma <atrus@zmanda.com>
	* example/amanda-client-postgresql.conf.in:
	  update example and make it more complete

2009-03-02  Nikolas Coukouma <atrus@zmanda.com>
	* application-src/ampgsql.pl,
	  man/xml-source/ampgsql.8.xml: cleanup old WAL files

2009-03-02  Nikolas Coukouma <atrus@zmanda.com>
	* installcheck/amrmtape.pl,
	  server-src/amrmtape.pl: zero datestamp with --keep-label

2009-03-01  Nikolas Coukouma <atrus@zmanda.com>
	* server-src/amrmtape.pl: send messages to log file regardless of verbosity flag

2009-02-27  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Fix parsing of EXIT-HANDLING property.

2009-02-27  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Constants.pm.in: publish $MT and $MTX, too

2009-02-26  Dustin J. Mitchell <dustin@zmanda.com>
	* restore-src/restore.c: if the changer does not provide a device,
	  use the configured tapedev

2009-02-26  Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: update detection for sles11, opensuse11.1
	  rpm builds will be broken for a bit longer in trunk

2009-02-26  Nikolas Coukouma <atrus@zmanda.com>
	* application-src/amgtar_perl.pl,
          application-src/amlog-script.pl,
          application-src/ampgsql.pl,
          application-src/amsamba.pl,
          application-src/amsuntar.pl,
          application-src/amzfs-sendrecv.pl,
          application-src/amzfs-snapshot.pl,
          application-src/script-email.pl,
          perl/Amanda/Application.swg,
          perl/Amanda/Script.pm,
          perl/Amanda/Script_App.pm:
	  load config-name/amanda-client.conf as well as amanda-client.conf

2009-02-26  Nikolas Coukouma <atrus@zmanda.com>
	* application-src/ampgsql.pl,
	  installcheck/amgtar.pl,
	  installcheck/ampgsql.pl: use $@ to get eval errors (not $!)

2009-02-25  Nikolas Coukouma <atrus@zmanda.com>
	* application-src/amoracle.pl,
	  application-src/ampgsql.pl,
	  example/amanda-client-oracle.conf.in,
	  example/amanda-client-postgresql.conf.in,
	  installcheck/ampgsql.pl,
	  man/xml-source/ampgsql.8.xml: bring amoracle and ampgsql properties
	  in line with conventions

2009-02-24  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c, application-src/amgtar.c,
	  changer-src/scsi-changer-driver.c, client-src/client_util.c,
	  common-src/conffile.c, device-src/s3-device.c,
	  oldrecover-src/set_commands.c, recover-src/set_commands.c,
	  server-src/amindexd.c, server-src/planner.c,
	  server-src/reporter.c: Replace all occurences of index by strchr,
	                         Replace all occurences of rindex by strrchr.

2009-02-24  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c: make s3_list_keys use its own buffer

2009-02-24  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c: fix error buffer handling of overflow data

2009-02-24  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda-devices.7.xml: specify behavior of VERBOSE
	  property

2009-02-24  Nikolas Coukouma <atrus@zmanda.com>
	* man/xml-source/ampgsql.8.xml,
	  man/xml-source/amsamba.8.xml,
	  man/xml-source/amstar.8.xml,
	  man/xml-source/amsuntar.8.xml:
	  document the mapping of configure options to default application
	  property values

2009-02-23  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/rait-device.c: actually *report* mismatched child
	  labels/timestamps; correctly detect the 'first' device; and free old
	  device label/time

2009-02-23  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/driver.c: improve confusing out-of-tapes error message

2009-02-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/changer.c: if changer_find is used to search for a
	  specific tape, do not try a redundant manual scan after the
	  search fails

2009-02-20  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Run.pm: create a purpose-specific 'junk'
	  directory to test dumps

2009-02-20  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Archive.pl installcheck/Amanda_Changer_compat.pl
	  installcheck/Amanda_Changer_disk.pl
	  installcheck/Amanda_Changer_rait.pl installcheck/Amanda_Device.pl
	  installcheck/Amanda_Logfile.pl installcheck/Amanda_Process.pl
	  installcheck/Amanda_Xfer.pl installcheck/Installcheck.pm
	  installcheck/Installcheck/Config.pm
	  installcheck/Installcheck/Dumpcache.pm
	  installcheck/Installcheck/Run.pm installcheck/Makefile.am
	  installcheck/amarchiver.pl installcheck/amfetchdump.pl
	  installcheck/amgetconf.pl installcheck/amgtar.pl
	  installcheck/ampgsql.pl installcheck/amservice.pl
	  installcheck/amstatus.pl installcheck/pp-scripts.pl: use a
	  subdirectory of AMANDA_TMPDIR for installcheck temporary files

2009-02-20  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_MainLoop.pl: report "timeout" on a timeout
	* amar-src/amar-test.c common-src/amflock-test.c
	  common-src/event-test.c common-src/queueing-test.c
	  common-src/quoting-test.c common-src/semaphore-test.c
	  device-src/vfs-test.c xfer-src/xfer-test.c: increase timeouts
	  drastically

2009-02-20  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c: change the default changerfile to
	  $CONFIG_DIR/changer

2009-02-20  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/property.c device-src/property.h: add PROPERTY_COMMENT
	* device-src/device.c: support PROPERTY_COMMENT
	* installcheck/Amanda_Device.pl: test it
	* man/xml-source/amanda-devices.7.xml: document it

2009-02-20  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add t, tb, tera, ... suffix.
	* man/xml-source/amanda.conf.5.xml: Document it.

2009-02-19  Nikolas Coukouma <atrus@zmanda.com>
	* example/amanda-client-postgresql.conf.in,
	  example/Makefile.am,
	  man/Makefile.am,
	  man/xml-source/ampgsql.8.xml,
	  configure.in,
	  application-src/Makefile.am,
	  application-src/ampgsql.pl,
	  installcheck/Makefile.am,
	  installcheck/ampgsql.pl: add PostgreSQL plugin/application (ampgsql)
	* installcheck/Installcheck/Application.pm:
	  fix property names in case of underscores
	* installcheck/Installcheck/Run.pm:
	  if application starts with /, don't assume it's in sbin

2009-02-19  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Util.swg: move POD to the top of the file, refomat

2009-02-19  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/util.h common-src/util.c: remove unneeded needs_quotes

2009-02-19  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Types.pl
	  installcheck/Amanda_Header.pl: rename Amanda::Types to
	  Amanda::Header, add to_string and from_string methods
	* common-src/fileheader.c: fix bug in returned size
	* device-src/amtapetype.pl installcheck/Amanda_Device.pl
	  installcheck/Amanda_Xfer.pl installcheck/Makefile.am
	  perl/Amanda/Device.swg perl/Amanda/Header.swg perl/Amanda/Tests.swg
	  perl/Amanda/Types.swg perl/Makefile.am server-src/amvault.pl: use
	  Amanda::Header

2009-02-19  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/Makefile.am common-src/queue.h: remove file
	* amandad-src/amandad.c common-src/alloc.c
	  common-src/bsdtcp-security.c common-src/krb5-security.c
	  common-src/local-security.c common-src/rsh-security.c
	  common-src/security-util.c common-src/security-util.h
	  common-src/ssh-security.c: remove includes and replace TAILQ with
	  GSList

2009-02-18  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/krb4-security.m4: Remove file
	* common-src/krb4-security.c: Remove file.
	* example/config.site, example/amanda.conf.in,
	  client-src/client_util.c, amandad-src/amandad.c,
	  man/xml-source/amanda-client.conf.5.xml,
	  man/xml-source/amanda.conf.5.xml,
	  man/xml-source/amgetconf.8.xml,
	  configure.in, server-src/dumper.c,
	  server-src/diskfile.c, perl/Amanda/Constants.pm.in,
	  installcheck/Amanda_Config.pl, common-src/amfeatures.h,
	  common-src/security.c, common-src/security.h,
	  common-src/genversion.c, common-src/amgetconf.pl,
	  common-src/conffile.c, common-src/Makefile.am,
	  common-src/amfeatures.c: Remove krb4 support.

2009-02-18  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Debug.swg: correctly check $^S in _my_die()

2009-02-18  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/debug.h common-src/debug.c: add ability to supporess
	  tracebacks
	* perl/Amanda/Debug.swg: fix typo and suppress traceback on die()

2009-02-18  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am: actually install Amanda::Change::rait

2009-02-18  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/util.c: add missing 'const'

2009-02-18  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/util.c common-src/util.h device-src/rait-device.c
	  perl/Amanda/Util.swg installcheck/Amanda_Util.pl: move
	  expand_braced_alternates and collapse_braced_alternates out of
	  rait-device.c and into util.c, and make them available from Perl
	* perl/Amanda/Changer/null.pm perl/Amanda/Changer/rait.pm
	  perl/Makefile.am: new changers
	* installcheck/Amanda_Changer_null.pl
	  installcheck/Amanda_Changer_rait.pl installcheck/Makefile.am: test new
	  changers
	* changer-src/Makefile.am changer-src/chg-null.sh
	  changer-src/chg-rait.sh: remove old scripts
	* man/xml-source/amanda-changers.7.xml
	  man/xml-source/amanda-devices.7.xml: update documentation

2009-02-18  John Hein <jhein@timing.com>
	* common-src/dgram.c: set the send buffer size when creating a new
	  socket

2009-02-18  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c common-src/conffile.h perl/Amanda/Config.swg:
	  change PP_SCRIPT to SCRIPT, to match the name of the config param
	* server-src/diskfile.c installcheck/Amanda_Config.pl:
	  use new symbols

2009-02-18  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Config.pl: installchecks for nested pp_scripts
	  and applications

2009-02-18  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c common-src/conffile.h: use a simple
	  identlist_t for pp_scripts
	* server-src/amadmin.c server-src/diskfile.c server-src/diskfile.h
	  server-src/server_util.c: use identlist_t's

2009-02-18  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Config.swg: perl bindings

2009-02-18  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c common-src/conffile.h: Change
	  DUMPTYPE_APPLICATION to give a string val_t; remove the
	  pointer-to-application val_t subtype; also fix many
	  memory leaks and simplify memory management
	* server-src/amadmin.c server-src/amcheck.c server-src/amindexd.c
	  server-src/diskfile.c server-src/diskfile.h server-src/driverio.c
	  server-src/planner.c: use new val_t result correctly

2009-02-18  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c: Do dle check without disk.
	* common-src/amxml.c: Accept a dle without a disk.
	* perl/Amanda/Application/Zfs.pm, application-src/amgtar.c,
	  application-src/amgtar_perl.pl,
	  application-src/amsamba.pl, application-src/amstar.c,
	  application-src/amsuntar.pl, application-src/amzfs-sendrecv.pl,
	  application-src/amzfs-snapshot.pl: Do minimal test in selfcheck if
	                                     a disk is not provided.

2009-02-18  Jean-Louis Martineau <martineau@zmanda.com>
	patch by glowkrantz
	* application-src/amzfs-sendrecv.pl: Use compression ratio for
	                                     compressed filesystem.

2009-02-18  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amdump.sh: Check if planner/driver are executable and
	                        log error.

2009-02-17  Dustin J. Mitchell <dustin@zmanda.com>
	* restore-src/amfetchdump.c: remove unintended debugging messages

2009-02-17  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-manual.sh: make messages clearer
	* perl/Amanda/Changer/compat.pm: use _run_tpchanger directly from
	  _manual_scan
	* server-src/amcheckdump.pl: handle errors better

2009-02-17  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-manual.sh: make messages clearer
	* perl/Amanda/Changer/compat.pm: use _run_tpchanger directly from
	  _manual_scan
	* server-src/amcheckdump.pl: handle errors better

2009-02-17  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Set all_level with level_t.

2009-02-17  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/syshacks.m4: add Mac OS X Leopard on advice from
	  Jose Hales-Garcia <jose@stat.ucla.edu>

2009-02-12  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/tape.m4: Define DEFAULT_TAPE_NON_BLOCKING_OPEN.
	* device-src/tape-device.c: Use DEFAULT_TAPE_NON_BLOCKING_OPEN and
	                            NONBLOCKING_OPEN property.
	* device-src/tape-device.h (TapeDevice): Add nonblocking_open.
	* man/xml-source/amanda-devices.7.xml: Document tape NONBLOCKING_OPEN
	                                       property.
	* server-src/amdevcheck.pl: Call $device->configure(1).

2009-02-11  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-rait.sh: get directory handling right (patch from
	  Jim.pennino on wiki.zmanda.com)
	* changer-src/chg-glue.pl: produce a debug log, add do_clean, fix
	  do_eject
	* perl/Amanda/Changer.pm: Add a new chg->eject method, to eject a
	  volume that's not currently reserved
	* perl/Amanda/Changer/compat.pm: fix release(), don't load 'current'
	  after cleaning or ejecting
	* installcheck/Amanda_Changer_compat.pl: updated tests

2009-02-11  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am: add a version number to libamglue

2009-02-10  Dustin J. Mitchell <dustin@zmanda.com>
	* restore-src/restore.c: fix incorrect assertion

2009-02-10  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/debugging.m4: fix --disable-syntax-checks

2009-02-09  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/debugging.m4: add --disable-syntax-checks
	* config/automake/scripts.am: disable them
	* configure.in: call AMANDA_DISABLE_SYNTAX_CHECKS

2009-02-09  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: remove TODO

2009-02-07  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/event.c: use built-in child watch source on FreeBSD

2009-02-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: options is already unquoted.
	* common-src/util.c: argument should not be quoted when added to argv.

2009-02-06  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Changer_compat.pl: remove debugging code

2009-02-06  Jean-Louis Martineau <martineau@zmanda.com>
	patch by Yoshihiro Ishikawa
	* recover-src/extract_list.c: Handle application-api.

2009-02-06  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Changer_compat.pl: support 'eject'
	* perl/Amanda/Changer.pm: change release/do_relase relationship
	* perl/Amanda/Changer/compat.pm: same
	* perl/Amanda/Changer/disk.pm: same
	* perl/Amanda/Changer/single.pm: same

2009-02-04  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.h: Add ES_ES.
	* common-src/conffile.c: Handle ES_ES in switch.
	* server-src/amadmin.c: Handle ES_ES in switch.
	* client-src/sendsize.c: Works with many multiple estimate method.
	* server-src/planner.c: Works with many multiple estimate method.

2009-02-04  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c, application-src/amgtar_perl.pl,
	  application-src/amsamba.pl, application-src/amstar.c,
	  application-src/amsuntar.pl,
	  application-src/amzfs-sendrecv.pl: Output a "CLIENT-ESTIMATE" line.
	* client-src/client_util.c: Parse "CLIENT-ESTIMATE" line.
	* client-src/client_util.h: New field to keep its value.

2009-02-04  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amfeatures.c,
	  common-src/amfeatures.h: And fe_xml_level_server amfeature.
	* common-src/amxml.c: parse <server> tag in level tag.
	* server-src/planner.c: Send <server> tag,
	                Move estimate server calculation to its own function.

2009-02-04  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c, client-src/sendbackup-gnutar.c,
	  client-src/sendbackup.c, client-src/sendbackup-dump.c,
	  client-src/sendsize.c,
	  client-src/selfcheck.c, recover-src/extract_list.c,
	  common-src/amxml.c,
	  common-src/amxml.h: Change Change dle->level for dle->levellist,
	                      each element is a level_t struct.

2009-02-04  Jean-Louis Martineau <martineau@zmanda.com>
	* amplot/amplot.awk: Set term to x11.

2009-02-04  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amfeatures.h: Add fe_xml_estimatelist feature.
	* common-src/amfeatures.c: Add fe_xml_estimatelist feature.
	* common-src/amxml.c: Parse multiple estimate value.
	* common-src/amxml.h: Change estimate for estimatelist in dle_t.
	* server-src/diskfile.h (xml_estimate): Protoype.
	* server-src/diskfile.c (xml_estimate): New function.
	* server-src/amcheck.c: Use xml_estimate.
	* server-src/planner.c: Use xml_estimate.
	* client-src/sendbackup.c, client-src/sendsize.c,
	  client-src/selfcheck.c: Use first estimate in estimatelist.

2009-02-02  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Correctly copy pp_scriptlist.

2009-02-02  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Remove a bogus line.

2009-01-30  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amrmtape.8.xml: clarify meaning of --erase

2009-01-30  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/amrecover.c: Always print error.
	* server-src/amindexd.c: read stderr of uncompress and sort process,
	  put the result in a GPtrArray, send the complete array to amrecover.

2009-01-30  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Typo.

2009-01-30  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c, common-src/conffile.h,
	  server-src/diskfile.h, server-src/amcheck.c,
	  server-src/planner.c, server-src/amadmin.c,
	  server-src/diskfile.c, perl/Amanda/Config.swg,
	  installcheck/Amanda_Config.pl: Use a list of estimate.

2009-01-30  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c, common-src/conffile.h,
	  server-src/amcheck.c, server-src/holding.c,
	  server-src/driver.c, perl/Amanda/Config.swg,
	  installcheck/Amanda_Config.pl: 'define' keyword is use only to define
          an holding disk, you must use 'holdisgdisk' without 'define' if you
          want to use it.

2009-01-29  Dustin J. Mitchell <dustin@zmanda.com>
	* config/config.guess config/config.sub: new updates from FSF

2009-01-29  Benjamin Lewis <bhlewis@purdue.edu>
	* autogen: fix quoting error
	* config/amanda/dumpers.m4:  use a hostname we're more confident
	  doesn't exist

2009-01-28  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Config.pm perl/Amanda/Archive.swg
	  perl/Amanda/DB/Catalog.pm perl/Amanda/MainLoop.swg
	  perl/Amanda/Tapelist.swg perl/Amanda/Xfer.swg: fix POD typos

2009-01-28  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c: support "." as a config name, indicating
	  "this directory"
	* changer-src/chg-lib.sh.in: use that support to run amdevcheck in
	  old-school changer shell scripts
	* man/xml-source/amanda.8.xml: docs
	* perl/Amanda/Config.swg: docs

2009-01-28  Nikolas Coukouma <atrus@zmanda.com>
	* installcheck/Makefile.am: do not run client software checks --without-client

2009-01-28  Jean-Louis Martineau <martineau@zmanda.com>
	* config/automake/scripts.am: Fix another get line numbers right when
	  syntax-checking perl scripts

2009-01-27  Nikolas Coukouma <atrus@zmanda.com>
	* installcheck/Installcheck/Application.pm: make sure all data is read
	* installcheck/amgtar.pl: check if GNU tar is present,
	  avoid using atime-preserve, make sure reported and actual size match

2009-01-27  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amgtar.pl: fix typo

2009-01-27  Nikolas Coukouma <atrus@zmanda.com>
	* installcheck/Installcheck/Application.pm: Add Installcheck::Application
	  harness for running things via the Application API
	* installcheck/amgtar.pl: Add installchecks for amgtar
	* installcheck/Makefile.am: Add files to build and distribution

2009-01-26  Dustin J. Mitchell <dustin@zmanda.com>
	* config/automake/scripts.am: get line numbers right when
	  syntax-checking perl scripts

2009-01-26 Satya Ganga <gsat@zmanda.com>
	* xml-source/amsuntar.8.xml : Update man page with RBAC info
	* application-src/amsuntar.pl : Adding support for estimate

2009-01-23  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/fileheader.h common-src/fileheader.c: add F_NOOP header,
	  used by the tape device
	* device-src/tape-device.c: enable appending, using F_NOOP when
	  necessary to avoid writing a double filemark
	* installcheck/Amanda_Device.pl: new tests

2009-01-22  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/fileheader.c common-src/fileheader.h
	  device-src/device.c device-src/device.h: make header-
	  building more flexible, allowing varying sizes
	* device-src/s3-device.c: use the new flexibility to write only the
	  header data necessary to S3
	* device-src/tape-device.c device-src/vfs-device.c
	  restore-src/restore.c server-src/chunker.c server-src/dumper.c
	  server-src/holding.c: use new function signatures, without changing
	  functionality

2009-01-22  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amstar.8.xml: Typo.

2009-01-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Add call to short_dump_state().

2009-01-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Set exit_status to STATUS_TAPE if taper crash.

2009-01-21  Jean-Louis Martineau <martineau@zmanda.com>,
	    Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/fileheader.c: Remove strquotedstr function.
	* common-src/quoting-test.c: Test strquotedstr function.
	* common-src/util.c: Add prototype for strquotedstr function.
	* common-src/util.h: Add new strquotedstr function.

2009-01-21  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/Makefile.am: Typo

2009-01-21  Dustin J. Mitchell <dustin@zmanda.com>
	Patch suggested by Ingo Schaefer <ingo@ingo-schaefer.de>
	* packaging/rpm/amanda.spec: detect and properly support suse11.1,
	  with a temporary hack to support suse11, too

2009-01-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Fix use of %free and %qlen keys.

2009-01-20 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: add missing BuildRequires, conditionalize
	  libtermcap.so.2 for fedora, change tar requirement to %{tarver}

2009-01-20 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: add %{PERLSITELIB} to %files section to
	  install perl for the client package add "directory mode" to defattr
	  statements where appropriate.

2009-01-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c: Use dp->hostnext to scan dles of a host.

2009-01-19 Satya Ganga <gsat@zmanda.com>
	* application-src/amsuntar.pl : New amsuntar application
	* application-src/Makefile.am : Make file updates to include amsuntar
	* man/entities/global.entities.in : Add to gsat  to the name list
	* man/Makefile.am  man/xml-source/amsuntar.8.xml : add new man amsuntar man page

2009-01-19  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/vfs-device.c: remove bogus locking stubs that are
	  making syscalls like close(-1); fix error handling in read_label
	  if check_is_dir fails()

2009-01-19  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/vfs-device.c: robust_open can return fd 0.

2009-01-19  Tom Robinson <tom.robinson@constantstream.com>
	* server-src/amoverview.pl: fix parsing of filenames containing colons

2009-01-19  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amzfs-sendrecv.pl: Handle incremental,
	                                     new KEEP-SNAPSHOT property.
	* man/xml-source/amzfs-sendrecv.8.xml: Document it.
	* application-src/teecount.c: New program.
	* application-src/Makefile.am: Add teecount.
	* perl/Amanda/Application/Zfs.pm: Work with 'current' snapshot.
	* common-src/amanda.h: include "safe-read.h"

2009-01-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Don't add 'dump to tape' in the 'dumped'
	                          result.

2009-01-16 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: fix the fedora 10 fix for other distros

2009-01-16  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/rpm/amanda.spec: Fix for fedora 10.

2009-01-16  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/vfs-device.c: don't cache the dir_handle, as
	  such caching does not work on some network filesystems

2009-01-16  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: add documentation
	  of inheritance for config sections

2009-01-16  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/amtapetype.pl: add a 'config' parameter
	* man/xml-source/amtapetype.8.xml: documentation
	* installcheck/amtapetype.pl: test with a small vtape

2009-01-16  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Use bitwise NOT for taper_state.

2009-01-16  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: Go to next tape if device_start_file fail.
	* device-src/tape-device.c: write a filemark when a file is finished.
	* device-src/tape-device.h (TapeDevice): Remove first_file.

2009-01-16  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Fix for no index with application.
	* application-src/amstar.c: Improve error reporting.
	* application-src/amgtar.c: Improve error reporting.

2009-01-14  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Add TAR-BLOCKSIZE property.
	* man/xml-source/amgtar.8.xml; document TAR-BLOCKSIZE property.

2009-01-13  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Paths.pm.in: add $localstatedir
	* server-src/amserverconfig.pl: remove extraneous /

2009-01-13  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Accept 'define' keyword for
	                                    defining an holdingdisk.
	* common-src/conffile.c: Document it.

2009-01-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Check fallback_splitsize is smaller than
	                        physmem_total().
	* server-src/taper-mem-port-source.c: Dont; check physmem_available.

2009-01-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/server_util.c: New get_pending_cmd function.
	* server-src/server_util.h: get_pending_cmd prototype.
	* server-src/driver.c: Send message to dumper in ABORT command.
	* server-src/driverio.c: Send message to dumper in ABORT command.
	* server-src/dumper.c: Check for ABORT cmd.
	* server-src/reporter.c: Don't log duplicate
	                         'Not enough holding disk space' error

2009-01-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Fix result_argv subscript.

2009-01-08  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/amfetchdump.c: Write to stderr.

2009-01-06  Jean-Louis Martineau <martineau@zmanda.com>,
	    Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tape-device.c (tape_device_seek_file): Set is_eof to FALSE
	  after it is use.
	* installcheck/Amanda_Device.pl: Add more tape check.

2009-01-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: Don't call changer_label() if a changer is not
	                      in use.

2009-01-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driverio.c: Set *result_argv to NULL on EOF.
	* server-src/taper-mem-port-source.c: Set an error if the memory can't
	  be allocated for the memory buffer.

2009-01-05  Dustin J. Mitchell <dustin@zmanda.com>
	* client-src/runtar.c: remove unnecessary check for existence of
	  CLIENT_LOGIN

2009-01-05  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Archive.swg, perl/Amanda/Device.swg,
	  perl/Amanda/Xfer.swg: Fix compiler warning.

2009-01-05  Jean-Louis Martineau <martineau@zmanda.com>
        * config/automake/scripts.am: Remove 'use lib' line before doing check.

2008-12-22  Paul Yeatman <pyeatman@zmanda.com>
	* man/entities/global.entities.in: added author/email entity for me
	* man/xml-source/amanda-auth.7.xml: newly added man page
	* man/Makefile.am: added amanda-auth to section 7
	* man/xml-source/amanda.conf.5.xml: removed details on auth parameter
	and added link to amanda-auth man page
	* man/xml-source/amanda.conf.5.xml: moved AUTHORIZATION section to
	amanda-auth and added link to amanda-auth man page

2008-12-22  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c: retry on CURLE_GOT_NOTHING (52) to handle "connection reset by peer"

2008-12-22  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3.c: translate error code 0 to "None", not NULL

2008-12-22  Dustin J. Mitchell <dustin@zmanda.com>
	* application-src/amgtar.c,
	  application-src/amstar.c: Use sizeof(line) for argument to fgets.

2008-12-22  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amarchiver.8.xml: amanda-archive-format man page is
	                                   in section 5.

2008-12-22  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Dumpcache.pm
	  installcheck/Installcheck/Run.pm installcheck/amdump.pl
	  installcheck/pp-scripts.pl: move amdump_diag to Installcheck::Run, fix
	  it, and use it in amdump and pp-scripts
	* application-src/amlog-script.pl: don't pretend to be script-email
	* man/Makefile.am: amanda-archive-format should be section 5
	* man/xml-source/amanda-archive-format.5.xml: small tweaks
	* man/xml-source/amanda-changers.7.xml: fix authorship
	* man/xml-source/amanda.8.xml: add link to amvault(8)
	* man/xml-source/amvault.8.xml: enumerate limitations of this version
	* perl/Amanda/Config.swg: fix mem leak in config_dir_relative wrapper

2008-12-22  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/dirs.m4: add --with-amdatadir
	* example/Makefile.am: use it for examples and templates
	* perl/Amanda/Paths.pm.in: add $amdatadir
	* server-src/amserverconfig.pl: use it
	* packaging/deb/rules packaging/rpm/amanda.spec: packaging changes
	  so that built packages still put examples and templates in
	  /var/lib/amanda

2008-12-22  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amstar.c: Use fgets to read star output.
	* application-src/amgtar.c: Use fgets to read gtar output.

2008-12-22  Jean-Louis Martineau <martineau@zmanda.com>,
	    Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/util.c: Convert underscore in application and script
	                     property name to dash.
	* device-src/property.c: Make underscore and dash equal in device
	                         property name.
	* installcheck/Amanda_Device.pl: Check device property name with
	                                 mixed case and dash.
	* installcheck/pp-scripts.pl: Check property name with underscore.

2008-12-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Fix reporting of FLUSH.

2008-12-21  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3-device.c: use devpay if the user token property is
	  given; otherwise, regular S3
	* installcheck/Amanda_Device.pl: adjust tests to correspond

2008-12-19  Nikolas Coukouma <atrus@zmanda.com>, Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3-device.c, device-src/s3.c, device-src/s3.h:
	  Reset read and write when retrying a failed request

2008-12-19  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Device.pl: if SSL is not supported, don't try
	  to test the SSL_CA_INFO property

2008-12-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/holding.c (holding_get_file_chunks): Set fullpaths to 1.

2008-12-18  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Don't free 'rc'.

2008-12-18  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amgtar.8.xml: Improve documentation of regex.

2008-12-18  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.h (anonymous_value): New prototype.
	* common-src/conffile.c (anonymous_value): New function.
	* common-src/conffile.c: Use anonymous_value.
	* server-src/diskfile.c: Use anonymous_value.

2008-12-17  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Script_App.pm: Fix infinite loop.
	* perl/Amanda/Application/Zfs.pm: Fix for freebsd.

2008-12-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Run script only if todo is set.

2008-12-17  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/amfetchdump.pl: chdir() before rmtree().

2008-12-17  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/amarchiver.pl: chdir() before rmtree().

2008-12-17  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amgtar.8.xml: atime_preserve -> atime-preserve
	* installcheck/pp-scripts.pl: add atime-preserve property

2008-12-16  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xslt/html.xsl.in: add <div class="refentry" /> for the benefit
	  of amanda.css.

2008-12-16 Dan Locks <dwlocks@zmanda.com>
	* config/amanda/changer.m4: update AC_CHECK_HEADERS to get rid of
	  "present but cannot be compiled" warning during debian packaging.

2008-12-16  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Don't close if it's not open.

2008-12-16  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/Makefile.am: Add amlog-script.
	* application-src/amlog-script.pl: New scripts.
	* server-src/amcheck.c , server-src/planner.c,
	  server-src/server_util.c, server-src/server_util.h,
	  server-src/driver.c: Add level argument to run_server_scripts().
	  The script is executed with that level argument.
	* installcheck/pp-scripts.pl: Check scripts.
	* installcheck/Makefile.am: Add pp-scripts.

2008-12-16  Dustin J. Mitchell <dustin@zmanda.com>
	* man/Makefile.am man/xml-source/amanda-changers.7.xml
	  man/xml-source/amanda-devices.7.xml man/xml-source/amanda.8.xml
	  man/xml-source/amanda.conf.5.xml: new documentation
	* perl/Amanda/Changer.pm: not finished yet!
	* perl/Amanda/Changer/compat.pm: fix error message
	* server-src/changer.c changer-src/chg-glue.pl:
	  better error handling

2008-12-15  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Set wait_30s to 0 for local auth.

2008-12-15  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Config.pl: work around buggy sort() in perl-5.6
	* installcheck/Amanda_DB_Catalog.pl installcheck/Amanda_Logfile.pl:
	  stringify bigints in is_deeply arguments
	* perl/Amanda/Archive.swg: grok_number is not in perl-5.6
	* perl/Amanda/BigIntCompat.pm: additional overloads and methods for
	  BigIntCompat for perl-5.6 compatibility

2008-12-15  Nikolas Coukouma <atrus@zmanda.com>
	* perl/Makefile.am,
	  perl/amglue/amglue.swg,
	  perl/amglue/filehandles.swg: add typemap to convert perl file handles
	  to int file descriptors
	* installcheck/Amanda_Device.pl: update usage
	* perl/Amanda/Device.swg,
	  perl/Amanda/Archive.swg,
	  perl/Amanda/MainLoop.swg: update docs, make typemap apply

2008-12-15  Nikolas Coukouma <atrus@zmanda.com>
	* installcheck/Amanda_Device.pl: simplify S3 installcheck, removing
	  ability to test well with just DevPay credentials

2008-12-14  Dustin J. Mitchell <dustin@zmanda.com>
	* man/Makefile.am: change manpage build process
	* man/entities/global.entities.in: generate with config.status
	* man/xslt/html.xsl.in: new templates to handle authors
	* man/xslt/man.xsl.in: new templates to handle authors
	* man/xml-source/*.xml: change specification of authors
	* man/xml-source/amanda-applications.7.xml: add links to apps
	* man/xml-source/amanda-scripts.7.xml: add links to scripts

2008-12-12  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Fix use of <programlisting>, it must
					    always be at the beginning of the line.

2008-12-12  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Fix coredump if GNUTAR is not set.

2008-12-12  John Hein <jhein@timing.com>
	* server-src/amdump.sh: fix Open3 invocation to work on
	  FreeBSD-4.x

2008-12-12  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3-device.c,
	  device-src/s3.c,
	  device-src/s3.h,
	  installcheck/Amanda_Device.pl,
	  man/xml-source/amanda-devices.7.xml: add SSL_CA_INFO property

2008-12-12  Dustin J. Mitchell <dustin@zmanda.com>
	* client-src/sendbackup-dump.c: fix previous commit to not use
	  precompiler directives in the middle of a macro invocation

2008-12-12  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS, ReleaseNotes: Add amzfs-sendrecv.
	* client-src/sendbackup.c: Fix indexd test.
	* man/Makefile.am: Add amzfs-sendrecv.8.
	* man/xml-source/amzfs-snapshot.8.xml: Add DLE format example.
	* man/xml-source/amanda-applications.7.xml: Add amzfs-sendrecv.8.
	* man/xml-source/amanda.8.xml: Add amzfs-sendrecv.8.
	* man/xml-source/amzfs-sendrecv.8.xml: New man page.
	* application-src/amzfs-sendrecv.pl: New application.
	* application-src/amzfs-snapshot.pl: Fix to use
	                                     Amanda::Application::Zfs
	* application-src/Makefile.am: Add amzfs-sendrecv.
	* perl/Amanda/Script_App.pm: Exit instead of die.
	* perl/Amanda/Application/Zfs.pm: New perl module for zfs.
	* perl/Makefile.am: Add Amanda/Application and
			    Amanda/Application/Zfs.pm

2008-12-12  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Wait to read at least one byte from the
				      data stream before forking the child.

2008-12-12  Jun Kuriyama <kuriyama@freebsd.org>, Gran Lwkran
	* changer-src/chg-zd-mtx.sh: fix bashisms
	* client-src/sendbackup-dump.c: use -L on systems that support it

2008-12-11 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: add detection for SLES11 (Beta)

2008-12-11  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS, ReleaseNotes: Add amsamba.

2008-12-11  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Check start_t before doing a dump to tape.

2008-12-10  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: distribute Dumpcache.pm

2008-12-10  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Dumpcache.pm: cache amdump runs
	* installcheck/Installcheck/Config.pm: add cleanup()
	* installcheck/Installcheck/Run.pm: call I::C::cleanup()
	* installcheck/Makefile.am: add _seupcache
	* installcheck/_setupcache.pl: set up the amdump cache first thing
	* installcheck/amcheckdump.pl installcheck/amdevcheck.pl
	  installcheck/amdump.pl installcheck/amfetchdump.pl
	  installcheck/amrmtape.pl: use dumpcache

2008-12-10  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c: Generate date header independently of locale

2008-12-10  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Disklist.swg: remove ref cycles and weakrefs
	* installcheck/Amanda_Disklist.pl: fix tests

2008-12-09  C R Ritson.
	* server-src/reporter.c: Add threshold to small and big estimate.

2008-12-09  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: Parse RECOVER-MODE application support.
	* client-src/client_util.h (backup_support_option_t):
	                           Add smb_recover_mode.
	* client-src/sendsize.c: Fix size.
	* man/Makefile.am: Add amsamba.8.
	* man/xml-source/amsamba.8.xml: New man page.
	* man/xml-source/amanda-applications.7.xml: List amsamba.
	* man/xml-source/amanda.8.xml: List amsamba.
	* application-src/Makefile.am (CHECK_PERL): Add amsamba
	* application-src/amsamba.pl: New application.
	* recover-src/extract_list.c: Get support option from application
	  and set --recover-mode if needed.
	* recover-src/amrecover.h: Remove some "#ifdef SAMBA_CLIENT".
	* recover-src/set_commands.c: Remove some "#ifdef SAMBA_CLIENT".
	* perl/Amanda/Paths.pm.in: Add $sysconfdir.
	* perl/Amanda/Util.swg: Add skip_quoted_string.

2008-12-09  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amstar.8.xml: Typo.

2008-12-09  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Fix plugin location.

2008-12-09  Nikolas Coukouma <atrus@zmanda.com>
	* installcheck/amrmtape.pl,
	  man/xml-source/amrmtape.8.xml,
	  server-src/amrmtape.pl: add --cleanup option to amrmtape
	  alphabetize command-line options

2008-12-08  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Disklist.swg: return a value from
	  read_disklist_internal

2008-12-08  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c common-src/conffile.h
	  installcheck/Amanda_Disklist.pl perl/Amanda/Config.swg
	  perl/Amanda/Disklist.swg server-src/amadmin.c server-src/amcheck.c
	  server-src/diskfile.c server-src/diskfile.h server-src/driverio.c
	  server-src/planner.c: change DUMPTYPE_SECURITY_DRIVER to
	  DUMPTYPE_AUTH, with related changes to disk_t

2008-12-08  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am installcheck/Amanda_Disklist.pl
	  perl/Amanda/Disklist.swg installcheck/Makefile.am:
	  new module + tests
	* man/xml-source/amanda.conf.5.xml: 'starttime' is a dump-specific
	  parameter
	* common-src/conffile.h: tag host-related parameters
	* perl/Amanda/Config.swg: POD typo
	* server-src/diskfile.h: comments

2008-12-08  Nikolas Coukouma <atrus@zmanda.com>
	* installcheck/amrmtape.pl,
	  man/xml-source/amrmtape.8.xml,
	  server-src/amrmtape.pl: add --keep-label option to amrmtape

2008-12-07  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/Makefile.am server-src/amvault.pl: new, experimental
	  script to copy data from secondary to tertiary volumes
	* common-src/fileheader.c: strip spurious ' ' from headers
	* man/Makefile.am man/xml-source/amvault.8.xml: docs
	* perl/Amanda/DB/Catalog.pm: add kbps calculation
	* perl/Amanda/Device.swg: add volume_header() method

2008-12-05  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/taper.c: remove dead code that can cause compiler errors

2008-12-05  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/device.c,
	  device-src/vfs-device.c,
	  installcheck/Amanda_Device.pl: fix erase() for VFS device
	* server-src/amrmtape.pl: fix rollback, erase() call setup

2008-12-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driverio.c: Send a message with NO-NEW-TAPE.
	* server-src/driver.c: Generate message for NO-NEW-TAPE, call
	  start_degraded_mode when sending NO-NEW-TAPE, Fix a subscript error
	  for INPUT-ERROR and TAPE-ERROR
	* server-src/taper.c: Get message from NO-NEW-TAPE command and log it.

2008-12-05  Nikolas Coukouma <atrus@zmanda.com>
	* server-src/amrmtape.pl:
	  man/xml-source/amrmtape.8.xml,
	  installcheck/amrmtape.pl:  add --empty and --changer options for erasing media

2008-12-04  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/device.c, device-src/device.h, perl/Amanda/Device.swg:
	  Add erase method to the device class
	* device-src/property.c, device-src/property.h:
	  Add FULL_DELETION property so devices can indicate if they implement erase
	* xml-source/amanda-devices.7.xml: document FULL_DELETION property
	* device-src/null-device.c, device-src/rait-device.c:
	  Indicate that these do not implement erase (via FULL_DELETION)
	* device-src/s3-device.c, device-src/vfs-device.c: Implementation of erase
	* device-src/s3-device.c: Add delete_all_files helper.
	  Return FALSE on error in one place.
	* installcheck/Amanda_Device.pl: Test erase and FULL_DELETION
	* device-src/s3.c, device-src/s3.h: Add s3_delete_bucket.
	  Don't usually retry when bucket is missing

2008-12-04  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/device.c,
	  device-src/s3-util.c,
	  device-src/device.h,
	  device-src/s3-util.h,
	  device-src/null-device.c,
	  device-src/s3-device.c,
	  device-src/property.c,
	  device-src/s3.c,
	  device-src/tape-device.c,
	  device-src/property.h,
	  device-src/s3.h,
	  device-src/vfs-device.c,
	  device-src/rait-device.c: strip trailing whitespace

2008-12-04  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/compat.pm: only call '-label' on chg-zd-mtx if
	  the changer is not seekable (hack to make slotinfofile work)

2008-12-04  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-glue.pl: add labelling support
	* perl/Amanda/Changer/compat.pm: call -label even for non-searchable
	  changers
	* changer-src/chg-zd-mtx.sh: provide optional slotinfofile mapping
	  slots to labels on a best-information-available basis

2008-12-03  Nikolas Coukouma <atrus@zmanda.com>
	* server-src/Makefile.am, server-src/amrmtape.pl, server-src/amrmtape.sh:
	  convert amrmtape to perl
	* installcheck/Makefile.am, installcheck/amrmtape.pl: installchecks for amrmtape
	* man/xml-source/amrmtape.8.xml: document new long options

2008-12-03  Satya Ganga <gsat@zmanda.com>
	* changer-src/chg-lib.sh.in: Remove dependency on ggrep and use mtx offline
	  command instead of "eject" which is not supported on solaris.

2008-12-03  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Provide default unit.

2008-12-03  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheckdump.pl: Use GNUTAR to validate smbclient image.

2008-12-01  Satya Ganga <gsat@zmanda.com>
	* server-src/amdevcheck.pl: add ability to print device properties
	* man/xml-source/amdevcheck.8.xml: new docs
	* installcheck/amdevcheck.pl: new tests
	* installcheck/Installcheck/Run.pm
	  installcheck/Amanda_Changer_compat.pl: vtape_dir() gives vtape root

2008-12-01  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c: fix signedness

2008-12-01  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/util.c: fix mishandling of trailing backslash in
	  unquote_string

2008-12-01  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/deb/changelog, packaging/deb/rules, packaging/deb/buildpkg,
	  packaging/rpm/buildpkg, packaging/rpm/amanda.spec,
	  configure.in: Change version to 2.6.2alpha.

2008-12-01  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c, device-src/s3.h: Fix segmentation fault within s3_make_bucket
	  by adding some "null-op" read and write functions.

2008-11-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Correctly parse degraded size.

2008-11-26  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Set application in extraction command.

2008-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in: AM_INIT_AUTOMAKE(amanda, "2.6.1b1")
	* ReleaseNotes: Release notes for 2.6.1b1.
	* NEWS: News for 2.6.1b1.
	* packaging/deb/rules, packaging/deb/buildpkg,
	  packaging/rpm/buildpkg,
	  packaging/rpm/amanda.spec: Change version to 2.6.1b1.

2008-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/bsd-security.m4: Fix.
	* config/amanda/bsdtcp-security.m4: Enable --with-bsdtcp-secutiy by
	                                    default.
	* config/amanda/ssh-security.m4: Enable --with-ssh-security by default.

2008-11-25  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/Makefile.am changer-src/chg-glue.pl:
	  add new c-to-perl glue script
	* server-src/changer.c: interface with new script
	* server-src/amtape.c man/xml-source/amtape.8.xml:
	  remove 'slot last' and 'slot prev'
	* perl/Amanda/Changer.pm perl/Amanda/Changer/compat.pm
	  perl/Amanda/Changer/disk.pm perl/Amanda/Changer/single.pm: updates to
	  new Changer API
	* installcheck/Amanda_Changer.pl installcheck/Amanda_Changer_compat.pl
	  installcheck/Amanda_Changer_disk.pl installcheck/Amanda_Changer_single.pl
	  installcheck/Makefile.am: tests for all of it

2008-11-25  Dustin J. Mitchell <dustin@zmanda.com>
	* example/template.d/advanced.conf.in: don't imply that
	  maxdumpsize is in bytes

2008-11-21  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c: work around a bug in Amazon's HTTP implementation
	  by avoiding HEAD requests.

2008-11-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c (clean_dle_str_for_client): Return NULL if
							    argument is NULL.
	* restore-src/restore.c: Also check for F_EMPTY.

2008-11-21  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Wait up to 5 seconds dwfor only for process
				 that should terminate.

2008-11-21  Dustin J. Mitchell <dustin@zmanda.com>
	* restore-src/restore.c: Continue if setting PROPERTY_READ_BUFFER_SIZE
				 fail.

2008-11-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/server_util.c: Skip one field in parsing INFO pid line.

2008-11-20  Jean-Louis Martineau <martineau@zmanda.com>
	* oldrecover-src/extract_list.c: Use config.
	* server-src/dumper.c: Check dle_str for NULL.

2008-11-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amdump.sh: Run amreport if the 'log' file already exist.

2008-11-20  Urs Schurer <urs@sitb.de>
	* server-src/amindexd.c: remove unnecessary stralloc()/free() calls
	  in process_ls_dump

2008-11-19 Satya Ganga <gsat@zmanda.com>
	* example/inetd.conf.amandaserver.in: Add serverconfig file
	* configure.in,example/Makefile.am: Include inetd.conf.amandaserver

2008-11-18 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: removed conditionals around
	  perl(ExtUtils::Embed) so that buildrequires applies to all platforms

2008-11-18  Satya Ganga <gsat@zmanda.com>
	* device-src/tape-device.c: Remove O_NONBLOCK flag from all tape open calls.

2008-11-18  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amstar.c: Free qdisk after the loop.
	* application-src/amgtar.c: Free qdisk after the loop.

2008-11-17  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amgtar.8.xml: Update for ATIME-PRESERVE default.

2008-11-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: Fix formating.

2008-11-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Parse "taper: using label ..." line.
	* server-src/driver.c: Print tape size.
	* server-src/amtoc.pl: Fix for new log format.
	* server-src/reporter.c: Increase field width.
	* server-src/taper.c: Print number of kbytes written to each tape.

2008-11-14  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3-device.c: eliminate an extra buffer copy in the
	  common case where the caller supplies a large enough buffer
	* device-src/s3.h: tweak a comment

2008-11-14  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/holding.h: Improve comment.
	* server-src/reporter.c: Print holding disk size in displyaunit.

2008-11-14  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: Get stderr of scripts and send it to
				    server.
	* client-src/client_util.h: Add err in client_script_result_t.
	* client-src/sendbackup.c: Call run_client_scripts with mesgstream.
	* client-src/sendsize.c: Fix.
	* server-src/planner.c: Get WARNING line from client.
	* server-src/reporter.c: Don't mark the dumper as FAILED if the
				 planner FAILED.
	* common-src/amfeatures.h (fe_sendsize_rep_warning): New amfeature
	* common-src/amfeatures.c: Add fe_sendsize_rep_warning.

2008-11-12  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amfetchdump.8.xml: fix ugly HTML formatting

2008-11-11  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Check that something is ready to be read
				 before calling errfd_recv.

2008-11-11  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-manual.sh: fix typo

2008-11-11 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: add fedora 9 detection, add
	  BuildRequires: perl(ExtUtils::Embed), fix %{dist}=unknown when
	  undetected instead of at all times

2008-11-11  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am installcheck/amfetchdump.pl: build all
	  active test scripts; add a DLE in the amfetchdump installcheck

2008-11-11  Dustin J. Mitchell <dustin@zmanda.com>
	* config/macro-archive/ac_perl_module_version.m4: new macro
	* config/amanda/swig.m4: check for ExtUtils::Embed

2008-11-11  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amarchiver.pl: quote $sbindir from regexp
	  interpretation

2008-11-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: Don't add Amanda/Script_App.pm and Amanda/Script.pm
			    to DISTCLEANFILES.

2008-11-11  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/amdump.pl: Set property "ATIME-PRESERVE" to "NO" in
				  amgtar application.

2008-11-11  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c: fix.
	* amandad-src/amandad.c: Read stderr of server and report it to server.
	* server-src/planner.c: Keep first line only.

2008-11-10  Dustin J. Mitchell <dustin@zmanda.com>
	* amar-src/amarchiver.c: fix filesize printf conversion

2008-11-10  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c, client-src/selfcheck.c: Check return
							   value of pipe.

2008-11-10  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Run.pm: change default DLEs
	* installcheck/amcheckdump.pl: add DLE explicitly
	* installcheck/amdevcheck.pl: add DLE explicitly
	* installcheck/amdump.pl: use the amgtar application in a dump

2008-11-10  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: only test amfetchdump if it was built
	* installcheck/amfetchdump.pl: use arguments in the right order

2008-11-10  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Archive.swg amar-src/amar.c amar-src/amar.h: bugfixes
	* man/Makefile.am man/xml-source/amarchiver.8.xml
	  amar-src/Makefile.am amar-src/amarchiver.c: new application
	* installcheck/Makefile.am installcheck/amarchiver.pl: tests

2008-11-10  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Run.pm: add Expect support
	* installcheck/Makefile.am installcheck/amfetchdump.pl: amfetchdump
	  installcheck, using Expect support

2008-11-10  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amgetconf.pl: don't setup_application() in dbclose

2008-11-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: Build Amanda::Application only if WANT_CLIENT.

2008-11-08  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm perl/Amanda/Changer/compat.pm
	  perl/Amanda/Changer/disk.pm perl/Amanda/Changer/single.pm
	  perl/Makefile.am: entirely new perl-based changer API
	* perl/Amanda/Config.swg common-src/conffile.c common-src/conffile.h:
	  add changer subsections
	* man/xml-source/amanda.conf.5.xml: document them
	* server-src/amcheckdump.pl: use the new changer API
	* installcheck/Amanda_Changer.pl installcheck/Amanda_Changer_Compat.pl
	  installcheck/Amanda_Changer_Single.pl installcheck/Amanda_Config.pl
	  installcheck/Installcheck/Config.pm installcheck/Makefile.am
	  installcheck/Amanda_Changer_Disk.pl: new/updated tests

2008-11-07  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amstar.c: fix.

2008-11-07  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Application.swg: Remove %init.

2008-11-07  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c, application-src/amgtar_perl.pl,
	  application-src/amstar.c: Write backup image to fd3 and index to fd4.
	* perl/Amanda/Script_App.pm: Use $self->{mesgout}.
	* recover-src/extract_list.c: Add more check.
	* client-src/client_util.c (backup_support_option): Get stderr of
	  application and put it in errarray,
	* client-src/client_util.h (backup_support_option): New prototype.
	* client-src/selfcheck.c, client-src/sendbackup.c,
	  client-src/sendsize.c: Get stderr of application and send it to
				 server.
	* server-src/dumper.c: Log the first error message.
	* server-src/planner.c: Log the first error message.
	* server-src/reporter.c: Don't print some error in report.

2008-11-07  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: Parse CALCSIZE and MULTI-ESTIMATE.
	* client-src/client_util.c (run_calcsize): New function.
	* client-src/client_util.h (run_calcsize): Prototype.
	* client-src/sendbackup.c: Update amandates.
	* client-src/sendsize.c: Handling of calcsize and multi-estimate.
	* client-src/selfcheck.c: Check calcsize for application.
	* application-src/amgtar_perl.pl, application-src/amstar.c,
	* application-src/amgtar.c: handling of calcsize and multi-estimate.
	* perl/Amanda/Script_App.pm: Add a check.
	* perl/Amanda/Application.swg: Add run_calcsize.
	* perl/Amanda/Application.pm: Delete
	* perl/Makefile.am: Built from Application.swg
	* client-src/calcsize.c: Handling of STAR program.

2008-11-06  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amgtar.8.xml: Document new properties.
	* application-src/amgtar.c: Remove ifdef IGNORE_TAR_ERRORS.

2008-11-06  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-zd-mtx.sh: Return first line of mtx output if mtx
				     exit with a status != 0.
	* server-src/amtape.c: Display changer error.

2008-11-06  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Add exit-handling property.

2008-11-06  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Add normal, ignore and strange property.

2008-11-04  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Check tape_splitsize < tape length.

2008-10-30  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/find.c server-src/find.h man/xml-source/amadmin.8.xml:
	  add new sort key, 'w', for write_timestamp
	* server-src/amadmin.c: use it
	* server-src/amindexd.c restore-src/amfetchdump.c: use 'w' to prefer
	  the oldest-written copy of a dump

2008-10-30  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar_perl.pl, application-src/amstar.c,
	  application-src/amgtar.c: Implement validate command.
	* server-src/amcheckdump.pl: Execute the validate command of an
				     application.
	* perl/Amanda/Script_App.pm (print_to_server): Add validate.
	* perl/Amanda/Application.pm (known_commands): Add validate.
	* common-src/security-util.c: Fix typo.

2008-10-29  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.conf.5.xml
	  man/xml-source/amanda-devices.7.xml: improve device property
	  documentation

2008-10-29  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: taperflush params can be
	  greater than 100%

2008-10-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/fileheader.c (dumpfile_free_data): New function.
	* common-src/fileheader.h (dumpfile_free_data): New prototype.
	* server-src/cmdline.c, server-src/dumper.c,
	  server-src/planner.c, server-src/amadmin.c,
	  server-src/amflush.c, server-src/holding.c,
	  server-src/driver.c, server-src/find.c,
	  server-src/taper-source.c, server-src/taper-file-source.c
	  server-src/taper.c: Call dumpfile_free or dumpfile_free_data.

2008-10-27  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/glib-util.c: check library version at runtime

2008-10-27  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Device.swg (start_file): Remove const for jobInfo.

2008-10-24  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Archive.pl: fix to also test for identity of
	  $user_data on perls that recognize such things

2008-10-24  Dustin J. Mitchell <dustin@zmanda.com>
	* amar-src/amar-test.c: don't ignore the return value of write()

2008-10-24  Nikolas Coukouma <atrus@zmanda.com>
            Jean-Louis Martineau <martineau@zmanda.com>
	* amar-src/amar.c: fix mis-aligned memory accesses
	* amar-src/amar-test.c: fix test_pipe

2008-10-24  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Script_App.pm: New base module for script and application.
	* perl/Amanda/Script.pm: New base module for script.
	* perl/Amanda/Application.pm: New base module for application.
	* perl/Makefile.am: Add Amanda::Script_app, Amanda::Script And
				Amanda::Application.
	* application-src/generic-dumper.pl: Remove file.
	* application-src/generic-script.pl: Remove file.
	* application-src/script-email.pl: Use Amanda::Script.
	* application-src/amgtar_perl.pl: Use Amanda::Application.
	* application-src/amzfs-snapshot.pl: Use Amanda::Script.
	* application-src/Makefile.am: Remove generic-*.pl files.

2008-10-24  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Archive.swg perl/Makefile.am: add a Perl interface to
	  libamar
	* installcheck/Amanda_Archive.pl installcheck/Makefile.am: test it.

2008-10-24  Dustin J. Mitchell <dustin@zmanda.com>
	* */Makefile.am: change @AMLINT@ to $(AMLINT), similarly for
	  $(AMLINTFLAGS), and strip $(EXEEXT) from program names when running
	  lint
	* config/amanda/libs.m4: put GLIB_CFLAGS in AMANDA_CPPFLAGS

2008-10-23  Dustin J. Mitchell <dustin@zmanda.com>
	* amar-src/Makefile.am: add amar.h to noinst_HEADERS

2008-10-23  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in Makefile.am amar-src/Makefile.am: new directory
	* amar-src/amar.c amar-src/amar.h: amanda archive library
	* amar-src/amar-test.c: tests for library
	* common-src/security-util.c common-src/security-util.h
	  common-src/util.c common-src/util.h: move net_writev to
	  util.c, rename to full_writev
	* man/Makefile.am man/xml-source/amanda-archive-format.7.xml
	  man/xml-source/amanda.8.xml: new manpage to describe the format

2008-10-20 Nikolas Coukouma <atrus@zmanda.com>
	* configure.in: add tests for more headers, plus some defines
	  for the presence of Amanda's headers
	* device-src/s3-util.c, device-src/s3-util.h: Use defines to switch between
	  POSIX regex API and a GRegex (PCRE) call-compatability layer.
	* device-src/s3.c, device-src/s3.h: Add a curl progress callback.
	  Use callbacks to write and read data. Provide callbacks for
	  memory buffers and files. The callbacks for files are currently
	  Windows-specific.
	* device-src/s3-device.c: update to use new API

2008-10-20  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am: remove spurious variables

2008-10-17  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-multi.sh: Check permission on the statefile and its
				    directory.

2008-10-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Set i to 0.

2008-10-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c, server-src/dumper.c
	  server-src/planner.c: Don't send appliaciton-api request if the
				client doesn't use the xml protocol.

2008-10-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: print space instead of N/A, dumper stats are
				 set to "FLUSH" if it is a flush.

2008-10-13  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/vfs-device.c: re-open the dir handle on every
	  device start or read label
	* installcheck/Amanda_Device.pl: adjust tests to degrade the
	  VFS device *after* it is started

2008-10-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: Moce EXTRA_DIST out of conditionals.

2008-10-13  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Makefile.am: revert previous commit.
	* config/automake/scripts.am: Check for a server perl module.

2008-10-13  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Makefile.am: SCRIPTS_PERL = $(tests).

2008-10-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: Don't check Amanda/Config files.

2008-10-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: Check file in top_srcdir if they are not
			    in top_builddir.

2008-10-10  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amgetconf.pl: remove 'use Amanda::Device qw( :constants);'

2008-10-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: test for libConfig.so before doing check.

2008-10-10  Jean-Louis Martineau <martineau@zmanda.com>
	* config/automake/scripts.am: Check perl scripts on compilation.
	  Add -I... to 'make check' to access perl module in build tree.
	  Add installcheck rules to check perl scripts with installed perl
	  modules.
	* application-src/amstar_perl.pl: Remove file.
	* device-src/Makefile.am, application-src/Makefile.am,
	  server-src/Makefile.am, installcheck/Makefile.am,
	  common-src/Makefile.am: Move most perl scripts to CHECK_PERL.
	* installcheck/Makefile.am:
	  Add "CHECK_PERL_FLAGS=-I$(top_srcdir)/installcheck".
	* perl/Makefile.am: Add rules to check all .pm files for check-local.
	* device-src/amtapetype.pl, server-src/amaddclient.pl,
	  common-src/amgetconf.pl: Fix syntax errors.

2008-10-10  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amzfs-snapshot.pl, application-src/amoracle.pl
	  application-src/script-email.pl, application-src/amgtar_perl.pl:
	    fix typos.

2008-10-10  Nick Smith <nick.smith@techop.ch>
	* application-src/amzfs-snapshot.pl: fix typos

2008-10-08  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/DB/Catalog.pm: manage the tapelist internally
	* perl/Amanda/Tapelist.swg: fix error message, re-read C tapelist
	  after writing
	* server-src/amcheckdump.pl: don't read tapelist
	* installcheck/Amanda_DB_Catalog.pl: don't read tapelist first

2008-10-08  Nick Smith <nick.smith@techop.ch>
	* server-src/driver.c: set degr_mesg to NULL when not degraded

2008-10-06  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amzfs-snapshot.pl: Accept execute-where argument.
	* application-src/script-email.pl: Accept execute-where argument.
	* client-src/client_util.c: Send execute-where argument to script.
	* server-src/server_util.c: Send execute-where argument to script.

2008-10-06  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amzfs-snapshot.pl: Add PFEXEC-PATH and PFEXEC
					     properties.
	* man/xml-source/amzfs-snapshot.8.xml: Document new properties.

2008-10-03  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Util.swg: add Amanda::Util::generate_timestamp
	* common-src/timestamp.c: add comment

2008-10-02  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/DB/Catalog.pm: add rudimentary ability to read logfiles
	* installcheck/Amanda_DB_Catalog.pl: test it
	* perl/Amanda/Logfile.swg: fix typo

2008-10-01  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3-device.c, device-src/s3.c, device-src/s3.h:
	  Add new property, S3_SSL, to control the use of SSL/TLS when
	  connecting to Amazon S3
	* man/xml-source/amanda-devices.7.xml:
	  document S3_SSL and S3_BUCKET_LOCATION

2008-10-01  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3-util.c: Re-implement s3_hex_encode() to avoid OpenSSL weirdness.

2008-10-01  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amanda.h common-src/conffile.c
	  oldrecover-src/extract_list.c recover-src/extract_list.c
	  server-src/amcheck.c server-src/amflush.c server-src/planner.c:
	  use g_ascii_isspace, as we assume ASCII (for now) and isspace()
	  is affected by locale and encoding settings.  Thanks to Michael
	  Reuland for helping track this down.

2008-09-30  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.h (xml_optionstr): New prototype.
	* server-src/diskfile.h (clean_dle_str_for_client): Prototype.
	* server-src/amindexd.c: Pass 0 to new argument of xml_optionstr.
	* server-src/amcheck.c: Pass 0 to new argument of xml_optionstr.
	* server-src/planner.c: Pass 0 to new argument of xml_optionstr.
	* server-src/driverio.c: Pass 1 to new argument of xml_optionstr.
	* server-src/dumper.c: Call clean_dle_str_for_client.
	* server-src/diskfile.c (xml_optionstr): Work for ENCRYPT_SERV_CUST.
	* server-src/diskfile.c (clean_dle_str_for_client): New function.
	* restore-src/restore.c: Call clean_dle_str_for_client.
	* common-src/amxml.c: Fix parsing.
	* common-src/amanda.h (match_no_newline): Prototype.
	* common-src/match.c (match_no_newline): New function.

2008-09-30  Dustin J. Mitchell <dustin@zmanda.com>
	* restore-src/restore.c: set data.flags for use by the changer_find
	  callback

2008-09-30  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/MainLoop.swg: add call_later()
	* installcheck/Amanda_MainLoop.pl: test it

2008-09-30  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/rait-device.c: fix typos

2008-09-30  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/semaphore.h: fix typo
	* device-src/rait-device.c: add a private threadpool-like
	  implementation for old glibs, where GThreadPool is susceptible to
	  deadlock

2008-09-29  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/device.c device-src/device.h device-src/null-device.c
	  device-src/property.c device-src/property.h device-src/rait-device.c
	  device-src/s3-device.c device-src/tape-aix.c device-src/tape-device.c
	  device-src/tape-device.h device-src/tape-ops.h device-src/tape-posix.c
	  device-src/tape-uware.c device-src/tape-xenix.c
	  device-src/vfs-device.c: add a 'configure' method to the Device API;
	  revamp device property handling to add source and surety and make
	  implementation easier
	* device-src/rait-device.h device-src/rait-device.c: make RAIT device
	  calculate block sized based on child devices, if they were configured
	  explicitly.
	* man/xml-source/amanda-devices.7.xml: note that common properties are
	  not implemented on all devices
	* common-src/glib-util.c common-src/glib-util.h: add helpers for
	  case-insensitive hashes
	* changer-src/scsi-changer-driver.c installcheck/Amanda_Device.pl
	  perl/Amanda/Device.swg restore-src/restore.c server-src/amcheck.c
	  server-src/amlabel.c server-src/amtape.c server-src/taper.c
	  server-src/taperscan.c: use new API

2008-09-29  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/find.c: handle find_result->label == NULL
	* perl/Amanda/DB/Catalog.pm: filter out bogus results with NULL label

2008-09-26  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/amglue/ghashtable.c: #include conffile.h, not conffile.c (!)

2008-09-26  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Parse dumpsize from taper result.

2008-09-26  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c: Set qdevice on common_exit path.

2008-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/fileheader.c: fix headers_are_equal

2008-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/fileheader.c common-src/fileheader.h: allow blocksize=0
	* device-src/device.c device-src/device.h: set blocksize in tape
	  header
	* device-src/null-device.c device-src/s3-device.c
	  device-src/tape-device.c device-src/vfs-device.c: set blocksize
	  in headers when starting files
	* device-src/rait-device.c: duplicate headers for child devices, since
	  they are no longer const
	* server-src/dumper.c: set blocksize on holding-disk files to
	  DISK_BLOCK_BYTES

2008-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tape-device.c: mark device as non-appendable temporarily,
	  since file numbers are incorrect when appending
	* installcheck/Amanda_Device.pl: handle non-appendable devices

2008-09-24  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driverio.c (dumper_cmd, chunker_cmd): Take new mesg
	  argument.
	* server-src/server_util.h (dumper_cmd, chunker_cmd): New prototype.
	* server-src/chunker.c: Get mesg from ABORT cmd and log it.
	* server-src/driver.c: Add the mesg argument to all dumper_cmd and
			       chunker_cmd.

2008-09-24  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Set degr_mesg and send it to driver.
	* server-src/driverio.h (sched_t): Add degr_mesg field.
	* server-src/driver.c: Parse message if no degraded estimate.

2008-09-23  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c common-src/conffile.h: store a struct
	  containing both filename and line number for each parameter, and use
	  it when reporting errors and warnings

2008-09-23  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/device.c: make 'unimplemented method' an assertion

2008-09-23  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3.c: use max_keys, instead of maximum body size (which
	  doesn't work) to limit the number of keys listed

2008-09-22  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/fileheader.c (fh_init): Set default type to F_EMPTY.
	* changer-src/chg-zd-mtx.sh: Allow to remove barcode from barcode file.
	* server-src/taperscan.c: Check type != F_EMPTY.
	* server-src/taper.c: Call changer_label().
	* server-src/amlabel.c: iCheck type != F_EMPTY. Call changer_label().

2008-09-22  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.c: Don't g_value_unset a bzero value.

2008-09-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Set result_argv=NULL, Fix typo.

2008-09-22  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/ps.m4: give up on runtime detection and just special-
	  case the 'ps' arguments for various systems
	* perl/Amanda/Constants.pm.in: add $PS
	* perl/Amanda/Process.pm: use $PS

2008-09-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c (addline): Done it constant time.

2008-09-19  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/Makefile.am common-src/quoting-test.c: new tests
	* common-src/token.c common-src/token.h: removed
	* common-src/util.c common-src/util.h: new home for quoting functions
	* configure.in: don't check for shquote
	* man/xml-source/amanda.conf.5.xml: info on quoting
	* perl/Amanda/Config/Server.pm: note about incompatibility
	* server-src/amcheck.c server-src/amindexd.c server-src/chunker.c
	  server-src/driver.c server-src/driverio.c server-src/driverio.h
	  server-src/dumper.c server-src/infofile.c server-src/server_util.c
	  server-src/server_util.h server-src/taper-file-source.c
	  server-src/taper-port-source.c server-src/taper.c: use new/updated
	  quoting functions

2008-09-19  Nick Smith <nick.smith@techop.ch>
	* example/amanda.conf.in: fix incorrect execute_on examples

2008-09-18  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Call security_close_connection before
			       checking if pkt == NULL.

2008-09-18  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Nick Smith
	* server-src/diskfile.c: Fix vstrextend use, Patch by Nick Smith.
	* server-src/diskfile.c: Init xml_app.result to stralloc("").

2008-09-16 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec:  Added detection of CentOS 4 and 5 as
	  suggested by dswartz.  added graceful failure when Distro/version is
	  not detected correctly

2008-09-15  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c: uninit apps, pp_scripts, and device_configs

2008-09-14  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/tapefile.c server-src/tapefile.h: add comments to
	  tapelist
	* perl/Amanda/Tapelist.swg: perl tapelist parser, too
	* installcheck/Amanda_Tapelist.pl: tests
	* man/xml-source/tapelist.5.xml: docs
	* server-src/amlabel.c: no initial comments when labeling
	* server-src/taper.c: maintain comment when relabeling

2008-09-12  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Fix typo: authetication -> authentication.

2008-09-05  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: fix inequalities; thanks to
	  Mike McConnell for spotting these

2008-09-05  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/taper.c: improve handling of device errors in taper

2008-09-02  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/amrestore.c: Load a default server config.

2008-08-29  Dustin J. Mitchell <dustin@zmanda.com>
	* autogen: revert glib's configure-time requirement for
	  pkg-config-0.16

2008-08-28  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tape-device.c: use the correct blocksize while reading
	* device-src/rait-device.c: fix typo
	* installcheck/Amanda_Device.pl: use the VFS device in RAIT tests, not
	  the tape device

2008-08-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Reset the MESG buffer for a new dump.

2008-08-27  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amcheck.c: make the check for tapelist result in a NOTE,
	  not a failure
	* server-src/tapefile.c: make a missing tapelist equivalent to an
	  empty one

2008-08-27  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/types.m4: always include sys/types.h, if it exists,
	  before trying other headers (fixes builds of FreeBSD-4.x); thanks
	  to John Hein <jhein@timing.com>
	* perl/Amanda/MainLoop.swg server-src/driverio.h: include amanda.h
	  before event.h

2008-08-22  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/amglue/bigint.c: add #include "stdint.h"

2008-08-22  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/ps.m4: search multiple ps invocations; thanks
	  to John Hein <jhein@timing.com>

2008-08-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.ci (tape): Correctly print next tape to use.
	* server-src/tapefile.c (print_new_tapes): New function to print new
						   tapes.
	* server-src/tapefile.h (print_new_tapes): Prototype.
	* server-src/reporter.c: Correctly print next tape to use.

2008-08-22  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c common-src/conffile.h perl/Amanda/Config.swg:
	  add new 'define device' config section
	* perl/Makefile.am perl/Amanda/Config/Server.pm
	  perl/Amanda/Config/Server/Devices.pm
	  perl/Amanda/Config/Server/Grammar: ditto
	* device-src/device.c device-src/device.h: configure devices from
	  device definitions, with better error handling
	* device-src/rait-device.c: handle child devices better
	* installcheck/Amanda_Config.pl installcheck/Amanda_Config_Server.pl
	  installcheck/Amanda_Xfer.pl installcheck/Installcheck/Config.pm
	  installcheck/amgetconf.pl: new tests, modifications to work with the
	  new system
	* man/xml-source/amanda-devices.7.xml
	  man/xml-source/amanda.conf.5.xml: corresponding documentation updates
	* perl/Amanda/Changer.pm perl/Amanda/Device.swg
	  restore-src/amrestore.c restore-src/restore.c server-src/amcheck.c
	  server-src/amcheckdump.pl server-src/amdevcheck.pl
	  server-src/amlabel.c server-src/amtape.c server-src/taper.c
	  server-src/taperscan.c: remove calls to
	  set_startup_properties_from_config
	* device-src/vfs-test.c: load config before trying to use a device
	* common-src/conffile.c: fix use of uninitialized variable

2008-08-22  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-disk.sh: replace == with =
	* changer-src/chg-lib.sh.in: fix sed invocation for BSD's sed

2008-08-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Fix computation of compression ratio.

2008-08-22  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.h: Add DMP_IGNORE and AM_IGNORE_RE.
	* application-src/amgtar.c, application-src/amgtar_perl.pl:
	  Ignore "Directory is new" and "Directory has been renamed".

2008-08-21  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/krb5-security.c: Fix security_seterror use.

2008-08-19  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in: check for getgrgid_r and getpwuid_r
	* common-src/security-util.c: conditionalize on checks

2008-08-18  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/version.h: remove #include of config.h
	* device-src/vfs-device.c: #include amanda.h first

2008-08-18  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/Makefile.am device-src/amtapetype.pl: new perl amtapetype
	* installcheck/Installcheck/Run.pm: report exit status
	* installcheck/Makefile.am installcheck/amtapetype.pl: new test
	* man/xml-source/amtapetype.8.xml: updated manpage
	* device-src/s3-device.c device-src/vfs-device.c
	  device-src/tape-device.c: add compression property
	* perl/Amanda/Xfer.swg: add POD for the cancel() method
	* xfer-src/dest-device.c: add a default for max_memory

2008-08-18  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c: make find_multiplier case-insensitive
	* device-src/device.c: reorder assertions
	* device-src/tape-device.c: don't set access_mode twice, but
	  set in_file = FALSE in start
	* device-src/s3-device.c: fix property registration
	* perl/Amanda/MainLoop.swg: remove attach() from example
	* perl/Amanda/Xfer.swg: more detail in POD
	* xfer-src/source-pattern.c: operate byte-for-byte, like the random
	  source, instead of using lots of memcpys and reallocs
	* xfer-src/source-random.c: remove redundant check

2008-08-18  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in Makefile.am tape-src/*: remove tape-src
	* changer-src/Makefile.am: don't link with libamtape
	* changer-src/chg-scsi.c: don't use libamtape
	* changer-src/scsi-changer-driver.c: don't use libamtape
	* config/amanda/tape.m4: fix comment
	* example/amanda.conf.in example/template.d/tapetypes: fix outdated
	  comments
	* man/Makefile.am man/xml-source/amdd.8.xml man/xml-source/ammt.8.xml:
	  remove amdd and ammt manpages
	* restore-src/Makefile.am: remove refs to tape-src/
	* server-src/Makefile.am: remove refs to tape-src/

2008-08-18  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/krb4-security.c common-src/krb5-security.c
	  config/amanda/tape.m4 common-src/amanda.h: remove
	  --with-maxtapeblocksize
	* common-src/conffile.c: deprecate file-pad
	* device-src/device-queueing.c device-src/device-queueing.h
	  device-src/device.c device-src/device.h device-src/null-device.c
	  device-src/property.c device-src/property.h device-src/rait-device.c
	  device-src/s3-device.c device-src/tape-device.c
	  device-src/tape-device.h device-src/vfs-device.c server-src/amcheck.c
	  server-src/taper.c tape-src/tapeio.c xfer-src/dest-device.c
	  xfer-src/source-device.c perl/Amanda/Device.swg: devices have
	  {min,max,current} block sizes; remove the short_block parameter from
	  device_write_block; fix property initialization; rename
	  PROPERTY_MEDIUM_TYPE to PROPERTY_MEDIUM_ACCESS_TYPE
	* device-src/rait-device.c: set child block sizes explicitly
	* installcheck/Amanda_Device.pl: tests; better S3 test count
	  calculations
	* installcheck/Amanda_Xfer.pl: tests
	* man/xml-source/amanda-devices.7.xml: update block sizes
	  documentation
	* man/xml-source/amanda.conf.5.xml: refer to block size properties
	* restore-src/amrestore.c: use set_restore_device_read_buffer_size
	* restore-src/restore.h restore-src/restore.c: add
	  set_restore_device_read_buffer_size

2008-08-16  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/driver.c: handle taper_{input,tape}_error memory
	  correctly, and add taper_tape_error to the trace log

2008-08-16  Dustin J. Mitchell <dustin@zmanda.com>
	* application-src/amzfs-snapshot.pl application-src/script-email.pl:
	  remove unnecessary 'use Amanda::Device'

2008-08-16  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amgetconf.pl: use filename-safe characters for $appname
	* installcheck/amgetconf.pl: test it

2008-08-16  Dustin J. Mitchell <dustin@zmanda.com>
	* man/entities/global.entities: add manpage refs
	* packaging/rpm/amanda_enterprise.spec
	  packaging/rpm/amanda_enterprise_client.spec
	  man/xml-source/disklist.5.xml man/xml-source/tapelist.5.xml
	  man/Makefile.am: add disklist(5), tapelist(5)
	* man/xml-source/amaddclient.8.xml man/xml-source/amadmin.8.xml
	  man/xml-source/amanda-client.conf.5.xml man/xml-source/amanda.8.xml
	  man/xml-source/amanda.conf.5.xml man/xml-source/amcheck.8.xml
	  man/xml-source/amcheckdb.8.xml man/xml-source/amdevcheck.8.xml
	  man/xml-source/amflush.8.xml man/xml-source/amlabel.8.xml
	  man/xml-source/amrecover.8.xml man/xml-source/amrmtape.8.xml:
	  - remove references to "output drivers" in favor of "device drivers"
	  - add more inter-page references
	  - fix typos
	  - add client_login to amanda-client.conf(5)
	  - reformat informaltables, which don't render well in HTML or nroff,
	    into variablelists, with fixes for bad xml->man conversion
	  - fix funky replacement entities in HTML output
	* perl/Amanda/DB/Catalog.pm: mention $dump->{kb} and ->{sec}
	* perl/Amanda/Device.swg: fix typo
	* perl/Amanda/MainLoop.swg: add hints for writing async functions
	* perl/Amanda/Types.swg: fix bad POD
	* perl/Amanda/Util.swg: POD fix: use $CONTEXT_* rather than strings
	* perl/Amanda/Xfer.swg: tweaks
	* server-src/taper.c: fix typo
	* server-src/taperscan.c: remove "(previously non-amanda)", as Amanda
	  will no longer overwrite such tapes

2008-08-16  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/debug.c: lock debug logging on a per-line basis

2008-08-16  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/rait-device.c: parse RAIT names with internal {..}
	* installcheck/Amanda_Device.pl: light testing

2008-08-15  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/debug.c: include backtraces on fatal errors
	* config/amanda/debugging.m4: look for glibc's backtrace support
	* configure.in: ditto

2008-08-14  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tape-aix.c device-src/tape-ops.h device-src/tape-uware.c
	  device-src/tape-xenix.c: bring non-POSIX tape-ops implementations up
	  to date with function signatures

2008-08-14  Dustin J. Mitchell <dustin@zmanda.com>,
	    Nikolas Coukouma <atrus@zmanda.com>
	* xfer-src/*: add support for asynchronous cancellation of transfers
	  and use it for error-handling
	* perl/Amanda/Xfer.swg: reflect into perl
	* installcheck/Amanda_Xfer.pl: test cancellation

2008-08-12  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/Makefile.am: clean up svn-info.h on maintainer-clean
	* man/Makefile.am: remove config.log after running config.status

2008-08-07 Nikolas Coukouma <atrus@zmanda.com>
    	* common-src/conffile.c: cleaner fix for signed compared to unsigned
    	  errors on older versions of GCC.

2008-08-06  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/Makefile.am: second fix

2008-08-06  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/Makefile.am: don't syntax-check amgetconf, since
	  it uses Amanda::* modules

2008-08-06 Nikolas Coukouma <atrus@zmanda.com>
    	* server-src/amgetconf.pl, common-src/amgetconf.pl:
    	  Add --execute-where=client|server and --client options
    	  to make amgetconf query the client configuration
    	  instead. Move from server-src to common-src.
    	* man/xml-source/amgetconf.8.xml: Document the new options.
    	* installcheck/amgetconf.pl: Test the new options.
    	* server-src/Makefile.am, common-src/Makefile.am:
    	  Updated Makefiles for move.
    	* packaging/deb/amanda-enterprise-backup-client.install,
    	  packaging/sun-pkg/i386/client/prototype:
    	  Add amgetconf to client packages.

2008-08-04 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec:  add %{tarver} macro and set the correct
	  minimum version per distro (Thanks to Jesse Angell for the rhel4 tip)

2008-08-04  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c: workaround gcc<4.1.0 problems with long
	  constants, don't use G_MAXINT64 in precompiler expressions

2008-08-03  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amrmtape.sh: use shell redirection with shell functions

2008-08-03  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/util.c: if !WORKING_IPV6, request AF_INET, not AF_NATIVE
	* common-src/dgram.c: address family debugging
	* common-src/stream.c: address family debugging

2008-08-03  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amanda.h common-src/conffile.c common-src/conffile.h
	  installcheck/Amanda_Config.pl perl/Amanda/Config.swg
	  server-src/planner.c: replace am64 type with gint64; also replace
	  some uses of off_t

2008-08-01 Nikolas Coukouma <atrus@zmanda.com>
	* perl/Amanda/BigIntCompat.pm: Add a module to make 'Math::BigInt's
	  stringify consistently (no '+' prefixing positive numbers).
	* perl/Makefile.am: Add Amanda/BigIntCompat.pm for installation, etc.
	* installcheck/bigint.pl, perl/amglue/bigint.c:
	  Use Amanda::BigIntCompat everywhere we use bigint.

2008-08-01 Nikolas Coukouma <atrus@zmanda.com>
	* common-src/match.c: Correct array index to be within bounds

2008-08-01 Nikolas Coukouma <atrus@zmanda.com>
	* config/amanda/flags.m4: Rename AMANDA_TEST_GCC_WARNING_FLAG to
	  AMANDA_TEST_GCC_FLAG and use AMANDA_ENABLE_GCC_WARNING where
	  appropriate. Add AMANDA_DISABLE_GCC_FEATURE. Disable strict-aliasing
	  (which causes errors).

2008-07-30  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Config.pl: add + to avoid perl-5.6.0 parsing bug
	* installcheck/amgetconf.pl: ditto

2008-07-29 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec:  Merged fixes from enterprise .spec for
	  parsing redhat-release for fedora versions correctly.

2007-07-28 Nikolas Coukouma <atrus@zmanda.com>
	* config/amanda/flags.m4: Add proper detection of flags for GCC 4.3+

2007-07-28 Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c: Calculate and send the MD5 hash when uploading data.
	  Also check the returned ETag to make sure it matches the sent MD5 hash.
	  Use simpler s3_base64_encode() instead of base64_encode().
	  Correct the use of character classes in several regular expressions.
	* device-src/s3-util.h, device-src/s3-util.c: Add utility functions
	  s3_base64_encode(), s3_hex_encode(), and s3_compute_md5_hash() as well
	  as some constants. Move regexec_wrap() into this and rename it to
	  s3_regexec_wrap().
	* device-src/Makefile.am: add s3-util.c and s3-util.h

2008-07-28  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Config.pm: don't set default tapetype
	  unless not set explicitly.
	* installcheck/Amanda_Config.pl: test changes
	* man/xml-source/amanda-client.conf.5.xml
	  man/xml-source/amanda.conf.5.xml: encourage, but don't require,
	  quoted identifiers

2008-07-28  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amserverconfig.pl: apply perltidy, factor some common
	  code, and create the config dir and changer conf only after the check
	  for mtx is performed

2008-07-28  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tests/semaphore-test.c: move function call out of
	  variable initialization

2008-07-25 Dan Locks <dwlocks@zmanda.com>
	* packaging/deb/control: added alternative dependency of libssl0.9.8 for
	  Ubuntu 8.x builds.  Added build dependencies for debhelper, fakeroot,
	  libcurl-dev, libssl-dev.  Updated server and client dependency for curl
	  to libcurl3

2008-07-18 Dan Locks <dwlocks@zmanda.com>
	*  configure.in:  add format-security to gcc compile flags
	*  server-src/amindexd.c,
	   server-src/dumper.c,
	   server-src/reporter.c,
	   restore-src/restore.c,
	   common-src/security-util.c,
	   common-src/bsd-security.c:  replacemented unquoted strings in
	   function arguments with "%s", arg.  jrfranks's suggestion, dustin provided
	   syntax for the fix.

2008-07-17 Dan Locks <dwlocks@zmanda.com>
	* packaging/debian/amanda-enterprise-backup-*.install: added entries for
	  applications and devices man pages.

2008-07-17  Jean-Louis Martineau <martineau@zmanda.com>
	* man/Makefile.am: Add amzfs-snapshot.8
	* man/xml-source/amzfs-snapshot.8.xml: New man page.
	* man/xml-source/amanda.8.xml: Add amzfs-snapshot.8
	* man/xml-source/amanda-scripts.7.xml: Add amzfs-snapshot.8
	* application-src/amzfs-snapshot.pl: New script
	* application-src/Makefile.am: Add amzfs-snapshot
	* perl/Amanda/Util.swg: Add sanitise_filename.

2008-07-17  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: amandad must be run by root for krb5 auth.

2008-07-16  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Improve message in failure to dump in degraded
			       mode.

2008-07-16 Dan Locks <dwlocks@zmanda.com>
	* packaging/deb/control,
	  packaging/rpm/amanda.spec: added explicit dependency on openssl, and a
	  build dependency for openssl and curl development files.

2008-07-15  Dustin J. Mitchell <dustin@zmanda.com>
	* example/xinetd.amandaserver.in example/xinetd.amandaclient.in:
	  specifying both IPv{4,6} does not work; remove IPv4

2008-07-15  Jean-Louis Martineau <martineau@zmanda.com>
	* man/Makefile.am: Add new man pages.
	* man/xml-source/script-email.8.xml: New man page.
	* man/xml-source/amanda.8.xml: List new man pages.
	* man/xml-source/amanda-scripts.7.xml: New man page.

2008-07-15  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in: generate (x)inetd files
	* example/inetd.conf.amandaclient.in example/xinetd.amandaclient.in
	  example/xinetd.amandaserver.in: give appropriate path for amandad,
	  from configure (fixes builds on 64-bit machines)
2008-07-15  Dustin J. Mitchell <dustin@zmanda.com>
	* client-src/client_util.c: #include "glib-util.h"
	* common-src/glib-util.c: New g_ptr_array_foreach fucntion.
	* common-src/glib-util.h: Prototype of g_ptr_array_foreach.
	* device-src/rait-device.c: Remove g_ptr_array_foreach.

2008-07-15  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: Read stdout of scripts.
	* client-src/client_util.h: New prototype for run_client_scripts,
				    New client_script_result_t struct.
	* client-src/sendbackup.c: Send scripts properties to application.
	* client-src/sendsize.c: Send scripts properties to application.
	* client-src/selfcheck.c: Send scripts properties to application.
	* recover-src/extract_list.c: Send scripts properties to application.
	* common-src/amxml.h (script_t) Add field to keep result of script.
	* common-src/amxml.c: Set script->result to NULL.

2008-07-14 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: fix macro detection of fedora version

2008-07-14 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: fix distribution detection, add
	activate-devpay to server files list

2008-07-11  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Changer.pl: set up and parse a config, now that
	  Amanda::Changer needs one

2008-07-11  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm: set device properties when testing device
	  labels in the changer

2008-07-11  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Add a DIRECTORY property.
	* man/xml-source/amgtar.8.xml: Document DIRECTORY property.

2008-07-11  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-lib.sh.in: remove bogus Log() invocations

2008-07-11  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.8.xml: fix amanda(8) formatting and add links
	  to new manpages

2008-07-11  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Device.pl: be more liberal in the flags that are
	  accepted from S3's read_label; this will reduce false failures

2008-07-11  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: Remove unused output_tool_property function.
	* client-src/client_util.h: Remove output_tool_property prototype.
	* man/xml-source/amanda-client.conf.5.xml: Add application and script
						   sections.
	* man/xml-source/amanda.conf.5.xml: Improve application and script
					    sections.
	* device-src/device.c: Fix for new property_t.
	* server-src/diskfile.h: Change prototype for xml_application and
				 xml_scripts.
	* server-src/diskfile.c: Add <priority> tag if client support it.
	* server-src/amindexd.c: Fix call to xml_application.
	* server-src/amcheck.c: Fix call to xml_application.
	* server-src/planner.c: Fix call to xml_application.
	* server-src/driverio.c: Fix call to xml_application.
	* server-src/server_util.c: Remove code to write property to stdin of
				    script.
	* perl/Amanda/Config.swg: Fix for new property_t.
	* perl/amglue/amglue.h: Prototype for g_hash_table_to_hashref_property.
	* perl/amglue/ghashtable.c: New g_hash_table_to_hashref_property
				    function.
	* installcheck/Amanda_Config.pl: Fix for new property_t.
	* common-src/util.c: Remove unused output_tool_proplist fucntion,
			     Fix for new property_t.
	* common-src/util.h: Remove output_tool_proplist prototype.
	* common-src/amxml.c:Fix for new property_t, parse priority of property.
	* common-src/conffile.c: Parse priority of a property,
			  Add application and script to amanda-client.conf.
	* common-src/conffile.h: New property_t struct.
	* common-src/amfeatures.h: New fe_xml_property_priority amfeature.
	* common-src/amfeatures.c: New fe_xml_property_priority amfeature.

2008-07-11  Jean-Louis Martineau <martineau@zmanda.com>
	* man/entities/global.entities: Add ENTITY email.jlm.
	* man/Makefile.am (CLIENT_MAN_PAGES): Set to amanda-applications.7,
	  amgtar.8 and amstar.8.
	* man/xml-source/amanda.conf.5.xml: Fix </programlisting>, it must be
					    at the begining of a line.
	* man/xml-source/amanda-applications.7.xml: New page.
	* man/xml-source/amgtar.8.xml: New page.
	* man/xml-source/amstar.8.xml: New page.

2008-07-09  Ian Turner <ian@zmanda.com>
	* device-src/device.h: Clarify documentation of device_read_label().
	* device-src/s3-device.c, device-src/tape-device.c,
	  device-src/vfs-device.c (device_read_label): Always clear volume
	  labels, even if device is in error.
	* device-src/rait-device.c: Ditto; also properly handle properties
	  that change device labels.

2007-07-09 Nikolas Coukouma <atrus@zmanda.com>
	* man/xml-source/amanda-devices.7.xml: Document the S3_BUCKET_LOCATION
	  property (for setting location constraints).

2008-07-08  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/vfs-device.c device-src/tape-device.c: do not autofinish
	  when EOF occurs on writing

2008-07-08  Dustin J. Mitchell <dustin@zmanda.com>,
	    Nikolas Coukouma <atrus@zmanda.com>,
	    Ian Turner <ian@zmanda.com>,
	    Jean-Louis Martineau <martineau@zmanda.com>
	Amanda has been analyzed with Klocwork source code analysis, the most
	accurate and comprehensive tool for finding critical programming
	errors and security vulnerabilities.
	* amandad-src/amandad.c changer-src/chg-scsi.c
	  client-src/client_util.c client-src/selfcheck.c
	  client-src/sendbackup.c client-src/sendsize.c common-src/amfeatures.c
	  common-src/bsd-security.c common-src/fileheader.c
	  common-src/local-security.c common-src/queueing.c
	  common-src/security-util.c device-src/property.c
	  device-src/rait-device.c device-src/tape-device.c
	  device-src/vfs-device.c recover-src/set_commands.c
	  restore-src/amidxtaped.c restore-src/amrestore.c restore-src/restore.c
	  server-src/amadmin.c server-src/amcheck.c server-src/amindexd.c
	  server-src/changer.c server-src/chunker.c server-src/cmdline.c
	  server-src/driver.c server-src/holding.c server-src/logfile.c
	  server-src/reporter.c server-src/server_util.c
	  server-src/taper-file-source.c: fix many issues identified
	  by Klockwork, ranging in severity from stylistic to minor.
	   - many memory leaks in error paths and application shutdown
	   - better handling of incorrect commandline arguments
	   - better resource management (file descriptors, etc.)

2008-07-07 Nikolas Coukouma <atrus@zmanda.com>
	* device-src/Makefile.am: conditionalize activate-devpay on
	  WANT_S3_DEVICE

2007-07-06 Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3-device.c, device-src/s3.c, device-src/s3.h,
	  device-src/activate-devpay.c, device-src/Makefile.am:
	  Allow both regular S3 and S3-with-DevPay to be used in
	  the same installation. Remove WANT_DEVPAY macro.
	* device-src/s3-device.c: Added a flag, is_devpay, to the device
	  and handled divergent cases. Removed useless device_error_set calls.
	* device-src/s3.c: Use DevPay authentication iff user_token is set.
	  Replaced some if statements about non-NULL pointers with assertions.
	* config/amanda/s3-device.m4, device-src/Makefile.am:
	  remove devpay flag and WANT_DEVPAY definition.
	* installcheck/Amanda_Device.pl: add tests for DevPay, refactor
	  other S3 tests.

2007-07-06 Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c: wait for bucket to appear after creation, treat
	  missing bucket as temporary error, increase retries from 5 to 14
	  (about 3min), explicitly handle HTTP verbs as libcurl expects.
	* installcheck/Amanda_Device.pl: remove (now-irrelvant) note about
	  buckets taking too long to appear.

2008-07-06 Dan Locks <dwlocks@zmanda.com>
	* packaging/deb/amanda-backup-server.postrm
	  packaging/deb/amanda-backup-client.postrm: removed unused
	  code
	* packaging/deb/postrm: fixed typo in deluser command
	* packaging/deb/rules: added specific preinst and postrm scripts for
	  client and server.

2008-07-03  Dustin J. Mitchell <dustin@zmanda.com>
	* man/Makefile.am man/amanda.css man/index.php man/xslt/html.xsl.in:
	  new files for HTML output
	* man/xslt/man.xsl.in: substitute XSLT_VERS
	* man/xml-source/amanda-devices.7.xml: tweaks
	* man/xml-source/amanda.8.xml: tweaks
	* man/xml-source/amanda.conf.5.xml: tweaks
	* man/xml-source/amgetconf.8.xml: tweaks
	* man/xml-source/amtoc.8.xml: tweaks

2008-07-03  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/genversion.c: correctly represent available amflock
	  implementations

2008-07-03  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Xfer.swg: #include "glib-util.h"

2008-07-02  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/rait-device.c: don't use self->device_name in open_device

2008-07-02  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amgetconf.pl: supply a plugin for scripts

2008-07-02  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c: Check an application is set if
	                         program == "APPLICATION".
	* common-src/amxml.c: Check plugin is set for application and script.
	* common-src/conffile.c: Check plugin is set for application and script

2008-07-02  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Fix printing of config path on error.

2008-07-02  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Device.pl: test that start(READ) without first
	  reading the label doesn't cause errors
	* device-src/s3-device.c: call s3_device_read_label directly

2008-07-02  Ian Turner <ian@zmanda.com>
	* man/xml-source/amanda.8.xml: Document how to override device
	  properties.

2008-07-02  Ian Turner <ian@zmanda.com>
	Dustin J. Mitchell <dustin@zmanda.com> contributed code and thoughts
	to this patch.
	* man/xml-source/amanda-devices.7.xml: Document new ERROR flag
	  to start RAIT device in degraded mode.
	* device/device.c: Be a little more forgiving of NULL devices.
	* device-src/vfs-device.c: Fix a bug where vfs_device_start()
	  would sometimes throw an erroneous assertion.
	* device-src/rait-device.c: Be much more robust in error handling;
	  new feature to start a RAIT device in degraded mode.
	* installcheck/Amanda_Device.pl: Enable more RAIT device tests.

2008-07-02  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amanda.h: remove unused #include <alloca.h>

2008-07-02  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tape-device.c: add "user" and "good" to feature flags
	* man/xml-source/amanda-devices.7.xml: document it

2008-07-01  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/device.h: fix comments to reflect removal of
	  autofinishing
	* device-src/tape-device.c: remove autofinishing

2008-07-01  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-lib.sh.in: also handle bare tape dev names

2008-07-01  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-lib.sh.in: fix tape_device_filename to not use perl
	* changer-src/chg-zd-mtx.sh: always use the unqualified hostname to
	  open the debug file

2008-06-30  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/match.c: fix multiple bugs in match_datestamp

2008-06-29  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm perl/Amanda/Cmdline.swg
	  perl/Amanda/Config.swg perl/Amanda/DB/Catalog.pm
	  perl/Amanda/Device.swg perl/Amanda/Logfile.swg
	  perl/Amanda/Util.swg: POD cleanup
	* perl/Makefile.am: new files, rules to make HTML
	* perl/amperl.css: CSS file for online POD
	* perl/make_html.pl: make online POD

2008-06-29  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am installcheck/amstatus.pl: new check

2008-06-27  Ian Turner <ian@zmanda.com>
	* server-src/taper.c: fix printing a NULL pointer in the error path

2008-06-27  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/device.c: check for and fail on multiple
	  short writes to the same file
	* device-src/null-device.c device-src/rait-device.c
	  device-src/s3-device.c device-src/tape-device.c
	  device-src/vfs-device.c: do not autofinish files
	* installcheck/Amanda_Device.pl installcheck/Amanda_Xfer.pl: don't
	  expect devices to autofinish anymore
	* server-src/taper.c xfer-src/dest-device.c: finish files explicitly
	* device-src/device-queueing.c: comments
	* xfer-src/xfer-element.h: comments

2008-06-27  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c device-src/s3.h device-src/s3-device.c installcheck/Amanda_Device.pl:
	  Add support for bucket location constraints
	* device-src/s3-device.c: Add S3_BUCKET_LOCATION device property
	* device-src/s3.c device-src/s3.h device-src/s3-device.c:
	  Checks for libcurl and bucket name compatability with location constraints
	* device-src/s3.c: make s3_init() threadsafe,
	  refactor regex compilation and calling,
	  refactor perform_request() functions to construct URL later,
	  use GString to tidy string generation
	* installcheck/Amanda_Device.pl: Add tests for location constraints

2008-06-27  Ian Turner <ian@zmanda.com>
	* device-src/rait-device.c: Fix a memory corruption issue on the last
	  block of a file.

2008-06-27  Ian Turner <ian@zmanda.com>
	* device-src/rait-device.c: Fix a memory corruption issue on the last
	  block of a file.

2008-06-27  Ian Turner <ian@zmanda.com>
	* device-src/rait-device.c: Track file numbers properly when child
	  devices change them (that is, in rait_device_start_file() and
	  rait_device_seek_file()).
	* installcheck/Amanda_Device.pl: Enable primary set of RAIT tests.

2008-06-27  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c (s3_device_read_label): Don't set
	  volume_header if nothing is read.

2008-06-27  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.c: Don't log is flag is DEVICE_STATUS_SUCCESS.

2008-06-27  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tape-posix.c: return DEVICE_ERROR|DEVICE_BUSY on EIO
	* changer-src/chg-lib.sh.in: keep waiting for a device if it *might*
	  be busy or offline

2008-06-26  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amstar.c: Use local start_time variable.
	* application-src/amgtar.c: Use local start_time variable.
	* common-src/clock.h: Remove times_zero and start_time extern.
	* common-src/clock.c: Remove times_zero.

2008-06-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c: Don't send encryption in xml req packet for
				 server encryption.

2008-06-25  Dustin J. Mitchell <dustin@zmanda.com>
	* application-src/amgtar.c: revert --atime-preserve change

2008-06-22  Dustin J. Mitchell <dustin@zmanda.com>
	* application-src/amgtar.c: change --atime-preserve=system to
	  --atime-preserve

2008-06-20  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amdump.pl: fix checks to refresh the test configuration

2008-06-20  Dustin J. Mitchell <dustin@zmanda.com>, Ian Turner <ian@zmanda.com>
	* server-src/amdump.sh: correctly handle error exits from planner
	* server-src/planner.c: fail if planning fails
	* installcheck/amdump.pl: test changes

2008-06-20 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: typo amanda-devices.7.gz

2008-06-20 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: added %{MANDIR}/man7/amanda-device.7.gz

2008-06-20  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: Call check_access() only
				    if getuid() == geteuid().
	* application-src/amgtar.c: check_dir(argument->dle.device, R_OK)

2008-06-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcleanup.pl: Correctly rename amdump files.

2008-06-19  Dustin J. Mitchell <dustin@zmanda.com>, Ian Turner <ian@zmanda.com>
	* man/Makefile.am man/xml-source/amanda-devices.7.xml: new manpage
	* man/entities/global.entities: emails for dustin and ian
	* man/xml-source/amanda.8.xml: refer to new manpage
	* man/xml-source/amanda.conf.5.xml: refer to new manpage
	* man/xml-source/amrecover.8.xml: refer to new manpage
	* server-src/amcheck.c: fix message regarding WORM media

2008-06-19  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amgetconf.pl: fail on bad parameters or subsections, but
	  not empty values or subsection lists
	* perl/Amanda/Config.swg: publish a list of subsections
	* installcheck/amgetconf.pl: test it

2008-06-19  Dustin J. Mitchell <dustin@zmanda.com>
	* example/template.d/amanda-single-tape.conf.in
	  example/template.d/amanda-harddisk.conf.in
	  example/template.d/amanda-tape-changer.conf.in
	  example/template.d/dumptypes example/template.d/amanda-S3.conf.in:
	  use application amgtar instead of program GNUTAR

2008-06-19  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/net.m4: AC_SUBST port ranges; update comments

2008-06-19  Satya Ganga <gsat@zmanda.com>
	* example/template.d/amanda-single-tape.conf.in
	  example/template.d/advanced.conf.in: update displayunit to "g" and
	  remove chg-manual for single tape configurations.

2008-06-19  Ian Turner <ian@zmanda.com>
	* device-src/rait-device.c (rait_device_start): Check for consistent
	  volume label on all child devices, fail with
	  DEVICE_STATUS_DEVICE_ERROR otherwise.
	* installcheck/Amanda_Device.pl: Test for foregoing.

2008-06-19  Paddy Sreenivasan <paddy@zmanda.com>
	* device-src/s3.h: use "https://ls.amazonaws.com/" as STS endpoint

2008-06-19  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: remove test_utils from SCRIPTS_PERL
	* config/automake/scripts.am: explain why

2008-06-18  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-manual.sh: Make it interruptible.

2008-06-18  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Remove check for amandates file.

2008-06-18  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amanda.h: Fix skip_quoted_string for "\\".
	* common-src/file.c: Fix debug_agets for "\\".

2008-06-18  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Report size of PART taped on 'dump to tape'.

2008-06-18  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendsize.c: Report error from application to server.
	* application-src/amgtar.c: Report exit status of tar.

2008-06-16  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Xfer.swg xfer-src/Makefile.am xfer-src/xfer-element.h
	  xfer-src/dest-device.c xfer-src/source-device.c: new elements
	  Amanda::Xfer:{Dest,Source}::Device
	* perl/Amanda/Xfer.swg: POD fix for Amanda::Xfer:Filter::Xor
	* installcheck/Amanda_Xfer.pl: tests for new elements

2008-06-16  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amservice.pl: add invocations of selfcheck for GNUTAR
	  and amgtar
	* installcheck/amservice.pl: put -f switches first

2008-06-15  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Config.pl: test config overwrites
	* common-src/conffile.c: don't segfault applying config overwrites
	  after config_init(0, NULL)

2008-06-13  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Run compression and encryption for
				   application-api.

2008-06-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Util.swg: Expose get_original_cwd.
	* application-src/amgtar_perl.pl, application-src/amoracle.pl:
	  chdir(get_original_cwd()) before restore.

2008-06-13  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/property.c device-src/property.h: remove tape properties
	* device-src/tape-device.c device-src/tape-device.h: add tape
	  properties

2008-06-12 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda_enterprise.spec,
	  packaging/rpm/amanda_enterprise_client.spec,
	  packaging/deb/rules: install amgtar and amstar suid root

2008-06-12  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c: Typo.

2008-06-11  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendsize.c: Check MAX-LEVEL from application.
	* server-src/planner.c: Ask for estimate even if SERVER, estimate is
	  valid if client return -1 and invelid if client return -2.
	* common-src/amfeatures.h: New fe_xml_estimate amfeature.
	* common-src/amxml.c: Parse <estimate> tag.
	* common-src/amxml.h (dle_t): New estimate field.
	* common-src/amfeatures.c: Set fe_xml_estimate.

2008-06-11  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c (application_property_add_to_argv):
	                           Add include and exclude.
	* client-src/client_util.h (application_property_add_to_argv):
	                           New prototype.
	* client-src/sendbackup.c, client-src/sendsize.c,
	  client-src/selfcheck.c, recover-src/extract_list.c:
	  Add bsu param to application_property_add_to_argv.
	* client-src/selfcheck.c: Check if application support includ/exclude.
	* application-src/amgtar_perl.pl: Don't support include/exclude.
	* application-src/amgtar.c: Support include-optional and
	                            exclude-optional.
	* common-src/amxml.c: Fix include/exclude parsing.

2008-06-11  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/Makefile.am: Install amgtar and amstar suid root.

2008-06-11  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c: Print cmdline before execing the application.
	* application-src/generic-dumper.pl: Cleanup.
	* application-src/script-oracle.pl: Cleanup.
	* application-src/script-email.pl: Cleanup.
	* application-src/amgtar_perl.pl: Cleanup.
	* application-src/generic-script.pl: Cleanup.
	* application-src/Makefile.am: Remove all scripts from CHECK_PERL.
	* perl/Amanda/Debug.swg: Typo.

2008-06-10  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/Makefile.am: don't use $(builddir), fix comparison
	* installcheck/Makefile.am: don't use $(builddir)

2008-06-10  Ian Turner <ian@zmanda.com>
	* common-src/fileheader.c: Silence a compiler warning.
	* device-src/rait-device.c: ditto.

2008-06-10  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/rait-device.c: hack around glib bug in versions <2.10.2
	  using the precompiler macro instead of glib_check_version, which
	  doesn't exist in every version of glib

2008-06-10 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec:  Replaced individual SBINDIR/am... entries
	  with SBINDIR/am* in %%files

2008-06-10  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Add pre&post recover scripts.

2008-06-09 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/buildpkg: added "|| exit 1" to any command which should
	  cause the script to fail.

2008-06-09 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: Changed individual SBINDIR/am... entries to
	  use a single SBINDIR/am* entry in %files

2008-06-09  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/fileheader.c: correctly free dle_str
	* device-src/device.c device-src/device.h: add volume_header Device
	  attributes
	* device-src/rait-device.c device-src/s3-device.c
	  device-src/tape-device.c device-src/vfs-device.c: populate
	  volume_header
	* server-src/amlabel.c: use volume_header to detect a non-empty tape
	  and require a force (-f) to overwrite it
	* server-src/taperscan.c: use volume_header to detect a non-empty tape
	  and require 'amlabel -f' to overwrite it
	* device-src/tape-device.c device-src/vfs-device.c: fix read_label
	  return values and remove useless chain-up calls

2008-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amservice.c: Open input file in read mode, prepend
				  get_original_cwd() to relative path.
	* installcheck/Makefile.am: Check amservice only on server.

2008-06-09  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Device.pl: skip all RAIT tests temporarily

2008-06-09  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.8.xml: add links to amservice

2008-06-07  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/ipv6.m4: remove redundant AC_SOCKADDR_STORAGE
	* configure.in: don't call AC_SOCKADDR_STORAGE

2008-06-07  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Xfer.pl: make AMANDA_TMPDIR if it doesn't exist

2008-06-07  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Run.pm: fix Installcheck::Run vtape
	  handling so that checks can load/unload vtapes "manually"

2008-06-07  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amdevcheck.pl: apply config_overwrites before printing
	  config errors

2008-06-07  Dustin J. Mitchell <dustin@zmanda.com>
	* application-src/amgtar_perl.pl application-src/amstar_perl.pl
	  application-src/generic-dumper.pl application-src/generic-script.pl
	  application-src/script-email.pl server-src/amgetconf.pl: add GPL
	  notice

2008-06-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amservice.c: Exit with 1 if the connection fail.
	* man/xml-source/amservice.8.xml: Document exit code.

2008-06-06  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/device.c: make device_set_error bulletproof to NULLs
	* device-src/tape-posix.c: fix compilation error when GMT_ONLINE is
	  not defined

2008-06-06  Jean-Louis Martineau <martineau@zmanda.com>
	* man/Makefile.am: Add amservice.8.
	* man/xml-source/amservice.8.xml: New man page for amservice.
	* server-src/amservice.c: New program to execute an amanda service
	                          on a client.
	* server-src/Makefile.am: Add amservice
	* installcheck/amservice.pl: New check for amservice program.
	* installcheck/Makefile.am: Add amservice

2008-06-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Don't quote dle_str.
	* common-src/fileheader.c: DLE= in header is like heredoc.

2008-06-06  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/*: major overhaul:
	  - add device_set_error to set error status and message for Device
	  - every error return from a device API method sets error status
	  - device_status_error is now threadsave
	  - a device in an error state will not perform further operations
	  - ensure Device attributes are set correctly by member functions
	  - device_open never returns NULL, but may return a null device with
	    error status set
	  - clearly define $device_name="$device_type:$device_node"
	  - send RAIT logging to the debug log
	  - vfs, tape devices don't touch the device until read_label or start
	  - on out-of-space in write, set is_eof, finish the file, and return
	    FALSE
	  - use accessor functions in Amanda::Device
	  - move device-specific properties to live with their devices
	  - change g_return_val_if_fail to g_assert or explicit checks
	  - remove most default Device methods, as they were more confusing
	    than helpful
	  - misc. other cleanup
	* device-src/null-device.h device-src/rait-device.h
	  device-src/s3-device.h device-src/vfs-device.h: removed to make most
	  device class declarations local to the source file
	* perl/Amanda/Device.swg: new error handling
	* perl/Amanda/Changer.pm restore-src/amrestore.c restore-src/restore.c
	  server-src/amcheck.c server-src/amcheckdump.pl
	  server-src/amdevcheck.pl server-src/amlabel.c server-src/amtape.c
	  server-src/taperscan.c: use new device error-handling
	* server-src/taper-file-source.c server-src/taper-port-source.c
	  server-src/taper-source.c: rename GObject constants (typo)
	* server-src/taper-source.h:
	* server-src/taper.c: handle opening devices better, log on EOM
	* common-src/glib-util.c: g_english_strjoinv: handle one-element lists
	  correctly
	* installcheck/amdevcheck.pl: volume-unlabeled message has changed
	* installcheck/Amanda_Device.pl perl/Amanda/Tests.swg: test all device
	  classes
	* configure.in device-src/tests/: removed
	* device-src/vfs-test.c: moved from device-src/tests/

2008-06-06  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Don't write the uncompression program if
				   it is not client compressed.

2008-06-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: Log no-tape line.

2008-06-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Improve formating.

2008-06-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: start the degraded mode if it receive
			       NO-NEW-TAPE from taper.

2008-06-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheckdump.pl: Check log fiels in directory if find_log
				     find no log for the timestamps.

2008-06-05  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c common-src/conffile.h: expose config_add_error
	* server-src/diskfile.c server-src/diskfile.h: use config_add_error
	  to send diskfile errors to conffile's error-handling mechanism
	* restore-src/amfetchdump.c server-src/amadmin.c server-src/amcheck.c
	  server-src/amcleanupdisk.c server-src/amflush.c server-src/amindexd.c
	  server-src/amtrmidx.c server-src/amtrmlog.c server-src/driver.c
	  server-src/planner.c: parse disklist along with config

2008-06-04  Jean-Louis Martineau <martineau@zmanda.com>
	And Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda-client.conf.5.xml: Document property.
	* installcheck/Amanda_Config.pl: Add test for client property.
	* common-src/conffile.c (client_var): Add CONF_PROPERTY.

2008-06-03  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Types.swg: Add dle_str to dumpfile_t.
	* common-src/fileheader.c: Don't print NULL dle_str.

2008-06-03  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amfeatures.h: Rename fe_amrecover_dle to fe_amindexd_DLE,
				   add fe_amrecover_dle_in_header.
	* common-src/amfeatures.c: Set fe_amrecover_dle_in_header.
	* recover-src/set_commands.c: Use fe_amindexd_DLE.
	* server-src/dumper.c: Set dle_str and add it to the header.
	* restore-src/restore.c: Remove dle_str is client doesn't have
				 fe_amrecover_dle_in_header.
	* common-src/fileheader.c: Parse and set dle_str from header.
	* common-src/fileheader.h: Add dle_str in dumpfile_t.

2008-06-03  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amdump.8.xml, man/xml-source/amreport.8.xml,
	  man/xml-source/amcheck.8.xml, man/xml-source/amflush.8.xml,
	  man/xml-source/amstatus.8.xml: Add "EXIT CODE" section".

2008-06-03  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (parm_key_info): Don't fold '-' to '_' in
						 subsec_name.
	* installcheck/amgetconf.pl: Fix and add more tests.

2008-06-03  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amxml.c: give parse error on an empty "disk" element
	* server-src/diskfile.c: give parse error on an empty "disk" element

2008-05-30  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Remove unneeded pointer cast.
	* common-src/stream.c: Fix compiler error.

2008-05-30  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Config.pm: fix subsection inheritance

2008-05-30  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amanda.h, common-src/bsd-security.c,
	  common-src/bsdtcp-security.c, common-src/bsdudp-security.c,
	  common-src/dgram.c, common-src/dgram.h, common-src/krb5-security.c,
	  common-src/security-util.c, common-src/security-util.h,
	  common-src/sockaddr-util.c, common-src/sockaddr-util.h,
	  common-src/stream.c, common-src/util.c, common-src/util.h,
	  restore-src/amidxtaped.c, server-src/amindexd.c: add sockaddr_union,
	  change all relevant functions to use it, to avoid aliasing violations

2008-05-30  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (lookup_keyword): Use temporary variable.
	* installcheck/Amanda_Config.pl:  Check insentivity of -/_ in amanda
					  keyword.
	* installcheck/Installcheck/Config.pm: Adjust to make the subsection
					       inheritance work.

2008-05-30  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Send properties from dump_dle to
				      application plugin.

2008-05-30  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: New *-RECOVER scripts.
	* application-src/script-email.pl: Add new *-RECOVER scripts.
	* application-src/generic-script.pl: Add new *-RECOVER scripts.
	* application-src/amstar.c: Fix.
	* application-src/amgtar.c: Fix.
	* recover-src/amrecover.c: Add a global dump_dle variable.
	* recover-src/extract_list.c: Call run_client_scripts for *-RECOVER
				      scripts.
	* recover-src/amrecover.h: Add an extern dump_dle variable.
	* recover-src/set_commands.c: Send to amindexd the DLE command.
	* server-src/amindexd.c: Handle the DLE command.
	* server-src/server_util.c: Add *-RECOVER scripts, they can't be
				    executed on server.
	* server-src/diskfile.c (xml_scripts): Add *-RECOVER scripts.
	* common-src/amfeatures.h: New fe_amrecover_dle amfeature.
	* common-src/amfeatures.c (am_init_feature_set): Add fe_amrecover_dle.
	* common-src/amxml.c: Add *-RECOVER scripts.
	* common-src/conffile.c: Add *-RECOVER scripts.
	* common-src/conffile.h: Add *-RECOVER scripts.

2008-05-29  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c: make config insensitive to
	  differences between '-' and '_'
	* man/xml-source/amanda-client.conf.5.xml
	  man/xml-source/amanda.conf.5.xml
	  man/xml-source/amgetconf.8.xml: document it
	* installcheck/Amanda_Config.pl installcheck/amgetconf.pl: update
	  tests

2008-05-29  Orion Poplawski <orion@cora.nwra.com>
	* server-src/chunker.c: fix buffer overrun

2008-05-29  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (client_keytab): Remove "DEVICE-PROPERTY".

2008-05-28  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/rait-device.c: rait-device returns correct size when
	  blocksize is too small

2008-05-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Fix ignoring pid line.

2008-05-27  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/ps.m4: Define PS_ARGUMENT to CYGWIN on cygwin.
	* perl/Amanda/Process.pm: Works with PS_ARGUMENT eq "CYGWIN".

2008-05-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: use lib '@amperldir@';
	* perl/Amanda/Process.pm: use Amanda::Constants;

2008-05-26  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/rait-device.c: temporarily remove the call to set the
	  BLOCK_SIZE property on all RAIT children, as it fails with VFS
	  devices
	* device-src/rait-device.c: rewrite g_ptr_array_union_robust to
	  correctly detect and handle child device failures
	* common-src/fileheader.c: fix parse_file_header to be threadsafe

2008-05-25  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-aix.c, device-src/tape-xenix.c
	  device-src/tape-posix.c: tape_is_ready take a (TapeDevice *) argument
	* device-src/tape-posix.c (tape_is_ready): Check for broken_gmt_online.
	* device-src/property.c: Add broken_gmt_online property.
	* device-src/property.h: Add PROPERTY_BROKEN_GMT_ONLINE.
	* device-src/tape-device.c: Use broken_gmt_online property.
	* device-src/tape-device.h (TapeDevice): Add broken_gmt_online field.
	* device-src/tape-ops.h (tape_is_ready): Change prototype.

2008-05-25  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-zd-mtx.sh: Fix logging.

2008-05-25  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/rpm/amanda.spec: Fix output message.

2008-05-25  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/Makefile.am common-src/simpleprng.c
	  common-src/simpleprng.h: new simple PRNG module for
	  reproducible use in tests (bitlength bug fixed).
	* xfer-src/dest-null.c: verify stream against PRNG
	* xfer-src/source-random.c: use PRNG to create stream
	* installcheck/Amanda_Xfer.pl: verify streams in xfers
	* perl/Amanda/Xfer.swg: use PRNG
	* xfer-src/xfer-element.h xfer-src/xfer-test.c: use
	  PRNG to test glue elements

2008-05-23  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_MainLooop.pl: handle SIGCHILD while
	  reading from dying child

2008-05-22  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/xfer-test.c: don't try to write to a file in the
	  source directory

2008-05-22  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Process.pm (load_ps_table): Fix split.

2008-05-22  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in: Call AMANDA_PS_ARGUMENT
	* config/amanda/ps.m4 (AMANDA_PS_ARGUMENT): New macro to find ps
						    argument.
	* perl/Amanda/Constants.pm.in: Add PS_ARGUMENT.
	* perl/Amanda/Process.pm (load_ps_table): Use PS_ARGUMENT.

2008-05-22  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Process.pm: process_alive return '' if the process is
				  dead.
	* installcheck/Amanda_Process.pl: New module to check Amanda::Process.
	* installcheck/Makefile.am (server_tests): Add Amanda_Process.

2008-05-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Add "failed: killed while" to some status if
				  the driver process is dead.
	* perl/Amanda/Process.pm: New process_alive function.

2008-05-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c server-src/planner.c, server-src/chunker.c,
	  server-src/amflush.c, server-src/driver.c, server-src/taper.c,
	  restore-src/amidxtaped.c, restore-src/restore.c,
	  restore-src/amfetchdump.c: Convert all pid_t to long before printing.

2008-05-21  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amcleanup.8.xml: Document new -p option.
	* server-src/logfile.c (program_str): Add many programs.
	* server-src/logfile.h (program_e): Add many programs.
	* server-src/dumper.c, server-src/planner.c,
	  server-src/chunker.c, server-src/amflush.c,
	  server-src/driver.c, server-src/taper.c,
	  restore-src/amidxtaped.c, restore-src/restore.c,
	  restore-src/amfetchdump.c,
	  server-src/amdump.sh: Log pid and pid-done lines, call run_amclenup.
	* server-src/server_util.c (run_amcleanup): New function to run
						    amcleanup.
	* server-src/server_util.c (get_master_process): New function get the
				 name of the first pid line in a log file.
	* server-src/server_util.h (run_amcleanup): Prototype.
	* server-src/server_util.h (get_master_process): Prototype.
	* server-src/reporter.c: Ignore pid and pid-done lines.
	* server-src/amcleanup.pl: New amcleanup program written in perl.
	* server-src/Makefile.am: Move amcleanup from SCRIPTS_SHELL to
				  SCRIPTS_PERL.
	* server-src/amcleanup.sh: Old program removed.
	* perl/Amanda/Process.pm: New module to hanlde amanda process.
	* perl/Makefile.am: Add Amanda/Process.pm to Amanda_DATA and EXTRA_DIST

2008-05-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Fix quoting of diskname.

2008-05-20  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in config/amanda/socklen_t_equiv.m4: detect the type (not
	  necessarily socklen_t used by getpeername et al.
	* amandad-src/amandad.c server-src/amindexd.c restore-src/amidxtaped.c
	  common-src/util.c common-src/bsdtcp-security.c common-src/amanda.h
	  common-src/krb5-security.c common-src/dgram.c common-src/stream.c:
	  use the type instead of socklen_t

2008-05-20  Jean-Louis Martineau <martineau@zmanda.com>
	    Dustin J. Mitchell <dustin@zmanda.com>
	    John Franks <jrfranks@zmanda.com>
	* server-src/amstatus.pl: quote disknames in amstatus
	* server-src/Makefile.am: don't check amstatus (since it
	  uses Amanda::* libs)
	* perl/Amanda/Util.swg: add (un)quote_string
	* installcheck/Amanda_Util.pl installcheck/Makefile.am: test it

2008-05-16  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Fix conf_parserror use.

2008-05-15  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am installcheck/Makefile.am Makefile.am: only build
	  XFA in server builds

2008-05-15  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Parse send-amreport-on.
	* common-src/conffile.h (send_amreport_t): New enum for possible value
						   of send-amreport-on.
	* server-src/reporter.c: Use send-amreport-on setting.
	* perl/Amanda/Config.swg: Define send_amreport_on_t constants.
	* man/xml-source/amanda.conf.5.xml: Document send-amreport-on.

2008-05-15  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c (application_property_argv_size): New
	  function to count the number of argument needed to store all
	  properties of an application for + * a dle in an ARGV.
	* client-src/client_util.c (application_property_add_to_argv): New
	  function to add all properties of an application for a dle to an ARGV.
	* client-src/client_util.h (application_property_argv_size,
				  application_property_add_to_argv): Prototype.
	* client-src/sendbackup.c, client-src/sendsize.c,
	  client-src/selfcheck.c: Use new functions to pass properties as
				  argument to application plugin.
	* application-src/script-email.pl, application-src/amstar.c,
	  application-src/generic-script.pl,
	  application-src/amgtar.c: Get properties from command line.
	* server-src/server_util.c: Use new functions to pass properties as
				    argument to pre/post script.
	* common-src/util.c (count_proplist): Callback function to count the
					      number of values of a property.
	* common-src/util.c (proplist_add_to_argv): callback function to store a
					property and it's value in an ARGV.
	* common-src/util.h (count_proplist, proplist_add_to_argv): Prototype.
	* common-src/conffile.c (property_argv_size): New function to count the
						      number of properties.
	* common-src/conffile.c (property_add_to_argv): New function to store a
					property and it's value in an ARGV.
	* common-src/conffile.h (property_argv_size,
				 property_add_to_argv): Prototype.

2008-05-15  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/Makefile.am: add element-glue.h to the distribution
	* xfer-src/element-glue.h: add 'extern'
	* xfer-src/xfer-test.c: fix test elements
	* xfer-src/xfer.c: don't use the sometimes-undefined constant
	  G_MAXINT32
	* xfer-src/source-random.c: Only use 'prolong' for threads, not
	  push/pull methods
	* installcheck/Amanda_Xfer.pl: Check the content of $msg->{message} in
	  XMSG_INFO

2008-05-14  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/xfer-element.h xfer-src/xfer.c xfer-src/dest-null.c
	  xfer-src/source-random.c xfer-src/xfer-test.c
	  xfer-src/element-glue.c xfer-src/xmsg.h xfer-src/dest-fd.c
	  xfer-src/source-fd.c xfer-src/element-glue.h
	  xfer-src/Makefile.am xfer-src/filter-xor.c
	  xfer-src/xfer-element.c perl/Amanda/Xfer.swg: new organization
	  of transfer mechansims and new algorithm for linking xfers, with
	  expanded unit tests to exercise new glue elements
	* installcheck/Amanda_Xfer.pl: updated installchecks
	* common-src/semaphore.h: fix comment typo
	* common-src/testutils.c common-src/testutils.h: optionally skip
	  timeouts (-t), and only show g_debug messages if -d is given

2008-05-14  Dustin J. Mitchell <dustin@zmanda.com>
	* client-src/amhpfixdevs.sh client-src/Makefile.am
	  client-src/amsinixfixdevs.sh config/amanda/devprefix.m4:
	  permanently remove amsinixfixdevs and amhpfixdevs

2008-05-12  Jean-Louis Martineau <martineau@zmanda.com>
	  Patch by Orion Poplawski
	* server-src/planner.c: Warn about overwrite of last level 1, and
	  force backup of level 1 if overwrite on this run.

2008-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Define default tapetype.

2008-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c (tape_validate_properties): New function to
	  validate properties.

2008-05-07  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amdevcheck.8.xml: Add an OUTPUT section.

2008-05-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Check the tapetype is defined.

2008-05-07  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c: Allow user to set "read_buffer_size"
				    property.
	* restore-src/amrestore.c: Don't limit blocksize to
				   --with-maxtapeblocksize.
	* common-src/conffile.c: Increase readblocksize to blocksize.
	  blocksize and readblocksize can be bigger than
	  --with-maxtapeblocksize.

2008-05-06  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add a 'mailer' config parameter.
	* common-src/conffile.h: Add CNF_MAILER.
	* changer-src/chg-scsi-chio.c, changer-src/chg-scsi.c
	  changer-src/chg-manual.sh, application-src/script-email.pl
	  server-src/amcheck.c server-src/amgetconf.pl
	  server-src/reporter.c: Use mailer from config.
	* perl/Amanda/Config.swg: amglue_add_constant(CNF_MAILER, confparm_key)
	* config/amanda/progs.m4: Set DEFAULT_MAILER.
	* common-src/amanda-sh-lib.sh.in: Don't set MAILER.
	* man/xml-source/amanda-client.conf.5.xml,
	  man/xml-source/amanda.conf.5.xml,
	  man/xml-source/amgetconf.8.xml: Update man pages.

2008-05-02 Dan Locks <dwlocks@zmanda.com>
 	* packaging/rpm/amanda.spec:  Replace ${ with %{ where applicable.

2008-05-02 Dan Locks <dwlocks@zmanda.com>
	*  packaging/deb/amanda-enterprise-backup-server.postinst
	   packaging/rpm/amanda_enterprise.spec:  Change .am_passphrase to a
	   semi-random number in both packages.

2008-04-29  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/dirs.m4: note that --with-dumperdir is
	  deprecated in ./configure --help


2008-04-28  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c: Fix test for DEVICE_STATUS_SUCCESS.

2008-04-28  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/Makefile.am xfer-src/xfer-element.h xfer-src/dest-fd.c
	  xfer-src/source-fd.c perl/Amanda/Xfer.swg: add new
	  Amanda::Xfer::Source::Fd, Amanda::Xfer::Dest::Fd
	* xfer-src/source-random.c xfer-src/xfer.c xfer-src/dest-null.c
	  xfer-src/xfer.h xfer-src/filter-xor.c xfer-src/xfer-element.c:
	  reorganize detection of transfer completion, to handle cases where
	  elements don't do any active processing
	* installcheck/Amanda_Xfer.pl: test it all

2008-04-24  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Correctly print truncated quoted diskname.

2008-04-23  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_MainLoop.pl common-src/event-test.c
	  common-src/queueing-test.c: try to make tests more resilient
	  to heavily-loaded, slow machines

2008-04-23  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Typo.

2008-04-23  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Always sent a FAILED to taper if dumper failed.
	* common-src/event.c: Check event is not dead before fire it.

2008-04-23  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Fix vstrextend use.

2008-04-23  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/event.c: use internal child_watch_source
	  for glib <2.6.0; versions 2.4.0 to 2.6.0 use unreliable
	  signals and are thus unreliable

2008-04-22  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Logfile.swg server-src/find.c server-src/find.h: add
	  parsing of 'sec' and 'kb' from logfile messages
	* perl/Amanda/DB/Catalog.pm perl/Makefile.am: new module
	* installcheck/Amanda_DB_Catalog.pl installcheck/Makefile.am: checks
	  for new module

2008-04-22  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/event.c: on glib <2.4.0, use a simple polling
	  child_watch_source; on more recent glib, use glib's own
	  child_watch_source

2008-04-22  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/source-random.c xfer-src/xmsg.c xfer-src/xfer-element.h
	  xfer-src/xfer-dest.c xfer-src/xfer-test.c xfer-src/xmsg.h
	  xfer-src/xfer.c xfer-src/xfer-dest.h xfer-src/dest-null.c
	  xfer-src/xfer.h xfer-src/filter-xor.c xfer-src/xfer-element.c:
	  - flatten XferElement hierarchy to one level
	  - change test element argument order
	  - rename XMsg.src to Xmsg.elt
	  - Improve memory management (refcounting, perl interface)
	* perl/Amanda/Changer.pm perl/Amanda/Xfer.swg
	  perl/Amanda/MainLoop.swg perl/Makefile.am
	  perl/amglue/amglue.h perl/amglue/source.c:
	  - rewrite handling of amglue_Source for better refcounting
	  - Amanda::MainLoop callbacks get the event source as 1st argument,
	    and will be called even if the event source goes out of scope in
	    perl
	  - MainLoop.swg significantly rewritten to get refcounting right
	* installcheck/Amanda_Xfer.pl: new checks (without excessive use of
	  file descriptors)
	* installcheck/Amanda_MainLoop.pl installcheck/Makefile.am: updated
	   checks

2008-04-22  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-posix.c: Don't return DEVICE_STATUS_VOLUME_MISSING
				   on ioctl error.
	* changer-src/chg-lib.sh.in (amdevcheck_status): return 1 only if the
			 possible errors are VOLUME_MISSING or DEVICE_BUSY.

2008-04-22  Kevin Zembower <kzembowe@jhuccp.org>
	* man/xml-source/amflush.8.xml: add amflush example

2008-04-22  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c: Move all device access from
	  tape_device_open_device to tape_device_read_label.
	  tape_device_start read the label if it is not already read.
	* device-src/vfs-device.c (vfs_device_open_device): remove read of the
							    label.

2008-04-22  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c (check_resetofs): Compilation fix if
						     NEED_RESETOFS is defined.
	* device-src/tape-posix.c: Handle no ENOMEDIUM.

2008-04-21  Dan Locks <dwlocks@zmanda.com>
	* packaging/deb/buildpkg: modified build script to create unsigned
	  packages

2008-04-21  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-lib.sh.in (amdevcheck_status):
	  Set amdevcheck_message.
	* changer-src/chg-chs.sh, changer-src/chg-juke.sh,
	  changer-src/chg-manual.sh, changer-src/chg-zd-mtx.sh,
	  changer-src/chg-multi.sh: Output amdevcheck_message
	* device-src/device.c: Set errmsg and status.
	  device_open always return a device, the status and errmsg are set.
	* device-src/device.h: Define DeviceStatusFlags.
	* device-src/null-device.c, device-src/s3-device.c,
	  device-src/tape-device.c, device-src/vfs-device.c,
	  device-src/rait-device.c: Set errmsg and status.
	* device-src/tape-posix.c: Return status for VOLUME_MISSING.
	* device-src/tape-ops.h: Remove TapeCheckResult.
	* server-src/taper-source.h (_TaperSource): Add errmsg.
	* server-src/taper-source.c: Set errmsg
	* server-src/amcheck.c, server-src/amtape.c, server-src/amlabel.c,
	  server-src/taperscan.c, restore-src/amrestore.c,
	  restore-src/restore.c: Use status and errmsg of a device.
	* server-src/taper-disk-port-source.c: Set errmsg.
	* server-src/reporter.c: Fix parsing of taper PARTIAL line.
	* server-src/taper.c: Use errmsg for device and _TaperSource.
	* server-src/taper-file-source.c: Set errmsg.
	* server-src/amcheckdump.pl,
	  server-src/amdevcheck.pl: Use status and errmsg from device.
	* perl/Amanda/Changer.pm: Fix for DEVICE_STATUS_*.
	* perl/Amanda/Device.swg: New interface.
	* installcheck/Makefile.am: Don't print some commands.
	* installcheck/Amanda_Device.pl: Check new device api.
	* common-src/queueing.c: Use new queue_fd_t.
	* common-src/queueing.h (queue_fd_t): new struct.
	* common-src/amanda-sh-lib.sh.in: Fix bug.
	* common-src/queueing-test.c: Use queue_fd_t.

2008-04-21  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amgetconf.pl: properly quote filenames in
	  regex, to avoid spurious failures when e.g., '+' appears
	  in the filename

2008-04-18  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm: rewrite Amanda::Changer to use
	  Amanda::MainLoop, allowing asynchronous operation of
	  changers
	* server-src/amcheckdump.pl: use new Amanda::Changer
	  interface (synchronously, until we have Amanda::Xfer)
	* installcheck/Amanda_Changer.pl: test new interface

2008-04-18  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: build $(full_tests) too

2008-04-18  Cyrille Bollu <Cyrille.Bollu@fedasil.be>
	* client-src/sendsize.c: use --numeric-owner during 'sendsize'

2008-04-17  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: segregate installchecks that require
	  both client and server components

2008-04-17  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/debug.c: add Amanda version to debug logs

2008-04-16  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Util.swg common-src/util.c common-src/util.h: add
	  process type and context process attributes
	* perl/Amanda/Debug.swg common-src/debug.c common-src/debug.h: add
	  debug_init to set up debugging according to the process context, and
	  log nothing in CONTEXT_SCRIPTUTIL
	* server-src/amgetconf.pl server-src/amdevcheck.pl:
	  CONTEXT_SCRIPTUTIL
	* server-src/amcheckdump.pl: use new $CONSTANT_CMDLINE variable
	* installcheck/Amanda_Debug.pl: add comment

2008-04-16  Dan Locks <dwlocks@zmanda.com>
	* Fixes to debian package reported by daniel_P
	* packaging/deb/preinst: remove spaces near ${amanda_group}
	* packaging/deb/amanda-backup-server.dirs
	  packaging/deb/amanda-backup-client.dirs: added var/amanda and
	  usr/share/lintian/overrides
	* packaging/deb/rules: added logic to find PERLSITELIB and append that
	  to amanda-backup-server.install, removed broken brace expansion
	* packaging/deb/buildpkg: removed extraneous configure step
	* packaging/deb/amanda-backup-server.postinst: added check for correct
	  permissions on /tmp/amanda

2008-04-16  Dan Locks <dwlocks@zmanda.com>
	* packaging/deb/rules packaging/rpm/amanda.spec: remove --with-gnutar=
	  from configure invocation.  no longer necessary.

2008-04-16  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3.c config/amanda/s3-device.m4: test curl features
	  at runtime, instead of compile time, and always use SSL if it
	  is available.

2008-04-16  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c: Improve message.
	* man/xml-source/amanda.conf.5.xml: Fix man page.
	* server-src/planner.c: Fix DS_INCRONLY and FORCE_FULL.

2008-04-16  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/dumpers.m4: continue searching for gnutar if we
	  find a binary claiming to be gnu tar that is not.  This gets
	  around serious breakage on Ubuntu, where star is installed as
	  /bin/gnutar, but /bin/tar is actually GNU Tar.

2008-04-15  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/file.c(mk1dir): fix reversed conditional to handle
	  a race condition

2008-04-15  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/debug.c (debug_logging_handler, debug_printf): Don't print
	  msg_timestamp() to stderr.

2008-04-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Call error() only after set_logerror is done.
	* server-src/planner.c: Call error() only after set_logerror is done.
	* server-src/chunker.c: Report a better error message.
	* common-src/stream.c: Set errno to ETIMEDOUT after a timeout.

2008-04-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c (dumps_match_dumpspecs): New function to only keep
	  dumps that match a dumpspecs, using it simplify amfetchdump.
	* server-src/find.h (dumps_match_dumpspecs): Prototype.
	* restore-src/amrestore.c: Add a first_restored_file to
	  search_a_tape(), to allow restore ot stop after the first image.
	* restore-src/restore.c: Set first_restored_file, it was never set,
	  it's needed to stop after the first image.
	* restore-src/restore.c (restore_from_tapelist): break if piping to
	  stdout.
	* restore-src/amfetchdump.c: Use dumps_match_dumpspecs.
	* restore-src/amfetchdump.c: If -p, the keep only one dump.
	* perl/Amanda/Logfile.swg (dumps_match_dumpspecs): New prototype.
	* perl/Amanda/Cmdline.swg: cmdline_parse_dumpspecs.
	* perl/amglue/dumpspecs.swg: Map dumpspecs to perl.
	* perl/Makefile.am (AMGLUE_SWG): Add amglue/dumpspecs.swg.
	* installcheck/Amanda_Logfile.pl: Add many tests.

2008-04-15  Jean-Louis Martineau <martineau@zmanda.com>
	* tape-src/tapetype.c: Initialize an default config.

2008-04-15  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c (connect_portrange, connect_port, bind_portrange):
	  Return the latest errno reported.

2008-04-08  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c common-src/conffile.h
	  perl/Amanda/Config.swg installcheck/Amanda_Config.pl:
	  new interface for config errors, re-introduce rawtapedev for
	  deprectation purposes
	* installcheck/Installcheck/Config.pm: support test
	  amanda-client.conf files
	* installcheck/Installcheck/Run.pm: add get_stdout, get_stderr
	* client-src/client_util.c client-src/client_util.h: add
	  config_errors_to_error_string
	* server-src/dumper.c server-src/planner.c: handle ERRORs and NAKs
	  better, so users see client-side config errors
	* oldrecover-src/amrecover.c changer-src/chg-scsi-chio.c
	  changer-src/chg-scsi.c client-src/sendbackup.c client-src/sendsize.c
	  client-src/selfcheck.c amandad-src/amandad.c application-src/amstar.c
	  application-src/amgtar.c recover-src/amrecover.c
	  server-src/amlogroll.c server-src/amindexd.c server-src/amcheck.c
	  server-src/amgetconf.pl server-src/chunker.c server-src/amadmin.c
	  server-src/amtape.c server-src/amcheckdump.pl
	  server-src/amcleanupdisk.c server-src/amflush.c server-src/amtrmlog.c
	  server-src/driver.c server-src/reporter.c server-src/taper.c
	  server-src/amdevcheck.pl server-src/amtrmidx.c server-src/diskfile.c
	  server-src/amlabel.c installcheck/Amanda_Changer.pl
	  installcheck/Amanda_Device.pl installcheck/Amanda_Logfile.pl
	  installcheck/Amanda_Tapelist.pl restore-src/amidxtaped.c
	  restore-src/amrestore.c restore-src/amfetchdump.c: adapt to new config
	  error interface

2008-04-08  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/diskfile.c: improve messages when client does not
	  support required features

2008-04-08  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Config.pl common-src/conffile.c
	  common-src/conffile.h: fix deprecation of keywords to
	  actually issue a warning.  'netusage' is no longer
	  deprecated.

2008-04-08  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/event.c: use SA_RESTART for child_watch_source

2008-04-07  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/MainLoop.swg perl/amglue/source.c
	  installcheck/Amanda_MainLoop.pl: wrap GMainLoop and the
	  GSources defined in event.c, using an extensible model
	* common-src/event.c: check whether child_watch_source's signal
	  handler has been replaced, and issue a warning if it has.

2008-04-07  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/queueing.c: fix condition (thanks to Jean-Louis
	  Martineau)

2008-04-07  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/Makefile.am common-src/queueing-test.c: new tests
	* device-src/tests/queue_test.c device-src/tests/Makefile.am: remove
	* common-src/queueing.c: fix two bugs:
	  - spurious in-place memmove on every buffer copy
	  - silent discard of a final packet if the consumer does not
	    completely consume it
	* common-src/queueing.h: update comments
	* common-src/testutils.h: add header-protection macros

2008-04-07  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am installcheck/Amanda_Device.pl: Add tests
	  for Amanda::Device

2008-04-07  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: fix typos

2008-04-04  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/*.xml: Use ulink tag to link to wiki.zmanda.com.

2008-04-04  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c: Check last_header->type != F_UNKNOWN.

2008-04-01  Dustin J. Mitchell <dustin@zmanda.com>
	Suggested by Sunil Sawant <sunil@zmanda.com>
	* man/xml-source/amrecover.8.xml: suggest including a config in the
	  amrecover command line

2008-04-01  John Franks <jfranks@zmanda.com>
	* gnulib/regenerate/regenerate gnulib/regenerate/no-restrict.patch:
	  Patches to reapply after gnulib updates.
	* gnulib/inet_ntop.c gnulib/inet_ntop.h gnulib/string.in.h
	  gnulib/gettimeofday.c gnulib/sys_time.in.h gnulib/base64.c
	  gnulib/getaddrinfo.c gnulib/Makefile.am gnulib/base64.h
	  gnulib/getaddrinfo.h:
	  Remove restricted keywords from source files.

2008-04-01  Satya Ganga <gsat@zmanda.com>
	* example/template.d/amanda-S3.conf.in: S3 device should have
	  "infinite" tape length

2008-03-31  John Franks <jfranks@zmanda.com>
	* common-src/stream.c
	  Fix warning about ininitialized variables.

2008-03-31  John Franks <jfranks@zmanda.com>
	* oldrecover-src/Makefile.am xfer-src/Makefile.am
	  recover-src/Makefile.am server-src/Makefile.am
	  restore-src/Makefile.am:
	  Fix build problems with multiply defined symbols.

2008-03-31  Dan Locks <dwlocks@zmanda.com>
	* packaging/deb/buildpkg
	  packaging/rpm/buildpkg: added -p to cp to preserve file timestamps.

2008-03-31  Dustin J. Mitchell <dustin@zmanda.com>, Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup-gnutar.c client-src/sendsize.c
	  client-src/selfcheck.c: update amandates whenever possible, but only
	  complain when it is really needed: when using calcsize, or when
	  using GNUTAR and --without-gnutar-listdir.
	* client-src/amandates.c: Set errno before return of start_amandates
	* perl/Amanda/Paths.pm.in: always terminate a perl mod with '1;'

2008-03-31  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amgetconf.pl: Parse config after setup_applccation call.

2008-03-31  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Check errno after full_read.

2008-03-31  Dan Locks <dwlocks@zmanda.com>
	* packaging/Makefile.am: add deb subdirectory.

2008-03-31  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/rsh-security.c common-src/ssh-security.c: improve error
	  messages for resolve_hostname calls

2008-03-27  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/util.c common-src/util.h: remove fullread(), fullwrite()
	* gnulib/regenerate/regenerate gnulib/Makefile.am
	  config/gnulib/gnulib-cache.m4: add full-read, full-write modules
	* oldrecover-src/extract_list.c client-src/noop.c
	  client-src/sendbackup-gnutar.c client-src/sendbackup.c
	  client-src/sendsize.c client-src/selfcheck.c amandad-src/amandad.c
	  application-src/amgtar.c recover-src/extract_list.c
	  server-src/changer.c server-src/logfile.c server-src/amindexd.c
	  server-src/amcheck.c server-src/dumper.c server-src/chunker.c
	  server-src/taper-port-source.c server-src/driverio.c
	  server-src/holding.c server-src/driver.c
	  server-src/taper-file-source.c restore-src/restore.c
	  common-src/security-util.c common-src/amanda.h
	  tape-src/output-file.c: use gnulib full_read, full_write functions,
	  which have slightly different error semantics than the corresponding
	  Amanda functions.

2008-03-27  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Add 'CHECK-DEVICE' property.

2008-03-27  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/activate-devpay.c (parse_commandline): Always return.

2008-03-25  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/readline.m4: Don't add READLINE_LIBS to LIBS.
	* oldrecover-src/Makefile.am (LDAAD): Add READLINE_LIBS.
	* recover-src/Makefile.am (LDAAD): Add READLINE_LIBS.
	* config/amanda/swig.m4: AM_CONDITIONAL(WANT_CYGWIN_COPY_PERL_DLL)
	* config/amanda/swig.m4: Add library to PERLEXTLIBS on cygwin.
	* config/amanda/syshacks.m4: Add '-no-undefined' to AMANDA_ADD_LDFLAGS.
	* amandad-src/Makefile.am,
	* client-src/Makefile.am, device-src/Makefile.am,
	  server-src/Makefile.am, server-src/server_util.c,
	  tape-src/Makefile.am: Add library to many *_LIBADD.
	* perl/Makefile.am (install-data-hook): Copy cygwin ddl if
	  WANT_CYGWIN_COPY_PERL_DLL.

2008-03-25  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Fix typo and remove unused prefix.

2008-03-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Check difference between origsize and outsize
	  to find if the image is compressed.

2008-03-25  Jean-Louis Martineau <martineau@zmanda.com>
	Greg Troxel reported the bug and possible solution.
	* common-src/stream.c (stream_server): New family argument, it is used
					       to create the socket.
	* common-src/stream.h (stream_server): New prototype.
	* server-src/chunker.c, server-src/taper.c: Call stream_server with
	  family of 'localhost', it's the name dumper use to contact them.
	* restore-src/amidxtaped.c: Call stream_server with AF_INET.
	* common-src/bsd-security.c, common-src/security-util.c: Call
	  stream_server with family of incoming packet.

2008-03-25  Jean-Louis Martineau <martineau@zmanda.com>
	Davor Ocelic reported the problem.
	* application-src/Makefile.am: Use applicationexec_PROGRAMS and
	  applicationexec_SCRIPTS to install executable.

2008-03-25  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c (show_stat_info): Use getpwuid_r
						       and getgrgid_r.
2008-03-25  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/swig.m4: fix the fix to the fix for FreeBSD systems'
	  peculiar linking of threading libraries.

2008-03-20  Dan Locks <dwlocks@zmanda.com>
	* packaging/deb/control: removed grep dependency
	* packaging/deb/amanda-backup-client.postinst
	  packaging/deb/amanda-backup-server.postinst
	  packaging/deb/amanda-backup-server.postrm
	  packaging/deb/amanda-backup-client.postrm:  removed call to
	  ldconfig to satisfy lintian
	* packaging/deb/amanda-backup-server.lintian
	  packaging/deb/amanda-backup-client.lintian: sorted and added new
	  overrides
	* packaging/deb/amanda-backup-client.dirs: removed var/amanda

2008-03-18  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/activate-devpay.c: fix type warning

2008-03-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c: Correctly check if two hosts map to the same
				 name.

2008-03-15  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am perl/amglue/mainloop.c perl/amglue/amglue.h
	  perl/amglue/source.c: rename mainloop.c to source.c to avoid
	  conflicts with MainLoop.c on case-insensitive filesystems

2008-03-14  Dan Locks <dwlocks@zmanda.com>
	* Initial debian release: This package is based on Bdale Garbee's
	  work as the official debian maintainer for amanda.

2008-03-14  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Document global and by dumptype
					    property.
	* server-src/server_util.c: Rename _proplist to _property.
	* server-src/diskfile.c: Rename _proplist to _property.
	* server-src/amadmin.c (disklist_one): Print property.
	* perl/Amanda/Config.swg: Add new constants to Amanda::Config
	* installcheck/Amanda_Config.pl: Test global property.
	* common-src/conffile.c: Add global and by dumptype property.
	* common-src/conffile.h: Add global and by dumptype property.

2008-03-14  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/MainLoop.swg perl/Makefile.am: new perl module
	* perl/amglue/amglue.h perl/amglue/mainloop.c: support for new module
	* installcheck/Amanda_MainLoop.pl installcheck/Makefile.am: tests for
	  new module
	* common-src/event.h: fix typo in comment

2008-03-14  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/dest-null.c: fix Solaris 8 compilation problem: isprint()
	  expects an int, not a char.

2008-03-13  Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: changed the PKG_CONFIG_PATH macro so that
	  it works with rpm versions earlier than 4.4

2008-03-13  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/device-queueing.c device-src/device-queueing.h
	  server-src/taper-source.c server-src/taper-source.h
	  server-src/taper-source-test.c server-src/taper.c
	  common-src/queueing.c common-src/queueing.h: change ints in
	  consumer/producer to (s)size_t
	* device-src/device.c device-src/device-queueing.c
	  device-src/tests/semaphore-test.c device-src/tests/Makefile.am
	  device-src/queueing.c device-src/semaphore.c
	  device-src/device-queueing.h device-src/queueing.h
	  device-src/Makefile.am device-src/semaphore.h
	  device-src/property.h server-src/taper.c common-src/queueing.c
	  common-src/queueing.h common-src/semaphore-test.c
	  common-src/semaphore.c common-src/semaphore.h
	  common-src/Makefile.am: move queueing and semaphore into
	  common-src, along with their tests
	* configure.in xfer-src/source-random.c xfer-src/xfer-element.h
	  xfer-src/xfer-dest.c xfer-src/xfer-test.c xfer-src/xfer.c
	  xfer-src/xfer-dest.h xfer-src/amxfer.h xfer-src/dest-null.c
	  xfer-src/Makefile.am xfer-src/xfer.h xfer-src/xfer-element.c
	  xfer-src/filter-xor.c Makefile.am: introduce transfer architecture
	* xfer-src/xmsg.c xfer-src/xfer-element.h xfer-src/xfer-test.c
	  xfer-src/xmsg.h xfer-src/xfer.c xfer-src/amxfer.h
	  xfer-src/Makefile.am xfer-src/xfer.h: support for sending
	  and receiving XMsgs.
	* common-src/event.c common-src/event.h: add default_event_loop().
	* device-src/device.c server-src/taper-source-test.c common-src/util.c
	  common-src/util.h common-src/glib-util.c common-src/glib-util.h:
	  create new glib_init() to do g_type_init(), initialize threads, etc.

2008-03-13  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendsize.c: Don't use sscanf for est->qamname because it
				 can have a '%'.
	* server-src/diskfile.c: Clean the diskname before using it as a regex.
	* common-src/protocol.c: Fix bug if packet have a '%' character.

2008-03-13  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Installcheck/Run.pm: Increase size of TAPE.

2008-03-12  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/event.c: Use %jd to print a pid_t, since it may be
	  larger on some platforms.

2008-03-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Fix solaris 8 cc warning.

2008-03-12  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Set stroptions to "".

2008-03-12  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/event.c common-src/event.h common-src/event-test.c:
	  add two new GSources: child_watch_source (sends events when a child
	  dies) and fdsource (sends events when file descriptors match
	  conditions).  Thanks to Jean-Louis Martineau for finding and fixing
	  a race condition.

2008-03-12  Dustin J. Mitchell <dustin@zmanda.com>
	* gnulib/regenerate/regenerate gnulib/Makefile.am DEVELOPING: update
	  documentation to reflect use of gnulib's git repository

2008-03-12  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Makefile.am: Remove CONFIG_CLOBBER_MY_CONFIG,
				    it is done automaticaly.
	* config/amanda/defaults.m4: AC_SUBST(CONFIG_CLOBBER_MY_CONFIG) to not
				     conflict with make CLOBBER_MY_CONFIG.

2008-03-12  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Makefile.am: Use CONFIG_CLOBBER_MY_CONFIG for Makefile
				    variable.

2008-03-12  Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/buildpkg: made the script quieter

2008-03-12  Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: fixed a number of complaints from rpmlint,
	  added --quiet to the configure invocation

2008-03-10  Jean-Louis Martineau <martineau@zmanda.com>
	* gnulib: Update to latest version, add getopt module.

2008-03-07  Jean-Louis Martineau <martineau@zmanda.com>
	* oldrecover-src/Makefile.am, example/Makefile.am,
	  amandad-src/Makefile.am, recover-src/Makefile.am,
	  restore-src/Makefile.am, Makefile.am: Include config/automake/vars.am.
	* installcheck/Amanda_Config.pl: Check config_filename.
	* installcheck/Installcheck/Config.pm: Use local amandates and
					       gnutar_listdir.
	* installcheck/Makefile.am: Take a copy of amanda-client.conf
	* config/amanda/defaults.m4: AC_SUBST(CLOBBER_MY_CONFIG)
	* config/automake/scripts.am: DISTCLEANFILES += $(SCRIPTS_INCLUDE)
	* config/automake/installperms.am: installperms.sh in top_builddir,
					   DISTCLEANFILES += $(installperms_sh)
	* Makefile.am: add '--without-amperldir CLOBBER_MY_CONFIG=OK' to
		       DISTCHECK_CONFIGURE_FLAGS.
	* common-src/Makefile.am: distclean-local: remove svn-info.h.

2008-03-07  Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/buildpkg:  Simplified usage of packaging script by
	  creating a tarball from existing source.

2008-03-06  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Installcheck/Run.pm: merge from application-api.
	* installcheck/Installcheck/Config.pm: merge from application-api.

2008-03-06  Jean-Louis Martineau <martineau@zmanda.com>
	* merge application-api

2008-03-06  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/Makefile.am: dest=$(amlibexecdir).

2008-03-06  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/Makefile.am: Rename SCRIPTSDATA to SCRIPTS_INCLUDE,
				   Add chg-lib.sh.in to EXTRA_DIST.
	* dumper-src/Makefile.am: Rename SCRIPTSDATA to SCRIPTS_INCLUDE,
				  Add generic-dumper.pl to EXTRA_DIST.
	* common-src/Makefile.am: Add amanda-sh-lib.sh to SCRIPTS_INCLUDE,
				  Add amanda-sh-lib.sh.in to EXTRA_DIST.

2008-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/Makefile.am: Move chg-lib.sh to SCRIPTSDATA.
	* dumper-src/Makefile.am: Move generic-dumper to SCRIPTSDATA.

2008-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/swig.m4: Check for *freebsd[123456]*

2008-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-scsi-chio.c: Compile fix.
	* changer-src/scsi-chio.c: Compile fix.
	* config/amanda/changer.m4: Check for linux/chio.h

2008-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/rpm/amanda.spec: Give CFLAGS after ./configure

2008-03-05  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/swig.m4: With many thanks to John E. Hein
	  <jhein@timing.com>, fix the comment and make the change committed
	  yesterday apply to all FreeBSD < 7.0.

2008-03-05  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/summary.m4: quote all warning messages that will be
	  included in heredocs, to avoid spurious interpretation of backquotes

2008-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/rpm/amanda.spec: Add %{PERLSITELIB} in %files sections.

2008-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/amidxtaped: Use default config if amrecover doesn't send
			a config name.  (amoldrecover doesn't send a config).
	* restore-src/restore.c: amrecover from 2.4.5 doesn't send the filenum,
	  so desired_tape->numfiles == 0.
	  If amidxtaped is launched directly from xinetd, then
	  flags->pipe_to_fd == STDOUT_FILENO, but this test should only
	  succeed for amrestore of amfetchdump.

2008-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c: Set d_self->is_eof to FALSE.

2008-03-04  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am config/amanda/swig.m4: add a special case for
	  FreeBSD-6.2: include -lpthread in the linking of each perl
	  extension, because libgthread does not pull in libpthread as
	  it does on other platforms.

2008-03-03  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: getnameinfo return != 0 on error.

2008-03-03  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/dumpers.m4: Typo.

2008-03-03  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tests/vfs_test.c, common-src/event-test.c: Fix ignoring
	  return value of 'pipe', declared with attribute warn_unused_result.

2008-02-29  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amanda.h: add <stdint.h>

2008-02-28  Dustin J. Mitchell <dustin@zmanda.com>
	* config/automake/installperms.am: --without-installperms now
	  generates a shell-parsable list of desired permissions
	* Makefile.am: erase installperms.sh before beginning a 'make
	  install'
	* oldrecover-src/Makefile.am client-src/Makefile.am
	  recover-src/Makefile.am server-src/Makefile.am: give mode
	  bits in octal

2008-02-28  Dustin J. Mitchell <dustin@zmanda.com>
	Thanks to John E. Hein <jhein@timing.com> for identifying this problem
	* perl/Amanda/Tests.swg: expose sizeof(size_t) to perl
	* installcheck/Amanda_Config.pl: use a properly-sized constant to
	  check parsing of large configuration values


2008-02-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindexd.c: Compute maxpart, call clean_dump.
	* server-src/disk_history.h (DUMP_ITEM): Add maxpart field.
	* server-src/disk_history.h (add_dump): New prototype,
	                                        add maxpart argument.
	* server-src/disk_history.c (add_dump): Remove a DUMP_ITEM if the
	                                previous part is not already added.
	* server-src/disk_history.c (clean_dump): New function to remove
	                                DUMP_ITEM if all part are not added.
	* common-src/tapelist.h (tapelist_t): Add partnum field.
	* common-src/tapelist.h (append_to_tapelist): New prototype,
	                                              add partnum argument.
	* common-src/tapelist.c (append_to_tapelist): New partnum argument.
	* restore-src/amfetchdump.c: Use new append_to_tapelist prototype.

2008-02-28  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Don't write unclaimed warning if we have
				      an accept function.

2008-02-27  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/testutils.c common-src/testutils.h
	  common-src/Makefile.am: add libtestutils.la
	* common-src/event-test.c common-src/amflock-test.c:
	  use libtestutils.la

2008-02-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c: Use sort_key in switch statement.

2008-02-26  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS, ReleaseNotes: Document --with-amlibdir.
	* config/amanda/dirs.m4: Add AS_HELP_STRING for --without-amlibdir and
				 --without-amlibexecdir,
				 Set AMPERLLIB to $amlibdir/perl.

2008-02-26  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/event-test.c: a more robust and effective test of
	  EV_READFD; thanks to Jean-Louis Martineau for the suggestions.

2008-02-26  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am config/amanda/dirs.m4 config/amanda/summary.m4:
	  add --with-amperldir, --without-amperldir, and install perl modules
	  in Perl's installsitearch by default; thanks to Orion Poplawski
	  <orion@cora.nwra.com> for help and suggestions.

2008-02-26  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/getfsent.c: Don't fail if stat of mount point fail.

2008-02-26  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c: Don't log a note if CLIENT_LOGIN == dumpuser for
			     RUNNING_AS_DUMPUSER_PREFERRED.

2008-02-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Report size of data on holding disk.

2008-02-20  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/dirs.m4: Add --with-amlibdir and --with-amlibexecdir.

2008-02-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c, server-src/dumper.c,
	  server-src/planner.c: Call waitpid to cleanup defunct process.

2008-02-20  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tape-posix.c: keep ioctl error message in
	  debug log

2008-02-19  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.c, device-src/null-device.c,
	  device-src/s3.c, device-src/tape-device.c,
	  device-src/queueing.h, device-src/s3.h,
	  device-src/vfs-device.c, device-src/rait-device.c,
	  server-src/taper-source-test.c, server-src/server_util.c,
	  server-src/taper-disk-port-source.c, perl/Amanda/Device.swg,
	  perl/amglue/integers.swg, restore-src/restore.c,
	  common-src/glib-util.c: Fix solaris compiler warning.

2008-02-19  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c (quote_string): Quote single quote (').
	* server-src/find.c:Correctly compute length of diskname.

2008-02-15  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in config/amanda/progs.m4 config/amanda/flags.m4:
	  use AC_PROG_EGREP instead of the Amanda version
	* server-src/find.c: fix compiler warning on Solaris 8

2008-02-15  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/rpm/amanda.spec: Remove amverify*

2008-02-15  Jean-Louis Martineau <martineau@zmanda.com>
	* oldrecover-src/Makefile.am: Build all files in the build directory.
	* recover-src/Makefile.am: Build all files in the build directory.
	* config/amanda/config.m4: Use $srcdir to buld common-src/svn-info.h
	* configure.in: execute AMANDA_GET_SVN_INFO after AC_OUTPUT because
	  AC_OUTPUT create the common-src directory.

2008-02-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c: Use 'long long' and '%lld' to sscanf.
	* file server-src/infofile.c: Use %jd to print intmax_t value.
	* file server-src/driver.c: Use 'long long' and '%lld' to sscanf.

2008-02-15  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/rpm/amanda.spec: Fix typo.

2008-02-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amdump.sh: Don't use 'date -d', use sed.

2008-02-14  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Run.pm: run test dumps of a smaller
	  directory, to avoid overflowing test tapes

2008-02-14  Dustin J. Mitchell <dustin@zmanda.com>
	* dumper-src/amstar.pl dumper-src/amgtar.pl
	  device-src/tests/get-activation-key.pl server-src/amcheckdump.pl
	  server-src/amdevcheck.pl: add GPL header

2008-02-14  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am installcheck/amdump.pl: add a check
	  that runs 'amdump' directly, since that fails often

2008-02-14  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/event-test.c: make tests more robust to environmental
	  variations, clean up forked children

2008-02-13  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/security-util.c
	  common-src/security-util.h: don't cast pointers to
	  integers for tcp_conn event id's

2008-02-13  Dan Locks <dwlocks@zmanda.com>
        * packaging/rpm/amanda.spec: added a check for PKG_CONFIG_PATH in the
          build environment as well as if provided on rpmbuild commandline.
          Conditionalized this var to handle cross compiling on FC8.

2008-02-12  Dustin J. Mitchell <dustin@zmanda.com>
	* amandad-src/amandad.c: use sizeof() instead of strlen()
	  in a constant expression

2008-02-12  Dustin J. Mitchell <dustin@zmanda.com>
	* amandad-src/amandad.c: initialize as->service
	* common-src/event.c common-src/event.h: new GMainLoop-based
	  version of the event library, allowing GMainLoop-based and
	  event-based processes to co-exist peacefully

2008-02-12  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amcheckdump.pl: fix typo

2008-02-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Fail if no header or no data.

2008-02-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Report failure if dumper succeed and
				  chunker failed.

2008-02-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.h (config_name, config_dir, config_filename):
				 Remove extern declaration.
	* common-src/conffile.h (get_config_name, get_config_dir,
				 get_config_filename): New prototype.
	* common-src/conffile.c (config_name, config_dir, config_filename):
				 Declare static.
	* common-src/conffile.h (get_config_name, get_config_dir,
				 get_config_filename): New functions.
	* perl/Amanda/Config.swg: Don't inline the functions.
	* oldrecover-src/extract_list.c, client-src/sendbackup.c,
	  client-src/sendsize.c, client-src/selfcheck.c,
	  recover-src/amrecover.c, recover-src/extract_list.c,
	  server-src/changer.c, server-src/amlogroll.c,
	  server-src/amindexd.c, server-src/amcheck.c,
	  server-src/dumper.c, server-src/planner.c,
	  server-src/chunker.c, server-src/amadmin.c,
	  server-src/amtape.c, server-src/amcleanupdisk.c,
	  server-src/amflush.c, server-src/amtrmlog.c,
	  server-src/driverio.c, server-src/driver.c,
	  server-src/reporter.c, server-src/taper.c,
	  server-src/amtrmidx.c, server-src/diskfile.c,
	  server-src/amlabel.c,
	  restore-src/amfetchdump.c: Use new functions.

2008-02-12  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/event-test.c common-src/Makefile.am: add checks
	  for the event module

2008-02-12  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/dumper.c server-src/server_util.c
	  server-src/infofile.c server-src/amtrmlog.c common-src/debug.c
	  common-src/file.c: Always call mkpdir without the 02000 bit set,
	  as it is not needed and causes problems on MacOS X.

2008-02-11  Dustin J. Mitchell <dustin@zmanda.com>
	* all source files: update GPL dates
	* perl/*: use LGPL instead of GPL

2008-02-11  Dustin J. Mitchell <dustin@zmanda.com>
	* amandad-src/amandad.c: fix use of non-constant array size

2008-02-11  Dustin J. Mitchell <dustin@zmanda.com>
	* amandad-src/amandad.c: add hack to avoid a race condition in
	  sendbackup operation
	* common-src/security-util.c: issue debug log message when data
	  tokens are dropped by the security API

2008-02-07  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/amrecover.c: Use tapedev from server if it is not set
				   in amanda.client.conf
	* example/amanda-client.conf.in: Document it.

2008-02-07  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c (tape_device_init): Init min_block_size
	  and fixed_block_size to 32768.

2008-02-07  Dustin J. Mitchell <dustin@zmanda.com>
	* packaging/rpm/amanda_enterprise.spec man/Makefile.am
	  man/xml-source/amverify.8.xml man/xml-source/amverifyrun.8.xml
	  man/xml-source/amcheckdump.8.xml server-src/amverifyrun.sh
	  server-src/amverify.sh server-src/Makefile.am: remove amverify*
	* server-src/amdevcheck.pl: tweak @ARGV parsing
	* server-src/amcheckdump.pl installcheck/Installcheck/Run.pm
	  installcheck/amcheckdump.pl: significant rewrite to catch more errors
	  and not loop for ever on some errors.

2008-02-01  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amgetconf.pl installcheck/amgetconf.pl
	  common-src/conffile.c: fix and test amgetconf to allow extra
	  command-line arguments (undocumented), to allow -o options without a
	  space, and to correctly return empty results for empty build
	  variables

2008-02-01  Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: added amdumpcheck.8.gz to the %files list
	  for both client and server, removed amplot from client, added missing
	  directory %{SYSCONFDIR}/amanda

2008-01-29  Dan Locks <dwlocks@zmanda.com>
        * packaging/rpm/amanda.spec: changed %{SYSCONFDIR} to %{LOCALSTATEDIR}
          where amanda/amandates is concerned.  also added %{LOCALSTATEDIR} to
          the %files list.

2008-01-29  Dan Locks <dwlocks@zmanda.com>
	* man/xml-source/* added http://wiki.zmanda.com to the "see also"
	  section

2008-01-29  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Check for g_options.
	* client-src/sendsize.c: Check for g_options.
	* client-src/selfcheck.c: Check for g_options.
	* amandad-src/amandad_util.c (free_g_options): Check g_options != NULL.

2008-01-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Fix "Use of uninitialized value in string".

2008-01-28  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Config.pl common-src/conffile.c: uppercase
	  displayunit, and add a unit test to be sure.

2008-01-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: handle lowercase displayunit.

2008-01-28  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in config/amanda/ipv6.m4 common-src/amanda.h: check
	  for netinet/in.h and in_port_t, and define the latter if
	  necessary.  Thanks to Craig Dewick <cdewick@lios.apana.org.au>
	  for the suggestion.

2008-01-28  Paddy Sreenivasan <paddy@zmanda.com>
	* man/xml-source/amanda.8.xml: Update amanda(8) to reflect 2.6.0
	  status

2008-01-28  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Send service stderr to amandad debug file,
	  Wait for service termination and send error message to server.

2008-01-28  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.c: Set PROPERTY_BLOCK_SIZE with a G_TYPE_INT
			       Set PROPERTY_READ_BUFFER_SIZE with a G_TYPE_UINT

2008-01-22  Dustin J. Mitchell <dustin@zmanda.com>
	* man/Makefile.am man/xml-source/amcheckdump.8.xml: new manpage
	* server-src/amcheckdump.pl: fix usage message

2008-01-22  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in config/amanda/userid.m4: add --with-single-userid

2008-01-22  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amfreetapes.sh: remove unused script

2008-01-22  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/amglue/amglue.h perl/amglue/bigint.c: Include integer limits
	  for all amglue files where they are missing from glib headers

2008-01-22  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: condition installchecks on the selected
	  components

2008-01-22  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am Makefile.am: distribute
	  installcheck/Installcheck scripts, make sure enough parameters
	  are passed along to distcheck for it to succeed, and also clean
	  up properly after tests are run.

2008-01-22  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/dumpers.m4: eliminate strange warning when
	  --without-smbclient is given

2008-01-18  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amgetconf.pl perl/Amanda/Constants.pm.in
	  installcheck/Amanda_Types.pl installcheck/Amanda_Config.pl
	  installcheck/Amanda_Tapelist.pl installcheck/Amanda_Debug.pl
	  installcheck/Amanda_Changer.pl installcheck/amdevcheck.pl
	  installcheck/Installcheck/Config.pm
	  installcheck/Amanda_Cmdline.pl installcheck/amcheckdump.pl
	  installcheck/Amanda_Logfile.pl installcheck/amgetconf.pl:
	  accumulated tweaks and updates to installchecks

2008-01-18  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Tests.swg perl/Makefile.am installcheck/bigint.pl
	  installcheck/Makefile.am: new tests for integer-handling
	  SWIG support, including an installed module (Amanda::Test) that
	  is not used except by this test.

2008-01-18  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Types.pl
	  installcheck/Amanda_Config.pl installcheck/Amanda_Changer.pl
	  installcheck/Amconfig.pm.in installcheck/amdevcheck.pl
	  installcheck/Installcheck installcheck/Installcheck/Run.pm
	  installcheck/Installcheck/Config.pm installcheck/Makefile.am
	  installcheck/amcheckdump.pl installcheck/Amanda_Logfile.pl
	  installcheck/amgetconf.pl: tweaks:
	   - Move installcheck utilities to the Installcheck::* namespace
	   - add Installcheck::Run to help with setting up amdump runs, and
	     running applications in general
	   - Add complete runs to amdevcheck, amcheckdump
	   - Return a nonzero exit status from amgetconf when an invalid
	     configuration parameter is specified.

2008-01-18  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Tapelist.swg perl/Amanda/Tapefile.swg perl/Makefile.am:
	  new module (Tapelist) replaces old stub (Tapefile)
	* installcheck/Amanda_Tapelist.pl installcheck/Makefile.am: test new
	  module
	* server-src/amcheckdump.pl installcheck/Amanda_Logfile.pl: use new
	  module

2008-01-18  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am perl/Amanda/Debug.swg: handle die() and warn() with
	  critical() and warning(), respectively
	* server-src/amgetconf.pl server-src/amcheckdump.pl
	  server-src/amdevcheck.pl: use die()
	* installcheck/Amanda_Config.pl installcheck/Amanda_Changer.pl
	  installcheck/Amanda_Debug.pl installcheck/Makefile.am: new/updated
	  unit tests

2008-01-18  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amgetconf.8.xml server-src/amgetconf.pl
	  server-src/getconf.c server-src/Makefile.am: rewrite amgetconf in
	  Perl, and add the ability to list available build variables.
	* config/amanda/krb4-security.m4 config/amanda/krb5-security.m4
	  config/amanda/bsd-security.m4 config/amanda/dumpers.m4
	  config/amanda/bsdtcp-security.m4 config/amanda/userid.m4
	  config/amanda/rsh-security.m4 config/amanda/ssh-security.m4
	  config/amanda/bsdudp-security.m4 config/amanda/compress.m4
	  config/amanda/debugging.m4 config/amanda/flock.m4: AC_SUBST a bunch
	  of constants for use in Amanda::Constants
	* perl/Makefile.am perl/Amanda/Paths.pm.in
	  perl/Amanda/Constants.pm.in: add new constants
	* perl/Amanda/Config.swg: add getconf_byname_strs
	* installcheck/amgetconf.pl: check new functionality
	* perl/Amanda/Util.swg common-src/util.c common-src/util.h: add
	  RUNNING_AS_ANY

2008-01-17  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/rpm/buildpkg, packaging/rpm/amanda.spec,
	  configure.in: Set for release 2.6.1alpha.

2008-01-16  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: Require user to specify
	  CLOBBER_MY_CONFIG=OK when running installchecks

2008-01-16  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/rpm/amanda.spec: Don't set PKG_CONFIG_PATH.

2008-01-16  Jean-Louis Martineau <martineau@zmanda.com>
	* oldrecover-src/extract_list.c, client-src/sendbackup.c,
	  client-src/sendsize.c, client-src/selfcheck.c,
	  recover-src/extract_list.c, server-src/changer.c,
	  server-src/amflush.c, server-src/driverio.c,
	  common-src/pipespawn.c: Call safe_fd before exec*.

2008-01-15  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/rpm/amanda.spec: Remove build_host.

2008-01-15  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Types.swg perl/Amanda/Config.swg perl/Amanda/Device.swg
	  perl/amglue/integers.swg: fix typos and compiler warnings

2008-01-15  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/Makefile.am: New file.
	* packaging/README: New file.
	* packaging/rpm/buildpkg: New file.
	* packaging/rpm/amanda.spec: New file.
	* configure.in
	* config/amanda/dirs.m4 (AMANDA_WITH_DUMPERDIR): Give a warning if used.
	* config/amanda/dirs.m4 (AMANDA_EXPAND_DIRS): Expand DUMPER_DIR to
					 ${amlibexecdir}/application
	* Makefile.am (SUBDIRS): Add packaging.
	* amanda.spec: Remove file.

2008-01-15  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/Makefile.am (AM_CFLAGS): Set to $(AMANDA_WARNING_CFLAGS)
	* device-src/tape-device.c, device-src/tape-posix.c,
	  device-src/vfs-device.c: include "util.h"
	* device-src/rait-device.c: fix compiler warning.

2008-01-14  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/amglue/bigint.c: fix the range-checking mechanics for large
	  integers, since the precompiler seems to get confused by large
	  constants.

2008-01-14  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/krb5-security.m4: abort configure run if krb5
	  is requested by libraries aren't found

2008-01-13  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: use &#215; instead of &times;

2008-01-11  Paddy Sreenivasan <paddy@zmanda.com>
	* device-src/Makefile.am: Don't install queueing.h and device.h

2008-01-11  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Config.swg perl/Amanda/Debug.swg: complete documentation

2008-01-11  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/Makefile.am: Install amandad in $libexecdir/amanda
	* installcheck/amgetconf.pl: usetimestamps defaults to yes.
	* NEWS, ReleaseNotes: Notes about make installcheck.

2008-01-11  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS: Add amcryptsimple, amgpgcrypt, amserverconfig and amaddclient.
	* ReleaseNotes: Ditto.

2008-01-11  Jean-Louis Martineau <martineau@zmanda.com>
	* ReleaseNotes: Update for amanda-2.6.0
	* News: Update for amanda-2.6.0
	* configure.in: AM_INIT_AUTOMAKE(amanda, "2.6.0b1")
	* Makefile.am (pkgdata_DATA): Add NEWS, ChangeLog and amanda.spec
	* amanda.spec: %{!?amanda_version: %define amanda_version 2.6.0b1}
