2009-11-05  Jean-Louis Martineau <martineau@zmanda.com>
        * client-src/sendbackup-dump.c, client-src/sendsize.c,
          client-src/selfcheck.c:
	  Fix compiler error if VXDUMP or VDUMP is defined.

2009-11-05  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: close FILE instead of fd.
	* client-src/selfcheck.c: fix fd leak with app_stderr.

2009-10-29  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendsize.c: Fix error reporting.

2009-10-27  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/deb/rules, packaging/deb/buildpkg,
	  packaging/rpm/buildpkg,
	  packaging/rpm/amanda.spec: Change version to 2.6.1p2.
	* NEWS: Add news for 2.6.1p2.
	* configure.in: Change version to 2.6.1p2.

2009-10-27  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Application/Zfs.pm: Use diskname for the snapshot name.

2009-10-23  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c: handle EROFS in open.

2009-10-08  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tape-device.h: add missing field

2009-10-07 Dan Locks <dwlocks@zmanda.com>
	*  packaging/deb/control: add |gnuplot-nox

2009-10-07  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda-devices.7.xml: add NONBLOCKING_OPEN property
	* config/amanda/tape.m4: use DEFAULT_TAPE_NON_BLOCKING_OPEN by default
	  on Linux
	* device-src/tape-device.c device-src/tape-device.h: conditionalize
	  the use of a nonblocking open

2009-10-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c: Fix initialization of xml_app.result.

2009-08-31  Dustin J. Mitchell <dustin@zmanda.com>
	* restore-src/amrestore.c: call device_configure

2009-08-31 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: add amstar and amgtar to suid section of
	  %files for server.

2009-08-13  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/amtapetype.pl: fix bad merge of references to
	  Amanda:Header

2009-08-05 Dan Locks <dwlocks@zmanda.com>
	* Thanks to Jim Barber for pointing out these bugs.
	* packaging/deb/amanda-backup-client.postinst, packaging/deb/rules,
	  packaging/deb/amanda-backup-server.postinst: replace all instances
	  of AMHOMEDIR with AMANDAHOMEDIR, install .am_passphrase 0600.
	* packaging/deb/control: add build-depends for libglib2.0-dev

2009-07-24  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Fix fd allocation.

2009-07-16  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-lib.sh.in: Fix MESSAGE parsing for Solaris sed.

2009-06-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Use the filenum from the PART line.
	                         Keep the filenum of the first part.

2009-06-12  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Fix for configured with CLIENT_LOGIN=root
	* man/xml-source/amanda-client.conf.5.xml: Typo.
	* man/xml-source/amanda.conf.5.xml: Add ssh_keys.

2009-05-22  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/amfetchdump.c: Fix sort_needed_tapes_by_write_timestamp.

2009-05-22  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Compatibity with 2.4.2 server.

2009-05-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Fix crash in amflush.

2009-05-15  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/debug.c: Fix memory leak.

2009-05-07  Dustin J. Mitchell <dustin@zmanda.com>
	    Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/debug.c: do not use a mutex in debug_printf
	* common-src/pipespawn.c server-src/changer.c:
	  do not call debug_printf after fork()

2009-05-06  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/taper.c: check for division by zero and don't print 'nan'
	  for kbps
	* installcheck/taper.pl: don't expect 'nan'

2009-05-04  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/taper-mem-port-source.c
	  server-src/taper-disk-port-source.c: continue reading from the port
	  after the cache is exhausted, instead of terminating the part abruptly
	  (which can lead to insertion of spurious zeros into the dumpfile);
	  also remove some unnecessary assertions (g_return_val_if_fail)
	* server-src/taper-file-source.c: use correct unit on part size;
	  correctly calculate estimated number of parts
	* server-src/taper-port-source.c: replace assertion with 'if'

2009-04-27  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Fix dbprintf statements.

2009-04-22  Sam Couter <sam@couter.id.au>
	* changer-src/chg-glue.pl: return a helpful error message when
	  Amanda::Changer->new() fails

2009-04-21  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda-devices.7.xml: Add 'FSF_AFTER_FILEMARK'
	  property to 'tape:' driver.
	* device-src/tape-device.c: Add code for new 'FSF_AFTER_FILEMARK'
	  property, set is_eof to FLASE where needed.
	* device-src/tape-device.h: Add fsf_after_filemark to _TapeDevice.
	* device-src/tape-aix.c, device-src/tape-uware.c,
	  device-src/tape-xenix.c, device-src/tape-posix.c: Set default value
	  for FSF_AFTER_FILEMARK.
	* config/amanda/defaults.m4: Find default value for 'FSF_AFTER_FILEMARK'
	  property.
	* xfer-src/dest-null.c: Remove bogus assert.
	* device-src/amtapetype.pl: New -p option to discover driver properties,
	  it can find value for the 'FSF_AFTER_FILEMARK' property.
	* man/xml-source/amtapetype.8.xml: Document -p options

2009-04-20  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c: handle EROFS in open.

2009-04-17  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/device.c: fix error message for unparsable property

2009-04-15  Dustin J. Mitchell <dustin@zmanda.com>
	* restore-src/amfetchdump.c: keep the order of tapes within a
	  particular run of Amanda

2009-04-10  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c: fix handling of double-backslash in quoted
	  strings

2009-04-09  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Check authopt before using it.

2009-04-07  Jean-Louis Martineau <martineau@zmanda.com>
	* client-drc/sendbackup.c: Init result.

2009-04-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper-source.c (default_taper_source_seek_to_part_start):
	  returns FALSE on not splitted dump.
	* server-src/driverio.c: info.last_level should not be set on error
	                 if level >= info.last_level.
	* server-src/driver.c: Rename update_failed_dump_to_tape to
	  update_failed_dump.
	  Call update_failed_dump on failed dump to holding disk.
	* application-src/amgtar.c: Don't update statefile if the backup failed.
	* client-drc/sendbackup.c: Don't update amandates if backup failed.

2009-04-03  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/compat.pm: always configure devices while
	  scanning
	* server-src/amcheckdump.pl: configure devices returned from the
	  changer

2009-04-01  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c: don't send empty location constraint,
	  allocate error messages

2009-04-01  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3-device.c: always send errors from setup_handle

2009-04-01  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3-device.c: don't clobber errors from setup_handle

2009-03-31  Jean-Louis Martineau <martineau@zmanda.com>
        * server-src/amcheck.c: Set l on error path.

2009-03-31  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer/compat.pm: Don't import :logging from Debug.

2009-03-30  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/deb/changelog, packaging/deb/rules,
	* packaging/deb/buildpkg, packaging/rpm/buildpkg,
	* packaging/rpm/amanda.spec: Change version to 2.6.1p1.
	* NEWS: Add news for 2.6.1p1.
	* configure.in: Change version to 2.6.1p1.

2009-03-29  Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: change a number of %if conditionals to
	  macros which expand if they are defined.

2009-03-25  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3.c: fix segfault in s3_make_bucket with location
	  constraint

2009-03-19  Dustin J. Mitchell <dustin@zmanda.com>
	(thanks to Peter Kunst <peter.kunst@swissrisk.com>)
	* common-src/Makefile.am: don't include genversion.h in distribution
	  tarballs

2009-03-19  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/Makefile.am: add -release to libamxfer

2009-03-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amlabel.c: give correct exit status on failure

2009-03-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: dump in "writing to tape" mode should also
	                          be included in the "dumped" summary.

2009-03-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c: Fix listing of partial dump in holding disk.

2009-03-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Log quoted qname.

2009-03-11  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/amtapetype.pl: do not produce broken 'bytes' units
	* installcheck/amtapetype.pl: test changes
	* man/xml-source/amanda.conf.5.xml: tapetype:length is not in bytes!
	* common-src/conffile.c: fix default for tapetype:length

2009-03-11  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amfeatures.c: improve error handling in
	  am_string_to_feature, return NULL on error
	* amandad-src/amandad_util.c recover-src/amrecover.c
	  server-src/amcheck.c server-src/amindexd.c server-src/chunker.c
	  server-src/driver.c server-src/dumper.c server-src/planner.c: always
	  terminate the string passed to am_string_to_feature

2009-03-11  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amfeatures.c: fix am_string_to_feature to fail correctly
	  on a bad feature string

2009-03-10  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: return DONE if input file is partial.

2009-03-10  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c: Set default TAPETYPE_FILEMARK to 1.

2009-02-27  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Fix parsing of EXIT-HANDLING property.

2009-02-24  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-rait.sh: get directory handling right (patch from
	  Jim.pennino on wiki.zmanda.com)
	* changer-src/chg-glue.pl: produce a debug log, add do_clean, fix
	  do_eject
	* perl/Amanda/Changer.pm: Add a new chg->eject method, to eject a
	  volume that's not currently reserved
	* perl/Amanda/Changer/compat.pm: fix release(), don't load 'current'
	  after cleaning or ejecting
	* installcheck/Amanda_Changer_compat.pl: updated tests

2009-02-24  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c, application-src/amgtar.c,
	  changer-src/scsi-changer-driver.c, client-src/client_util.c,
	  common-src/conffile.c, device-src/s3-device.c,
	  oldrecover-src/set_commands.c, recover-src/set_commands.c,
	  server-src/amindexd.c, server-src/planner.c,
	  server-src/reporter.c: Replace all occurences of index by strchr,
	                         Replace all occurences of rindex by strrchr.

2009-02-24  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c: make s3_list_keys use its own buffer

2009-02-24  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c: fix error buffer handling of overflow data

2009-02-23  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/rait-device.c: actually *report* mismatched child
	  labels/timestamps; correctly detect the 'first' device; and free old
	  device label/time

2009-02-23  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/vfs-device.c: remove bogus locking stubs that are
	  making syscalls like close(-1); fix error handling in read_label
	  if check_is_dir fails()

2009-02-19  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer/compat.pm: add missing semicolon in do_release

2009-02-18  John Hein <jhein@timing.com>
	* common-src/dgram.c: set the send buffer size when creating a new
	  socket

2009-02-17  Dustin J. Mitchell <dustin@zmanda.com>
	* restore-src/amfetchdump.c: remove unintended debugging messages

2009-02-17  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-manual.sh: make messages clearer
	* perl/Amanda/Changer/compat.pm: use _run_tpchanger directly from
	  _manual_scan
	* server-src/amcheckdump.pl: handle errors better

2009-02-09  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: remove TODO

2009-02-07  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/event.c: use built-in child watch source on FreeBSD

2009-02-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: options is already unquoted.
	* common-src/util.c: argument should not be quoted when added to argv.

2009-02-06  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Changer_compat.pl: remove debugging code

2009-02-06  Jean-Louis Martineau <martineau@zmanda.com>
	patch by Yoshihiro Ishikawa
	* recover-src/extract_list.c: Handle application-api.

2009-02-06  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Changer_compat.pl: support 'eject'
	* perl/Amanda/Changer.pm: change release/do_relase relationship
	* perl/Amanda/Changer/compat.pm: same
	* perl/Amanda/Changer/disk.pm: same
	* perl/Amanda/Changer/single.pm: same

2009-01-13  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Paths.pm.in: add $localstatedir
	* server-src/amserverconfig.pl: remove extraneous /

2009-02-04  Jean-Louis Martineau <martineau@zmanda.com>
	* amplot/amplot.awk: Set term to x11.

2009-02-02  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Correctly copy pp_scriptlist.

2009-02-02  Dustin J. Mitchell <dustin@zmanda.com>
	* config/config.guess config/config.sub: new updates from FSF
	* autogen: fix quoting error
	* config/amanda/dumpers.m4:  use a hostname we're more confident
	  doesn't exist

2009-01-30  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Remove a bogus line.

2009-01-22  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in: AM_INIT_AUTOMAKE(amanda, "2.6.1")
	* packaging/deb/rules, packaging/deb/buildpkg, packaging/deb/changelog,
	  packaging/rpm/buildpkg,
	  packaging/rpm/amanda.spec: Change version to 2.6.1.

2009-01-22  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amstar.8.xml: Typo.

2009-01-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Add call to short_dump_state().

2009-01-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Set exit_status to STATUS_TAPE if taper crash.

2009-01-21  Jean-Louis Martineau <martineau@zmanda.com>,
	    Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/fileheader.c: Remove strquotedstr function.
	* common-src/quoting-test.c: Test strquotedstr function.
	* common-src/util.c: Add prototype for strquotedstr function.
	* common-src/util.h: Add new strquotedstr function.

2009-01-21  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/Makefile.am: Typo

2009-01-21  Dustin J. Mitchell <dustin@zmanda.com>
	Patch suggested by Ingo Schaefer <ingo@ingo-schaefer.de>
	* packaging/rpm/amanda.spec: detect and properly support suse11.1,
	  with a temporary hack to support suse11, too

2009-01-21  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/rpm/amanda.spec: Typo.

2009-01-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Fix use of %free and %qlen keys.

2009-01-20 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: add missing BuildRequires, conditionalize 
	  libtermcap.so.2 for fedora, change tar requirement to %{tarver}

2009-01-20 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: add %{PERLSITELIB} to %files section to
	  install perl for the client package add "directory mode" to defattr
	  statements where appropriate.

2009-01-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c: Use dp->hostnext to scan dles of a host.

2009-01-19  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/vfs-device.c: robust_open can return fd 0.

2009-01-19  Tom Robinson <tom.robinson@constantstream.com>
	* server-src/amoverview.pl: fix parsing of filenames containing colons

2009-01-19  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amzfs-sendrecv.pl: Handle incremental,
	                                     new KEEP-SNAPSHOT property.
	* man/xml-source/amzfs-sendrecv.8.xml: Document it.
	* application-src/teecount.c: New program.
	* application-src/Makefile.am: Add teecount.
	* perl/Amanda/Application/Zfs.pm: Work with 'current' snapshot.
	* common-src/amanda.h: include "safe-read.h"

2009-01-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Don't add 'dump to tape' in the 'dumped'
	                          result.

2009-01-16 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: fix the fedora 10 fix for other distros

2009-01-16  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/vfs-device.c: don't cache the dir_handle, as
	  such caching does not work on some network filesystems

2009-01-16  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/rpm/amanda.spec: Fix for fedora 10.

2009-01-16  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/amtapetype.pl: remove call to old device function

2009-01-16  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Use bitwise NOT for taper_state.

2009-01-16  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: Go to next tape if device_start_file fail.
	* device-src/tape-device.c: write a filemark when a file is finished.
	* device-src/tape-device.h (TapeDevice): Remove first_file.

2009-01-16  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Fix for no index with application.
	* application-src/amstar.c: Improve error reporting.
	* application-src/amgtar.c: Improve error reporting.

2009-01-14  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Add TAR-BLOCKSIZE property.
	* man/xml-source/amgtar.8.xml; document TAR-BLOCKSIZE property.

2009-01-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Check fallback_splitsize is smaller than
	                        physmem_total().
	* server-src/taper-mem-port-source.c: Dont; check physmem_available.

2009-01-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/server_util.c: New get_pending_cmd function.
	* server-src/server_util.h: get_pending_cmd prototype.
	* server-src/driver.c: Send message to dumper in ABORT command.
	* server-src/driverio.c: Send message to dumper in ABORT command.
	* server-src/dumper.c: Check for ABORT cmd.
	* server-src/reporter.c: Don't log duplicate
	                         'Not enough holding disk space' error

2009-01-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Fix result_argv subscript.

2009-01-08  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/amfetchdump.c: Write to stderr.

2009-01-06  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c (tape_device_seek_file): Set is_eof to FALSE
	  after it is use.

2009-01-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: Don't call changer_label() if a changer is not
	                      in use.

2009-01-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driverio.c: Set *result_argv to NULL on EOF.
	* server-src/taper-mem-port-source.c: Set an error if the memory can't
	  be allocated for the memory buffer.

2009-01-05  Dustin J. Mitchell <dustin@zmanda.com>
	* client-src/runtar.c: remove unnecessary check for existence of
	  CLIENT_LOGIN

2009-01-05  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Archive.swg, perl/Amanda/Device.swg,
	  perl/Amanda/Xfer.swg: Fix compiler warning.

2009-01-05  Jean-Louis Martineau <martineau@zmanda.com>
	* config/automake/scripts.am: Remove 'use lib' line before doing check.

2008-12-22  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in: AM_INIT_AUTOMAKE(amanda, "2.6.1b2")
	* packaging/deb/rules, packaging/deb/buildpkg,
	  packaging/deb/changelog, packaging/rpm/buildpkg,
	  packaging/rpm/amanda.spec: Change version to 2.6.1b2.

2008-12-22  Paul Yeatman <pyeatman@zmanda.com>
	* man/entities/global.entities.in: added author/email entity for me
	* man/xml-source/amanda-auth.7.xml: newly added man page
	* man/Makefile.am: added amanda-auth to section 7
	* man/xml-source/amanda.conf.5.xml: removed details on auth parameter
	and added link to amanda-auth man page 
	* man/xml-source/amanda.conf.5.xml: moved AUTHORIZATION section to
	amanda-auth and added link to amanda-auth man page 

2008-12-22  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c: retry on CURLE_GOT_NOTHING (52) to handle "connection reset by peer"

2008-12-22  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3.c: translate error code 0 to "None", not NULL

2008-12-22  Dustin J. Mitchell <dustin@zmanda.com>
	* application-src/amgtar.c,
	  application-src/amstar.c: Use sizeof(line) for argument to fgets.

2008-12-22  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amarchiver.8.xml: amanda-archive-format man page is
	                                   in section 5.

2008-12-22  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Dumpcache.pm
	  installcheck/Installcheck/Run.pm installcheck/amdump.pl
	  installcheck/pp-scripts.pl: move amdump_diag to Installcheck::Run, fix
	  it, and use it in amdump and pp-scripts
	* application-src/amlog-script.pl: don't pretend to be script-email
	* man/Makefile.am: amanda-archive-format should be section 5
	* man/xml-source/amanda-archive-format.5.xml: small tweaks
	* man/xml-source/amanda-changers.7.xml: fix authorship
	* man/xml-source/amanda.8.xml: add link to amvault(8)
	* man/xml-source/amvault.8.xml: enumerate limitations of this version
	* perl/Amanda/Config.swg: fix mem leak in config_dir_relative wrapper

2008-12-22  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/dirs.m4: add --with-amdatadir
	* example/Makefile.am: use it for examples and templates
	* perl/Amanda/Paths.pm.in: add $amdatadir
	* server-src/amserverconfig.pl: use it
	* packaging/deb/rules packaging/rpm/amanda.spec: packaging changes
	  so that built packages still put examples and templates in
	  /var/lib/amanda

2008-12-22  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amstar.c: Use fgets to read star output.
	* application-src/amgtar.c: Use fgets to read gtar output.

2008-12-22  Jean-Louis Martineau <martineau@zmanda.com>, 
	    Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/util.c: Convert underscore in application and script
			     property name to dash.
	* device-src/property.c: Make underscore and dash equal in device
				 property name.
	* installcheck/Amanda_Device.pl: Check device property name with
					 mixed case and dash.
	* installcheck/pp-scripts.pl: Check property name with underscore.

2008-12-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Fix reporting of FLUSH.

2008-12-19  Nikolas Coukouma <atrus@zmanda.com>, Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3-device.c, device-src/s3.c, device-src/s3.h:
	  Reset read and write when retrying a failed request

2008-12-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/holding.c (holding_get_file_chunks): Set fullpaths to 1.

2008-12-18  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Don't free 'rc'.

2008-12-18  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amgtar.8.xml: Improve documentation of regex.

2008-12-18  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.h (anonymous_value): New prototype.
	* common-src/conffile.c (anonymous_value): New function.
	* common-src/conffile.c: Use anonymous_value.
	* server-src/diskfile.c: Use anonymous_value.

2008-12-17  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Script_App.pm: Fix infinite loop.
	* perl/Amanda/Application/Zfs.pm: Fix for freebsd.

2008-12-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Run script only if todo is set.

2008-12-17  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/amfetchdump.pl: chdir() before rmtree().

2008-12-17  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/pipespawn.c: Remove bogus g_debug().

2008-12-17  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/amarchiver.pl: chdir() before rmtree().
	* installcheck/amcheckdump.pl: Add reason to BAIL_OUT.
	* installcheck/amdevcheck.pl: Add reason to BAIL_OUT.

2008-12-07  Satya Ganga <gsat@zmanda.com>
	* changer-src/chg-lib.sh.in: Remove dependency on ggrep and use mtx
	  offline command instead of "eject" which is not supported on solaris.

2008-12-17 Dan Locks <dwlocks@zmanda.com>
	* config/amanda/changer.m4: update AC_CHECK_HEADERS to get rid of
	  "present but cannot be compiled" warning during debian packaging.

2008-12-17 Dan Locks <dwlocks@zmanda.com>
       * packaging/rpm/amanda.spec: add detection for SLES11 (Beta)

2008-12-17  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amgtar.8.xml: atime_preserve -> atime-preserve
	* installcheck/pp-scripts.pl: add atime-preserve property, remove
	  references to Installcheck::Dumpcache, which isn't in this release

2008-12-16  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xslt/html.xsl.in: add <div class="refentry" /> for the benefit
	  of amanda.css.

2008-12-16  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Don't close if it's not open.

2008-12-16  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/Makefile.am: Add amlog-script.
	* application-src/amlog-script.pl: New scripts.
	* server-src/amcheck.c , server-src/planner.c,
	  server-src/server_util.c, server-src/server_util.h,
	  server-src/driver.c: Add level argument to run_server_scripts().
	  The script is executed with that level argument.
	* installcheck/pp-scripts.pl: Check scripts.
	* installcheck/Makefile.am: Add pp-scripts.

2008-12-16  Dustin J. Mitchell <dustin@zmanda.com>
	* man/Makefile.am man/xml-source/amanda-changers.7.xml
	  man/xml-source/amanda-devices.7.xml man/xml-source/amanda.8.xml
	  man/xml-source/amanda.conf.5.xml: new documentation
	* perl/Amanda/Changer.pm: not finished yet!
	* perl/Amanda/Changer/compat.pm: fix error message
	* server-src/changer.c changer-src/chg-glue.pl:
	  better error handling

2008-12-16  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-glue.pl: add labelling support
	* perl/Amanda/Changer/compat.pm: only call '-label' on chg-zd-mtx if
	  the changer is not seekable (hack to make slotinfofile work)
	* changer-src/chg-zd-mtx.sh: provide optional slotinfofile mapping
	  slots to labels on a best-information-available basis

2008-12-15  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Set wait_30s to 0 for local auth.

2008-12-15  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Config.pl: work around buggy sort() in perl-5.6
	* installcheck/Amanda_DB_Catalog.pl installcheck/Amanda_Logfile.pl:
	  stringify bigints in is_deeply arguments
	* perl/Amanda/Archive.swg: grok_number is not in perl-5.6
	* perl/Amanda/BigIntCompat.pm: additional overloads and methods for
	  BigIntCompat for perl-5.6 compatibility

2008-12-14  Dustin J. Mitchell <dustin@zmanda.com>
	* man/Makefile.am: change manpage build process
	* man/entities/global.entities.in: generate with config.status
	* man/xslt/html.xsl.in: new templates to handle authors
	* man/xslt/man.xsl.in: new templates to handle authors
	* man/xml-source/*.xml: change specification of authors
	* man/xml-source/amanda-applications.7.xml: add links to apps
	* man/xml-source/amanda-scripts.7.xml: add links to scripts

2008-12-12  John Hein <jhein@timing.com>
	* server-src/amdump.sh: fix Open3 invocation to work on
	  FreeBSD-4.x

2008-12-12  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Fix use of <programlisting>, it must
					    always be at the beginning of the line.

2008-12-12  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Fix coredump if GNUTAR is not set.

2008-12-12  Dustin J. Mitchell <dustin@zmanda.com>
	* client-src/sendbackup-dump.c: fix previous commit to not use
	  precompiler directives in the middle of a macro invocation

2008-12-12  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS, ReleaseNotes: Add amzfs-sendrecv.
	* client-src/sendbackup.c: Fix indexd test.
	* man/Makefile.am: Add amzfs-sendrecv.8.
	* man/xml-source/amzfs-snapshot.8.xml: Add DLE format example.
	* man/xml-source/amanda-applications.7.xml: Add amzfs-sendrecv.8.
	* man/xml-source/amanda.8.xml: Add amzfs-sendrecv.8.
	* man/xml-source/amzfs-sendrecv.8.xml: New man page.
	* application-src/amzfs-sendrecv.pl: New application.
	* application-src/amzfs-snapshot.pl: Fix to use
	                                     Amanda::Application::Zfs
	* application-src/Makefile.am: Add amzfs-sendrecv.
	* perl/Amanda/Script_App.pm: Exit instead of die.
	* perl/Amanda/Application/Zfs.pm: New perl module for zfs.
	* perl/Makefile.am: Add Amanda/Application and
	                    Amanda/Application/Zfs.pm

2008-12-12  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Wait to read at least one byte from the
				      data stream before forking the child.

2008-12-12  Jun Kuriyama <kuriyama@freebsd.org>, Göran Löwkran
	* changer-src/chg-zd-mtx.sh: fix bashisms
	* client-src/sendbackup-dump.c: use -L on systems that support it

2008-12-11  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS, ReleaseNotes: Add amsamba.

2008-12-11  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Check start_t before doing a dump to tape.

2008-12-09  C R Ritson.
	* server-src/reporter.c: Add threshold to small and big estimate.

2008-12-09  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: Parse RECOVER-MODE application support.
	* client-src/client_util.h (backup_support_option_t):
	                           Add smb_recover_mode.
	* client-src/sendsize.c: Fix size.
	* man/Makefile.am: Add amsamba.8.
	* man/xml-source/amsamba.8.xml: New man page.
	* man/xml-source/amanda-applications.7.xml: List amsamba.
	* man/xml-source/amanda.8.xml: List amsamba.
	* application-src/Makefile.am (CHECK_PERL): Add amsamba
	* application-src/amsamba.pl: New application.
	* recover-src/extract_list.c: Get support option from application
	  and set --recover-mode if needed.
	* recover-src/amrecover.h: Remove some "#ifdef SAMBA_CLIENT".
	* recover-src/set_commands.c: Remove some "#ifdef SAMBA_CLIENT".
	* perl/Amanda/Paths.pm.in: Add $sysconfdir.
	* perl/Amanda/Util.swg: Add skip_quoted_string.

2008-12-09  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amstar.8.xml: Typo.

2008-12-09  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Fix plugin location.

2008-12-07  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/Makefile.am server-src/amvault.pl: new, experimental
	  script to copy data from secondary to tertiary volumes
	* common-src/fileheader.c: strip spurious ' ' from headers
	* man/Makefile.am man/xml-source/amvault.8.xml: docs
	* perl/Amanda/DB/Catalog.pm: add kbps calculation
	* perl/Amanda/Device.swg: add volume_header() method

2008-12-05  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/taper.c: remove dead code that can cause compiler errors

2008-12-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driverio.c: Send a message with NO-NEW-TAPE.
	* server-src/driver.c: Generate message for NO-NEW-TAPE, call
	  start_degraded_mode when sending NO-NEW-TAPE, Fix a subscript error 
	  for INPUT-ERROR and TAPE-ERROR
	* server-src/taper.c: Get message from NO-NEW-TAPE command and log it.

2008-12-03  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Provide default unit.

2008-12-03  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheckdump.pl: Use GNUTAR to validate smbclient image.

2008-12-01  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c: fix signedness

2008-12-01  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/util.c: fix mishandling of trailing backslash in
	  unquote_string

2008-12-01  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c, device-src/s3.h: Fix segmentation fault within s3_make_bucket
	  by adding some "null-op" read and write functions.

2008-11-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Correctly parse degraded size.

2008-11-26  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Set application in extraction command.

2008-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in: AM_INIT_AUTOMAKE(amanda, "2.6.1b1")
	* ReleaseNotes: Release notes for 2.6.1b1.
	* NEWS: News for 2.6.1b1.
	* packaging/deb/rules, packaging/deb/buildpkg,
	  packaging/rpm/buildpkg,
	  packaging/rpm/amanda.spec: Change version to 2.6.1b1.

2008-11-25  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/bsd-security.m4: Fix.
	* config/amanda/bsdtcp-security.m4: Enable --with-bsdtcp-secutiy by
	                                    default.
	* config/amanda/ssh-security.m4: Enable --with-ssh-security by default.

2008-11-25  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/Makefile.am changer-src/chg-glue.pl:
	  add new c-to-perl glue script
	* server-src/changer.c: interface with new script
	* server-src/amtape.c man/xml-source/amtape.8.xml:
	  remove 'slot last' and 'slot prev'
	* perl/Amanda/Changer.pm perl/Amanda/Changer/compat.pm
	  perl/Amanda/Changer/disk.pm perl/Amanda/Changer/single.pm: updates to
	  new Changer API
	* installcheck/Amanda_Changer.pl installcheck/Amanda_Changer_compat.pl
	  installcheck/Amanda_Changer_disk.pl installcheck/Amanda_Changer_single.pl
	  installcheck/Makefile.am: tests for all of it

2008-11-25  Dustin J. Mitchell <dustin@zmanda.com>
	* example/template.d/advanced.conf.in: don't imply that
	  maxdumpsize is in bytes

2008-11-21  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c: work around a bug in Amazon's HTTP implementation
	  by avoiding HEAD requests.

2008-11-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c (clean_dle_str_for_client): Return NULL if
							    argument is NULL.
	* restore-src/restore.c: Also check for F_EMPTY.

2008-11-21  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Wait up to 5 seconds dwfor only for process
				 that should terminate.

2008-11-21  Dustin J. Mitchell <dustin@zmanda.com>
	* restore-src/restore.c: Continue if setting PROPERTY_READ_BUFFER_SIZE
				 fail.

2008-11-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/server_util.c: Skip one field in parsing INFO pid line.

2008-11-20  Jean-Louis Martineau <martineau@zmanda.com>
	* oldrecover-src/extract_list.c: Use config.
	* server-src/dumper.c: Check dle_str for NULL.

2008-11-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amdump.sh: Run amreport if the 'log' file already exist.

2008-11-20  Urs Schurer <urs@sitb.de>
	* server-src/amindexd.c: remove unnecessary stralloc()/free() calls
	  in process_ls_dump

2008-11-19 Satya Ganga <gsat@zmanda.com>
	* example/inetd.conf.amandaserver.in: Add serverconfig file
	* configure.in,example/Makefile.am: Include inetd.conf.amandaserver

2008-11-18 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: removed conditionals around
	  perl(ExtUtils::Embed) so that buildrequires applies to all platforms

2008-11-18  Satya Ganga <gsat@zmanda.com>
	* device-src/tape-device.c: Remove O_NONBLOCK flag from all tape open calls.

2008-11-18  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amstar.c: Free qdisk after the loop.
	* application-src/amgtar.c: Free qdisk after the loop.

2008-11-17  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amgtar.8.xml: Update for ATIME-PRESERVE default.

2008-11-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: Fix formating.

2008-11-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Parse "taper: using label ..." line.
	* server-src/driver.c: Print tape size.
	* server-src/amtoc.pl: Fix for new log format.
	* server-src/reporter.c: Increase field width.
	* server-src/taper.c: Print number of kbytes written to each tape.

2008-11-14  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3-device.c: eliminate an extra buffer copy in the
	  common case where the caller supplies a large enough buffer
	* device-src/s3.h: tweak a comment

2008-11-14  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/holding.h: Improve comment.
	* server-src/reporter.c: Print holding disk size in displyaunit.

2008-11-14  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: Get stderr of scripts and send it to
				    server.
	* client-src/client_util.h: Add err in client_script_result_t.
	* client-src/sendbackup.c: Call run_client_scripts with mesgstream.
	* client-src/sendsize.c: Fix.
	* server-src/planner.c: Get WARNING line from client.
	* server-src/reporter.c: Don't mark the dumper as FAILED if the
				 planner FAILED.
	* common-src/amfeatures.h (fe_sendsize_rep_warning): New amfeature
	* common-src/amfeatures.c: Add fe_sendsize_rep_warning.

2008-11-12  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amfetchdump.8.xml: fix ugly HTML formatting

2008-11-11  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Check that something is ready to be read
				 before calling errfd_recv.

2008-11-11  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-manual.sh: fix typo

2008-11-11 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: add fedora 9 detection, add
	  BuildRequires: perl(ExtUtils::Embed), fix %{dist}=unknown when
	  undetected instead of at all times

2008-11-11  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am installcheck/amfetchdump.pl: build all
	  active test scripts; add a DLE in the amfetchdump installcheck

2008-11-11  Dustin J. Mitchell <dustin@zmanda.com>
	* config/macro-archive/ac_perl_module_version.m4: new macro
	* config/amanda/swig.m4: check for ExtUtils::Embed

2008-11-11  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amarchiver.pl: quote $sbindir from regexp
	  interpretation

2008-11-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: Don't add Amanda/Script_App.pm and Amanda/Script.pm
			    to DISTCLEANFILES.

2008-11-11  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/amdump.pl: Set property "ATIME-PRESERVE" to "NO" in
				  amgtar application.

2008-11-11  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c: fix.
	* amandad-src/amandad.c: Read stderr of server and report it to server.
	* server-src/planner.c: Keep first line only.

2008-11-10  Dustin J. Mitchell <dustin@zmanda.com>
	* amar-src/amarchiver.c: fix filesize printf conversion

2008-11-10  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c, client-src/selfcheck.c: Check return
							   value of pipe.

2008-11-10  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Run.pm: change default DLEs
	* installcheck/amcheckdump.pl: add DLE explicitly
	* installcheck/amdevcheck.pl: add DLE explicitly
	* installcheck/amdump.pl: use the amgtar application in a dump

2008-11-10  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: only test amfetchdump if it was built
	* installcheck/amfetchdump.pl: use arguments in the right order

2008-11-10  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Archive.swg amar-src/amar.c amar-src/amar.h: bugfixes
	* man/Makefile.am man/xml-source/amarchiver.8.xml
	  amar-src/Makefile.am amar-src/amarchiver.c: new application
	* installcheck/Makefile.am installcheck/amarchiver.pl: tests

2008-11-10  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Run.pm: add Expect support
	* installcheck/Makefile.am installcheck/amfetchdump.pl: amfetchdump
	  installcheck, using Expect support

2008-11-10  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amgetconf.pl: don't setup_application() in dbclose

2008-11-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: Build Amanda::Application only if WANT_CLIENT.

2008-11-08  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm perl/Amanda/Changer/compat.pm
	  perl/Amanda/Changer/disk.pm perl/Amanda/Changer/single.pm
	  perl/Makefile.am: entirely new perl-based changer API
	* perl/Amanda/Config.swg common-src/conffile.c common-src/conffile.h:
	  add changer subsections
	* man/xml-source/amanda.conf.5.xml: document them
	* server-src/amcheckdump.pl: use the new changer API
	* installcheck/Amanda_Changer.pl installcheck/Amanda_Changer_Compat.pl
	  installcheck/Amanda_Changer_Single.pl installcheck/Amanda_Config.pl
	  installcheck/Installcheck/Config.pm installcheck/Makefile.am
	  installcheck/Amanda_Changer_Disk.pl: new/updated tests

2008-11-07  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amstar.c: fix.

2008-11-07  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Application.swg: Remove %init.

2008-11-07  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c, application-src/amgtar_perl.pl,
	  application-src/amstar.c: Write backup image to fd3 and index to fd4.
	* perl/Amanda/Script_App.pm: Use $self->{mesgout}.
	* recover-src/extract_list.c: Add more check.
	* client-src/client_util.c (backup_support_option): Get stderr of
	  application and put it in errarray,
	* client-src/client_util.h (backup_support_option): New prototype.
	* client-src/selfcheck.c, client-src/sendbackup.c,
	  client-src/sendsize.c: Get stderr of application and send it to
				 server.
	* server-src/dumper.c: Log the first error message.
	* server-src/planner.c: Log the first error message.
	* server-src/reporter.c: Don't print some error in report.

2008-11-07  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: Parse CALCSIZE and MULTI-ESTIMATE.
	* client-src/client_util.c (run_calcsize): New function.
	* client-src/client_util.h (run_calcsize): Prototype.
	* client-src/sendbackup.c: Update amandates.
	* client-src/sendsize.c: Handling of calcsize and multi-estimate.
	* client-src/selfcheck.c: Check calcsize for application.
	* application-src/amgtar_perl.pl, application-src/amstar.c,
	* application-src/amgtar.c: handling of calcsize and multi-estimate.
	* perl/Amanda/Script_App.pm: Add a check.
	* perl/Amanda/Application.swg: Add run_calcsize.
	* perl/Amanda/Application.pm: Delete
	* perl/Makefile.am: Built from Application.swg
	* client-src/calcsize.c: Handling of STAR program.

2008-11-06  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amgtar.8.xml: Document new properties.
	* application-src/amgtar.c: Remove ifdef IGNORE_TAR_ERRORS.

2008-11-06  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-zd-mtx.sh: Return first line of mtx output if mtx
				     exit with a status != 0.
	* server-src/amtape.c: Display changer error.

2008-11-06  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Add exit-handling property.

2008-11-06  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Add normal, ignore and strange property.

2008-11-04  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Check tape_splitsize < tape length.

2008-10-30  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/find.c server-src/find.h man/xml-source/amadmin.8.xml:
	  add new sort key, 'w', for write_timestamp
	* server-src/amadmin.c: use it
	* server-src/amindexd.c restore-src/amfetchdump.c: use 'w' to prefer
	  the oldest-written copy of a dump

2008-10-30  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar_perl.pl, application-src/amstar.c,
	  application-src/amgtar.c: Implement validate command.
	* server-src/amcheckdump.pl: Execute the validate command of an
				     application.
	* perl/Amanda/Script_App.pm (print_to_server): Add validate.
	* perl/Amanda/Application.pm (known_commands): Add validate.
	* common-src/security-util.c: Fix typo.

2008-10-29  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.conf.5.xml
	  man/xml-source/amanda-devices.7.xml: improve device property
	  documentation

2008-10-29  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: taperflush params can be
	  greater than 100%

2008-10-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/fileheader.c (dumpfile_free_data): New function.
	* common-src/fileheader.h (dumpfile_free_data): New prototype.
	* server-src/cmdline.c, server-src/dumper.c,
	  server-src/planner.c, server-src/amadmin.c,
	  server-src/amflush.c, server-src/holding.c,
	  server-src/driver.c, server-src/find.c,
	  server-src/taper-source.c, server-src/taper-file-source.c
	  server-src/taper.c: Call dumpfile_free or dumpfile_free_data.

2008-10-27  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/glib-util.c: check library version at runtime

2008-10-27  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Device.swg (start_file): Remove const for jobInfo.

2008-10-24  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Archive.pl: fix to also test for identity of
	  $user_data on perls that recognize such things

2008-10-24  Dustin J. Mitchell <dustin@zmanda.com>
	* amar-src/amar-test.c: don't ignore the return value of write()

2008-08-14  Nikolas Coukouma <atrus@zmanda.com>
            Jean-Louis Martineau <martineau@zmanda.com>
	* amar-src/amar.c: fix mis-aligned memory accesses
	* amar-src/amar-test.c: fix test_pipe

2008-10-24  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Script_App.pm: New base module for script and application.
	* perl/Amanda/Script.pm: New base module for script.
	* perl/Amanda/Application.pm: New base module for application.
	* perl/Makefile.am: Add Amanda::Script_app, Amanda::Script And
				Amanda::Application.
	* application-src/generic-dumper.pl: Remove file.
	* application-src/generic-script.pl: Remove file.
	* application-src/script-email.pl: Use Amanda::Script.
	* application-src/amgtar_perl.pl: Use Amanda::Application.
	* application-src/amzfs-snapshot.pl: Use Amanda::Script.
	* application-src/Makefile.am: Remove generic-*.pl files.

2008-10-24  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Archive.swg perl/Makefile.am: add a Perl interface to
	  libamar
	* installcheck/Amanda_Archive.pl installcheck/Makefile.am: test it.

2008-10-24  Dustin J. Mitchell <dustin@zmanda.com>
	* */Makefile.am: change @AMLINT@ to $(AMLINT), similarly for
	  $(AMLINTFLAGS), and strip $(EXEEXT) from program names when running
	  lint
	* config/amanda/libs.m4: put GLIB_CFLAGS in AMANDA_CPPFLAGS

2008-10-23  Dustin J. Mitchell <dustin@zmanda.com>
	* amar-src/Makefile.am: add amar.h to noinst_HEADERS

2008-10-23  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in Makefile.am amar-src/Makefile.am: new directory
	* amar-src/amar.c amar-src/amar.h: amanda archive library
	* amar-src/amar-test.c: tests for library
	* common-src/security-util.c common-src/security-util.h
	  common-src/util.c common-src/util.h: move net_writev to
	  util.c, rename to full_writev
	* man/Makefile.am man/xml-source/amanda-archive-format.7.xml
	  man/xml-source/amanda.8.xml: new manpage to describe the format

2008-10-20 Nikolas Coukouma <atrus@zmanda.com>
	* configure.in: add tests for more headers, plus some defines
	  for the presence of Amanda's headers
	* device-src/s3-util.c, device-src/s3-util.h: Use defines to switch between
	  POSIX regex API and a GRegex (PCRE) call-compatability layer.
	* device-src/s3.c, device-src/s3.h: Add a curl progress callback.
	  Use callbacks to write and read data. Provide callbacks for
	  memory buffers and files. The callbacks for files are currently
	  Windows-specific.
	* device-src/s3-device.c: update to use new API

2008-10-20  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am: remove spurious variables

2008-10-17  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-multi.sh: Check permission on the statefile and its
				    directory.

2008-10-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Set i to 0.

2008-10-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c, server-src/dumper.c
	  server-src/planner.c: Don't send appliaciton-api request if the
				client doesn't use the xml protocol.

2008-10-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: print space instead of N/A, dumper stats are
				 set to "FLUSH" if it is a flush.

2008-10-13  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/vfs-device.c: re-open the dir handle on every
	  device start or read label
	* installcheck/Amanda_Device.pl: adjust tests to degrade the
	  VFS device *after* it is started

2008-10-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: Moce EXTRA_DIST out of conditionals.

2008-10-13  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Makefile.am: revert previous commit.
	* config/automake/scripts.am: Check for a server perl module.

2008-10-13  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Makefile.am: SCRIPTS_PERL = $(tests).

2008-10-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: Don't check Amanda/Config files.

2008-10-11  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: Check file in top_srcdir if they are not
			    in top_builddir.

2008-10-10  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amgetconf.pl: remove 'use Amanda::Device qw( :constants);'

2008-10-10  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Makefile.am: test for libConfig.so before doing check.

2008-10-10  Jean-Louis Martineau <martineau@zmanda.com>
	* config/automake/scripts.am: Check perl scripts on compilation.
	  Add -I... to 'make check' to access perl module in build tree.
	  Add installcheck rules to check perl scripts with installed perl
	  modules.
	* application-src/amstar_perl.pl: Remove file.
	* device-src/Makefile.am, application-src/Makefile.am,
	  server-src/Makefile.am, installcheck/Makefile.am,
	  common-src/Makefile.am: Move most perl scripts to CHECK_PERL.
	* installcheck/Makefile.am:
	  Add "CHECK_PERL_FLAGS=-I$(top_srcdir)/installcheck".
	* perl/Makefile.am: Add rules to check all .pm files for check-local.
	* device-src/amtapetype.pl, server-src/amaddclient.pl,
	  common-src/amgetconf.pl: Fix syntax errors.

2008-10-10  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amzfs-snapshot.pl, application-src/amoracle.pl
	  application-src/script-email.pl, application-src/amgtar_perl.pl:
	    fix typos.

2008-10-10  Nick Smith <nick.smith@techop.ch>
	* application-src/amzfs-snapshot.pl: fix typos

2008-10-08  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/DB/Catalog.pm: manage the tapelist internally
	* perl/Amanda/Tapelist.swg: fix error message, re-read C tapelist
	  after writing
	* server-src/amcheckdump.pl: don't read tapelist
	* installcheck/Amanda_DB_Catalog.pl: don't read tapelist first

2008-10-08  Nick Smith <nick.smith@techop.ch>
	* server-src/driver.c: set degr_mesg to NULL when not degraded

2008-10-06  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amzfs-snapshot.pl: Accept execute-where argument.
	* application-src/script-email.pl: Accept execute-where argument.
	* client-src/client_util.c: Send execute-where argument to script.
	* server-src/server_util.c: Send execute-where argument to script.

2008-10-06  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amzfs-snapshot.pl: Add PFEXEC-PATH and PFEXEC
					     properties.
	* man/xml-source/amzfs-snapshot.8.xml: Document new properties.

2008-10-03  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Util.swg: add Amanda::Util::generate_timestamp
	* common-src/timestamp.c: add comment

2008-10-02  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/DB/Catalog.pm: add rudimentary ability to read logfiles
	* installcheck/Amanda_DB_Catalog.pl: test it
	* perl/Amanda/Logfile.swg: fix typo

2008-10-01  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3-device.c, device-src/s3.c, device-src/s3.h:
	  Add new property, S3_SSL, to control the use of SSL/TLS when
	  connecting to Amazon S3
	* man/xml-source/amanda-devices.7.xml:
	  document S3_SSL and S3_BUCKET_LOCATION

2008-10-01  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3-util.c: Re-implement s3_hex_encode() to avoid OpenSSL weirdness.

2008-10-01  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amanda.h common-src/conffile.c
	  oldrecover-src/extract_list.c recover-src/extract_list.c
	  server-src/amcheck.c server-src/amflush.c server-src/planner.c:
	  use g_ascii_isspace, as we assume ASCII (for now) and isspace()
	  is affected by locale and encoding settings.  Thanks to Michael
	  Reuland for helping track this down.

2008-09-30  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.h (xml_optionstr): New prototype.
	* server-src/diskfile.h (clean_dle_str_for_client): Prototype.
	* server-src/amindexd.c: Pass 0 to new argument of xml_optionstr.
	* server-src/amcheck.c: Pass 0 to new argument of xml_optionstr.
	* server-src/planner.c: Pass 0 to new argument of xml_optionstr.
	* server-src/driverio.c: Pass 1 to new argument of xml_optionstr.
	* server-src/dumper.c: Call clean_dle_str_for_client.
	* server-src/diskfile.c (xml_optionstr): Work for ENCRYPT_SERV_CUST.
	* server-src/diskfile.c (clean_dle_str_for_client): New function.
	* restore-src/restore.c: Call clean_dle_str_for_client.
	* common-src/amxml.c: Fix parsing.
	* common-src/amanda.h (match_no_newline): Prototype.
	* common-src/match.c (match_no_newline): New function.

2008-09-30  Dustin J. Mitchell <dustin@zmanda.com>
	* restore-src/restore.c: set data.flags for use by the changer_find
	  callback

2008-09-30  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/MainLoop.swg: add call_later()
	* installcheck/Amanda_MainLoop.pl: test it

2008-09-30  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/rait-device.c: fix typos

2008-09-30  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/semaphore.h: fix typo
	* device-src/rait-device.c: add a private threadpool-like
	  implementation for old glibs, where GThreadPool is susceptible to
	  deadlock

2008-09-29  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/device.c device-src/device.h device-src/null-device.c
	  device-src/property.c device-src/property.h device-src/rait-device.c
	  device-src/s3-device.c device-src/tape-aix.c device-src/tape-device.c
	  device-src/tape-device.h device-src/tape-ops.h device-src/tape-posix.c
	  device-src/tape-uware.c device-src/tape-xenix.c
	  device-src/vfs-device.c: add a 'configure' method to the Device API;
	  revamp device property handling to add source and surety and make
	  implementation easier
	* device-src/rait-device.h device-src/rait-device.c: make RAIT device
	  calculate block sized based on child devices, if they were configured
	  explicitly.
	* man/xml-source/amanda-devices.7.xml: note that common properties are
	  not implemented on all devices
	* common-src/glib-util.c common-src/glib-util.h: add helpers for
	  case-insensitive hashes
	* changer-src/scsi-changer-driver.c installcheck/Amanda_Device.pl
	  perl/Amanda/Device.swg restore-src/restore.c server-src/amcheck.c
	  server-src/amlabel.c server-src/amtape.c server-src/taper.c
	  server-src/taperscan.c: use new API

2008-09-29  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/find.c: handle find_result->label == NULL
	* perl/Amanda/DB/Catalog.pm: filter out bogus results with NULL label

2008-09-26  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/amglue/ghashtable.c: #include conffile.h, not conffile.c (!)

2008-09-26  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Parse dumpsize from taper result.

2008-09-26  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c: Set qdevice on common_exit path.

2008-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/fileheader.c: fix headers_are_equal

2008-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/fileheader.c common-src/fileheader.h: allow blocksize=0
	* device-src/device.c device-src/device.h: set blocksize in tape
	  header
	* device-src/null-device.c device-src/s3-device.c
	  device-src/tape-device.c device-src/vfs-device.c: set blocksize
	  in headers when starting files
	* device-src/rait-device.c: duplicate headers for child devices, since
	  they are no longer const
	* server-src/dumper.c: set blocksize on holding-disk files to
	  DISK_BLOCK_BYTES

2008-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tape-device.c: mark device as non-appendable temporarily,
	  since file numbers are incorrect when appending
	* installcheck/Amanda_Device.pl: handle non-appendable devices

2008-09-24  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driverio.c (dumper_cmd, chunker_cmd): Take new mesg
	  argument.
	* server-src/server_util.h (dumper_cmd, chunker_cmd): New prototype.
	* server-src/chunker.c: Get mesg from ABORT cmd and log it.
	* server-src/driver.c: Add the mesg argument to all dumper_cmd and
			       chunker_cmd.

2008-09-24  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Set degr_mesg and send it to driver.
	* server-src/driverio.h (sched_t): Add degr_mesg field.
	* server-src/driver.c: Parse message if no degraded estimate.

2008-09-23  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c common-src/conffile.h: store a struct
	  containing both filename and line number for each parameter, and use
	  it when reporting errors and warnings

2008-09-23  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/device.c: make 'unimplemented method' an assertion

2008-09-23  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3.c: use max_keys, instead of maximum body size (which
	  doesn't work) to limit the number of keys listed

2008-09-22  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/fileheader.c (fh_init): Set default type to F_EMPTY.
	* changer-src/chg-zd-mtx.sh: Allow to remove barcode from barcode file.
	* server-src/taperscan.c: Check type != F_EMPTY.
	* server-src/taper.c: Call changer_label().
	* server-src/amlabel.c: iCheck type != F_EMPTY. Call changer_label().

2008-09-22  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.c: Don't g_value_unset a bzero value.

2008-09-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Set result_argv=NULL, Fix typo.

2008-09-22  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/ps.m4: give up on runtime detection and just special-
	  case the 'ps' arguments for various systems
	* perl/Amanda/Constants.pm.in: add $PS
	* perl/Amanda/Process.pm: use $PS

2008-09-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c (addline): Done it constant time.

2008-09-19  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/Makefile.am common-src/quoting-test.c: new tests
	* common-src/token.c common-src/token.h: removed
	* common-src/util.c common-src/util.h: new home for quoting functions
	* configure.in: don't check for shquote
	* man/xml-source/amanda.conf.5.xml: info on quoting
	* perl/Amanda/Config/Server.pm: note about incompatibility
	* server-src/amcheck.c server-src/amindexd.c server-src/chunker.c
	  server-src/driver.c server-src/driverio.c server-src/driverio.h
	  server-src/dumper.c server-src/infofile.c server-src/server_util.c
	  server-src/server_util.h server-src/taper-file-source.c
	  server-src/taper-port-source.c server-src/taper.c: use new/updated
	  quoting functions

2008-09-19  Nick Smith <nick.smith@techop.ch>
	* example/amanda.conf.in: fix incorrect execute_on examples

2008-09-18  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Call security_close_connection before
			       checking if pkt == NULL.

2008-09-18  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Nick Smith
	* server-src/diskfile.c: Fix vstrextend use, Patch by Nick Smith.
	* server-src/diskfile.c: Init xml_app.result to stralloc("").

2008-09-16 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec:  Added detection of CentOS 4 and 5 as 
	  suggested by dswartz.  added graceful failure when Distro/version is 
	  not detected correctly

2008-09-15  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c: uninit apps, pp_scripts, and device_configs

2008-09-14  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/tapefile.c server-src/tapefile.h: add comments to
	  tapelist
	* perl/Amanda/Tapelist.swg: perl tapelist parser, too
	* installcheck/Amanda_Tapelist.pl: tests
	* man/xml-source/tapelist.5.xml: docs
	* server-src/amlabel.c: no initial comments when labeling
	* server-src/taper.c: maintain comment when relabeling

2008-09-12  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Fix typo: authetication -> authentication.

2008-09-05  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: fix inequalities; thanks to
	  Mike McConnell for spotting these

2008-09-05  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/taper.c: improve handling of device errors in taper

2008-09-02  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/amrestore.c: Load a default server config.

2008-08-29  Dustin J. Mitchell <dustin@zmanda.com>
	* autogen: revert glib's configure-time requirement for
	  pkg-config-0.16

2008-08-28  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tape-device.c: use the correct blocksize while reading
	* device-src/rait-device.c: fix typo
	* installcheck/Amanda_Device.pl: use the VFS device in RAIT tests, not
	  the tape device

2008-08-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Reset the MESG buffer for a new dump.

2008-08-27  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amcheck.c: make the check for tapelist result in a NOTE,
	  not a failure
	* server-src/tapefile.c: make a missing tapelist equivalent to an
	  empty one

2008-08-27  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/types.m4: always include sys/types.h, if it exists,
	  before trying other headers (fixes builds of FreeBSD-4.x); thanks
	  to John Hein <jhein@timing.com>
	* perl/Amanda/MainLoop.swg server-src/driverio.h: include amanda.h
	  before event.h

2008-08-22  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/amglue/bigint.c: add #include "stdint.h"

2008-08-22  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/ps.m4: search multiple ps invocations; thanks
	  to John Hein <jhein@timing.com>

2008-08-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.ci (tape): Correctly print next tape to use.
	* server-src/tapefile.c (print_new_tapes): New function to print new
						   tapes.
	* server-src/tapefile.h (print_new_tapes): Prototype.
	* server-src/reporter.c: Correctly print next tape to use.

2008-08-22  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c common-src/conffile.h perl/Amanda/Config.swg:
	  add new 'define device' config section
	* perl/Makefile.am perl/Amanda/Config/Server.pm
	  perl/Amanda/Config/Server/Devices.pm
	  perl/Amanda/Config/Server/Grammar: ditto
	* device-src/device.c device-src/device.h: configure devices from
	  device definitions, with better error handling
	* device-src/rait-device.c: handle child devices better
	* installcheck/Amanda_Config.pl installcheck/Amanda_Config_Server.pl
	  installcheck/Amanda_Xfer.pl installcheck/Installcheck/Config.pm
	  installcheck/amgetconf.pl: new tests, modifications to work with the
	  new system
	* man/xml-source/amanda-devices.7.xml
	  man/xml-source/amanda.conf.5.xml: corresponding documentation updates
	* perl/Amanda/Changer.pm perl/Amanda/Device.swg
	  restore-src/amrestore.c restore-src/restore.c server-src/amcheck.c
	  server-src/amcheckdump.pl server-src/amdevcheck.pl
	  server-src/amlabel.c server-src/amtape.c server-src/taper.c
	  server-src/taperscan.c: remove calls to
	  set_startup_properties_from_config
	* device-src/vfs-test.c: load config before trying to use a device
	* common-src/conffile.c: fix use of uninitialized variable

2008-08-22  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-disk.sh: replace == with =
	* changer-src/chg-lib.sh.in: fix sed invocation for BSD's sed

2008-08-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Fix computation of compression ratio.

2008-08-22  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.h: Add DMP_IGNORE and AM_IGNORE_RE.
	* application-src/amgtar.c, application-src/amgtar_perl.pl:
	  Ignore "Directory is new" and "Directory has been renamed".

2008-08-21  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/krb5-security.c: Fix security_seterror use.

2008-08-19  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in: check for getgrgid_r and getpwuid_r
	* common-src/security-util.c: conditionalize on checks

2008-08-18  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/version.h: remove #include of config.h
	* device-src/vfs-device.c: #include amanda.h first

2008-08-18  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/Makefile.am device-src/amtapetype.pl: new perl amtapetype
	* installcheck/Installcheck/Run.pm: report exit status
	* installcheck/Makefile.am installcheck/amtapetype.pl: new test
	* man/xml-source/amtapetype.8.xml: updated manpage
	* device-src/s3-device.c device-src/vfs-device.c
	  device-src/tape-device.c: add compression property
	* perl/Amanda/Xfer.swg: add POD for the cancel() method
	* xfer-src/dest-device.c: add a default for max_memory

2008-08-18  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c: make find_multiplier case-insensitive
	* device-src/device.c: reorder assertions
	* device-src/tape-device.c: don't set access_mode twice, but
	  set in_file = FALSE in start
	* device-src/s3-device.c: fix property registration
	* perl/Amanda/MainLoop.swg: remove attach() from example
	* perl/Amanda/Xfer.swg: more detail in POD
	* xfer-src/source-pattern.c: operate byte-for-byte, like the random
	  source, instead of using lots of memcpys and reallocs
	* xfer-src/source-random.c: remove redundant check

2008-08-18  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in Makefile.am tape-src/*: remove tape-src
	* changer-src/Makefile.am: don't link with libamtape
	* changer-src/chg-scsi.c: don't use libamtape
	* changer-src/scsi-changer-driver.c: don't use libamtape
	* config/amanda/tape.m4: fix comment
	* example/amanda.conf.in example/template.d/tapetypes: fix outdated
	  comments
	* man/Makefile.am man/xml-source/amdd.8.xml man/xml-source/ammt.8.xml:
	  remove amdd and ammt manpages
	* restore-src/Makefile.am: remove refs to tape-src/
	* server-src/Makefile.am: remove refs to tape-src/

2008-08-18  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/krb4-security.c common-src/krb5-security.c
	  config/amanda/tape.m4 common-src/amanda.h: remove
	  --with-maxtapeblocksize
	* common-src/conffile.c: deprecate file-pad
	* device-src/device-queueing.c device-src/device-queueing.h
	  device-src/device.c device-src/device.h device-src/null-device.c
	  device-src/property.c device-src/property.h device-src/rait-device.c
	  device-src/s3-device.c device-src/tape-device.c
	  device-src/tape-device.h device-src/vfs-device.c server-src/amcheck.c
	  server-src/taper.c tape-src/tapeio.c xfer-src/dest-device.c
	  xfer-src/source-device.c perl/Amanda/Device.swg: devices have
	  {min,max,current} block sizes; remove the short_block parameter from
	  device_write_block; fix property initialization; rename
	  PROPERTY_MEDIUM_TYPE to PROPERTY_MEDIUM_ACCESS_TYPE
	* device-src/rait-device.c: set child block sizes explicitly
	* installcheck/Amanda_Device.pl: tests; better S3 test count
	  calculations
	* installcheck/Amanda_Xfer.pl: tests
	* man/xml-source/amanda-devices.7.xml: update block sizes
	  documentation
	* man/xml-source/amanda.conf.5.xml: refer to block size properties
	* restore-src/amrestore.c: use set_restore_device_read_buffer_size
	* restore-src/restore.h restore-src/restore.c: add
	  set_restore_device_read_buffer_size

2008-08-16  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/driver.c: handle taper_{input,tape}_error memory
	  correctly, and add taper_tape_error to the trace log

2008-08-16  Dustin J. Mitchell <dustin@zmanda.com>
	* application-src/amzfs-snapshot.pl application-src/script-email.pl:
	  remove unnecessary 'use Amanda::Device'

2008-08-16  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amgetconf.pl: use filename-safe characters for $appname
	* installcheck/amgetconf.pl: test it

2008-08-16  Dustin J. Mitchell <dustin@zmanda.com>
	* man/entities/global.entities: add manpage refs
	* packaging/rpm/amanda_enterprise.spec
	  packaging/rpm/amanda_enterprise_client.spec
	  man/xml-source/disklist.5.xml man/xml-source/tapelist.5.xml
	  man/Makefile.am: add disklist(5), tapelist(5)
	* man/xml-source/amaddclient.8.xml man/xml-source/amadmin.8.xml
	  man/xml-source/amanda-client.conf.5.xml man/xml-source/amanda.8.xml
	  man/xml-source/amanda.conf.5.xml man/xml-source/amcheck.8.xml
	  man/xml-source/amcheckdb.8.xml man/xml-source/amdevcheck.8.xml
	  man/xml-source/amflush.8.xml man/xml-source/amlabel.8.xml
	  man/xml-source/amrecover.8.xml man/xml-source/amrmtape.8.xml:
	  - remove references to "output drivers" in favor of "device drivers"
	  - add more inter-page references
	  - fix typos
	  - add client_login to amanda-client.conf(5)
	  - reformat informaltables, which don't render well in HTML or nroff,
	    into variablelists, with fixes for bad xml->man conversion
	  - fix funky replacement entities in HTML output
	* perl/Amanda/DB/Catalog.pm: mention $dump->{kb} and ->{sec}
	* perl/Amanda/Device.swg: fix typo
	* perl/Amanda/MainLoop.swg: add hints for writing async functions
	* perl/Amanda/Types.swg: fix bad POD
	* perl/Amanda/Util.swg: POD fix: use $CONTEXT_* rather than strings
	* perl/Amanda/Xfer.swg: tweaks
	* server-src/taper.c: fix typo
	* server-src/taperscan.c: remove "(previously non-amanda)", as Amanda
	  will no longer overwrite such tapes

2008-08-16  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/debug.c: lock debug logging on a per-line basis

2008-08-16  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/rait-device.c: parse RAIT names with internal {..}
	* installcheck/Amanda_Device.pl: light testing

2008-08-15  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/debug.c: include backtraces on fatal errors
	* config/amanda/debugging.m4: look for glibc's backtrace support
	* configure.in: ditto

2008-08-14  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tape-aix.c device-src/tape-ops.h device-src/tape-uware.c
	  device-src/tape-xenix.c: bring non-POSIX tape-ops implementations up
	  to date with function signatures

2008-08-14  Dustin J. Mitchell <dustin@zmanda.com>,
	    Nikolas Coukouma <atrus@zmanda.com>
	* xfer-src/*: add support for asynchronous cancellation of transfers
	  and use it for error-handling
	* perl/Amanda/Xfer.swg: reflect into perl
	* installcheck/Amanda_Xfer.pl: test cancellation

2008-08-12  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/Makefile.am: clean up svn-info.h on maintainer-clean
	* man/Makefile.am: remove config.log after running config.status

2008-08-07 Nikolas Coukouma <atrus@zmanda.com>
    	* common-src/conffile.c: cleaner fix for signed compared to unsigned
    	  errors on older versions of GCC.

2008-08-06  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/Makefile.am: second fix

2008-08-06  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/Makefile.am: don't syntax-check amgetconf, since
	  it uses Amanda::* modules

2008-08-06 Nikolas Coukouma <atrus@zmanda.com>
    	* server-src/amgetconf.pl, common-src/amgetconf.pl:
    	  Add --execute-where=client|server and --client options
    	  to make amgetconf query the client configuration
    	  instead. Move from server-src to common-src.
    	* man/xml-source/amgetconf.8.xml: Document the new options.
    	* installcheck/amgetconf.pl: Test the new options.
    	* server-src/Makefile.am, common-src/Makefile.am:
    	  Updated Makefiles for move.
    	* packaging/deb/amanda-enterprise-backup-client.install,
    	  packaging/sun-pkg/i386/client/prototype:
    	  Add amgetconf to client packages.

2008-08-04 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec:  add %{tarver} macro and set the correct
	  minimum version per distro (Thanks to Jesse Angell for the rhel4 tip)

2008-08-04  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c: workaround gcc<4.1.0 problems with long
	  constants, don't use G_MAXINT64 in precompiler expressions

2008-08-03  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amrmtape.sh: use shell redirection with shell functions

2008-08-03  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/util.c: if !WORKING_IPV6, request AF_INET, not AF_NATIVE
	* common-src/dgram.c: address family debugging
	* common-src/stream.c: address family debugging

2008-08-03  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amanda.h common-src/conffile.c common-src/conffile.h
	  installcheck/Amanda_Config.pl perl/Amanda/Config.swg
	  server-src/planner.c: replace am64 type with gint64; also replace
	  some uses of off_t

2008-08-01 Nikolas Coukouma <atrus@zmanda.com>
	* perl/Amanda/BigIntCompat.pm: Add a module to make 'Math::BigInt's
	  stringify consistently (no '+' prefixing positive numbers).
	* perl/Makefile.am: Add Amanda/BigIntCompat.pm for installation, etc.
	* installcheck/bigint.pl, perl/amglue/bigint.c:
	  Use Amanda::BigIntCompat everywhere we use bigint.

2008-08-01 Nikolas Coukouma <atrus@zmanda.com>
	* common-src/match.c: Correct array index to be within bounds

2008-08-01 Nikolas Coukouma <atrus@zmanda.com>
	* config/amanda/flags.m4: Rename AMANDA_TEST_GCC_WARNING_FLAG to
	  AMANDA_TEST_GCC_FLAG and use AMANDA_ENABLE_GCC_WARNING where
	  appropriate. Add AMANDA_DISABLE_GCC_FEATURE. Disable strict-aliasing
	  (which causes errors).

2008-07-30  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Config.pl: add + to avoid perl-5.6.0 parsing bug
	* installcheck/amgetconf.pl: ditto

2008-07-29 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec:  Merged fixes from enterprise .spec for
	  parsing redhat-release for fedora versions correctly.

2007-07-28 Nikolas Coukouma <atrus@zmanda.com>
	* config/amanda/flags.m4: Add proper detection of flags for GCC 4.3+

2007-07-28 Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c: Calculate and send the MD5 hash when uploading data.
	  Also check the returned ETag to make sure it matches the sent MD5 hash.
	  Use simpler s3_base64_encode() instead of base64_encode().
	  Correct the use of character classes in several regular expressions.
	* device-src/s3-util.h, device-src/s3-util.c: Add utility functions
	  s3_base64_encode(), s3_hex_encode(), and s3_compute_md5_hash() as well
	  as some constants. Move regexec_wrap() into this and rename it to
	  s3_regexec_wrap().
	* device-src/Makefile.am: add s3-util.c and s3-util.h

2008-07-28  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Config.pm: don't set default tapetype
	  unless not set explicitly.
	* installcheck/Amanda_Config.pl: test changes
	* man/xml-source/amanda-client.conf.5.xml
	  man/xml-source/amanda.conf.5.xml: encourage, but don't require,
	  quoted identifiers

2008-07-28  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amserverconfig.pl: apply perltidy, factor some common
	  code, and create the config dir and changer conf only after the check
	  for mtx is performed

2008-07-28  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tests/semaphore-test.c: move function call out of
	  variable initialization

2008-07-25 Dan Locks <dwlocks@zmanda.com>
	* packaging/deb/control: added alternative dependency of libssl0.9.8 for
	  Ubuntu 8.x builds.  Added build dependencies for debhelper, fakeroot,
	  libcurl-dev, libssl-dev.  Updated server and client dependency for curl
	  to libcurl3

2008-07-18 Dan Locks <dwlocks@zmanda.com>
	*  configure.in:  add format-security to gcc compile flags
	*  server-src/amindexd.c,
	   server-src/dumper.c,
	   server-src/reporter.c,
	   restore-src/restore.c,
	   common-src/security-util.c,
	   common-src/bsd-security.c:  replacemented unquoted strings in
	   function arguments with "%s", arg.  jrfranks's suggestion, dustin provided
	   syntax for the fix.

2008-07-17 Dan Locks <dwlocks@zmanda.com>
	* packaging/debian/amanda-enterprise-backup-*.install: added entries for
	  applications and devices man pages.
	  
2008-07-17  Jean-Louis Martineau <martineau@zmanda.com>
	* man/Makefile.am: Add amzfs-snapshot.8
	* man/xml-source/amzfs-snapshot.8.xml: New man page.
	* man/xml-source/amanda.8.xml: Add amzfs-snapshot.8
	* man/xml-source/amanda-scripts.7.xml: Add amzfs-snapshot.8
	* application-src/amzfs-snapshot.pl: New script
	* application-src/Makefile.am: Add amzfs-snapshot
	* perl/Amanda/Util.swg: Add sanitise_filename.

2008-07-17  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: amandad must be run by root for krb5 auth.

2008-07-16  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Improve message in failure to dump in degraded
			       mode.

2008-07-16 Dan Locks <dwlocks@zmanda.com>
	* packaging/deb/control,
	  packaging/rpm/amanda.spec: added explicit dependency on openssl, and a 
	  build dependency for openssl and curl development files.

2008-07-15  Dustin J. Mitchell <dustin@zmanda.com>
	* example/xinetd.amandaserver.in example/xinetd.amandaclient.in:
	  specifying both IPv{4,6} does not work; remove IPv4

2008-07-15  Jean-Louis Martineau <martineau@zmanda.com>
	* man/Makefile.am: Add new man pages.
	* man/xml-source/script-email.8.xml: New man page.
	* man/xml-source/amanda.8.xml: List new man pages.
	* man/xml-source/amanda-scripts.7.xml: New man page.

2008-07-15  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in: generate (x)inetd files
	* example/inetd.conf.amandaclient.in example/xinetd.amandaclient.in
	  example/xinetd.amandaserver.in: give appropriate path for amandad,
	  from configure (fixes builds on 64-bit machines)
2008-07-15  Dustin J. Mitchell <dustin@zmanda.com>
	* client-src/client_util.c: #include "glib-util.h"
	* common-src/glib-util.c: New g_ptr_array_foreach fucntion.
	* common-src/glib-util.h: Prototype of g_ptr_array_foreach.
	* device-src/rait-device.c: Remove g_ptr_array_foreach.

2008-07-15  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: Read stdout of scripts.
	* client-src/client_util.h: New prototype for run_client_scripts,
				    New client_script_result_t struct.
	* client-src/sendbackup.c: Send scripts properties to application.
	* client-src/sendsize.c: Send scripts properties to application.
	* client-src/selfcheck.c: Send scripts properties to application.
	* recover-src/extract_list.c: Send scripts properties to application.
	* common-src/amxml.h (script_t) Add field to keep result of script.
	* common-src/amxml.c: Set script->result to NULL.

2008-07-14 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: fix macro detection of fedora version

2008-07-14 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: fix distribution detection, add
	activate-devpay to server files list

2008-07-11  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Changer.pl: set up and parse a config, now that
	  Amanda::Changer needs one

2008-07-11  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm: set device properties when testing device
	  labels in the changer

2008-07-11  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Add a DIRECTORY property.
	* man/xml-source/amgtar.8.xml: Document DIRECTORY property.

2008-07-11  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-lib.sh.in: remove bogus Log() invocations

2008-07-11  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.8.xml: fix amanda(8) formatting and add links
	  to new manpages

2008-07-11  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Device.pl: be more liberal in the flags that are
	  accepted from S3's read_label; this will reduce false failures

2008-07-11  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: Remove unused output_tool_property function.
	* client-src/client_util.h: Remove output_tool_property prototype.
	* man/xml-source/amanda-client.conf.5.xml: Add application and script
						   sections.
	* man/xml-source/amanda.conf.5.xml: Improve application and script
					    sections.
	* device-src/device.c: Fix for new property_t.
	* server-src/diskfile.h: Change prototype for xml_application and
				 xml_scripts.
	* server-src/diskfile.c: Add <priority> tag if client support it.
	* server-src/amindexd.c: Fix call to xml_application.
	* server-src/amcheck.c: Fix call to xml_application.
	* server-src/planner.c: Fix call to xml_application.
	* server-src/driverio.c: Fix call to xml_application.
	* server-src/server_util.c: Remove code to write property to stdin of
				    script.
	* perl/Amanda/Config.swg: Fix for new property_t.
	* perl/amglue/amglue.h: Prototype for g_hash_table_to_hashref_property.
	* perl/amglue/ghashtable.c: New g_hash_table_to_hashref_property
				    function.
	* installcheck/Amanda_Config.pl: Fix for new property_t.
	* common-src/util.c: Remove unused output_tool_proplist fucntion,
			     Fix for new property_t.
	* common-src/util.h: Remove output_tool_proplist prototype.
	* common-src/amxml.c:Fix for new property_t, parse priority of property.
	* common-src/conffile.c: Parse priority of a property,
			  Add application and script to amanda-client.conf.
	* common-src/conffile.h: New property_t struct.
	* common-src/amfeatures.h: New fe_xml_property_priority amfeature.
	* common-src/amfeatures.c: New fe_xml_property_priority amfeature.

2008-07-11  Jean-Louis Martineau <martineau@zmanda.com>
	* man/entities/global.entities: Add ENTITY email.jlm.
	* man/Makefile.am (CLIENT_MAN_PAGES): Set to amanda-applications.7,
	  amgtar.8 and amstar.8.
	* man/xml-source/amanda.conf.5.xml: Fix </programlisting>, it must be
					    at the begining of a line.
	* man/xml-source/amanda-applications.7.xml: New page.
	* man/xml-source/amgtar.8.xml: New page.
	* man/xml-source/amstar.8.xml: New page.

2008-07-09  Ian Turner <ian@zmanda.com>
	* device-src/device.h: Clarify documentation of device_read_label().
	* device-src/s3-device.c, device-src/tape-device.c,
	  device-src/vfs-device.c (device_read_label): Always clear volume
	  labels, even if device is in error.
	* device-src/rait-device.c: Ditto; also properly handle properties
	  that change device labels.

2007-07-09 Nikolas Coukouma <nikolas@zmanda.com>
	* man/xml-source/amanda-devices.7.xml: Document the S3_BUCKET_LOCATION
	  property (for setting location constraints).

2008-07-08  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/vfs-device.c device-src/tape-device.c: do not autofinish
	  when EOF occurs on writing

2008-07-08  Dustin J. Mitchell <dustin@zmanda.com>, 
	    Nikolas Coukouma <nikolas@zmanda.com>,
	    Ian Turner <ian@zmanda.com>,
	    Jean-Louis Martineau <martineau@zmanda.com>
	Amanda has been analyzed with Klocwork source code analysis, the most
	accurate and comprehensive tool for finding critical programming
	errors and security vulnerabilities.
	* amandad-src/amandad.c changer-src/chg-scsi.c
	  client-src/client_util.c client-src/selfcheck.c
	  client-src/sendbackup.c client-src/sendsize.c common-src/amfeatures.c
	  common-src/bsd-security.c common-src/fileheader.c
	  common-src/local-security.c common-src/queueing.c
	  common-src/security-util.c device-src/property.c
	  device-src/rait-device.c device-src/tape-device.c
	  device-src/vfs-device.c recover-src/set_commands.c
	  restore-src/amidxtaped.c restore-src/amrestore.c restore-src/restore.c
	  server-src/amadmin.c server-src/amcheck.c server-src/amindexd.c
	  server-src/changer.c server-src/chunker.c server-src/cmdline.c
	  server-src/driver.c server-src/holding.c server-src/logfile.c
	  server-src/reporter.c server-src/server_util.c
	  server-src/taper-file-source.c: fix many issues identified
	  by Klockwork, ranging in severity from stylistic to minor.
	   - many memory leaks in error paths and application shutdown
	   - better handling of incorrect commandline arguments
	   - better resource management (file descriptors, etc.)

2008-07-07 Nikolas Coukouma <nikolas@zmanda.com>
	* device-src/Makefile.am: conditionalize activate-devpay on
	  WANT_S3_DEVICE

2007-07-06 Nikolas Coukouma <nikolas@zmanda.com>
	* device-src/s3-device.c, device-src/s3.c, device-src/s3.h,
	  device-src/activate-devpay.c, device-src/Makefile.am:
	  Allow both regular S3 and S3-with-DevPay to be used in
	  the same installation. Remove WANT_DEVPAY macro.
	* device-src/s3-device.c: Added a flag, is_devpay, to the device
	  and handled divergent cases. Removed useless device_error_set calls.
	* device-src/s3.c: Use DevPay authentication iff user_token is set.
	  Replaced some if statements about non-NULL pointers with assertions.
	* config/amanda/s3-device.m4, device-src/Makefile.am:
	  remove devpay flag and WANT_DEVPAY definition.
	* installcheck/Amanda_Device.pl: add tests for DevPay, refactor
	  other S3 tests.

2007-07-06 Nikolas Coukouma <nikolas@zmanda.com>
	* device-src/s3.c: wait for bucket to appear after creation, treat
	  missing bucket as temporary error, increase retries from 5 to 14
	  (about 3min), explicitly handle HTTP verbs as libcurl expects.
	* installcheck/Amanda_Device.pl: remove (now-irrelvant) note about
	  buckets taking too long to appear.

2008-07-06 Dan Locks <dwlocks@zmanda.com>
	* packaging/deb/amanda-backup-server.postrm
	  packaging/deb/amanda-backup-client.postrm: removed unused
	  code
	* packaging/deb/postrm: fixed typo in deluser command
	* packaging/deb/rules: added specific preinst and postrm scripts for
	  client and server.

2008-07-03  Dustin J. Mitchell <dustin@zmanda.com>
	* man/Makefile.am man/amanda.css man/index.php man/xslt/html.xsl.in:
	  new files for HTML output
	* man/xslt/man.xsl.in: substitute XSLT_VERS
	* man/xml-source/amanda-devices.7.xml: tweaks
	* man/xml-source/amanda.8.xml: tweaks
	* man/xml-source/amanda.conf.5.xml: tweaks
	* man/xml-source/amgetconf.8.xml: tweaks
	* man/xml-source/amtoc.8.xml: tweaks

2008-07-03  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/genversion.c: correctly represent available amflock
	  implementations

2008-07-03  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Xfer.swg: #include "glib-util.h"

2008-07-02  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/rait-device.c: don't use self->device_name in open_device

2008-07-02  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amgetconf.pl: supply a plugin for scripts

2008-07-02  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c: Check an application is set if
	                         program == "APPLICATION".
	* common-src/amxml.c: Check plugin is set for application and script.
	* common-src/conffile.c: Check plugin is set for application and script

2008-07-02  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Fix printing of config path on error.

2008-07-02  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Device.pl: test that start(READ) without first
	  reading the label doesn't cause errors 
	* device-src/s3-device.c: call s3_device_read_label directly

2008-07-02  Ian Turner <ian@zmanda.com>
	* man/xml-source/amanda.8.xml: Document how to override device
	  properties.

2008-07-02  Ian Turner <ian@zmanda.com>
	Dustin J. Mitchell <dustin@zmanda.com> contributed code and thoughts
	to this patch.
	* man/xml-source/amanda-devices.7.xml: Document new ERROR flag
	  to start RAIT device in degraded mode.
	* device/device.c: Be a little more forgiving of NULL devices.
	* device-src/vfs-device.c: Fix a bug where vfs_device_start()
	  would sometimes throw an erroneous assertion.
	* device-src/rait-device.c: Be much more robust in error handling;
	  new feature to start a RAIT device in degraded mode.
	* installcheck/Amanda_Device.pl: Enable more RAIT device tests.

2008-07-02  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amanda.h: remove unused #include <alloca.h>

2008-07-02  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tape-device.c: add "user" and "good" to feature flags
	* man/xml-source/amanda-devices.7.xml: document it

2008-07-01  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/device.h: fix comments to reflect removal of
	  autofinishing
	* device-src/tape-device.c: remove autofinishing

2008-07-01  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-lib.sh.in: also handle bare tape dev names

2008-07-01  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-lib.sh.in: fix tape_device_filename to not use perl
	* changer-src/chg-zd-mtx.sh: always use the unqualified hostname to
	  open the debug file

2008-06-30  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/match.c: fix multiple bugs in match_datestamp

2008-06-29  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm perl/Amanda/Cmdline.swg
	  perl/Amanda/Config.swg perl/Amanda/DB/Catalog.pm
	  perl/Amanda/Device.swg perl/Amanda/Logfile.swg 
	  perl/Amanda/Util.swg: POD cleanup
	* perl/Makefile.am: new files, rules to make HTML
	* perl/amperl.css: CSS file for online POD
	* perl/make_html.pl: make online POD

2008-06-29  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am installcheck/amstatus.pl: new check

2008-06-27  Ian Turner <ian@zmanda.com>
	* server-src/taper.c: fix printing a NULL pointer in the error path

2008-06-27  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/device.c: check for and fail on multiple
	  short writes to the same file
	* device-src/null-device.c device-src/rait-device.c
	  device-src/s3-device.c device-src/tape-device.c
	  device-src/vfs-device.c: do not autofinish files
	* installcheck/Amanda_Device.pl installcheck/Amanda_Xfer.pl: don't
	  expect devices to autofinish anymore
	* server-src/taper.c xfer-src/dest-device.c: finish files explicitly
	* device-src/device-queueing.c: comments
	* xfer-src/xfer-element.h: comments

2008-06-27  Nikolas Coukouma <atrus@zmanda.com>
	* device-src/s3.c device-src/s3.h device-src/s3-device.c installcheck/Amanda_Device.pl:
	  Add support for bucket location constraints
	* device-src/s3-device.c: Add S3_BUCKET_LOCATION device property
	* device-src/s3.c device-src/s3.h device-src/s3-device.c:
	  Checks for libcurl and bucket name compatability with location constraints
	* device-src/s3.c: make s3_init() threadsafe,
	  refactor regex compilation and calling,
	  refactor perform_request() functions to construct URL later,
	  use GString to tidy string generation
	* installcheck/Amanda_Device.pl: Add tests for location constraints

2008-06-27  Ian Turner <ian@zmanda.com>
	* device-src/rait-device.c: Fix a memory corruption issue on the last
	  block of a file.

2008-06-27  Ian Turner <ian@zmanda.com>
	* device-src/rait-device.c: Fix a memory corruption issue on the last
	  block of a file.

2008-06-27  Ian Turner <ian@zmanda.com>
	* device-src/rait-device.c: Track file numbers properly when child
	  devices change them (that is, in rait_device_start_file() and
	  rait_device_seek_file()).
	* installcheck/Amanda_Device.pl: Enable primary set of RAIT tests.

2008-06-27  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/s3-device.c (s3_device_read_label): Don't set
	  volume_header if nothing is read.

2008-06-27  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.c: Don't log is flag is DEVICE_STATUS_SUCCESS.

2008-06-27  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tape-posix.c: return DEVICE_ERROR|DEVICE_BUSY on EIO
	* changer-src/chg-lib.sh.in: keep waiting for a device if it *might*
	  be busy or offline

2008-06-26  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amstar.c: Use local start_time variable.
	* application-src/amgtar.c: Use local start_time variable.
	* common-src/clock.h: Remove times_zero and start_time extern.
	* common-src/clock.c: Remove times_zero.

2008-06-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c: Don't send encryption in xml req packet for
				 server encryption.

2008-06-25  Dustin J. Mitchell <dustin@zmanda.com>
	* application-src/amgtar.c: revert --atime-preserve change

2008-06-22  Dustin J. Mitchell <dustin@zmanda.com>
	* application-src/amgtar.c: change --atime-preserve=system to
	  --atime-preserve

2008-06-20  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amdump.pl: fix checks to refresh the test configuration

2008-06-20  Dustin J. Mitchell <dustin@zmanda.com>, Ian Turner <ian@zmanda.com>
	* server-src/amdump.sh: correctly handle error exits from planner
	* server-src/planner.c: fail if planning fails
	* installcheck/amdump.pl: test changes

2008-06-20 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: typo amanda-devices.7.gz

2008-06-20 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: added %{MANDIR}/man7/amanda-device.7.gz

2008-06-20  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: Call check_access() only
				    if getuid() == geteuid().
	* application-src/amgtar.c: check_dir(argument->dle.device, R_OK)

2008-06-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcleanup.pl: Correctly rename amdump files.

2008-06-19  Dustin J. Mitchell <dustin@zmanda.com>, Ian Turner <ian@zmanda.com>
	* man/Makefile.am man/xml-source/amanda-devices.7.xml: new manpage
	* man/entities/global.entities: emails for dustin and ian
	* man/xml-source/amanda.8.xml: refer to new manpage
	* man/xml-source/amanda.conf.5.xml: refer to new manpage
	* man/xml-source/amrecover.8.xml: refer to new manpage
	* server-src/amcheck.c: fix message regarding WORM media

2008-06-19  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amgetconf.pl: fail on bad parameters or subsections, but
	  not empty values or subsection lists
	* perl/Amanda/Config.swg: publish a list of subsections
	* installcheck/amgetconf.pl: test it

2008-06-19  Dustin J. Mitchell <dustin@zmanda.com>
	* example/template.d/amanda-single-tape.conf.in
	  example/template.d/amanda-harddisk.conf.in
	  example/template.d/amanda-tape-changer.conf.in
	  example/template.d/dumptypes example/template.d/amanda-S3.conf.in:
	  use application amgtar instead of program GNUTAR

2008-06-19  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/net.m4: AC_SUBST port ranges; update comments

2008-06-19  Satya Ganga <gsat@zmanda.com>
	* example/template.d/amanda-single-tape.conf.in
	  example/template.d/advanced.conf.in: update displayunit to "g" and
	  remove chg-manual for single tape configurations.

2008-06-19  Ian Turner <ian@zmanda.com>
	* device-src/rait-device.c (rait_device_start): Check for consistent
	  volume label on all child devices, fail with
	  DEVICE_STATUS_DEVICE_ERROR otherwise.
	* installcheck/Amanda_Device.pl: Test for foregoing.

2008-06-19  Paddy Sreenivasan <paddy@zmanda.com>
	* device-src/s3.h: use "https://ls.amazonaws.com/" as STS endpoint

2008-06-19  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: remove test_utils from SCRIPTS_PERL
	* config/automake/scripts.am: explain why

2008-06-18  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-manual.sh: Make it interruptible.

2008-06-18  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Remove check for amandates file.

2008-06-18  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amanda.h: Fix skip_quoted_string for "\\".
	* common-src/file.c: Fix debug_agets for "\\".

2008-06-18  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Report size of PART taped on 'dump to tape'.

2008-06-18  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendsize.c: Report error from application to server.
	* application-src/amgtar.c: Report exit status of tar.

2008-06-16  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Xfer.swg xfer-src/Makefile.am xfer-src/xfer-element.h
	  xfer-src/dest-device.c xfer-src/source-device.c: new elements
	  Amanda::Xfer:{Dest,Source}::Device
	* perl/Amanda/Xfer.swg: POD fix for Amanda::Xfer:Filter::Xor
	* installcheck/Amanda_Xfer.pl: tests for new elements

2008-06-16  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amservice.pl: add invocations of selfcheck for GNUTAR
	  and amgtar
	* installcheck/amservice.pl: put -f switches first

2008-06-15  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Config.pl: test config overwrites
	* common-src/conffile.c: don't segfault applying config overwrites
	  after config_init(0, NULL)

2008-06-13  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Run compression and encryption for
				   application-api.

2008-06-13  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Util.swg: Expose get_original_cwd.
	* application-src/amgtar_perl.pl, application-src/amoracle.pl:
	  chdir(get_original_cwd()) before restore.

2008-06-13  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/property.c device-src/property.h: remove tape properties
	* device-src/tape-device.c device-src/tape-device.h: add tape
	  properties

2008-06-12 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda_enterprise.spec,
	  packaging/rpm/amanda_enterprise_client.spec,
	  packaging/deb/rules: install amgtar and amstar suid root

2008-06-12  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c: Typo.

2008-06-11  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendsize.c: Check MAX-LEVEL from application.
	* server-src/planner.c: Ask for estimate even if SERVER, estimate is
	  valid if client return -1 and invelid if client return -2.
	* common-src/amfeatures.h: New fe_xml_estimate amfeature.
	* common-src/amxml.c: Parse <estimate> tag.
	* common-src/amxml.h (dle_t): New estimate field.
	* common-src/amfeatures.c: Set fe_xml_estimate.

2008-06-11  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c (application_property_add_to_argv):
	                           Add include and exclude.
	* client-src/client_util.h (application_property_add_to_argv):
	                           New prototype.
	* client-src/sendbackup.c, client-src/sendsize.c,
	  client-src/selfcheck.c, recover-src/extract_list.c:
	  Add bsu param to application_property_add_to_argv.
	* client-src/selfcheck.c: Check if application support includ/exclude.
	* application-src/amgtar_perl.pl: Don't support include/exclude.
	* application-src/amgtar.c: Support include-optional and
	                            exclude-optional.
	* common-src/amxml.c: Fix include/exclude parsing.

2008-06-11  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/Makefile.am: Install amgtar and amstar suid root.

2008-06-11  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c: Print cmdline before execing the application.
	* application-src/generic-dumper.pl: Cleanup.
	* application-src/script-oracle.pl: Cleanup.
	* application-src/script-email.pl: Cleanup.
	* application-src/amgtar_perl.pl: Cleanup.
	* application-src/generic-script.pl: Cleanup.
	* application-src/Makefile.am: Remove all scripts from CHECK_PERL.
	* perl/Amanda/Debug.swg: Typo.

2008-06-10  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/Makefile.am: don't use $(builddir), fix comparison
	* installcheck/Makefile.am: don't use $(builddir)

2008-06-10  Ian Turner <ian@zmanda.com>
	* common-src/fileheader.c: Silence a compiler warning.
	* device-src/rait-device.c: ditto.

2008-06-10  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/rait-device.c: hack around glib bug in versions <2.10.2
	  using the precompiler macro instead of glib_check_version, which
	  doesn't exist in every version of glib

2008-06-10 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec:  Replaced individual SBINDIR/am... entries 
	  with SBINDIR/am* in %%files

2008-06-10  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Add pre&post recover scripts.

2008-06-09 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/buildpkg: added "|| exit 1" to any command which should
	  cause the script to fail.

2008-06-09 Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: Changed individual SBINDIR/am... entries to
	  use a single SBINDIR/am* entry in %files

2008-06-09  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/fileheader.c: correctly free dle_str
	* device-src/device.c device-src/device.h: add volume_header Device
	  attributes
	* device-src/rait-device.c device-src/s3-device.c
	  device-src/tape-device.c device-src/vfs-device.c: populate
	  volume_header
	* server-src/amlabel.c: use volume_header to detect a non-empty tape
	  and require a force (-f) to overwrite it
	* server-src/taperscan.c: use volume_header to detect a non-empty tape
	  and require 'amlabel -f' to overwrite it
	* device-src/tape-device.c device-src/vfs-device.c: fix read_label
	  return values and remove useless chain-up calls

2008-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amservice.c: Open input file in read mode, prepend
				  get_original_cwd() to relative path.
	* installcheck/Makefile.am: Check amservice only on server.

2008-06-09  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Device.pl: skip all RAIT tests temporarily

2008-06-09  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.8.xml: add links to amservice

2008-06-07  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/ipv6.m4: remove redundant AC_SOCKADDR_STORAGE
	* configure.in: don't call AC_SOCKADDR_STORAGE

2008-06-07  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Xfer.pl: make AMANDA_TMPDIR if it doesn't exist

2008-06-07  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Run.pm: fix Installcheck::Run vtape
	  handling so that checks can load/unload vtapes "manually"

2008-06-07  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amdevcheck.pl: apply config_overwrites before printing
	  config errors

2008-06-07  Dustin J. Mitchell <dustin@zmanda.com>
	* application-src/amgtar_perl.pl application-src/amstar_perl.pl
	  application-src/generic-dumper.pl application-src/generic-script.pl
	  application-src/script-email.pl server-src/amgetconf.pl: add GPL
	  notice

2008-06-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amservice.c: Exit with 1 if the connection fail.
	* man/xml-source/amservice.8.xml: Document exit code.

2008-06-06  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/device.c: make device_set_error bulletproof to NULLs
	* device-src/tape-posix.c: fix compilation error when GMT_ONLINE is
	  not defined

2008-06-06  Jean-Louis Martineau <martineau@zmanda.com>
	* man/Makefile.am: Add amservice.8.
	* man/xml-source/amservice.8.xml: New man page for amservice.
	* server-src/amservice.c: New program to execute an amanda service
	                          on a client.
	* server-src/Makefile.am: Add amservice
	* installcheck/amservice.pl: New check for amservice program.
	* installcheck/Makefile.am: Add amservice

2008-06-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Don't quote dle_str.
	* common-src/fileheader.c: DLE= in header is like heredoc.

2008-06-06  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/*: major overhaul:
	  - add device_set_error to set error status and message for Device
	  - every error return from a device API method sets error status
	  - device_status_error is now threadsave
	  - a device in an error state will not perform further operations
	  - ensure Device attributes are set correctly by member functions
	  - device_open never returns NULL, but may return a null device with
	    error status set
	  - clearly define $device_name="$device_type:$device_node"
	  - send RAIT logging to the debug log
	  - vfs, tape devices don't touch the device until read_label or start
	  - on out-of-space in write, set is_eof, finish the file, and return
	    FALSE
	  - use accessor functions in Amanda::Device
	  - move device-specific properties to live with their devices
	  - change g_return_val_if_fail to g_assert or explicit checks
	  - remove most default Device methods, as they were more confusing
	    than helpful
	  - misc. other cleanup
	* device-src/null-device.h device-src/rait-device.h
	  device-src/s3-device.h device-src/vfs-device.h: removed to make most
	  device class declarations local to the source file
	* perl/Amanda/Device.swg: new error handling
	* perl/Amanda/Changer.pm restore-src/amrestore.c restore-src/restore.c
	  server-src/amcheck.c server-src/amcheckdump.pl
	  server-src/amdevcheck.pl server-src/amlabel.c server-src/amtape.c
	  server-src/taperscan.c: use new device error-handling
	* server-src/taper-file-source.c server-src/taper-port-source.c
	  server-src/taper-source.c: rename GObject constants (typo)
	* server-src/taper-source.h:
	* server-src/taper.c: handle opening devices better, log on EOM
	* common-src/glib-util.c: g_english_strjoinv: handle one-element lists
	  correctly
	* installcheck/amdevcheck.pl: volume-unlabeled message has changed
	* installcheck/Amanda_Device.pl perl/Amanda/Tests.swg: test all device
	  classes
	* configure.in device-src/tests/: removed
	* device-src/vfs-test.c: moved from device-src/tests/

2008-06-06  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Don't write the uncompression program if
				   it is not client compressed.

2008-06-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: Log no-tape line.

2008-06-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Improve formating.

2008-06-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: start the degraded mode if it receive
			       NO-NEW-TAPE from taper.

2008-06-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheckdump.pl: Check log fiels in directory if find_log
				     find no log for the timestamps.

2008-06-05  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c common-src/conffile.h: expose config_add_error
	* server-src/diskfile.c server-src/diskfile.h: use config_add_error
	  to send diskfile errors to conffile's error-handling mechanism
	* restore-src/amfetchdump.c server-src/amadmin.c server-src/amcheck.c
	  server-src/amcleanupdisk.c server-src/amflush.c server-src/amindexd.c
	  server-src/amtrmidx.c server-src/amtrmlog.c server-src/driver.c
	  server-src/planner.c: parse disklist along with config

2008-06-04  Jean-Louis Martineau <martineau@zmanda.com>
	And Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda-client.conf.5.xml: Document property.
	* installcheck/Amanda_Config.pl: Add test for client property.
	* common-src/conffile.c (client_var): Add CONF_PROPERTY.

2008-06-03  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Types.swg: Add dle_str to dumpfile_t.
	* common-src/fileheader.c: Don't print NULL dle_str.

2008-06-03  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amfeatures.h: Rename fe_amrecover_dle to fe_amindexd_DLE,
				   add fe_amrecover_dle_in_header.
	* common-src/amfeatures.c: Set fe_amrecover_dle_in_header.
	* recover-src/set_commands.c: Use fe_amindexd_DLE.
	* server-src/dumper.c: Set dle_str and add it to the header.
	* restore-src/restore.c: Remove dle_str is client doesn't have
				 fe_amrecover_dle_in_header.
	* common-src/fileheader.c: Parse and set dle_str from header.
	* common-src/fileheader.h: Add dle_str in dumpfile_t.

2008-06-03  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amdump.8.xml, man/xml-source/amreport.8.xml,
	  man/xml-source/amcheck.8.xml, man/xml-source/amflush.8.xml,
	  man/xml-source/amstatus.8.xml: Add "EXIT CODE" section".

2008-06-03  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (parm_key_info): Don't fold '-' to '_' in
						 subsec_name.
	* installcheck/amgetconf.pl: Fix and add more tests.

2008-06-03  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amxml.c: give parse error on an empty "disk" element
	* server-src/diskfile.c: give parse error on an empty "disk" element

2008-05-30  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Remove unneeded pointer cast.
	* common-src/stream.c: Fix compiler error.

2008-05-30  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Config.pm: fix subsection inheritance

2008-05-30  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amanda.h, common-src/bsd-security.c,
	  common-src/bsdtcp-security.c, common-src/bsdudp-security.c,
	  common-src/dgram.c, common-src/dgram.h, common-src/krb5-security.c,
	  common-src/security-util.c, common-src/security-util.h,
	  common-src/sockaddr-util.c, common-src/sockaddr-util.h,
	  common-src/stream.c, common-src/util.c, common-src/util.h,
	  restore-src/amidxtaped.c, server-src/amindexd.c: add sockaddr_union,
	  change all relevant functions to use it, to avoid aliasing violations

2008-05-30  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (lookup_keyword): Use temporary variable.
	* installcheck/Amanda_Config.pl:  Check insentivity of -/_ in amanda
					  keyword.
	* installcheck/Installcheck/Config.pm: Adjust to make the subsection
					       inheritance work.

2008-05-30  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Send properties from dump_dle to
				      application plugin.

2008-05-30  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: New *-RECOVER scripts.
	* application-src/script-email.pl: Add new *-RECOVER scripts.
	* application-src/generic-script.pl: Add new *-RECOVER scripts.
	* application-src/amstar.c: Fix.
	* application-src/amgtar.c: Fix.
	* recover-src/amrecover.c: Add a global dump_dle variable.
	* recover-src/extract_list.c: Call run_client_scripts for *-RECOVER
				      scripts.
	* recover-src/amrecover.h: Add an extern dump_dle variable.
	* recover-src/set_commands.c: Send to amindexd the DLE command.
	* server-src/amindexd.c: Handle the DLE command.
	* server-src/server_util.c: Add *-RECOVER scripts, they can't be
				    executed on server.
	* server-src/diskfile.c (xml_scripts): Add *-RECOVER scripts.
	* common-src/amfeatures.h: New fe_amrecover_dle amfeature.
	* common-src/amfeatures.c (am_init_feature_set): Add fe_amrecover_dle.
	* common-src/amxml.c: Add *-RECOVER scripts.
	* common-src/conffile.c: Add *-RECOVER scripts.
	* common-src/conffile.h: Add *-RECOVER scripts.

2008-05-29  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c: make config insensitive to
	  differences between '-' and '_'
	* man/xml-source/amanda-client.conf.5.xml
	  man/xml-source/amanda.conf.5.xml 
	  man/xml-source/amgetconf.8.xml: document it
	* installcheck/Amanda_Config.pl installcheck/amgetconf.pl: update
	  tests

2008-05-29  Orion Poplawski <orion@cora.nwra.com>
	* server-src/chunker.c: fix buffer overrun

2008-05-29  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (client_keytab): Remove "DEVICE-PROPERTY".

2008-05-28  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/rait-device.c: rait-device returns correct size when
	  blocksize is too small

2008-05-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Fix ignoring pid line.

2008-05-27  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/ps.m4: Define PS_ARGUMENT to CYGWIN on cygwin.
	* perl/Amanda/Process.pm: Works with PS_ARGUMENT eq "CYGWIN".

2008-05-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: use lib '@amperldir@';
	* perl/Amanda/Process.pm: use Amanda::Constants;

2008-05-26  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/rait-device.c: temporarily remove the call to set the
	  BLOCK_SIZE property on all RAIT children, as it fails with VFS
	  devices
	* device-src/rait-device.c: rewrite g_ptr_array_union_robust to
	  correctly detect and handle child device failures
	* common-src/fileheader.c: fix parse_file_header to be threadsafe

2008-05-25  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-aix.c, device-src/tape-xenix.c
	  device-src/tape-posix.c: tape_is_ready take a (TapeDevice *) argument
	* device-src/tape-posix.c (tape_is_ready): Check for broken_gmt_online.
	* device-src/property.c: Add broken_gmt_online property.
	* device-src/property.h: Add PROPERTY_BROKEN_GMT_ONLINE.
	* device-src/tape-device.c: Use broken_gmt_online property.
	* device-src/tape-device.h (TapeDevice): Add broken_gmt_online field.
	* device-src/tape-ops.h (tape_is_ready): Change prototype.

2008-05-25  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-zd-mtx.sh: Fix logging.

2008-05-25  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/rpm/amanda.spec: Fix output message.

2008-05-25  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/Makefile.am common-src/simpleprng.c
	  common-src/simpleprng.h: new simple PRNG module for
	  reproducible use in tests (bitlength bug fixed).
	* xfer-src/dest-null.c: verify stream against PRNG
	* xfer-src/source-random.c: use PRNG to create stream
	* installcheck/Amanda_Xfer.pl: verify streams in xfers
	* perl/Amanda/Xfer.swg: use PRNG
	* xfer-src/xfer-element.h xfer-src/xfer-test.c: use
	  PRNG to test glue elements

2008-05-23  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_MainLooop.pl: handle SIGCHILD while
	  reading from dying child

2008-05-22  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/xfer-test.c: don't try to write to a file in the
	  source directory

2008-05-22  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Process.pm (load_ps_table): Fix split.

2008-05-22  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in: Call AMANDA_PS_ARGUMENT
	* config/amanda/ps.m4 (AMANDA_PS_ARGUMENT): New macro to find ps
						    argument.
	* perl/Amanda/Constants.pm.in: Add PS_ARGUMENT.
	* perl/Amanda/Process.pm (load_ps_table): Use PS_ARGUMENT.

2008-05-22  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Process.pm: process_alive return '' if the process is
				  dead.
	* installcheck/Amanda_Process.pl: New module to check Amanda::Process.
	* installcheck/Makefile.am (server_tests): Add Amanda_Process.

2008-05-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Add "failed: killed while" to some status if
				  the driver process is dead.
	* perl/Amanda/Process.pm: New process_alive function.

2008-05-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c server-src/planner.c, server-src/chunker.c,
	  server-src/amflush.c, server-src/driver.c, server-src/taper.c,
	  restore-src/amidxtaped.c, restore-src/restore.c,
	  restore-src/amfetchdump.c: Convert all pid_t to long before printing.

2008-05-21  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amcleanup.8.xml: Document new -p option.
	* server-src/logfile.c (program_str): Add many programs.
	* server-src/logfile.h (program_e): Add many programs.
	* server-src/dumper.c, server-src/planner.c,
	  server-src/chunker.c, server-src/amflush.c,
	  server-src/driver.c, server-src/taper.c,
	  restore-src/amidxtaped.c, restore-src/restore.c,
	  restore-src/amfetchdump.c,
	  server-src/amdump.sh: Log pid and pid-done lines, call run_amclenup.
	* server-src/server_util.c (run_amcleanup): New function to run
						    amcleanup.
	* server-src/server_util.c (get_master_process): New function get the
				 name of the first pid line in a log file.
	* server-src/server_util.h (run_amcleanup): Prototype.
	* server-src/server_util.h (get_master_process): Prototype.
	* server-src/reporter.c: Ignore pid and pid-done lines.
	* server-src/amcleanup.pl: New amcleanup program written in perl.
	* server-src/Makefile.am: Move amcleanup from SCRIPTS_SHELL to
				  SCRIPTS_PERL.
	* server-src/amcleanup.sh: Old program removed.
	* perl/Amanda/Process.pm: New module to hanlde amanda process.
	* perl/Makefile.am: Add Amanda/Process.pm to Amanda_DATA and EXTRA_DIST

2008-05-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Fix quoting of diskname.

2008-05-20  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in config/amanda/socklen_t_equiv.m4: detect the type (not
	  necessarily socklen_t used by getpeername et al.
	* amandad-src/amandad.c server-src/amindexd.c restore-src/amidxtaped.c
	  common-src/util.c common-src/bsdtcp-security.c common-src/amanda.h
	  common-src/krb5-security.c common-src/dgram.c common-src/stream.c:
	  use the type instead of socklen_t

2008-05-20  Jean-Louis Martineau <martineau@zmanda.com>
	    Dustin J. Mitchell <dustin@zmanda.com>
	    John Franks <jrfranks@zmanda.com>
	* server-src/amstatus.pl: quote disknames in amstatus
	* server-src/Makefile.am: don't check amstatus (since it
	  uses Amanda::* libs)
	* perl/Amanda/Util.swg: add (un)quote_string
	* installcheck/Amanda_Util.pl installcheck/Makefile.am: test it

2008-05-16  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Fix conf_parserror use.

2008-05-15  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am installcheck/Makefile.am Makefile.am: only build
	  XFA in server builds

2008-05-15  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Parse send-amreport-on.
	* common-src/conffile.h (send_amreport_t): New enum for possible value
						   of send-amreport-on.
	* server-src/reporter.c: Use send-amreport-on setting.
	* perl/Amanda/Config.swg: Define send_amreport_on_t constants.
	* man/xml-source/amanda.conf.5.xml: Document send-amreport-on.

2008-05-15  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c (application_property_argv_size): New
	  function to count the number of argument needed to store all
	  properties of an application for + * a dle in an ARGV.
	* client-src/client_util.c (application_property_add_to_argv): New
	  function to add all properties of an application for a dle to an ARGV.
	* client-src/client_util.h (application_property_argv_size,
				  application_property_add_to_argv): Prototype.
	* client-src/sendbackup.c, client-src/sendsize.c,
	  client-src/selfcheck.c: Use new functions to pass properties as
				  argument to application plugin.
	* application-src/script-email.pl, application-src/amstar.c,
	  application-src/generic-script.pl,
	  application-src/amgtar.c: Get properties from command line.
	* server-src/server_util.c: Use new functions to pass properties as
				    argument to pre/post script.
	* common-src/util.c (count_proplist): Callback function to count the
					      number of values of a property.
	* common-src/util.c (proplist_add_to_argv): callback function to store a
					property and it's value in an ARGV.
	* common-src/util.h (count_proplist, proplist_add_to_argv): Prototype.
	* common-src/conffile.c (property_argv_size): New function to count the
						      number of properties.
	* common-src/conffile.c (property_add_to_argv): New function to store a
					property and it's value in an ARGV.
	* common-src/conffile.h (property_argv_size,
				 property_add_to_argv): Prototype.

2008-05-15  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/Makefile.am: add element-glue.h to the distribution
	* xfer-src/element-glue.h: add 'extern'
	* xfer-src/xfer-test.c: fix test elements
	* xfer-src/xfer.c: don't use the sometimes-undefined constant
	  G_MAXINT32
	* xfer-src/source-random.c: Only use 'prolong' for threads, not
	  push/pull methods
	* installcheck/Amanda_Xfer.pl: Check the content of $msg->{message} in
	  XMSG_INFO

2008-05-14  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/xfer-element.h xfer-src/xfer.c xfer-src/dest-null.c
	  xfer-src/source-random.c xfer-src/xfer-test.c
	  xfer-src/element-glue.c xfer-src/xmsg.h xfer-src/dest-fd.c
	  xfer-src/source-fd.c xfer-src/element-glue.h
	  xfer-src/Makefile.am xfer-src/filter-xor.c
	  xfer-src/xfer-element.c perl/Amanda/Xfer.swg: new organization
	  of transfer mechansims and new algorithm for linking xfers, with
	  expanded unit tests to exercise new glue elements
	* installcheck/Amanda_Xfer.pl: updated installchecks
	* common-src/semaphore.h: fix comment typo
	* common-src/testutils.c common-src/testutils.h: optionally skip
	  timeouts (-t), and only show g_debug messages if -d is given

2008-05-14  Dustin J. Mitchell <dustin@zmanda.com>
	* client-src/amhpfixdevs.sh client-src/Makefile.am
	  client-src/amsinixfixdevs.sh config/amanda/devprefix.m4:
	  permanently remove amsinixfixdevs and amhpfixdevs

2008-05-12  Jean-Louis Martineau <martineau@zmanda.com>
	  Patch by Orion Poplawski
	* server-src/planner.c: Warn about overwrite of last level 1, and
	  force backup of level 1 if overwrite on this run.

2008-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Define default tapetype.

2008-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c (tape_validate_properties): New function to
	  validate properties.

2008-05-07  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amdevcheck.8.xml: Add an OUTPUT section.

2008-05-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Check the tapetype is defined.

2008-05-07  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c: Allow user to set "read_buffer_size"
				    property.
	* restore-src/amrestore.c: Don't limit blocksize to
				   --with-maxtapeblocksize.
	* common-src/conffile.c: Increase readblocksize to blocksize.
	  blocksize and readblocksize can be bigger than
	  --with-maxtapeblocksize.

2008-05-06  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add a 'mailer' config parameter.
	* common-src/conffile.h: Add CNF_MAILER.
	* changer-src/chg-scsi-chio.c, changer-src/chg-scsi.c
	  changer-src/chg-manual.sh, application-src/script-email.pl
	  server-src/amcheck.c server-src/amgetconf.pl
	  server-src/reporter.c: Use mailer from config.
	* perl/Amanda/Config.swg: amglue_add_constant(CNF_MAILER, confparm_key)
	* config/amanda/progs.m4: Set DEFAULT_MAILER.
	* common-src/amanda-sh-lib.sh.in: Don't set MAILER.
	* man/xml-source/amanda-client.conf.5.xml,
	  man/xml-source/amanda.conf.5.xml,
	  man/xml-source/amgetconf.8.xml: Update man pages.

2008-05-02 Dan Locks <dwlocks@zmanda.com>
 	* packaging/rpm/amanda.spec:  Replace ${ with %{ where applicable.
 
2008-05-02 Dan Locks <dwlocks@zmanda.com>
	*  packaging/deb/amanda-enterprise-backup-server.postinst
	   packaging/rpm/amanda_enterprise.spec:  Change .am_passphrase to a
	   semi-random number in both packages. 

2008-04-29  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/dirs.m4: note that --with-dumperdir is 
	  deprecated in ./configure --help


2008-04-24  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c: Fix test for DEVICE_STATUS_SUCCESS.

2008-04-28  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/Makefile.am xfer-src/xfer-element.h xfer-src/dest-fd.c
	  xfer-src/source-fd.c perl/Amanda/Xfer.swg: add new
	  Amanda::Xfer::Source::Fd, Amanda::Xfer::Dest::Fd
	* xfer-src/source-random.c xfer-src/xfer.c xfer-src/dest-null.c
	  xfer-src/xfer.h xfer-src/filter-xor.c xfer-src/xfer-element.c:
	  reorganize detection of transfer completion, to handle cases where
	  elements don't do any active processing
	* installcheck/Amanda_Xfer.pl: test it all

2008-04-24  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Correctly print truncated quoted diskname.

2008-04-23  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_MainLoop.pl common-src/event-test.c
	  common-src/queueing-test.c: try to make tests more resilient
	  to heavily-loaded, slow machines

2008-04-23  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Typo.

2008-04-23  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Always sent a FAILED to taper if dumper failed.
	* common-src/event.c: Check event is not dead before fire it.

2008-04-23  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Fix vstrextend use.

2008-04-23  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/event.c: use internal child_watch_source
	  for glib <2.6.0; versions 2.4.0 to 2.6.0 use unreliable
	  signals and are thus unreliable

2008-04-22  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Logfile.swg server-src/find.c server-src/find.h: add
	  parsing of 'sec' and 'kb' from logfile messages
	* perl/Amanda/DB/Catalog.pm perl/Makefile.am: new module
	* installcheck/Amanda_DB_Catalog.pl installcheck/Makefile.am: checks
	  for new module

2008-04-22  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/event.c: on glib <2.4.0, use a simple polling 
	  child_watch_source; on more recent glib, use glib's own
	  child_watch_source

2008-04-22  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/source-random.c xfer-src/xmsg.c xfer-src/xfer-element.h
	  xfer-src/xfer-dest.c xfer-src/xfer-test.c xfer-src/xmsg.h
	  xfer-src/xfer.c xfer-src/xfer-dest.h xfer-src/dest-null.c
	  xfer-src/xfer.h xfer-src/filter-xor.c xfer-src/xfer-element.c:
	  - flatten XferElement hierarchy to one level
	  - change test element argument order
	  - rename XMsg.src to Xmsg.elt
	  - Improve memory management (refcounting, perl interface)
	* perl/Amanda/Changer.pm perl/Amanda/Xfer.swg
	  perl/Amanda/MainLoop.swg perl/Makefile.am
	  perl/amglue/amglue.h perl/amglue/source.c:
	  - rewrite handling of amglue_Source for better refcounting
	  - Amanda::MainLoop callbacks get the event source as 1st argument,
	    and will be called even if the event source goes out of scope in
	    perl
	  - MainLoop.swg significantly rewritten to get refcounting right
	* installcheck/Amanda_Xfer.pl: new checks (without excessive use of
	  file descriptors)
	* installcheck/Amanda_MainLoop.pl installcheck/Makefile.am: updated
	   checks

2008-04-22  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-posix.c: Don't return DEVICE_STATUS_VOLUME_MISSING
				   on ioctl error.
	* changer-src/chg-lib.sh.in (amdevcheck_status): return 1 only if the
			 possible errors are VOLUME_MISSING or DEVICE_BUSY.

2008-04-22  Kevin Zembower <kzembowe@jhuccp.org>
	* man/xml-source/amflush.8.xml: add amflush example

2008-04-22  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c: Move all device access from
	  tape_device_open_device to tape_device_read_label.
	  tape_device_start read the label if it is not already read.
	* device-src/vfs-device.c (vfs_device_open_device): remove read of the
							    label.

2008-04-22  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c (check_resetofs): Compilation fix if
						     NEED_RESETOFS is defined.
	* device-src/tape-posix.c: Handle no ENOMEDIUM.

2008-04-21  Dan Locks <dwlocks@zmanda.com>
	* packaging/deb/buildpkg: modified build script to create unsigned
	  packages

2008-04-21  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-lib.sh.in (amdevcheck_status):
	  Set amdevcheck_message.
	* changer-src/chg-chs.sh, changer-src/chg-juke.sh,
	  changer-src/chg-manual.sh, changer-src/chg-zd-mtx.sh,
	  changer-src/chg-multi.sh: Output amdevcheck_message
	* device-src/device.c: Set errmsg and status.
	  device_open always return a device, the status and errmsg are set.
	* device-src/device.h: Define DeviceStatusFlags.
	* device-src/null-device.c, device-src/s3-device.c,
	  device-src/tape-device.c, device-src/vfs-device.c,
	  device-src/rait-device.c: Set errmsg and status.
	* device-src/tape-posix.c: Return status for VOLUME_MISSING.
	* device-src/tape-ops.h: Remove TapeCheckResult.
	* server-src/taper-source.h (_TaperSource): Add errmsg.
	* server-src/taper-source.c: Set errmsg
	* server-src/amcheck.c, server-src/amtape.c, server-src/amlabel.c,
	  server-src/taperscan.c, restore-src/amrestore.c,
	  restore-src/restore.c: Use status and errmsg of a device.
	* server-src/taper-disk-port-source.c: Set errmsg.
	* server-src/reporter.c: Fix parsing of taper PARTIAL line.
	* server-src/taper.c: Use errmsg for device and _TaperSource.
	* server-src/taper-file-source.c: Set errmsg.
	* server-src/amcheckdump.pl,
	  server-src/amdevcheck.pl: Use status and errmsg from device.
	* perl/Amanda/Changer.pm: Fix for DEVICE_STATUS_*.
	* perl/Amanda/Device.swg: New interface.
	* installcheck/Makefile.am: Don't print some commands.
	* installcheck/Amanda_Device.pl: Check new device api.
	* common-src/queueing.c: Use new queue_fd_t.
	* common-src/queueing.h (queue_fd_t): new struct.
	* common-src/amanda-sh-lib.sh.in: Fix bug.
	* common-src/queueing-test.c: Use queue_fd_t.

2008-04-21  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amgetconf.pl: properly quote filenames in
	  regex, to avoid spurious failures when e.g., '+' appears
	  in the filename

2008-04-18  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Changer.pm: rewrite Amanda::Changer to use
	  Amanda::MainLoop, allowing asynchronous operation of 
	  changers
	* server-src/amcheckdump.pl: use new Amanda::Changer 
	  interface (synchronously, until we have Amanda::Xfer)
	* installcheck/Amanda_Changer.pl: test new interface

2008-04-18  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: build $(full_tests) too

2008-04-18  Cyrille Bollu <Cyrille.Bollu@fedasil.be>
	* client-src/sendsize.c: use --numeric-owner during 'sendsize'

2008-04-17  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: segregate installchecks that require
	  both client and server components

2008-04-17  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/debug.c: add Amanda version to debug logs

2008-04-16  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Util.swg common-src/util.c common-src/util.h: add
	  process type and context process attributes
	* perl/Amanda/Debug.swg common-src/debug.c common-src/debug.h: add
	  debug_init to set up debugging according to the process context, and
	  log nothing in CONTEXT_SCRIPTUTIL
	* server-src/amgetconf.pl server-src/amdevcheck.pl:
	  CONTEXT_SCRIPTUTIL
	* server-src/amcheckdump.pl: use new $CONSTANT_CMDLINE variable
	* installcheck/Amanda_Debug.pl: add comment

2008-04-16  Dan Locks <dwlocks@zmanda.com>
	* Fixes to debian package reported by daniel_P
	* packaging/deb/preinst: remove spaces near ${amanda_group}
	* packaging/deb/amanda-backup-server.dirs
	  packaging/deb/amanda-backup-client.dirs: added var/amanda and
	  usr/share/lintian/overrides
	* packaging/deb/rules: added logic to find PERLSITELIB and append that
	  to amanda-backup-server.install, removed broken brace expansion
	* packaging/deb/buildpkg: removed extraneous configure step
	* packaging/deb/amanda-backup-server.postinst: added check for correct
	  permissions on /tmp/amanda

2008-04-16  Dan Locks <dwlocks@zmanda.com>
	* packaging/deb/rules packaging/rpm/amanda.spec: remove --with-gnutar=
	  from configure invocation.  no longer necessary.

2008-04-16  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3.c config/amanda/s3-device.m4: test curl features
	  at runtime, instead of compile time, and always use SSL if it
	  is available.

2008-04-16  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c: Improve message.
	* man/xml-source/amanda.conf.5.xml: Fix man page.
	* server-src/planner.c: Fix DS_INCRONLY and FORCE_FULL.

2008-04-16  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/dumpers.m4: continue searching for gnutar if we
	  find a binary claiming to be gnu tar that is not.  This gets
	  around serious breakage on Ubuntu, where star is installed as
	  /bin/gnutar, but /bin/tar is actually GNU Tar.

2008-04-15  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/file.c(mk1dir): fix reversed conditional to handle 
	  a race condition

2008-04-15  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/debug.c (debug_logging_handler, debug_printf): Don't print
	  msg_timestamp() to stderr.

2008-04-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Call error() only after set_logerror is done.
	* server-src/planner.c: Call error() only after set_logerror is done.
	* server-src/chunker.c: Report a better error message.
	* common-src/stream.c: Set errno to ETIMEDOUT after a timeout.

2008-04-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c (dumps_match_dumpspecs): New function to only keep
	  dumps that match a dumpspecs, using it simplify amfetchdump.
	* server-src/find.h (dumps_match_dumpspecs): Prototype.
	* restore-src/amrestore.c: Add a first_restored_file to
	  search_a_tape(), to allow restore ot stop after the first image.
	* restore-src/restore.c: Set first_restored_file, it was never set,
	  it's needed to stop after the first image.
	* restore-src/restore.c (restore_from_tapelist): break if piping to
	  stdout.
	* restore-src/amfetchdump.c: Use dumps_match_dumpspecs.
	* restore-src/amfetchdump.c: If -p, the keep only one dump.
	* perl/Amanda/Logfile.swg (dumps_match_dumpspecs): New prototype.
	* perl/Amanda/Cmdline.swg: cmdline_parse_dumpspecs.
	* perl/amglue/dumpspecs.swg: Map dumpspecs to perl.
	* perl/Makefile.am (AMGLUE_SWG): Add amglue/dumpspecs.swg.
	* installcheck/Amanda_Logfile.pl: Add many tests.

2008-04-15  Jean-Louis Martineau <martineau@zmanda.com>
	* tape-src/tapetype.c: Initialize an default config.

2008-04-15  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c (connect_portrange, connect_port, bind_portrange):
	  Return the latest errno reported.

2008-04-08  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/conffile.c common-src/conffile.h 
	  perl/Amanda/Config.swg installcheck/Amanda_Config.pl:
	  new interface for config errors, re-introduce rawtapedev for
	  deprectation purposes
	* installcheck/Installcheck/Config.pm: support test
	  amanda-client.conf files
	* installcheck/Installcheck/Run.pm: add get_stdout, get_stderr
	* client-src/client_util.c client-src/client_util.h: add
	  config_errors_to_error_string
	* server-src/dumper.c server-src/planner.c: handle ERRORs and NAKs
	  better, so users see client-side config errors
	* oldrecover-src/amrecover.c changer-src/chg-scsi-chio.c
	  changer-src/chg-scsi.c client-src/sendbackup.c client-src/sendsize.c
	  client-src/selfcheck.c amandad-src/amandad.c application-src/amstar.c
	  application-src/amgtar.c recover-src/amrecover.c
	  server-src/amlogroll.c server-src/amindexd.c server-src/amcheck.c
	  server-src/amgetconf.pl server-src/chunker.c server-src/amadmin.c
	  server-src/amtape.c server-src/amcheckdump.pl
	  server-src/amcleanupdisk.c server-src/amflush.c server-src/amtrmlog.c
	  server-src/driver.c server-src/reporter.c server-src/taper.c
	  server-src/amdevcheck.pl server-src/amtrmidx.c server-src/diskfile.c
	  server-src/amlabel.c installcheck/Amanda_Changer.pl
	  installcheck/Amanda_Device.pl installcheck/Amanda_Logfile.pl
	  installcheck/Amanda_Tapelist.pl restore-src/amidxtaped.c
	  restore-src/amrestore.c restore-src/amfetchdump.c: adapt to new config
	  error interface

2008-04-08  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/diskfile.c: improve messages when client does not
	  support required features

2008-04-08  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Config.pl common-src/conffile.c
	  common-src/conffile.h: fix deprecation of keywords to
	  actually issue a warning.  'netusage' is no longer
	  deprecated.

2008-04-08  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/event.c: use SA_RESTART for child_watch_source

2008-04-07  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/MainLoop.swg perl/amglue/source.c
	  installcheck/Amanda_MainLoop.pl: wrap GMainLoop and the 
	  GSources defined in event.c, using an extensible model
	* common-src/event.c: check whether child_watch_source's signal
	  handler has been replaced, and issue a warning if it has.

2008-04-07  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/queueing.c: fix condition (thanks to Jean-Louis
	  Martineau)

2008-04-07  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/Makefile.am common-src/queueing-test.c: new tests
	* device-src/tests/queue_test.c device-src/tests/Makefile.am: remove
	* common-src/queueing.c: fix two bugs:
	  - spurious in-place memmove on every buffer copy
	  - silent discard of a final packet if the consumer does not
	    completely consume it
	* common-src/queueing.h: update comments
	* common-src/testutils.h: add header-protection macros

2008-04-07  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am installcheck/Amanda_Device.pl: Add tests
	  for Amanda::Device

2008-04-07  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: fix typos

2008-04-04  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/*.xml: Use ulink tag to link to wiki.zmanda.com.

2008-04-04  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c: Check last_header->type != F_UNKNOWN.

2008-04-01  Dustin J. Mitchell <dustin@zmanda.com>
	Suggested by Sunil Sawant <sunil@zmanda.com>
	* man/xml-source/amrecover.8.xml: suggest including a config in the
	  amrecover command line

2008-04-01  John Franks <jfranks@zmanda.com>
	* gnulib/regenerate/regenerate gnulib/regenerate/no-restrict.patch:
	  Patches to reapply after gnulib updates.
	* gnulib/inet_ntop.c gnulib/inet_ntop.h gnulib/string.in.h
	  gnulib/gettimeofday.c gnulib/sys_time.in.h gnulib/base64.c
	  gnulib/getaddrinfo.c gnulib/Makefile.am gnulib/base64.h
	  gnulib/getaddrinfo.h:
	  Remove restricted keywords from source files.

2008-04-01  Satya Ganga <gsat@zmanda.com>
	* example/template.d/amanda-S3.conf.in: S3 device should have
	  "infinite" tape length

2008-03-31  John Franks <jfranks@zmanda.com>
	* common-src/stream.c
	  Fix warning about ininitialized variables.

2008-03-31  John Franks <jfranks@zmanda.com>
	* oldrecover-src/Makefile.am xfer-src/Makefile.am
	  recover-src/Makefile.am server-src/Makefile.am
	  restore-src/Makefile.am:
	  Fix build problems with multiply defined symbols.

2008-03-31  Dan Locks <dwlocks@zmanda.com>
	* packaging/deb/buildpkg
	  packaging/rpm/buildpkg: added -p to cp to preserve file timestamps.

2008-03-31  Dustin J. Mitchell <dustin@zmanda.com>, Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup-gnutar.c client-src/sendsize.c
	  client-src/selfcheck.c: update amandates whenever possible, but only
	  complain when it is really needed: when using calcsize, or when
	  using GNUTAR and --without-gnutar-listdir.
	* client-src/amandates.c: Set errno before return of start_amandates
	* perl/Amanda/Paths.pm.in: always terminate a perl mod with '1;'

2008-03-31  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amgetconf.pl: Parse config after setup_applccation call.

2008-03-31  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Check errno after full_read.

2008-03-31  Dan Locks <dwlocks@zmanda.com>
	* packaging/Makefile.am: add deb subdirectory.

2008-03-31  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/rsh-security.c common-src/ssh-security.c: improve error
	  messages for resolve_hostname calls

2008-03-27  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/util.c common-src/util.h: remove fullread(), fullwrite()
	* gnulib/regenerate/regenerate gnulib/Makefile.am
	  config/gnulib/gnulib-cache.m4: add full-read, full-write modules
	* oldrecover-src/extract_list.c client-src/noop.c
	  client-src/sendbackup-gnutar.c client-src/sendbackup.c
	  client-src/sendsize.c client-src/selfcheck.c amandad-src/amandad.c
	  application-src/amgtar.c recover-src/extract_list.c
	  server-src/changer.c server-src/logfile.c server-src/amindexd.c
	  server-src/amcheck.c server-src/dumper.c server-src/chunker.c
	  server-src/taper-port-source.c server-src/driverio.c
	  server-src/holding.c server-src/driver.c
	  server-src/taper-file-source.c restore-src/restore.c
	  common-src/security-util.c common-src/amanda.h 
	  tape-src/output-file.c: use gnulib full_read, full_write functions,
	  which have slightly different error semantics than the corresponding
	  Amanda functions.

2008-03-27  Jean-Louis Martineau <martineau@zmanda.com>
	* application-src/amgtar.c: Add 'CHECK-DEVICE' property.

2008-03-27  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/activate-devpay.c (parse_commandline): Always return.

2008-03-25  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/readline.m4: Don't add READLINE_LIBS to LIBS.
	* oldrecover-src/Makefile.am (LDAAD): Add READLINE_LIBS.
	* recover-src/Makefile.am (LDAAD): Add READLINE_LIBS.
	* config/amanda/swig.m4: AM_CONDITIONAL(WANT_CYGWIN_COPY_PERL_DLL)
	* config/amanda/swig.m4: Add library to PERLEXTLIBS on cygwin.
	* config/amanda/syshacks.m4: Add '-no-undefined' to AMANDA_ADD_LDFLAGS.
	* amandad-src/Makefile.am,
	* client-src/Makefile.am, device-src/Makefile.am,
	  server-src/Makefile.am, server-src/server_util.c,
	  tape-src/Makefile.am: Add library to many *_LIBADD.
	* perl/Makefile.am (install-data-hook): Copy cygwin ddl if
	  WANT_CYGWIN_COPY_PERL_DLL.

2008-03-25  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Fix typo and remove unused prefix.

2008-03-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Check difference between origsize and outsize
	  to find if the image is compressed.

2008-03-25  Jean-Louis Martineau <martineau@zmanda.com>
	Greg Troxel reported the bug and possible solution.
	* common-src/stream.c (stream_server): New family argument, it is used
					       to create the socket.
	* common-src/stream.h (stream_server): New prototype.
	* server-src/chunker.c, server-src/taper.c: Call stream_server with
	  family of 'localhost', it's the name dumper use to contact them.
	* restore-src/amidxtaped.c: Call stream_server with AF_INET.
	* common-src/bsd-security.c, common-src/security-util.c: Call
	  stream_server with family of incoming packet.

2008-03-25  Jean-Louis Martineau <martineau@zmanda.com>
	Davor Ocelic reported the problem.
	* application-src/Makefile.am: Use applicationexec_PROGRAMS and
	  applicationexec_SCRIPTS to install executable.

2008-03-25  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c (show_stat_info): Use getpwuid_r
						       and getgrgid_r.
2008-03-25  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/swig.m4: fix the fix to the fix for FreeBSD systems'
	  peculiar linking of threading libraries.

2008-03-20  Dan Locks <dwlocks@zmanda.com>
	* packaging/deb/control: removed grep dependency
	* packaging/deb/amanda-backup-client.postinst 
	  packaging/deb/amanda-backup-server.postinst 
	  packaging/deb/amanda-backup-server.postrm
	  packaging/deb/amanda-backup-client.postrm:  removed call to
	  ldconfig to satisfy lintian
	* packaging/deb/amanda-backup-server.lintian
	  packaging/deb/amanda-backup-client.lintian: sorted and added new
	  overrides
	* packaging/deb/amanda-backup-client.dirs: removed var/amanda

2008-03-18  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/activate-devpay.c: fix type warning

2008-03-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c: Correctly check if two hosts map to the same
				 name.

2008-03-15  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am perl/amglue/mainloop.c perl/amglue/amglue.h
	  perl/amglue/source.c: rename mainloop.c to source.c to avoid
	  conflicts with MainLoop.c on case-insensitive filesystems

2008-03-14  Dan Locks <dwlocks@zmanda.com>
	* Initial debian release: This package is based on Bdale Garbee's
	  work as the official debian maintainer for amanda.

2008-03-14  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Document global and by dumptype
					    property.
	* server-src/server_util.c: Rename _proplist to _property.
	* server-src/diskfile.c: Rename _proplist to _property.
	* server-src/amadmin.c (disklist_one): Print property.
	* perl/Amanda/Config.swg: Add new constants to Amanda::Config
	* installcheck/Amanda_Config.pl: Test global property.
	* common-src/conffile.c: Add global and by dumptype property.
	* common-src/conffile.h: Add global and by dumptype property.

2008-03-14  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/MainLoop.swg perl/Makefile.am: new perl module
	* perl/amglue/amglue.h perl/amglue/mainloop.c: support for new module
	* installcheck/Amanda_MainLoop.pl installcheck/Makefile.am: tests for
	  new module
	* common-src/event.h: fix typo in comment

2008-03-14  Dustin J. Mitchell <dustin@zmanda.com>
	* xfer-src/dest-null.c: fix Solaris 8 compilation problem: isprint()
	  expects an int, not a char.

2008-03-13  Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: changed the PKG_CONFIG_PATH macro so that
	  it works with rpm versions earlier than 4.4

2008-03-13  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/device-queueing.c device-src/device-queueing.h
	  server-src/taper-source.c server-src/taper-source.h
	  server-src/taper-source-test.c server-src/taper.c
	  common-src/queueing.c common-src/queueing.h: change ints in
	  consumer/producer to (s)size_t
	* device-src/device.c device-src/device-queueing.c
	  device-src/tests/semaphore-test.c device-src/tests/Makefile.am
	  device-src/queueing.c device-src/semaphore.c
	  device-src/device-queueing.h device-src/queueing.h
	  device-src/Makefile.am device-src/semaphore.h
	  device-src/property.h server-src/taper.c common-src/queueing.c
	  common-src/queueing.h common-src/semaphore-test.c
	  common-src/semaphore.c common-src/semaphore.h
	  common-src/Makefile.am: move queueing and semaphore into
	  common-src, along with their tests
	* configure.in xfer-src/source-random.c xfer-src/xfer-element.h
	  xfer-src/xfer-dest.c xfer-src/xfer-test.c xfer-src/xfer.c
	  xfer-src/xfer-dest.h xfer-src/amxfer.h xfer-src/dest-null.c
	  xfer-src/Makefile.am xfer-src/xfer.h xfer-src/xfer-element.c
	  xfer-src/filter-xor.c Makefile.am: introduce transfer architecture
	* xfer-src/xmsg.c xfer-src/xfer-element.h xfer-src/xfer-test.c
	  xfer-src/xmsg.h xfer-src/xfer.c xfer-src/amxfer.h
	  xfer-src/Makefile.am xfer-src/xfer.h: support for sending
	  and receiving XMsgs.
	* common-src/event.c common-src/event.h: add default_event_loop().
	* device-src/device.c server-src/taper-source-test.c common-src/util.c
	  common-src/util.h common-src/glib-util.c common-src/glib-util.h:
	  create new glib_init() to do g_type_init(), initialize threads, etc.

2008-03-13  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendsize.c: Don't use sscanf for est->qamname because it
				 can have a '%'.
	* server-src/diskfile.c: Clean the diskname before using it as a regex.
	* common-src/protocol.c: Fix bug if packet have a '%' character.

2008-03-13  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Installcheck/Run.pm: Increase size of TAPE.

2008-03-12  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/event.c: Use %jd to print a pid_t, since it may be
	  larger on some platforms.

2008-03-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Fix solaris 8 cc warning.

2008-03-12  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Set stroptions to "".

2008-03-12  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/event.c common-src/event.h common-src/event-test.c:
	  add two new GSources: child_watch_source (sends events when a child
	  dies) and fdsource (sends events when file descriptors match
	  conditions).  Thanks to Jean-Louis Martineau for finding and fixing
	  a race condition.

2008-03-12  Dustin J. Mitchell <dustin@zmanda.com>
	* gnulib/regenerate/regenerate gnulib/Makefile.am DEVELOPING: update
	  documentation to reflect use of gnulib's git repository

2008-03-12  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Makefile.am: Remove CONFIG_CLOBBER_MY_CONFIG,
				    it is done automaticaly.
	* config/amanda/defaults.m4: AC_SUBST(CONFIG_CLOBBER_MY_CONFIG) to not
				     conflict with make CLOBBER_MY_CONFIG.

2008-03-12  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Makefile.am: Use CONFIG_CLOBBER_MY_CONFIG for Makefile
				    variable.

2008-03-11  Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/buildpkg: made the script quieter

2008-03-12  Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: fixed a number of complaints from rpmlint,
	  added --quiet to the configure invocation

2008-03-10  Jean-Louis Martineau <martineau@zmanda.com>
	* gnulib: Update to latest version, add getopt module.

2008-03-07  Jean-Louis Martineau <martineau@zmanda.com>
	* oldrecover-src/Makefile.am, example/Makefile.am,
	  amandad-src/Makefile.am, recover-src/Makefile.am,
	  restore-src/Makefile.am, Makefile.am: Include config/automake/vars.am.
	* installcheck/Amanda_Config.pl: Check config_filename.
	* installcheck/Installcheck/Config.pm: Use local amandates and
					       gnutar_listdir.
	* installcheck/Makefile.am: Take a copy of amanda-client.conf
	* config/amanda/defaults.m4: AC_SUBST(CLOBBER_MY_CONFIG)
	* config/automake/scripts.am: DISTCLEANFILES += $(SCRIPTS_INCLUDE)
	* config/automake/installperms.am: installperms.sh in top_builddir,
					   DISTCLEANFILES += $(installperms_sh)
	* Makefile.am: add '--without-amperldir CLOBBER_MY_CONFIG=OK' to
		       DISTCHECK_CONFIGURE_FLAGS.
	* common-src/Makefile.am: distclean-local: remove svn-info.h.

2008-03-07  Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/buildpkg:  Simplified usage of packaging script by
	  creating a tarball from existing source.

2008-03-06  Jean-Louis Martineau <martineau@zmanda.com>
	* installcheck/Installcheck/Run.pm: merge from application-api.
	* installcheck/Installcheck/Config.pm: merge from application-api.

2008-03-06  Jean-Louis Martineau <martineau@zmanda.com>
	* merge application-api

2008-03-06  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/Makefile.am: dest=$(amlibexecdir).

2008-03-06  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/Makefile.am: Rename SCRIPTSDATA to SCRIPTS_INCLUDE,
				   Add chg-lib.sh.in to EXTRA_DIST.
	* dumper-src/Makefile.am: Rename SCRIPTSDATA to SCRIPTS_INCLUDE,
				  Add generic-dumper.pl to EXTRA_DIST.
	* common-src/Makefile.am: Add amanda-sh-lib.sh to SCRIPTS_INCLUDE,
				  Add amanda-sh-lib.sh.in to EXTRA_DIST.

2008-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/Makefile.am: Move chg-lib.sh to SCRIPTSDATA.
	* dumper-src/Makefile.am: Move generic-dumper to SCRIPTSDATA.

2008-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/swig.m4: Check for *freebsd[123456]*

2008-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-scsi-chio.c: Compile fix.
	* changer-src/scsi-chio.c: Compile fix.
	* config/amanda/changer.m4: Check for linux/chio.h

2008-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/rpm/amanda.spec: Give CFLAGS after ./configure

2008-03-05  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/swig.m4: With many thanks to John E. Hein
	  <jhein@timing.com>, fix the comment and make the change committed
	  yesterday apply to all FreeBSD < 7.0.

2008-03-05  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/summary.m4: quote all warning messages that will be
	  included in heredocs, to avoid spurious interpretation of backquotes

2008-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/rpm/amanda.spec: Add %{PERLSITELIB} in %files sections.

2008-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/amidxtaped: Use default config if amrecover doesn't send
			a config name.  (amoldrecover doesn't send a config).
	* restore-src/restore.c: amrecover from 2.4.5 doesn't send the filenum,
	  so desired_tape->numfiles == 0.
	  If amidxtaped is launched directly from xinetd, then
	  flags->pipe_to_fd == STDOUT_FILENO, but this test should only
	  succeed for amrestore of amfetchdump.

2008-03-05  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c: Set d_self->is_eof to FALSE.

2008-03-04  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am config/amanda/swig.m4: add a special case for
	  FreeBSD-6.2: include -lpthread in the linking of each perl
	  extension, because libgthread does not pull in libpthread as
	  it does on other platforms.

2008-03-03  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: getnameinfo return != 0 on error.

2008-03-03  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/dumpers.m4: Typo.

2008-03-03  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tests/vfs_test.c, common-src/event-test.c: Fix ignoring
	  return value of 'pipe', declared with attribute warn_unused_result.

2008-02-29  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amanda.h: add <stdint.h>

2008-02-28  Dustin J. Mitchell <dustin@zmanda.com>
	* config/automake/installperms.am: --without-installperms now
	  generates a shell-parsable list of desired permissions
	* Makefile.am: erase installperms.sh before beginning a 'make 
	  install'
	* oldrecover-src/Makefile.am client-src/Makefile.am
	  recover-src/Makefile.am server-src/Makefile.am: give mode
	  bits in octal

2008-02-28  Dustin J. Mitchell <dustin@zmanda.com>
	Thanks to John E. Hein <jhein@timing.com> for identifying this problem
	* perl/Amanda/Tests.swg: expose sizeof(size_t) to perl
	* installcheck/Amanda_Config.pl: use a properly-sized constant to
	  check parsing of large configuration values


2008-02-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindexd.c: Compute maxpart, call clean_dump.
	* server-src/disk_history.h (DUMP_ITEM): Add maxpart field.
	* server-src/disk_history.h (add_dump): New prototype,
	                                        add maxpart argument.
	* server-src/disk_history.c (add_dump): Remove a DUMP_ITEM if the
	                                previous part is not already added.
	* server-src/disk_history.c (clean_dump): New function to remove
	                                DUMP_ITEM if all part are not added.
	* common-src/tapelist.h (tapelist_t): Add partnum field.
	* common-src/tapelist.h (append_to_tapelist): New prototype,
	                                              add partnum argument.
	* common-src/tapelist.c (append_to_tapelist): New partnum argument.
	* restore-src/amfetchdump.c: Use new append_to_tapelist prototype.

2008-02-28  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Don't write unclaimed warning if we have
				      an accept function.

2008-02-27  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/testutils.c common-src/testutils.h
	  common-src/Makefile.am: add libtestutils.la
	* common-src/event-test.c common-src/amflock-test.c:
	  use libtestutils.la

2008-02-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c: Use sort_key in switch statement.

2008-02-26  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS, ReleaseNotes: Document --with-amlibdir.
	* config/amanda/dirs.m4: Add AS_HELP_STRING for --without-amlibdir and
				 --without-amlibexecdir,
				 Set AMPERLLIB to $amlibdir/perl.

2008-02-26  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/event-test.c: a more robust and effective test of
	  EV_READFD; thanks to Jean-Louis Martineau for the suggestions.

2008-02-26  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am config/amanda/dirs.m4 config/amanda/summary.m4:
	  add --with-amperldir, --without-amperldir, and install perl modules
	  in Perl's installsitearch by default; thanks to Orion Poplawski
	  <orion@cora.nwra.com> for help and suggestions.

2008-02-26  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/getfsent.c: Don't fail if stat of mount point fail.

2008-02-26  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c: Don't log a note if CLIENT_LOGIN == dumpuser for
			     RUNNING_AS_DUMPUSER_PREFERRED.

2008-02-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Report size of data on holding disk.

2008-02-20  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/dirs.m4: Add --with-amlibdir and --with-amlibexecdir.

2008-02-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c, server-src/dumper.c,
	  server-src/planner.c: Call waitpid to cleanup defunct process.

2008-02-20  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tape-posix.c: keep ioctl error message in
	  debug log

2008-02-19  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.c, device-src/null-device.c,
	  device-src/s3.c, device-src/tape-device.c,
	  device-src/queueing.h, device-src/s3.h,
	  device-src/vfs-device.c, device-src/rait-device.c,
	  server-src/taper-source-test.c, server-src/server_util.c,
	  server-src/taper-disk-port-source.c, perl/Amanda/Device.swg,
	  perl/amglue/integers.swg, restore-src/restore.c,
	  common-src/glib-util.c: Fix solaris compiler warning.

2008-02-19  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c (quote_string): Quote single quote (').
	* server-src/find.c:Correctly compute length of diskname.

2008-02-15  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in config/amanda/progs.m4 config/amanda/flags.m4:
	  use AC_PROG_EGREP instead of the Amanda version
	* server-src/find.c: fix compiler warning on Solaris 8

2008-02-15  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/rpm/amanda.spec: Remove amverify*

2008-02-15  Jean-Louis Martineau <martineau@zmanda.com>
	* oldrecover-src/Makefile.am: Build all files in the build directory.
	* recover-src/Makefile.am: Build all files in the build directory.
	* config/amanda/config.m4: Use $srcdir to buld common-src/svn-info.h
	* configure.in: execute AMANDA_GET_SVN_INFO after AC_OUTPUT because
	  AC_OUTPUT create the common-src directory.

2008-02-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c: Use 'long long' and '%lld' to sscanf.
	* file server-src/infofile.c: Use %jd to print intmax_t value.
	* file server-src/driver.c: Use 'long long' and '%lld' to sscanf.

2008-02-15  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/rpm/amanda.spec: Fix typo.

2008-02-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amdump.sh: Don't use 'date -d', use sed.

2008-02-14  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Installcheck/Run.pm: run test dumps of a smaller
	  directory, to avoid overflowing test tapes

2008-02-14  Dustin J. Mitchell <dustin@zmanda.com>
	* dumper-src/amstar.pl dumper-src/amgtar.pl
	  device-src/tests/get-activation-key.pl server-src/amcheckdump.pl
	  server-src/amdevcheck.pl: add GPL header

2008-02-14  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am installcheck/amdump.pl: add a check
	  that runs 'amdump' directly, since that fails often

2008-02-14  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/event-test.c: make tests more robust to environmental
	  variations, clean up forked children

2008-02-13  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/security-util.c 
	  common-src/security-util.h: don't cast pointers to
	  integers for tcp_conn event id's

2008-02-13  Dan Locks <dwlocks@zmanda.com>
        * packaging/rpm/amanda.spec: added a check for PKG_CONFIG_PATH in the
          build environment as well as if provided on rpmbuild commandline.
          Conditionalized this var to handle cross compiling on FC8.

2008-02-12  Dustin J. Mitchell <dustin@zmanda.com>
	* amandad-src/amandad.c: use sizeof() instead of strlen()
	  in a constant expression

2008-02-12  Dustin J. Mitchell <dustin@zmanda.com>
	* amandad-src/amandad.c: initialize as->service
	* common-src/event.c common-src/event.h: new GMainLoop-based
	  version of the event library, allowing GMainLoop-based and 
	  event-based processes to co-exist peacefully

2008-02-12  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/amcheckdump.pl: fix typo

2008-02-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Fail if no header or no data.

2008-02-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Report failure if dumper succeed and
				  chunker failed.

2008-02-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.h (config_name, config_dir, config_filename):
				 Remove extern declaration.
	* common-src/conffile.h (get_config_name, get_config_dir,
				 get_config_filename): New prototype.
	* common-src/conffile.c (config_name, config_dir, config_filename):
				 Declare static.
	* common-src/conffile.h (get_config_name, get_config_dir,
				 get_config_filename): New functions.
	* perl/Amanda/Config.swg: Don't inline the functions.
	* oldrecover-src/extract_list.c, client-src/sendbackup.c,
	  client-src/sendsize.c, client-src/selfcheck.c,
	  recover-src/amrecover.c, recover-src/extract_list.c,
	  server-src/changer.c, server-src/amlogroll.c,
	  server-src/amindexd.c, server-src/amcheck.c,
	  server-src/dumper.c, server-src/planner.c,
	  server-src/chunker.c, server-src/amadmin.c,
	  server-src/amtape.c, server-src/amcleanupdisk.c,
	  server-src/amflush.c, server-src/amtrmlog.c,
	  server-src/driverio.c, server-src/driver.c,
	  server-src/reporter.c, server-src/taper.c,
	  server-src/amtrmidx.c, server-src/diskfile.c,
	  server-src/amlabel.c,
	  restore-src/amfetchdump.c: Use new functions.

2008-02-12  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/event-test.c common-src/Makefile.am: add checks
	  for the event module

2008-02-12  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/dumper.c server-src/server_util.c
	  server-src/infofile.c server-src/amtrmlog.c common-src/debug.c
	  common-src/file.c: Always call mkpdir without the 02000 bit set,
	  as it is not needed and causes problems on MacOS X.

2008-02-11  Dustin J. Mitchell <dustin@zmanda.com>
	* all source files: update GPL dates
	* perl/*: use LGPL instead of GPL

2008-02-11  Dustin J. Mitchell <dustin@zmanda.com>
	* amandad-src/amandad.c: fix use of non-constant array size

2008-02-11  Dustin J. Mitchell <dustin@zmanda.com>
	* amandad-src/amandad.c: add hack to avoid a race condition in
	  sendbackup operation
	* common-src/security-util.c: issue debug log message when data
	  tokens are dropped by the security API

2008-02-07  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/amrecover.c: Use tapedev from server if it is not set
				   in amanda.client.conf
	* example/amanda-client.conf.in: Document it.

2008-02-07  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/tape-device.c (tape_device_init): Init min_block_size
	  and fixed_block_size to 32768.

2008-02-07  Dustin J. Mitchell <dustin@zmanda.com>
	* packaging/rpm/amanda_enterprise.spec man/Makefile.am
	  man/xml-source/amverify.8.xml man/xml-source/amverifyrun.8.xml
	  man/xml-source/amcheckdump.8.xml server-src/amverifyrun.sh
	  server-src/amverify.sh server-src/Makefile.am: remove amverify*
	* server-src/amdevcheck.pl: tweak @ARGV parsing
	* server-src/amcheckdump.pl installcheck/Installcheck/Run.pm
	  installcheck/amcheckdump.pl: significant rewrite to catch more errors
	  and not loop for ever on some errors.

2008-02-01  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amgetconf.pl installcheck/amgetconf.pl
	  common-src/conffile.c: fix and test amgetconf to allow extra
	  command-line arguments (undocumented), to allow -o options without a
	  space, and to correctly return empty results for empty build
	  variables

2008-02-01  Dan Locks <dwlocks@zmanda.com>
	* packaging/rpm/amanda.spec: added amdumpcheck.8.gz to the %files list
	  for both client and server, removed amplot from client, added missing
	  directory %{SYSCONFDIR}/amanda

2008-01-29  Dan Locks <dwlocks@zmanda.com>
        * packaging/rpm/amanda.spec: changed %{SYSCONFDIR} to %{LOCALSTATEDIR}
          where amanda/amandates is concerned.  also added %{LOCALSTATEDIR} to
          the %files list.

2008-01-29  Dan Locks <dwlocks@zmanda.com>
	* man/xml-source/* added http://wiki.zmanda.com to the "see also"
	  section

2008-01-29  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Check for g_options.
	* client-src/sendsize.c: Check for g_options.
	* client-src/selfcheck.c: Check for g_options.
	* amandad-src/amandad_util.c (free_g_options): Check g_options != NULL.

2008-01-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Fix "Use of uninitialized value in string".

2008-01-28  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Config.pl common-src/conffile.c: uppercase
	  displayunit, and add a unit test to be sure.

2008-01-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: handle lowercase displayunit.

2008-01-28  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in config/amanda/ipv6.m4 common-src/amanda.h: check
	  for netinet/in.h and in_port_t, and define the latter if 
	  necessary.  Thanks to Craig Dewick <cdewick@lios.apana.org.au>
	  for the suggestion.

2008-01-28  Paddy Sreenivasan <paddy@zmanda.com>
	* man/xml-source/amanda.8.xml: Update amanda(8) to reflect 2.6.0
	  status

2008-01-28  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Send service stderr to amandad debug file,
	  Wait for service termination and send error message to server.

2008-01-28  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.c: Set PROPERTY_BLOCK_SIZE with a G_TYPE_INT
			       Set PROPERTY_READ_BUFFER_SIZE with a G_TYPE_UINT

2008-01-22  Dustin J. Mitchell <dustin@zmanda.com>
	* man/Makefile.am man/xml-source/amcheckdump.8.xml: new manpage
	* server-src/amcheckdump.pl: fix usage message

2008-01-22  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in config/amanda/userid.m4: add --with-single-userid

2008-01-22  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amfreetapes.sh: remove unused script

2008-01-22  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/amglue/amglue.h perl/amglue/bigint.c: Include integer limits
	  for all amglue files where they are missing from glib headers

2008-01-22  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: condition installchecks on the selected
	  components

2008-01-22  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am Makefile.am: distribute
	  installcheck/Installcheck scripts, make sure enough parameters
	  are passed along to distcheck for it to succeed, and also clean
	  up properly after tests are run.

2008-01-22  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/dumpers.m4: eliminate strange warning when
	  --without-smbclient is given

2008-01-18  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amgetconf.pl perl/Amanda/Constants.pm.in
	  installcheck/Amanda_Types.pl installcheck/Amanda_Config.pl
	  installcheck/Amanda_Tapelist.pl installcheck/Amanda_Debug.pl
	  installcheck/Amanda_Changer.pl installcheck/amdevcheck.pl
	  installcheck/Installcheck/Config.pm
	  installcheck/Amanda_Cmdline.pl installcheck/amcheckdump.pl
	  installcheck/Amanda_Logfile.pl installcheck/amgetconf.pl:
	  accumulated tweaks and updates to installchecks

2008-01-18  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Tests.swg perl/Makefile.am installcheck/bigint.pl
	  installcheck/Makefile.am: new tests for integer-handling
	  SWIG support, including an installed module (Amanda::Test) that
	  is not used except by this test.

2008-01-18  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amanda_Types.pl
	  installcheck/Amanda_Config.pl installcheck/Amanda_Changer.pl
	  installcheck/Amconfig.pm.in installcheck/amdevcheck.pl
	  installcheck/Installcheck installcheck/Installcheck/Run.pm
	  installcheck/Installcheck/Config.pm installcheck/Makefile.am
	  installcheck/amcheckdump.pl installcheck/Amanda_Logfile.pl
	  installcheck/amgetconf.pl: tweaks:
	   - Move installcheck utilities to the Installcheck::* namespace
	   - add Installcheck::Run to help with setting up amdump runs, and
	     running applications in general
	   - Add complete runs to amdevcheck, amcheckdump
	   - Return a nonzero exit status from amgetconf when an invalid 
	     configuration parameter is specified.

2008-01-18  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Tapelist.swg perl/Amanda/Tapefile.swg perl/Makefile.am:
	  new module (Tapelist) replaces old stub (Tapefile)
	* installcheck/Amanda_Tapelist.pl installcheck/Makefile.am: test new
	  module
	* server-src/amcheckdump.pl installcheck/Amanda_Logfile.pl: use new
	  module

2008-01-18  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Makefile.am perl/Amanda/Debug.swg: handle die() and warn() with
	  critical() and warning(), respectively
	* server-src/amgetconf.pl server-src/amcheckdump.pl
	  server-src/amdevcheck.pl: use die()
	* installcheck/Amanda_Config.pl installcheck/Amanda_Changer.pl
	  installcheck/Amanda_Debug.pl installcheck/Makefile.am: new/updated
	  unit tests

2008-01-18  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amgetconf.8.xml server-src/amgetconf.pl
	  server-src/getconf.c server-src/Makefile.am: rewrite amgetconf in
	  Perl, and add the ability to list available build variables.
	* config/amanda/krb4-security.m4 config/amanda/krb5-security.m4
	  config/amanda/bsd-security.m4 config/amanda/dumpers.m4
	  config/amanda/bsdtcp-security.m4 config/amanda/userid.m4
	  config/amanda/rsh-security.m4 config/amanda/ssh-security.m4
	  config/amanda/bsdudp-security.m4 config/amanda/compress.m4
	  config/amanda/debugging.m4 config/amanda/flock.m4: AC_SUBST a bunch
	  of constants for use in Amanda::Constants
	* perl/Makefile.am perl/Amanda/Paths.pm.in
	  perl/Amanda/Constants.pm.in: add new constants
	* perl/Amanda/Config.swg: add getconf_byname_strs
	* installcheck/amgetconf.pl: check new functionality
	* perl/Amanda/Util.swg common-src/util.c common-src/util.h: add
	  RUNNING_AS_ANY

2008-01-17  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/rpm/buildpkg, packaging/rpm/amanda.spec,
	  configure.in: Set for release 2.6.1alpha.

2008-01-16  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Makefile.am: Require user to specify
	  CLOBBER_MY_CONFIG=OK when running installchecks

2008-01-16  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/rpm/amanda.spec: Don't set PKG_CONFIG_PATH.

2008-01-16  Jean-Louis Martineau <martineau@zmanda.com>
	* oldrecover-src/extract_list.c, client-src/sendbackup.c,
	  client-src/sendsize.c, client-src/selfcheck.c,
	  recover-src/extract_list.c, server-src/changer.c,
	  server-src/amflush.c, server-src/driverio.c,
	  common-src/pipespawn.c: Call safe_fd before exec*.

2008-01-15  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/rpm/amanda.spec: Remove build_host.

2008-01-15  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Types.swg perl/Amanda/Config.swg perl/Amanda/Device.swg
	  perl/amglue/integers.swg: fix typos and compiler warnings

2008-01-15  Jean-Louis Martineau <martineau@zmanda.com>
	* packaging/Makefile.am: New file.
	* packaging/README: New file.
	* packaging/rpm/buildpkg: New file.
	* packaging/rpm/amanda.spec: New file.
	* configure.in
	* config/amanda/dirs.m4 (AMANDA_WITH_DUMPERDIR): Give a warning if used.
	* config/amanda/dirs.m4 (AMANDA_EXPAND_DIRS): Expand DUMPER_DIR to
					 ${amlibexecdir}/application
	* Makefile.am (SUBDIRS): Add packaging.
	* amanda.spec: Remove file.

2008-01-15  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/Makefile.am (AM_CFLAGS): Set to $(AMANDA_WARNING_CFLAGS)
	* device-src/tape-device.c, device-src/tape-posix.c,
	  device-src/vfs-device.c: include "util.h"
	* device-src/rait-device.c: fix compiler warning.

2008-01-14  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/amglue/bigint.c: fix the range-checking mechanics for large
	  integers, since the precompiler seems to get confused by large
	  constants.

2008-01-14  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/krb5-security.m4: abort configure run if krb5
	  is requested by libraries aren't found

2008-01-13  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: use &#215; instead of &times;

2008-01-11  Paddy Sreenivasan <paddy@zmanda.com>
	* device-src/Makefile.am: Don't install queueing.h and device.h

2008-01-11  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Config.swg perl/Amanda/Debug.swg: complete documentation

2008-01-11  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/Makefile.am: Install amandad in $libexecdir/amanda
	* installcheck/amgetconf.pl: usetimestamps defaults to yes.
	* NEWS, ReleaseNotes: Notes about make installcheck.

2008-01-11  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS: Add amcryptsimple, amgpgcrypt, amserverconfig and amaddclient.
	* ReleaseNotes: Ditto.

2008-01-11  Jean-Louis Martineau <martineau@zmanda.com>
	* ReleaseNotes: Update for amanda-2.6.0
	* News: Update for amanda-2.6.0
	* configure.in: AM_INIT_AUTOMAKE(amanda, "2.6.0b1")
	* Makefile.am (pkgdata_DATA): Add NEWS, ChangeLog and amanda.spec
	* amanda.spec: %{!?amanda_version: %define amanda_version 2.6.0b1}

2008-01-10  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (usetimestamps): Default ot yes.
	* man/xml-source/amanda.conf.5.xml (usetimestamps): Document it.

2008-01-10  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amverifyrun.sh, server-src/amverify.sh,
	  tape-src/ammt.c, tape-src/amdd.c: Write deprecated message.

2008-01-10  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/defaults.m4: Set amandates to $localstatedir/amanda/amandate

2008-01-10  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amfreetapes.sh: Use amlibexecdir.

2008-01-10  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/dirs.m4: Set amlibexecdir to $libexecdir/amanda.
	* amandad-src/amandad.c, amplot/amplot.sh,
	  amplot/Makefile.am, changer-src/chg-chs.sh,
	  changer-src/chg-disk.sh, changer-src/chg-juke.sh,
	  changer-src/chg-lib.sh.in, changer-src/chg-manual.sh,
	  changer-src/chg-mcutil.sh, changer-src/chg-mtx.sh,
	  changer-src/chg-multi.sh, changer-src/chg-null.sh,
	  changer-src/chg-rait.sh, changer-src/chg-rth.pl,
	  changer-src/chg-zd-mtx.sh, changer-src/Makefile.am,
	  client-src/Makefile.am, client-src/patch-system.sh,
	  client-src/selfcheck.c, client-src/sendbackup-dump.c,
	  client-src/sendbackup-gnutar.c, client-src/sendsize.c,
	  common-src/amaespipe.sh, common-src/amanda-sh-lib.sh.in,
	  common-src/amcrypt-ossl-asym.sh, common-src/amcrypt-ossl.sh,
	  common-src/amcrypt.sh, common-src/genversion.c,
	  common-src/local-security.c, common-src/Makefile.am,
	  common-src/rsh-security.c, common-src/ssh-security.c,
	  dumper-src/amgtar.pl, example/xinetd.amandaclient,
	  example/xinetd.amandaserver, installcheck/amgetconf.pl,
	  perl/Amanda/Changer.pm, perl/Amanda/Paths.pm.in,
	  restore-src/Makefile.am, server-src/amcheck.c,
	  server-src/amcheckdb.sh, server-src/amcleanup.sh,
	  server-src/amdump.sh, server-src/amflush.c,
	  server-src/amoverview.pl, server-src/amrmtape.sh,
	  server-src/amverifyrun.sh, server-src/amverify.sh,
	  server-src/changer.c, server-src/driver.c,
	  server-src/getconf.c, server-src/Makefile.am,
	  tape-src/Makefile.am: Use amlibexecdir.

2008-01-10  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/flags.m4 (AMANDA_STATIC_FLAGS):
	  Set AMANDA_STATIC_LDFLAGS to '-static' if set.
	* configure.in: Call AMANDA_STATIC_FLAGS.
	* amandad-src/Makefile.am, changer-src/Makefile.am,
	  client-src/Makefile.am, common-src/Makefile.am,
	  dumper-src/Makefile.am, oldrecover-src/Makefile.am,
	  recover-src/Makefile.am, restore-src/Makefile.am,
	  server-src/Makefile.am,
	  tape-src/Makefile.am(AM_LDFLAGS): Set to AMANDA_STATIC_LDFLAGS.

2008-01-09  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in (AC_CONFIG_FILES): Add example/template.d/amanda-S3.conf
	* example/Makefile.am (dist_template_DATA): Add
						    template.d/amanda-S3.conf

2008-01-09  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/scsi-solaris.c: Cleanup.

2008-01-09  Ian Turner <ian@zmanda.com>
	* changer-src/chg-zd-mtx.sh.in: Don't write a corrupt changerfile
	  when a tape has no barcode label.

2008-01-08  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amcheckdump.pl: call critical() rather than
	  using die().

2008-01-08  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheckdump.pl: Parse 'amflush: starttime' and
				     'planner: timestamp' line.
	* server-src/amflush.c: Print correct starttime line.

2008-01-08  Ian Turner <ian@zmanda.com>
	Most of this work was done by Dustin J. Mitchell
	<dustin@zmanda.com>, with contributions by Ian Turner <ian@zmanda.com>.
	* example/template.d/amanda-S3.conf.in: Example configuration
	  using Amazon S3.
	* device-src/device.c: Register the S3 device.
	* device-src/tests/get-activation-key.pl: Tool to retrieve 
	  a DevPay activation key.
	* device-src/s3-device.c, device-src/s3-device.h: S3 device driver.
	* device-src/s3.c, device-src/s3.h: Network support for S3 driver.
	* device-src/property.c, device-src/property.h: Register S3
	  authentication properties.
	* device-src/activate-devpay.c: Tool to convert a devpay 
	  activation key into user tokens.
	* device-src/Makefile.am: Support all these new files.
	* configure.in: Check S3 prerequesites.
	* config/amanda/s3-device.m4: Check if the S3 device should be
	  built.
	* config/amanda/libs.m4: Code to check for libcurl version and
	  features.
	* common-src/util.c: Use libcurl header.

2008-01-08  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amcheckdump.pl: call critical() rather than
	  using die().

2008-01-08  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/local-security.c: New 'local' security driver.
	* common-src/security.c (drivers): Add local_security_driver
	* common-src/Makefile.am (libamanda_la_SOURCES): Add local-security.c
	* man/xml-source/amanda.conf.5.xml,
	  man/xml-source/amanda-client.conf.5.xml,
	  example/amanda-client.conf.in,
	  example/template.d/dumptypes: Document 'local' security driver.

2008-01-08  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amcheckdump.pl perl/Amanda/Util.swg: don't use
	  the C safe_fd, which kills the Perl debugger; just check
	  that fd's 0-2 are open

2008-01-08  Dustin J. Mitchell <dustin@zmanda.com>
	* perl/Amanda/Types.swg perl/Makefile.am: add new Amanda::Types module
	to contain data structures common to several other modules.
	* perl/Amanda/Device.swg: move dumpfile_t to Amanda::Types
	* installcheck/Amanda_Types.pl installcheck/Makefile.am: simple tests
	  for the new module
	* common-src/fileheader.c common-src/fileheader.h: build_header
	  now takes a precise size, not a minimum.

2008-01-08  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/amrecover.c: Call apply_config_overwrites before
				   config_init(CONFIG_INIT_EXPLICIT_NAME ...)

2008-01-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c (strquotedstr, hexdump): Remove function.
	* common-src/util.h (strquotedstr, hexdump): Remove prototype.
	* common-src/fileheader.c (strquotedstr, hexdump): Add function.
	* common-src/fileheader.c (strquotedstr): Fix.

2008-01-07  Jean-Louis Martineau <martineau@zmanda.com>
	* perl/Amanda/Changer.pm: Use Amanda::Config::get_config_dir().

2008-01-07  Jean-Louis Martineau <martineau@zmanda.com>
	* config/automake/scripts.am: Don't set CHECK_PERL.
	* changer-src/Makefile.am: Set CHECK_PERL.
	* client-src/Makefile.am: Set CHECK_PERL.
	* dumper-src/Makefile.am: Set CHECK_PERL.
	* common-src/Makefile.am: Set CHECK_PERL.

2008-01-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/krb5-security.c: Fix argument to resolve_hostname.
	* config/amanda/krb4-security.m4: Check .a or .so lib.
	* config/amanda/krb5-security.m4: Check .a or .so lib.

2008-01-07  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/Makefile.am: Merge typo.
	* example/Makefile.am: Merge Typo.

2007-12-27  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in config/amanda/printf.m4: remove unused
	  configure checks

2007-12-27  Paddy Sreenivasan <paddy@zmanda.com>
	* server-src/reporter.c: Check for NULL mailto

2007-12-27  Satya Ganga <gsat@zmanda.com>
	* server-src/amserverconfig.pl: holding disk will be created
	  only if we have at least 1G free space in the Amanda home dir

2007-12-27  Ian Turner <ian@zmanda.com>
	* server-src/taperscan.c server-src/taper.c: only print error_message
	  if it is non-NULL

2007-12-27  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amrmtape.sh: remove @DB_EXT@, which no longer
	  exists (since 2007-10-09).

2007-12-26  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amverify.sh: fix multiple non-portable shell
	  techniques

2007-12-23  Dustin J. Mitchell <dustin@zmanda.com>
	Large-scale merge of perl interface to Amanda, along with
	a fleet of related changes.  Patch authors are given for
	changes not made by Dustin.

	* perl/Makefile.am config/amanda/swig.m4: use
	  ExtUtils::Embed::perl_inc() to get the include directory
	  and let Amanda's compiler/linker flags and libtool take
	  care of the rest
	* perl/Amanda/Config.swg: use accessors for config_name, 
	  config_filename, and config_dir 
	* server-src/amcheckdump.pl server-src/amdevcheck.pl
	  perl/Amanda/Util.swg installcheck/Amanda_Config.pl: use
	  new accessors
	* perl/Amanda/Util.swg common-src/amanda.h: use a .-relative
	  path in two #include directives to avoid accidentally 
	  including perl's headers of the same name; this is a temporary
	  hack until a larger-scale overhaul of Amanda's headers is done.
	* config/amanda/swig.m4: error out if shared libraries are disabled
	* server-src/amcheckdump.pl: Use timestamp from latest
	  amdump.1 or amflush.1 log file.  (Jean-Louis Martineau
	  <martineau@zmanda.com>)
	* server-src/amcheckdump.pl: Output partnum.  (Jean-Louis
	  Martineau <martineau@zmanda.com>)
	* server-src/amcheckdump.pl: Add a '/' after the config name.
	(Jean-Louis Martineau <martineau@zmanda.com>)
	* perl/Amanda/Logfile.swg perl/Amanda/Device.swg perl/Makefile.am
	  perl/amglue/integers.swg perl/amglue/amglue.h
	  perl/amglue/amglue.swg perl/amglue/glib.swg
	  perl/amglue/bigint.c: Always use Math::BigInt to convert numeric 
	  quantities from C to Perl, to avoid integer overflow and automatic
	  promotion to double.
	* perl/Amanda/Debug.swg client-src/versionsuffix.c
	  common-src/util.c common-src/util.h common-src/debug.c
	  common-src/debug.h common-src/conffile.c
	  common-src/conffile.h common-src/file.c common-src/file.h:
	  - move get_/set_pname to util.c
	  - rename RunningAsWho to running_as_flags
	  - cache original cwd before changing it in safe_cd, and use the
	    cached value in conffile
	* server-src/logfile.c: call set_logerror in open_log
	* client-src/runtar.c common-src/debug.c common-src/amanda.h
	  common-src/file.c common-src/file.h: replace client_uid,
	  client_gid globals with functions, to eliminate the need
	  for initialization
	* server-src/logfile.c: Update warning about globals
	* server-src/find.c: Update search_logfile to possibly search
	  all tapes in a logfile. Also, other miscellaneous
	  refactoring.  (Ian Turner <ian@zmanda.com>)
	* server-src/find.h: Document new interface.
	* server-src/amindexd.c, server-src/amadmin.c,
	  server-src/amtrmidx.c, restore-src/amfetchdump.c: Use new
	  find_dump interface.
	* common-src/util.c, common-src/util.h: New function
	  compare_possibly_null_strings, which is like strcmp() but
	  orders NULL pointers before non-null strings.
	* Makefile.am: reflect BINARY_OWNER into distcheck-triggered
	  ./configure
	* common-src/conffile.c common-src/conffile.h: completely
	  new API, almost complete rewrite
	* common-src/columnar.c common-src/columnar.h
	  common-src/Makefile.am: new files, extracted from
	  conffile.[ch]
	* oldrecover-src/amrecover.c oldrecover-src/extract_list.c
	  changer-src/chg-scsi-chio.c changer-src/chg-scsi.c
	  client-src/sendbackup.c client-src/sendsize.c
	  client-src/selfcheck.c amandad-src/amandad.c
	  device-src/device.c recover-src/amrecover.c
	  recover-src/extract_list.c server-src/diskfile.h
	  server-src/logfile.c server-src/amlogroll.c
	  server-src/amindexd.c server-src/amcheck.c
	  server-src/dumper.c server-src/planner.c
	  server-src/chunker.c server-src/amadmin.c
	  server-src/amtape.c server-src/amcleanupdisk.c
	  server-src/getconf.c server-src/amflush.c
	  server-src/amtrmlog.c server-src/driverio.c
	  server-src/holding.c server-src/driverio.h
	  server-src/driver.c server-src/reporter.c server-src/taper.c
	  server-src/find.c server-src/amindex.c server-src/amtrmidx.c
	  server-src/diskfile.c server-src/amlabel.c
	  perl/Amanda/Config.swg config/amanda/defaults.m4
	  restore-src/amidxtaped.c restore-src/amrestore.c
	  restore-src/restore.c restore-src/amfetchdump.c
	  common-src/util.h common-src/glib-util.c tape-src/tapeio.c
	  common-src/amanda.h tape-src/tapeio.h: use new conffile API
	* installcheck/Makefile.am installcheck/Amconfig.pm.in
	  installcheck/Installdirs.pm.in installcheck/Amanda_Config.pl
	  installcheck/Amanda_Changer.pl installcheck/Amanda_Cmdline.pl
	  installcheck/Amanda_Logfile.pl installcheck/amcheckdump.pl
	  installcheck/amdevcheck.pl installcheck/amgetconf.pl:
	  new unit tests for new modules, applications
	* server-src/amdevcheck.pl server-src/amcheckdump.pl: new pure-
	  Perl applications; amcheckdump.pl is by Ian Turner
	  <ian@zmanda.com>
	* perl/Amanda perl/Makefile.am perl/Amanda/Paths.pm.in
	  perl/Amanda/Logfile.swg perl/Amanda/Changer.pm
	  perl/Amanda/Config.swg perl/Amanda/Debug.swg
	  perl/Amanda/Tapefile.swg perl/Amanda/Cmdline.swg
	  perl/Amanda/Util.swg perl/Amanda/Device.swg: new directory
	  containing perl interfaces to Amanda modules
	* perl/amglue perl/amglue/integers.swg perl/amglue/amglue.h
	  perl/amglue/exports.swg perl/amglue/ghashtable.c
	  perl/amglue/amglue.swg perl/amglue/constants.swg
	  perl/amglue/glib.swg perl/amglue/bigint.c: functions and
	  macros to glue Amanda to perl

2007-12-21  Satya Ganga <gsat@zmanda.com>
	* server-src/amserverconfig.pl: correct holding disk size
	  validation logic so that it works on solaris too

2007-12-21  Satya Ganga <gsat@zmanda.com>
	* server-src/amserverconfig.pl: amserverconfig needs to create a empty
	  changer.conf file

2007-12-21  Jean-Louis Martineau <martineau@zmanda.com>
	Bug reported by Tim Bunnell.
	* client-src/getfsent.c (dev2rdev): Do it only for block device.

2007-12-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: Unquote holding_disk_file.

2007-12-20  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/debug.h: fix (cosmetic, but confusing) typo

2007-12-19  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c (quote_string): Quote ':'.

2007-12-19  Ian Turner <ian@zmanda.com>
	* server-src/taper.c: Don't crash if there is a problem writing a
	  brand new tape.

2007-12-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Correctly set planner_timestamp if
				usetimestamps is set to no.

2007-12-18  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driverio.c (childstr): Check dumper->chunker.

2007-12-14  Ian Turner <ian@zmanda.com>
	* device-src/tape-device.c: Try to open tape devices as O_NONBLOCK
	  at first; if the device is not ready, we will let the changer script
	  retry, instead of having the kernel do it for us.
	* device-src/tape-ops.h, device-src/tape-aix.c,
	  device-src/tape-uware.c, device-src/tape-xenix.c,
	  device-src/tape-posix.c: Add new tape_is_ready() function.

2007-12-14  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/dumpers.m4: Don't set STAR in AMANDA_PROG_SAMBA_CLIENT.

2007-12-14  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c (search_logfile): Parse taper result line before
					      merging part_find.

2007-12-14  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c (find_log): Result should not have duplicate
					logfile.

2007-12-10  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Parse NEW-TAPE line
	* server-src/taper.c: Add the handle in NEW-TAPE result.
	* server-src/driver.c: Check number of arguments in NEW-TAPE result.

2007-12-10  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/progs.m4: Define AMLINT To 'echo;false' to no lint
				  are found.

2007-12-10  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsdudp-security.c: Loop over all address until a bind
					is successful.
	* common-src/bsd-security.c: Loop over all address until a bind
				     is successful.
	* common-src/stream.c: Loop over all address until a connect is
			       successful.

2007-12-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindexd.c: Don't use duplicate part.

2007-12-07  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/amfetchdump.c: Don't use duplicate part.

2007-12-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/holding.c (holding_get_all_datestamps): Don't add
	  duplicate datestamp.

2007-12-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Don't complain about correct unlabeled
				volumes.

2007-12-06  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c, client-src/sendsize.c,
	  client-src/selfcheck.c, client-src/calcsize.c,
	  amandad-src/amandad.c, device-src/device.c,
	  device-src/vfs-device.c, server-src/changer.c,
	  server-src/dumper.c, server-src/planner.c,
	  server-src/chunker.c, server-src/server_util.c,
	  server-src/taperscan.c, server-src/driver.c,
	  server-src/taper.c, server-src/find.c,
	  server-src/diskfile.c, common-src/pipespawn.c,
	  common-src/util.c, common-src/conffile.c: Fix memory leak.

2007-12-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c (search_logfile): Parse PARTPARTIAL line.

2007-12-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: Use g_strdup if pointer can be NULL.

2007-12-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taperscan.c: Don't output the latest changer result.

2007-12-05  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c (resolve_hostname): Take a new socktype argument.
	* common-src/util.h (resolve_hostname): New prototype.
	* common-src/bsd-security.c, common-src/bsdtcp-security.c,
	  common-src/bsdudp-security.c, common-src/krb5-security.c,
	  common-src/rsh-security.c, common-src/security-util.c,
	  common-src/ssh-security.c, common-src/stream.c,
	  recover-src/set_commands.c, server-src/amcheck.c,
	  server-src/dumper.c: Call resolve_hostname with socktype argument.

2007-12-05  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c (resolve_hostname): Don't return V4MAPPED address.
	* common-src/amanda.h (AI_V4MAPPED, AI_ALL): Don't define.

2007-12-04  Ian Turner <ian@zmanda.com>
	* server-src/taperscan.c, server-src/taperscan.h: Support persistence
	  between invocations of taper_scan(), so that you can get second-best
	  and further tapes.
	* server-src/amcheck.c, server-src/amtape.c: Use the new taperscan 
	  interface.
	* server-src/taper.c: Do the right thing if there is an error writing
	  the tape label.

2007-12-04  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amtape.c: Correctly output the result of taper scan.

2007-12-04  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c, server-src/dumper.c
	  server-src/planner.c: Don't crash is securoty driver is not found.

2007-12-04  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/changer.c: Print better message if the changer script
				has no output.

2007-12-03  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amserverconfig.8.xml: Fix indentation.

2007-11-30  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper-mem-port-source.c, server-src/taper-file-source.c
	  server-src/taper.c: Cast guint64 to uintmax_t and use %ju to print.

2007-11-30  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Improve documentation.
	* example/amanda.conf.in: Ditto.

2007-11-30  Jean-Louis Martineau <martineau@zmanda.com>
       * server-src/server_util.c (cmdstr): Remove SPLIT-NEEDNEXT
                                            and SPLIT-CONTINUE
       * server-src/server_util.h (cmd_t): Remove SPLIT_NEEDNEXT
                                           and SPLIT_CONTINUE.
       * server-src/taper.c: Send part_kbyte in PARTDONE result.
       * server-src/amstatus.pl: Parse part_kbyte in PARTDONE result line.
                                 Parse REQUEST-NEW_TAPE line.
       * common-src/conffile.h: CONF_FLUSH_THRESHOLD_DUMPED,
			        CONF_FLUSH_THRESHOLD_SCHEDULE, CONF_TAPERFLUSH.
       * common-src/conffile.c: CNF_FLUSH_THRESHOLD_DUMPED,
                                CNF_FLUSH_THRESHOLD_SCHEDULE, CNF_TAPERFLUSH.
       * server-src/driverio.h: Add Many globals.
       * server-src/driver.c: Split runq in runq and directq.
                              Implement flush-threshold-*/taperflush.
       * example/amanda.conf.in: Example for flush-threshold-* and taperflush.
       * man/xml-source/amanda.conf.5.xml: Document flush-threshold-*
					   and taperflush.

2007-11-30  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taperscan.c: Fix output formating.

2007-11-30  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/set_commands.c: Add a terminating '/' in cd_regex.
				      Never add it in cd_dir.

2007-11-30  Jean-Louis Martineau <martineau@zmanda.com>
	* config/automake/scripts.am: Build of the scripts also depend on
				      $(top_builddir)/config.status

2007-11-30  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amdump.sh: Pass a --startime argument to planner.
	* server-src/planner.c: Get the --starttime command line argument.

2007-11-30  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: New --locale-independent-date-format option.
	* man/xml-source/amstatus.8.xml: Document it.
	* server-src/amflush.c: Output a "starttime-locale-independent" line.
	* server-src/amdump.sh: Output a "starttime-locale-independent" line.

2007-11-30  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c: Remove seen_chunk_of function.

2007-11-28  Jean-Louis Martineau <martineau@zmanda.com>
	* config/macro-archive/docbook-dtd.m4: Check return code of 5.

2007-11-28  Dustin J. Mitchell <dustin@zmanda.com>
	* installcheck/Amconfig.pm.in: fix quoting error leading to
	directories named '"'

2007-11-28  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/file.c: only chown new directories when running as root

2007-11-28  Dustin J. Mitchell <dustin@zmanda.com>
	* config/automake/installperms.am: strip directory names from build
	  filenames when setting permissions; fixes errors from examples/
	  install

2007-11-28  Dustin J. Mitchell <dustin@zmanda.com>
	* man/Makefile.am: Allow installs, but not tarballs, without
	  manpages

2007-11-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Check dp->todo before using (est)->dp.

2007-11-27  Jean-Louis Martineau <martineau@zmanda.com>
	* device-src/device.c (default_device_start): Overwrite label only
						      if mode == ACCESS_WRITE.

2007-11-20  Ian Turner <ian@zmanda.com>
	* device-src/device.c, device-src/device.h
	  device-src/tape-device.c, device-src/rait-device.c: Change API
	  semantics with respect to label reading. This patch makes it
	  possible to open and read a volume with properties while only
	  reading its label once. Thanks to Jean-Louis Martineau
	  <martineau@zmanda.com> for suggesting this change.

2007-11-20  Ian Turner <ian@zmanda.com>
	* device-src/vfs-device.c: Be more thourough about updating volume
	  usage statistics.

2007-11-20  Ian Turner <ian@zmanda.com>
	* changer-src/chg-lib.sh.in: Use a more robust check for MT path.
	* server-src/amverify.sh.in: Use amrestore instead of amdd/ammt.

2007-11-09  Ian Turner <ian@zmanda.com>
	* server-src/taperscan.c: Fix a memory allocation bug and be a little
	  more paranoid.

2007-11-06  Ian Turner <ian@zmada.com>
	* server-src/taperscan.c: Print a proper message if there is
	  only one flag from device_read_label().

2007-11-26  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in config/amanda/config.m4 common-src/genversion.c
	  common-src/Makefile.am: explicitly generate svn info at configure
	  time, rather than relying on svn keywords

2007-11-26  Ian Turner <ian@zmanda.com>
	* server-src/Makefile.am: Move amdevcheck from libexec/ to sbin/.
	  Thanks to Satya Ganga <gsat@zmanda.com> for noticing this problem.
	
2007-11-26  John Franks <jrfranks@zmanda.com>
	* common-src/debug.c	For cygwin builds: change to
	  close and reopen log file handle on successful rename.
	  This is to ensure that Windows has no possibility of
	  preventing access to the original file name if processes
	  collide.
		
2007-11-23  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amflush.c: Send config option (-o) to child process.

2007-11-23  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Don't set est(dp)->state before testing it.

2007-11-23  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/readline.m4: Include termcap, curses or ncurese in LIBS.

2007-11-23  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c (match_disklist): Fix for disk not found.

2007-11-23  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Don't release taper_ev_read in
                               start_degraded_mode.

2007-11-20  Paddy Sreenivasan <paddy@zmanda.com>
        * amanda.spec: Added calls to Zmanda
	* example/amanda-client.conf.in: Switch to bsdtcp

2007-11-14  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl: Handle taper FAILED message.

2007-11-14  Jean-Louis Martineau <martineau@zmanda.com>
	* config/amanda/userid.m4: Use $enableval in AC_ARG_ENABLE.

2007-11-07  Paddy Sreenivasan <paddy@zmanda.com>
	* server-src/amserverconfig.pl server-src/amaddclient.pl: 
          new configuration tools
	* common-src/amgpgcrypt.pl common-src/amcryptsimple.pl: 
          new encryption plugins
	* man/xml-source/amaddclient.8.xml man/xml-source/amgpgcrypt.8.xml 
          man/xml-source/amcryptsimple.8.xml 
	  man/xml-source/amserverconfig.8.xml: man pages for new tools
	* example/template.d/* - Configuration file templates
	* example/amanda-client.conf.in: Updated amanda configuration file
	* example/Makefile.am man/Makefile.am server-src/Makefile.am
          common-src/Makefile.am: Added amserverconfig, amaddclient, 
          amgpgcrypt and amcryptsimple
	* device-src/Makefile.am: Fixed libamdevice version
	* configure.in: Added template files
        * amanda.spec: Updated spec file for new utilities

2007-11-01  Dustin J. Mitchell <dustin@zmanda.com>
	* config/automake/installperms.am: new method of specifying
	  permissions on installed files
	* config/amanda/userid.m4 configure.in: add --disable-installperms
	  to disable any permsisions settings (useful for packaging builds)
	* oldrecover-src/Makefile.am example/Makefile.am
	  changer-src/Makefile.am amplot/Makefile.am
	  client-src/Makefile.am amandad-src/Makefile.am man/Makefile.am
	  dumper-src/Makefile.am recover-src/Makefile.am
	  server-src/Makefile.am restore-src/Makefile.am
	  Makefile.am support/Makefile.am common-src/Makefile.am
	  tape-src/Makefile.am: use installperms.am

2007-11-01  Dustin J. Mitchell <dustin@zmanda.com>
	Suggested by Jon LaBadie
	* config/automake/precompile.am: new rule to make
	  precompiler output files; useful for debugging
	* */Makefile.am: include precompile.am

2007-11-01  Jean-Louis Martineau <martineau@zmanda.com>
	* AUTHORS: Add Dustin J. Mitchell.

2007-10-31  John Franks <jrfranks@zmanda.com> (merged by dustin@zmanda.com)
	* most C files, amanda.h: Switch to using the g_printf family, which
	  supports a consistent set of %-conversions, including the 'z'
	  (size_t) and 'j' (intmax_t) size specifiers.  Convert various
	  printf format strings accordingly.

2007-10-31  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/genversion.c common-src/Makefile.am: fix BUILD_REV
	  and BUILD_BRANCH to work even when packages are built from
	  distribution tarballs

2007-10-31  Ian Turner <ian@zmanda.com>
	* server-src/taperscan.c: Don't segfault if there is an error opening
	  a device during taperscan.

2007-10-30  Dustin J. Mitchell <dustin@zmanda.com>
	* docs autogen INSTALL UPGRADING configure.in 
	  DEVELOPING Makefile.am: remove docs/ directory in favor of
	  manpages and online reference; most docs/* were outdated

2007-10-29  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-zd-mtx.sh: fix typo

2007-10-29  Ian Turner <ian@zmanda.com>
	* restore-src/restore.c: Don't mention slot numbers when running
	  without a changer.

2007-10-29  Ian Turner <ian@zmanda.com>
	* man/xml-source/amfetchdump.8.xml: Remove documentation for
	  amfetchdump -i.

2007-10-26  Dustin J. Mitchell <dustin@zmanda.com>
	Add support for post-install tests, which can be more thorough than
	unit tests.
	* configure.in Makefile.am installcheck/*: new directory
	* installcheck/amgetconf.pl: test some of amgetconf's functionality
	* docs/developing.txt: notes on various test mechanisms
	* config/automake/scripts.am: add CHECK_PERL_FLAGS
	* common-src/debug.c: only try to chown debug files if running as root

2007-10-25  Dustin J. Mitchell <dustin@zmanda.com>
	* config/mkinstalldirs config/depcomp config/config.guess
	  config/ltmain.sh config/config.sub config/missing
	  config/install-sh config/ylwrap: update files with automake-1.10, 
	  libtool-1.5.24
	* autogen: don't call automake with --add-missing, as it stomps all
	  over the working copy

2007-10-25  Dustin J. Mitchell <dustin@zmanda.com>
	* gnulib/* config/*: updated to latest gnulib
	* gnulib/regenerate/regenerate: update gnulib date
	* gnulib/regenerate/getaddrinfo-cygwin.patch: update to patch new
	  getaddrinfo.c
	* device-src/tests/vfs_test.c: mkdtemp.h no longer exists

2007-10-24  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/Makefile.am: Remove duplicate entry for
				  libamclient_la_SOURCES.

2007-10-23  Dustin J. Mitchell <dustin@zmanda.com>
	* config/automake/scripts.am: rules to build (substitute) scripts
	* config/automake/vars.am: define empty variables for later appending
	* config/automake/check-perl.am config/automake/check-shell.pm:
	  removed
	* changer-src/Makefile.am amplot/Makefile.am client-src/Makefile.am
	  dumper-src/Makefile.am server-src/Makefile.am 
	  common-src/Makefile.am: Use new include files
	* configure.in: remove now-unnecessary AC_CONFIG_FILES
	* *.sh.in *.pl.in *.awk.in: renamed

2007-10-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Always call sort_disks.

2007-10-20  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Correctly document portrange.
	* common-src/conffile.c: Fix portrange.

2007-10-20  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Allow reserved-udp-port and reserved-tcp-port
				 in amanda-client.conf.

2007-10-17  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amanda.h: remove amflock cruft

2007-10-16  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/defaults.m4: Change EXAMPLE_TAPEDEV to use the 'tape:'
	syntax, and to indicate "you need to change this!" more explicitly

2007-10-16  Ian Turner <ian@zmanda.com>
	* common-src/glib-util.c: Allow use of units in parsing GValues; in
	  particular, this allows use of units when specifying device
	  properties in the configuration file.
	* common-src/conffile.c, common-src/conffile.h: Make unit suffixes
	  available outside of conffile.c.

2007-10-16  Ian Turner <ian@zmanda.com>
	* device-src/device.c: Fix a compilation error in
	  device_set_startup_properties_from_config().

2007-10-16  Ian Turner <ian@zmanda.com>
	* man/xml-source/amanda.conf.5.xml, server-src/taper.c,
	  common-src/conffile.c, common-src/conffile.h: Add new
	  configuration directive device_output_buffer_size to replace
	  tapebufs.

2007-10-15  Ian Turner <ian@zmanda.com>
	* device-src/device.c: Don't complain about problems setting
	  MAX_VOLUME_USAGE; do complain about problems setting
	  READ_BUFFER_SIZE.

2007-10-16  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup-gnutar.c: Use GNUTAR.

2007-10-15  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/device.c: do not fall back to tape:/foo if the tape
	  device is not available (WANT_TAPE_DEVICE is not set)

2007-10-12  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-mtx.sh.in changer-src/chg-zd-mtx.sh.in
	  changer-src/chg-multi.sh.in: add missing definition of prefix

2007-10-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/protocol.c (s_repwait): return PA_FINISH on P_NAK.

2007-10-11  Dustin J. Mitchell <dustin@zmanda.com>
	* config/amanda/tape.m4: fix typo (have_MTIOCTOP -> HAVE_MTIOCTOP)

2007-10-10  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amflock-test.c common-src/amflock-lnlock.c: don't use
	  AMANDA_TMPDIR during build-time testing

2007-09-14  Dustin J. Mitchell <dustin@zmanda.com>
	* recover-src/uscan.l recover-src/extract_list.c 
	  recover-src/uparse.y recover-src/amrecover.h 
	  recover-src/help.c recover-src/set_commands.c: deprecate
	  'settape', add 'setdevice'
	* man/xml-source/amrecover.8.xml: corresponding doc update
	* example/amanda.conf.in: update comments in example config, 
	  change default value of amrecover_changer from the confusing
	  "/dev/null"

2007-10-09  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amflock-test.c: lock files in the cwd, rather than /tmp,
	  and pay attention to errors from unlink()

2007-10-09  Dustin J. Mitchell <dustin@zmanda.com>
	* gnulib/regenerate/regenerate gnulib/mkdtemp.c gnulib/mkdtemp.h
	  gnulib/gettimeofday.c gnulib/sys_time_.h gnulib/tempname.c
	  gnulib/tempname.h gnulib/stat_.h gnulib/Makefile.am
	  device-src/tests/vfs_test.c config/gnulib/mkdtemp.m4
	  config/gnulib/sys_time_h.m4 config/gnulib/tempname.m4
	  config/gnulib/gnulib-comp.m4 config/gnulib/sys_stat_h.m4
	  config/gnulib/gnulib-cache.m4 config/gnulib/gettimeofday.m4:
	  add 'mkdtemp' gnulib module, use it in vfs_test.c

2007-10-09  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c (portable_readdir): Don't use reentrant function.

2007-10-08  Dustin J. Mitchell <dustin@zmanda.com>
	* autogen configure.in config/macro-archive/*.m4
	  config/amanda/*.m4 config/libtool/*.m4: move most autoconf
	  checks to macros in .m4 files.  Hilights of changes along the way:
	  - use AC_REQUIRES to enforce check ordering
	  - Add a post-configure summary of important results
	  - use AM_CONDITIONAL to control conditional compilation of whole
	    files, instead of preprocessor macros
	  - correct spelling of PRINCIPLE -> PRINCIPAL
	  - remove support for dbmalloc (we use valgrind, coverity, etc. now)
	  - remove support for infofiles in anything but text format
	  - change DONT_SUID_ROOT to !WANT_SETUID_ROOT
	  - remove unused --with-broken-fsf
	  - remove multiple unused function and header checks, the defines
	    from which do not appear in any source file
	  - remove LTLIBOBJS cruft based on
	    http://www.delorie.com/gnu/docs/autoconf/autoconf_165.html
	  - remove unused LTALLOCA definition based on
	    http://www.delorie.com/gnu/docs/libtool/libtool_30.html
	  - use autoconf macro archive's
	    AC_DEFINE_DIR to expand $prefix, etc. in directory variables
	  - do not *require* --with-{user,group}; this allows 'make distcheck'
	    to run successfully
	* docs/developing.txt: describe how to update gnulib, libtool, and
	  gettext
	* po/reautopoint.patch po/reautopoint: script to update gettext,
	  parallel to gnulib/regenerate/regenerate
	* amandad-src/amandad.c changer-src/scsi-aix.c
	  changer-src/scsi-bsd.c changer-src/scsi-cam.c
	  changer-src/scsi-changer-driver.c changer-src/scsi-chio.c
	  changer-src/scsi-hpux.c changer-src/scsi-hpux_new.c
	  changer-src/scsi-irix.c changer-src/scsi-linux.c
	  changer-src/scsi-proto.c changer-src/scsi-solaris.c
	  changer-src/sense.c client-src/calcsize.c client-src/getfsent.c
	  client-src/selfcheck.c client-src/sendbackup.c
	  client-src/sendsize.c common-src/alloc.c common-src/amanda.h
	  common-src/conffile.c common-src/debug.c common-src/file.c
	  common-src/genversion.c common-src/krb4-security.c
	  common-src/writev.c device-src/tape-posix.c server-src/amadmin.c
	  server-src/amcheck.c server-src/amlabel.c server-src/amlogroll.c
	  server-src/amtape.c server-src/amtrmidx.c server-src/amtrmlog.c
	  server-src/changer.c server-src/chunker.c server-src/diskfile.c
	  server-src/driver.c server-src/dumper.c server-src/getconf.c
	  server-src/infofile.c server-src/infofile.h server-src/planner.c
	  server-src/reporter.c tape-src/output-tape.c: changes corresponding
	  to simplifications and fixes in autoconf
	* gnulib/regenerate/no-error.patch gnulib/regenerate/regenerate: no
	  need to create gnulib.m4i anymore

2007-10-08  Kevin Till <ktill@zmanda.com>  (merged by dustin@zmanda.com)
	* example/amanda.conf.in: add segate LTO tapetype

2007-10-08  Paddy Sreenivasan <paddy@zmanda.com>
	* changer-src/chg-lib.sh.in
	  changer-src/chg-null.sh.in changer-src/chg-disk.sh.in
	  changer-src/chg-juke.sh.in changer-src/chg-rait.sh.in
	  changer-src/chg-chs.sh.in changer-src/chg-mcutil.sh.in
	  amplot/amplot.sh.in client-src/patch-system.sh.in
	  server-src/amcheckdb.sh.in server-src/amverifyrun.sh.in
	  server-src/amrmtape.sh.in server-src/amverify.sh.in
	  server-src/amfreetapes.sh.in server-src/amcleanup.sh.in
	  server-src/amdump.sh.in common-src/amanda-sh-lib.sh.in
	  common-src/amcrypt-ossl-asym.sh.in common-src/amcrypt.sh.in
	  common-src/amaespipe.sh.in common-src/Makefile.am
	  common-src/amcrypt-ossl.sh.in: move amanda-sh-lib.sh from
	  $libexecdir/amanda to just $libexecdir

2007-10-04  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tests/Makefile.am device-src/tests/vfs_test.c: add a test
	  for the vfs device
	* device-src/property.c device-src/vfs-device.c: add
	  PROPERTY_FREE_SPACE

2007-10-04  Dan Locks <dwlocks@zmanda.com>
	* amanda.spec: add .spec file Zmanda uses for community builds
	
2007-10-04  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/device.c device-src/Makefile.am configure.in: add
	  WANT_TAPE_DEVICE conditional, for machines that have no tape
	  support whatsoever (Mac OS X)

2007-10-03  Dan Locks <dwlocks@zmanda.com>
	* configure.in: Added /opt/local/bin AC_PATH_PROG(PKG_CONFIG.. for 
	  mac osx and macports

2007-10-03  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Go in degraded mode after out of tape.

2007-10-02  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Fix indentation.

2007-10-02  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amcheck.c: Fix typo in merge found by
	  martineau@zmanda.com

2007-10-01  Ian Turner <ian@zmanda.com>
	* device-src/rait-device.c, device-src/queueing.c,
	  device-src/tests/device_test.c, device-src/device.h,
	  device-src/device.c: Remove device_is_eof() function in favor of
	  accessing is_eof member directly.

2007-10-01  Dustin J. Mitchell <dustin@zmanda.com>
	Coverity bug #237
	* amandad-src/amandad.c: fix a use-after-free

2007-10-01  Ian Turner <ian@zmanda.com>
	* device-src/device.c: Automatically register the CANONICAL_NAME
	  property for all devices.

2007-10-01  Ian Turner <ian@zmanda.com>
	* device-src/tape-posix.c: Use MTEOD on systems that have it but not
	  MTEOM.

2007-10-01  Ian Turner <ian@zmanda.com>
	* device-src/device.c, device-src/vfs-device.c,
	  device-src/rait-device.c: Use g_strdup() instead of strdup().

2007-10-01  Ian Turner <ian@zmanda.com>
	* changer-src/chg-lib.sh.in: Fix some compilation problems on
	  Solaris 10.

2007-09-25  Dan Locks <dwlocks@zmanda.com>
	* common-src/util.c: cast uid_t to long long for printf formatting

2007-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* oldrecover-src/Makefile.am changer-src/Makefile.am
	  client-src/Makefile.am amandad-src/Makefile.am
	  recover-src/Makefile.am server-src/Makefile.am
	  restore-src/Makefile.am common-src/Makefile.am
	  tape-src/Makefile.am: replace -I../config with 
	  -I$(top_builddir)/config
	* device-src/tests/Makefile.am: Replace -I.. with 
	  -I$(top_srcdir)/device-src

2007-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* client-src/sendsize.c: change "smbclient" to SAMBA_CLIENT to allow
	  configurable name

2007-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amflock-flock.c common-src/amflock-posix.c
	  common-src/amflock-lockf.c common-src/amflock-lnlock.c
	  common-src/amflock.c: use G_GNUC_UNUSED to avoid compiler
	  warnings

2007-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amanda.h common-src/file.h: move declaration of 
	  canonicalize_pathname to file.h

2007-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/util.c common-src/util.h: only check euid==uid
	  if not RUNNING_AS_UID_ONLY; set_root_privs() checks that euid=0
	* client-src/runstar.c client-src/noop.c client-src/runtar.c
	  client-src/sendbackup.c client-src/killpgrp.c
	  client-src/sendsize.c client-src/selfcheck.c
	  client-src/rundump.c amandad-src/amandad.c
	  server-src/amlogroll.c server-src/amindexd.c
	  server-src/amcheck.c server-src/dumper.c server-src/planner.c
	  server-src/chunker.c server-src/amadmin.c server-src/amtape.c
	  server-src/amcleanupdisk.c server-src/amflush.c
	  server-src/amtrmlog.c server-src/amdevcheck.c
	  server-src/driver.c server-src/reporter.c server-src/taper.c
	  server-src/amtrmidx.c server-src/amlabel.c
	  restore-src/amidxtaped.c restore-src/amfetchdump.c:
	  remove RUNNING_WITHOUT_SETUID and change RUNNING_AS_SETUID_ROOT
	  to RUNNING_AS_UID_ONLY (with corresponding checks for root-ness)
	* client-src/calcsize.c: drop root privs immediately, and only
	  regain them for stat() and opendir() operations

2007-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/property.c device-src/property.h: create VERBOSE property

2007-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/device.h device-src/queueing.h: expand comments
	* tape-src/output-rait.h tape-src/output-null.c 
	  tape-src/output-null.h tape-src/output-file.c 
	  tape-src/output-file.h tape-src/output-tape.c 
	  tape-src/output-tape.h tape-src/output-rait.c: add deprecation
	  comment

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* changer-src/chg-zd-mtx.sh.in: Don't pass stripped device names back
	  to Amanda.

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* changer-src/chg-mtx.sh.in, changer-src/chg-manual.sh.in,
	  changer-src/chg-zd-mtx.sh.in, changer-src/chg-juke.sh.in,
	  changer-src/chg-chs.sh.in, changer-src/chg-multi.sh.in: Don't use
	  ammt for anything; use system mt and only for device operations that
	  require it.
	* changer-src/chg-lib.sh.in: Support for above change.

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* device-src/tape-device.c: Fix a border case bug where
	  tape_device_robust_read() would abort when called with a buffer
	  exactly equal to the minimum read size.

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* device-src/tape-device.c: Use g_strdup() instead of strdup().

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* device-src/vfs-device.h, device-src/fd-device.c,
	  device-src/tape-device.c, device-src/Makefile.am,
	  device-src/fd-device.h, device-src/tape-device.h,
	  device-src/vfs-device.c: Delete the FdDevice and make TapeDevice
	  and VfsDevice direct descendants of Device. Also, correct all
	  reading and writing of volume and part labels for both drivers.
	* server-src/amcheck.c: Unlabeled tapes are OK, at least with
	  label_new_tapes_option.

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* server-src/taperscan.c: Fix the order of arguments to
	  scan_read_label(). Patch by Dustin J. Mitchell <dustin@zmanda.com>.

2007-09-25  Jean-Louis Martineau <martineau@zmanda.com> (merged by dustin@zmanda.com)
	* restore-src/restore.c: Change "no tapedev specified" message.

2007-09-25  Jean-Louis Martineau <martineau@zmanda.com> (merged by dustin@zmanda.com)
	* server-src/amtape.c: changer_label should be called only on success.

2007-09-25  Jean-Louis Martineau <martineau@zmanda.com> (merged by dustin@zmanda.com)
	* restore-src/restore.c: init cur_tapedev.

2007-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* gnulib/regenerate/regenerate gnulib/* config/gnulib/*: add
	  gnulib module 'fsusage'
	* common-src/statfs-test.c common-src/statfs.c
	  common-src/statfs.h common-src/Makefile.am: remove old statfs
	* client-src/selfcheck.c client-src/calcsize.c
	  server-src/amcheck.c server-src/driver.c: use fsusage instead of
	  statfs

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* common-src/alloc.c: Do away with debug_amfree(), which makes invalid
	  assumptions about the way system malloc() works.
	* common-src/amanda.h: Update definition of amtable_free() accordingly.

2007-09-25  Jean-Louis Martineau <martineau@zmanda.com> (merged by dustin@zmanda.com)
	* server-src/amadmin.c: Allow 'f' sort order.
	* server-src/find.c: Fix parsing of log files.
	* server-src/find.h (DEFAULT_SORT_ORDER): Set to "hkdlpbf".

2007-09-25  Jean-Louis Martineau <martineau@zmanda.com> (merged by dustin@zmanda.com)
	* server-src/driverio.h (sched_t): Split attempted in dump_attempted
					   and taper_attempted.
	* server-src/driver.c: Split attempted in dump_attempted
			       and taper_attempted.
	* server-src/driver.c (file_taper_result): Retry dump if INPUT-ERROR.

2007-09-25  Jean-Louis Martineau <martineau@zmanda.com> (merged by dustin@zmanda.com)
	* server-src/dumper.c (add_msg_data): Remove bogus handling of "
					      in mesg stream.

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* server-src/taper-file-source.c: If there's a problem reading the
	  holding disk, log the error as we get it from the OS.

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* server-src/taper-source.c, server-src/taper.c: Do the right thing
	  if the connection to dumper is severed before we recieve a header.

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* server-src/taper-source.c, server-src/taper-source.h,
	  server-src/taper-source-test.c, server-src/taper-port-source.c,
	  server-src/taper-port-source.h: Don't have TaperPortSource track
	  the control FD, and make it responsible for closing the data FD.
	* server-src/taper.c: ditto, plus close control socket correctly.

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* server-src/vfs-device.c: Fix a bug where all VFS device volumes
	  were thought unlabeled. Also do the right thing when there are
	  extra files in the VFS volume directory.
	* server-src/amlabel.c: Fail if there is a problem re-reading the
	  volume label.

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* device-src/device.c: Set the device name before reading the label.
	* device-src/fd-device.c: An invalid header indicates an unlabeled
	  volume, not a volume error.
	* device-src/taper-device.c: Insufficient buffer space causes
	  ENOMEM, not ENOSPC, at least on Linux.
	* server-src/amlabel.c: Correctly handle the case where
	  device_read_label() returns exactly 1 set bit.

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* server-src/taper-source.c, server-src/taper-disk-port-source.c,
	  server-src/taper.c: Be careful not to use strings from getcwd()
	  past the next invocation of getcwd().

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* device-src/vfs-device.c: Use old VFS device specification.

2007-09-25  Ian Turner <ian@zmanad.com> (merged by dustin@zmanda.com)
	* server-src/amlabel.c: Don't dump core on successful labeling.

2007-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tests/semaphore-test.c device-src/tests/Makefile.am:
	  test semaphore module
	* device-src/semaphore.c: bugfixes, optimizations
	* device-src/semaphore.h: inline documentation

2007-09-25  Nikhil Bandiwadekar <nikhil@zmanda.com> (merged by dustin@zmanda.com)
	* server-src/driver.c: Added quoting to directory name while logging
	    in statistics section
	* server-src/reporter.c: Handled quoted string for directory name in
	    statistics section

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* device-src/device.c, device-src/device.h, device-src/s3-device.c,
	  device-src/fd-device.c, device-src/tape-device.c,
	  device-src/vfs-device.c, device-src/rait-device.c: Implement new,
	  more nuanced device_read_label() interface.
	* server-src/amcheck.c, server-src/amtape.c, server-src/taperscan.c,
	  server-src/amlabel.c, restore-src/amrestore.c,
	  restore-src/restore.c: Use new interface.
	* common-src/glib-util.c, common-src/glib-util.h: New Flags->string
	  interface.
	* server-src/amdevcheck.c: New tool to check device/volume status.
	* man/xml-source/amdevcheck.8.xml: Document it.
	* server-src/Makefile.am: Add amdevcheck
	* man/Makefile.am: Add amdevcheck.8

2007-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/s3-device.c: adjust glib logging calls to match debug.h's
	  definitions.
	* common-src/debug.c: typo
	* common-src/debug.h: add definitions for g_info() and g_debug() if
	  they are missing

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	Thanks to Pavel Pragin <ppragin@zmanda.com> for finding these issues.
	* server-src/amtape.c: Update the changer database in 'amtape update'.
	  Thanks to Dustin J. Mitchell <dustin@zmanda.com> for this fix.
	* server-src/taperscan.c: Update the changer database during the
	  taper scan algorithm.

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	Thanks to Jean-Louis Martineau <martineau@zmanda.com> for these fixes:
	* server-src/dumper.c: Log packet to debug file.
	* server-src/planner.c: Improve quoting.
	* server-src/driver.c: Don't call free_serial if we still need it.
	* server-src/driver.c: Wait for dumper result if taper fail.
	* server-src/amstatus.pl.in: Improve parsing of initial schedule.

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* device-src/tape-device.c: Use the right default block size for
	  reading.

2007-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/vfs-device.c: add forgotten device_add_property() call

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* server-src/taper.c: Remove an erroneous assertion. Thanks to
	  Jean-Louis Martineau <martineau@zmanda.com> for noticing this issue.

2007-09-25  Patch by Jean-Louis Martineau <martineau@zmanda.com> (merged by dustin@zmanda.com)
	* server-src/driverio.h server-src/driver.c: Record
	  information from first PARTDONE result.  Remove duplicate
	  update_info_dumper.  Call update_info_taper as needed.

2007-09-25  Jean-Louis Martineau <martineau@zmanda.com> (merged by dustin@zmanda.com)
	* restore-src/restore.c: Don't send text to prompt_out if amidxtaped.

2007-09-25  Jean-Louis Martineau <martineau@zmanda.com> (merged by dustin@zmanda.com)
	* restore-src/amfetchdump.c: Fix a bug where amfetchdump will never
				     try to use the changer.

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* restore-src/amfetchdump.c: Fix a bug where amfetchdump will
	  still try to use the changer even with the -d parameter.

2007-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amadmin.8.xml server-src/amadmin.c: add an
	  'outd' column to 'amadmin CONF holding list -l', indicating
	  an "outdated" dump, and a '-d' option to list only outdated
	  holding disk files.  Outdated dumps are described in the
	  amadmin documentation.

2007-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* client-src/sendsize.c configure.in server-src/getconf.c
	  restore-src/amrestore.c restore-src/amfetchdump.c
	  common-src/util.c common-src/genversion.c common-src/util.h
	  common-src/debug.c common-src/error.c common-src/amanda.h
	  common-src/Makefile.am:
	  - support the glib logging infrastructure by feeding messages
	    into debug logs
	  - merge the error module into the debug module
	  - document debug.h with verbose comments
	  - call g_critical() for error() and g_error() for errordump()
	  - remove double dgettext() call in debug_printf
	  - remove --without-debugging (so debugging is always on)
	  - remove mostly unused debug prefix support
	  - remove onerror(), replacing its few uses with alternatives

2007-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tests/device_test.c configure.in
	  recover-src/extract_list.c recover-src/uparse.y
	  server-src/amlogroll.c server-src/dumper.c server-src/reporter.c
	  common-src/conffile.c common-src/amanda.h common-src/getcwd.c
	  common-src/getcwd.h common-src/Makefile.am: Replace calls
	  to safe_getcwd with calls to g_get_current_dir(), which
	  has the same signature and semantics.

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* restore-src/restore.c: Fix a bug where amfetchdump would not
	  restore anything when given the -p option. Thanks to Jean-Louis
	  Martineau <martineau@zmanda.com> for help in the development of
	  this patch.

2007-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: note that includefile can
	  take relative paths
	* server-src/amcleanupdisk.c: fix local variable shadowing 
	  config_dir

2007-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/holding.c (holding_walk_file): amfree(filename).

2007-09-25  John Franks <jrfranks@zmanda.com> (merged by dustin@zmanda.com)
	* man/Makefile.am: fixes for conditional compiles

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* common-src/conffile.c: Clean up some bad warning suppression and
	  obselete unused code.

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* example/config.site man/xml-source/amanda.conf.5.xml
	  device-src/device.c device-src/device.h device-src/property.c
	  device-src/fd-device.c device-src/tape-device.c
	  device-src/property.h device-src/tape-device.h
	  device-src/tape-ops.h server-src/amcheck.c server-src/amtape.c
	  server-src/taperscan.c server-src/taper.c server-src/amlabel.c
	  restore-src/amrestore.c restore-src/restore.c:
	  This patch adds a new property READ_BUFFER_SIZE which is used
	  only by the tape device. The VFS device still uses BLOCK_SIZE
	  for reading; other devices don't need the property.

2007-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amcheck.c: remove debugging message
	* device-src/tape-posix.c: fix compilation
	  errors when MTCOMPRESSION is not defined

2007-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* Makefile.am config/Makefile.am config/ax_create_stdint_h.m4i
	  autogen configure.in: remove AX_CREATE_STDINT_H
	* configure.in: add system-specific glib configuration
	* changer-src/scsi-cam.c device-src/device.c
	  device-src/device.h device-src/tests/device_test.c
	  device-src/rait-device.c server-src/amcheck.c
	  server-src/taper.c server-src/amlabel.c
	  restore-src/amrestore.c restore-src/restore.c
	  common-src/glib-util.c common-src/security-util.c
	  common-src/amanda.h common-src/krb4-security.c:
	  replace references to stdint types and defines with glib
	  equivalents

2007-09-25  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* device-src/s3.c, device-src/tape-device.c,
	  device-src/rait-device.c: Fix a number of compiler warnings, some
	  legimate, others not. Thanks to Dustin J. Mitchell
	  <dustin@zmanda.com> and Jean-Louis Martineau <martineau@zmanda.com>
	  for help identifying warnings that need fixing.

2007-09-25  Dustin J. Mitchell <dustin@zmanda.com>
	* man/xml-source/amcleanup.8.xml server-src/amcleanupdisk.c
	  server-src/amcleanup.sh.in: add -v option for verbose output
	* server-src/holding.c server-src/holding.h: rewrite 
	  implementation of the holding API to use functors
	* server-src/driver.c: modifications to holding API changes

2007-09-24  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* device-src/device.c: Suppress a compiler warning.

2007-09-24  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* device-src/device.h, device-src/device.c, device-src/fd-device.c,
	  device-src/tape-device.c, device-src/vfs-device.c,
	  device-src/rait-device.c: Update the seek_file API skip missing
	  files. Thanks to Dustin J. Mitchell <dustin@zmanda.com> and
	  Jean-Louis Martineau <martineau@zmanda.com> for help with this patch.
	* restore-src/restore.c: Use the new API.

2007-09-24  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* client-src/Makefile.am, device-src/tests/Makefile.am,
	  device-src/Makefile.am, configure.in, common-src/Makefile.am,
	  tape-src/Makefile.am: Use AM_CFLAGS and LDFLAGS when
	  compiling. These changes by Dustin J. Mitchell <dustin@zmanda.com>.
	* device-src/device.c, device-src/null-device.c,
	  device-src/device.c, device-src/queueing.c, device-src/property.c,
	  device-src/fd-device.c, device-src/s3-device.c,
	  device-src/semaphore.h, device-src/property.h,
	  device-src/vfs-device.c: Fix compiler warnings revealed by above
	  change. Thanks to Jean-Louis Martineau Jean-Louis Martineau
	  <martineau@zmanda.com> for help with these fixes.

2007-09-24  Dustin J. Mitchell <dustin@zmanda.com>
	* restore-src/restore.c restore-src/restore.h:
	Allow NULLs in arguments to dump_match(); make it a static
	function.

2007-09-24  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/device.c device-src/vfs-device.h
	  device-src/rait-device.h device-src/device.h
	  device-src/null-device.c device-src/tape-aix.c
	  device-src/tape-uware.c device-src/null-device.h
	  device-src/tape-xenix.c device-src/queueing.c
	  device-src/semaphore.c device-src/property.c
	  device-src/fd-device.c device-src/tape-device.c 
	  device-src/queueing.h device-src/semaphore.h
	  device-src/property.h device-src/tape-posix.c
	  device-src/fd-device.h device-src/tape-device.h
	  device-src/vfs-device.c device-src/rait-device.c
	  device-src/tape-ops.h common-src/glib-util.c
	  common-src/glib-util.h: restrict to GPLv2

2007-09-24  John Franks <jrfranks@zmanda.com> (merged by dustin@zmanda.com)
	* Correct Cygwin build errors:
	  common-src/Makefile.am
	  common-src/amanda.h

2007-09-24  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/cmdline.c server-src/planner.c server-src/amadmin.c
	  server-src/amcleanupdisk.c server-src/amflush.c
	  server-src/holding.c server-src/holding.h server-src/driver.c
	  server-src/find.c common-src/glib-util.c common-src/glib-util.h:
	  remove 'verbose' flag, remove holding directories from API (they 
	  will be gone soon anyway), and rework the holding module to use 
	  glib data structures

2007-09-24  Dustin J. Mitchell <dustin@zmanda.com>
	* gnulib/regenerate/regenerate gnulib/Makefile.am
	  device-src/tests/Makefile.am device-src/Makefile.am
	  server-src/taper-mem-port-source.c server-src/taper.c
	  config/gnulib/gnulib-comp.m4 config/gnulib/gnulib-cache.m4
	  config/gnulib.m4i common-src/physmem.c common-src/physmem.h
	  common-src/amanda.h common-src/base64.c common-src/Makefile.am
	  common-src/base64.h: move base64, physmem into gnulib and set
	  device API to include libgnu.

2007-09-24  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/Makefile.am: remove redundant use of EXTRA_DIST

2007-09-24  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/device.c device-src/tests/device_test.c
	  device-src/rait-device.c server-src/amcheck.c
	  server-src/amtape.c server-src/taperscan.c server-src/taper.c
	  server-src/amlabel.c restore-src/restore.c: device_open() no
	  longer free()s the device name it is given.

2007-09-24  Dustin J. Mitchell <dustin@zmanda.com>
	* restore-src/restore.c: fix uninitialized value error

2007-09-24  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/changer.c server-src/amindexd.c
	  restore-src/amidxtaped.c common-src/debug.c common-src/amanda.h
	  common-src/alloc.c: fix support for builds without --with-debugging

2007-09-24  Dustin J. Mitchell <dustin@zmanda.com>
	* device-src/tests/queue_test.c: simplify signal handling to
	  be more portable

2007-09-24  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/cmdline.c server-src/cmdline.h:
	  Optionally parse datestamps and levels
	* server-src/amadmin.c: pass flags to cmdline functions
	* server-src/find.c restore-src/amidxtaped.c
	  restore-src/amrestore.c restore-src/restore.c
	  restore-src/restore.h restore-src/amfetchdump.c:
	  Use cmdline module in amrestore, amidxtaped, and amfetchdump

2007-09-24  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* restore-src/amrestore.c: Fix a segmentation fault that occurs
	  when the user specifies hostname, diskname, and date. Thanks to
	  Jean-Louis Martineau <martineau@zmanda.com> for finding and 
	  fixing this bug.

2007-09-24  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* device-src/device.c (device_set_startup_properties_from_config):
	  Use tapetype parameters as well as device_property directives.
	* device-src/device.h: ditto.
	* common-src/conffile.c: Use a new macro DEFAULT_TAPE_LENGTH
	  as default tapetype length.
	* common-src/conffile.h: ditto.
	* restore-src/amrestore.c: Use new interface to
	  devic_set_startup_properties_from_config().
	* restore-src/restore.c: ditto.
	* server-src/amcheck.c: ditto.
	* server-src/amlabel.c: ditto.
	* server-src/amtape.c: ditto.
	* server-src/taper.c: ditto.
	* server-src/taperscan.c: ditto.

2007-09-24  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* server-src/amcheck.c: Return 0 if everything is good with the
	  tape. Thanks to Dustin Mitchell <dustin@zmanda.com> for 
	  reporting this issue, and to Jean-Louis Martineau 
	  <martineau@zmanda.com> for suggesting the form of the fix.

2007-09-24  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* server-src/restore.c: Only restore files matching requested
	  disknames. Report and patch by Jean-Louis Martineau
	  <martineau@zmanda.com>.

2007-09-24  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* server-src/restore.c: Drop some globals, use data types
	  responsibly.
	
2007-09-24  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* server-src/taper.c: Be slightly more rigorous in sanity-checking
	  the expected number of splits.
	* server-src/taper-file-source.c: Correctly predict the number
	  of splits.
	
2007-09-24  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* device-src/vfs-device.c: Accept device names without a
	  terminating '/'.
	
2007-09-24  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	Merge in new Device API. Thanks to Jean-Louis and Dustin for their
	code contributions to this patch.

2007-09-20  Dustin J. Mitchell <dustin@zmanda.com>
	* oldrecover-src/extract_list.c recover-src/extract_list.c: 
	  change stralloc2 to newstralloc2 to avoid possible memory
	  leak (coverity bug #214)

2007-09-17  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/client_util.c: Parse kencrypt in option string.
	* client-src/sendbackup.c: Send KENCRYPT keyword in REP packet.
	* client-src/client_util.h: Add kencrypt field in option_t.
	* amandad-src/amandad.c: Enable kencrypt.
	* server-src/dumper.c: Enable kencrypt.
	* common-src/security.h (accept): New prototype, add conf_fn and datap.
	* common-src/bsdtcp-security.c (bsdtcp_accept): Use new param.
	* common-src/ssh-security.c (ssh_connect): Set rh->rc->conf_fn and
						   rh->rc->datap
	* common-src/security-util.c (sec_accept): Set rc->conf_fn and
						   rc->datap
	* common-src/amanda.h (kencrypt_type): New enum.
	* common-src/bsdudp-security.c (bsdudp_accept): Use new param.
	* common-src/security-util.h (sec_accept): New prototype.
	* common-src/krb5-security.c: encryption enabled based on kencrypt.
	* common-src/bsd-security.c (bsd_accept):  Use new param.

2007-09-14  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/util.c common-src/util.h: add euid checks to
	  check_running_as
	* client-src/runstar.c client-src/noop.c client-src/runtar.c
	  client-src/sendbackup.c client-src/killpgrp.c
	  client-src/sendsize.c client-src/selfcheck.c
	  client-src/rundump.c client-src/calcsize.c
	  amandad-src/amandad.c configure.in server-src/amlogroll.c
	  server-src/amindexd.c server-src/dumper.c server-src/planner.c
	  server-src/chunker.c server-src/amadmin.c server-src/amtape.c
	  server-src/amcleanupdisk.c server-src/amflush.c
	  server-src/amtrmlog.c server-src/amdevcheck.c
	  server-src/driver.c server-src/reporter.c server-src/taper.c
	  server-src/amtrmidx.c server-src/amlabel.c
	  restore-src/amidxtaped.c restore-src/amfetchdump.c: use them
	* common-src/krb5-security.c: remove unused variable

2007-09-14  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/getconf.c: Don't check running_as in amgetconf, as
	  it may not have a configuration file (e.g., for build params)

2007-09-12  Dustin J. Mitchell <dustin@zmanda.com>
	Bug identified by Satya Ganga <gsat@zmanda.com>
	* common-src/util.c: handle bad call to check_running_as correctly

2007-09-11  Dustin J. Mitchell <dustin@zmanda.com>
	Bug reported by Bill Bartlett; patch by Jean-Louis Martineau
	<martineau@zmanda.com>
	* common-src/statfs.c: fix error in available-space calculations

2007-09-10  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amcheck.c: quiet compiler warnings when SINGLE_USERID is
	  defined

2007-09-10  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in: change FORCE_USERID to CHECK_USERID, add SINGLE_USERID
	  (when all of Amanda runs as the same userid) and WANT_SETUID_CLIENT
	  (clint binaries should be setuid-root), currently only used on
	  Cygwin.
	* common-src/util.c common-src/util.h: utility functions for userid
	  checks and manipulations
	* oldrecover-src/amrecover.c client-src/runstar.c
	  client-src/noop.c client-src/runtar.c client-src/sendbackup.c
	  client-src/killpgrp.c client-src/sendsize.c
	  client-src/selfcheck.c client-src/rundump.c
	  client-src/calcsize.c amandad-src/amandad.c
	  recover-src/amrecover.c server-src/amlogroll.c
	  server-src/amindexd.c server-src/amcheck.c server-src/dumper.c
	  server-src/planner.c server-src/chunker.c server-src/amadmin.c
	  server-src/amtape.c server-src/amcleanupdisk.c
	  server-src/getconf.c server-src/amflush.c server-src/amtrmlog.c
	  server-src/amdevcheck.c server-src/driver.c
	  server-src/reporter.c server-src/taper.c server-src/amdump.sh.in
	  server-src/amtrmidx.c server-src/amlabel.c common-src/genversion.c 
	  restore-src/amidxtaped.c restore-src/amfetchdump.c
	  common-src/bsdtcp-security.c common-src/bsdudp-security.c
	  common-src/krb5-security.c common-src/krb4-security.c
	  common-src/bsd-security.c: use utility functions to check userids.

2007-09-07  Dustin J. Mitchell <dustin@zmanda.com>
	Change by Paul Bijnens
	* man/xml-source/amanda.conf.5.xml: Clarify 'etimeout'

2007-09-07  Dustin J. Mitchell <dustin@zmanda.com>
	* gnulib/regenerate/no-error.patch gnulib/Makefile.am: remove
	  spurious sign-compare warnings from gnulib

2007-09-05  Dustin J. Mitchell <dustin@zmanda.com>
	Bug identified downstream in Debian packaging
	* changer-src/chg-null.sh.in: fix typo

2007-08-29  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/genversion.c common-src/Makefile.am: add subversion revision 
	  and branch info to 'amadmin x version'

2007-08-23  Dustin J. Mitchell <dustin@zmanda.com>
	sf bug #1775316 reported by joerg <altix@users.sourceforge.net>
	* configure.in: use 'sed' instead of shell substitutions to C-quote
	  ssh arguments

2007-08-22  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/Makefile.am: adjust dependencies so that 'make dist' can
	  run without a 'make all'

2007-08-20  Dustin J. Mitchell <dustin@zmanda.com>
	* client-src/sendbackup-gnutar.c client-src/sendsize.c: use
	  sanitized, canonicalized, and quoted filenames where necessary
	* server-src/driver.c: quote diskname in logfile
	* common-src/amanda.h common-src/file.c: Add ':' to the list
	  of characters sanitised when constructing filenames from
	  disknames; add canonicalize_pathname()

2007-08-14  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amanda.h common-src/util.h: move readline headers
	  out of amanda.h and into util.h, since the corresponding
	  functions are in util.c
	* common-src/util.c: comments
	* configure.in: check for both headers and libraries and define
	  HAVE_READLINE if both are found; add new --with-readline
	  to require readline and --without-readline to not search
	  for it at all.
	* oldrecover-src/Makefile.am recover-src/Makefile.am: remove explicit
	  use of READLINE_LIBS

2007-08-09  Dustin J. Mitchell <dustin@zmanda.com>
	Patch by C R Ritson <c.r.ritson@newcastle.ac.uk>
	* server-src/amverifyrun.sh.in: "lock" the logfile by creating a 
	  symlink.

2007-08-06  Dustin J. Mitchell <dustin@zmanda.com>
	* example/DLT-A4.ps example/Makefile.am: add new template contributed
	  by Terry Burton <tez@terryburton.co.uk>.

2007-08-01  Dustin J. Mitchell <dustin@zmanda.com>
	Patch by Satya Ganga <gsat@zmanda.com>
	* server-src/amcleanup.sh.in: shell-compatibility fixes for bash-2.03
	  (Solaris 8)

2007-07-31  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/statfs-test.c common-src/statfs.c common-src/statfs.h
	  common-src/Makefile.am: Add a statfs-test to make sure that
	  statfs works on target systems.

2007-07-27  Ian Turner <ian@zmanda.com>
	* restore-src/amfetchdump.c: Check for required arguments in
	  all cases.

2007-07-27  Dustin J. Mitchell <dustin@zmanda.com>
	* config/automake/check-perl.am: new automake fragment to check perl scripts
	* config/automake/check-shell.am: new automake fragment to check shell scripts
	* configure.in changer-src/Makefile.am client-src/Makefile.am dumper-src/Makefile.am
	  server-src/Makefile.am common-src/Makefile.am: use new checks
	* changer-src/chg-lib.sh.in: add newline for Solaris's 'bash'
	* changer-src/chg-chs.sh.in changer-src/chg-mcutil.sh.in: fix errors found by
	  new checks

2007-07-26  Ian Turner <ian@zmanda.com>
	* restore-src/restore.c: If tpchanger is not defined, then (duh)
	  don't use the changer. This patch by Jean-Louis Martineau 
	  <martineau@zmanda.com>.

2007-07-24  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-lib.sh.in common-src/amanda-sh-lib.sh.in
	  configure.in common-src/Makefile.am: new general-purpose
	  shell-script library
	* configure.in: check for prog 'gettext'
	* changer-src/chg-null.sh.in
	  changer-src/chg-manual.sh.in changer-src/chg-disk.sh.in
	  changer-src/chg-juke.sh.in changer-src/chg-rait.sh.in
	  changer-src/chg-chs.sh.in changer-src/chg-mcutil.sh.in
	  amplot/amplot.sh.in client-src/patch-system.sh.in
	  server-src/amcheckdb.sh.in server-src/amverifyrun.sh.in
	  server-src/amrmtape.sh.in server-src/amverify.sh.in
	  server-src/amfreetapes.sh.in server-src/amcleanup.sh.in
	  server-src/amdump.sh.in common-src/amcrypt-ossl-asym.sh.in
	  common-src/amcrypt.sh.in common-src/amaespipe.sh.in
	  common-src/amcrypt-ossl.sh.in: use new library to function
	  correctly even when gettext is missing.

2007-07-23  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Set MaxWidth for numerical value
	* server-src/reporter.c: Calculate the size if a numerical value.

2007-07-20  Jean-Louis Martineau <martineau@zmanda.com>
        Patch by Dimitri Gorokhovik
        * changer-src/chg-multi.sh.in: Typo.

2007-07-18  Ian Turner <ian@zmanda.com> (merged by dustin@zmanda.com)
	* changer-src/chg-lib.sh.in, changer-src/chg-zd-mtx.sh.in: Correctly
	  accept the use of tape:/dev/nst0 notation in chg-zd-mtx.

2007-07-18  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/reporter.c: fix reporting of STRANGE messages

2007-07-16  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-zd-mtx.sh.in: check for validity of 'mt' and 'mtx'
	  binaries early, and produce appropriate error messages

2007-07-13  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in: add /usr/sfw/bin to SYSPATH for Solaris 10

2007-07-13  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-lib.sh.in: Remoce duplicate amdd, add ammt.

2007-07-12  Dustin J. Mitchell <dustin@zmanda.com>
	* autogen config/Makefile.am config/ax_compare_version.m4i
	  Makefile.am: new m4 file
	* config/docbook-xslt-min.m4i config/docbook-dtd.m4i
	  config/docbook-xslt.m4i: major bug fixing

2007-07-11  Dustin J. Mitchell <dustin@zmanda.com>
	* recover-src/amrecover.c recover-src/extract_list.c: Add detailed
	  logging of the amrecover user conversation.

2007-07-11  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Paul Bijnens
	* changer-src/chg-multi.sh.in: Typo.

2007-07-10  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in: an empty 'MAILER' is no longer an error, just a
	  warning
	* changer-src/chg-manual.sh.in changer-src/chg-scsi-chio.c
	  changer-src/chg-scsi.c server-src/amverify.sh.in
	  server-src/getconf.c common-src/genversion.c: conditionalize
	  references to MAILER, to handle the situation when it is not
	  set.

2007-07-09  Dustin J. Mitchell <dustin@zmanda.com>
	Documentation patch as suggested by Chris Hoogendyk and Olivier
	Nicole.
	* man/xml-source/amanda.8.xml: add better documentation about the 
	  -o command-line option for configuration override.

2007-07-09  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c: Don't do superfluous fsf,
				 improve error handling.

2007-07-05  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amadmin.c: correct misalignment of 'amadmin x balance'
	  output, as reported by Stefan G. Weichinger <sgw@amanda.org>.

2007-07-03  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/amanda.h common-src/amflock.c: remove unused 
	  CONFIGURE_TEST conditionals

2007-06-28  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/security-util.c: Change authorization error message to
	"Please add the line "HOST USER SERVICE" to AMANDAHOSTS on the client"
	as suggested by Paddy Sreenivasan <paddy@zmanda.com>.

2007-06-28  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in common-src/amflock-flock.c
	  common-src/amflock-posix.c common-src/amanda.h
	  common-src/amflock-lockf.c common-src/amflock-test.c
	  common-src/amflock-lnlock.c common-src/amflock.c
	  common-src/amflock.h common-src/Makefile.am:
	  refactor file locking support into multiple implementations,
	  only test for availability (not functionality) at configure
	  time, and add a 'make check' test script.  Fixes a bug reported
	  by Paul Crittenden.  Chris Hoogendyk, Jon LaBadie, and Jean-Louis
	  Martineau helped track it down.

2007-06-27  Dustin J. Mitchell <dustin@zmanda.com>
	* autogen config/ax_create_stdint_h.m4i config/acinclude.m4i
	  Makefile.am: use updated version of ax_create_stdint_h.m4
	  from http://autoconf-archive.cryp.to/ax_create_stdint_h.html.
	  Original by Guido U. Draheim <guidod@gmx.de>, patched locally
	  to avoid spurious "command not found" on Solaris 10.
	* config/Makefile.am: add ax_create_stdint_h.m4i

2007-06-25  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/cmdline.c server-src/cmdline.h server-src/taperscan.c
	  server-src/taperscan.h config/docbook-dtd.m4i
	  config/docbook-xslt-min.m4i config/docbook-xslt.m4i
	  config/xsltproc.m4i common-src/sockaddr-util.c
	  common-src/sockaddr-util.h common-src/amaespipe.sh.in:
	  restrict to GPLv2

2007-06-25  Dustin J. Mitchell <dustin@zmanda.com>
	* client-src/sendbackup.c client-src/killpgrp.c
	  client-src/sendsize.c client-src/selfcheck.c
	  server-src/amcheck.c server-src/reporter.c common-src/util.c
	  common-src/util.h common-src/security-util.c: add str_exit_status()
	  to interpret the status resulting from wait(), use it throughout
	  the codebase.

2007-06-20  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/planner.c common-src/bsdudp-security.c
	  common-src/krb5-security.c common-src/bsd-security.c:
	  remove dead/unused code

2007-06-20  Dustin J. Mitchell <dustin@zmanda.com>
	* client-src/sendsize.c: call dbfn(), not debug_fn()
	* common-src/amanda.h: make dbfn() return a meaningful string
	  when debugging is disabled

2007-06-19  Dustin J. Mitchell <dustin@zmanda.com>
	* tape-src/tapetype.c: close and re-open tape after rewind
	  (patch from Franz Fischer <amanda@franz-fischer.de>, modified
	  by Jean-Louis Martineau <martineau@zmanda.com>)

2007-06-06  Jean-Louis Martineau <martineau@zmanda.com>
        * restore-src/restore.c: accept all header with size >= DISK_BLOCK_BYTES

2007-06-18  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl.in: Set and use chunk_time.

2007-06-07  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amcleanupdisk.c: don't try to clean up holding disks
	  if they are empty.

2007-06-06  Dustin J. Mitchell <dustin@zmanda.com>
	* client-src/sendbackup.c: remove bogus check for unknown program

2007-06-07  Jean-Louis Martineau <martineau@zmanda.com>
	Christopher McCrory found the cause of the problem.
	* server-src/find.c: Send ouput to stderr.

2007-06-07  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in: detect GNU tar's 'backup' and ignore it.  Thanks
	  to Jeanna Geier <jeanna@webteam.net> for spotting this.

2007-06-05  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c: Don't use -w flags for od execution.

2007-06-05  Dustin J. Mitchell <dustin@zmanda.com>
	* client-src/selfcheck.c: fix formatting typo
	* common-src/security.h: fix prototypes in comments
	* common-src/security-util.c common-src/util.c: fix 
	  vstralloc errors
	* common-src/debug.c common-src/amanda.h: remove 
	  debug_prefix_time
	* changer-src/scsi-linux.c changer-src/chg-scsi-chio.c
	  changer-src/scsi-cam.c client-src/calcsize.c
	  recover-src/amrecover.c server-src/driver.c
	  client-src/sendbackup-gnutar.c server-src/find.c
	  server-src/diskfile.c : format string / i18n tweaks
	* common-src/amcrypt-ossl.sh.in: fix shell quoting

2007-06-04  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/sense.c server-src/driver.c server-src/reporter.c
	  server-src/amadmin.c server-src/amtape.c common-src/amanda.h:
	  use T_() instead of _T() as the macro flagging static strings
	  in need of translation; fixes compilation error on Mac OS X, where
	  _T is defined in the system headers.

2007-06-04  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-zd-mtx.sh.in changer-src/chg-multi.sh.in:
	  use chg-lib.sh fully, fix i18n problems.

2007-06-04  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/krb5-security.c common-src/bsdtcp-security.c
	  common-src/security-util.c: check results from getnameinfo()
	  correctly

2007-06-04  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amstatus.pl.in: use perl flags -Tw

2007-06-04  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/debug.c common-src/error.c: fix compilation errors
	  on strict platforms.

2007-06-04  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsd-security.c common-src/bsdudp-security.c: 
	  Make bsd, bsdudp open an IPv4 and an IPv6 socket; fixes bug reported
	  by Marc Muehlfeld.

2007-06-04  Dustin J. Mitchell <dustin@zmanda.com>
	* oldrecover-src/Makefile.am changer-src/Makefile.am
	  amplot/Makefile.am client-src/Makefile.am
	  amandad-src/Makefile.am dumper-src/Makefile.am
	  recover-src/Makefile.am restore-src/Makefile.am
	  tape-src/Makefile.am: add quotes to allow spaces in user
	  and group names

2007-06-04  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-scsi.c: use long int for tape sleep time
	* client-src/selfcheck.c: error out if no calcsize program is found
	* server-src/amindexd.c: run 'sort' in the C locale
	* server-src/amcheck.c: flag localhost not resolving as an error
	* server-src/diskfile.c: improve error handling
	* common-src/amcrypt.sh.in common-src/amcrypt-ossl-asym.sh.in
	  common-src/amcrypt-ossl.sh.in: search /opt/csw/bin for openssl
	  binaries; improve error handling

2007-06-04  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/planner.c server-src/amcleanupdisk.c
	  server-src/amflush.c server-src/holding.c server-src/holding.h:
	  do not assume anything about the names of holding
	  directories; use holding disk files themselves to discover
	  dump time/datestamps

2007-06-04  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/krb5-security.c: Typo.

2007-06-01  Ian Turner <ian@zmanda.com>
	* restore-src/restore.c: Set flags->fsf = 0 by default.

2007-05-29  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Check dumper->down.
	* server-src/dumper.c (sendbackup_response): Only call
	  security_close_connection if pkt != NULL.

2007-05-29  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl.in: Use compressed size.

2007-05-29  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Don't report overwrite if no label.

2007-05-29  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-manual.sh.in: Don't reset the slot to 0 on eject.

2007-05-25  Kevin Till <ktill@zmanda.com>
	* example/amanda.conf.in: ditto
	* man/xml-source/amanda.conf.5.xml: ditto
	* common-src/conffile.c: ditto

2007-05-24  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/scsi-changer-driver.c changer-src/scsi-cam.c
	  client-src/sendbackup.c client-src/selfcheck.c
	  recover-src/extract_list.c server-src/amindexd.c
	  server-src/amcheck.c server-src/driver.c server-src/dumper.c
	  server-src/planner.c server-src/amadmin.c server-src/diskfile.c
	  contrib/set_prod_link.pl common-src/krb5-security.c
	  common-src/bsd-security.c common-src/security-util.c
	  common-src/conffile.c common-src/bsdudp-security.c:
	  trivial changes to add _(), etc. -- harmonization of branch
	  divergence caused by manual resolution of merge conflicts

2007-05-24  Satya Ganga <gsat@zmanda.com> (merged by dustin@zmanda.com)
	* server-src/amcleanup.sh.in: rewrite to find all the active
	process/children for a given configuration

2007-05-24  John Franks <jrfranks@zmanda.com> (merged by dustin@zmanda.com)
	* common-src/fileheader.c:
	  Remove ".exe" extension from program name is tape header.

2007-05-24  John Franks <jrfranks@zmanda.com> (merged by dustin@zmanda.com)
	* config/gettext-macros/gettext.m4
	config/gettext-macros/inttypes-pri.m4:
	  Change name gl_HEADER_INTTYPES_H to gl_AC_HEADER_INTTYPES_H

2007-05-24  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in: add configure.in recognition for Mac OS X

2007-05-24  John Franks <jrfranks@zmanda.com> (merged by dustin@zmanda.com)
	* configure.in: IPV6 on cygwin only partially works.
		Force WORKING_IPV6 to false.

2007-05-24  Kevin Till <ktill@zmanda.com> (merged by dustin@zmanda.com)
	* server-src/driver.c: use amanda text domain in driver

2007-05-24  John Franks <jrfranks@zmanda.com> (merged by dustin@zmanda.com)
	* config/libtool.m4i:
		Fix to pass loader variables correctly on Solaris systems
		with a gcc that does not use -static or -shared.

2007-05-24  Kevin Till <ktill@zmanda.com> (merged by dustin@zmanda.com)
	* server-src/amstatus.pl.in: parse directory and holding_disk_dir with
	  space correctly

2007-05-24  John Franks <jrfranks@zmanda.com> (merged by dustin@zmanda.com)
	* client-src/sendbackup.c client-src/sendsize.c client-src/sendbackup-star.c
	  configure.in server-src/amindexd.c server-src/taper.c server-src/diskfile.c
	  config/acinclude.m4i common-src/amanda.h common-src/util.c
	  common-src/security-util.c:
		Fix compilation problems using GCC on solaris.

2007-05-24  Jean-Louis Martineau <martineau@zmanda.com> (merged by dustin@zmanda.com)
	* server-src/reporter.c: Split FAILED and STRANGE section.

2007-05-23  John Franks <jrfranks@zmanda.com> (merged by dustin@zmanda.com)
	* common-src/conffile.c: Fix windows compilation warning.

2007-05-23  John Franks <jrfranks@zmanda.com> (merged by dustin@zmanda.com)
	* po/Makefile.am changer-src/scsi-changer-driver.c changer-src/sense.c
	  client-src/unctime.c server-src/amadmin.c server-src/amtape.c
	  server-src/driver.c server-src/reporter.c common-src/amanda.h
	  tape-src/tapeio.h tape-src/tapetype.c:
		Change _() gettext macro to call gettext()
		Create _T() to allow gettext translation of static strings.
	* common-src/security.c:  Create larger buffers for error messages.

2007-05-23  John Franks <jrfranks@zmanda.com> (merged by dustin@zmanda.com)
	* configure.in: Prevent annoying lint usage message from
	  being displayed in configure console output.

2007-05-23  John Franks <jrfranks@zmanda.com> (merged by dustin@zmanda.com)
	* autogen:
		Fix problem of not generating po/Makefile.in on fresh checkout.
	* server-src/logfile.c:
		Always output to logfile in "C" locale.
	* amandad-src/amandad.c changer-src/chg-scsi-chio.c
	  changer-src/chg-scsi.c client-src/calcsize.c client-src/getfsent.c
	  client-src/killpgrp.c client-src/noop.c client-src/rundump.c
	  client-src/runstar.c client-src/runtar.c client-src/selfcheck.c
	  client-src/sendbackup.c client-src/sendsize.c
	  client-src/versionsuffix.c common-src/amfeatures.c
	  common-src/amflock.c common-src/file.c common-src/genversion.c
	  common-src/statfs.c common-src/token.c oldrecover-src/amrecover.c
	  recover-src/amrecover.c restore-src/amfetchdump.c
	  restore-src/amidxtaped.c restore-src/amrestore.c server-src/amadmin.c
	  server-src/amcheck.c server-src/amcleanupdisk.c server-src/amflush.c
	  server-src/amindexd.c server-src/amlabel.c server-src/amlogroll.c
	  server-src/amtape.c server-src/amtrmidx.c server-src/amtrmlog.c
	  server-src/chunker.c server-src/diskfile.c server-src/driver.c
	  server-src/dumper.c server-src/getconf.c server-src/infofile.c
	  server-src/planner.c server-src/reporter.c server-src/taper.c
	  tape-src/amdd.c tape-src/ammt.c tape-src/tapeio.c tape-src/tapetype.c:
	  	Change back to always run in "C" locale.

2007-05-23  Jean-Louis Martineau <martineau@zmanda.com> (merged by dustin@zmanda.com)
	* changer-src/chg-manual.sh.in: Fix quoting; fix gettext usage.

2007-05-23  John Franks <jrfranks@zmanda.com> (merged by dustin@zmanda.com)
	* configure.in:
		New gettext routines.
	* server-src/amcheckdb.sh.in server-src/amcleanup.sh.in
	  server-src/amverifyrun.sh.in server-src/amrmtape.sh.in
	  server-src/amverify.sh.in server-src/amdump.sh.in
	  server-src/amfreetapes.sh.in amplot/amplot.sh.in
	  changer-src/chg-mtx.sh.in changer-src/chg-null.sh.in
	  changer-src/chg-manual.sh.in changer-src/chg-zd-mtx.sh.in
	  changer-src/chg-disk.sh.in changer-src/chg-juke.sh.in
	  changer-src/chg-rait.sh.in changer-src/chg-scsi.c
	  changer-src/chg-chs.sh.in changer-src/chg-multi.sh.in
	  changer-src/chg-mcutil.sh.in client-src/patch-system.sh.in
	  common-src/amcrypt.sh.in common-src/amaespipe.sh.in
	  common-src/amcrypt-ossl-asym.sh.in common-src/amcrypt-ossl.sh.in:
		Internationalize shell messages
	* autogen config/gettext-macros/nls.m4
	  config/gettext-macros/lib-link.m4:
		Update for autoconf version 2.6 autogen
	* oldrecover-src/amrecover.c recover-src/amrecover.c
	  server-src/amflush.c server-src/logfile.c server-src/amtrmlog.c
	  server-src/amlogroll.c server-src/amindexd.c server-src/amcheck.c
	  server-src/driver.c server-src/dumper.c server-src/chunker.c
	  server-src/planner.c server-src/reporter.c server-src/amadmin.c
	  server-src/amtape.c server-src/taper.c server-src/server_util.c
	  client-src/versionsuffix.c client-src/runtar.c
	  server-src/amtrmidx.c server-src/amcleanupdisk.c
	  server-src/getconf.c server-src/diskfile.c
	  changer-src/chg-scsi-chio.c client-src/noop.c server-src/infofile.c
	  server-src/amlabel.c client-src/sendbackup.c client-src/getfsent.c
	  client-src/killpgrp.c client-src/sendsize.c client-src/selfcheck.c
	  client-src/rundump.c client-src/calcsize.c restore-src/amidxtaped.c
	  restore-src/amrestore.c restore-src/amfetchdump.c Makefile.am
	  amandad-src/amandad.c common-src/genversion.c common-src/debug.c
	  common-src/error.c common-src/statfs.c common-src/amflock.c
	  common-src/file.c common-src/token.c common-src/security-util.c
	  common-src/conffile.c common-src/amanda.h common-src/amfeatures.c
	  tape-src/ammt.c tape-src/amdd.c tape-src/tapeio.c
	  tape-src/tapetype.c:
		Use amanda domain for LC_MESSAGES.

2007-05-22  Maitreyee Karmarkar <maitreyee@zmanda.com> (merged by dustin@zmanda.com)
	* server-src/amcheck.c : Changed some amcheck messages
	* common-src/conffile.c : Changed some amcheck messages
	
2007-05-22  Maitreyee Karmarkar <maitreyee@zmanda.com> (merged by dustin@zmanda.com)
	* client-src/selfcheck.c, server-src/changer.c, server-src/amcheck.c,
	  server-src/taperscan.c, server-src/diskfile.c,
	  common-src/conffile.c:
	  Change in some amcheck error messages

2007-05-22   John Franks <jrfranks@zmanda.com> (merged by dustin@zmanda.com)
	* common-src/krb5-security.c common-src/security-util.c
	  server-src/taper.c server-src/taperscan.c:
		Fix botched *vstrallocf conversions.
	* oldrecover-src/extract_list.c server-src/amlogroll.c
	  server-src/chunker.c server-src/driver.c server-src/dumper.c
	  server-src/getconf.c server-src/holding.c server-src/planner.c
	  server-src/reporter.c server-src/taper.c:
		Add errno text when printing getcwd() error message.

2007-05-22  Kevin Till <ktill@zmanda.com> (merged by dustin@zmanda.com)
	* configure.in:	move crypt scripts to common-src since they are needed
	  by both server and client
	* common-src/Makefile.am: ditto
	* server-src/Makefile.am: ditto

2007-05-17   John Franks <jrfranks@zmanda.com> (merged by dustin@zmanda.com)
	* configure.in oldrecover-src/amrecover.c
	  oldrecover-src/extract_list.c oldrecover-src/display_commands.c
	  oldrecover-src/help.c oldrecover-src/set_commands.c
	  recover-src/amrecover.c recover-src/extract_list.c
	  recover-src/display_commands.c recover-src/help.c
	  recover-src/set_commands.c server-src/amflush.c
	  server-src/changer.c server-src/taperscan.c server-src/logfile.c
	  server-src/amtrmlog.c server-src/driverio.c
	  server-src/amlogroll.c server-src/tapefile.c
	  server-src/amindexd.c server-src/driver.c server-src/amcheck.c
	  server-src/dumper.c server-src/chunker.c server-src/planner.c
	  server-src/reporter.c server-src/server_util.c
	  server-src/amadmin.c server-src/amtape.c server-src/taper.c
	  server-src/amcleanupdisk.c server-src/find.c
	  server-src/amtrmidx.c server-src/getconf.c
	  server-src/diskfile.c server-src/infofile.c
	  server-src/amlabel.c changer-src/scsi-linux.c
	  changer-src/chg-scsi-chio.c changer-src/scsi-chio.c
	  changer-src/scsi-hpux.c changer-src/scsi-changer-driver.c
	  changer-src/scsi-cam.c changer-src/chg-scsi.c
	  changer-src/scsi-bsd.c changer-src/scsi-irix.c
	  changer-src/scsi-solaris.c changer-src/sense.c
	  changer-src/scsi-aix.c changer-src/scsi-hpux_new.c
	  autogen client-src/unctime.c client-src/versionsuffix.c
	  client-src/noop.c client-src/client_util.c client-src/runtar.c
	  client-src/sendbackup-gnutar.c client-src/getfsent.c
	  client-src/sendbackup.c client-src/sendbackup-dump.c
	  client-src/killpgrp.c client-src/sendsize.c
	  client-src/selfcheck.c client-src/rundump.c
	  client-src/calcsize.c client-src/amandates.c
	  restore-src/amidxtaped.c restore-src/amrestore.c
	  restore-src/restore.c restore-src/amfetchdump.c Makefile.am
	  amandad-src/amandad_util.c amandad-src/amandad.c
	  common-src/rsh-security.c common-src/pipespawn.c
	  common-src/security.c common-src/krb5-security.c
	  common-src/util.c common-src/genversion.c
	  common-src/bsdtcp-security.c common-src/debug.c
	  common-src/fileheader.c common-src/dgram.c
	  common-src/stream.c common-src/match.c
	  common-src/protocol.c common-src/ssh-security.c
	  common-src/statfs.c common-src/krb4-security.c
	  common-src/amflock.c common-src/bsd-security.c
	  common-src/file.c common-src/token.c common-src/event.c
	  common-src/security-util.c common-src/conffile.c
	  common-src/amanda.h common-src/bsdudp-security.c
	  common-src/alloc.c common-src/clock.c common-src/amfeatures.c
	  tape-src/ammt.c tape-src/amdd.c tape-src/output-file.c
	  tape-src/tapeio.c tape-src/tapeio.h tape-src/output-tape.c
	  tape-src/tapetype.c tape-src/output-rait.c:
	  o First stage of internationalization.
	    - Add GNU gettext to configuration.
	    - Add _() macro to flag translatable strings and modify
	      code to use it.  Macros like SSIZE_T_FMT are included in
	      this call, even though xgettext will not parse them; this
	      will be fixed later.
	    - Add plural() function for selecting singular or plural form
	      of string and modify code to use it.
	    - Add amanda.po target to Makefile.

2007-05-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Remove bogus amfree(newtapefile).

2007-05-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Check all tapelist filename.

2007-05-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c (read_datafd): Reset timeout after the write.

2007-05-17  Jean-Louis Martineau <martineau@zmanda.com>
	* amplot/amplot.sh.in: Remove function keyword.
	* changer-src/chg-lib.sh.in: Remove function keyword.
	* changer-src/chg-multi.sh.in: Remove function keyword.
	* changer-src/chg-zd-mtx.sh.in: Remove function keyword.

2007-05-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c: Fix double free.

2007-05-17  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amanda.h: define sockaddr_storage and ss_family.
	* common-src/amanda.h: define INET_ADDRSTRLEN.
	* config/acinclude.m4i (AC_SOCKADDR_STORAGE): New macro.
	* configure.in: AC_SOCKADDR_STORAGE.

2007-05-17  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amanda.h: Define AI_V4MAPPED and AI_ALL.

2007-05-17  Jean-Louis Martineau <martineau@zmanda.com>
	* util.c (cmp_sockaddr): un-map V4mapped address before comparison.
	* common-src/security-util.c: add debugging.

2007-05-17  Dustin J. Mitchell <dustin@zmanda.com> (merged by dustin@zmanda.com)
	* common-src/amanda.h: fix typo (missing 'extern') in erroutput_type

2007-05-16	John Franks <jrfranks@zmanda.com> (merged by dustin@zmanda.com)
	* oldrecover-src/amrecover.c oldrecover-src/extract_list.c
	  oldrecover-src/display_commands.c oldrecover-src/set_commands.c
	  recover-src/amrecover.c recover-src/extract_list.c
	  recover-src/display_commands.c recover-src/set_commands.c
	  server-src/changer.c server-src/taperscan.c
	  server-src/amtrmlog.c server-src/amindexd.c server-src/driver.c
	  server-src/amcheck.c server-src/dumper.c server-src/chunker.c
	  server-src/planner.c server-src/reporter.c server-src/taper.c
	  server-src/amtrmidx.c changer-src/scsi-linux.c
	  changer-src/chg-scsi-chio.c changer-src/scsi-chio.c
	  changer-src/scsi-hpux.c changer-src/scsi-cam.c
	  changer-src/scsi-changer-driver.c changer-src/chg-scsi.c
	  changer-src/scsi-bsd.c changer-src/scsi-irix.c
	  changer-src/scsi-solaris.c changer-src/sense.c
	  changer-src/scsi-aix.c changer-src/scsi-hpux_new.c
	  client-src/client_util.c client-src/runtar.c
	  client-src/sendbackup-gnutar.c client-src/sendbackup.c
	  client-src/sendbackup-dump.c client-src/killpgrp.c
	  client-src/sendsize.c client-src/selfcheck.c
	  client-src/rundump.c client-src/calcsize.c
	  client-src/amandates.c restore-src/amidxtaped.c
	  restore-src/restore.c amandad-src/amandad_util.c
	  amandad-src/amandad.c common-src/rsh-security.c
	  common-src/sockaddr-util.c common-src/pipespawn.c
	  common-src/security.c common-src/krb5-security.c
	  common-src/util.c common-src/util.h common-src/bsdtcp-security.c
	  common-src/tapelist.c common-src/debug.c common-src/fileheader.c
	  common-src/error.c common-src/dgram.c common-src/stream.c
	  common-src/protocol.c common-src/ssh-security.c
	  common-src/krb4-security.c common-src/bsd-security.c
	  common-src/event.c common-src/security-util.c
	  common-src/conffile.c common-src/amanda.h
	  common-src/bsdudp-security.c common-src/security-util.h
	  common-src/alloc.c tape-src/output-file.c tape-src/tapeio.c
	  tape-src/output-tape.c:
		- Change dbprintf() to use __VA_ARGS__. (Remove extra parens)
		- Prepend program name and nano second accuracy time stamp
		  to each line in debug file.
		- Emove any resulting duplicate timestamps from functions that
		  inserted them in each dbprintf() line.
		- Fix dballoc compilation.
		- Fix dbmalloc compilation.
		- Fix amfree() to report file and line # of amfree line during
		  errors.
		- Add vstrallocf() and newvstrallocf() functions. These are
		  the same as vstralloc() and newvstralloc() except they use
		  printf style format strings.  (Required to eliminate
		  untranslateable string concatenations in messages.)
		- Change files to use *allocf() functions where it seemed
		  appropriate..
		- Fix kerberos 4 compilation.
		- Fix kerberos 5 compilation.

2007-05-16  Jean-Louis Martineau <martineau@zmanda.com> (merged by dustin@zmanda.com)
	* common-src/debug.c (debug_rename): Fix for cygwin: rename
	  will not overwrite an existing file

2007-05-15   John Franks <jrfranks@zmanda.com> (merged by dustin@zmanda.com)
	* client-src/sendbackup.c common-src/dgram.c common-src/event.c
	  server-src/changer.c server-src/driverio.c:
		Cast FD_SETSIZE to int to avoid compilation problems.

2007-05-15   Kevin Till <ktill@zmanda.com> (merged by dustin@zmanda.com)
	* common-src/debug.c: dbrename patch by Jean-Louis Martineau to
	  unlink the target of the rename operation before renaming.

2007-05-15  Dustin J. Mitchell <dustin@zmanda.com>
	* client-src/sendsize.c: fix parsing of include/excludes for 
	  old clients

2007-05-11  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcrypt-ossl-asym.sh.in: Use CLIENT_LOGIN.
	* server-src/amcrypt-ossl.sh.in: Use CLIENT_LOGIN.

2007-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/krb5-security.c: Fix compilation.

2007-05-09	Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/stream.c: add errno's to stream_client_internal

2007-05-09	Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amadmin.c server-src/infofile.c
	  common-src/security-util.c common-src/krb5-security.c:
	  fix type-punning warnings

2007-05-09	Dustin J. Mitchell <dustin@zmanda.com>
	* recover-src/set_commands.c server-src/amcheck.c
	  server-src/dumper.c common-src/rsh-security.c
	  common-src/krb5-security.c common-src/util.c common-src/util.h
	  common-src/bsdtcp-security.c common-src/stream.c
	  common-src/ssh-security.c common-src/bsd-security.c
	  common-src/security-util.c common-src/bsdudp-security.c
	  common-src/security-util.h: Add IPv6-savvy resolve_hostname() and use it
	  everywhere

2007-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* config/Makefile.am (EXTRA_DIST): Add docbook-dtd.m4i,
	  docbook-xslt.m4i, docbook-xslt-min.m4i and xsltproc.m4i.

2007-05-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/stream.c: pass correct sockaddr size to bind()

2007-05-07  Pieter Bowman <bowman@math.utah.edu>
	* common-src/file.c: reverse the order of chown/chmod to correctly
	  create temporary files.

2007-05-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/krb5-security.c: Fix compilation.

2007-05-04  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/cmdline.c server-src/holding.c server-src/holding.h
	  server-src/amadmin.c server-src/amcleanupdisk.c: remove 
	  holding_file_read_header()

2007-05-04  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/sockaddr-util.h common-src/bsdtcp-security.c common-src/security-util.c
	  common-src/krb5-security.c common-src/stream.c: add and use a copy_sockaddr() macro

2007-05-04  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in common-src/rsh-security.c common-src/bsdtcp-security.c
	  common-src/ssh-security.c common-src/bsdudp-security.c
	  common-src/krb5-security.c common-src/krb4-security.c common-src/bsd-security.c
	  common-src/Makefile.am: use AM_CONDITIONAL to select security modules to compile

2007-05-04  Dustin J. Mitchell <dustin@zmanda.com>
	* autogen man/Makefile.am configure.in config/acinclude.m4i
	  config/docbook-xslt-min.m4i config/docbook-dtd.m4i config/docbook-xslt.m4i
	  config/xsltproc.m4i Makefile.am: detect xsltproc, docbook xslt, and docbook
	  dtd versions better, to ensure proper creation of manpages.

2007-05-04  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/amindexd.c common-src/sockaddr-util.c common-src/sockaddr-util.h
	  common-src/util.c common-src/security-util.c common-src/amanda.h
	  common-src/dgram.c common-src/stream.c common-src/Makefile.am: add new
	  sockaddr-util.[ch] containing sockaddr-related functions.

2007-05-04  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in: AM_INIT_AUTOMAKE(amanda, 2.5.3alpha)

2007-05-03  Jean-Louis Martineau <martineau@zmanda.com>
	* docs/*.txt: Update from xml-docs.

2007-05-03  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amrecover.8.xml: Fix space.

2007-05-03  Jean-Louis Martineau <martineau@zmanda.com>
	* Amanda 2.5.2 released.
	* configure.in: AM_INIT_AUTOMAKE(amanda, 2.5.2).

2007-05-02  Jean-Louis Martineau <martineau@zmanda.com>
	* docs/*.txt, man/xml-source/*.xml: Change OVERWRITE bu OVERRIDE.
	* man/xml-source/amadmin.8.xml: Add notees on no-reuse command.

2007-05-02  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Improve 'invalid service' message.

2007-05-01  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Report the error message.
	* recover-src/extract_list.c: Don't call close_connection.
	* common-src/security-util.c: (tcpm_close_connection): Check for rh->rc

2007-04-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c (tcp1_stream_client): Set rh->rc->driver.

2007-04-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsd-security.c, common-src/bsdudp-security.c,
	  common-src/krb4-security.c: Fix ntohs for port number.
	* common-src/dgram.c: Add socket number in comment.

2007-04-27  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/holding.c server-src/holding.h server-src/find.c:
	  use holding module in find.c:search_holding_disk()

2007-04-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Fix infobad setting.

2007-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Set *bad on error.

2007-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amflush.c: Quote L_DISK and FLUSH line.
	* server-src/driver.c: Parse quoted FLUSH line.
	* server-src/planner.c:  Quote L_DISK and FLUSH line.

2007-04-25  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in common-src/ssh-security.c: allow build-time configuration of SSH options

2007-04-23  Paddy Sreenivasan <paddy@zmanda.com>
	* changer-src/scsi-solaris.c common-src/protocol.c: changes to build on Solaris

2007-04-20  Dustin J. Mitchell <dustin@zmanda.com>
	* configure.in: remove unused AMANDA_C_VOLATILE
	* config/acinclude.m4: remove unused AMANDA_C_VOLATILE

2007-04-20  Dustin J. Mitchell <dustin@zmanda.com>
	* autogen: silence unnecessary warnings about GNU make, return exit status

2007-04-20  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/stream.c: retry socket creation if OS does not support IPv6
	  at runtime

2007-04-20  Jean-Louis Martineau <martineau@zmanda.com>
	* amplot/amplot.sh.in (test_awk,find_gnuplot): Imported from zmanda.
	* amplot/amplot.awk: Fix some parsing.
	* server-src/driver.c (free_kps): Return 0 instead of big value.

2007-04-18  Jean-Louis Martineau <martineau@zmanda.com>
	* oldrecover-src/Makefile.am, changer-src/Makefile.am,
	  client-src/Makefile.am, amandad-src/Makefile.am,
	  recover-src/Makefile.am, server-src/Makefile.am,
	  restore-src/Makefile.am: Link libgnu after libamanda.

2007-04-18  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Improve tar argument in amanda header for
				   extraction.

2007-04-18  Dustin J. Mitchell <dustin@zmanda.com>
	* man/Makefile.am configure.in config/acinclude.m4i: add xsltproc- and docbook-
	  related autoconf macros, use them to ensure the environment is appropriate for
	  building manpages; manpage build is off by default.

2007-04-17  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-disk.sh.in: Send error message to stdout.

2007-04-17  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-zd-mtx.sh.in: fix more typos (thanks to
	  "Stefan G. Weichinger" <sgw@amanda.org>)

2007-04-17  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c: Fix restoration of split and encrypted backup.

2007-04-13  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-zd-mtx.sh.in: fix typo in error message

2007-04-13  Jean-Louis Martineau <martineau@zmanda.com>
	* Amanda 2.5.2b1 released.
	* configure.in: AM_INIT_AUTOMAKE(amanda, 2.5.2b1).

2007-04-13  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c (first_num): Removed function.
	* client-src/sendbackup.c (the_num): return the nth number in a string.
	* client-src/sendbackup.h (AM_SIZE_RE): Need a field.
	* client-src/sendbackup-dump.c: Use new AM_SIZE_RE.
	* client-src/sendbackup-gnutar.c: Use new AM_SIZE_RE.

2007-04-13  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS: Change in amanda-2.5.2
	* ReleaseNotes: Releases Notes for 2.5.2
	* server-src/chunker.c (write_tapeheader): Set errno to ENOSPC.

2007-04-12  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/dumper.c: use fullwrite() instead of write()

2007-04-12  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Remove duplicate setsockopt(,,SO_REUSEADDR).
	* common-src/bsd-security.c: Use int for setsockopt.
	* common-src/stream.c (try_socksize): Use int for setsockopt.

2007-04-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Remove duplicate test.
	* server-src/dumper.c: Use newvstralloc.

2007-04-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Take value from chunker if it succeed and
				 taper fail.

2007-04-10  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in: Use krb5 shared library.

2007-04-10  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-zd-mtx.sh.in: remove configurability of mt, mtx paths

2007-04-10  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/krb5-security.c: Initialize rc->gss_context.

2007-04-09  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-zd-mtx.sh.in: fix bugs in configuration for mt, mtx paths

2007-04-06  Dustin J. Mitchell <dustin@zmanda.com>
	* oldrecover-src/extract_list.c oldrecover-src/display_commands.c
	  client-src/sendbackup.c client-src/getfsent.c client-src/sendsize.c
	  client-src/selfcheck.c recover-src/amrecover.c recover-src/extract_list.c
	  recover-src/display_commands.c server-src/amlogroll.c
	  server-src/amindexd.c server-src/tapefile.c server-src/amcheck.c
	  server-src/dumper.c server-src/planner.c server-src/reporter.c
	  server-src/amadmin.c server-src/find.c server-src/infofile.c
	  restore-src/amidxtaped.c common-src/security-util.c common-src/amanda.h:
	  improve parsing with strcmp_const and strcmp_const_skip

2007-04-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: Limit splitsize to 1G in PORT-WRITE.

2007-04-06  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/krb5-security.c: Report client hostname.

2007-04-06  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/tapelist.c (append_to_tape): Don't call dump_tapelist.

2007-04-05  Dustin J. Mitchell <dustin@zmanda.com>
	* contrib/macosx/org.amanda.amandad.bsd*.plist: updated to use username
	  'amandabackup'

2007-04-05  Dustin J. Mitchell <dustin@zmanda.com>
	* amplot/amplot.sh.in configure.in config/acinclude.m4i:
	  move checks for gnuplot, awk to runtime for easier packaging;
	  add fake gettext functions to ease the transition to
	  full gettext support

2007-04-05  Dustin J. Mitchell <dustin@zmanda.com> 
	* server-src/amindex.c: fix bug where debug fd was closed by safe_fd,
	  remove remote_hostname, rewrite to use getaddrinfo/getnameinfo
	* server-src/dumper.c server-src/amcheck.c recover-src/set_commands.c:
	  use getaddrinfo/getnameinfo
	* common-src/security-util.[ch]: add try_resolving_hostname()
	* common-src/ssh-security.c common-src/rsh-security.c:
	  use try_resolving_hostname, rewrite to avoid gethostbyname
	* common-src/krb5-security.c: use getaddrinfo instead of gethostbyname

2007-04-05  Dustin J. Mitchell <dustin@zmanda.com>
	* changer-src/chg-lib.sh.in changer-src/chg-mtx.sh.in
	  changer-src/chg-manual.sh.in changer-src/chg-zd-mtx.sh.in
	  changer-src/chg-multi.sh.in changer-src/Makefile.am
	  configure.in: make the path to MTX and other executables configurable
	  in changer scripts; introduce new changer shell library to reduce
	  code duplication; add fake gettext functions to ease the transition to
	  full gettext support

2007-04-04  Dustin J. Mitchell <dustin@zmanda.com>
	* server-src/dumper.c server-src/chunker.c: remove assumed ENOSPC
	  error in static write_tapeheader functions

2007-04-03  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Remove buggy &.

2007-04-03  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Add READBLOCKSIZE tapetype config option.
	* common-src/conffile.c(getconf_readblocksize): Function to retrieve
	  the tapetype readblocksize or the configured maxtapeblocksize.
	* common-src/conffile.h: Add READBLOCKSIZE tapetype config option.
	* man/xml-source/amanda.conf.5.xml: Document it.
	* tape-src/output-tape.c: Use getconf_readblocksize.
	* tape-src/tapeio.c: Use getconf_readblocksize.

2007-04-03  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsd-security.c, common-src/bsdtcp-security.c,
	  common-src/bsdudp-security.c,
	  common-src/security-util.c: Fix auth_debug and dbprintf usage.

2007-04-03  Jean-Louis Martineau <martineau@zmanda.com>
	Merge from zmanda ext.
	* man/xml-source/amadmin.8.xml man/xml-source/amanda.8.xml
	  server-src/amflush.c server-src/cmdline.c server-src/cmdline.h
	  server-src/holding.c server-src/holding.h server-src/driver.c
	  server-src/planner.c server-src/amadmin.c server-src/taper.c
	  server-src/amcleanupdisk.c server-src/find.c
	  server-src/Makefile.am: revise holding-disk management, add new
	  'amadmin' subcommand to list and delete dumps from the holding
	  disk.
	* server-src/amadmin.c: Add 'amadmin XX holding list -l'

2007-04-02  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/bsdtcp-security.c common-src/bsd-security.c 
	  common-src/security-util.c common-src/bsdudp-security.c:
	  bugfixes, always check for NULL ai_canonname
	* common-src/util.c common-src/util.h common-src/krb4-security.c 
	  common-src/security-util.c: bugfix for hosts with multiple addresses,
	  improved cmp_sockaddr, remove redundant checks
	* server-src/taper.c: add log message when new tapes are auto-labeled
	* common-src/security-util.c: patch to avoid spurious compiler warnings
	  noticed on FC3

2007-03-30  Dustin J. Mitchell <dustin@zmanda.com>
	* common-src/file.c: remove unused amanda_setup()

2007-03-30  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amanda.h: Define a _() macro.

2007-03-28  Dustin J. Mitchell <dustin@zmanda.com>
	* common/amanda.h: fix typo in SS_SET_INADDR_ANY for non-IPv6 
	  machines
	* gnulib/regenerate/regenerate: update to include visibility
	  and lock modules (See 2007-03-14)
	* recover-src/extract_list.c common-src/krb4-security.c
	  common-src/event.c common-src/security-util.c: use
	  SELECT_ARG_TYPE instead of fd_set

2007-03-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/krb5-security.c: Fix for krb5 and IPv6.
	* common-src/security-util.c: Fix for krb5 and IPv6.

2007-03-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/krb5-security.c: Compile with heimdal kerberos.

2007-03-27  Jean-Louis Martineau <martineau@zmanda.com>
	Fix solaris 9 problem:
	* common-src/krb5-security.c: Use putenv instead of setenv.
	* common-src/security-util.c: Set flags according to family.

2007-03-27  Jean-Louis Martineau <martineau@zmanda.com>
	Merge from zmanda EXT.

2007-03-27  Jean-Louis Martineau <martineau@zmanda.com>
	* Makefile.am (EXTRA_DIST): Remove contrib/gnulib-update-current.

2007-03-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Ouput quoted diskname in "DUMP SUMMARY"
	  section.

2007-03-23  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-zd-mtx.sh.in: Exit with a message if the
					configuration file doesn't exist.

2007-03-23  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Fix error message.

2007-03-23  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Fix segfault.

2007-03-23  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Use SS_LEN.
	* common-src/util.c: Use SS_LEN.

2007-03-21  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security.h (security_driver): Add data_encrypt and
						   data_decrypt function.
	* common-src/bsd-security.c, common-src/bsdtcp-security.c,
	  common-src/bsdudp-security.c, common-src/krb4-security.c,
	  common-src/rsh-security.c,
	  common-src/ssh-security.c: Set data_encrypt and data_decrypt to NULL.

	* common-src/conffile.c: Parse KRB5KEYTAB and KRB5PRINCIPAL on client.
	* common-src/krb5-security.c: Complete rewrite.
	* common-src/security-util.h: Change many prototype.
	* common-src/security-util.c: Change argument to function.
	* recover-src/amrecover.c: Use generic_client_get_security_conf.
	* recover-src/extract_list.c: Use generic_client_get_security_conf.

2007-03-21  Jean-Louis Martineau <martineau@zmanda.com>
	Merge from zmanda EXT.
	- Add SS_INIT, SS_SET_INADDR_ANY, SS_GET_PORT and SS_SET_PORT
	  macros for IPv6 portability
	- add SS_LEN() macro for calculating length of a
	  struct sockaddr, use it in a few locations where incorrect
	  lengths were being passed.
	- New script for rebuilding gnulib from scratch; current
	  gnulib is from "cvs update -D '2007-01-31 13:12:51 -0600'"

2007-03-12  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/set_commands.c (set_tape): Don't amfree(tape).
	* oldrecover-src/set_commands.c (set_tape): Don't amfree(tape).

2007-02-22  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/scsi-linux.c, common-src/security-util.c,
	  common-src/stream.c, oldrecover-src/amrecover.c,
	  restore-src/restore.c, server-src/amcheck.c,
	  server-src/taper.c: Use SIZE_T_FMT and SSIZE_T_FMT instead of %z.

2007-02-22  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsd-security.c: Always retry getaddrinfo if INET6 failed.
	* common-src/bsdudp-security.c: Ditto.

2007-02-22  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/debug.c: Remove old file in current directory.

2007-02-22  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-chio.pl.in: Typo.

2007-02-21  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Remove match for path_on_disk_slash.

2007-02-20  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/stream.c, common-src/util.c: Pass exact socklen_t to
						  bind and connect call.

2007-02-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: Set splitsize to 0 if no data in file.
	* server-src/amflush.c: Don't send FLUSH request if no data in file.
	* server-src/planner.c: Don't send FLUSH request if no data in file.
	* server-src/driver.c: Don't send request to taper if no data in file.

2007-02-19  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Fix compilation with --without-ipv6.

2007-02-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amverify.sh.in: Remove bogus fi.

2007-02-16  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amverify.sh.in: Add timeout on wait for device ready.
	* changer-src/chg-chio.pl.in: Wait (with timeout) for drive ready.

2007-02-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: Don't call free_server_config.

2007-02-15  Jean-Louis Martineau <martineau@zmanda.com>
	* patching file oldrecover-src/amrecover.h (local_cd): Prototype.
	* oldrecover-src/set_commands.c: Works with quoted arguments.
	* oldrecover-src/uparse.y (LCD): Call local_cd.
	* recover-src/amrecover.h (local_cd): Prototype.
	* recover-src/set_commands.c: Works with quoted arguments.
	* recover-src/uparse.y (LCD): Call local_cd.

2007-02-14  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Add "on the client" message.

2007-02-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl.in: fix for chunk and displayunit.

2007-02-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Fix if krb4 is compiled but another auth is
			       used.

2007-02-13  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/alloc.c (safe_env): Remove LANG and LC_* only if we are
					 priviledged process.

2007-02-13  Jean-Louis Martineau <martineau@zmanda.com>
	* dumper-src/amgtar.pl.in: Replace -t options by -T.
	* dumper-src/Makefile.am: Remove perl -t options.

2007-02-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/Makefile.am (STANDARD_COMMON_STUFF_NOT_FILE): Add sl.
	* common-src/statfs.c: Fix scale function.

2007-02-12  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendsize.c: Fix PARAM_HONOR_NODUMP.

2007-02-09  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Fix postscript crash.

2007-02-09  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-manual.sh.in: Add tty, email, tty_email request mode.

2007-02-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindexd.c: Use dbfd.

2007-02-06  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/alloc.c (vstrallocf): New function.
	* common-src/amanda.h (vstrallocf): Prototype.
	* client-src/sendsize.c: Send error if fe_rep_sendsize_quoted_error.
	* common-src/amfeatures.c (am_init_feature_set): Set
						 fe_rep_sendsize_quoted_error.
	* common-src/amfeatures.h (fe_rep_sendsize_quoted_error): new features.
	* server-src/planner.c: Receive error message from sendsize.

2007-02-06  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c, changer-src/scsi-linux.c,
	  common-src/conffile.c, configure.in,
	  man/Makefile.am, man/xml-source/amcheck.8.xml,
	  server-src/amlabel.c, server-src/taper.c: Merge from zmanda.

2007-02-06  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/clock.c (timesub): The result must always be positive.

2007-02-05  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-zd-mtx.sh.in: Fix for sed and IMPORT/EXPORT.

2007-02-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Add parentheses.

2007-02-02  Jean-Louis Martineau <martineau@zmanda.com>
	* contrib/gnulib-update-current: New file.
	* Makefile.am (EXTRA_DIST): Add contrib/gnulib-update-current.

2007-02-02  Jean-Louis Martineau <martineau@zmanda.com>
	* man/Makefile.am: Use http://docbook.sourceforge.net
	* man/xml-source/amadmin.8.xml, man/xml-source/amaespipe.8.xml,
	  man/xml-source/amanda.8.xml, man/xml-source/amanda-client.conf.5.xml,
	  man/xml-source/amanda.conf.5.xml, man/xml-source/amcheck.8.xml,
	  man/xml-source/amcrypt.8.xml, man/xml-source/amdump.8.xml,
	  man/xml-source/amfetchdump.8.xml, man/xml-source/amflush.8.xml,
	  man/xml-source/amgetconf.8.xml, man/xml-source/amlabel.8.xml,
	  man/xml-source/ammt.8.xml, man/xml-source/amrecover.8.xml,
	  man/xml-source/amreport.8.xml,
	  man/xml-source/amtape.8.xml: Fix for xmllint.
	* man/xslt/man.xsl: Remove bogus code.

2007-02-01  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-zd-mtx.sh.in: Support IMPORT/EXPORT slot.

2007-02-01  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amdump.sh.in: Output a starttime line.
	* server-src/amflush.c: Output a starttime line.
	* server-src/amstatus.pl.in: parse the starttime line.

2007-01-26  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in: Fix --with-ipv6 option.

2007-01-26  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amdump.sh.in: Exit with a status.

2007-01-26  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c: Use hostnext pointer.

2007-01-26  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Exit with a status.

2007-01-26  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl.in: Exit with a status.

2007-01-26  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl.in: Detect failed dump to tape.

2007-01-25  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in: Add --with-ipv6 option.

2007-01-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/changer.c (changer_command): Send stderr to dbfd().

2007-01-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c: Check hostname have same case.

2007-01-25  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-zd-mtx.sh.in: Check if MT and MTX exists.

2007-01-25  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-zd-mtx.sh.in: Set CHANGER environment variable.

2007-01-24  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Cleanup conf_print function.

2007-01-24  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Check for duplicate -o options.
	* recover-src/amrecover.c: Change precedence of option.

2007-01-24  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c: Fix compiler warning.

2007-01-23  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c (tcpm_recv_token): Check size < 0.


2007-01-23  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c: Check duplicate DLE with match_host and
				 match_disk.

2007-01-18  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c: Improve check if /etc/dumpdates in not there.

2007-01-18  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/amfetchdump.c: Set arg_state to ARG_GET_HOST.

2007-01-18  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Check tape_access.
	* server-src/taper.c: Improve message.

2007-01-16  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in: Define GCC_COMPILER.
	* gnulib/Makefile.am: Add -Wno-error to AM_CFLAGS if GCC_COMPILER.

2007-01-16  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/getconf.c: Fix segfault in parameter parsing.

2007-01-15  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsd-security.c, common-src/bsdtcp-security.c,
	  common-src/bsdudp-security.c,
	  common-src/stream.c: Don't call check_addrinfo_give_name.
	* common-src/security-util.c (check_addrinfo_give_name): Always log
	                                                         error message.

2007-01-11  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c Set default length/filemark correctly.
	* man/xml-source/amanda.conf.5.xml: Document they are in kbytes.

2007-01-10  Jean-Louis Martineau <martineau@zmanda.com>
	* config/gnulib/gnulib-common.m4: New file.
	* config/gnulib.m4i: Load config/gnulib/gnulib-common.m4.

2007-01-10  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c (do_sendpkt): Send packet if handle != NULL.

2007-01-10  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c, common-src/conffile.h,
	  server-src/diskfile.c: Keep different list for exclude file and list.

2007-01-10  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c (read_file): Don't count first header twice.

2007-01-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl.in: Fix split-dump accounting.

2007-01-04  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c: Use prompt_in.

2007-01-04  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c, common-src/bsd-security.c,
	  common-src/bsdtcp-security.c, common-src/bsdudp-security.c,
	  common-src/dgram.c, common-src/security-util.c,
	  common-src/stream.c,
	  common-src/util.c: Replace HAVE_IPV6 by WORKING_IPV6.
	* configure.in: Define HAVE_IPV6 if IPv6 is working.

2007-01-04  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-chio.pl.in, changer-src/chg-iomega.pl.in,
	  changer-src/chg-rth.pl.in, dumper-src/amgtar.pl.in,
	  server-src/amoverview.pl.in, server-src/amstatus.pl.in,
	  server-src/amtoc.pl.in: Clean ENV and set PATH.

2006-12-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Don't repport error for many run in a day if
			       it's amflush.

2006-12-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c (quote_string): Escape '\' character.

2006-12-22  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/display_commands.c: Send quoted text to amindexd.
	* recover-src/extract_list.c: Send quoted text to amindexd.
	* recover-src/set_commands.c: Send quoted text to amindexd.

2006-12-22  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-disk.sh.in: LASTSLOT in a changerfile for chg-disk.

2006-12-22  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendsize.c: Compilation fix.

2006-12-18  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/packet.c (pkt_init_empty): New function.
	* common-src/packet.h (pkt_init_empty): New prototype.
	* amandad-src/amandad.c, common-src/protocol.c,
	  common-src/security-util.c: Use pkt_init_empty.

2006-12-18  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Print nothing if the list is emtpy.

2006-12-14  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c: Fix filename for output file.

2006-12-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amanda.h: Define __attribute__ for gcc >= 3.
	* common-src/packet.c (pkt_init): Accept NULL for fmt.
	* amandad-src/amandad.c, common-src/protocol.c,
	  common-src/security-util.c: Pass NULL to pkt_init.
	* amandad-src/amandad.c, changer-src/chg-scsi.c,
	  changer-src/scsi-linux.c, client-src/sendbackup.c,
	  common-src/amanda.h, common-src/conffile.c,
	  common-src/event.c, common-src/packet.c,
	  common-src/security-util.c, common-src/stream.c,
	  common-src/util.c, oldrecover-src/amrecover.c,
	  restore-src/restore.c, server-src/amcheck.c,
	  server-src/driver.c, server-src/driverio.c,
	  server-src/taper.c: Fix printf format error.

2006-12-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindexd.c: Use fgets to read index file because they
	                         are not quoted.

2006-12-12  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in: Find patch for sort program.
	* server-src/amindexd.c: Clean the indexd file between the uncompress
				 and sort process.

2006-12-08  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in: Add ICE_CHECK_DECL(snprintf,stdio.h)
	* configure.in: Add ICE_CHECK_DECL(vsnprintf,stdio.h)
	* client-src/sendbackup.c: Fix ignoring return value of write.

2006-12-08  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amadmin.8.xml, man/xml-source/amanda.8.xml,
	  man/xml-source/amanda.conf.5.xml, man/xml-source/amcheck.8.xml,
	  man/xml-source/amfetchdump.8.xml, man/xml-source/ammt.8.xml,
	  man/xml-source/amrecover.8.xml: Move </note> tag to beginning of line

2006-12-08  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-rait.sh.in: Fix typo for -reset.

2006-12-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindexd.c: Fix host case problem.
	* server-src/diskfile.c (add_disk, parse_diskline): Update hostname
							    field.
	* server-src/diskfile.h (disk_s): New hostname field.
	* server-src/disk_history.c (add_dump): New hostname parameter.
	* server-src/disk_history.h (DUMP_ITEM): New hostname field.
	* server-src/disk_history.h (add_dump): Protoype change.

2006-12-07  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Add missing HAVE_IPV6.
	* common-src/security-util.c: Add missing HAVE_IPV6.
	* common-src/bsd-security.c, common-src/bsdtcp-security.c,
	  common-src/bsdudp-security.c, common-src/dgram.c,
	  common-src/dgram.h, common-src/stream.c,
	  common-src/util.c: Fix for broken getaddrinfo:not returning V4MAPPED

2006-12-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (lookup_keyword): Use strcasecmp.
	* common-src/conffile.c (get_conftoken): Don;t convert to uppercase.
	* server-src/getconf.c: Don;t print extra '\n' for --list.

2006-12-04  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c (str_sockaddr): Use host byte order for port.

2006-12-04  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amtape.h: Remove file.

2006-12-04  Jean-Louis Martineau <martineau@zmanda.com>
	Application API phase 1.
	* client-src/client_util.c, client-src/client_util.h,
	  client-src/selfcheck.c, client-src/sendbackup.c,
	  client-src/sendsize.c, common-src/amfeatures.c,
	  common-src/amfeatures.h, common-src/fileheader.c,
	  common-src/fileheader.h, recover-src/extract_list.c,
	  server-src/amcheck.c, server-src/amstatus.pl.in,
	  server-src/dumper.c, server-src/Makefile.am,
	  server-src/planner.c: Fix for Application API.
	* configure.in: Fix for moved files.
	* dumper-src/generic-dumper.pl.in: Fix for Application API.
	* dumper-src/Makefile.am: Fix for renamed files.
	* dumper-src/gnutar.pl.in: Renamed to dumper-src/amgtar.pl.in.
	* dumper-src/amgtar.pl.in: Fix for Application API.
	* dumper-src/star.pl.in: Renamed to dumper-src/amstar.pl.in.
	* dumper-src/amstar.pl.in: Fix for Application API.

2006-11-29  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Kill dump process on error.

2006-11-29  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-chio.pl.in: Check tapedev is set.
	* changer-src/chg-disk.sh.in: Check tapedev is set.
	* changer-src/chg-iomega.pl.in: Check tapedev is set.
	* changer-src/chg-manual.sh.in: Check tapedev is set.
	* changer-src/chg-mtx.sh.in: Check tapedev is set.
	* changer-src/chg-rth.pl.in: Check tapedev is set.
	* server-src/amcheck.c: Tapedev is needed only if tpchanger is not set.
	* server-src/amflush.c: Tapedev is needed only if tpchanger is not set.
	* server-src/amindexd.c: Tapedev is needed only if tpchanger is not set
	* server-src/taper.c: Tapedev is needed only if tpchanger is not set.

2006-11-29  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Ignore tar exit with status 1.

2006-11-29  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindexd.c (clean_backslash): New function use to unescape
						 '\' characters in index files.

2006-11-29  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c (search_tapes): Fix prompt_out setting.

2006-11-28  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amanda.h: Don't include gnulib header if CONFIGURE_TEST
			       is defined.
	* common-src/amflock.c (main): Remove unused fd variable.

2006-11-28  Jean-Louis Martineau <martineau@zmanda.com>
	* config/Makefile.am (EXTRA_DIST): Add gnulib.m4i.

2006-11-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c (copy_file): Fix compilation error.

2006-11-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/stream.c: Fix compilation error.

2006-11-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amanda.h (NI_MAXHOST): Define if not defined.
	* common-src/bsd-security.c, common-src/bsdtcp-security.c,
	  common-src/bsdudp-security.c, common-src/dgram.c,
	  common-src/security-util.c, common-src/stream.c,
	  common-src/util.c: HAVE_IPV6 conditional code

2006-11-26  Jean-Louis Martineau <martineau@zmanda.com>
	* config/gnulib/*: m4 files for gnulib.
	* config/gnulib.m4i: File to load all m4 files for gnulib.
	* gnulib/*: gnulib source.
	* */Makefile.am (INCLUDES): Add $(top_srcdir)/gnulib.
	* */Makefile.am (LDADD): Add ../gnulib/libgnu.$(LIB_EXTENSION).
	* Makefile.am (ACINCLUDE_M4_DEPS): Add $(srcdir)/config/gnulib.m4i.
	* Makefile.am (SUBDIRS): Add gnulib.
	* configure.in: AC_PREREQ(2.59), gl_EARLY, gl_INIT.
	* configure.in (AC_CONFIG_FILES): Add gnulib/Makefile.
	* autogen: Add config/gnulib.m4i to acinclude.m4.

2006-11-24  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup-dump.c, client-src/sendbackup-gnutar.c,
	  client-src/sendsize.c,
	  server-src/amindexd.c: Patch for gcc-3.2.3 to compile the new
				 vstralloc macro.

2006-11-24  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/file.c (old_sanitise_filename): New function.
	* common-src/amanda.h (old_sanitise_filename): Prototype.
	* common-src/util.c (copy_file): New function.
	* common-src/util.h (copy_file): Prototype.
	* server-src/diskfile.c: Check that two DLE doesn't get the same
				 sanitized filename.
	* server-src/amindex.c (getoldindexfname): New function.
	* server-src/amindex.h (getoldindexfname): prototype.
	* server-src/amindexd.c: Use the old sanitized filename if the new
				 file doesn't exist.
	* server-src/amcheck.c: Call check_infofile.
	* server-src/planner.c: Call check_infofile.
	* server-src/server_util.c (check_infofile): New function, will copy
			 the old sanitizes info file if the new doesn't exist.
	* server-src/server_util.h (check_infofile): Prototype.

2006-11-23  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c (tcpm_recv_token): amanda protocol
	  packet can be larger than NETWORK_BLOCK_BYTES

2006-11-21  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/stream.c: Fix compiler error.

2006-11-21  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c, common-src/amanda.h,
	  common-src/bsd-security.c, common-src/bsdtcp-security.c,
	  common-src/bsdudp-security.c, common-src/dgram.c,
	  common-src/dgram.h, common-src/krb4-security.c,
	  common-src/krb5-security.c, common-src/security-util.c,
	  common-src/security-util.h, common-src/stream.c,
	  common-src/util.c, common-src/util.h,
	  restore-src/amidxtaped.c, server-src/amindexd.c: IPV6.

2006-11-20  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendsize.c, oldrecover-src/display_commands.c,
	  oldrecover-src/extract_list.c, recover-src/display_commands.c,
	  recover-src/extract_list.c,
	  server-src/driver.c: Fix compiler error.

2006-11-20  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendsize.c: Open the amandates file after the
				 <config>/amanda-client.conf file is loaded.

2006-11-20  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendsize.c: Fix compiler error on boris.
	* server-src/driver.c: Fix compiler error on rocky.

2006-11-20  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c, server-src/amcheck.c,
	* server-src/driver.c, server-src/dumper.c,
	* server-src/planner.c, tape-src/output-file.c: Lint cleanup.

2006-11-20  Ian Turner <ian@zmanda.com>
	* tape-src/output-file.c: Fix a compilation error related to
	  improper type casts. Thanks to Satya Ganga for noticing this
	  problem.

2006-11-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Use temporary variable to scanf an OFF_T_FMT.
	* server-src/planner.c: Use temporary variable to scanf an OFF_T_FMT.

2006-11-13  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c: Work for estimate calcsize and
				  program "DUMP".

2006-11-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Don't ouput an warning if holdingdisk 'use'
				is set to 0.

2006-11-09  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amgetconf.8.xml: Document --list.

2006-11-09  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-scsi.c: Don't remove '_' from "generic_changer".

2006-11-08  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amanda.h, common-src/conffile.c,
	  common-src/conffile.h, common-src/security-util.c,
	  configure.in, oldrecover-src/amrecover.c,
	  oldrecover-src/extract_list.c, recover-src/amrecover.c,
	  recover-src/extract_list.c, restore-src/amrestore.c,
	  server-src/dumper.c: Fix compiler error on Tru64.

2006-11-08  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (getconf_byname):
				Parse "DEFINE:identifer:parameter" format.
	* common-src/conffile.c (getconf_list): New function to list a DEFINE.
	* common-src/conffile.c (lookup_holdingdisk): New function.
	* common-src/conffile.h (getconf_list,
				 lookup_holdingdisk): New prototype.
	* server-src/getconf.c: accept --list argument and
				"DEFINE:identifer:parameter" format.
	* man/xml-source/amgetconf.8.xml: Document.

2006-11-08  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: set off_t variable to 0 before sscanf.
	* server-src/planner.c: set off_t variable to 0 before sscanf.

2006-11-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl.in: Improve error message.

2006-11-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Fix coverity bug 170.
	* server-src/diskfile.c: Fix coverity bug 147.

2006-11-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (validate_chunksize): Check chunksize is >=
						      2*DISK_BLOCK_KB

2006-11-06  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amanda.h: Define OFF_T_STRTOL.
	* configure.in: Check for strtol and strtoll.

2006-11-02  Ian Turner <ian@zmanda.com>
	* common-src/amanda.h: Use atol if atoll is missing.

2006-11-02  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Better message on invalid size.

2006-11-02  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in: List bsdudp as a udp transport.

2006-11-01  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c: Don't use 0 for NULL.

2006-11-01  Jean-Louis Martineau <martineau@zmanda.com>
	Revert Ian patch of 2006-10-29.
	* common-src/conffile.c: Defile AMANDATES_FILE
	* client-src/amandates.h: Don't define AMANDATES_FILE

2006-11-01  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Rename DUMPTYPE_START_T to DUMPTYPE_STARTTIME.
	* common-src/conffile.h: Rename DUMPTYPE_START_T to DUMPTYPE_STARTTIME.
	* server-src/amadmin.c (disklist_one): Print correct starttime.
	* server-src/diskfile.c: Set start_t to starttime.
	* server-src/diskfile.h (disk_t): Add starttime.

2006-11-01  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/scsi-changer-driver.c: Add Tandberg SLR100,
	                                     more debugging.
	* changer-src/sense.c: Add Tandberg SLR100 Tape Drive "SLR100".

2006-11-01  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amanda.h: Define dbrename if !DEBUG_CODE.
	* restore-src/amidxtaped.c: Declare i if !DEBUG_CODE.

2006-10-30  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c (disklist_one): Print ignore field.
	* server-src/amoverview.pl.in: Ignore 'ignore yes' and 'strategy skip'.
	* server-src/diskfile.c: Correct hostname allocation.
	                         Keep 'ignore yes' and 'strategy skip' DLE in
				 memory, set there todo to 0.
	* server-src/diskfile.h: (struct disk_s): New ignore field.

2006-10-29  Ian Turner <ian@zmanda.com>
	This was reported as debian bug 394796. Thanks to Damyan Ivanov 
	<dam@modsoftsys.com> for reporting and to Bdale Garbee 
	<bdale@gag.com> for a preliminary patch.
	* common-src/conffile.c: Use AMANDATES_FILE as default for 
	  location of amandates.
	* common-src/amandates.h: Move from client-src/
	* client-src/amandates.h: Move to common-src/
	* common-src/Makefile.am: Update to reflect new location of 
	  amandates.h.
	* client-src/Makefile.am: ditto.

2006-10-25  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Jay Fenlason
	* common-src/rsh-security.c: Fix.

2006-10-24  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (get_config_options): Build and argv of the
	                                              -o arguments.
	* common-src/conffile.h (get_config_options): Prototype.
	* server-src/driverio.c: exec dumper/chunker/driver with the argv from
	                         get_config_options
	* server-src/amtape.c: Accept -o argument.
	* man/xml-source/amtape.8.xml: Document it.

2006-10-24  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: Fix allocation problem on tapedev.

2006-10-20  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (conf_print): Add a parameter if we want
					      CONFTYPE_STRING enclosed in ".
	* server-src/planner.c: Use getconf_int to get etimeout value.

2006-10-20  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c (free_split_buffer): Correct free.

2006-10-20  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup.c: Parse quote amdevice.
	* server-src/amcheck.c: Send quoted amdevice.
	* server-src/planner.c: Send quoted amdevice.

2006-10-20  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (CNF_CTIMEOUT, CNF_DTIMEOUT, CNF_ETIMEOUT):
	  They are of type CONFTYPE_INT
	  (CONFTYPE_TIME are for value parsed as "hhmm"")
	* common-src/conffile.c (getconf_byname): Use conf_print().
	* common-src/conffile.h: Add comment.
	* server-src/amcheck.c, server-src/dumper.c, server-src/planner.c:
	  Use getconf_int to get timeout value.

2006-10-19  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Fix formating.

2006-10-19  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/calcsize.c, client-src/sendsize.c: Remove bogus fseek.

2006-10-19  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/calcsize.c: Quote amname.

2006-10-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Print an L_STATS with the hostname
	* server-src/reporter.c: Print hostname, org, config and date at the
				 beginning of the report

2006-10-16  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/dgram.c (dgram_cat),
	  common-src/packet.c (pkt_init, pkt_cat): Works correctly with
						   vsnprintf returning -1.

2006-10-11  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/Makefile.am (libamanda_la_LIBADD) Remove @LTLIBOBJS@.

2006-10-11  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: stralloc(tapedev).
	* configure.in (EXAMPLE_TAPEDEV): Set to /dev/null if no tape-device.
	* example/amanda-client.conf.in, example/amanda.conf.in
	  example/chg-mcutil.conf.in: Use EXAMPLE_TAPEDEV.

2006-10-11  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/alloca.c, common-src/getcwd.c, common-src/mktime.c,
	  common-src/memmove.c, common-src/snprintf.c,
	  common-src/strcasecmp.c, common-src/strerror.c,
	  common-src/strftime.c, common-src/strncasecmp.c,
	  common-src/strstr.c, common-src/waitpid.c,
	  COPYRIGHT-APACHE: Removed files.
	* configure.in: Remove many AC_REPLACE_FUNCS.
	* Makefile.am (pkgdata_DATA): Remove COPYRIGHT-APACHE.

2006-10-11  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/Makefile.am: Remove all reference to our regex
	* common-src/match.c: #include <regex.h>, the system regex
	* common-src/memmove.c: No more memmove in regex-src
	* Makefile.am (pkgdata_DATA): Remove COPYRIGHT-REGEX
	* Makefile.am (EXTRA_DIST): Remove regex-src/*
	* regex-src: Remove directory.
	* common-src/regcomp.c, common-src/regerror.c,
	  common-src/regexec.c, common-src/regfree.c,
	  common-src/amregex.h: Remove files.

2006-10-11  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Improve message for dump larger than available
				tape space if runtapes > 1 and splitsize == 0.

2006-10-10  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (wait_children): Don't crash if dumper->chunker
					       is NULL

2006-10-04  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Call security_recvpkt() on A_SENDNACK
				 and dup P_REQ.
	* common-src/security-util.c: Improve message.

2006-10-03  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcleanupdisk.c: Accept -o arguments.
	* server-src/amcleanup.sh.in: Add missing 'shift' for non-linux system.
	                              Accept -o arguments.

2006-10-03  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amoverview.pl.in: Fix parsing of time field from amadmin.

2006-10-03  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/amidxtaped.c, restore-src/restore.c,
	  server-src/amcheck.c, server-src/amflush.c,
	  server-src/amlabel.c, server-src/taper.c,
	  server-src/taperscan.c: Check for CNF_TAPEDEV == NULL.

2006-10-03  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c: Don't set CNF_TAPEDEV to DEFAULT_TAPE_DEVICE.
	* configure.in: Don't set DEFAULT_TAPE_DEVICE.

2006-09-29  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsdtcp-security.c: Add logging on error.

2006-09-29  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amoverview.pl.in: Use shellwords instead of quotewords,
	  don't add date for disk not in the disklist.

2006-09-28  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsd-security.c: Fix %hd printf argument format.
	* common-src/security-util.c: Fix %hd printf argument format.

2006-09-28  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c (client_keytab): Add DEBUG_*.
	* oldrecover-src/amrecover.c: Call read_clientconf.

2006-09-27  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c: Improve debugging.
	* server-src/changer.c: Make sure to dup the fd out of the 0..2 range.

2006-09-27  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/amfetchdump.c: Pass new prompt_in parameter to
	                             search_tapes.
	* restore-src/restore.c (search_tapes, load_manual_tape): New prompt_in
	                                                          parameter.
	* restore-src/restore.h (search_tapes): New prompt_in parameter.
	* restore-src/amidxtaped.c: Set new 'FILE *' instead of reusing stdin
	                            and stdout.
	* server-src/amindexd.c: Set new 'FILE *' instead of reusing stdin
	                         and stdout.

2006-09-27  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Orion Poplawski <orion@cora.nwra.com>
	* server-src/planner.c: Add a skip_quoted_line() on error.

2006-09-23  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl.in: Fix parsing of 'taper: wrote label' line.
	* server-src/amtoc.pl.in: Fix parsing of 'START taper' line.

2006-09-22  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.h: New CONFTYPE_INTRANGE conftype_t.
	* common-src/conffile.c: New CNF_RESERVED_UDP_PORT,
	                         CNF_RESERVED_TCP_PORT,
	                         CNF_UNRESERVED_TCP_PORT config options.
	* common-src/dgram.c: Use the new CNF_RESERVED_UDP_PORT option.
	* common-src/stream.c: Use the new CNF_*RESERVED_PORT options.
	* man/xml-source/amanda-client.conf.5.xml: Document it.
	* man/xml-source/amanda.conf.5.xml: Document it.

2006-09-22  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by William Jojo
	* client-src/sendsize.c: Fix #endif for AIX.

2006-09-22  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/packet.c: Fix use of arglist_start/arglist_end.
	* server-src/amindexd.c: Fix use of vsnprintf (for IRIX).
	* server-src/logfile.c: Fix use of arglist_start/arglist_end.

2006-09-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Don't assert if holding use is set to 0.

2006-09-19  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c (search_logfile): Count 'PARTIAL taper line'.

2006-09-19  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Paul Bijens
	* server-src/amcheck.c: Print "tapelist" instead of "tapefile".

2006-09-19  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/dgram.c (dgram_bind): Remove unused variables.

2006-09-19  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/conffile.c, common-src/conffile.h: Add debug_amandad,
	  debug_amidxtaped, debug_amindexd, debug_amrecover, debug_auth,
	  debug_event, debug_holding, debug_protocol, debug_planner,
	  debug_driver, debug_dumper, debug_chunker, debug_taper,
	  debug_selfcheck, debug_sendsize, debug_sendbackup
	  configurations options.
	* common-sc/debug.c: Use it's own clock function.
	* amandad-src/amandad.c, amandad-src/amandad_util.c,
	  client-src/calcsize.c, client-src/client_util.c,
	  client-src/killpgrp.c, client-src/rundump.c,
	  client-src/runtar.c, client-src/selfcheck.c,
	  client-src/sendbackup.c, client-src/sendsize.c,
	  common-src/bsd-security.c, common-src/bsdtcp-security.c,
	  common-src/bsdudp-security.c, common-src/debug.c,
	  common-src/dgram.c, common-src/event.c,
	  common-src/krb5-security.c, common-src/pipespawn.c,
	  common-src/protocol.c, common-src/rsh-security.c,
	  common-src/security.c, common-src/security-util.c,
	  common-src/security-util.h, common-src/ssh-security.c,
	  common-src/stream.c, common-src/util.c,
	  recover-src/amrecover.c, restore-src/amidxtaped.c,
	  server-src/amindexd.c, server-src/chunker.c,
	  server-src/driver.c, server-src/dumper.c,
	  server-src/planner.c,
	  server-src/taper.c: Use the debug_* configuration options.
			      Use debug_prefix_time to print the time on
			      all debugging message.

2006-09-19  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Use CNF_REP_TRIES.
	* common-src/conffile.c: New CONNECT_TRIES, REQ_TRIES, REP_TRIES
	                         configuration options.
	* common-src/conffile.h: New CONNECT_TRIES, REQ_TRIES, REP_TRIES
	                         configuration options.
	* common-src/protocol.c: Use CNF_CONNECT_TRIES and CNF_REQ_TRIES.
	* common-src/protocol.c: Rename reqtries to resettries.
	                         Rename acktries to reqtries.
	* man/xml-source/amanda-client.conf.5.xml: Document new options.
	* man/xml-source/amanda.conf.5.xml: Document new options.

2006-09-19  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Read client configuratrion file.
	* client-src/client_util.c, client-src/selfcheck.c,
	  client-src/sendbackup.c, client-src/sendbackup-dump.c,
	  client-src/sendbackup-gnutar.c, client-src/sendsize.c,
	  recover-src/amrecover.c, recover-src/extract_list.c,
	  restore-src/amfetchdump.c, server-src/amadmin.c,
	  server-src/amcheck.c, server-src/amflush.c,
	  server-src/amflush.c, server-src/amlabel.c,
	  server-src/amlogroll.c, server-src/amtrmidx.c,
	  server-src/amtrmlog.c, server-src/chunker.c,
	  server-src/diskfile.c, server-src/driver.c,
	  server-src/dumper.c, server-src/getconf.c,
	  server-src/planner.c, server-src/reporter.c,
	  server-src/taper.c: Use generic macro/functions instead of
	                      client/server functions.
	* client-src/client_util.h: Remove unuse macro.
	* client-src/Makefile.am: Remove clientconf.? files.
	* common-src/amanda.h: Define MAX_DUMPERS.
	* common-src/conffile.c: New file, merge of client-src/clientconf.c
	                                        and server-src/conffile.c
	* common-src/conffile.h: New file, merge of client-src/clientconf.c
	                                        and server-src/conffile.c
	* common-src/Makefile.am (libamanda_la_SOURCES): Add conffile.c
	* common-src/Makefile.am (noinst_HEADERS): Add conffile.h
	* common-src/util.c: Move many thing to common-src/conffile.c.
	* common-src/util.h: Move many thing to common-src/conffile.h.
	* server-src/driverio.h: Remove MAX_DUMPERS define.
	* server-src/Makefile.am: Remove conffile.[hc].

2006-09-19  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/dgram.c (dgram_bind): Don't set SO_REUSEADDR on socket.

2006-09-19  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c (connect_port): Make EHOSTUNREACH and ENETUNREACH
					    fatal error.

2006-09-18  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c(dump_sockaddr): Convert from network to machine
	                                    bytes order before printing.
	* common-src/dgram.c (dgram_recv): Print the fromaddr.

2006-09-15  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Correct order of close/dup.

2006-09-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsdtcp-security.c: Use AMANDA_SERVICE_NAME.

2006-09-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl.in: Check that $dumpers_active is defined.

2006-09-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c (conftoken_getc): Return an int.

2006-09-11  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup-dump.c: Works if rundump is not used.

2006-09-05  Jean-Louis Martineau <martineau@zmanda.com>
	* Amanda 2.5.1 released.
	* configure.in: AM_INIT_AUTOMAKE(amanda, 2.5.1).
	* NEWS: Change in amanda-2.5.1

2006-08-30  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: Typo in error message.

2006-08-29  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c: Print error message to stdout before
				  calling error().

2006-08-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c (log_msgout): Seek to begining of file.

2006-08-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Report if a dump was successfully retried.

2006-08-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl.in: Correct size for retried dump.

2006-08-25  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/runtar.c: Check that strcmp(argv[3], "--create") == 0.

2006-08-24  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/statfs.c (scale): Macro replaced by a function.

2006-08-24  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/chunker.c: Use STREAM_BUFSIZE for stream_accept.
	* server-src/taper.c: Use STREAM_BUFSIZE for stream_accept.

2006-08-24  Maitreyee Karmarkar <maitreyee.zmanda.com>
	* man/xml-source/amcheck.8.xml: amcheck xml man page change 

2006-08-23  Kevin Till <ktill@zmanda.com>
	*  server-src/driver.c: fix typo

2006-08-23  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (dumper_result): Decrement pendings_aborts.
	* server-src/driver.c (handle_dumper_result): Don't send duper result
	  to chunker if we aborted it.
	* server-src/driverio.c (dumper_cmd, chunker_cmd): Don't close the fd
	  on ABORT.
	* server-src/dumper.c: Accept ABORT command.

2006-08-23  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c (restore): Set bytes_read to the return value
	  of read_file_header.

2006-08-22  Jean-Louis Martineau <martineau@zmanda.com>
	* tape-src/output-tape.c: Works if EOVERFLOW is not defined.

2006-08-21  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c, common-src/rsh-security.c,
	  common-src/ssh-security.c, restore-src/restore.c,
	  server-src/changer.c, server-src/dumper.c: Fix sentinel warning.

2006-08-21  Jean-Louis Martineau <martineau@zmanda.com>
	* example/amanda.conf.in: Typo.

2006-08-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driverio.c: Fix bogus "(unsigned long)-1".

2006-08-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (start_some_dumps): Remove bogus free_assignedhd.

2006-08-21  Maitreyee Karmarkar <maitreyee.zmanda.com>
	* server-src/amcheck.c: Check specific clients
	* man/amcheck.8: add the multiple client check format

2006-08-18  Ian Turner <ian@zmanda.com>
	* tape-src/amtapetype.c: Don't crash on exit

2006-08-17  Paddy Sreenivasan <paddy@zmanda.com>
        * server-src/driverio.c:
        * server-src/changer.c:
        * restore-src/amfetchdump.c:
        * recover-src/extract_list.c:
        * oldrecover-src/extract_list.c:
        * common-src/util.c:
        * common-src/stream.c:
        * common-src/file.c:
        * common-src/dgram.c: Fix warnings

2006-08-17  Kevin Till <ktill@zmanda.com>
	* common-src/stream.c: Loop 5 times (ntries > 5) on select error

2006-08-14  Paddy Sreenivasan <paddy@zmanda.com>
        * client-src/sendsize.c: Fix warning
        * server-src/reporter.c: Fix warnings

2006-07-28  Jean-Louis Martineau <martineau@zmanda.com>
	* Amanda 2.5.1b2 released.
	* configure.in: AM_INIT_AUTOMAKE(amanda, 2.5.1b2).

2006-07-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (find_diskspace): Make sure size > 0.

2006-07-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Don't check new disk.

2006-07-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Always log if full size estimate is larger
				than the available tape space.

2006-07-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Always log if the latest full dump will be
				overwritten soon.

2006-07-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/clock.c (timesub): Don't make a negative time.

2006-07-27  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Tell which file are loaded.
	* man/xml-source/amanda-client.conf.5.xml: Ditto.

2006-07-26  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS: for 2.5.1b2.

2006-07-26  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.h (CONFTYPE_HOLDING): New conftype.
	* common-src/util.c (conf_init_holding, conf_set_holding,
			     get_conftype_hold): New fonction.
	* example/amanda.conf.in: Example of new holdingdisk value.
	* man/xml-source/amanda.8.xml: Example.
	* man/xml-source/amanda.conf.5.xml: Document it.
	* server-src/amadmin.c (disklist_one): Print holdingdisk value.
	* server-src/conffile.c: Parse new CONF_HOLDING type.
	* server-src/conffile.h (dumptype_get_to_holdingdisk): Change macro.
	* server-src/diskfile.c (parse_diskline): dumptype_get_to_holdingdisk.
	* server-src/driver.c: Use new CONFTYPE_HOLDING value.

2006-07-26  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c: Fix bug found by coverity.
	* common-src/debug.c: Fix bug found by coverity.

2006-07-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amflush.c: Typo.

2006-07-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amflush.c: Correct test for driver_stream.

2006-07-25  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/clientconf.c: Default CLN_AMANDATES to /etc/amandates.
	* common-src/util.c (conf_init_size): Type is CONFTYPE_SIZE.
	* server-src/conffile.c (getconf_taperalgo): New function.
	* server-src/conffile.h (getconf_taperalgo): Prototype.
	* server-src/driver.c: Use getconf_taperalgo.

2006-07-25  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/clientconf.c (client_getconf_boolean): New function.
	* client-src/clientconf.h (client_getconf_boolean): Prototype.
	* server-src/conffile.c (getconf_boolean): New function.
	* server-src/conffile.h (getconf_boolean): Prototype.
	* restore-src/amidxtaped.c: Use getconf_boolean.
	* server-src/amflush.c: Use getconf_boolean.
	* server-src/planner.c: Use getconf_boolean.

2006-07-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/getconf.c: Don't print BUGGY.
	* changer-src/chg-chio.pl.in: Don't parse BUGGY.
	* changer-src/chg-iomega.pl.in: Don't parse BUGGY.
	* changer-src/chg-zd-mtx.sh.in: Don't parse BUGGY.
	* man/xml-source/amgetconf.8.xml: Don't parse BUGGY.
	* server-src/amverifyrun.sh.in: Don't parse BUGGY.
	* server-src/amverify.sh.in: Don't parse BUGGY.

2006-07-25  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c: Cleanup.
	* restore-src/amrestore.c: Don't fsf if the last read return 0.

2006-07-25  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c: Fix bug found by klocwork.
	* common-src/rsh-security.c: Fix bug found by klocwork.
	* common-src/ssh-security.c: Fix bug found by klocwork.
	* server-src/planner.c: Fix bug found by klocwork.

2006-07-25  Jean-Louis Martineau <martineau@zmanda.com>
	* tape-src/output-tape.c (tape_tape_open): mt is declared inside #ifdef.

2006-07-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Fix quoting.

2006-07-25  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/clientconf.c: client_getconf* validate the type.
	* common-src/util.c (get_conftype_*): New function.
	* common-src/util.h (get_conftype_*): Prototype.
	* server-src/conffile.c: getconf* validate the type.
	* server-src/conffile.h: Use get_conftype_* function.

2006-07-25  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/clientconf.c: New AMANDATES client config option.
	* client-src/clientconf.h: New AMANDATES client config option.
	* client-src/amandates.c: Use AMANDATES.
	* client-src/amandates.h: Use AMANDATES.
	* client-src/selfcheck.c: Use AMANDATES.
	* client-src/sendbackup-gnutar.c: Use AMANDATES.
	* client-src/sendsize.c:: Use AMANDATES.
	* common-src/util.h : New CONF_AMANDATES.
	* man/xml-source/amanda-client.conf.5.xml: Document it.

2006-07-25  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/clientconf.c: New GNUTAR_LIST_DIR client config option.
	* client-src/clientconf.h: New GNUTAR_LIST_DIR client config option.
	* client-src/selfcheck.c: Use GNUTAR_LIST_DIR.
	* client-src/sendbackup-gnutar.c: Use GNUTAR_LIST_DIR.
	* client-src/sendsize.c: Use GNUTAR_LIST_DIR.
	* common-src/util.h: New CONF_GNUTAR_LIST_DIR.
	* man/xml-source/amanda-client.conf.5.xml: Document it.

2006-07-25  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/calcsize.c, client-src/killpgrp.c,
	  client-src/rundump.c, client-src/runtar.c,
	  client-src/selfcheck.c, client-src/sendbackup.c,
	  client-src/sendsize.c, common-src/amanda.h,
	  common-src/debug.c, oldrecover-src/amrecover.c,
	  recover-src/amrecover.c, restore-src/amfetchdump.c,
	  restore-src/amidxtaped.c, server-src/amadmin.c,
	  server-src/amcheck.c, server-src/amcleanupdisk.c,
	  server-src/amflush.c, server-src/amindexd.c,
	  server-src/amlabel.c, server-src/amlogroll.c,
	  server-src/amtape.c, server-src/amtrmidx.c,
	  server-src/amtrmlog.c, server-src/chunker.c,
	  server-src/driver.c, server-src/dumper.c,
	  server-src/getconf.c, server-src/planner.c,
	  server-src/reporter.c, server-src/taper.c: dbrename ot the config dir.

2006-07-25  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amanda.h: Define DBG_SUBDIR_SERVER, DBG_SUBDIR_CLIENT
			       and DBG_SUBDIR_CLIENT.
	* amandad-src/amandad.c, changer-src/chg-scsi.c,
	  changer-src/chg-scsi-chio.c, client-src/calcsize.c,
	  client-src/killpgrp.c, client-src/rundump.c, client-src/runtar.c,
	  client-src/selfcheck.c, client-src/sendbackup.c,
	  client-src/sendsize.c,
	  oldrecover-src/amrecover.c, recover-src/amrecover.c,
	  restore-src/amfetchdump.c, restore-src/amidxtaped.c,
	  restore-src/amrestore.c, server-src/amadmin.c,
	  server-src/amcheck.c, server-src/amcleanupdisk.c,
	  server-src/amflush.c, server-src/amindexd.c,
	  server-src/amlabel.c, server-src/amlogroll.c,
	  server-src/amtape.c, server-src/amtrmidx.c,
	  server-src/amtrmlog.c, server-src/chunker.c,
	  server-src/diskfile.c, server-src/driver.c,
	  server-src/dumper.c, server-src/getconf.c,
	  server-src/infofile.c, server-src/planner.c,
	  server-src/reporter.c (dbopen): Use DBG_SUBDIR_SERVER,
					 DBG_SUBDIR_CLIENT or DBG_SUBDIR_CLIENT.

2006-07-25  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/calcsize.c: Get config on argument.
	* client-src/killpgrp.c: Get config on argument.
	* client-src/rundump.c: Get config on argument.
	* client-src/runtar.c: Get config on argument.
	* client-src/sendbackup.c: Call program with config as argument.
	* client-src/sendbackup-dump.c: Call program with config as argument.
	* client-src/sendbackup-gnutar.c: Call program with config as argument.
	* client-src/sendbackup.h: Add global g_options.
	* client-src/sendsize.c: Call program with config as argument.

2006-07-23  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendbackup-gnutar.c: Fix bug found by splint.
	* client-src/sendsize.c: Fix bug found by splint.

2006-07-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: Fix amfree(mem_splitbuf).

2006-07-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c, server-src/taper.c: Fix memory leak found
						     by coverity.

2006-07-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: Fix split_buffer allocation problem.

2006-07-22  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c, common-src/security-util.c,
	  restore-src/restore.c, server-src/diskfile.c: Fix memory leak found
							by coverity.

2006-07-20  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-scsi.c, changer-src/scsi-changer-driver.c,
	  client-src/amandates.c, client-src/calcsize.c,
	  client-src/selfcheck.c, client-src/sendbackup.c,
	  client-src/sendsize.c, common-src/security-util.c,
	  recover-src/extract_list.c, restore-src/restore.c,
	  server-src/amindexd.c, server-src/diskfile.c,
	  server-src/driver.c, server-src/reporter.c,
	  server-src/tapefile.c, server-src/taper.c: Fix memory leak found
						     by coverity.

2006-07-19  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/selfcheck.c : Read client config file.
	* client-src/sendbackup.c: Read client config file.
	* client-src/sendsize.c  : Read client config file.

2006-07-19  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.h (g_option_t): Add 'char *config';
	* amandad-src/amandad_util.c (parse_g_options): Parse 'config='.
	* common-src/amfeatures.h (fe_req_options_config): New amfeature.
	* common-src/amfeatures.c (am_init_feature_set):
						    set fe_req_options_config.
	* server-src/amcheck.c: Send 'config=' in global options.
	* server-src/dumper.c: Send 'config=' in global options.
	* server-src/planner.c: Send 'config=' in global options.

2006-07-19  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Call dbopen("amandad").
	* changer-src/chg-scsi.c: Call dbopen("server").
	* changer-src/chg-scsi-chio.c: Call dbopen("server").
	* client-src/calcsize.c: Call dbopen("client").
	* client-src/getfsent.c: Call dbopen(NULL).
	* client-src/killpgrp.c: Call dbopen("client").
	* client-src/rundump.c: Call dbopen("client").
	* client-src/runstar.c: Call dbopen("client").
	* client-src/runtar.c: Call dbopen("client").
	* client-src/selfcheck.c: Call dbopen("client").
	* client-src/sendbackup.c: Call dbopen("client").
	* client-src/sendsize.c: Call dbopen("client").
	* common-src/amanda.h (dbopen, debug_open): Take a 'char * subdir'
						    argument.
	* common-src/bsd-security.c: Call dbopen(NULL).
	* common-src/debug.c (debug_open): Call debug_setup_1(subdir)
	* common-src/debug.c (debug_setup_1): Take a subdir argument,
					      add it to dbgdir.
	* common-src/file.c: Call dbopen(NULL).
	* common-src/statfs.c: Call dbopen(NULL).
	* common-src/token.c: Call dbopen(NULL).
	* oldrecover-src/amrecover.c: Call dbopen("client").
	* recover-src/amrecover.c: Call dbopen("client").
	* restore-src/amfetchdump.c: Call dbopen("server").
	* restore-src/amidxtaped.c: Call dbopen("server").
	* restore-src/amrestore.c: Call dbopen("server").
	* server-src/amadmin.c: Call dbopen("server").
	* server-src/amcheck.c: Call dbopen("server").
	* server-src/amcleanupdisk.c: Call dbopen("server").
	* server-src/amflush.c: Call dbopen("server").
	* server-src/amindexd.c: Call dbopen("server").
	* server-src/amlabel.c: Call dbopen("server").
	* server-src/amlogroll.c: Call dbopen("server").
	* server-src/amtape.c: Call dbopen("server").
	* server-src/amtrmidx.c: Call dbopen("server").
	* server-src/amtrmlog.c: Call dbopen("server").
	* server-src/chunker.c: Call dbopen("server").
	* server-src/diskfile.c: Call dbopen("server").
	* server-src/driver.c: Call dbopen("server").
	* server-src/dumper.c: Call dbopen("server").
	* server-src/getconf.c: Call dbopen("server").
	* server-src/infofile.c: Call dbopen("server").
	* server-src/planner.c: Call dbopen("server").
	* server-src/reporter.c: Call dbopen("server").
	* server-src/taper.c: Call dbopen("server").

2006-07-17  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/chunker.c: Fix rt computation.
	* server-src/dumper.c: Fix dumptime computation.
	* server-src/taper.c: Fix rt computation.

2006-07-17  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS: Klocwork defects fixed.
	* NEWS: Coverity defect fixed.

2006-07-14  Jean-Louis Martineau <martineau@zmanda.com>
	* Makefile.am (pkgdata_DATA): add ReleaseNotes.

2006-07-14  Jean-Louis Martineau <martineau@zmanda.com>
	* Amanda 2.5.1b1 released.
	* configure.in: Remove -Werror.

2006-07-14  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendsize.c: Use read/write to copy tar snapshot file.
	* client-src/sendbackup-gnutar.c: Ditto.

2006-07-13  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/stream.c (stream_accept): Loop 5 times on select error.

2006-07-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: The datafd is not scheduled at start,
			       add test for it.
	* common-src/stream.c (tcpm_recv_token): Set error_msg.
	
2006-07-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c (free_new_argv): Move out of
					     #ifndef HAVE_LIBREADLINE.

2006-07-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c (tape): Report the number of new tapes instead
				       of "a new tape" for each tapes.
	* server-src/reporter.c (output_tapeinfo): Ditto.

2006-07-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taperscan.c (changer_taper_scan): Report error from
						       changer_find.

2006-07-11  John Franks jrfranks@zmanda.com
	* configure.in: Fix multiple definition of readline during cygwin
	  compile.

2006-07-11  Paddy Sreenivasan <paddy@zmanda.com>
	* common-src/pipespawn.c : Fixed compiler warning

2006-07-11  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amtapetype.8.xml: No default value for -e.

2006-07-11  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c: Don't conftoken_ungetc(ch) if ch == EOF.
	* server-src/reporter.c: Check tp == NULL.

2006-07-11  Jean-Louis Martineau <martineau@zmanda.com>
	* tape-src/tapetype.c: Make -e an needed argument.
	* man/xml-source/amtapetype.8.xml: Update man page.

2006-07-11  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-zd-mtx.sh.in: Remove .conf from changerfile.

2006-07-11  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c (check_file_overwrite): Renamed from
							  check_file_overwite.
	* recover-src/extract_list.c (check_file_overwrite): Do the path check
	  in the correct order (from left ro right).

2006-07-11  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/file.c (debug_agets): Remove call to dbprintf.

2006-07-10  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c (add_to_unlink_list, do_unlink_list,
	              free_unlink_list): New function to manage unlink_list.
	* recover-src/extract_list.c (check_file_overwite): Check all
	  component of an EXTRACT_LIST_ITEM, if a component is not a
	  directory, add it to the unlink_list.
	* recover-src/extract_list.c (extract_files): Call do_unlink_list and
	  free_unlink_list, rename buf to cwd.

2006-07-10  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/pipespawn.c (pipespawnv_passwd): Add prototype.
	* common-src/pipespawn.c (pipespawn, pipespawn): Remove 2 NULL
	   parameters to the pipespawnv_passwd call.
	* common-src/pipespawn.c (pipespawnv_passwd): Remove passwdvar and
	   passwdfd parameters, add passwdvar and local variable.
	   Don't use memcpy to set passwdfd.
	* common-src/pipespawn.h (pipespawnv_passwd): Remove prototype.

2006-07-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c (stream_read_sync_callback): Remove bogus
	  call of callback.

2006-07-07  Kevin Till  <ktill@zmanda.com>
	* common-src/bsd-security.c: use STREAM_BUFSIZE instead of -1
	* common-src/bsdtcp-security.c: ditto
	* common-src/krb4-security.c: ditto 
	* common-src/security-util.c: ditto
	* restore-src/amidxtaped.c: ditto

2006-07-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c (get_conftoken): Remove duplicate conftoken_ungetc.

2006-07-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Validate and report big packet size.

2006-07-07  Jean-Louis Martineau <martineau@zmanda.com>
	* oldrecover-src/Makefile.am: Typo.

2006-07-07  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/sendsize.c: Typo.

2006-07-06  John Franks	<jrfranks@zmanda.com>
	* common-src/genversion.c:
		Remove reference to error().  This causes a compile
		error on cygwin.

2006-07-06  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 128, 170, 182, 470, 517
	* changer-src/chg-scsi.c: Validate drivenum, check count_file.
	* client-src/sendsize.c: Validate level.
	* oldrecover-src/amrecover.c: Use tm.
	* recover-src/amrecover.c: Use tm.
	* server-src/infofile.c (delete_txinfofile): Use local variable.

2006-07-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: Check for cur_filename.
	* tape-src/output-file.c: Use vstrextend.
	* tape-src/tapeio.c: Check for r.

2006-07-06  Jean-Louis Martineau <martineau@zmanda.com>
	Fix splint warning
	* oldrecover-src/extract_list.c (clean_tape_list): Cleanup for splint.
	* recover-src/extract_list.c (clean_tape_list): Cleanup for splint.
	* server-src/amindexd.c: Add a /*@i@*/.
	* server-src/conffile.c: Cast to off_t for conf_init_am64.
	* server-src/driver.c: Cast to unsigned to print pid_t.
	* server-src/find.c (strip_failed_chunks): Cleanup for splint.

2006-07-06  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 114
	* server-src/amindexd.c: Free their_feature_string.
	Klocwork bug 130
	* restore-src/amrestore.c: Test maximum value for rst_flags->blocksize.
	Klocwork bug 294
	* common-src/genversion.c: Check NULL result of malloc.
	Klocwork bug 294
	* client-src/selfcheck.c: Check NULL result of fdopen.
	Klocwork bug 539, 542
	* oldrecover-src/extract_list.c: Fix pfn2->next = fn2.
	* recover-src/extract_list.c   : Ditto
	Klocwork bug 268, 272, 543, 544
	* oldrecover-src/extract_list.c: Check for cmd != NULL.
	* recover-src/extract_list.c   : Ditto
	Klocwork bug 510
	* restore-src/amidxtaped.c: Check for argv != NULL.
	Klocwork bug 435
	* changer-src/scsi-linux.c: Make buffer one larger.
	Klocwork bug 520
	* changer-src/scsi-changer-driver.c (OpenDevice): Validate parameters.
	Klocwork bug 182
	* changer-src/chg-scsi.c (clean_tape): Check usagetime != NULL.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 551
	* regex-src/regcomp.c (allocset): Check for p->g->sets
						and p->g->setbits

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 169, 170, 181
	* changer-src/chg-scsi.c: Validate input.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 282
	* common-src/file.c (rmpdir): Check for p == NULL.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 524
	* common-src/dgram.c (dgram_send_addr): Set addr_save earlier.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 495
	* server-src/taper.c (file_reader_side): Maximum value for
						 fallback_splitsize.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 532
	* recover-src/display_commands.c: Check for cmd != NULL.
	* oldrecover-src/display_commands.c: Ditto

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 410
	* restore-src/restore.c (restore): Check for tmp_filename.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 234
	* server-src/driver.c: Check for h and activehd >= 0.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 338 and 390
	* server-src/reporter.c (handle_partial, handle_strange): Check result
	  of handle_success.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 558
	* client-src/selfcheck.c (check_options, check_disk): Check for
							      calcprog == NULL

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 521
	* client-src/clientconf.c (add_client_conf): Check result of realloc.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 447 and 449
	* restore-src/restore.c: Check for valid sendbackup request.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 407
	* restore-src/restore.c (restore): Set statinfo.st_size.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 189
	* common-src/file.c (sanitise_filename): Never return NULL.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/Makefile.am:    Remove tape-src and libamtape.
	* client-src/Makefile.am:     Remove tape-src and libamtape.
	* man/Makefile.am:            Cleanup.
	* oldrecover-src/Makefile.am: Remove tape-src and libamtape.
	* recover-src/Makefile.am:    Remove tape-src and libamtape.
	
2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 236
	* server-src/driver.c (handle_dumper_result): Check for
						      dumper->ev_read != NULL.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 553
	* restore-src/restore.c (search_a_tape): Check for desired_tape == NULL.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 556 and 557
	* common-src/security-util.c (bsd_recv_security_ok): Check result of
	  strtok, check service == NULL.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 161
	* client-src/calcsize.c (calc_load_file): Return NULL if fopen fail.
	* client-src/calcsize.c (main):  check NULL result from calc_load_file.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 84
	* server-src/amflush.c (main): Check return of lookup_disk.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 62, 85, 459, 463, 466, 469, 555, 559
	* common-src/security-util.c: Check result of fdopen.
	* client-src/sendsize.c     : Ditto.
	* server-src/amcheck.c      : Ditto.
	* server-src/amflush.c      : Ditto.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 159, 375, 377, 379, 508, 509, 513, 519
	* common-src/bsd-security.c:    Replace malloc by alloc.
	* common-src/bsdudp-security.c: Ditto
	* common-src/genversion.c:      Ditto
	* recover-src/amrecover.c:      Ditto
	* restore-src/amidxtaped.c:     Ditto
	* server-src/reporter.c:        Ditto

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 562 and 475
	* recover-src/set_commands.c (cd_dir): Check result of rindex.
	* oldrecover-src/set_commands.c (cd_dir): ditto.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 552
	* restore-src/restore.c (load_manual_tape): Alloc space for cur_tapedev.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 406
	* restore-src/restore.c (restore): Check for final_filename.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 318
	* server-src/list_dir.c (add_dir_list_item): Check for cur_list->next.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 17, 32
	* server-src/amadmin.c (disklist_one): Check localtime return NULL.
	* server-src/amadmin.c (info_one)    : Ditto.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 2, 83, 128, 384, 478, 504, 505, 506, 517, 566, 567
	* server-src/amadmin.c (seqdatestr): Check localtime return NULL.
	* common-src/util.c (construct_datestamp, construct_timestamp,
			     conf_print):         Ditto.
	* oldrecover-src/amrecover.c (main):      Ditto.
	* oldrecover-src/uscan.l (ll_parse_date): Ditto.
	* recover-src/amrecover.c (main):         Ditto.
	* recover-src/uscan.l (ll_parse_date):    Ditto.
	* server-src/amflush.c (main):            Ditto.
	* server-src/reporter.c (handle_success): Ditto.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 470
	* client-src/sendsize.c (add_diskest): Check for level value.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 372
	* server-src/reporter.c (nicedate): Check month value.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 20
	* server-src/amadmin.c (tape): Limit nb_days to 10000.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	Klocwork bug 21
	* server-src/amadmin.c (balance): Test 'later' after it is set.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/alloc.c (internal_vstralloc): Don't return NULL.

2006-07-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/infofile.c (open_txinfofile): Use local variable.

2006-06-29  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c (label_of_current_slot): Close the tapefd if
	                                                 the label mismatch.

2006-06-29  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c (strip_failed_chunks):
	  - Get a **output_find as parameter.
	  - Check the label before remove a valid chunk.
	  - Memory management fix.

2006-06-28  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: Improve message for .amandahosts.

2006-06-27  Ian Turner <ian@zmanda.com>
	* common-src/fileheader.c: Fix a bug where spanned dumps would 
	  always fail.

2006-06-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Fix test for holdingdisk negative size.

2006-06-27  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in: Don't set DEFAULT_TAPE_DEVICE if it is not set.
	* client-src/clientconf.c: Work DEFAULT_TAPE_DEVICE not set.
	* common-src/genversion.c: Work DEFAULT_TAPE_DEVICE not set.
	* recover-src/amrecover.c: Work DEFAULT_TAPE_DEVICE not set.
	* server-src/getconf.c:    Work DEFAULT_TAPE_DEVICE not set.

2006-06-27  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Paul Bijnens
	* server-src/amcheck.c: Check for access(hdp->diskdir, X_OK).

2006-06-27  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/conffile.c (getconf_byname): Check for kt->keyword != NULL.
	* client-src/clientconf.c (client_getconf_byname): Ditto

2006-06-22  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: check_file_overwite.

2006-06-22  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Do the cleanup of the extract list
	                              at the extraction time
	* oldrecover-src/extract_list.c: Ditto.

2006-06-22  Jean-Louis Martineau <martineau@zmanda.com>
	* NEWS: Add new features.
	* ReleasesNotes: New files.

2006-06-22  Jean-Louis Martineau <martineau@zmanda.com>
	* docs/Makefile.am (pkgdata_DATA): Add amaespipe.8.txt amcrypt.8.txt
	  amcrypt-asym-ossl.8.txt amcrypt-ossl.8.txt amfetchdump.8.txt
	* docs/amaespipe.8.txt: New file.
	* docs/amcrypt.8.txt: New file.
	* docs/amcrypt-asym-ossl.8.txt: New file.
	* docs/amcrypt-ossl.8.txt: New file.
	* docs/amfetchdump.8.txt: New file.

2006-06-22  Jean-Louis Martineau <martineau@zmanda.com>
	* docs/Makefile.am (pkgdata_DATA): Add howto-auth.txt.
	* docs/howto-auth: Documentation on auth.
	* docs/*.txt: Update from xml-docs

2006-06-22  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Add notes about bsdudp and bsdtcp.
	* man/xml-source/amanda-client.conf.5.xml: Ditto.

2006-06-22  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c (is_empty_dir): New function.
	* recover-src/extract_list.c: Print a warning if cwd is not empty.

2006-06-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c: Allow 'p' and 'P' in --sort argument.

2006-06-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c: Print errstr returned by match_disklist.
	* server-src/amcheck.c: Print errstr returned by match_disklist.
	* server-src/amflush.c: Print errstr returned by match_disklist.
	* server-src/diskfile.c (match_disklist): Return an error str.
	* server-src/diskfile.h (match_disklist): New prototype.
	* server-src/planner.c: Print errstr returned by match_disklist.
	* server-src/reporter.c: Accept host/disk as arguments.

2006-06-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindexd.c (uncompress_file): Set LC_ALL=C before
	                                           executing sort.

2006-06-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (wait_children, kill_children): New function.
	* server-src/driver.c (wait_for_children): Use wait_children and
	                                           kill_children.
	* server-src/driver.c (main): Use wait_children.
	* server-src/driverio.c (taper_cmd, chunker_cmd): Close socket on QUIT
	                                                  or ABORT command.

2006-06-22  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amfeatures.c (am_init_feature_set): Set
	  fe_amrecover_feedme_tape.
	* common-src/amfeatures.h (fe_amrecover_feedme_tape): New amfeatures.
	* common-src/fileheader.c (print_header): Fix.
	* recover-src/extract_list.c: Use fe_amrecover_feedme_tape.
	* restore-src/amfetchdump.c: Print error if get_lock == 0.
	* restore-src/amidxtaped.c: Call send_message if get_lock == 0.
	* restore-src/restore.c: Split search_tapes in 5 functions.
	* restore-src/restore.h (send_message): prototype.

2006-06-22  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amfetchdump.8.xml: Document -O and new -o.
	* restore-src/amfetchdump.c: Replace -o by -O

2006-06-22  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/clientconf.c (parse_client_conf): Fix segmentation fault.
	* server-src/conffile.c (parse_server_conf): Fix segmentation fault.

2006-06-21  Kevin Till <ktill@zmanda.com>
        * changer-src/chg-juke.sh.in
        * changer-src/chg-manual.sh.in
        * changer-src/chg-mcutil.sh.in
        * changer-src/chg-multi.sh.in
        * changer-src/chg-mtx.sh.in
        * changer-src/chg-rait.sh.in
        * changer-src/chg-disk.sh.in
        * changer-src/chg-zd-mtx.sh.in
        * changer-src/chg-null.sh.in
        * changer-src/chg-chs.sh.in
        * client-src/patch-system.sh.in
        * amplot/amplot.sh.in
        * server-src/amcrypt-ossl.sh.in
        * server-src/amrmtape.sh.in
        * server-src/amcleanup.sh.in
        * server-src/amverifyrun.sh.in
        * server-src/amaespipe.sh.in
        * server-src/amdump.sh.in
        * server-src/amcrypt.sh.in
        * server-src/amcrypt-ossl-asym.sh.in
        * server-src/amcheckdb.sh.in
        * server-src/amfreetapes.sh.in
        * server-src/amverify.sh.in
         change /bin/sh to @SHELL@ for configure to pick up the correct
         shell. Sourceforge bug 1466655
	* man/xml-source/amcrypt-ossl-asym.8.xml: it's backup-privkey.pem

2006-06-20  Kevin Till <ktill@zmanda.com>
        * common-src/security-util.c: ignore EINTR in net_writev
	  patch by Jean-Louis Martineau.

2006-06-20  John Franks <jrfranks@zmanda.com>
	* server-src/conffile.c:
		Remove Duplicate keyword table entries and alphabetize
		to make future duplicates easier to spot...

	* server-src/taper.c:
		Fix compiler warnings when no mmap function is present.

2006-06-20  John Franks <jrfranks@zmanda.com>
	* server-src/diskfile.c:
		Default boolean values without parameters to yes if
		no value is present in configuration file.  This
		maintains backward compatibility and is logical since
		a value such as "index" reads as an assertion of fact.

2006-06-19  Jean-Louis Martineau <martineau@zmanda.com>
	* docs/wishlist.txt: Remove features done in 2.5.0/2.5.1

2006-06-19  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: amrecover_check_label and
	                                    amrecover_do_fsf default to yes.
	* server-src/conffile (init_dumptype_defaults): DUMPTYPE_INDEX set to 1.
	* server-src/diskfile.c (parse_diskline): index set from
	                                          dumptype_get_index.

2006-06-16  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl.in: Match quotes in DONE line.

2006-06-16  Kevin Till <ktill@zmanda.com>
        * example/amanda-client.conf.in:
         correct DEFAULT_TAPE_SERVER/DEFAULT_SERVER
	* server-src/amcrypt-ossl-asym.sh.in:
          set RANDFILE for openssl to place entropy file.
        * server-src/amcrypt-ossl.sh.in: ditto

2006-06-16  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c   : Use strcasecmp to compare auth.
	* client-src/selfcheck.c  : Ditto
	* client-src/sendbackup.c : Ditto
	* restore-src/amidxtaped.c: Ditto
	* server-src/amindexd.c   : Ditto

2006-06-16  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindexd.c (reply, lreply, fast_lreply): Correct use
	  of arglist_start and arglist_end..
	* server-src/amindexd.c (lreply_backend): Remove function.

2006-06-16  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsd-security.c (stream_read_callback): Send error to the
	                                                    callback.

2006-06-16  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c: Typo.
	* restore-src/restore.c: Typo.

2006-06-16  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/clientconf.c: Allow include.
	* client-src/clientconf.c (read_confline): Don't crash.
	* server-src/conffile.c (read_confline): Don't crash.
	* recover-src/amrecover.c: Exit if error in conf file.

2006-06-16  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/arglist.h: Typo.
	* recover-src/extract_list.c: handle MESSAGE from amidxtaped.

2006-06-16  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amfeatures.c (am_init_feature_set): Set
	                                                 fe_amrecover_message.
	* common-src/amfeatures.h (am_feature_e): Add fe_amrecover_message.
	* common-src/arglist.h (printf_arglist_function3): Prototype.

2006-06-16  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c (send_message): New function that send message
	                                        to stderr and/or amrecover.
	* restore-src/restore.c: Call send_message on some error path.

2006-06-16  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/event.c (event_loop_wait, event_wait): Take an
	                                 event_handle_t * as parameter.
	* common-src/event.h: New prototype.
	* common-src/bsd-security.c: Call event_wait(bs->ev_read).
	* common-src/krb4-security.c: Call event_wait(ks->ev_read).
	* common-src/krb5-security.c: Call event_wait(ks->ev_read).
	* common-src/security-util.c: Call event_wait(ss->ev_read).

2006-06-15  Kevin Till <ktill@zmanda.com>
        * man/xml-source/amcrypt-ossl-asym.8.xml: it's .am_passphrase
	* server-src/amcrypt-ossl-asym.sh.in: export PATH
        * server-src/amcrypt-ossl.sh.in: export PATH


2006-06-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: -w doesn't change the test selection.
	* man/xml-source/amcheck.8.xml

2006-06-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Log empty disklist and no DLE selected.

2006-06-14  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsd-security.c: Use %u to print in_port_t data.
	* common-src/bsdudp-security.c: Ditto.

2006-06-14  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-disk.sh.in: Return the number of slot in output of
	                              the -info command.
	* changer-src/chg-zd-mtx.sh.in: Ditto.

2006-06-14  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/chg-zd-mtx.sh.in: Accept changerfile that already
	                                have the .conf suffix.

2006-06-13  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c (s_ackwait): Resend the REP on receive of a
	                                     duplicate REQ.

2006-06-13  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c (bsd_recv_security_ok): Set error only
	  if we get an error.

2006-06-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: usetimestamps is a warning.

2006-06-12  Kevin Till <ktill@zmanda.com>
        * common-src/security-util.c: if host is 127.0.0.1 and either
          localhost or localhost.domain is in .amandahost, hostmatch passes.
        * common-src/security-util.h: update check_user_amandahosts prototype

2006-06-12  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c (process_writenetfd): Close the pipe if the
	                                              security_stream is closed.
	* recover-src/extract_list.c: Improve message if we don't get thei
	                              FEATURE line from amidxtaped.

2006-06-12  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/amrecover.c: Read amanda-client.conf and
				   <conf>/amanda-client.conf.

2006-06-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c, common-src/tapelist.c,
	  restore-src/restore.c, server-src/amcheck.c, server-src/amindexd.c,
	  server-src/amtape.c, server-src/changer.c, server-src/driver.c,
	  server-src/planner.c, server-src/taper.c,
	  server-src/taperscan.c: Fix memory leak.

2006-06-12  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c: Fix Adding at end of list.

2006-06-12  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c (syncpipe_putstr): Don't crash if str is NULL.

2006-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/holding.c (pick_datestamp): Fix reading user input.

2006-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/amrecover.c (sigint_handler): Call send_command only if
						    amindexd is alive.

2006-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c (connect_port): ETIMEDOUT is a fatal error.

2006-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/stream.c (stream_client_internal): Get errno set
	                                                correctly.
	* server-src/driver.c (handle_chunker_result): Don't assert(0) on
	                      receive of a TRYAGAIN from a chunker, but set
	                      chunker->result.
	* server-src/dumper.c: Try gethostbyname("localhost") before calling
	                       stream_client and log appropriate message.

2006-06-09  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Report ERROR if gethostbyname("localhost")
				doesn't succeed.

2006-06-08  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/clientconf.c (add_client_conf): New function to map
						     normal option to their
						     -o equivalent.
	* client-src/clientconf.h (add_client_conf): Prototype.
	* man/xml-source/amrecover.8.xml: Document -o.
	* recover-src/amrecover.c: Also read <config>/amanda-client.conf

2006-06-08  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c (parse_diskline): Only return 0 or -1.

2006-06-08  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.h (g_option_t): Add auth.
	* amandad-src/amandad_util.c (init_g_options): Set auth to NULL.
	* amandad-src/amandad_util.c (parse_g_options): Parse auth.
	* amandad-src/amandad_util.c (free_g_options): Free auth.
	* client-src/sendbackup.c: Get amandad_auth from command line and
				   compare with REQ packet.
	* common-src/amfeatures.h (fe_amindexd_options_hostname,
				   fe_amindexd_options_features,
				   fe_amindexd_options_auth,
				   fe_amidxtaped_options_hostname,
				   fe_amidxtaped_options_features,
				   fe_amidxtaped_options_auth): New amfeatures.
	* common-src/amfeatures.c (am_init_feature_set): Set new amfeatures.
	* recover-src/amrecover.c: Send auth in OPTIONS of req packet.
	* recover-src/extract_list.c: Send auth in OPTIONS of req packet.
	* restore-src/amidxtaped.c: Parse amandad_auth from command line.
				    Get auth from OPTIONS line.
				    Compare them.
	* server-src/amindexd.c: Parse amandad_auth from command line.
				 Get auth from OPTIONS line.
				 Compare them.

2006-06-08  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c(connect_port): Return -2 on ECONNREFUSED error
					   from connect.

2006-06-07  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: exec the service with the auth as parameter.
	* amandad-src/amandad.c(writebuf): Do no close fd.
	* client-src/selfcheck.c: Read the auth for the command line and
				  compare with the option string.
	* client-src/selfcheck.c(main): Do no close 0,1,2 fd.

2006-06-07  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.8.xml(CONFIGURATION OVERWRITE): New section.
	* man/xml-source/amadmin.8.xml,   man/xml-source/amcheck.8.xml,
	  man/xml-source/amdump.8.xml,    man/xml-source/amflush.8.xml,
	  man/xml-source/amgetconf.8.xml, man/xml-source/amlabel.8.xml,
	  man/xml-source/amreport.8.xml,
	  man/xml-source/amrestore.8.xml: Add -o option.

2006-06-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c(get_conftoken): Merge from zmanda.

2006-06-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c(get_conftoken): Remove a conftoken_ungetc.

2006-06-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsd-security.c (stream_read_callback): Merge with zmanda.

2006-06-07  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c(process_writenetfd): Call security_stream_read
						     only if size > 0.

2006-06-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/conffile.c (lookup_interface): Fix merge error.

2006-06-07  John Franks <jrfranks@zmanda.com>
	* common-src/amanda.h:
		Fix isnormal() replacement macro to indirectly
		check if a floating point value is != 0.0.
		This prevents compiler warnings.

2006-06-07  John Franks <jrfranks@zmanda.com>
	* common-src/util.c
		Put in "/* NOTREACHED */" comments after error() calls.
	* server-src/diskfile.c
		Change disktype index default to yes for backward compatibility.

2006-06-06  John Franks <jrfranks@zmanda.com>
	* amandad-src/amandad.c common-src/bsd-security.c:
		Correct fix for infinite amandad loop.

2006-06-06  John Franks <jrfranks@zmanda.com>
	* common-src/stream.c common-src/util.c:
		Lint clean again.
	* server-src/conffile.c:
		Remove replicated line

2006-06-06  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c (conftoken_ungetc): Return the character.
	* common-src/util.c (get_conftoken): Merge to allow escape character.
	* common-src/util.c (read_block): Allow STRING as IDENT.
	* server-src/conffile.c (getconf_long, getconf_size): New function.
	* server-src/conffile.c: Cleanup after Merge.

2006-06-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c, server-src/amcheck.c, server-src/amflush.c,
	  server-src/amlabel.c, server-src/amlogroll.c, server-src/amtrmidx.c,
	  server-src/amtrmlog.c, server-src/getconf.c,
	  server-src/reporter.c: Usage -o
	* server-src/amflush.c, server-src/amlogroll.c, server-src/amtrmidx.c,
	  server-src/amtrmlog.c, server-src/chunker.c, server-src/driver.c,
	  server-src/dumper.c, server-src/getconf.c, server-src/planner.c,
	  server-src/reporter.c,
	  server-src/taper.c: Add call to report_bad_conf_arg.
	* server-src/conffile.c(get_comprate, get_compress): Parse CONF_END.

2006-06-06  John Franks <jrfranks@zmanda.com>
	* configure.in:
		Increase checking level from 1 to 2 for SUN lint.
	* client-src/amandates.c client-src/clientconf.c
	  common-src/security-util.c recover-src/amrecover.c
	  recover-src/extract_list.c regex-src/regcomp.c server-src/amcheck.c
	  server-src/amlabel.c server-src/chunker.c server-src/conffile.c
	  server-src/conffile.h server-src/diskfile.c server-src/diskfile.h
	  server-src/driver.c server-src/holding.c server-src/reporter.c
	  server-src/tapefile.c server-src/taper.c tape-src/amdd.c:
		Lint clean again.
	* common-src/util.h common-src/util.c:
		Lint clean again.
		Add missing conftype size.
	* common-src/bsd-security.c
		Fix infinte loop which consumes all /tmp space and 1/2
		the CPU time when EOF is reached on socket.

2006-06-05  Paddy Sreenivasan <paddy@zmanda.com>
        * common-src/util.c: Fix warning

2006-06-05  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/amfetchdump.c, server-src/amcheck.c,
	  server-src/amcheckdb.sh.in, server-src/amcleanup.sh.in,
	  server-src/amdump.sh.in, server-src/amflush.c,
	  server-src/amlabel.c, server-src/amlogroll.c,
	  server-src/amtrmidx.c, server-src/amtrmlog.c,
	  server-src/chunker.c, server-src/conffile.c,
	  server-src/diskfile.c, server-src/driver.c,
	  server-src/driverio.c, server-src/dumper.c,
	  server-src/getconf.c, server-src/planner.c,
	  server-src/reporter.c, server-src/taper.c,
	  server-src/taperscan.c: Allow -o options and some memory fix.
	* server-src/conffile.c(lookup_dumptype, lookup_tapetype,
	  lookup_interface): Use strcasecmp.

2006-06-02  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/stream.c (stream_client_internal): Use connect_portrange.
	* common-src/util.c (connect_portrange): First, try to connect with a
						 port already used.
	* common-src/util.c (connect_port): Try to connect with a specific port.
	* common-src/util.h: Cleanup.

2006-06-02  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c: Remove empty if.

2006-06-02  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/util.c (read_block): Don't read CONF_NL aftre the '{'.
	* server-src/conffile.c(get_holdingdisk, get_tapetype, get_interface):
	  Read a CONF_NL after the call to read_block.
	* server-src/conffile.c(read_dumptype): Read a CONF_NL if we are not
	                                        called from diskfile.
	* server-src/diskfile.c: Don't loop on empty line after read_dumptype.

2006-06-01  Kevin Till  <ktill@zmanda.com>
        * server-src/amcrypt-ossl.sh.in: symmetric encrypt script using openSSL.
          Thanks to Ben Slusky.
        * server-src/amcrypt-ossl-asym.sh.in: public-ley encrypt script using openSSL.
        * man/xml-source/amcrypt-ossl.8.xml: man page
        * man/xml-source/amcrypt-ossl-asym.8.xml: man page
        * configure.in: ditto
        * man/Makefile.am: ditto
        * man/entities/global.entities: ditto
        * server-src/Makefile.am: ditto

2006-06-01  John Franks <jfranks@zmanda.com>
	Eliminate Cygwin compile warnings.
	* client-src/getfsent.c:  Quiet unused parameter warnings.
	* client-src/selfcheck.c: Quiet unused parameter warnings.
	* common-src/security-util.h: Make hostname const char *.

2006-06-01  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: holdingdisk_get_disksize() return an off_t.
	* server-src/find.c: result should be ssize_t.

2006-06-01  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amanda.h: Remove am64_t.
	* client-src/clientconf.c, client-src/clientconf.h, common-src/util.c,
	  common-src/util.h, server-src/conffile.c, server-src/conffile.h:
	  Second pass of config cleanup, add function to parse -o argument.
	* recover-src/amrecover.c: -o command argument.
	* restore-src/restore.c: Use off_t instead of am64_t.
	* server-src/amadmin.c: New config subcommand. -o command argument.
	* server-src/amlabel.c: Fix memory leak.
	* server-src/diskfile.c: Fix memory leak.
	* server-src/diskfile.h: Rename no_hold to to_holdingdisk.
	* server-src/driver.c: Many.
	* server-src/planner.c: am64_t to off_t.

2006-06-01  Jean-Louis Martineau <martineau@zmanda.com>
	This is the first pass of a general rewrite of configuration file
	parsing, It will now use array to store all options.

	* client-src/clientconf.c:
	* client-src/clientconf.h:
	* server-src/conffile.c:
	* server-src/conffile.h:
	* common-src/util.c: Many new functions.
	* common-src/util.h:

	* restore-src/amidxtaped.c, server-src/amcheck.c,
	  server-src/amcleanupdisk.c, server-src/amlabel.c,
	  server-src/diskfile.c, server-src/driver.c, server-src/driverio.c,
	  server-src/find.c, server-src/holding.c, server-src/planner.c,
	  server-src/reporter.c,
	  server-src/taper.c: Use new macro to get configuration option.

2006-06-01  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c, client-src/amandates.c, client-src/noop.c,
	  client-src/selfcheck.c, client-src/sendsize.c,
	  common-src/bsd-security.c, common-src/bsdtcp-security.c,
	  common-src/bsdudp-security.c, common-src/fileheader.c,
	  common-src/rsh-security.c, common-src/security-util.c,
	  common-src/security-util.h, common-src/ssh-security.c,
	  recover-src/extract_list.c, server-src/amcheck.c,
	  server-src/amindexd.c, server-src/amlogroll.c,
	  server-src/diskfile.c, server-src/driver.c, server-src/dumper.c,
	  server-src/find.c, server-src/logfile.c, server-src/planner.c,
	  server-src/reporter.c,
	  server-src/tapefile.c: Fix memory and fd leak.

2006-06-01  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/find.c (search_holding_disk): Take the datestamp from the
	  file, not the directory name, otherwise usetimestamps=no doesn't
	  work.

2006-06-01  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/stream.c (stream_server): New priv parameter if we want
					       a reserved port. Don't try to
					       get a reserved port if priv==0.
	* common-src/stream.h (stream_server): New prototype.
	* common-src/bsd-security.c: Call stream_server with priv==0.
	* common-src/krb4-security.c: Call stream_server with priv==1.
	* common-src/security-util.c: Call stream_server with priv==0.
	* restore-src/amidxtaped.c: Call stream_server with priv==0.
	* server-src/chunker.c: Call stream_server with priv==0.
	* server-src/taper.c: Call stream_server with priv==0.

2006-06-01  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/diskfile.c: Return -1 if open of diskfile failed.
	* server-src/driver.c: Change message if didn't get a DATE line.
	* server-src/reporter.c: Ignore faillure in reading amanda.conf
				 disklist and tapelist.

2006-05-29  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.8.xml: Documents service in .amandahosts.

2006-05-29  Jean-Louis Martineau <martineau@zmanda.com>
	Previous patch doesn't work because 'make -j2' will use fd 3.
	* amandad-src/Makefile.am: Use a temporary file for output of
				   'make listlibsrc'.
	* changer-src/Makefile.am: Ditto.
	* client-src/Makefile.am: Ditto.
	* common-src/Makefile.am: Ditto.
	* oldrecover-src/Makefile.am: Ditto.
	* recover-src/Makefile.am: Ditto.
	* restore-src/Makefile.am: Ditto.
	* server-src/Makefile.am: Ditto.
	* tape-src/Makefile.am: Ditto.

2006-05-29  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/Makefile.am: 'make listlibsrc' send it's ouput to fd 3.
	* changer-src/Makefile.am: Ditto.
	* client-src/Makefile.am: Ditto.
	* common-src/Makefile.am: Ditto.
	* oldrecover-src/Makefile.am: Ditto.
	* recover-src/Makefile.am: Ditto.
	* restore-src/Makefile.am: Ditto.
	* server-src/Makefile.am: Ditto.
	* tape-src/Makefile.am: Ditto.

2006-05-28  Paddy Sreenivasan <paddy@zmanda.com>
        * tape-src/tapeio.c : Fixed warnings
        * tape-src/output-rait.c : Fixed warnings
        * tape-src/output-null.c : Fixed warnings
        * tape-src/output-file.c : Fiexed warnings
        * recover-src/amrecover.c: Fixed warnings
        * recover-src/extract_list.c : Fixed warnings
        * server-src/amadmin.c : Fixed warnings
        * server-src/driver.c : Fixed warnings
        * server-src/infofile.c : Fixed warnings

2006-05-26  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/conffile.c (read_dumptype): Parse SSH_KEYS.

2006-05-26  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c (udp_inithandle): Remove bad merge.
	* server-src/amindexd.c: Improve error message.
	* server-src/planner.c: Add a space in output.

2006-05-26  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/conffile.c: Set dpcur.no_hold correctly,
				 Fix for conffile program.

2006-05-26  Jean-Louis Martineau <martineau@zmanda.com>
	Allow many services to share the same tcp connection for
	bsdtcp/ssh/rsh.
	Add a security_close_connection to the security-api.
	* amandad-src/amandad.c (wait_30s, exit_on_qlength): New variable to
					control auth specific behaviour.
	* common-src/bsd-security.c: Add sec_close_connection_none.
	* common-src/bsdudp-security.c: Add sec_close_connection_none.
	* common-src/krb4-security.c: Add sec_close_connection_none.
	* common-src/krb5-security.c: Add sec_close_connection_none.
	* common-src/security.h (security_close_connection): Prototype.
	* common-src/security-util.h (sec_close_connection_none,
				      tcpm_close_connection): Prototype.
	* common-src/security-util.h (struct tcp_conn): Add toclose.
	* common-src/security-util.h (struct sec_stream): Add closed_by_me and
							  closed_by_network.
	* common-src/security-util.c (sec_close_connection_none,
				      tcpm_close_connection): New function.
	* common-src/security-util.c: Handle many services on one connection.
	* common-src/bsdtcp-security.c: Handle many services on one connection.
	* common-src/rsh-security.c: Handle many services on one connection.
	* common-src/ssh-security.c: Handle many services on one connection.
	* recover-src/amrecover.c: Add call security_close_connection.
	* recover-src/extract_list.c: Add call security_close_connection.
	* server-src/amcheck.c: Add call security_close_connection.
	* server-src/dumper.c: Add call security_close_connection.

2006-05-26  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c (bsd_prefix_packet): We need the username
	  of the getuid() user.

2006-05-26  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/fileheader.c: Parse datestamp on F_TAPEEND.
	* restore-src/amrestore.c: Set read_result to the result of
				   read_file_header.
	* restore-src/restore.c (read_file_header): Return a ssize_t.
			Rename bytes_read by read_result.
			Set read_result to the result of read_file_header.
	* restore-src/restore.h (read_file_header): New prototype.

2006-05-25  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taperscan.c: Replace bogus newvstralloc by vstrextend.

2006-05-25  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/getfsent.c (print_entry): Add prototype.
	* common-src/token.c (main): Shut up compiler warning.
	* server-src/infofile.c (dump_rec, dump_db): Add prototype.

2006-05-25  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c, common-src/bsd-security.c,
	  common-src/bsdtcp-security.c, common-src/bsdudp-security.c,
	  common-src/event.c, common-src/krb5-security.c,
	  common-src/protocol.c, common-src/rsh-security.c,
	  common-src/security-util.c, common-src/ssh-security.c,
	  common-src/util.c, server-src/driver.c: comment debugging.

2006-05-25  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security-util.c: typo.
	* server-src/amcheck.c: Make sure all check are done.

2006-05-25  Jean-Louis Martineau <martineau@zmanda.com>
	Fix for program not compiled by default.
	make bsdsecurity still not compile.
	* common-src/bsd-security.c(bind_portrange): prototype change.
	* common-src/Makefile.am (STANDARD_COMMON_STUFF_NOT_FILE): Add match.o.
	* server-src/conffile.c: Many typo.
	* tape-src/tapeio.c: Use OFF_T_FMT and SSIZE_T_FMT when needed, typo.
	
2006-05-25  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/fileheader.c (validate_datestamp): Works for 8 characters
							datestamp.
	* common-src/security-util.c (tcpm_send_token): netlength must be
							uint32_t.
	* common-src/security-util.c (bsd_prefix_packet): Fix typo.
	* common-src/util.c (get_time): Don't do computation for starttime.
	* server-src/conffile.c (read_dumptype): Do computation for starttime.

2006-05-25  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/krb5-security.c (krb5_sendpkt, krb5_stream_read_sync,
				      recv_token): Return ssize_t.
	* common-src/krb5-security.c (krb5_accept, krb5_stream_accept,i
				      krb5_stream_auth): Shut up compiler.
	* tape-src/output-file.c: Use SSIZE_MAX instead of SSIZE_T_MAX.

2006-05-25  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in(AM_INIT_AUTOMAKE): Fix.

2006-05-25  John Franks <jrfranks@zmanda.com>
	Pass user CFLAGS correctly to machine generated code and do not
	enforce code quality checks on them.
	* configure.in:
	  Put compiler code check flags into existing, but previously
          unused, AM_CFLAGS for Makefiles to pick up.  CFLAGS should
	  now only contain mandatory flags.

	* recover-src/Makefile.am  oldrecover-src/Makefile.am:
	  Use CFLAGS for compiling C code generated from uparse.y and uscan.l

2006-05-24  John Franks <jrfranks@zmanda.com>
	Add support for binary path names on disk and in configuration files.
           (Allow spaces in filenames.)

	Allow quoted strings for disklist entries.

	Lint clean code using sun lint, splint and strict GCC warnings. 
	Type / size clean, dead code removal, portibility checks, etc.
	Many checks are still turned off.  See configure.in for lint flags used.

	Increase debug output in /tmp/amanda/*debug files.

	Set SO_REUSEADDR on sockets help avoid running out of ports.

	* configure.in:
		Added lint program discovery with specific targets for SUN lint and splint.
		Check each compiler option to see if GCC supports it.
		Enable more code quality warnings.
		Change missing xsltproc to warning rather than error.
		Define _GNU_SOURCES to build flags.
		Make size_t and time_t printf format macros.
		Check for isnormal() availability.
		Don't install man pages if they are not built.
		Fix man pages to not attempt build or install if
			--without-built-manpages is set.

	* Makefile.am amandad-src/Makefile.am changer-src/Makefile.am
	  client-src/Makefile.am common-src/Makefile.am
	  oldrecover-src/Makefile.am recover-src/Makefile.am
	  restore-src/Makefile.am server-src/Makefile.am tape-src/Makefile.am:
		Add lint target.

	* common-src/amanda.h common-src/dgram.c common-src/stream.c
	  common-src/util.c:
		Keep checking for ports on all bind errors.
		Delay and retry a few times if all ports are busy.
		Retry bind failures after all methods fail.
		increase bind checking timeout to 30 minutes.

	* client-src/amandad.c
		Issue wait when any child exits.  (Get rid of defunct processes)
		Stat() index file before using system command.
		  (shell is not reporting failure if index is not present)

	* recover-src/extract_list.c:
	  Fix problem of 'add *' not adding directories.
	  Fix problem of freeing pointer not obtained through malloc.
	  Touch up file addition to actually use the file names
	     retrieved when adding a directory and not the directory itself.

	* server-src/taper.c
		Strenghten error recovery for broken syncpipes and writer errors.

	* changer-src/chg-scsi-chio.c client-src/amandates.c
	  client-src/client_util.c client-src/findpass.c client-src/getfsent.c
	  client-src/selfcheck.c client-src/sendbackup-gnutar.c
	  client-src/sendbackup-star.c client-src/sendbackup.c
	  client-src/sendsize.c common-src/bsd-security.c common-src/file.c
	  common-src/krb5-security.c server-src/amcheck.c server-src/amindexd.c
	  server-src/diskfile.c server-src/driver.c server-src/dumper.c
	  server-src/holding.c server-src/infofile.c server-src/logfile.c
	  server-src/tapefile.c:
		allow empty lines in input streams.

	* recover-src/uparse.y
		print message when input is garbage.

	* server-src/getconf.c:
		Define HOSTNAME_INSTANCE if it was not already defined
		for Kerberos.

	* configure.in: Make readline warning less specific.  Readline is
	  used by all input from terminal now.

2006-05-24  Kevin Till <ktill@@zmanda.com>
	* client-src/sendbackup.c: ignore SIGINT
	* common-src/ssh-security.c: add to total only when n > 0
	* common-src/ssh-security.c: add ssh to error,
	  retry writev when EINTR, EAGAIN is seen
	  to STDOUT. exit when options is chosen in template mode.
	* server-src/driver.c: make sure timestamp is not null
	* amanda/configure.in: remove template.d/amanda.conf which is a dup 
	  of amanda-harddisk.conf
	* example/Makefile.am: add template.d/README
	* amanda-harddisk.conf.in: set tapedev
	* recover-src/amrecover.c: aclose socket before exit.
	* recover-src/extract_list.c: ditto
	* amanda_enterprise.spec: remove template.d/amanda.conf, add template.d/README
	  in the failure cases. <> user input field.
	* server-src/amcheck.c: no quoted text is a warning
	* server-src/driver.c: no need to amfree qname
	  argument. Search mtx in PATH too.
	* example/template.d/advanced.conf.in: fix comment for autoflush
	* example/template.d/advanced.conf.in: add usetimestamps
	* server-src/diskfile.c: to catch unsupported compress-encryption
	  combination and abort amdump gracefully.
	* man/xml-source/amanda.conf.5.xml: fix syntax, add 
	  dumptype references.	
	* man/xml-source/amanda.8.xml: fix syntax
	* configure.in:			ditto
	* man/Makefile.am:		ditto
	* example/amanda.conf.in:	tidy up
        * man/xml-source/amaespipe.8.xml: add uuencode as requirement
        * man/xml-source/amcrypt.8.xml:   add uuencode as requirement
        * server-src/amcheck.c: catch dumptype misconfiguration
        * server-src/diskfile.c: ditto
        * server-src/driverio.c: ditto
        * server-src/planner.c:  ditto
        * server-src/conffile.c: check includefile before calling
          read_conffile_recursively
	* example/amanda.conf.in:	add public-key encryption dumptype example
	* man/xml-source/amanda.8.xml:  fix some formatting	
	* server-src/planner.c: adjust setuid() calling sequences so that ssh can work
	* server-src/dumper.c:  ditto
	* configure.in:		     add LOW_TCPPORTRANGE for amrecover
	* common-src/stream.c:       use LOW_TCPPORTRANGE
	* server-src/amdump.sh.in:   check if config is supplied
	* man/xml-source/amrestore.8.xml: add notes on "-f" option

2006-05-24  Ian Turner <ian@zmanda.com>
	* configure.in: Properly document --without-xsltproc as itself, 
	  and not the (nonexistant) option --without-built-manpages.

2006-05-16  John Franks <jrfranks@zmanda.com>
	* amandad-src/amandad.c client-src/clientconf.c common-src/bsd-security.c
	  common-src/bsdudp-security.c common-src/dgram.c common-src/krb4-security.c
	  common-src/krb5-security.c common-src/match.c common-src/packet.c
	  common-src/security-util.c common-src/security-util.h
	  common-src/security.h common-src/util.c oldrecover-src/Makefile.am
	  oldrecover-src/set_commands.c recover-src/amrecover.c
	  recover-src/extract_list.c server-src/conffile.c server-src/driver.c
	  server-src/dumper.c server-src/planner.c server-src/reporter.c:
		Minimal changes to get tree to compile along with some more
		debugging output.

2006-05-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c (disklist_one): print spindle.

2006-05-12  Jean-Louis Martineau <martineau@zmanda.com>
	* commmon-src/bsd-security.c: Typo.

2006-05-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/Makefile.am (noinst_HEADERS): Add security-util.h.

2006-05-12  Jean-Louis Martineau <martineau@zmanda.com>
	Build a big tok_t enum for server and client config.
	* client-src/clientconf.c: Move many things to util.c.
	* client-src/clientconf.h: Remove extern variable.
	* common-src/util.c: Add common part of clientconf.c and conffile.c
	* common-src/util.h: Prototype.
	* server-src/conffile.c: Move many things to util.c.
	* server-src/diskfile.c(disk_parserror): Rename from parserror.
	* server-src/taper.c: Make many variable static.

2006-05-12  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c: Fix use of possibly NULL input.

2006-05-12  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/ssh-security.c (ssh_connect): Retrieve ssh_keys from
	                                           configuration.
	* server-src/amadmin.c(disklist_one): Print ssh_keys.
	* server-src/conffile.c(SSH_KEYS): Parse new dumptype option.
	* server-src/conffile.h(dumptype_t): Add ssh_keys.
	* server-src/diskfile.c(parse_diskline): Copy new field.
	* server-src/diskfile.h(disk_t) Add ssh_keys.
	* server-src/driverio.c(dumper_cmd): Send dp->ssh_keys in a PORT_DUMP
	                                     command to the dumper.
	* server-src/dumper.c: Parse ssh_keys in a PORT_DUMP command.
	* server-src/dumper.c(dumper_get_security_conf): Return the ssh_keys.
	* server-src/server_util.c(amhost_get_security_conf): Return the
	                                                      ssh_keys.

2006-05-12  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Set allow_many_services to 0 if auth=bsdtcp.
	* common-src/bsd-security.c: Use security-util.c.
	* common-src/bsdtcp-security.c: New security-api.
	* common-src/bsdudp-security.c: New secutity-api.
	* common-src/krb4-security.c: Use security-util.c.
	* common-src/krb5-security.c: Use security-util.c.
	* common-src/Makefile.am (libamanda_la_SOURCES): Add bsdtcp-security.c,
							     bsdtcp-security.c
							 and security-util.c.
	* common-src/protocol.c: Debuging cleanup.
	* common-src/rsh-security.c Use security-util.c.
	* common-src/security.c: Use bsdtcp_security_driver
				 and bsdudp_security_driver.
	* common-src/security.h(accept): New prototype.
	* common-src/security-util.c: Many common function for security-api.
	* common-src/security-util.h: many prototype for security-api.
	* common-src/ssh-security.c Use security-util.c.
	* common-src/stream.c (stream_client_internal): Call connect_portrange.
	* common-src/util.c (make_socket): Make a socket.
	* common-src/util.c (connect_portrange): Make a socket, bind it and
						 connect.
	* common-src/util.h (connect_portrange): Prototype.
	* configure.in: new --with-bsdtcp-security and --with-bsdudp-security.

2006-05-10  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by <amanda@inventivetechnology.at>
	* man/xml-source/amrecover.8.xml: Document listhost command.

2006-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by <amanda@inventivetechnology.at>
	* server-src/amindexd.c: new LISTHOST command.
	* recover-src/set_commands.c (list_host): New function.
	* recover-src/amrecover.h (list_host): Prototype.
	* recover-src/help.c (list_host): Print help.
	* recover-src/uscan.l: Parse listhost command.
	* recover-src/uparse.y: LISTHOST command.
	* oldrecover-src/set_commands.c (list_host): New function.
	* oldrecover-src/amrecover.h (list_host): Prototype.
	* oldrecover-src/help.c (list_host): Print help.
	* oldrecover-src/uscan.l: Parse listhost command.
	* oldrecover-src/uparse.y: LISTHOST command.

2006-05-08  Ian Turner <ian@zmanda.com>
	* server-src/amcheck.c: Make it an error when the expected new 
	  tape cannot be found. Thanks to Paul Bijnens
	  <paul.bijnens@xplanation.com> for the patch and to Jason L 
	  Tibbitts III <tibbs@math.uh.edu> for noticing this problem.

2006-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* driverio.h (shed_s): Add est_nsize, est_csize, degr_nsize, degr_csize
	                       for nativa and compressed estimate size.
	* planner.c: Send the native and compressed estimate size to the driver.
	* driver.c: log with L_STATS the estimate of a successful dump.
	* reporter.c: Parse the L_STATS.
	* reporter.c(generate_bad_estimate): New function that will put in the
	                                     NOTES section all bad estimate.

2006-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in (AC_CONFIG_FILES): Add oldrecover-src/Makefile.
	* Makefile.am (RECOVER_SUBDIRS): Add oldrecover-src.
	* oldrecover-src/amrecover.c: Copy of old recover-src/amrecover.c
	* oldrecover-src/amrecover.h: Copy of old recover-src/amrecover.h
	* oldrecover-src/display_commands.c: Copy of old
					     recover-src/display_commands.c
	* oldrecover-src/extract_list.c: Copy of old recover-src/extract_list.c
	* oldrecover-src/help.c: Copy of old recover-src/help.c
	* oldrecover-src/Makefile.am: Copy of old recover-src/Makefile.am
	* oldrecover-src/set_commands.c: Copy of old recover-src/set_commands.c
	* oldrecover-src/uparse.y: Copy of old recover-src/uparse.y
	* oldrecover-src/uscan.l: Copy of old recover-src/uscan.l
	* recover-src/amrecover.c: Works with security-api.
	* recover-src/amrecover.h: Works with security-api.
	* recover-src/extract_list.c: Works with security-api.

2006-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Fixup.

2006-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/packet.h: pkt_t.body is now a char*.
	* common-src/packet.c (pkt_init): Return an alloced pkt.body.
	* common-src/packet.c (pkt_cat): Increade pkt.body size if needed.
	* common-src/protocol.c: Free allocated pkt.body.
	* common-src/dgram.c (dgram_cat): Return int.
	* common-src/dgram.h (dgram_cat): New prototype.
	* common-src/krb5-security.c: Work with dynamicaly allocated packet
				      body.
	* common-src/rsh-security.c: Work with dynamicaly allocated packet
				     body.
	* common-src/ssh-security.c: Work with dynamicaly allocated packet
				     body.
	* amandad-src/amandad.c: Work with dynamicaly allocated packet body.
	* server-src/amcheck.c: Don't limit packet size.
	* server-src/planner.c: Don't limit packet size.

2006-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c (service_new): Apply the correct patch.

2006-05-08  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: Fix compiler warning.
	* common-src/match.c: Many function get const parameters.
	* common-src/amanda.h: Prototype change.

2006-05-07  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c (service_new): Make sur that the 3 data_read[]
	  and the 3 data_write[] fd are not in the range DATA_FD_OFFSET to
	  DATA_FD_OFFSET+DATA_FD_COUNT-1.

2006-05-05  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/tapelist.c (append_to_tapelist): Remove bad amfree.

2006-05-05  Nikhil Bandiwadekar <nikhil@zmanda.com>
        * server-src/conffile.c: fix to correctly handle am64 datatype

2006-05-04  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: Write the slot number in the
			      'taper: wrote label' line.
	* server-src/amverifyrun.sh.in: Parse that line.

2006-05-02  Jean-Louis Martineau <martineau@zmanda.com>
	* amstatus.pl.in: Limit characters for hostname in setup_estimate line.

2006-04-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/rsh-security.c: Pass "amdump amindexd amidxtaped" option
				     to amandad.
	* common-src/ssh-security.c: Ditto.

2006-04-27  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Accept a list of services on the command line.

2006-04-27  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/tapelist.c (append_to_tapelist): Fix memory leak.

2006-04-27  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: Fix memory leak.
	* amandad-src/amandad.h (free_g_options): Prototype.
	* amandad-src/amandad_util.c (free_g_options): New function to free a
						       g_option_t.
	* server-src/amcleanupdisk.c: Fix memory leak.
	* server-src/reporter.c: Fix memory leak.
	* server-src/tapefile.c: Fix memory leak.
	* server-src/taperscan.c: Put message in error_message.

2006-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c (start_server_check): Memory leak.

2006-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/Makefile.am (noinst_HEADERS): Add amandad.h.
	* client-src/Makefile.am (noinst_HEADERS): Add clientconf.h.

2006-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda-client.conf.5.xml: New file.

2006-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amanda.h (check_user_ruserok, check_user_amandahosts):
	  Remove prototype.
	* common-src/bsd-security.c: Pass the service name across check_user*
	  function and validate it from the .amandahosts file.

2006-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/amidxtaped.c: Can be launched by amandad.
	* server-src/Makefile.am (INCLUDES): Add -I$(top_srcdir)/amandad-src
	* server-src/Makefile.am (amidxtaped__LDADD): Link with libamandad.
	* restore-src/restore.c: Fix indentation.

2006-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindexd.c: Can be launched by amandad
	* server-src/Makefile.am (INCLUDES): Add -I$(top_srcdir)/amandad-src
	* server-src/Makefile.am (amindexd_LDADD): Link with libamandad.

2006-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* amandad-src/amandad.c: New file.
	* amandad-src/amandad.h: New file.
	* amandad-src/amandad_util.c: New file, add function init_g_options
				      parse_g_options.
	* amandad-src/Makefile.am: New file.
	* client-src/amandad.c: Removed file.
	* client-src/amandad.h: Removed file.
	* client-src/client_util.c (init_g_options, parse_g_options): Remove.
	* client-src/client_util.h (init_g_options, parse_g_options): Remove.
	* client-src/Makefile.am (INCLUDES): -I$(top_srcdir)/amandad-src
	* client-src/Makefile.am (libexec_PROGRAMS): Remove amandad.
	* client-src/Makefile.am (LDADD): Add
				  ../amandad-src/libamandad.$(LIB_EXTENSION).
	* client-src/selfcheck.c: #include "amandad.h".
	* client-src/sendsize.c: #include "amandad.h".
	* configure.in (AC_CONFIG_FILES): amandad-src/Makefile.
	* Makefile.am (SUBDIRS): amandad-src.

2006-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* docs/security-api.txt: Document security_read_sync.
	* common-src/security.h: Typo.

2006-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/amandad.c (service_new): Pass the "amandad" argument to
					      the service.

2006-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsd-security.c: Allow to run many services on the same
				     client. Cleanup.
	* common-src/rsh-security.c: Ditto.
	* common-src/ssh-security.c: Ditto.

2006-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/security.h (security_stream_read_sync): Prototype.
	* common-src/bsd-security.c (bsd_stream_read_sync): New function.
	* common-src/krb4-security.c (krb4_stream_read_sync): New function.
	* common-src/krb5-security.c (krb5_stream_read_sync): New function.
	* common-src/rsh-security.c (rsh_stream_read_sync): New function.
	* common-src/ssh-security.c (ssh_stream_read_sync): New function.

2006-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/amandad.c: Open pipe in both direction to the services.
	* client-src/sendbackup.c: Deal with the newer pipe.

2006-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/clientconf.c: New file to read the client configuration
				   file.
	* client-src/clientconf.h: Header.
	* client-src/Makefile.am: Link clientconf into libamclient.
	* configure.in (AC_CONFIG_FILES): example/amanda-client.conf.
	* docs/amanda-client.conf.5.txt: New documentation.
	* docs/Makefile.am (pkgdata_DATA): amanda-client.conf.5.txt.
	* example/amanda-client.conf.in: exemple.
	* example/Makefile.am  (noinst_DATA): amanda-client.conf.
	* man/entities/global.entities: amclientconf.
	* man/Makefile.am (COMMON_MAN5_PAGES): amanda-client.conf.5.
	* man/xml-source/amanda.8.xml (SEE ALSO): amanda-client.conf(5).
	* man/xml-source/amanda.conf.5.xml (SEE ALSO): amanda-client.conf(5).
	* man/xml-source/amrecover.8.xml (SEE ALSO): amanda-client.conf(5).

2006-04-26  K. K. George<kkg@zmanda.com>
	* server-src/reporter.c: Fix to untaint the mailto parameter.
	* server-src/amcheck.c: Fix to untaint the mailto parameter
        * changer-src/chg-scsi.c: Fix to untaint the mailto parameter.
        * changer-src/chg-scsi-chio.c: Fix to untaint the mailto parameter.
        * common-src/util.h: Added function to check if the mailto 
          parameter is untainted
        * common-src/util.c: Added function to check if the mailto 
          parameter is untainted

2006-04-26  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/event.c(event_wait): New function.
	* common-src/event.h(event_wait): prototype.
	* docs/eventapi.txt: Document event_wait.

2006-04-24  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Fix divide by zero if runtapes==0.

2006-04-24  K. K. George<kkg@zmanda.com>
        * server-src/reporter.c: Fix to make the mailto parameter in
          amanda.conf optional. Added two more commandline options
          -i & -Maddress.
        * server-src/amcheck.c: Fix to make the mailto parameter in
          amanda.conf optional.
        * man/xml-source/amreport.8.xml: Modified to document the
          -i & -Maddress commandline parameters
        * docs/amreport.8.txt: Modified to document the
          -i & -Maddress commandline parameters
        * changer-src/chg-scsi.c: Fix to make the mailto parameter in
          amanda.conf optional.
        * changer-src/chg-scsi-chio.c: Fix to make the mailto parameter in
          amanda.conf optional.

2006-04-23  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (handle_chunker_result): make sure that
						       est_size > act-size.

2006-04-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/changer.c (changer_command): Make sure fd[0] != 1.

2006-04-19  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/amidxtaped.c: Cleanup.

2006-04-19  Ian Turner <ian@zmanda.com>
	* tape-src/output-tape.c: Do a more thourough check to ensure 
	  that we actually got a tape device, before proceeding to use 
	  it.

2006-04-18  Ian Turner <ian@zmanda.com>
	* changer-src/chg-disk.sh.in: Check that the virtual device is a 
	  directory with proper permissions.
	* server-src/changer.c: Do the right thing (failure) if there is 
	  a problem with the changer.

2006-04-18  Ian Turner <ian@zmanda.com>
	* recover-src/uscan.l: Accept setdate of the form
	  yyyy-MM-dd-hh-mm in addition to yyyy-MM-dd-hh-mm-ss.
	* man/xml-source/amrecover.8.xml: Document this change.

2006-04-14  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/help.c: Document setdate YYYY-MM-DD-HH-MM-SS format.
	* man/xml-source/amrecover.8.xml: Ditto.

2006-04-14  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/amandad.c: Use %p to printf pointer.

2006-04-14  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amtape.c: Add update command.

2006-04-11  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: log_add(L_WARNING) the output of taper_scan if
			       no valid tape are found.

2006-04-11  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c: Call taper_scan with
		(..., FILE_taperscan_output_callback,outf) arguments.
	* server-src/amtape.c:  Call taper_scan with
		(..., FILE_taperscan_output_callback,stderr) arguments.
	* server-src/taper.c:   Call taper_scan with
		(..., CHAR_taperscan_output_callback, &error_msg) arguments.
	* server-src/taperscan.h(FILE_taperscan_output_callback,
				 CHAR_taperscan_output_callback): Protoype.
	* server-src/taperscan.h(taper_scan): New protoype, remove
	  error_message arg, add taperscan_output_callback and data arg.
	* server-src/taperscan.c(FILE_taperscan_output_callback): Callback
	  that print the msg to it's arg, which is FILE*.
	* server-src/taperscan.c(CHAR_taperscan_output_callback): Callback
	  that append the msg to it's arg, which is char*.
	* server-src/taperscan.c(taper_scan): Fix for new arguments.
	* server-src/taperscan.c(changer_taper_scan): Fix for new arguments.

2006-04-11  Jean-Louis Martineau <martineau@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Document amandad_path and
					    client_username dumptype option.

2006-04-11  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/krb4-security.c: Increase timeout to 60 seconds.
	* common-src/rsh-security.c: Increase timeout to 60 seconds.
	* common-src/ssh-security.c: Increase timeout to 60 seconds.

2006-04-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/conffile.c: New configuration option usetimestamps.
	* server-src/conffile.h: New configuration option usetimestamps.
	* example/amanda.conf.in: Document new usetimestamps options.
	* man/xml-source/amanda.conf.5.xml: Document new usetimestamps options.
	* server-src/amflush.c: Use datestamp or timestamp depending of
				usetimesstamps.
	* server-src/planner.c: Use datestamp or timestamp depending of
				usetimesstamps.
	* server-src/driver.c: Log an ERROR if many run a day and
			       usetimestamps us set to no.

2006-04-07  Ian Turner <ian@zmanda.com>
	* server-src/changer.c: Don't crash if we go to taperscan "Plan 
	  B".

2006-04-07  Ian Turner <ian@zmanda.com>
	* server-src/changer.c: Only print changer debug messages if 
	  there was a problem.

2006-04-07  Ian Turner <ian@zmanda.com>
	* recover-src/amrecover.c: Print a more helpful command if mount
	  point autodetection fails.
	* recover-src/display_commands.c: Print a more helpful message
	  if the user tries to ls without having setdisk earlier.

2006-04-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amadmin.c: Fix use of datestamp as int.
	* server-src/find.c: Ditto.
	* server-src/reporter.c: Ditto.
	* server-src/tapefile.c: Ditto.

2006-04-07  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/Makefile.am: Fix dependency between genversion and
				  versuff.o.

2006-04-07  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/amrecover.c: Change initialization of server_name and
				   tape_server_name.

2006-04-07  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/amrestore.c: reset count_error to 0 on a restore.

2006-04-06  Kevin Till <ktill@zmanda.com>
	* server-src/Makefile.am: always install planner/dumper setuid-root
	* server-src/amcheck.c:	  check planner/dumper for setuid-root
	* server-src/dumper.c:	  drop privilege asap. Switch between bsd 
	  and ssh auth is now possible with the same installation.
	* server-src/planner.c:	  ditto

2006-04-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taperscan.c (changer_taper_scan): Pass a pointer to the
	  changer_loadslot call.

2006-04-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/tapefile.c (lookup_last_reusable_tape): Fix a datestamp
	  test with an int.

2006-04-06  Ian Turner <vectro@vectro.org>
	* recover-src/amrecover.c (main): Check AMANDA_SERVER and 
	  AMANDA_TAPE_SERVER environment variables before falling back 
	  to compiled-in defaults. Document this new behavior. Thanks to 
	  Malcolm Locke <malc@hoodee.co.uk> for the idea and patch.

2006-04-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c (handle_chunk): CHUNK line always have the
	  datestamp.

2006-04-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/krb5-security.c: Fix for krb5_connect call in
	   open_callback.

2006-04-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (start_some_dumps): Recover correctly if the
	  chunker reply with something that is not a PORT command.
	* server-src/driver.c (dump_to_tape): remove duplicate free_serial.
	* server-src/driverio.c: Improve debugging.

2006-04-05  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/tapelist.c(unmarshal_tapelist_str): Fix
	  "value computed is not used" compiler warning.

2006-04-05  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsd-security.c (bsd_connect): New datap argument.
	* common-src/krb4-security.c (krb4_connect): New datap argument.
	* common-src/krb5-security.c (krb5_connect): New datap argument.
	* common-src/rsh-security.c (rsh_connect): New datap argument,
		 retrieve amanda_path and client_username from configuration.
	* common-src/ssh-security.c (ssh_connect): New datap argument,
		retrieve amanda_path and client_username from configuration.
	* common-src/protocol.c: Pass new datap argument to security_connect.
	* common-src/security.h(connect): New prototype.
	* common-src/security.h(security_connect): Add datap to macro.
	* server-src/amadmin.c(disklist_one): Print amandad_path and
					      client_username.
	* server-src/conffile.c(AMANDAD_PATH, CLIENT_USERNAME): Parse new
				dumptype option.
	* server-src/conffile.h(dumptype_t): Add amandad_path and
					     client_username.
	* server-src/diskfile.c(parse_diskline): Copy new field.
	* server-src/diskfile.h(disk_t) Add amandad_path and client_username.
	* server-src/driverio.c(dumper_cmd): Send dp->amandad_path and
	  dp->client_username in a PORT_DUMP command to the dumper.
	* server-src/dumper.c: Parse amandad_path and client_username in a
			       PORT_DUMP command.
	* server-src/dumper.c(dumper_get_security_conf): New function to return
				configuration option to the security-api.
	* server-src/dumper.c: Use dumper_get_security_conf for the callback
			       to protocol_sendreq.
	* server-src/planner.c Use amhost_get_security_conf for the callback
			       to protocol_sendreq.
	* server-src/amcheck.c: Use amhost_get_security_conf for the callback
				to protocol_sendreq.
	* server-src/server_util.c(amhost_get_security_conf): New function to
			return configuration option to the security-api,
			it expect an am_host_t arg.
	* server-src/server_util.h(amhost_get_security_conf): Prototype.

2006-04-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl.in: Remove duplicate instruction.

2006-04-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindexd.c: Remove all code that set str_buffer_size,
				 rename str_buffer_size to reply_buffer_size,
				 rename buf to reply_buffer,
	* server-src/amindexd.c(reply, lreply_backend): Increase reply_buffer
							size if required.

2006-04-05  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amfeatures.h: Add fe_amrecover_timestamp amfeature.
	* common-src/amfeatures.c (am_init_feature_set):
						 Add fe_amrecover_timestamp.
	* server-src/amindexd.c(opaque_ls_one): New function.
	* server-src/amindexd.c(disk_history_list,opaque_ls_one): Send only a
	  datestamp if client doesn't have fe_amrecover_timestamp.

2006-04-05  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/uscan.l: Parse "setdate YYYY-MM-DD-HH-MM-SS".
	* server-src/amindexd.c (cmp_date): New function to cmp datestamp with
					    timestamp, use it where needed.
	* server-src/amindexd.c (amindexd_nicedate): Fix for timestamp.
	* server-src/amtrmidx.c: Fix for timestamp.
	* server-src/disk_history.h (DUMP_ITEM): Increase size of date.

2006-04-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amflush.c: Send DATE line to driver, use timestamp.
	* server-src/amindex.c (getindexfname): Increase datebuf size.
	* server-src/amtrmlog.c: Fix bug with date_keep computation if
				 dumpcycle is INF.
	* server-src/amtrmlog.c: rotate timestamped log file.
	* server-src/chunker.c: Receive START cmd, use timestamp.
	* server-src/driver.c: Receive DATE line, send START cmd to chunker,
			       use timestamp.
	* server-src/driverio.c (startup_dump_processes): Send START cmd to
							  dumper.
	* server-src/driverio.c (dumper_cmd, chunker_cmd): Send START command.
	* server-src/driverio.h (startup_dump_processes): Prototype change,
							  need the timestamp.
	* server-src/dumper.c: Receive START cmd, use timestamp.
	* server-src/find.c (find_nicedate): Fix for timestamp.
	* server-src/planner.c: Send DATE line to driver, use timestamp.
	* server-src/server_util.c (cmdstr): Add START.
	* server-src/server_util.h (cmd_t): Add START.
	* server-src/taper.c: Get timestamp from TAPER_START command.

2006-04-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amindexd.c (amindexd_nicedate): New function.
	* server-src/find.h (struct find_result_s): Remove datestamp and
		 datestamp_aux field, only timestamp will be used.
	* restore-src/amfetchdump.c: Convert datestamp to 'char *'.
	* restore-src/restore.c: Convert datestamp to 'char *'.
	* server-src/amindexd.c: Convert datestamp to 'char *'.
	* server-src/amlabel.c: Convert datestamp to 'char *'.
	* server-src/amtrmidx.c: Convert datestamp to 'char *'.
	* server-src/find.c: Convert datestamp to 'char *'.
	* server-src/reporter.c: Convert datestamp to 'char *'.
	* server-src/tapefile.c: Convert datestamp to 'char *'.
	* server-src/tapefile.h: Convert datestamp to 'char *'.
	* server-src/taper.c: Convert datestamp to 'char *'.

2006-04-05  Jean-Louis Martineau <martineau@zmanda.com>
	* configure.in: AM_INIT_AUTOMAKE(amanda, 2.5.1b1).

2006-04-05  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Change expression to remove overflow.

2006-03-29  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/calcsize.c: Don't use declaration after instruction,
	  older compiler don't accept it.

2006-03-23  Jean-Louis Martineau <martineau@zmanda.com>
	* Amanda 2.5.0 released.
	* configure.in: AM_INIT_AUTOMAKE(amanda, 2.5.0).
	* NEWS: Update for 2.5.0

2006-03-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/dumper.c: wait for compress/index/encryp subprocess.

2006-03-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amstatus.pl.in: Parse PARTIAL reply.

2006-03-22  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Put '#define HOLD_DEBUG' in comment.

2006-03-21  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/chunker.c: Don't loop on startup_chunker.
	* server-src/dumper.c: Don't wait for all children, some process (ssh)
	  might not terminate.

2006-03-17  Ian Turner <ian@zmanda.com>
	* server-src/taper.c (read_file): When finished flushing a 
	  chunked dump, print information about the whole dump, not just 
	  the last chunk. Also, fix some memory leaks.

2006-03-16  Kevin Till <ktill@zmanda.com>
	* server-src/amverify.sh.in: check for EOI. amrestore only 
	  reports EOI for some tapetypes.

2006-03-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/conffile.c: Fix heritage of auth.

2006-03-14  Kevin Till <ktill@@zmanda.com>
	* example/amanda.conf.in: add dumptype custom-compress. 
	  add ssh,krb5 as valid input for auth. 
        * man/xml-source/amanda.conf.5.xml: give reference to 
	  custom-compress, encrypt-fast dumptypes.

2006-03-14  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amfeatures.h: Rename fe_amidxtaped_FEEDME to
					  fe_amrecover_FEEDME
	* common-src/amfeatures.c (am_init_feature_set): Set
							 fe_amrecover_FEEDME.
	* restore-src/restore.h (search_tapes): Add their_features parameter.
	* restore-src/amfetchdump.c: Add NULL pointer to search_tapes call.
	* restore-src/amidxtaped.c: Add their_features to search_tapes call.
	* restore-src/restore.c (search_tapes): Send FEEDME only if client
						support it.

2006-03-11  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driverio.c : Fix errors found using Coverity tools.

2006-03-10  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taperscan.c: Fix Coverity fix.

2006-03-10  Jean-Louis Martineau <martineau@zmanda.com>
	* changer-src/scsi-changer-driver.c:
					 Fix errors found using Coverity tools.
	* server-src/diskfile.c: Fix errors found using Coverity tools.
	* server-src/planner.c: Fix errors found using Coverity tools.
	* server-src/taperscan.c: Fix errors found using Coverity tools.

2006-03-10  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driverio.c: Undo my bad fix.
	* server-src/infofile.c: Fix errors found using Coverity tools.
	* tape-src/tapetype.c: Fix errors found using Coverity tools.

2006-03-09  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c: Fix errors found using Coverity tools.

2006-03-09  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/holding.c: Fix errors found using Coverity tools.

2006-03-09  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driverio.c: Fix errors found using Coverity tools.
	* server-src/planner.c: Fix errors found using Coverity tools.

2006-03-09  John Franks <jrfranks@zmanda.com>
	* changer-src/chg-scsi.c:        Fix errors found using Coverity tools.
	* changer-src/scsi-changer-driver.c:
					 Fix errors found using Coverity tools.
	* changer-src/sense.c:           Fix errors found using Coverity tools.
	* client-src/sendbackup-dump.c:  Fix errors found using Coverity tools.
	* client-src/sendbackup.c:       Fix errors found using Coverity tools.
	* recover-src/display_commands.c:Fix errors found using Coverity tools.
	* regex-src/regcomp.c:           Fix errors found using Coverity tools.
	* restore-src/restore.c:         Fix errors found using Coverity tools.
	* server-src/amindexd.c:         Fix errors found using Coverity tools.
	* server-src/diskfile.c:         Fix errors found using Coverity tools.
	* server-src/driver.c:           Fix errors found using Coverity tools.
	* server-src/driverio.c:         Fix errors found using Coverity tools.
	* server-src/infofile.c:         Fix errors found using Coverity tools.
	* server-src/planner.c:          Fix errors found using Coverity tools.
	* server-src/taper.c:            Fix errors found using Coverity tools.
	* server-src/taperscan.c:        Fix errors found using Coverity tools.
	* server-src/conffile.c:         Change report default to use at least
	                                 one space between every column.

2006-03-08  Jean-Louis Martineau <martineau@zmanda.com>
	* client-src/amandad.c: Fix coverity bug.
	* client-src/calcsize.c: Fix coverity bug.
	* client-src/client_util.c: Fix coverity bug.
	* client-src/sendbackup.c: Fix coverity bug.
	* client-src/sendsize.c: Fix coverity bug.
	* common-src/bsd-security.c: Fix coverity bug.
	* common-src/file.c: Fix coverity bug.
	* common-src/fileheader.c: Fix coverity bug.
	* common-src/pipespawn.c: Fix coverity bug.
	* recover-src/extract_list.c: Fix coverity bug.
	* restore-src/restore.c: Fix coverity bug.
	* server-src/amindexd.c: Fix coverity bug.
	* server-src/conffile.c: Fix coverity bug.
	* server-src/diskfile.c: Fix coverity bug.
	* server-src/driverio.c: Fix coverity bug.
	* server-src/dumper.c: Fix coverity bug.
	* server-src/planner.c: Fix coverity bug.
	* server-src/reporter.c: Fix coverity bug.

2006-03-07  Paddy Sreenivasan <paddy@zmanda.com>
	* man/xml-source/amanda.8.xml: added amaespipe and amcrypt.

2006-03-07  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c: Don't log a multi-line message in no-tape case.

2006-03-06  John Franks <jrfranks@zmanda.com>
	* recover-src/extract_list.c:
	  1) Don't add '.' directory twice to tar extract list.
	  2) Don't prepend extra '/' to extract patterns starting with '/'.
          3) Convert "/" extract pattern to "*" equivalent.

2006-03-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taperscan.c (scan_slot): append slotstr to
	  ct->error_message.
	* server-src/taperscan.c: Add a '\n' after each slot error message.

2006-03-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/reporter.c (handle_error): Handle error from taper.

2006-03-06  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/taper.c (label_tape): Set errstr and return 0 if no
	  valid tape are available.

2006-03-03  Ian Turner <ian@zmanda.com>
	* common-src/amanda.h: New macros MAX_TAPE_LABEL_LEN and 
	  MAX_TAPE_LABEL_BUF.
	* common-src/amfeatures.h: New amfeature fe_amidxtaped_FEEDME
	* recover-src/extract_list.c: Accept port number with CONNECT; 
	  implement fe_amidxtaped_FEEDME.
	* restore-src/amidxtaped.c: Introduce port number with CONNECT. 
	  (closes SF bug 1431623)
	* restore-src/restore.c: Implement fe_amidxtaped_FEEDME.
	  (closes SF bug 1421433)
	* restore-src/restore.h: Properly name rst_flags.

2006-02-28  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsd-security.c (bsd_connect, netfd_read_callback, main):
	  Set bh->proto_handle to NULL after allocating bh.
	* common-src/bsd-security.c (bsd_close): Donothing if
	  bh->proto_handle == NULL.

2006-02-28  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/protocol.c (s_repwait): Decrease p->timeout on receive
					     of a PREP.

2006-02-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c: Print dumper TRY_AGAIN message.

2006-02-28  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/planner.c: Don't print estimate size if estimate failed.

2006-02-25  Ian Turner <ian@zmanda.com>
	* man/Makefile.am: Don't use static patterns (as they are not 
	  portable), use implicit rules instead.

2006-02-20  Kevin Till <ktill@zmanda.com>
	* common-src/krb4-security.c: changes needed for krb4/5 to compile. Thanks to
				      Orion Poplawski.
	* common-src/krb5-security.c: ditto.

2006-02-16  Kevin Till <ktill@zmanda.com>
	* example/amanda.conf.in: dumptype option is "encrypt"
	* man/xml-source/amanda.conf.5.xml: ditto
	* server-src/holding.c: util.h is include'd twice
	* common-src/ssh-security.c: set correct debug print 

2006-02-10  Kevin Till <ktill@zmanda.com>
	* man/xml-source/amanda.8.xml: replace informaltable with literallayout 

2006-02-13  John Franks <jrfranks@zmanda.com>
 	* server-src/driver.c: Pring a more precise message when taper
	  returns an error.  Include error message from taper in log.
	  Print out "protocol error" if taper returns a bogus command.

2006-02-10  Kevin Till <ktill@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: add note about first character of a 
			tapetype string must be alphabet

2006-02-10  John Franks <jrfranks@zmanda.com>
 	* server-src/taper.c: Call error() if an invalid string is read
 	  by syncpipe_getstr().
 
2006-02-09  John Franks <jrfranks@zmanda.com>
 	* Makefile.am, */Makefile.am:  Corrections generated by David Braun
 	  dustybird@users.sourceforge.net to properly set source directories
 	  for remote (VPATH) builds.
 	* man/Makefile.am:  Fixed man page builds to use proper source and
 	  build paths.
 	* autogen: Force rebuilding everything and print only syntax errors.
 	  (Errors are seen occasionally in system autogen files...)
	* configure.in: Eliminate possibility of empty string in shell tests.
 	  fix quoting of '[' and ']' characters in help messages.
 	  Fix default value for DUMPER_DIR to pick up EPREFIX correctly.
 
2006-02-08  Ian Turner <ian@zmanda.com>
	* server-src/driver.c (handle_taper_result): Properly handle 
	  SPLIT_NEEDNEXT case. Thanks to Josef Wolf for finding this bug.
	  Also reindent.

2006-02-06 Kevin Till <ktill@zmanda.com> 
	* restore-src/restore.c: fix comment formatting on version 1.2.1

2006-02-06 Kevin Till <ktill@zmanda.com>
	* configure.in: Bug 1423731, SSH_SECURITY set only when --with-ssh-security used
	* server-src/Makefile.am:: not to install planner/dumper setuid-root --with-ssh-security
	* server-src/amcheck.c:	   ditto
	* server-src/dumper.c: 	   ditto
	* restore-src/restore.c:    add missing "}"
	
2006-02-06  Ian Turner <ian@zmanda.com>
	* restore-src/amidxtaped.c: Properly handle changers, 
	  tape-label checking, and tape prompting in amrecover, 
	  amindexd, and amidextaped. Thanks to Paul Bijnens 
	  <pbijnens@users.sourceforge.net> for the patch.
	* restore-src/restore.c: ditto.
	* server-src/amindexd.c: ditto.

2006-02-04  Paddy Sreenivasan <paddy@zmanda.com>
        * man/xml-source/amfetchdump.8.xml
        * man/xml-source/amcrypt.8.xml
        * man/xml-source/amanda.conf.5.xml
        * man/xml-source/amanda.8.xml
        * man/xml-source/amaespipe.8.xml
        * man/entities/global.entities: Merged changes from xml-docs tree

2006-02-03  John Franks <jrfranks@zmanda.com>
	* server-src/taper.c: Fix null string printout in CHUNKERSUCCESS log line.

2006-02-03  Ian Turner <ian@zmanda.com>
	* server-src/amadmin.c (main): Don't free conf_tapelist too 
	  early. Thanks to Cédric Lucantis
	  <cedric-lucantis@users.sourceforge.net> for the patch.

2006-02-02 Kevin Till <ktill@zmanda.com>
	* man/xml-source/amanda.8.xml: fix formatting. <informaltable> problem 
				       to be fixed.
	* man/xml-source/amrecover.8.xml: add note on client-encrypted tapes.

2006-02-02  Ian Turner <ian@zmanda.com>
	* recover-src/extract_list.c (extract_files_child): Run tar with 
	  --numeric-owner if we are extracting a non-sambafied tar file. 
	  Thanks to Paul Bijnens <pbijnens@users.sourceforge.net> for 
	  the patch. Thanks also to Mark Schaefer for suggesting this 
	  change.

2006-02-01  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c: Use OFF_T_FMT to printf off_t variable,
	  cast size_t to am64_t and use AM64_FMT to printf them.

2006-01-31  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/driver.c (dumper_result): Reset sched(dp)->attempted to 0
	  before adding it to tapeq.

2006-01-27  Ian Turner <ian@zmanda.com>
	* configure.in: Add new option --without-xsltproc (and
	  --with-xsltproc), which turns off (or forces) the use of xsltproc to
	  build manpages. Thanks to Paul Bijnens
	  <pbijnens@users.sourceforge.net> for suggesting this feature.

2006-01-27  Ian Turner <ian@zmanda.com>
	* restore-src/amfetchdump.c: Properly clean up logfiles. Also, 
	  run as user amanda even if we are started as some other user.
	  Thanks to Paul Bijnens <pbijnens@users.sourceforge.net> for the 
	  patch.

2006-01-25  Paddy Sreenivasan <paddy@zmanda.com>
        * common-src/amanda.h:     Removed unnecessary header include files.

2006-01-25  Kevin Till<ktill@zmanda.com>
	* server-src/amadmin.c:	fix for sourceforge bug 1412698
				add missing parameters to "amadmin x disklist"
	* server-src/amstatus.pl.in: untaint user input, enforce known path.
	* server-src/amoverview.pl.in: untaint user input (bug 1353481)

2006-01-25  Kevin Till<ktill@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: fix formatting (<para> is not compatible 
					    with some tag) add supported auth types.

2006-01-25  Kevin Till<ktill@zmanda.com>
	* common-src/bsd-security.c: move check_security to bsd_security.c, 
                                     fix faulty return
				     Thanks to Paul Bijnens
	* restore-src/amidxtaped.c:  ditto
	* server-src/amindexd.c:     ditto and no need to tell client 
                                     about reason for denial
	* common-src/amanda.h:       add proto of check_security
	* server-src/conffile.c:     don't list CRYPT in the summary report 
                                     for now
	* restore-src/restore.c:     set outfd correctly for amfetchdump cases
				     Thanks to Paul Bijnens

2006-01-24  Ian Turner <ian@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Put documentation of 
	  split-dump options in the right place. Thanks to Paul Bijnens 
	  <pbijnens@users.sourceforge.net> for the fix.
	* man/xml-source/amanda.8.xml: ditto.

2006-01-23  Ian Turner <ian@zmanda.com>
	* server-src/taperscan.c (find_brand_new_tape_label): Start 
	  brand new tape labels at 1 instead of 0. Thanks to Paul 
	  Bijnens <pbijnens@users.sourceforge.net> for the fix.

2006-01-18  Jean-Louis Martineau <martineau@zmanda.com>
	* Amanda 2.5.0b2 released.
	* configure.in: AM_INIT_AUTOMAKE(amanda, 2.5.0b2).
	* NEWS: Update for 2.5.0b2
	
2006-01-15  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/disk_history.c: Fix memory leak.

2006-01-15  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/bsd-security.c: Fix memory leak.
	* common-src/tapelist.c: Fix memory leak.
	* restore-src/amidxtaped.c: Fix memory leak.
	* restore-src/restore.c: Fix memory leak.
	* server-src/amindexd.c: Fix memory leak.
	* server-src/conffile.c: Fix memory leak.
	* server-src/disk_history.c: Fix memory leak.
	* server-src/find.c: Fix memory leak.

2006-01-13  John Franks <jrfranks@zmanda.com>
	* client-src/amandad.c:      Remove SO_LINGER and TCP_NDELAY.
	                             Loop on I/O if EINTR or EAGAIN.
	* client-src/noop.c:         Loop on I/O if EINTR or EAGAIN.
	* client-src/sendbackup.c:   Remove SIGPIPE handler.
	                             Loop on I/O if EINTR or EAGAIN.
	                             Check for EPIPE on writes.
	* common-src/bsd-security.c: Loop on I/O if EINTR or EAGAIN.
	* common-src/stream.c:       Remove SO_LINGER and TCP_NDELAY.
	* common-src/util.c:         Loop on I/O if EINTR or EAGAIN.
	* recover-src/amrecover.c:   Write commanda atomically in sigint handler
	* recover-src/extract_list.c:Remove SIGPIPE handler.
	                             Loop on I/O if EINTR or EAGAIN.
	                             Check for EPIPE on writes.
	                             Remove shutdown functions.
	* restore-src/amfetchdump.c: Remove SIGPIPE handler.
	* restore-src/amidxtaped.c:  Remove SO_LINGER and TCP_NDELAY.
	                             Remove SIGPIPE handler.
	                             read_file_header does not return if it
	                             Fix infinite loop on EOF or error and
	                             fail if memory reallocation failure in
	                             get_client_line_fd.
	* restore-src/restore.c:     Remove SIGPIPE handler.
	                             Loop on I/O if EINTR or EAGAIN.
	                             Remove shutdown functions.
	                             Simplify read loop.
	* restore-src/restore.h:     Change read_file_header to return void
	* server-src/amcheck.c:      Use fullread() to handel EINTR etc.
				     Remove unused variable.
	* server-src/changer.c:      Remove SO_LINGER and TCP_NDELAY.
                                     Use fullwrite on socket.
	* server-src/driverio.c:     Remove SO_LINGER and TCP_NDELAY.
	* server-src/taper.c:        Use fullwrite() to write data.
	                             Use fullread() to read data.
	* tape-src/output-file.c;    Use fullwrite() to write data.

2006-01-13  Jean-Louis Martineau <martineau@zmanda.com>
	* server-src/amcheck.c (start_server_check): Remove unused variable
	  errstr.
	* restore-src/restore.c (restore): Remove unused variable s, l and
	  dataeof.

2006-01-12  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract_list.c (send_to_tape_server): Do only on write.
	* restore-src/amidxtaped.c (get_client_line_fd): New function to read
	  one complete line from an fd.

2006-01-09  John Franks <jrfranks@zmanda.com>
	* common-src/amanda.h:	Include tcp.h
	* client-src/amandad.c:	Set TCP_NODELAY and SO_LINGER on sockets.
	* common-src/dgram.c:	No linger on datagrams
	* common-src/stream.c:	Set TCP_NODELAY and SO_LINGER on sockets.
	* common-src/util.c:    Fix fullwrite to return # of bytes written
				before failure.
	* example/amanda.conf.in: Cleanup exclude list template.
				Use configure directlries instead of /usr/local
	* recover-src/extract_list.c: Cleanup read loops.
				Use real fullwrite instead of inline versions.
				Remove extra setting of LINGER on socket.
	* restore-src/amidxtaped.c: Set TCP_NODELAY and SO_LINGER on sockets.
	* restore-src/restore.c:Use real fullwrite instead of inline versions.
	* server-src/changer.c:	Set TCP_NODELAY and SO_LINGER on sockets.
	* server-src/chunker.c:	Use real fullwrite instead of inline versions.
	* server-src/driverio.c:Set TCP_NODELAY and SO_LINGER on sockets.
	* server-src/dumper.c:	Use real fullwrite instead of inline versions.

2006-01-09  Ian Turner <ian@zmanda.com>
	* changer-src/scsi-changer-driver.c: If there is a problem opening
	  the device during GenericRewind, don't retry for 201 minutes; give
	  up after only 200 seconds.

2006-01-09  Ian Turner <ian@zmanda.com>
	* server-src/taperscan.c: When doing taper-scan algorithm, properly
	  accept new tapes.

2006-01-09  Ian Turner <ian@zmanda.com>
	* tape-src/tapeio.c: Generate a more reasonable message when
	reading an empty tape label on brand-new tapes.

2006-01-09  Ian Turner <ian@zmanda.com>
	* server-src/amcheck.c: Actually do what the documentation for 
	  amcheck -w says; that is, overwrite labels on tapes.

2006-01-06  Kevin Till<ktill@zmanda.com>
	* server-src/amcheck.c: check if encrypt or compress program is 
	  executable. Check encrypt/compress configuration.
	* server-src/dumper.c: kill encrypt child when dump is stopped
	* server-src/amcrypt.sh.in: check for aespipe
	* server-src/amaespipe.sh.in: adjust PATH
	* man/xml-source/amtapetype.8.xml: fix format problem.

2006-01-06  Jean-Louis Martineau <martineau@zmanda.com>
	* recover-src/extract-list.c: Remove 'U' argument for gtar extraction.

2006-01-06  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c (flush_open_outputs): Another shutdown is
	  required.

2006-01-05  John Franks <jrfranks@zmanda.com>
	* recover-src/extract_list.c: Extend linger timeouts to 60 seconds.
          Use shutdown() on sockets.
	  Retry reads in case of EINTR or EAGAIN.
	* common-src/stream.c: set linger on correct socket.
	  Extend linger timeouts to 60 seconds.
	* restore-src/restore.c: Fix compiler warnings.
	* Call shutdown in more cases.

2006-01-05  John Franks <jrfranks@zmanda.com>
	* client-src/amandad.c: Set SO_LINGER on sockets.
	* common-src/dgram.c:   Set SO_LINGER on sockets.
	* common-src/stream.c:  Set SO_LINGER on sockets.
	* common-src/util.c:    Return any bytes already read on error or EOF.
	* recover-src/extract_list.c: Set SO_LINGER on data socket.
          Fix printf of unterminated string data.
	  Check return codes on socket header reads.
	* restore-src/amidxtaped.c: Set SO_LINGER on sockets.
	  Check return codes on socket header reads.
	* restore-src/restore.c:
	  Flush newline after operator prompt.
	* common-src/debug.c:
	  Fix memory leak when debug file name already exists.
	  Print error text upon hard open() error.
	  Allow group members read only access to log files.

2006-01-05  Kevin Till<ktill@zmanda.com>
        * restore-src/restore.c: handle sigpipe. Some program (e.g. bzip2) closes reading pipe
          early when it sees trailing garbage after EOF.

2006-01-02  Jean-Louis Martineau <martineau@zmanda.com>
	* common-src/amanda.h: Add a FD_COPY macro.
	* recover-src/extract_list.c (writer_intermediary): Don't use
	  writer_intermediary, do the select locally.

2006-01-02  Jean-Louis Martineau <martineau@zmanda.com>
	* restore-src/restore.c (flush_open_outputs): Call shutdown before
	  close.

2005-12-30  John Franks <jrfranks@zmanda.com>
	* recover-src/extract_list.c:
	  Fix double clearing of buffer during normal read path.
	* restore-src/amidxtaped.c
	  Actually initialize changer if it is needed.  (Set use_changer
          before checking it...)
        * Fix control messages being sent down the data pipe when
          restoring to client that does not support split dumps.
        * Print error and exit if a split dump is needed during restore
	  and client can not handle it. 

2005-12-30  Ian Turner <ian@zmanda.com>
	* common-src/fileheader.c: Remove xx/UNKNOWN split-dump header 
	  syntax, in favor of xx/-1.

2005-12-29  John Franks <jrfranks@zmanda.com>
	* recover-src/display_commands.c
	  Fix list deletion which did not update list root with NULL pointer.
	  Make free_dir_item() a non-recursive function to prevent stack bloat.
	  Fix list insertion code which inserts item in list initializes entry.
	* recover-src/extract_list.c
	  Fix to initialize lditem before using it...
	  Prevent multiple frees of cmd string.
	  Do not free err which is only initialized with static string pointers.
	  Fix typo which caused newstralloc() to free the wrong memory.
	* server-src/amindexd.c
	  Fix Compiler warning of unused variable.
	* server-src/taperscan.c
	  Fix Compiler warning of bogus format specifier.
  
2005-12-29  Kevin Till<ktill@zmanda.com>
	* man/xml-source/amcrypt.8.xml: add new amcrypt man page
	* man/xml-source/amaespipe.8.xml: add new amaespipe man page

2005-12-29  Ian Turner <ian@zmanda.com>
	* man/xml-source/amanda.conf.5.xml: Document label_new_tapes 
	  config option.

2005-12-28  Ian Turner <ian@zmanda.com>
	* recover-src/amrecover.h: Use dynamic strings in struct DIR_ITEM.
	* recover-src/display_commands.c: ditto
	* recover-src/extract_list.c: ditto. Also use dynamic strings in
	  struct EXTRACT_LIST and struct EXTRACT_LIST_ITEM.

2005-12-28  Ian Turner <ian@zmanda.com>
	* common-src/amfeatures.h: Add three new amfeatures:
	  fe_amindexd_marshall_in_OLSD, fe_amindexd_marshall_in_ORLD,
	  fe_amindexd_marshall_in_DHST.
	* common-src/amfeatures.c: ditto.
	* server-src/amindexd.c: Talk well to older clients.

2005-12-23  Ian Turner <ian@zmanda.com>
	* server-src/taperscan.c: Don't crash if find_brand_new_tape_label
	  returns NULL. Also, don't return NULL from
	  find_brand_new_tape_label without a good excuse.
	
2005-12-23  Kevin Till <ktill@zmanda.com>
	* client-src/client_util.c: change server_decrypt_option to
	  server-decrypt-option
	* client-src/sendbackup.c:  change client_decrypt_option to
	  client-decrypt-option
	* server-src/dumper.c:      ditto
	* common-src/amfeatures.c:  add crypt related amfeaturs
	* common-src/amfeatures.h:  ditto  
	* server-src/diskfile.c:    amfeatures checking and warns on
	  mis-configuration

2005-12-23  Paddy Sreenivasan <paddy@zmanda.com>
         * restore-src/restore.c:
         * server-src/amtape.c:
         * server-src/taperscan.c : Make scan_init static function

2005-12-23  John Franks <jrfranks@zmanda.com>
	* server-src/taper.c: Reduce I/O's system call overhead by 30%
          in main read / write loop. 

2005-12-23  John Franks <jrfranks@zmanda.com>
	* recover-src/restore.c  Remove inapproriate aclose which caused
          broken restore pipe.
	* recover-src/extract_list.c  Fix and cleanup read_buffer()
          mainly to fix hole that drops parital buffer of data if end
          of file is reached or an error occured..  Touched up calling
          functions to make sure EOF/timeouts are handled correctly.
          Increased normal path read timeout value from on second to
          whatever READ_TIMEOUT is set to.

2005-12-22  Jean-Louis Martineau <martineau@zmanda.com>

	* restore-src/restore.c (restore): Remova an aclose.

2005-12-22  Jean-Louis Martineau <martineau@zmanda.com>

	* restore-src/amidxtaped.c (cleanup): Function registered with atexit
	  to remove the log file.

2005-12-20  Jean-Louis Martineau <martineau@zmanda.com>

	* server-src/Makefile.am (noinst_HEADERS): Add taperscan.h.

2005-12-20  John Franks <jrfranks@zmanda.com>

	* restore-src/restore.c: Remove unused variables.
				 Fix uninitialize reference to bytes_read.
	* server-src/amcheck.c:	 Remove unused variables.
				 Include taperscan.h for missing prototype.
	* server-src/amtape.c:	 Remove unused variables.
				 Include taperscan.h for missing prototype.
	* server-src/taper.c:	 Remove unused variables.
				 Minor indenting changes.
	* server-src/taperscan.c:Remove unused variables.
				 Fix typo which assigns NULL rather than
				  checks for NULL.
				 Commented out reference to auto_pos which
				  is assigned but never used...

2005-12-20  Jean-Louis Martineau <martineau@zmanda.com>

	* common-src/fileheader.c (parse_file_header): Parse '/' in part.
	* common-src/fileheader.c (build_header): Add space ' ' before "part".

2005-12-20  Jean-Louis Martineau <martineau@zmanda.com>

	* server-src/reporter.c: Fix report of output size.

2005-12-19  Ian Turner <ian@zmanda.com>
	* server-src/taperscan.c: Check that automatic tape labels satisfy
	the labelstr.

2005-12-19  Ian Turner <ian@zmanda.com>
	* server-src/fileheader.c: Fix broken split-dump file headers.

2005-12-18  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Paul Bijnens

	* server-src/amcheck.c: Tapelist file is regular file.

2005-12-17  Jean-Louis Martineau <martineau@zmanda.com>

	* restore-src/restore.c (get_block): Return a ssize_t.
	* restore-src/restore.c: convert ssize_t to long for printing.
	* restore-src/restore.c (restore>): Remove unused variable, outpipe,
	   outpipe2, i.

2005-12-17  John R. Franks <jrfranks@zmanda.com>

	* restore-src/restore.h (read_file_header, restore): Return a ssize_t
	  instead of using a global variable bytes_read.
	* restore-src/restore.c: Use local variable instead of global
	  bytes_read. Many memory management fixe. Fixe pipe handling,
	* restore-src/amrestore.c: Use new read_file_header and restore.
	* restore-src/amfetchdump.c: Use new read_file_header and restore.

2005-12-17  Jean-Louis Martineau <martineau@zmanda.com>
	With Kevin Till <ktill@zmanda.com>

	* common-src/fileheader.c (parse_file_header): Fix parsing of first
	  line.
	* common-src/fileheader.c (build_header): Print crypt after programi
	   and only if it is needed.

2005-12-14  Ian Turner <ian@zmanda.com>

	* common-src/alloc.c: Add new function vstrextend, which extends an
	  existing string.
	* common-src/amanda.h: Define vstrextend.
	* example/amanda.conf.in: Document new option
	  label_new_tapes. Change default labelstr.
	* man/xml-source/amcheck.8.xml: Emphasize the destructiveness of
	  amcheck -w.
	* restore-src/restore.c: Use the new changer_find interface.
	* server-src/Makefile.am: Add new file taperscan.c
	* server-src/amcheck.c: Use the taper-scan algorithm in taperscan.c,
	  instead of the previous separate amcheck implementation.
	* server-src/amtape.c: Use the taper-scan algorithm in taperscan.c,
	  instead of the previous separate amtape implementation. Also, use
	  the new changer_find interface for other kinds of tape finding.
	* server-src/changer.c: Eliminate changer_scan. Change the API to
	  changer_find, so that callers can pass a user-data object, instead
	  of using globals.
	* server-src/changer.h: Declare and document new changer_find
	  interface.
	* server-src/conffile.c: Add new config option label_new_tapes.
	* server-src/conffile.h: ditto.
	* server-src/taper.c: Use the taper-scan algorithm in taperscan.c,
	  instead of the previous separate taper implementation. Also,
	  combine tape-label-reading for ZFTAPE and non-ZFTAPE drives (the
	  difference only matters on writing).
	* server-src/taperscan.c: Refactor the taper-scan algorithm from
	  taper, amtape, and amcheck. Implement label_new_tapes feature.
	* server-src/taperscan.h: Declare and document new taperscan
	  interface.
	* tape-src/tapeio.c: Notice the difference between a non-Amanda tape
	  and some other tape-reading problem.
	* tape-src/tapeio.h: New declarations.

2005-12-13  Jean-Louis Martineau <martineau@zmanda.com>

	* server-src/reporter.c (handle_success): On a taper line, the outsize
	  should only count dump to tape, not flush.

2005-12-13  Jean-Louis Martineau <martineau@zmanda.com>

	* server-src/amstatus.pl.in: Parse chunker DONE line to set output size.

2005-12-09  John Franks <jrfranks@zmanda.com>

	* client-src/Makefile.am: Do not include tape library if
	  configuring with --without-server option.
	* recover-src/Makefile.am: Do not include tape library if
	  configuring with --without-server option.

2005-12-08  Jean-Louis Martineau <martineau@zmanda.com>

	* configure.in: Move the size detection after detection of large
	  file support. That change the size of off_t.

2005-12-08  Jean-Louis Martineau <martineau@zmanda.com>

	* common-src/amanda.h: Set OFF_T_FMT to printf format of a off_t.
	* server-src/taper.c: Use OFF_T_FMT.

2005-12-08  Jean-Louis Martineau <martineau@zmanda.com>

	* configure.in: Set LL_FMT correctly.
	* server-src/conffile.c: Use LL_FMT.

2005-12-08  Jean-Louis Martineau <martineau@zmanda.com>

	* server-src/conffile.c: Maxdumpsize is a AM64.
	* server-src/planner.c: conf_maxdumpsize, total_size, tape_length and
	  tape_mark are am64_t.

2005-12-08  Jean-Louis Martineau <martineau@zmanda.com>

	* configure.in: Check for sizeof of many type. Check printf format of
	  a 64-bit integers.
	* common-src/amanda.h: Typedef am64_t to a 64 bits signed type,i
	  set AM64_FMT to the printf format of a am64_t variable.
	* server-src/conffile.c: New AM64 type.
	* server-src/conffile.h(getconf_am64): Prototype.

2005-12-08  Jean-Louis Martineau <martineau@zmanda.com>

	* client-src/Makefile.am: Remove amqde.
	* client-src/sendsize.c: Remove code to call amqde.
	* client-src/amqde.c: Remove file.
	* configure.in: Remove '--with-qde' option.

2005-12-05  Jean-Louis Martineau <martineau@zmanda.com>

	* server-src/amindexd.c (reply, lreply, fast_lreply): Must use
	  str_buffer_sizebuf instead of sizeof(bug).

2005-12-05  Jean-Louis Martineau <martineau@zmanda.com>

	* server-src/planner.c: Print the time in the FINISH line.
	* server-src/reporter.c: The estimate time is based on the planner
	  FINISH line.

2005-12-05  Jean-Louis Martineau <martineau@zmanda.com>

	* common-src/Makefile.am (bsdsecurity_LDADD): Add ssh-security.

2005-12-05  Jean-Louis Martineau <martineau@zmanda.com>

	* server-src/holding.c (scan_holdingdisk): Static function.
	* server-src/taper.c (signal_handler, install_signal_handlers): Ditto.
	* server-src/reporter.c (output_strange,do_postscript_output): Ditto.

2005-12-04  Jean-Louis Martineau <martineau@zmanda.com>

	* server-src/logfile.c (logtype_str): Add important ','.

2005-12-03  Jean-Louis Martineau <martineau@zmanda.com>

	* server-src/planner.c (setup_estimate): Fix wrong order for argument.

2005-12-03  Jean-Louis Martineau <martineau@zmanda.com>

	* server-src/driver.c (start_some_dumps): Don't test for
	  cur_idle == NOT_IDLE.

2005-12-03  Jean-Louis Martineau <martineau@zmanda.com>

	* server-src/driverio.c (check_unfree_serial): New fonction to check
	  unfreed serial number.
	* server-src/driverio.c (free_serial_dp): Set stable[s].dp to NULL.
	* server-src/driverio.h (check_unfree_serial): Prototype.
	* server-src/driver.c (main): Call check_unfree_serial.

2005-12-02  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Franz Fischer

	* config/acinclude.m4i: Fix for __alpha.

2005-12-02  Jean-Louis Martineau <martineau@zmanda.com>

	* common-src/util.c: Debug must end with '\n'.

2005-12-01  Jean-Louis Martineau <martineau@zmanda.com>

	* configure.in: Amanda support x86_64-unknown-linux-gnu.

2005-11-30  Jean-Louis Martineau <martineau@zmanda.com>

        * common-src/rsh-security.c (rsh_sendpkt): buf is a char array.
        * common-src/ssh-security.c (rsh_sendpkt): buf is a char array.
	* config/acinclude.m4i (AX_CREATE_STDINT_H): Newer macro.

2005-11-30  Jean-Louis Martineau <martineau@zmanda.com>

	* client-src/rundump.c: undef USE_RUNDUMP before define.

2005-11-30  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Franz Fischer

	* client-src/amqde.c: Fix compiler warning.

2005-11-30  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Franz Fischer

	* common-src/event.h: Fix compiler warning.
	* server-src/conffile.h: Fix compiler warning.

2005-11-30  Kevin Till	<ktill@zmanda.com>
	
	* client-src/client_util.c add server-side, client-side encryption
	  as well as custom compression. Custom compression patch is
	  orginally created by Matthieu Lochegnies.
	* client-src/client_util.h Ditto
	* client-src/selfcheck.c Ditto
	* client-src/sendbackup-dump.c Ditto
	* client-src/sendbackup-gnutar.c Ditto
	* client-src/sendbackup.c Ditto
	* client-src/sendbackup.h Ditto
	* common-src/fileheader.c Ditto
	* common-src/fileheader.h Ditto
	* common-src/util.h Ditto
	* example/amanda.conf.in Ditto
	* man/xml-source/amanda.conf.5.xml Ditto
	* restore-src/amrestore.c Ditto
	* restore-src/restore.c Ditto
	* server-src/conffile.c Ditto
	* server-src/conffile.h Ditto
	* server-src/diskfile.c Ditto
	* server-src/diskfile.h Ditto
	* server-src/dumper.c Ditto
	
2005-11-29  Jean-Louis Martineau <martineau@zmanda.com>

	* config/libtool.m4i: libtool 1.5.20
	* config/ltmain.sh: libtool 1.5.20

2005-11-29  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Franz Fischer

	* common-src/fileheader.c (build_header): Declation before instruction.
	* restore-src/amfetchdump.c: Don't use C++ style comment.
	* restore-src/restore.c: Don't use C++ style comment.
	* server-src/amindexd.c (reply, lreply, fast_lreply): buf must be
	   dynamicaly allocated.
	* server-src/logfile.h: Don't use C++ style comment.
	* server-src/taper.c (free_split_buffer): Test splitbuf against NULL.

2005-11-22 Paddy Sreenivasan <paddy@zmanda.com>
        * common-src/rsh-security.c: Fix x86_64 compile warnings.
        * common-src/ssh-security.c: Fix x86_64 compile warnings.
        * man/Makefile.am: Added EXTRA_XML files.
        * man/xml-source/amanda.8.xml: Added spanning patch variables.
        * man/xml-source/amrecover.8.xml: Added amfetchdump to SEE ALSO.
        * xslt/global.entities: Removed file.

2005-11-20  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Jon H. LaBadie

	* changer-src/chg-disk.sh.in: Check permission on file access.

2005-11-17  Paddy Sreenivasan <paddy@zmanda.com>
        * man/entities/global.entities: New file. Added man page entities.
        * man/entities/xinclude.dtd: New file.
        * man/xslt/man.xsl: Correct include path for settings.xsl.

2005-11-15  John R. Franks <jrfranks@zmanda.com>
	* changer-src/scsi-changer-driver.c: Fix IA-64 compile warnings.
	* common-src/rsh-security.c: Fix IA-64 compile warnings.
	* common-src/ssh-security.c: Fix IA-64 compile warnings.
	* regex-src/engine.c: Fix IA-64 compile warnings.
	* regex-src/regexec.c: Fix IA-64 compile warnings.

2005-11-15  Paddy Sreenivasan <paddy@zmanda.com>

        * configure.in:  Changed defaults for tape_dev and nr_tape_dev.
        * example/amanda.conf.in: Leave only changerfile definition
          uncommented.
        * man/xml-source/amanda.conf.5.xml: Updated defaults for 
          tapedev and rawtapedev

2005-11-10  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/planner.c: Fix incronly.

2005-11-05  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* man/Makefile.am: Set man_MANS,

2005-11-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* man/Makefile.am: Set man5_MANS and man8_MANS,
	  install-data-hook use them.

2005-11-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Olivier Cherrier

	* man/Makefile.am (install-data-hook): Set protection correclty
	  for man5 and man8.

2005-10-29  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/util.c (bind_portrange): Increase port in all case.

2005-10-27  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/conffile.c: Allow runtapes==0.
	* server-src/driver.c: Use a global conf_runtapes. Don't start a
	  taper if runtapes==0.
	* server-src/reporter.c: Don't print The next tapes if runtapes==0.


2005-10-24  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* Amanda 2.5.0b1 released.
	* configure.in: AM_INIT_AUTOMAKE(amanda, 2.5.0b1).
	* NEWS: Update for 2.5.0b1.

2005-10-25  Ian Turner <ian@zmanda.com>
	
	* man/Makefile.am: include amfetchdump.8.
	* man/xml-source/amadmin.8.xml: Add spanning-patch documentation.
	* man/xml-source/amanda.8.xml: ditto
	* man/xml-source/amrecover.8.xml: ditto
	* man/xml-source/amfetchdump.8.xml: ditto (new file)
	* man/xslt/global.entities: Add myself, Zmanda Inc.
	
2005-10-24  Jean-Louis Martineau <martineau@zmanda.com>

	* client-src/sendsize.c (getsize_wrapper): Add a NULL at the end of
	  the argvchild array.

2005-10-20  Jean-Louis Martineau <martineau@zmanda.com>

	* server-src/server_util.c (getcmd): Print DEBUG to stderr.

2005-10-20  Ian Turner <ian@zmanda.com>

	* configure.in: Check for xsltproc.
	* man/Makefile.am: Properly build, clean, and distribute generated
	  manpages from XML source.
	* man/amadmin.8: Remove from CVS
	* man/amanda.8: Remove from CVS
	* man/amanda.conf.5: Remove from CVS
	* man/amcheck.8: Remove from CVS
	* man/amcheckdb.8: Remove from CVS
	* man/amcleanup.8: Remove from CVS
	* man/amdd.8: Remove from CVS
	* man/amdump.8: Remove from CVS
	* man/amflush.8: Remove from CVS
	* man/amgetconf.8: Remove from CVS
	* man/amlabel.8: Remove from CVS
	* man/ammt.8: Remove from CVS
	* man/amoverview.8: Remove from CVS
	* man/amplot.8: Remove from CVS
	* man/amrecover.8: Remove from CVS
	* man/amreport.8: Remove from CVS
	* man/amrestore.8: Remove from CVS
	* man/amrmtape.8: Remove from CVS
	* man/amstatus.8: Remove from CVS
	* man/amtape.8: Remove from CVS
	* man/amtapetype.8: Remove from CVS
	* man/amtoc.8: Remove from CVS
	* man/amverify.8: Remove from CVS
	* man/amverifyrun.8: Remove from CVS
	* man/xml-source/amadmin.8.xml: Add from xml-docs
	* man/xml-source/amanda.8.xml: Add from xml-docs
	* man/xml-source/amanda.conf.5.xml: Add from xml-docs
	* man/xml-source/amcheck.8.xml: Add from xml-docs
	* man/xml-source/amcheckdb.8.xml: Add from xml-docs
	* man/xml-source/amcleanup.8.xml: Add from xml-docs
	* man/xml-source/amdd.8.xml: Add from xml-docs
	* man/xml-source/amdump.8.xml: Add from xml-docs
	* man/xml-source/amflush.8.xml: Add from xml-docs
	* man/xml-source/amgetconf.8.xml: Add from xml-docs
	* man/xml-source/amlabel.8.xml: Add from xml-docs
	* man/xml-source/ammt.8.xml: Add from xml-docs
	* man/xml-source/amoverview.8.xml: Add from xml-docs
	* man/xml-source/amplot.8.xml: Add from xml-docs
	* man/xml-source/amrecover.8.xml: Add from xml-docs
	* man/xml-source/amreport.8.xml: Add from xml-docs
	* man/xml-source/amrestore.8.xml: Add from xml-docs
	* man/xml-source/amrmtape.8.xml: Add from xml-docs
	* man/xml-source/amstatus.8.xml: Add from xml-docs
	* man/xml-source/amtape.8.xml: Add from xml-docs
	* man/xml-source/amtapetype.8.xml: Add from xml-docs
	* man/xml-source/amtoc.8.xml: Add from xml-docs
	* man/xml-source/amverify.8.xml: Add from xml-docs
	* man/xml-source/amverifyrun.8.xml: Add from xml-docs
	* man/xslt/expand-sambadoc.xsl: Add from xml-docs
	* man/xslt/global.entities: Add from xml-docs
	* man/xslt/man.xsl: Add from xml-docs
	* man/xslt/settings.xsl: Add from xml-docs

2005-10-20  Jean-Louis Martineau <martineau@zmanda.com>

	* server-src/amstatus.pl.in: a FLUSH command can't be in an estimate
	  phase.
	* server-src/driver.c: Start autoflush while waiting for estimate.
	* server-src/planner.c: Write FLUSH line before estimate.

2005-10-17  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by John R. Franks <jrfranks@zmanda.com>

	* server-src/taper.c (create_split_buffer): Should not use sizeof().

2005-10-17  Jean-Louis Martineau <martineau@zmanda.com>

	* server-src/taper.c (read_file): Move the putresult(DONE) to the
	  right place, some cleanup.

2005-10-17  Jean-Louis Martineau <martineau@zmanda.com>

	* server-src/planner.c: Increase DEFAULT_DUMPRATE to 1024 K/s.

2005-10-17  Ian Turner <ian@zmanda.com>

	* Changelog: Fix line breaks.
	* restore-src/restore.c: Give more useful FSF error messages.
	* recover-src/extract_list.c: Do better error checking on passed port
	  number.
	* common-src/tapelist.c: Do proper memory management of strings.
	  Otherwise really bad stuff happens.

2005-10-17  Jean-Louis Martineau <martineau@zmanda.com>

	* server-src/taper.c: Set SIGPIPE to SIG_IGN, the code already
	  handle it correctly.

2005-10-16  Jean-Louis Martineau <martineau@zmanda.com>

	* server-src/taper.c (signal_handler): Don't REMOVE_SHARED_MEMORY, it
	  is done by exit.

2005-10-16  Jean-Louis Martineau <martineau@zmanda.com>

	* server-src/driverio.c (serial2disk): Print str if error.

2005-10-15  Paddy Sreenivasan <paddy@zmanda.com>

        * server-src/taper.c: Shared memory need not be removed in normal paths.
          Done as part of atexit. 

2005-10-15  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by John R. Franks <jrfranks@zmanda.com>

	* changer-src/scsi-aix.c: calls to open/openx guages success by
	  checking for a file descriptor greater than 0.  0 is also a valid
	  descriptor so the check should be >= 0.
	  Calls to SCSI_OpenDevice does not check for error return.
	  Calls to SCSI_OpenDevice does not check for error return.
	  Calls to SCSI_OpenDevice does not check for error return.
	  Call to opendir() does not check for error.
	* changer-src/scsi-hpux_new.c: Ditto.
	* changer-src/scsi-irix.c: Ditto.
	* changer-src/scsi-linux.c: Ditto.
	* changer-src/scsi-solaris.c: Ditto.
	* client-src/selfcheck.c: Call to open() does not check for error.
	* client-src/sendbackup.c: Call to freopen() does not check for error.
	* client-src/sendsize.c: Call to open() does not check for error.
	* common-src/bsd-security.c: Call to open() does not check for error.
	* common-src/file.c: Call to open() does not check for error.
	* restore-src/amrestore.c: Calls to tape_open() do not always check
	  return code.  open() is called with open flags set to 0
	  (Call always fails with an EINVAL)
	* restore-src/restore.c: fopen() return error check  is "fopen() < 0".
	  fopen returns a pointer and the proper check should be
	  "fopen() == NULL".
	  Call to open() does not check for error.
	* tape-src/tapeio.c: tape_open() is called here and other places with a
	  variable number of arguments, and yet is not defined as a varargs
	  function...
	* tape-src/tapeio.h: Prototype for tape_open.

2005-10-15  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by Paddy Sreenivasan <paddy@zmanda.com>

	* client-src/sendsize.c: Log message changes.
	* server-src/taper.c: And an atexit function to detach shared memory.
	  Trap some signal and detach shared memory.

2005-10-14  Jean-Louis Martineau <martineau@zmanda.com>

	* regex-src/regcomp.c (findmust): Initialized start to NULL.

2005-10-14  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by John R. Franks <jrfranks@zmanda.com>

	* regex-src/cclass.h: Fixed to add missing braces and reformat long
	  strings to fix in 80 columns.
	* regex-src/cname.h: Fixed by adding braces and tidying up code a bit.
	* regex-src/regcomp.c (p_ere): Initialized prevback and prevfwd to 0.
	  ifdef out unused mcsub, mcin and mcfind functions.
	  (findmust) Initialized newstart to NULL.
	* regex-src/regerror.c: Adds missing braces.
	* regex-src/regexec.c (nope): Use only in assert, so it is not only
	  defined if NDEBUG is not defined.

2005-10-14  Jean-Louis Martineau <martineau@zmanda.com>
	Patch by John R. Franks <jrfranks@zmanda.com>

	* common-src/krb4-security.c (krb4_security_dummy): Rename from dummy,
	  it is not static int.
	* common-src/krb5-security.c (krb5_security_dummy): Rename from dummy,
	  it is not static int.

2005-10-13  Jean-Louis Martineau <martineau@zmanda.com>

	* common-src/util.c (bind_portrange): New argument proto.
	  Check for reserved port.
	* common-src/util.h (bind_portrange): New prototype.
	* common-src/bsd-security.c (bind_portrange): New prototype.
	* common-src/dgram.c: Add "udp" as argument to bind_portrange.
	* common-src/stream.c: Add "tcp" as argument to bind_portrange.

2005-10-12  Jean-Louis Martineau <martineau@zmanda.com>

	* restore-src/amidxtaped.c (check_security_buffer): i is a socklen_t.
	* restore-src/amidxtaped.c (main): Remove i, fd, amrestore_path, pid,
	  isafile, stat_tape, tapename, s, fp, ch and errstr variable.

2005-10-11  Ian Turner <ian@zmanda.com>
	Patch by  Jean-Louis Martineau <martineau@zmanda.com>
	
	* restore-src/amfetchdump.c: Remove unused variable debug.
        * restore-src/amidxtaped.c: Remove lock_logfile(), which is also 
	  in restore.c.
	* restore-src/Makefile.am: Include libamanda twice, to fix build 
	  on some machines.

2005-10-11  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* restore-src/Makefile (noinst_HEADERS): Add restore.h.
	* restore-src/restore.c (search_tapes): Add the fourth argument to
	  read_file_header.

2005-10-11  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/conffile.c: dpcur.s_split_diskbuffer must be initialize
	  to 0.
	* server-src/reporter.c (handle_partial): Set repdata to the result
	  of handle_success.
	* server-src/taper.c: Set the first-file.

2005-10-11  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* client-src/client_util.c, server-src/amcheck.c,
	  server-src/reporter.c: Add missing type for arguments.

2005-10-11  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/taper.c (tape_writer_side): detach_buffers on normal exit.

2005-10-10  Ian Turner <ian@zmanda.com>

	* server-src/amtape.h: Apply tape-spanning patch by John Stange
	  <building@cs.umd.edu> as ported to 2.5.0 by Ian Turner, with
	  contributions by Christopher Pascoe <c.pascoe@itee.uq.edu.au>.
	* configure.in: Ditto
	* amplot/Makefile.am: Ditto
	* changer-src/Makefile.am: Ditto
	* client-src/Makefile.am: Ditto
	* common-src/Makefile.am: Ditto
	* common-src/amanda.h: Ditto
	* common-src/amfeatures.c: Ditto
	* common-src/amfeatures.h: Ditto
	* common-src/fileheader.c: Ditto
	* common-src/fileheader.h: Ditto
	* common-src/match.c: Ditto
	* common-src/tapelist.c: Ditto
	* common-src/tapelist.h: Ditto
	* example/amanda.conf.in: Ditto
	* man/Makefile.am: Ditto
	* recover-src/amrecover.c: Ditto
	* recover-src/amrecover.h: Ditto
	* recover-src/display_commands.c: Ditto
	* recover-src/extract_list.c: Ditto
	* restore-src/Makefile.am: Ditto
	* restore-src/amfetchdump.c: Ditto
	* restore-src/amfetchdump.h: Ditto
	* restore-src/amidxtaped.c: Ditto
	* restore-src/amrestore.c: Ditto
	* restore-src/restore.c: Ditto
	* restore-src/restore.h: Ditto
	* server-src/Makefile.am: Ditto
	* server-src/amadmin.c: Ditto
	* server-src/amindexd.c: Ditto
	* server-src/amoverview.pl.in: Ditto
	* server-src/amtoc.pl.in: Ditto
	* server-src/amverify.sh.in: Ditto
	* server-src/changer.c: Ditto
	* server-src/conffile.c: Ditto
	* server-src/conffile.h: Ditto
	* server-src/disk_history.c: Ditto
	* server-src/disk_history.h: Ditto
	* server-src/diskfile.c: Ditto
	* server-src/diskfile.h: Ditto
	* server-src/driver.c: Ditto
	* server-src/driverio.c: Ditto
	* server-src/find.c: Ditto
	* server-src/find.h: Ditto
	* server-src/holding.c: Ditto
	* server-src/holding.h: Ditto
	* server-src/logfile.c: Ditto
	* server-src/logfile.h: Ditto
	* server-src/planner.c: Ditto
	* server-src/reporter.c: Ditto
	* server-src/server_util.c: Ditto
	* server-src/server_util.h: Ditto
	* server-src/taper.c: Ditto

2005-10-07  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/taper.c: Change message: on new tape due to

2005-10-06  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by John R. Franks 

	* common-src/amflock.c (main): Don't call safe_fd, it's not needed
	  during configure.
	* configure.in: '#include <sys/types.h>' in the check
	  'for Linux like scsi support (sg)'

2005-10-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* client-src/amandad.c (writebuf): Call waitpid in the parent.

2005-10-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* client-src/amandad.c (service_delete): Remove call to sleep.
	* common-src/bsd-security.c: Add bsdprintf. Add more debug.
	  The handle is used as a string, instead of 2 int.

2005-10-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/rsh-security.c: rshprintf should call dbprint.
	* common-src/ssh-security.c: rshprintf should call dbprint, add many
	  rshprintf.
	* common-src/event.c: Add eventprintf, use it. Add debug_prefix_time
	  to the log. 

2005-10-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/stream.c: len is a socklen_t.
	* server-src/amindexd.c: Add socklen as a socklen_t.
	* restore-src/amidxtaped.c: Add socklen as a socklen_t.
	* tape-src/tapetype.c: Change printf format.
	* server-src/amlabel.c: Add a variable isa_zftape. init fd to -1.
	* server-src/dumper.c: Init outfd to -1.
	* common-src/file.c (areads_getbuf): First argument is const.

2005-10-01  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/reporter.c: Don't trunk hostname/diskname in
	  'FAILURE AND STRANGE DUMP SUMMARY' section.

2005-10-01  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/chunker.c (main): Remove outfd.

2005-09-30  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/conffile.c, server-src/diskfile.c, server-src/infofile.c,
	  client-src/getfsent.c, common-src/statfs.c, common-src/token.c
          (main): Remove fd declaration.

2005-09-30  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* client-src/runtar.c: 'e' and 'bdf' are only needed if GNUTAR.

2005-09-30  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/sl.c (insert_sort_sl). Typo.

2005-09-30  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* config/config.guess: Update from automake 1.9.5.
	* config/config.sub: Update from automake 1.9.5.
	* config/depcomp: Update from automake 1.9.5.
	* config/install-sh: Update from automake 1.9.5.
	* config/missing: Update from automake 1.9.5.
	* config/mkinstalldirs: Update from automake 1.9.5.
	* config/ltmain.sh: Update from libtool-1.5.16.
	* config/libtool.m4i: Update from libtool-1.5.16.

2005-09-30  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/bsd-security.c: Fix small bug.

2005-09-22  John R. Jackson <jrj@purdue.edu>

	* configure.in: If --without-server is specified, either on the
	  command line or via config.site, make sure --without-restore
	  is also in effect.  Avoids compilation errors if mismatched.
	* example/config.site: Document above.

2005-09-21  John R. Jackson <jrj@purdue.edu>

	* server-src/getconf.c: Allow CLIENT_LOGIN to be retrieved via
	  "amgetconf build.CLIENT_LOGIN".

2005-09-21  John R. Jackson <jrj@purdue.edu>

	* server-src/amlabel.c: 'int fd' is only needed if HAVE_LINUX_ZFTAPE_H
	  is defined.

2005-09-21  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amlabel.c: 'int fd' is needed.

2005-09-20  John R. Jackson <jrj@purdue.edu>

	* server-src/reporter.c: Fix minor typo noticed by Scott R. Burns
	  <Scott.Burns@Netcontech.Com>.

2005-09-20  John R. Jackson <jrj@purdue.edu>

	* common-src/file.c: Create safe_fd() to do common file descriptor
	  safety operations at the start of every program.  In addition
	  to closing everything from three on up that used to be done
	  with explicit code, make sure stdin, stdout and stderr are
	  open per a potential (but unlikely) security report from Ben
	  Schwarz <bschwarz@EECS.berkeley.EDU>.
	* common-src/amanda.h: Ditto.
	* client-src/amandad.c: Ditto.
	* client-src/calcsize.c: Ditto.
	* client-src/getfsent.c: Ditto.
	* client-src/killpgrp.c: Ditto.
	* client-src/rundump.c: Ditto.
	* client-src/runtar.c: Ditto.
	* client-src/selfcheck.c: Ditto.
	* client-src/sendbackup.c: Ditto.
	* client-src/sendsize.c: Ditto.
	* client-src/versionsuffix.c: Ditto.
	* common-src/amflock.c: Ditto.
	* common-src/rsh-security.c: Ditto.
	* common-src/ssh-security.c: Ditto.
	* common-src/statfs.c: Ditto.
	* common-src/token.c: Ditto.
	* recover-src/amrecover.c: Ditto.
	* restore-src/amidxtaped.c: Ditto.
	* restore-src/amrestore.c: Ditto.
	* server-src/amadmin.c: Ditto.
	* server-src/amcheck.c: Ditto.
	* server-src/amcleanupdisk.c: Ditto.
	* server-src/amflush.c: Ditto.
	* server-src/amindexd.c: Ditto.
	* server-src/amlabel.c: Ditto.
	* server-src/amlogroll.c: Ditto.
	* server-src/amtape.c: Ditto.
	* server-src/amtrmidx.c: Ditto.
	* server-src/amtrmlog.c: Ditto.
	* server-src/chunker.c: Ditto.
	* server-src/conffile.c: Ditto.
	* server-src/diskfile.c: Ditto.
	* server-src/driver.c: Ditto.
	* server-src/getconf.c: Ditto.
	* server-src/infofile.c: Ditto.
	* server-src/planner.c: Ditto.
	* server-src/reporter.c: Ditto.
	* server-src/taper.c: Ditto.
	* server-src/dumper.c: Ditto plus remove incorrect chdir to hard
	  coded "/tmp/amanda".

2005-09-20  John R. Jackson <jrj@purdue.edu>

	* client-src/calcsize.c: Fix format string.
	* server-src/diskfile.c: Fix compiler warnings.
	* server-src/planner.c: Fix compiler warnings.

2005-09-20  John R. Jackson <jrj@purdue.edu>

	* common-src/amanda.h: Add dbreopen() so debug file can be closed
	  and then reopened if needed.
	* common-src/debug.c: Ditto.
	* client-src/runtar.c: Close the debug file (fd 10) around the
	  exec of GNU tar.  Newer versions complain about stray file
	  descriptors.
	* server-src/getconf.c: Use dbreopen() to create the debug file.
	  Do not try to open config file unless needed (allows clients to
	  use build.XXX/dbopen.XXX/dbclose.XXX).

2005-09-20  John R. Jackson <jrj@purdue.edu>

	* client-src/sendbackup-dump.c: Ignore a new message from Solaris
	  vxdump.

2005-09-20  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/bsd-security.c: Generate a unique event_id, thei
	  proto_handle is not always unique.

2005-09-15  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amverify.sh.in: Don't check for EOI, it's buggy.

2005-09-12  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/driverio.c: Don't save history with size < 0.

2005-09-12  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Geert Uytterhoeven <geert@linux-m68k.org>

	* server-src/planner.c: Don't use history with size < 0.

2005-09-07  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch Paul Bijnens <paul.bijnens@xplanation.com>

	* server-src/planner.c(delay_dumps): Delay incremental dump also
	  larger than tape.

2005-09-07  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Orion Poplawski <orion@cora.nwra.com>

	* server-src/amoverview.pl.in: Add options -last, -num0 and -togo0.
	* man/amoverview.8: Document -last, -num0 and -togo0.

2005-09-07  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Orion Poplawski <orion@cora.nwra.com>

	* server-src/driver.c: Make tape_length and tape_left unsigned long.

2005-07-11  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Stefan G. Weichinger <monitor@oops.co.at>

	* client-src/sendbackup-gnutar.c: Added RE for new Samba-releases.

2005-07-11  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	Bug found by John E Hein <jhein@timing.com>.
	* server-src/amadmin.c: Fix of by one with NB_HISTORY.
	* server-src/infofile.c:x: Fix of by one with NB_HISTORY.

2005-06-08  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Jay Fenlason <fenlason@redhat.com>

	* client-src/sendsize.c: Fix dbprintf call.

2005-06-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	    Stefan G. Weichinger <monitor@oops.co.at>

	* example/amanda.conf.in: edited the default-value for the
	                          holdingdisk-usage to "use -100 Mb".
	                          The old value "use 290 Mb" didn't make much
	                          sense anymore.

2005-06-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amverifyrun.sh.in: Remove buggy space.

2005-05-17  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amadmin.c: Add [--days <num>] argument to tape subcommand.

2005-05-13  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* example/amanda.conf.in: Update from 2.4.5.

2005-05-13  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* docs/*: New documentation from xml-docs.
	* docs/Makefile.am (pkgdata_DATA): Update for new files.

2005-05-13  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* man/Makefile.am (COMMON_MAN_PAGES): Add amanda.conf.5.

2005-05-13  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* man/*: Use man pages form xml-docs.
	* configure.in (AC_CONFIG_FILES): Remove all man pages.
	* man/Makefile.am (EXTRA_DIST): Add amadmin.8 amanda.8 amanda.conf.5 
	  amcheck.8 amcheckdb.8 amcleanup.8 amdump.8 amflush.8 amgetconf.8
	  amlabel.8 amoverview.8 amreport.8 amrecover.8 amrmtape.8 amstatus.8
	  amtapetype.8 amtoc.8 amverify.8 amverifyrun.8

2005-05-05  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/rsh-security.c (net_read_fillbuf): Read only a packet,
	  nothing more.
	* common-src/ssh-security.c (net_read_fillbuf): Read only a packet,
	  nothing more.
	* common-src/rsh-security.c (conn_put): Don't kill the process, only do
	  a wait with WNOHANG.
	* common-src/ssh-security.c (conn_put): Don't kill the process, only do
	  a wait with WNOHANG.

2005-04-14  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* changer-src/chg-zd-mtx.sh.in: Improve handling of
	  "Unknown Storage Element Loaded".

2005-04-06  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	- https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=144052

	* server-src/amverifyrun.sh.in: Filter changer log file.

2005-04-06  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amcheck.c: Improve messages.

2005-04-06  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* client-src/sendsize.c (generic_calc_estimates): Use amname instead
	  of dirname in message.

2005-03-29  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/conffile.h: Rename getcont_unit_divisor to
	  getconf_unit_divisor.
	* server-src/amadmin.c: Use getconf_unit_divisor.
	* server-src/amcheck.c: Use getconf_unit_divisor.
	* server-src/conffile.c: Use getconf_unit_divisor.
	* server-src/conffile.c (unit_divisor): Init to 1.
	* server-src/reporter.c: Use getconf_unit_divisor. The mb macro always
	  divide by 1024. Add the du macro. Use mb or du where appropriate.

2005-03-16  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/infofile.h (history_t): Add secs field.
	* server-src/infofile.c (read_txinfofile): Parse info file with secs
	  in history.
	* server-src/infofile.c (write_txinfofile): Write secs in history.
	* server-src/driverio.c (update_info_dumper): Update secs in history.

2005-03-16  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/planner.c: Improve server estimate.
	* server-src/planner.c: Write server estimate like others estimate.

2005-02-14  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amstatus.pl.in: last_level is negative, on new disk.

2005-02-09  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amstatus.pl.in: Use '-?' to match negative values
	  instead of '-*'.

2005-02-09  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Orion Poplawski <orion@cora.nwra.com>

	* server-src/amoverview.pl.in: Print the total number of level 0
	  dumps for each disk and the number of runs until the last level 0
	  dump will be overwritten.

2005-02-09  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Phil Homewood <pdh@snapgear.com>

	* server-src/amoverview.pl.in: Add -skipmissed option.

2005-02-09  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/driver.c: Print the chunksize to the log.

2005-02-09  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* client-src/calcsize.c: Print estimate to STDERR.
	* client-src/sendsize.c (generic_calc_estimates): Read calcsize result,
	  and send it to amandad. Write debuging message.

2005-02-09  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Franz G. Fischer

	* server-src/conffile.c: Adds a value type LONG and a val_t.l long
	  union member and changes get_number() to return long and
	  get_simple() to fill val_t.l if called for a long value.  The
	  get_simple() calls have been changed to LONG for typetype_t.blocksize
	  typetype_t.length, typetype_t.filemark, holdingdisk_t.disksize and
	  holdingdisk_t.chunksize.

2005-02-09  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amdump.sh.in: Redirect in append mode.
	* server-src/driver.c: Set stdout and stderr to not buffered.
	* server-src/planner.c: Set stderr to not buffered.
	  Print 'setup_estimate:' on one line.
	* server-src/amstatus.pl.in: Parse new 'setup_estimate:' line.

2005-02-09  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* client-src/calcsize.c: Improve estimate for sparse file and count
	  space for filenames.

2005-02-09  Jean-Louis Martineau <martineau@iro.umontreal.ca>

        * server-src/planner.c: Improve message if no incremental estimate.

2004-12-21  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Christopher Pascoe <c.pascoe@itee.uq.edu.au>

	* common-src/match.c (match_glob, match_tar): Don't amfree(regex)
	  before calling error().

2004-11-22  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/driver.c (startaflush): Use ALGO_SMALLEST if nothing fit.

2004-11-22  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/driver.c: Typo.

2004-11-19  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* restore-src/amrestore.c: Should now work correctly with empty file.
	* server-src/amverify.sh.in: Parse "End-of-Information detected."
	  message from amrestore.

2004-11-19  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/driver.c: tape_left should not become negative.

2004-11-19  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Orion Poplawski <orion@cora.nwra.com>

	* server-src/diskfile.c: Parse negative spindle (-1).

2004-11-19  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amadmin.c: Balance subcommand use displayunit.
	* server-src/amcheck.c: Small cleanup.

2004-11-19  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* restore-src/amrestore.c: Undo patch from 2004-11-11, it break
	  the file: dirver.

2004-11-19  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amstatus.pl.in: Remove trace.

2004-11-16  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/diskfile.c: Compilation fix.

2004-11-16  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/conffile.c: Parse displayunit,
	  new fonction getcont_unit_divisor().
	* server-src/conffile.h: Prototype of getcont_unit_divisor().
	* server-src/amcheck.c: Use displayunit to display holding disk size.
	* server-src/amstatus.pl.in: Use displayunit to display dump size.
	* server-src/reporter.c: use displayunit to display dump size.
	* Document displayunit.

2004-11-16  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/reporter.c: Change 'Daily' for 'Incr.'.

2004-11-15  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amstatus.pl.in Fix for level -1.

2004-11-15  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Daniel Widyono <widyono@seas.upenn.edu>

	* changer-src/chg-zd-mtx.sh.in: Fix for library with barcode.

2004-11-11  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* restore-src/amrestore.c: Read empty file.

2004-11-10  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/tapetype.c: Use new tape.

2004-11-08  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amstatus.pl.in: Display partial estimate.

2004-11-08  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/diskfile.c (read_diskline): A spindle must be numerical.

2004-10-21  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/holding.c (rename_tmp_holding): Always rename files.

2004-10-21  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/driver.c: Print message when too many retry.
	* server-src/amstatus.pl.in: Detect a failed dump after too many retry.
	* amplot/amplot.awk: Parse these message.

2004-10-21  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/driver.c (dump_to_tape): Don't retry a dump indefinitely
	  if dumper returns DONE and taper returns TRYAGAIN.

2004-10-21  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/driver.c (dump_to_tape): Don't retry a dump indefinitely
	  if dumper returns TRYAGAIN and taper returns DONE.

2004-10-20  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amflush.c: Don't start a driver if nothing to flush.

2004-10-14  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Eric Siegerman <erics@telepres.com>

	* example/3hole.ps: Fix for multiple tape.

2004-10-04  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amverify.sh.in: Terminate if no tape online.

2004-09-17  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amadmin.c (main): Call check_dumpuser() as soon as posible.

2004-09-17  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/conffile.c (getconf_byname): Special case for typ == BOOL.

2004-09-17  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/planner.c (promote_hills): Use dumpcycle instead of
	  tapecycle.
	* example/amanda.conf.in: Remove warning for tapecyle set to inf.

2004-09-17  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amadmin.c (balance): Don't core dump if DUMPCYLE is too
	  big.

2004-09-15  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/tapetype.c: New -o option, doesn't overwrite amanda
	  tape without -o.
	* man/amtapetype.8.in: Document new -o option.

2004-09-15  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amstatus.pl.in: Works with failed dump to tape.

2004-08-31  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* client-src/sendbackup-gnutar.c (end_backup): Write warning message
	  in not fatal error.
	* server-src/dumper.c (process_dumpline): Parse warning message.
	* server-src/reporter.c (handle_strange): Print warning message in
	  the STRANGE summary.

2004-08-31  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/driverio.c (free_serial): Set stable[s].dp to NULL.
	* server-src/driverio.c (disk2serial): Check that stable[s].dp == NULL.

2004-08-31  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Joe Rhett <jrhett@isite.net>

	* common-src/alloc.c (safe_env): Keep SYSTEMROOT if __CYGWIN__.

2004-08-31  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Orion Poplawski <orion@cora.nwra.com>

	* server-src/conffile.c (copy_dumptype): Copy maxpromoteday.

2004-08-12  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* client-src/selfcheck.c (check_disk): More check for CALCSIZE.

2004-08-11  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/amfeatures.h (fe_selfcheck_calcsize): New feature.
	* common-src/amfeatures.c (am_init_feature_set): Set
	  fe_selfcheck_calcsize.
	* client-src/selfcheck.c: Check if calcsize binary is available if
	  it is needed.
	* server-src/amcheck.c (start_host): Call selfcheck with CALCSIZE
	  if it support fe_selfcheck_calcsize.

2004-08-05  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* man/amanda.8.in: Document 'estimate' dumptype option.

2004-08-04  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amrmtape.sh.in: Understand history info.

2004-08-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/driver.c: Typo.

2004-08-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amstatus.pl.in: Parse CONTINUE and RQ-MORE-DISK line,
	  print if a dump is waiting for holding disk space (roomq).

2004-08-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/driver.c (handle_dumper_result, handle_chunker_result):
	  Don't call free_serial().
	* server-src/driver.c (dumper_result): Call free_serial_dp(dp).
	* server-src/driverio.c (dumper_cmd): Remove CONTINUE cmd.
        * server-src/driverio.c (chunker_cmd): Print serial number for CONTINUE
          command.
        * server-src/driverio.c (disk2serial): Try to find a 'dp' before
          allocating a new serial.
	* server-src/driverio.c (free_serial_dp): New function to remove the
	  serial for a dp.
	* server-src/driverio.h (free_serial_dp): Prototype.
        * server-src/chunker.c (databuf_flush): Read serial number for CONTINUE
          command.

2004-08-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/planner.c (getsize): Do SERVER estimate, call sendsize with
	  CALCSIZE estimate.

2004-08-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* client-src/calcsize.c: Support exclude and include like gnutar,
	  change in program argument.
	* client-src/sendsize.c: Execute calcsize as requested.
	* common-src/amfeatures.h (fe_calcsize_estimate): New feature.
	* common-src/amfeatures.c (am_init_feature_set): set
	  fe_calcsize_estimate.
	* server-src/amcheck.c (start_host): Check if client support CALCSIZE
	  estimate.

2004-08-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/conffile.h (ES_CLIENT, ES_SERVER, ES_CALCSIZE): New define
	  for estimate type.
	* server-src/conffile.h (dumptype_t): Add 'estimate' and 's_estimate'
	* server-src/conffile.c (get_estimate): New function to parse estimate
	  type, ....
	* server-src/diskfile.c (read_diskline): Copy 'estimate'.
	* server-src/diskfile.h (disk_t): Add 'estimate'.
	* server-src/amadmin.c (disklist_one): Print estimate type.

2004-08-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/match.c (match_tar, tar_to_regex): New fonction similar
	  to the exclude option of tar.
	* common-src/amanda.h (match_tar, tar_to_regex): Prototype.

2004-08-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/infofile.h (history_t): new struct.
	* server-src/infofile.h (info_t): Add a history_t.
	* server-src/infofile.c (read_txinfofile): Parse history data.
	* server-src/infofile.c (write_txinfofile): Print history data.
	* server-src/amadmin.c (export_one): export history data.
	* server-src/amadmin.c (import_one): import history data.
	* server-src/driverio.c (update_info_dumper): update history data.

2004-05-10  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* server-src/planner.c: Log L_DISK for autoflush disk.

2004-05-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/planner.c (handle_result): Add dp to pestq at the
	  correct place.

2004-04-30  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/amanda.h: #include "amanda-int.h" only if !CONFIGURE_TEST.

2004-04-29  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* config/acinclude.m4i (AX_CREATE_STDINT_H) : New macro.
	* configure.in: Use AX_CREATE_STDINT_H(common-src/amanda-int.h).
	* common-src/amanda.h: include "common-src/amanda-int.h".
	* changer-src/scsi-cam.c: Change u_int32_t for uint32_t.

2004-04-27  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* configure.in: Fix for automake 1.8.4.
	* config/acinclude.m4i: Fix for automake 1.8.4.

2004-04-26  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* configure.in: Result of autoupdate.

2004-04-26  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* config/config.guess: Update from automake 1.8.
	* config/config.sub: Update from automake 1.8.
	* config/depcomp: Update from automake 1.8.
	* config/install-sh: Update from automake 1.8.
	* config/missing: Update from automake 1.8.
	* config/mkinstalldirs: Update from automake 1.8.
	* config/ltmain.sh: Update from libtool-1.5.6.
	* config/libtool.m4i: Update from libtool-1.5.6.

2004-04-26  Marc Mengel <mengel@fnal.gov>

	* tape-src/output-rait.c: Verify reads correctly.

2004-04-26  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/driver.c (continue_dumps): Fix deadlock if holding disk
	fill up when in degraded mode.

2004-04-23  Eric Siegerman <eric_97@pobox.com>

	Bug fix: amflush would run, and consume a tape, even if there
	were no Amanda directories waiting to be flushed:
	* common-src/sl.c (is_empty_sl): New function to test
	  whether a list is empty.
	* common-src/sl.h (is_empty_sl): Prototype.
	* server-src/amflush.sh (main): Use is_empty_sl(),
	  rather than ==NULL, to test emptiness of datestamp_list.

2004-04-23  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/planner.c (setup_estimate): Typo.

2004-04-22  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	Allow bumpsize, bumppercent, bumpdays and bumpmult to be in a dumptype.
	* server-src/conffile.c: Parse.
	* server-src/conffile.h: Define.
	* server-src/amadmin.c (disklist_one): Use.
	* server-src/diskfile.c (read_diskline): Initialize.
	* server-src/diskfile.h: Define.
	* server-src/planner.c: Use.
	* man/amanda.8.in: Document.

2004-04-22  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Fix by Paul Bijnens <paul.bijnens@xplanation.com>

	* server-src/planner.c (setup_estimate): Only ask for level 0 estimate
	  if strategy is noinc.

2004-04-21  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Documentation from Paul Bijnens <paul.bijnens@xplanation.com>

	* man/amoverview.8.in: Document results.

2004-04-21  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* server-src/amoverview.pl.in: Print last two characters.

2004-04-16  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* changer-src/chg-disk.sh.in: Fix for sh compatibility.

2004-04-14  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Fix by John Koyle <jkoyle@rfpdepot.com>

	* common-src/dgram.c: Fix EAGAIN on Linux.

2004-04-06  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amadmin.c (bumpsize): Typo.

2004-04-06  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	New bumppercent global option.
	* example/amanda.conf.in: Document it.
	* man/amanda.8.in: Document it.
	* server-src/amadmin.c (bumpsize): Write it.
	* server-src/conffile.c: Parse it.
	* server-src/conffile.h: Define It.
	* server-src/planner.c (bump_thresh): New size_level_0 parameter,
	  use the new bumppercent option.

2004-04-05  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amadmin.c: Rename host_t to amhost_t.
	* server-src/amcheck.c: Ditto.
	* server-src/amindexd.c: Ditto.
	* server-src/diskfile.c: Ditto.
	* server-src/diskfile.h: Ditto.
	* server-src/driver.c: Ditto.
	* server-src/planner.c: Ditto.

2004-03-26  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* amplot/amplot.awk: Parse "driver: tape size" line.

2004-03-22  Stefan G. Weichinger <monitor@oops.co.at>

	* server-src/amcheck.c (start_host): Added warning for hostname
	  localhost.
	* docs/TOP-TEN-QUESTIONS: added note about localhost-warning.

2004-03-19  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* docs/Makefile.am (pkgdata_DATA): Add TOP-TEN-QUESTIONS.

2004-03-18  Stefan G. Weichinger <monitor@oops.co.at>

	* docs/TOP-TEN-QUESTIONS: New file.

2004-03-17  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/reporter.c (handle_success): Set stats[i].coutsize
	  correctly.
	* server-src/taper.c: Do not subtract tt_blocksize_kb from filesize.

2004-03-16  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/ssh-security.c: New ssh security driver.
	* common-src/Makefile.am (libamanda_la_SOURCES): Add ssh-security.c.
	* common-src/security.c: Add ssh security driver.
	* configure.in: Add --with-ssh-security. Define SSH_SECURITY.

2004-03-16  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amcheck.c: Do labelstr check in correct order.

2004-03-10  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	Use only one time event for all dumpers, no wait event.
	start_some_dumps is called everytime a dumper or taper finish.
	* server-src/driver.c (dumpers_ev_time): New global event.
	* server-src/driver.c (start_some_dumps): Remove dumper argument,
	  can start many dump.
	* server-src/driver.c (dumper_result): Call start_some_dumps instead
	  of event_wakeup.
	* server-src/driver.c (handle_idle_wait): Remove function.
	* server-src/driver.c (handle_dumpers_time): new handle for
	  dumpers_ev_time, it call start_some_dumps.
	* server-src/driverio.h (dumper_t): Remove ev_wait.
	* server-src/driverio.c (startup_dump_process): Don't set ev_wait.

2004-03-09  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/fileheader.c (print_header): Fix fprintf use.
	* client-src/amqde.c (parse_exclude_path): Fix = by ==.
	* common-src/protocol.c (s_repwait): Fix compiler warning.
	* common-src/rsh-security.c (runrsh): Fix compiler warning.

2004-03-05  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/pipespawn.c (pipespawn): Remove passwdvar and passwdfd.

2004-02-13  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Reported by Allen Liu <allen@bellglobal.com>

	* server-src/amverifyrun.sh.in: Replace '-e' test by '-f'.

2004-02-13  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amcheck.c: Verify the tape is listed in the tapelist file.
	* server-src/taper.c: Ditto

2004-02-13  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/driver.c (dump_schedule): Print complete name.

2004-02-13  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	The estimate send a PREP (partial REP) packet after each estimate.
	* client-src/amandad.c: Send PREP packet if sendsize.
	* common-src/amfeatures.c (am_init_feature_set): Add
	  fe_partial_estimate.
	* common-src/amfeatures.h (am_feature_e): Add fe_partial_estimate.
	* common-src/packet.c (pktypes[]): Add PREP.
	* common-src/packet.h (pktype_t): Add P_PREP.
	* common-src/protocol.c (action_t): Add A_CONTPEND.
	* common-src/protocol.c: Handle P_PREP packet.
	* server-src/amstatus.pl.in: Parse "got partial result" line.
	* server-src/planner.c: Handle P_PREP packet.

2004-02-13  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Reported by Jason Brooks <jason.brooks@windriver.com>

	* server-src/reporter.c: Remove duplicate setting of cd to
	  &ColumnData[Level].

2004-02-12  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Philippe Charnier <charnier@xp11.frmug.org>

	* server-src/amtrmidx.c: Add '\n'.

2004-02-11  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* recover-src/set_commands.c (cd_glob): Fix memory leak.

2004-02-11  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* recover-src/set_commands.c (cd_dir, set_directory): Fix memory leak.
	* recover-src/uscan.l: Fix double amfree.

2004-02-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/driver.c: Build holding disk name with timestamp.
	* server-src/holding.c (is_datestr): Check also for timestamp.
	* server-src/planner.c: Flush today's dump with autoflush.
	* server-src/find.c: Find holding disk with timestamp.
	* server-src/find.h (find_result_t): Add timestamp field.

2004-02-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* changer-src/chg-zd-mtx.sh.in: Works if all slot and tape are full.

2004-02-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amverifyrun.sh.in: Do not execute amverify if no tape
	  to verify.

2004-02-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amdump.sh.in: Do not redirect to /dev/null.

2004-02-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* config/acinclude.m4i: Define CF_WAIT_INT.
	* configure.in: Call CF_WAIT_INT.
	* common-src/amanda.h: Try to make waitpid doesn't warn.

2004-01-29  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* Makefile.am (EXTRA_DIST): Add contrib/mkamandisk.

2004-01-29  Christoph Pospiech <pospiech@de.ibm.com>

	* configure.in (AC_CONFIG_FILES): Add changer-src/chg-iomega.pl.
	* changer-src/Makefile.am (libexec_SCRIPTS) Add chg-iomega.
	* changer-src/chg-iomega.pl.in: New changer script.
	* docs/TAPE.CHANGERS: Document chg-iomega.
	* contrib/mkamandisk: Script to format iomega disk.

2004-01-29  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* restore-src/amidxtaped.c (scan_init): Remove the log file if it exit.

2004-01-26  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* configure.in: Set GNUTAR_LISTED_INCREMENTAL_DIRX.
	* example/amanda.conf.in: Update record documentation.
	* man/amanda.8.in: Update record documentation.

2004-01-14  Stefan G. Weichinger <monitor@oops.co.at>

	* docs/INSTALL: Add config for xinetd.

2004-01-07  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/planner.c (handle_result): Detect bad estimate (-1).
	* server-src/planner.c (analyze_estimate): Don't schedule level
	  if the estimate is bad.

2003-12-16  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* docs/HOWTO-FILE-DRIVER: New file.
	* docs/TAPE.CHANGERS: Explain chg-disk.
	* docs/Makefile.am (pkgdata_DATA): add HOWTO-FILE-DRIVER.

2003-12-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* docs/SYSTEM.NOTES: Add a note about sendsize coredump on AIX.

2003-11-28  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Jean-Christian SIMONETTI <simonetti@echo.fr>

	* changer-src/chg-disk.sh.in: New changer script.
	* changer-src/Makefile.am (libexec_SCRIPTS): Add chg-disk.
	* configure.in (AC_CONFIG_FILES): Add changer-src/chg-disk.sh.

2003-11-28  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/tapetype.c: extern int optind.
	* tape-src/tapeio.c: extern int optind.

2003-11-28  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by C.Scheeder <christoph.scheeder@scheeder.de>

	* changer-src/sense.c (SenseType): Add "DAT AutoChanger" and "C1537A".

2003-11-27  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/driver.c: Print the tape size.
	* server-src/amstatus.pl.in: print % of tape use.

2003-11-26  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/conffile.c (copy_dumptype): Copy in/exclude only if seen.

2003-11-26  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/reporter.c (output_tapeinfo): Fix printing of new tape.

2003-11-25  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amcheck.c (taperscan_slot): Deal with label not in
	  tapelist case.
	* server-src/amtape.c (taperscan_slot): Ditto.
	* server-src/taper.c (taperscan_slot): Ditto.

2003-11-24  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/driver.c (handle_taper_result): Always call
	  continue_dumps() in TRYAGAIN case.

2003-11-21  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* changer-src/chg-chio.pl.in (getTapeStatus): Set $drives[$num] to 0
	if no tape in drive.

2003-11-20  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* docs/Makefile.am (pkgdata_DATA): Add HOWTO-AFS.

2003-11-18  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Mitch Collinsworth <mitch@ccmr.cornell.edu>

	* client-src/selfcheck.c: Skip accessibility check for AFS entries.
	* docs/HOWTO-AFS: New file.

2003-11-07  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amadmin.c (tape): Display the next new tapes.
	* server-src/reporter.c (output_tapeinfo): Ditto.

2003-10-31  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* docs/Makefile.am (pkgdata_DATA): Add chg-scsi.notes.

2003-10-31  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amcheck.c (taperscan_slot): Set found=3 if new tape.
	* server-src/amcheck.c (taper_scan): Handle found==3.
	* server-src/amtape.c (taperscan_slot): Set found=3 if new tape.
	* server-src/amtape.c (taper_scan): Handle found==3.
	* server-src/taper.c (taperscan_slot): Set found=3 if new tape.
	* server-src/taper.c (taper_scan): Handle found==3.

2003-10-30  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amcheck.c: Use stralloc(optarg).
	* tape-src/ammt.c: Use stralloc(optarg).
	* tape-src/tapetype.c: Use stralloc(optarg).

2003-10-30  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Jay Fenlason <fenlason@redhat.com>

	* server-src/dumper.c: Don't set SIGCHLD to SIG_IGN.

2003-10-30  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Andrew Rucker Jones <arjones@simultan.dyndns.org>

	* client-src/sendbackup-gnutar.c (AM_SIZE_RE): Fix regex for samba3.

2003-10-27  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amadmin.c (find): Call find_dump to allow dynamic disklist.
	* server-src/amindexd.c: Call find_dump to allow dynamic disklist.
	* server-src/amtrmidx.c:  Call find_dump to allow dynamic disklist.
	* server-src/diskfile.c (add_disk): Set device and todo.
	* server-src/find.c: Build disklist dynamicaly from log files.
	* server-src/find.h (find_dump): New prototype.

2003-10-27  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amlogroll.c: set_pname("amlogroll").

2003-10-24  Todd M. Kover <kovert@omniscient.com>

	* add amqde for "quick and dirty estimates" under gnutar (program
	  that will traverse the filesystem rather than invoke gnutar).
	  controlled via configure option --with-qde.  This really wants to
	  be configured in the server.

2003-10-24  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amverify.sh.in: Fix usage message.
	* common-src/fileheader.c (print_header): fprintf to outf.
	* server-src/tapefile.c (lookup_last_reusable_tape): Check for
	  tp->datestamp > 0.
	* server-src/amadmin.c (disklist_one): Don't print ':' on device line.

2003-10-23  Todd Kover <kovert@omniscient.com>

	* make amrecover link against readline rather than libamanda so
	  only amrecover would require the shared library (if it's found)

2003-10-22  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* client-src/amandates.c (finish_amandates): Call error() if the
	  close of amdf fail.
	* common-src/amflock.c (create_lock): Return -1 if the close of f fail.
	* common-src/amflock.c (read_lock): Don't set f to NULL if the close
	  fail.
	* server-src/tapefile.c (write_tapelist): Return 1 if the close of
	  tapef fail.

2003-10-14  John R. Jackson (jrj@purdue.edu)

	* docs/SYSTEM.NOTES: Add FreeBSD 5.1 note about setting the UDP packet
	  size, compliments of Nicolas Ecarnot <nicolas.ecarnot@accim.com>.

2003-10-14  John R. Jackson (jrj@purdue.edu)

	* client-src/sendsize.c: Handle case where PID's get re-used.

2003-10-14  John R. Jackson (jrj@purdue.edu)

	* configure.in: Need to check for sys/gscdds.h on AIX to enable
	  SCSI changer.

2003-10-07  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/genversion.c (prundefvar): New function to print an
	  undefined variable.
	* common-src/genversion.c: Print undefined variable.
	* server-src/amcheck.c: Improve message for no LPRCMD defined.

2003-07-08  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* restore-src/amidxtaped.c: Don't clea re_label before checking
	  for the changer.

2003-07-07  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Scott Mcdermott <smcdermott@questra.com>

	* changer-src/chg-zd-mtx.sh.in (initial_poll_delay): New config
	  variable to add a pause after a tape loading.

2003-07-07  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Fix by John E. Hein <jhein@timing.com>

	* changer-src/chg-manual.sh.in: Quote @EGREP@.
	* changer-src/chg-null.sh.in: Quote @EGREP@.

2003-07-07  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* amplot/amplot.sh.in: Remove files before runnig amplot.awk.
	* amplot/amplot.awk: Parse 'flush line', fix tape_wait line.
	* server-src/driver.c (read_flush): Write a 'flush size' to the
	  debug file.

2003-07-07  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* changer-src/chg-chio.pl.in: Fix next/prev command.

2003-07-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* client-src/client_util.c (add_include): Count include with 2 /,
	  Fix descriptor leak.

2003-06-25  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amstatus.pl.in: Fix print spacing for idle dumpers.

2003-06-20  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/holding.c: Fix compiler error.
	* server-src/planner.c: Use snprintf.

2003-06-20  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* tape-src/tapetype.c: Avoid a numerical overflow for large tape
	  capacities.

2003-06-20  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amstatus.pl.in: Fix to failed tape.

2003-06-18  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/planner.c (delay_dumps): Delay not delay forced full
	  before forced full.

2003-06-18  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* changer-src/chg-zd-mtx.sh.in: Log the changer file used.

2003-06-11  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amverify.sh.in: Do not advance to next tape.

2003-06-10  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	patch by Eric Siegerman <eric_97@pobox.com>

	* server-src/planner.c: Make promote_hills() honour maxpromotedays.

2003-06-05  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* changer-src/scsi-bsd.c: Use pDev[DeviceFD].fd instead of DeviceFD.
	* changer-src/scsi-hpux_new.c:Use pDev[DeviceFD].fd instead of DeviceFD.
	* changer-src/scsi-linux.c: Use pDev[ip].fd instead of DeviceFD.

2003-06-05  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* client-src/noop.c: #include "util.h".

2003-06-05  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amflush.c: Implement new -b and -s options.
	* man/amflush.8.in: Document it.

2003-06-05  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/driver.c (dump_to_tape): Don't go in degraded mode if
	  taper reply DONE.

2003-06-05  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/output-rait.c: Don't call waitpid if we didn't fork.

2003-06-04  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amverify.sh.in: Use @MAXTAPEBLOCKSIZE@ instead of 32.

2003-06-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Bug reported by Sven Rudolph <rudsve@drewag.de>

	* server-src/holding.c (mkholdingdir): New function to create a holding
	  directory.
	* server-src/holding.h (mkholdingdir): Prototype.
	* server-src/driver.c: Use mkholdingdir;
	* server-src/chunker.c: Call mkholdingdir before opening a file for
	  writing.

2003-06-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* server-src/amstatus.pl.in: Fix for missing amdump.1 or amflush.1.

2003-06-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* server-src/amstatus.pl.in: If nothing is active, it now gives the
	  status of the last run (amdump or amflush).
	* man/amstatus.8.in: Document it.

2003-05-29  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/output-file.c (check_online): Write error if opendir failed.

2003-05-29  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* server-src/amoverview.pl.in: Use 'amadmin <conf> disklist' instead
	  of parsing the disklist file.

2003-05-27  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/tapefile.c (read_tapelist,parse_tapeline): Fix for
	  previous patch.

2003-05-20  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/versuff.c.in: Use @VERSION_SUFFIX@.

2003-05-16  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* example/amanda.conf.in: Add more amrecover_changer doc.
	* man/amanda.8.in: Add more amrecover_changer doc.
	* man/amrecover.8.in: Add more amrecover_changer doc.

2003-05-12  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/tapefile.c (read_tapelist): Ignore blank line.
	* server-src/tapefile.c (parse_tapeline): Newer status parameter, set
	  it to '1' when reading blank line.

2003-04-28  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* configure.in (AC_CHECK_HEADERS): Enleve linux/ftape-header-segment.h,
	  linux/ftape-vendors.h et linux/ftape.h.

2003-04-28  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Darin Dugan <dddugan@iastate.edu>

	* server-src/amcheck.c: Change subject in email if no error.

2003-04-26  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/error.c (output_error_message): Always prepend program
	  name.

2003-04-15  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amstatus.pl.in: Fix for estimate disk.

2003-04-14  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/taper.c: Read holding file correctly if blocksize != 32k.

2003-04-13  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	New file by Robert C Dege <RDege@northropgrumman.com>

	* configure.in: Find mcutil binary.
	* configure.in (AC_CONFIG_FILES): Add changer-src/chg-mcutil.sh and
	  example/chg-mcutil.conf.
	* changer-src/Makefile (libexec_SCRIPTS): Add chg-mcutil.
	* changer-src/chg-mcutil.sh.in: New file.
	* example/Makefile (EXTRA_DIST): Add chg-mcutil.conf
	* example/chg-mcutil.conf.in: New file.

2003-04-08  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* man/amanda.8.in (blocksize): Document the --with-maxtapeblocksize
	  configure option.

2003-04-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amverifyrun.sh.in: Run the amverify command.

2003-04-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* server-src/reporter.c: Get the filenumber correct.

2003-04-01  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* server-src/reporter.c: Print a postscript label for each tape used.

2003-03-18  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* configure.in (*-sco3.2v4*): It is not like *-sco3.2v5*,
	  define DEV_PREFIX and RDEV_PREFIX.

2003-03-17  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* configure.in: Typo.

2003-03-17  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Gert Doering <gert@greenie.muc.de>

	* client-src/getfsent.c (get_fstab_nextentry): Compile on *-sco3.2v4*.

2003-03-17  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* configure.in: Compile on *-sco3.2v4*

2003-03-17  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* configure.in: Use '=' instead of '=='.

2003-03-14  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* recover-src/set_commands.c (set_tape): Recognize null:, rait:,
	  file: and tape: as driver, not host name.

2003-03-14  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amrmtape.sh.in: Print better output.

2003-03-13  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* changer-src/Makefile.am (libexec_SCRIPTS): Missing \.

2003-03-08  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* client-src/client_util.c (add_include): If include contain 2 '/' then
	  use at asis, don't try to match it.

2003-03-07  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/changer.h (changer_label): Return an int.
	* server-src/changer.h (changer_label): First parameter is char *.

2003-03-07  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* file tape-src/output-rait.c (rait_open): Call tapefd_set_master_fd();
	* file tape-src/tapeio.c (struct tape_info): Add master_fd field.
	* file tape-src/tapeio.c (tape_info_init): Set master_fd to -1;
	* file tape-src/tapeio.c (tapefd_getinfo_host, tapefd_getinfo_disk,
	  tapefd_getinfo_level): Return info of master_fd.
	* file tape-src/tapeio.c (tapefd_set_master_fd): New function to set
	  master_fd.
	* file tape-src/tapeio.h (tapefd_set_master_fd): Prototype.

2003-03-06  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/output-file.c (file_tapefd_can_fork): New function that
	  return 1 if the file: can be run under a forked process.
	* tape-src/output-file.h (file_tapefd_can_fork): Prototype.
	* tape-src/output-null.c (null_tapefd_can_fork): New function that
	  return 1 if the null: can be run under a forked process.
	* tape-src/output-null.h (null_tapefd_can_fork): Prototype.
	* tape-src/output-rait.c (rait_close, rait_tapefd_ioctl): Fork only if
	* tapefd_can_fork() return 1.
	* tape-src/output-rait.c (rait_tapefd_can_fork): New function that
	  return 1 if the rait: can be run under a forked process.
	* tape-src/output-rait.h (rait_tapefd_can_fork): Prototype.
	* tape-src/output-tape.c (tape_tapefd_can_fork): New function that
	  return 1 if the tape: can be run under a forked process.
	* tape-src/output-tape.h (tape_tapefd_can_fork): Prototype.
	* tape-src/tapeio.c (struct virtualtape): Add xxx_tapefd_can_fork and
	  initialize vtable[];
	* tape-src/tapeio.c (tapefd_can_fork): New function to can the driver
	  xxx_tapefd_can_fork function.
	* tape-src/tapeio.h (tapefd_can_fork): Prototype.

2003-03-05  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/output-file.c (file_tapefd_write): Call file_release(fd)
	  before opening the file for writing.

2003-03-04  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* changer-src/chg-zd-mtx.sh.in: Default for driveslot is 0.

2003-03-04  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* amplot/amplot.sh.in: New -b option for b/w postscript.
	* amplot/amplot.awk: Add 'color' to command if bw is set.
	* amplot/amplot.g: Change line 6 to line 8.
	* man/amplot.8: Document -b option.

2003-03-04  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* recover-src/extract_list.c: Fix the name of the
	  amidxtaped.<timestamp>.debug file.

2003-02-28  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Eric Doutreleau <Eric.Doutreleau@int-evry.fr>
	
	* restore-src/amidxtaped.c: Use the device sent by the changer.

2003-02-28  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* restore-src/amidxtaped.c: Remove lock 'unlink(conf_logfile)' on
	  all failure path.

2003-02-28  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/changer.c: Sync with 2.4.4.

2003-02-21  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* client-src/client_util.c: Print error except ENOENT for
	  exclude/include files.

2003-02-20  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/tapetype.c: Use %ld to print some variable.

2003-02-20  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/conffile.c (init_defaults): conf_printer.s must be set
	  with stralloc("").

2003-02-12  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* tape-src/tapetype.c: Document -c option.

2003-02-12  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* changer-src/chg-zd-mtx.sh.in:Print "are you sure your drive slot is n"

2003-02-12  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/tapefile.c (read_tapelist): return 1 if can't open the
	  tapelist file.

2003-02-12  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* man/amtapetype.8.in: Add doc from a mail by John R. Jackson.

2003-02-11  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amcheck.c: New -a option.
	* man/amcheck.8.in: Document it.

2003-02-11  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amindexd.c (build_disk_table): Compare the level.

2003-02-10  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* tape-src/tapetype.c: New -c argument to do only the compression test.
	  Better detection of compression.
	* man/amtapetype.8.in: Document -c argument.

2003-02-09  John R. Jackson (jrj@purdue.edu)

	* tape-src/tapetype.c: Allocate the I/O buffers on page boundaries.
	  This helps performance on some OS's.

2003-02-08  John R. Jackson (jrj@purdue.edu)

	* restore-src/amrestore.c: Clean up strtol() argument processing.

2003-02-08  John R. Jackson (jrj@purdue.edu)

	* docs/INSTALL: Clean up supporting package versions and URL's.

2003-02-06  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* docs/Makefile.am (pkgdata_DATA): Add HOWTO-CYGWIN.html.

2003-02-04  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Christophe Kalt <kalt@taranis.org>

	* client-src/sendbackup-dump.c: New AM_SIZE_RE for NetApp.
	* client-src/sendsize.c: New re_size for NetApp.

2003-02-04  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Fix by Colin Henein <cmh@>

	* common-src/amanda.h: Fix for the where S_ISDIR is not defined.

2003-02-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Doug Kingston <dpk@randomnotes.org>

	* configure.in (NEED_SETUID_CLIENT): Set to false on *-pc-cygwin.
	* configure.in (WANT_SETUID_CLIENT): Set if NEED_SETUID_CLIENT != false.
	* client-src/Makefile.am: Don't chmod u+s if WANT_SETUID_CLIENT.

2003-02-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Andrew Rucker Jones <arjones@simultan.dyndns.org>

	* man/amtapetype.8.in: Fix example.

2003-01-31  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/amanda.h: #define S_ISDIR if not already defined.

2003-01-31  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	File from Doug Kingston <dpk@randomnotes.org>

	* docs/HOWTO-CYGWIN.html: New file.

2003-01-30  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* configure.in: Define WANT_RUNTIME_PSEUDO_RELOC on cygwin
	* client-src/Makefile.am: AM_LDFLAGS="-Wl,-enable-runtime-pseudo-reloc"
	  if WANT_RUNTIME_PSEUDO_RELOC.
	* recover-src/Makefile.am: Ditto.

2003-01-28  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/output-rait.h: #define stralloc strdup
	* tape-src/output-rait.c: Revert patch of 2003-01-26, we don't have
	  vstralloc in standalone.

2003-01-27  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Reported by Doug Kingston <dpk@randomnotes.org>

	* recover-src/Makefile.am: Set AM_YFLAGS instead of YFLAGS.

2003-01-26  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/output-rait.c (tapeio_next_devname): Use vstralloc.

2003-01-26  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* changer-src/chg-scsi-chio.c: Change strdup to stralloc.
	* changer-src/chg-scsi.c: Ditto.
	* changer-src/scsi-aix.c: Ditto.
	* changer-src/scsi-bsd.c: Ditto.
	* changer-src/scsi-cam.c: Ditto.
	* changer-src/scsi-changer-driver.c: Ditto.
	* changer-src/scsi-hpux_new.c: Ditto.
	* changer-src/scsi-irix.c: Ditto.
	* changer-src/scsi-linux.c: Ditto.
	* changer-src/scsi-solaris.c: Ditto.
	* changer-src/sense.c: Ditto.
	* tape-src/output-rait.c: Ditto.

2003-01-26  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/taper.c (read_file): Don't count header in filesize.

2003-01-25  John R. Jackson (jrj@purdue.edu)

	* tape-src/tapeio.c: Fix tape_access() and tape_stat() problem caused
	  by indeterminate compiler order of evaluation.

2003-01-25  John R. Jackson (jrj@purdue.edu)

	* restore-src/amidxtaped.c: Log errno when tape_stat fails.
	* restore-src/amrestore.c: Ditto.
	* tape-src/output-rait.c: Ditto.

2003-01-24  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amstatus.pl.in: print an usage by tape.

2003-01-23  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* recover-src/extract_list.c (add_extract_item, delete_extract_item):
	  Check also for level when comparing label.

2003-01-17  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	Do not build chg-scsi-chio, it is buggy.
	* changer-src/Makefile.am (libexec_PROGRAMS): remove $(CHIO_SCSI).
	* changer-src/Makefile.am (EXTRA_PROGRAMS): add $(CHIO_SCSI).

2003-01-16  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* configure.in: disable amrestore if --without-server is set.

2003-01-04  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* client-src/amandad.c: Use the dbfd macro instead of the external
	  variable db_fd.
	* client-src/selfcheck.c: Ditto.
	* client-src/sendbackup.c: Ditto.
	* client-src/sendsize.c: Ditto.
	* client-src/sendbackup-gnutar.c: Use save_errno instead of errno.
	* common-src/debug.c: Move most declaration inside #ifdef DEBUG_CODE.
	* server-src/amindexd.c: dup db_fd() to stderr.
	* server-src/conffile.c: Don't call error() if the config file does not
	  exist, just write to stderr and set got_parserror.

2003-01-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* recover-src/amrecover.c: Fix memory leak.

2003-01-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	Add new maxpromoteday option in a dumptype.
	* example/amanda.conf.in: Give an example
	* man/amanda.8.in: Document it.
	* server-src/amadmin.c: Print it in the disklist subcommand.
	* server-src/conffile.c: read it.
	* server-src/conffile.h (dumptype_t): Add maxpromoteday and
	  s_maxpromoteday.
	* server-src/diskfile.c (read_diskline): Copy maxpromoteday from
	  dumptype_t to disk_t.
	* server-src/diskfile.h (disk_t):  Add maxpromoteday.
	* server-src/planner.c (promote_highest_priority_incr): Don't promote
	  a disk if est(dp)->next_level0 > dp->maxpromoteday.

2003-01-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Reported by Josh More <jmore@remote-print.com>

	* client-src/client_util.c (add_exclude, add_include): Remove the
	  need for MAXPATHLEN.

2003-01-02  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Fix by Josh More <jmore@remote-print.com>

	* tape-src/output-tape.c: Add a ; after f = MT_UNLOAD

2003-01-01  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Undo patch of 2002-11-27. That doesn't work well for the planner.

	* common-src/amanda.h (days_diff): Revert to old macro.
	* server-src/amadmin.c: Undo Fix for newer days_diff.
	* server-src/planner.c: Undo Fix for newer days_diff.

2003-01-01  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* client-src/client_util.c: Fix memory leak reported by valgrind.
	* client-src/selfcheck.c: Ditto.
	* client-src/sendbackup.c: Ditto.
	* client-src/sendsize.c: Ditto.
	* common-src/amfeatures.c: Ditto.
	* common-src/debug.c: Ditto.
	* recover-src/amrecover.c: Ditto.
	* recover-src/extract_list.c: Ditto.
	* recover-src/set_commands.c: Ditto.
	* recover-src/uparse.y: Ditto.
	* recover-src/uscan.l: Ditto.
	* server-src/amindexd.c: Ditto.
	* server-src/amlabel.c: Ditto.
	* server-src/amtape.c: Ditto.
	* server-src/amtrmidx.c: Ditto.
	* server-src/amtrmlog.c: Ditto.
	* server-src/changer.c: Ditto.
	* server-src/conffile.c: Ditto.
	* server-src/driver.c: Ditto.
	* server-src/driverio.c: Ditto.
	* server-src/dumper.c: Ditto.
	* server-src/find.c: Ditto.
	* server-src/holding.c: Ditto.
	* server-src/logfile.c: Ditto.
	* server-src/planner.c: Ditto.
	* server-src/reporter.c: Ditto.
	* server-src/tapefile.c: Ditto.
	* server-src/taper.c: Ditto.

2002-12-30  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* amplot/amplot.awk: Many fix.

2002-12-30  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/planner.c (promote_highest_priority_incremental): Promote
	  a disk > balanced size if no full today. Do not promote a disk it's
	  the only disk due that day and no full today.

2002-12-30  Jean-Louis Martineau <martineau@iro.umontreal.ca>
	Patch by Brad Roberts <braddr@puremagic.com>

	* server-src/amflush.c: Remove 2 redundant amfree call after remove_sl.
	* server-src/holding.c (get_flush): Ditto.

2002-12-27  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/conffile.c: New taperalgo configuration keyword.
	* server-src/conffile.h: Ditto.
	* man/amanda.8.in: Document it.
	* server-src/driver.c (startaflush): New function to start a flush to
	  tape.

2002-12-27  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/diskfile.c (parse_diskline): Allow skip in dumptype.

2002-12-23  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amstatus.pl.in: Parse features from PORT-WRITE line.

2002-12-19  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	Don't use the G flag for samba backup restore by tar.
	* recover-src/extract_list.c (enum dumptypes): Add IS_SAMBA_TAR.
	* recover-src/extract_list.c (extract_files_child): Set dumptype to
	  IS_SAMBA_TAR if it's a SAMBA backup. Don't pass the G flag to tar
	  if it's IS_SAMBA_TAR.

2002-12-18  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* amplot/amplot.awk: Parse line with features, parse ENDFLUSH line.

2002-12-17  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/planner.c (promote_highest_priority_incremental): Newer
	  algorithm that reduce the number of level 0 by hosts on a single day.

2002-12-17  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* amplot/amplot.awk: Parse newer log lines.

2002-12-11  Jean-Louis Martineau <martineau@iro.umontreal.ca> 
	* server-src/reporter.c (output_stats): Typo.

2002-12-09  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/reporter.c: Print an usage by tape.

2002-12-05  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/tapeio.c (do_read): Init count to 0.

2002-12-05  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/Makefile.am: Install tapetype program as amtapetype.
	* docs/TAPETYPES: Change for amtapetype.
	* man/amtapetype.8.in: New man page
	* man/Makefile.am: Install it.
	* configure.in (AC_CONFIG_FILES): Add man/amtapetype.8.

2002-12-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* tape-src/ammt.c (optind): Add prototype.
	* tape-src/amdd.c (optind): Add prototype.

2002-12-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/arglist.h (printf_arglist_function,
	  printf_arglist_function1, printf_arglist_function2): Define if
	  STDC_HEADERS is not defined.

2002-12-03  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amstatus.pl.in: New --date option to display datestamp.
	* server-src/amstatus.pl.in: Increase some field size.
	* server-src/amstatus.pl.in: The host field adjust it's length to the
	 largest.

2002-11-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/amanda.h (days_diff): Don't add a half day.
	* server-src/amadmin.c: Fix for newer days_diff.
	* server-src/planner.c: Fix for newer days_diff.

2002-11-26  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/amandad.c: Fix compiler warning.
	* common-src/Makefile.am (bsdsecurity): Link with file.o.
	* common-src/bsd-security.c: Fix compiler warning.
	* common-src/bsd-security.c (construct_datestamp, construct_timestamp):
	  Add function if TEST.
	* server-src/chunker.c: Fix compiler warning.
	* server-src/dumper.c: Fix compiler warning.

2002-11-26  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* tape-src/tapetype.c: Cast time_t to long for printing.

2002-11-26  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amflush.c: Write a "amflush: start at ???" line.
	* server-src/amstatus.pl.in: parse the "amflush: start at ???" line.

2002-11-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c (delay_dumps): Use snprintf.

2002-11-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/debug.c: Most of the code must in #ifdef DEBUG_CODE.
	* client-src/client_util.c: Use AMANDA_TMPDIR instead of AMANDA_DBGDIR.

2002-11-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/TAPE.CHANGERS: Sync with 2.4.3.

2002-11-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c: Cleanup.

2002-11-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* man/amadmin.8.in: Document new --days option of balance subcommand.

2002-11-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c (days_diff): Make next_level0 more acurate.
	* server-src/amadmin.c (balance): Improve output.

2002-11-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/extract_list.c: Add Retry and Skip command to amrecover.

2002-11-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* tape-src/output-tape.c (tape_tapefd_fsf): Must not be static.

2002-11-19  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/reporter.c: Fix for LPRCMD not defined.

2002-11-14  Marc Mengel <mengel@fnal.gov>

	New changer scripts for use with rait: code, run several other
	changers in tandem and return a rait: tape device.  Makes fake
	amanda.conf files under AMANDA_DEBUGDIR for each changer used,
	then cleans up.

	* changer-src/chg-rait.sh.in:	New file. Multi-changer script.
	* changer-src/chg-null.sh.in:	New File. Null-device changer script.
	* docs/TAPE.CHANGERS:  Descriptions of above.
	* configure.in: added above files.
	* changer-src/Makefile.am: Likewise.

2002-11-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Orion Poplawski <orion@colorado-research.com>

	* server-src/planner.c (delay_dumps): Add the estimate size to all call
	  of delay_one_dump.

2002-11-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/reporter.c: Increase width of some field.

2002-11-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/scsi-solaris.c (SCSI_ExecuteCommand): Init ret to 0.

2002-11-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/extract_list.c (delete_file): j is int.
	* changer-src/scsi-defs.h (B, B1): Check if already defined.
	* server-src/taper.c: Some cast to int.
	* tape-src/amdd.c (read_func, write_func): Complete prototype.
	* tape-src/tapeio.h (tapefd_read, tapefd_write): return ssize_t,
	  third argument is size_t.
	* tape-src/tapeio.c: Ditto.
	* tape-src/output-file.h (file_tapefd_read, file_tapefd_write): return
	  ssize_t, third argument is size_t.
	* tape-src/output-file.c: Ditto.
	* tape-src/output-null.h (null_tapefd_read, null_tapefd_write): return
	  ssize_t, third argument is size_t.
	* tape-src/output-null.c: Ditto.
	* tape-src/output-rait.h (rait_read, rait__write): return ssize_t,
          third argument is size_t.
	* tape-src/output-rait.c: Ditto.
	* tape-src/output-tape.h (tape_tapefd_read, tape_tapefd_write): return
	  ssize_t, third argument is size_t.
	* tape-src/output-tape.c: Ditto.

2002-11-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in: socklen_t default to int.
	* common-src/dgram.c (dgram_recv): addrlen is socklen_t.
	* common-src/stream.c (stream_server): len is socklen_t.
	* recover-src/extract_list.c (add_file): j is int.

2002-11-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client_util.c (test_name_len) Remove variable.
	* common-src/match.c (len_prefix): Change type to int.
	* server-src/taper.c: Use %p to print pointer.
	* tape-src/amdd.c (read_func, write_func):Change return type to ssize_t.
	* tape-src/amdd.c (debug): Renamed to debug_amdd.
	* tape-src/ammt.c (debug): Renamed to debug_ammt.

2002-11-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* restore-src/amidxtaped.c: Fix restore from file.

2002-11-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* restore-src/amidxtaped.c: Fix newline in string literal.

2002-11-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/conffile.c (maxdumpsize): New option.
	* server-src/conffile.h: Ditto.
	* server-src/planner.c: Use maxdumpsize if set.
	* example/amanda.conf.in: Document it.
	* man/amanda.8.in: Document it.

2002-11-06  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/amfeatures.h (fe_amidxtaped_fsf, fe_amidxtaped_label,
	  fe_amidxtaped_device, fe_amidxtaped_host, fe_amidxtaped_disk,
	  fe_amidxtaped_datestamp, fe_amidxtaped_header, fe_amidxtaped_nargs,
	  fe_amidxtaped_config): New features.
	* common-src/amfeatures.c (am_init_feature_set): Set new features.
	* recover-src/extract_list.c: Send new protocol data to amidxtaped.
	* restore-src/Makefile.am: amidxtaped.c need libamserver.
	* restore-src/amidxtaped.c: Read new protocol data from amrecover.
	* restore-src/amidxtaped.c: Use new configuration options.
	* server-src/conffile.c (conf_amrecover_do_fsf,
	  conf_amrecover_check_label, conf_amrecover_changer): New config.
	* server-src/conffile.h: New config options.
	* example/amanda.conf.in: Document them.
	* man/amanda.8.in: Document them.

2002-11-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* autogen: touch config/config.h.in
	* configure.in: Patch from autoupdate-2.53 and LIBOBJS.
	* common-src/Makefile.am: Build versuff.o before version.o
	* recover-src/Makefile.am: Remove work around for automake-1.2

2002-11-04  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in: Remove --disable-libtool.
	* */Makefile.am: Remove WANT_LIBTOOL.

2002-11-04  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/chg-scsi.c (config_name, config_dir): Remove declaration.
	* server-src/amadmin.c: Ditto.
	* server-src/amcheck.c: Ditto.
	* server-src/amcleanupdisk.c: Ditto.
	* server-src/amflush.c: Ditto.
	* server-src/amindexd.c: Ditto.
	* server-src/amlabel.c: Ditto.
	* server-src/amlogroll.c: Ditto.
	* server-src/amtape.c: Ditto.
	* server-src/amtrmidx.c: Ditto.
	* server-src/amtrmlog.c: Ditto.
	* server-src/chunker.c: Ditto.
	* server-src/diskfile.c: Ditto.
	* server-src/driver.c: Ditto.
	* server-src/dumper.c: Ditto.
	* server-src/getconf.c: Ditto.
	* server-src/planner.c: Ditto.
	* server-src/reporter.c: Ditto.
	* server-src/taper.c: Ditto.
	* server-src/conffile.c (config_name, config_dir): Add declaration.

2002-11-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* man/amrestore.8: Amrestore doesn't use a changer.

2002-11-01  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in (SHELL): Don't set it, libtool do it.

2002-10-31  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* config/ltmain.sh, config/libtool.m4i: Update from libtool 1.4.3.

2002-10-30  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* restore-src/amrestore.c: New '-l <label>' flag, Do a rewind and
	  check the label before restoring.
	* man/amrestore.8: Document -l flag.

2002-10-29  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in (AM_HAVE_MT_FLAGS, AM_HAVE_MT_FILENO, AM_HAVE_MT_BLKNO,
	  AM_HAVE_MT_DSREG,AM_HAVE_MT_ERREG): Rename to HAVE_MT_FLAGS,
	  HAVE_MT_FILENO, HAVE_MT_BLKNO, HAVE_MT_DSREG and HAVE_MT_ERREG.
	* tape-src/output-tape.c: Ditto.

2002-10-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Undo patch of 2002-10-24. They are needed by amrecover.

	* client-src/getfsent.h (open_fstab, close_fstab, get_fstab_nextentry,
	  is_local_fstype): Add Prototype.
	* client-src/getfsent.c (open_fstab, close_fstab, get_fstab_nextentry,
	  is_local_fstype): remove Prototype.

2002-10-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Paul Bijnens <paul.bijnens@xplanation.com>

	* tape-src/tapetype.c: Detects and warns the user if the tape drive
	  has hardware compression enabled.

2002-10-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* restore-src/amrestore.c: New '-f <fileno>' flag, Do a rewind and
	  'fsf <fileno>' if -f is set.
	* man/amrestore.8: Document -f flag.
	
2002-10-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/amfeatures.h (fe_amindexd_fileno_in_OLSD, 
	  fe_amindexd_fileno_in_ORLD): New amfeatures.
	* common-src/amfeatures.c (am_init_feature_set): Set
	  fe_amindexd_fileno_in_OLSD and fe_amindexd_fileno_in_ORLD.
	* recover-src/amrecover.h (struct DIR_ITEM): Add fileno.
	* recover-src/display_commands.c (add_dir_list_item): Set fileno
	  in struct DIR_ITEM.
	* recover-src/display_commands.c (suck_dir_list_from_server): Read
	  fileno if fe_amindexd_fileno_in_OLSD is set.
	* recover-src/extract_list.c (struct EXTRACT_LIST): Add fileno.
	* recover-src/extract_list.c (add_file): Read fileno if
	  fe_amindexd_fileno_in_ORLD is set.
	* recover-src/extract_list.c (delete_file): Read fileno if
	  fe_amindexd_fileno_in_ORLD is set.
	* server-src/amindexd.c (opaque_ls): Write fileno if
	  fe_amindexd_fileno_in_OLSD or fe_amindexd_fileno_in_ORLD are set.

2002-10-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	patch by Doug Kingston <dpk@pobox.com>

	* configure.in (NEED_PATH_ENV, IGNORE_UID_CHECK, IGNORE_FSTAB,
	  DONT_SUID_ROOT): Defined if on *-pc-cygwin.
	* client-src/Makefile.am: Fix for cygwin.
	* client-src/getfsent.c: Don't use fstab if IGNORE_FSTAB.
	* client-src/killpgrp.c: Don't suid(0) if DONT_SUID_ROOT.
	* client-src/rundump.c: Don't suid(0) if DONT_SUID_ROOT.
	* client-src/runtar.c: Don't suid(0) if DONT_SUID_ROOT.
	* client-src/selfcheck.c (check_suid): Don't check uid if
	  IGNORE_UID_CHECK.
	* common-src/alloc.c (safe_env): Add PATH to ENV if NEED_PATH_ENV.
	* recover-src/amrecover.c: Don't check uid if IGNORE_UID_CHECK.

2002-10-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/getfsent.h (open_fstab, close_fstab, get_fstab_nextentry,
	  is_local_fstype): Remove Prototype.
	* client-src/getfsent.c (open_fstab, close_fstab, get_fstab_nextentry,
	  is_local_fstype): Add Prototype.

2002-10-22  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amindexd.c: New FEATURES command that read the features
	  set from the client and reply the features set of the server.
	* recover-src/amrecover.h: include "amfeatures.h"
	* recover-src/amrecover.c: Send the FEATURES command to the server
	  and read it's features set.

2002-10-20  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/Makefile.am: Work around for CYGWIN.
	* server-src/Makefile.am: Ditto.

2002-10-20  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in: Remove empty command from $program_transform_name.

2002-10-18  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/extract_list.c (READ_TIMEOUT): Increased to 240*60.

2002-09-30  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

        * client-src/getfsent.c (open_fstab): Check if MNTTAB is defined.

2002-09-19  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amverifyrun.sh.in: New program.
	* man/amverifyrun.8.in: Man page for amverifyrun.
	* configure.in (AC_OUTPUT): add man/amverifyrun.8 and
	  server-src/amverifyrun.sh.
	* man/Makefile.am (SERVER_MAN_PAGES): Add amverifyrun.8.
	* man/amanda.8.in: Add amdd, ammt and amverifyrun in SEE ALSO.
	* man/amverify.8.in: Add amverifyrun(8) in SEE ALSO.
	* server-src/Makefile.am (sbin_SCRIPTS): Add amverifyrun.

2002-09-18  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amverify.sh.in: Accept runtapes as a third argument.
	* man/amverify.8.in: Document it.

2002-09-18  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* config/missing: Updated from automake-1.5.

2002-09-17  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* config/config.guess: Updated from ftp://ftp.gnu.org/gnu/config/
	* config/config.sub: Updated from ftp://ftp.gnu.org/gnu/config/

2002-09-17  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/sendsize.c (getsize_dump): Print the fstype.
	* client-src/sendbackup-dump.c (start_backup): Print the fstype.

2002-09-16  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by  Florian Hars <hars@bik-gmbh.de>

	* changer-src/chg-zd-mtx.sh.in: Fix default value for cleancycle.

2002-09-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/extract_list.c (extract_files): print tape drive
	  and host before asking to load tape.

2002-09-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/taper.c (read_file): Initialize file, 
	  stat(file.cont_filename) before opening it.
          
2002-09-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amverify.sh.in: Don't check that the device is
	  a character device, it could be a file: or rait:

2002-09-06  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* common-src/amfeatures.c (am_set_default_feature_set):
	  fe_rep_options_sendbackup_options is a default feature.

2002-09-06  Jean-Louis Martineau <martineau@iro.umontreal.ca>

	* server-src/amstatus.pl.in: Sort a disk in datestamp order.

2002-09-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Text by Jean-Francois Malouin <Jean-Francois.Malouin@bic.mni.mcgill.ca>

	* docs/EXCLUDE: Improve documentation.

2002-09-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/reporter.c: Fix compilation error if LPRCMD is not defined.

2002-08-26  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Jason Brooks <jason0@mail.wrs.com>

	* docs/chg-scsi.notes: New document.
	* changer-src/chg-scsi.c: Adding printout of "emubarcode" values 
	  in the debug file.
	* changer-src/scsi-changer-driver.c: Added dlt8000 and L500 to 
	  ChangerIO[].
	* changer-src/sense.c: Added dlt8000 and L500 to SenseType[].

2002-08-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* tape-src/output-null.c (null_tape_stat, null_tape_access): Use
	  "/dev/null" instead of filename.

2002-08-22  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/chg-mtx.sh.in: Sync with 2.4.3 branch.
	* changer-src/chg-scsi-chio.c: Ditto.
	* changer-src/chg-scsi.c: Ditto.
	* changer-src/scsi-aix.c: Ditto.
	* changer-src/scsi-bsd.c: Ditto.
	* changer-src/scsi-cam.c: Ditto.
	* changer-src/scsi-changer-driver.c: Ditto.
	* changer-src/scsi-defs.h: Ditto.
	* changer-src/scsi-hpux_new.c: Ditto.
	* changer-src/scsi-irix.c: Ditto.
	* changer-src/scsi-linux.c: Ditto.
	* changer-src/scsi-solaris.c: Ditto.
	* tape-src/tapeio.c: Ditto.

2002-08-21  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/uparse.y: Fix compiler warning.

2002-08-21  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amtrmidx.c: Continue if a directory doesn't exist.

2002-08-21  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* man/amanda.8.in (tapecycle): Improve documentation.

2002-08-21  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: Works with features.

2002-08-21  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/amfeatures.c (am_feature_to_string): Return the string
	  "UNKNOWNFEATURE" if no features.
	* common-src/amfeatures.c (am_string_to_feature): Return NULL if the
	  string is "UNKNOWNFEATURE".

2002-08-20  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/file.c (debug_agets): line_free was badly set when
	the buffer size in increased.

2002-07-19  John R. Jackson (jrj@purdue.edu)

	* common-src/amanda.h: Fix bad #define.

2002-07-02  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by
	  David Munro <D.Munro@surrey.ac.uk>

	* common-src/sl.c (new_sl): Alloc (sl_t) instead of (sl_t *).
          
2002-06-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Bug reported by 
	  Jonathan R. Johnson <Jonathan.Johnson@MinnetonkaSoftware.com>

	* server-src/reporter.c: Fix psfname filename.

2002-05-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/sendbackup.c: Don't do compression if it is server side.
	* client-src/sendbackup-dump.c: Ditto.
	* client-src/sendbackup-gnutar.c: Ditto.

2002-05-02  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Manuel Bouyer <bouyer@antioche.lip6.fr>

	* server-src/taper.c (detach_buffers): Fix compilation with mmap.

2002-04-29  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/extract_list.c (extract_files): Set dump_device_name
	  after the call of okay_to_continue.

2002-04-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	New features to describe the OPTIONS line of a REP packet.
	* common-src/amfeatures.h: Add fetures fe_rep_options_maxdumps,
	  fe_rep_options_hostname, fe_rep_options_features and
	  fe_rep_options_sendbackup_options.
	* common-src/amfeatures.c (am_init_feature_set): Add
	  fe_rep_options_features.
	* client-src/selfcheck.c: Write REP packet according to server features.        * client-src/sendbackup.c: Ditto.
	* client-src/sendsize.c: Ditto.

2002-04-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/amfeatures.h:
	     Rename fe_g_options_maxdump  to fe_req_options_maxdumps
	     Rename fe_g_options_hostname to fe_req_options_hostname
	     Rename fe_g_options_features to fe_req_options_features
	* common-src/amfeatures.c: Ditto
	* server-src/amcheck.c: Ditto
	* server-src/dumper.c: Ditto
	* server-src/planner.c: Ditto

2002-04-22  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcheck.c: Check if it can send features, hostname or
	  maxdumps on the global options line. Don't send hostname and
	  maxdumps for a noop service.
	* server-src/dumper.c: Ditto.
	* server-src/planner.c: Ditto.

2002-04-22  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/sendbackup.c: (optionstr): Add srvcomp-best and
	  srvcomp-fast options.

2002-04-22  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcheck.c (start_host): Check the todo bit before 
	  sending noop REQ.

2002-04-21  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client_util.c (parse_options, parse_g_options): Check
	  for duplication options.
	* client-src/client_util.h (COMPR_SERVER_FAST, COMPR_SERVER_BEST):
	  Declare.
	* client-src/selfcheck.c: Check for COMPR_FAST or COMPR_BEST.

2002-04-21  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/selfcheck.c (host):Remove variable,use g_options->hostname.
	* client-src/sendbackup.c: Ditto.
	* client-src/sendsize.c: Ditto.

2002-04-19  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client_util.c (parse_g_options) New function to parse
	  the global options string.
	* client-src/client_util.h (parse_g_options): Prototype.
	* client-src/selfcheck.c: use parse_g_options.
	* client-src/sendbackup.c: use parse_g_options.
	* client-src/sendsize.c: use parse_g_options.

2002-04-19  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

        * server-src/diskfile.c: Improve message for missing features.

2002-04-19  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	Add many features.
	* common-src/amfeatures.c (am_set_default_feature_set): New function 
	  to set the default features set.
	* common-src/amfeatures.h (am_set_default_feature_set): Prototype.
	* common-src/amfeatures.h: Rename amanda_feature_auth_keyword to 
	  fe_options_auth.
	* client-src/client_util.c: Check features.
	* server-src/amcheck.c: Ditto.
	* server-src/diskfile.c: Ditto.
	* server-src/driverio.c: Ditto.
	* server-src/planner.c: Ditto.
	* server-src/diskfile.h (optionstr): Change prototype.
	* client-src/sendsize.c: Fix compiler warning.

2002-04-18  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/amfeatures.c: Include "amfeatures.h"
	* common-src/rsh-security.c: Don't assert on undefined variable.

2002-04-17  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/amfeatures.c: Renamed from features.c
	* common-src/amfeatures.h: Renamed from features.h
	* common-src/Makefile.am: Rename features to amfeatures.
	* client-src/amandad.c: Ditto.
	* client-src/client_util.h: Ditto.
	* client-src/selfcheck.c: Ditto.
	* client-src/sendbackup.c: Ditto.
	* client-src/sendsize.c: Ditto.
	* server-src/amcheck.c: Ditto.
	* server-src/chunker.h: Ditto.
	* server-src/diskfile.h: Ditto.
	* server-src/dumper.c: Ditto.
	* server-src/planner.c: Ditto.
	* server-src/taper.c: Ditto.

2002-04-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/conffile.c: Default dumporder set to "ttt".
	* server-src/driver.c: If dumporder is too short, use t and T.
	* man/amanda.8.in: Default dumporder set to "ttt".

2002-04-13  John R. Jackson (jrj@purdue.edu)

	* common-src/features.c: Add amanda_feature_auth_keyword feature so
	  authorization in the OPTIONS string is backward compatible.
	* common-src/features.h: Ditto.
	* client-src/client_util.c: Ditto.
	* client-src/client_util.h: Ditto.
	* client-src/selfcheck.c: Ditto.
	* client-src/sendbackup.c: Ditto.
	* client-src/sendsize.c: Ditto.
	* server-src/diskfile.c: Ditto.
	* server-src/planner.c: Fix compiler warning.

2002-04-13  John R. Jackson (jrj@purdue.edu)

	* server-src/diskfile.c: Fix memory leak.

2002-04-13  John R. Jackson (jrj@purdue.edu)

	* server-src/amcheck.c: Fix error parsing in packet.

2002-04-13  John R. Jackson (jrj@purdue.edu)

	* common-src/features.c: New file.  Add support for feature sets so
	  different Amanda versions can work together.
	* common-src/features.h: Ditto.
	* common-src/Makefile.am: Ditto.  Add "features" test program.
	* client-src/amandad.c: Add "noop" service to return the feature set.
	* client-src/selfcheck.c: Accept and return a feature set in OPTIONS.
	  Improve parsing.
	* client-src/sendbackup.c: Ditto.
	* client-src/sendsize.c: Ditto.
	* common-src/bsd-security.c: Minor message change.
	* common-src/error.c: Use strcasecmp.
	* common-src/protocol.c: Use dbprintf for PROTO_DEBUG and improve
	  messages.
	* restore-src/amidxtaped.c: Improve parsing.
	* server-src/amcheck.c: Ask for client features via "noop" before
	  doing the real "selfcheck" service requests.  Improve parsing.
	* server-src/amflush.c: Minor coding format cleanup.
	* restore-src/amindexd.c: Improve parsing.
	* server-src/chunker.c: Deal with features string in commands.  Improve
	  parsing.
	* server-src/diskfile.c: Initialize the features hosttype field.
	* server-src/diskfile.h: Add the features hosttype field.
	* server-src/driver.c: Save the features from the schedule.  Clean
	  up some error messages.
	* server-src/driverio.c: Add features string to several commands.
	* server-src/dumper.c: Deal with features string in commands.  Improve
	  parsing.
	* server-src/planner.c: Ask for client features via "noop" before
	  doing the real "sendsize" service requests.  Improve parsing.
	* server-src/server_util.c: Minor coding cleanup.
	* server-src/server_util.h: Increase the number of args allowed on
	  commands.
	* server-src/taper.c: Deal with features string in commands.  Improve
	  parsing.

2002-04-12  John R. Jackson (jrj@purdue.edu)

	* server-src/driver.c: Fix crash when only processing a tape queue
	  (e.g. amflush).

2002-04-11  John R. Jackson (jrj@purdue.edu)

	* server-src/driver.c: Protect against crash when taper has died.

2002-04-11  John R. Jackson (jrj@purdue.edu)

	* common-src/stream.c: Clean up an error message.

2002-04-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/DUMPER-API: Remove the section about USER and GROUP.

2002-04-09  John R. Jackson (jrj@purdue.edu)

	* server-src/driver.c: Fix send of QUIT to taper when it is down.

2002-04-07  John R. Jackson (jrj@purdue.edu)

	* server-src/dumper.c: Change sendbackup response parsing to handle
	  2.4 changes.  Improve packet parse error processing.  Make packet
	  logging conditional on an #ifdef instead of commented out.

2002-04-07  John R. Jackson (jrj@purdue.edu)

	* client-src/amandad.c: Fix FORCE_USERID to run the service as the
	  client user if amandad was started as root.

2002-04-07  John R. Jackson (jrj@purdue.edu)

	* common-src/clock.c: Move definition of amanda_gettimeofday() macro
	  to the header file so it could be used other places.  Use new
	  amanda_timezone macro to avoid some #ifdef's.
	* common-src/clock.h: Ditto.
	* common-src/bsd-security.c: Fix compatibility problems with pre-2.5
	  servers trying to talk to 2.5 clients.  The HANDLE value was not
	  being properly handled, and the sequence number was being ignored.

2002-04-07  John R. Jackson (jrj@purdue.edu)

	* server-src/reporter.c: Move column routines to conffile.c so amcheck
	  can use them in its tests.  Do not abort on several failures, but
	  generate messages in the FAILURE AND STRANGE DUMP SUMMARY section.
	* server-src/conffile.c: Move column routines to here.
	* server-src/conffile.h: Ditto.
	* server-src/amcheck.c: Add several config file tests.
	* server-src/logfile.c: Change "reporter" to "amreport".

2002-04-07  John R. Jackson (jrj@purdue.edu)

	* configure.in: Add /usr/local/sbin to LOCPATH.

2002-03-31  John R. Jackson (jrj@purdue.edu)

	* server-src/amcheck.c: Send maxdumps and hostname in packet OPTIONS.

2002-03-31  John R. Jackson (jrj@purdue.edu)

	* changer-src/scsi-defs.h: Fix compiler warning and bug it was hiding.
	* changer-src/scsi-solaris.c: Ditto.

2002-03-31  John R. Jackson (jrj@purdue.edu)

	* client-src/amandad.c: Fix arguments to pkt_cat.
	* common-src/bsd-security.c: Ditto.

2002-03-31  John R. Jackson (jrj@purdue.edu)

	* client-src/amandad.c: Add relative timestamps to a lot of debug
	  file messages, and add more messages, to better track what is
	  going on.  Various general cleanup.
	* client-src/calcsize.c: Ditto.
	* client-src/client_util.c: Ditto.
	* client-src/selfcheck.c: Ditto.
	* client-src/sendbackup-dump.c: Ditto.
	* client-src/sendbackup-gnutar.c: Ditto.
	* client-src/sendbackup.c: Ditto.
	* client-src/sendbackup.h: Ditto.
	* client-src/sendsize.c: Ditto.
	* common-src/amanda.h: Ditto.
	* common-src/bsd-security.c: Ditto.
	* common-src/clock.c: Ditto.
	* common-src/clock.h: Ditto.
	* common-src/debug.c: Ditto.
	* common-src/dgram.c: Ditto.
	* common-src/error.c: Ditto.
	* common-src/file.c: Ditto.
	* common-src/pipespawn.c: Ditto.
	* common-src/stream.c: Ditto.
	* common-src/util.c: Ditto.
	* man/amanda.8.in: Ditto.
	* restore-src/amidxtaped.c: Ditto.
	* restore-src/amrestore.c: Ditto.
	* server-src/amindexd.c: Ditto.
	* server-src/getconf.c: Ditto.
	* server-src/planner.c: Ditto.

2002-03-31  John R. Jackson (jrj@purdue.edu)

	* client-src/sendsize.c: Pay attention to the spindle number.

2002-03-30  John R. Jackson (jrj@purdue.edu)

	* server-src/planner.c: General delay_dumps code cleanup.

2002-03-30  John R. Jackson (jrj@purdue.edu)

	* server-src/planner.c: Make sure individual dumps larger than a tape
	  are not added back into the schedule.  Found by Uncle George
	  <gatgul@voicenet.com>.

2002-03-29  John R. Jackson (jrj@purdue.edu)

	* man/amanda.8.in: Move "comment" in tapetype after inclusion of
	  previous definition.  Found by Uncle George <gatgul@voicenet.com>.

2002-03-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client_util.c (fixup_relative): New function to prepend
	  the dirname if relative.
	* client-src/client_util.c (build_exclude, build_include): Use
	  fixup_relative.
	* client-src/client_util.c (parse_options): Do not prepend the dirname.
	* client-src/selfcheck.c (check_options): Don't generate ERROR for samba
	  if optional is set.

2002-03-24  John R. Jackson (jrj@purdue.edu)

	* common-src/debug.c: Change dbopen() message slightly to match what
	  amdump generates, making it easier to parse.

2002-03-24  John R. Jackson (jrj@purdue.edu)

	* common-src/Makefile.am: Move clock routines to common-src so
	  everyone may use them.
	* server-src/Makefile.am: Ditto.

2002-03-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/sendbackup-gnutar.c: Fix use of no_record.

2002-03-24  John R. Jackson (jrj@purdue.edu)

	* client-src/amandad.c: Make sure argv[0] is valid before using it.
	* restore-src/amidxtaped.c: Ditto.
	* server-src/amindexd.c: Ditto.

2002-03-24  John R. Jackson (jrj@purdue.edu)

	* client-src/client_util.c: Use the Amanda memory allocation code.
	* client-src/sendbackup-gnutar.c: Ditto.
	* client-src/sendsize.c: Ditto.
	* common-src/match.c: Ditto.
	* recover-src/amrecover.c: Ditto.
	* recover-src/display_commands.c: Ditto.
	* recover-src/extract_list.c: Ditto.
	* restore-src/amidxtaped.c: Ditto.
	* server-src/amflush.c: Ditto.
	* server-src/disk_history.c: Ditto.
	* server-src/driver.c: Ditto.
	* server-src/dumper.c: Ditto.
	* common-src/amanda.h: Always pass the source file and line number
	  to the memory routines to make it easier to debug.
	* common-src/alloc.c: Ditto.
	* common-src/file.c: Ditto.

2002-03-23  John R. Jackson (jrj@purdue.edu)

	* changer-src/chg-scsi-chio.c: Use agets instead of fgets.
	* changer-src/chg-scsi.c: Use agets instead of fgets.
	* client-src/client_util.c: Use agets instead of fgets.
	* recover-src/amrecover.c: Clean up output on EOF.
	* recover-src/extract_list.c: Use agets instead of direct stdio.
	  Clean up output on EOF.  Add '?' help.
	* recover-src/set_commands.c: Quote the new device in the verify
	  output to make it stand out.
	* server-src/amflush.c: Clean up output on EOF.  Clean up output
	  when multiple holding disk areas selected.  Clean up parsing.
	  Loop until valid user response.
	* server-src/find.c: Do not complain if log file is missing for
	  a new (datestamp == 0) tape.
	* server-src/holding.c: Use agets instead of fgets. Clean up
	  interactive input and output.

2002-03-23  John R. Jackson (jrj@purdue.edu)

	* client-src/selfcheck.c: Fix a compiler warning.
	* client-src/sendbackup.c: Ditto.
	* client-src/sendsize.c: Ditto.

2002-03-23  John R. Jackson (jrj@purdue.edu)

	* client-src/getfsent.c (close_fstab()): Call endfsent() instead
	  of fclose(), if available.

2002-03-23  John R. Jackson (jrj@purdue.edu)

	* common-src/dbprintf (debug_printf): Make sure errno is preserved
	  across dbprint() calls.

2002-03-23  John R. Jackson (jrj@purdue.edu)

	* configure.in: Add -R$dir as well as -L$dir on Solaris when processing
	  --with-libraries to support shared libraries of support products.

2002-03-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/chunker.c: Get result from dumper.
	* server-src/driver.c: Send dumper result to chunker.
	* server-src/driverio.c (chunker_cmd): Send DONE and FAILED command.
	* server-src/driverio.h (chunker_t): New down field.
	* server-src/dumper.c: Cleanup.
	* server-src/logfile.c (logtype_str): Add "PARTIAL".
	* server-src/logfile.h (logtype_e): Add L_PARTIAL log.
	* server-src/reporter.c: Handle PARTIAL log.
	* server-src/server_util.c (cmdstr): Add "PARTIAL".
	* server-src/server_util.h (cmd_t): Add PARTIAL command.
	* server-src/taper.c (read_file): Result is PARTIAL if dumper
	  result is not DONE.

2002-03-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/tapefile.c (write_tapelist): Write to a temp file and
	  rename it.
	* server-src/amlabel.c: Do not rename the tapelist file.
	* server-src/taper.c (label_tape): Do not rename the tapelist file.

2002-03-22  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client_util.c (parse_options): Do not check if the
	  exclude file exist, it's done later.

2002-03-22  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client_util.c (parse_options): Parse exclude-optional and
	  include-optional.
	* client-src/client_util.h (option_t): New exclude_optional and
	  include_optional field.
	* man/amanda.8.in: Document optional.
	* server-src/amadmin.c (disklist_one): Display optional.
	* server-src/conffile.c: Parse optional keyword.
	* server-src/conffile.h (dumptype_t): New exclude_optional and
	  include_optional field.
	* server-src/diskfile.c (read_diskline): Copy optional bits.
	* server-src/diskfile.c (optionstr): Print optional bits.
	* server-src/diskfile.h (disk_t): New exclude_optional and
	  include_optional field.
	* server-src/planner.c (getsize): Use new sendsize format if optional
	  bits are used.

2002-03-21  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (dump_to_tape): Call start_degraded_mode() if
	  taper failed.

2002-03-21  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/extract_list.c (extract_files_setup): Add ^$ to host.

2002-03-20  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch from Michael Frankowski <mfrankow@winternet.com>

	* client-src/sendbackup-gnutar.c: Test for subdir before dbprintf.

2002-03-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client_util.c (init_options): New function.
	* client-src/client_util.h (init_options): Prototype.
	* client-src/sendsize.c (main): Use init_options.

2002-03-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client-util.c: Check for include and exclude files.

2002-03-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: Fix.
	* server-src/conffile.c(get-compress): Change message for bad 
	  compress argument.

2002-03-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: Fix.
	* client-src/client_util.c (parse_options): Parse auth= option.
	* client-src/client_util.h (option_t): Add auth field.
	* client-src/sendbackup.c: Use auth instead of bsd-auth.
	* client-src/sendsize.c: Init auth.

2002-03-09  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/sendbackup-dump.c: use amdevice as argument to
	  amname_to_fstype.
	* client-src/sendsize.c: Use amdevice as argument to amname_to_dirname.
	* server-src/dumper.c: clear device if it is set to NODEVICE.

2002-03-08  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amindexd.c: Compilation fix.

2002-03-07 John R. Jackson (jrj@purdue.edu)

	* changer-src/chg-zd-mtx.sh.in: Allow whitespace on a VolumeTag line.
	  Compliments of Christopher McCrory <chrismcc@pricegrabber.com>.

2002-03-06  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/amrecover.h (list_disk): Prototype.
	* recover-src/set_commands.c (list_disk): New function.
	* recover-src/uparse.y: parse LISTDISK.
	* recover-src/uscan.l: listdisk keyword.
	* recover-src/help.c: help for listdisk.
	* man/amrecover.8.in: Doc for listdisk.
	* server-src/amindexd.c: New LISTDISK command.
	* docs/INDEXING: Document LISTDISK command.

2002-03-06  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: Better output for autoflush.

2002-03-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: Fix.

2002-03-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c (disklist_one): Print dp->device.
	* server-src/amcheck.c (start_host): Send device if specified.
	* server-src/amstatus.pl.in: Parse line with device.
	* server-src/diskfile.c (parse_diskline): Parse device.
	* server-src/diskfile.c (match_disklist): Match on device.
	* server-src/diskfile.h (disk_t): New field device.
	* server-src/driverio.c: (dumper_cmd): Send device.
	* server-src/dumper.c (main): Parse device in request.
	* server-src/dumper.c (start_dump): New device argument, send
	  device to client.
	* server-src/planner.c (getsize): Send device to client.
	* server-src/server_util.h (MAX_ARGS): Set it to 12.
	* client-src/client_util.c (add_include, build_exclude, build_include,
	  parse_options): New device argument.
	* client-src/client_util.h (build_exclude,build_include,parse_options):
	  New prototype.
	* client-src/selfcheck.c: Use device.
	* client-src/sendbackup-dump.c: Use device.
	* client-src/sendbackup-gnutar.c: Use device.
	* client-src/sendbackup.c: Use device.
	* client-src/sendbackup.h (start_backup): New device argument.
	* client-src/sendsize.c: Use device.
	* man/amanda.8.in: Document new disklist syntax.
	* example/disklist: Give example.

2002-03-02  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

        * server-src/amstatus.pl.in: Write "wait to flush" only if waittaper
	  is requested.

2002-03-02  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: Fix for failed tape.

2002-02-18  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* man/amanda.8.in: Document multiple exclude.
	* man/amanda.8.in: Document include.

2002-02-16  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client-util.c (add_include): Include are glob expression.

2002-02-16  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/debug.c (debug_open); Don't try to renmae an already 
	  renamed file.

2002-02-15  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/conffile.c (dump_configuration): Print multiple 
	  exclude and include.

2002-02-15  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client_util.c (add_exclude, add_include): Typo.

2002-02-15  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client_util.c (build_include, build_exclude): Fix for 
	  bad eof detection.

2002-02-15  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client_util.c (get_name): Create a file name.
	* client-src/client_util.c (build_name): Remove old files,
	  build an unused file name.
	* client-src/client_util.c (add_exclude): Add an exclude pattern to
	  the exclude file.
	* client-src/client_util.c (add_include): Add an include to the
	  include file.
	* client-src/client_util.c (build_exclude): Concat all excludes in 
	  one file.
	* client-src/client_util.c (build_include): Concat all includes in 
	  one file.
	* client-src/client_util.h (build_exclude, build_include): Prototype.
	* client-src/selfcheck.c.diff (check_options): Call build_exclude 
	  and build_include.
	* client-src/sendsize.c.diff: Call gtar with one 
	  exclude file/include file.
	* client-src/sendbackup-gnutar.c.diff: Call gtar with one 
	  exclude file/include file.

2002-02-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/amanda.h (amfree): Change e local variable to e__errno.
	* common-src/amanda.h (strappend): Change t local variable to t_t_t.

2002-02-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/sendsize.c: Set include_file and include_list to NULL
	  when using old protocol.
	* client-src/sendbackup-gnutar.c: Include "." when using old protocol.

2002-02-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/conffile.h (dumptype_t): Add include_file and include_list.
	* server-src/conffile.c: Read include.
	* server-src/diskfile.h (disk_t): Add include_file and include_list.
	* server-src/diskfile.c (optionstr): Add include to the optionstr.
	* server-src/amadmin.c (disklist_one): Print include.
	* server-src/planner.c: Use new protocol if include is used.
	* client-src/client_util.h (option_t): Add include_file and include_list
	* client-src/client_util.c (parse_options): Parse include.
	* client-src/selfcheck.c (check_options): Print ERROR if include are 
	  used for SAMBA or DUMP.
	* client-src/sendsize.c: Send include to gnutar.
	* client-src/sendbackup-gnutar.c: Send include to gnutar.

2002-02-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/client_util.c (parse_options): Check that files from
	  'exclude list' exist'.
	* client-src/selfcheck.c (check_options): Give ERROR if multiple
	  exclude are used with samba or if exclude are used with DUMP.

2002-02-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/sendbackup.h: Remove bad stuff introduced in previous
	  patch.
	* client-src/sendbackup-gnutar.c: Ditto.

2002-02-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client_src/client_util.c (parse_options): Function to parse 
	  the option string. 
	* client_src/client_util.h (parse_options): Prototype.
	* client_src/client_util.h (option_t): Struct for options.
	* client_src/Makefile.am: Compile client_util.
	* client_src/selfcheck.c: Use new option_t and multiple exclude.
	* client_src/sendbackup.h: Use new option_t and multiple exclude.
	* client_src/sendbackup.c: Use new option_t and multiple exclude.
	* client_src/sendbackup-dump.c: Use new option_t and multiple exclude.
	* client_src/sendbackup-gnutar.c: Use new option_t and multiple exclude.
	* client_src/sendsize.c: Use new option_t and multiple exclude.
	* server-src/conffile.h: Use sl_t for exclude_file and exclude_list.
	* server-src/conffile.c: Multiple exclude.
	* server-src/diskfile.h: Use sl_t for exclude_file and exclude_list.
	* server-src/diskfile.c: Multiple exclude.
	* server-src/planner.c: Multiple exclude.

2002-02-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/pipespawn.c (pipespawnv): Typo, ap_snprintf -> snprintf.

2002-02-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/pipespawn.c (pipespawnv): New funtion taking an 
	  argv argument.
	* common-src/pipespawn.h (pipespawnv): Prototype.

2002-02-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/holding.h: Use sl_t instead of holding_t
	* server-src/holding.c: Ditto.
	* server-src/amcleanupdisk.c: Ditto.
	* server-src/amflush.c: Ditto.
	* server-src/find.c: Ditto.
	* server-src/planner.c: Ditto.

2002-02-11 John R. Jackson (jrj@purdue.edu)

	* configure.in: AIX needs the "other" getconf argument to find out
	  about large file support (XBS5_ILP32_OFFBIG instead of LFS).

2002-02-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/sl.h: New header file
	* common-src/sl.c: New file for list of string struct.
	* common-src/Makefile.am: Compile sl.c

2002-02-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/chg-zd-mtx.sh.in: Don't use '^' in expr match argument.

2002-02-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/fileheader.c (build_header): Typo.

2002-02-10 John R. Jackson (jrj@purdue.edu)

	* configure.in: Add new file-pad tapetype option to take the place
	  of a positive/negative blocksize.  Blocksize may now only be
	  positive.  File-pad defaults to "true" which pads the last tape
	  record like it always has.
	* man/amanda.8.in: Ditto.
	* server-src/amlabel.c: Ditto.
	* server-src/conffile.c: Ditto.  Fix typo in conffile test program.
	* server-src/conffile.h: Ditto.
	* server-src/planner.c: Ditto.
	* server-src/taper.c: Ditto.

2002-02-10 John R. Jackson (jrj@purdue.edu)

	* configure.in: Save the ./configure args and display them in the
	  version string (e.g. amandad*debug and "amadmin xx version").
	* common-src/genversion.c: Ditto.

2002-02-10 John R. Jackson (jrj@purdue.edu)

	* common-src/alloc.c: Fix type mismatch issues discovered by splint
	  (www.splint.org).  Compliments of jens persson <jens@persson.cx>.
	* common-src/bsd-security.c: Ditto.
	* common-src/debug.c: Ditto.
	* common-src/dgram.c: Ditto.
	* common-src/file.c: Ditto.
	* common-src/fileheader.c: Ditto.
	* common-src/fileheader.h: Ditto.
	* common-src/genversion.c: Ditto.
	* common-src/getcwd.c: Ditto.
	* common-src/match.c: Ditto.
	* common-src/stream.c: Ditto.
	* common-src/strstr.c: Ditto.
	* common-src/token.c: Ditto.
	* recover-src/amrecover.c: Ditto.
	* recover-src/display_commands.c: Ditto.
	* recover-src/extract_list.c: Ditto.
	* recover-src/set_commands.c: Ditto.
	* server-src/reporter.c: Ditto.

2002-02-10 John R. Jackson (jrj@purdue.edu)

	* changer-src/chg-zd-mtx.sh.in: Major cleanup and general overhaul.
	* docs/TAPE.CHANGERS: Cleanup.

2002-02-09 John R. Jackson (jrj@purdue.edu)

	* common-src/arglist.h: Clean up gcc detection of printf style variable
	  argument list functions.
	* changer-src/scsi-changer-driver.c: Ditto.
	* common-src/debug.c: Ditto.
	* common-src/dgram.c: Ditto.
	* common-src/error.c: Ditto.
	* common-src/packet.c: Ditto.
	* common-src/packet.h: Ditto.
	* common-src/security.c: Ditto.
	* common-src/snprintf.c: Ditto.
	* common-src/token.c: Ditto.
	* common-src/token.h: Ditto.
	* server-src/amindexd.c: Ditto.
	* server-src/conffile.c: Ditto.
	* server-src/diskfile.c: Ditto.
	* server-src/logfile.c: Ditto.
	* server-src/logfile.h: Ditto.
	* server-src/server_util.c: Ditto.

2002-02-09 John R. Jackson (jrj@purdue.edu)

	* configure.in: Must look in both strings.h and string.h when trying
	  to find function declarations (strncasecmp was not found on AIX
	  but is really there and our override caused a mismatch error).

2002-02-09 John R. Jackson (jrj@purdue.edu)

	* configure.in: Add code to test for a type defined in other than the
	  autoconf expected locations.  Use it to look for socklen_t.

2002-02-08 John R. Jackson (jrj@purdue.edu)

	* server-src/amadmin.c (check_dumpuser): Make it fatal to attempt to
	  do an operation that would alter any files when run as someone other
	  than the dump user from amanda.conf.  This should prevent files from
	  ending up with incorrect ownership.

2002-02-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* man/amrecover.8.in (settape): Document that the hostname is required
	  if the protocol (tape:, file:, rait:, null:) is specified.
	* man/amrecover.8.in (settape): Document that it is posible to
	  change the tape device when asked to load tape.

2002-02-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/holding.c (scan_holdingdir): Create the list in 
	  datestamp order.

2002-02-02 John R. Jackson (jrj@purdue.edu)

	* configure.in: Add unistd.h to list of places to look for ruserok()
	  declaration.  Reported by John Koenig <jfkoenig@vipb.com> on ALPHA
	  running OSF1 v5.1

2002-02-01  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
        Reported by Roland E. Lipovits <rel@lipo.at0.net>

	* server-src/amstatus.pl.in: Don't double-counts the failed 
	  estimate partitions.

2002-01-31  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in: New --with-maxtapeblocksize with a default of 32.
	* common-src/amanda.h: MAX_TAPE_BLOCK_KB is defined in amanda.h

2002-01-31  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/fileheader.c (build_header): Never write the
	  BLOCKSIZE= line.
	* common-src/fileheader.c (parse_file_header): Do not parse the
	  BLOCKSIZE= line.

2002-01-31  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/fileheader.c (build_header): Write the BLOCKSIZE= line
	  after the dd if=... line.

2002-01-31  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c: Init code to 0.

2002-01-29 John R. Jackson (jrj@purdue.edu)

	* tape-src/output-tape.c (tape_tapefd_fsf): Some systems cannot deal
	  with large stack variables, so allocate tape I/O buffers dynamically.
	* tape-src/tapeio.c (tapefd_rdlabel): Ditto.

2002-01-25 John R. Jackson (jrj@purdue.edu)

	* server-src/driver.c: Log non-zero exit codes and signals from all
	  the dumpers and taper.

2002-01-25 John R. Jackson (jrj@purdue.edu)

	* server-src/amindexd.c: Clean up reporting of errors by gethostby*()
	  functions.  Make sure they always report what they were trying to
	  look up, and don't bother reporting errno (it would be h_errno).

2002-01-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/fileheader.h (dumpfile_t): Add blocksize field.
	* common-src/fileheader.h (build_header): Change prototype.
	* common-src/fileheader.c (fh_init): blocksize default to 
	  DISK_BLOCK_BYTES.
	* common-src/fileheader.c (parse_file_header): Parse BLOCKSIZE= line.
	* common-src/fileheader.c (build_header): Remove blocksize parameter, 
	  write the BLOCKSIZE= line.
	* tape-src/tapeio.c: set file.blocksize, Change call to build_header.
	* restore-src/amrestore.c: Ditto.
	* server-src/dumper.c: Ditto.
	* server-src/taper.c: Ditto.
	* server-src/holding.c: Ditto.
	* server-src/chunker.c: Ditto.

2002-01-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/scsi-changer-driver.c (SCSI_ReadElementStatus):
	  set ret to -1.

2002-01-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c: Check for dp->todo.

2002-01-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Harlan Stenn <Harlan.Stenn@pfcs.com>

	* changer-src/chg-scsi.c: Typo.

2002-01-06  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/Makefile.am: Run `perl -c' on perl script.
	* client-src/Makefile.am: Ditto.
	* dumper-src/Makefile.am: Ditto.
	* server-src/Makefile.am: Ditto.

2002-01-06  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Reported by Geert Uytterhoeven <geert@linux-m68k.org>

	* README: Amanda compile on Linux/m68k.

2002-01-06  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/chg-rth.pl.in: Typo. fi -> }.

2002-01-06  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Harlan Stenn <Harlan.Stenn@pfcs.com>

	* changer-src/chg-chio.pl.in: Typo. fi -> }.
	* changer-src/chg-chio.pl.in (prefix, exec_prefix): Set correctly.
	* changer-src/chg-chio.pl.in (max_picker): Init to -1.

2002-01-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/extract_list.c (okay_to_continue_tape): Ignore \n
	  at end of string.

2002-01-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amoverview.pl.in: Ignore some line from amadmin.

2002-01-04  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/event.c: Use ASSERTIONS not ASSERT.

2002-01-01  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* tape-src/output-tape.c (tape_tapefd_rewind, tape_tapefd_unload):
	  Init rc to -1.
	* changer-src/scsi-irix.c (SCSI_OpenDevice): Cast to int.
	* common-src/match.c (clean_regex): Cast to int.

2002-01-01  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Reported by <ian.willis@sge.net>

	* common-src/rsh-security.c: Fix for RSH_DEBUG.

2001-12-31  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* config/ltconfig: Remove
	* config/ltmain.sh, config/libtool.m4i: Update from libtool 1.4.2.
	* config/config.guess: Update from
	  ftp://ftp.gnu.org/gnu/config/config.guess
	* config/config.sub: Update from 
	  ftp://ftp.gnu.org/gnu/config/config.sub
	* config/depcomp, config/install-sh, config/missing, 
	  config/mkinstalldirs: Update from automake 1.5
	* config/Makefile.am (EXTRA_DIST): Remove ltconfig.

2001-12-31  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Harlan Stenn <Harlan.Stenn@pfcs.com>

	* configure.in: Add missing [.

2001-12-30  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Jason Thomas <jason@topic.com.au>
	     and Eric Siegerman <erics@telepres.com>

	* common-src/bsd-security.c (check_user_amandahosts): improve message.

2001-12-30  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c: Do not go in degraded mode in nodump mode.
	* server-src/conffile.c:Check many options to be sure they are positive.

2001-12-30  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/chg-scsi.c (get_relative_target): return -1;
	* changer-src/scsi-irix.c (SCSI_ExecuteCommand): Remove Zero variable.
	* common-src/amanda.h: include strings.h if HAVE_STRINGS_H is defined.
	* server-src/amadmin.c (info_one): Remove lev0date variable.
	* server-src/amadmin.c (import_db): Remove vers_comment variable.
	* server-src/amindexd.c (main): Remove arg_len variable.
	* server-src/amtrmidx.c (main): Remove level_position and
	  datestamp_position variables.
	* server-src/changer.c (changer_current): Remove checked variable.
	* server-src/conffile.c (read_confline): Check value of RESERVE.
	* server-src/conffile.c (get_tapetype): Check value of LENGTH and
	  FILEMARK.
	* server-src/diskfile.h: bit field of 1 bit must be unsigned.
	* server-src/driver.c (main): Don't check the value of RESERVE.
	* server-src/driver.c (find_diskspace): Remove as_pref variable.
	* server-src/driverio.c (getresult): cast cmd_t.
	* server-src/chunker.c (databuf_flush): save_type is a filetype_t.
	* server-src/find.c (search_logfile): Remove host_undo_ch and
	  disk_undo_ch variables.
	* server-src/holding.c (pick_datestamp): Remove result variable.
	* server-src/server_util.c (getcmd): Loop on a cmd_t variable.
	* server-src/taper.c (tape_writer_side): Remove out_open variable.
	* tape-src/tapeio.c (tapefd_close): Cast to (void *).

2001-12-29  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/selfcheck.c: Fix compiler warning.
	* changer-src/chg-scsi.c: Ditto.
	* changer-src/scsi-changer-driver.c: Ditto.
	* changer-src/scsi-defs.h: Ditto.
	* server-src/server_util.c: Ditto.
	* common-src/fileheader.c: Ditto.

2001-12-29  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in: Set MAX_TAPE_BLOCK_KB on linux

2001-12-29  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Blaz Zupan <blaz@amis.net>

	* changer-src/chg-zd-mtx.sh.in: typo.

2001-12-18  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/selfcheck.c (check_access): New function (old check_file
	  function).
	* client-src/selfcheck.c (check_file): Check that the filename is a
	  file.
	* client-src/selfcheck.c (check_dir): Check that dirname is a directory.

2001-12-18  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Henning Schmiedehausen <henning@forge.intermeta.de>

	* common-src/file.c (safe_cd): Create the AMANDA_DBGDIR and
	  AMANDA_TMPDIR directory.

2001-12-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amverify.sh.in: Check that @AMANDA_TMPDIR@ exist.
	* server-src/amrmtape.sh.in: Ditto.

2001-12-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/Makefile.am: fix setting of libexec_PROGRAMS.

2001-12-09  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: Work with amflush log.

2001-12-09  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (nodump): new argument, Don't start the dumpers
	  if set.
	* server-src/holding.c (get_flush): chdir to original cwd.
	* server-src/reporter.c: accept driver and amflush line in log.
	* server-src/amflush.c: exec driver to do the flushing.

2001-12-09  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: Fixup for estimate, write flush line.

2001-12-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/extract_list.c: You can change the tape device
	  between each tape.

2001-12-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* restore-src/amrestore.c (restore): try to find the next chunk 
	  in the current directory.

2001-12-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* example/amanda.conf.in: typo.

2001-12-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	Patch by Roland E. Lipovits <rel@lipo.at0.net>
	* example/amanda.conf.in: typo.

2001-12-04  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/dumper.c, server-src/taper.c, server-src/chunker.c:
	Replace TRY_AGAIN by TRYAGAIN.

2001-11-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Michael D. Beynon <beynon@ll.mit.edu>

	* server-src/driver.c (main): Take care of empty tapeq.

2001-11-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/diskfile.c (lookup_host): Match must be exact.

2001-11-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c: Add host, disk, datestamp and level on 
	FLUSH line. Add datestamp on DUMP line.
	* server-src/driver.c (read_flush): Read new format of FLUSH line.
	* server-src/driver.c (read_schedule): Read new format of DUMP line.
	* server-src/amflush.c: Write a datestamp on stderr.
	* server-src/amdump.sh.in: Write a datestamp on stderr.
	* server-src/amstatus.pl.in: Works with autoflush.

2001-11-08  Jean-Louis Martineau <martineau@IRO.UMontreal.CA> 
	* server-src/conffile.c (autoflush): New configuration options.
	* server-src/conffile.h (autoflush): New configuration options.
	* man/amanda.8.in: Document it.
	* example/amanda.conf.in: Document it.
	* server-src/holding.h (get_flush, pick_datestamp, pick_all_datestamp,
	cleanup_holdingdisk): New prototype.
	* server-src/holding.c (scan_holdingdir, cleanup_holdingdisk,
	get_flush): New function.
	* server-src/holding.c (pick_datestamp, pick_all_datestamp): New
	verbose argument.
	* server-src/amcleanupdisk.c: Change call to pick_all_datestamp.
	* server-src/amflush.c: Change call to pick_all_datestamp.
	* server-src/find.c: Change call to pick_all_datestamp.
	* server-src/planner.c: Write FLUSH line to driver, the schedule
	line contain the keyword DUMP.
	* server-src/planner.c: Add datestamp to SUCCESS and FAIL line.
	* server-src/amstatus.pl.in: New parsing of DUMP line.
	* server-src/driverio.h: New datestamp field in sched_t;
	* server-src/driver.c (build_diskspace): New function to build a
	assignedhd_t from an holding file.
	* server-src/driver.c (read_flush): New function to read the list
	of files to flush.
	* server-src/driver.c (read_schedule): Parse the keyword DUMP.
	* server-src/driver.c: Add datestamp to FAIL line.
	* server-src/dumper.c: Add datestamp to FAIL line.
	* server-src/reporter.c (timedata_t, repdata_t) : Major change of
	structure.
	* server-src/taper.c: Add datestamp to FAIL line.

2001-11-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/conffile.c: New dumporder configuration.
	* server-src/conffile.h: Likewise.
	* server-src/driver.c (start_some_dumps): Use dumporder to
	select the next disk to dump.
	* example/amanda.conf.in: Give an example of dumporder.
	* man/amanda.8.in: Document it.

2001-11-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/amrecover.h (cd_glob, cd_regex, cd_dir): New prototypes.
	* recover-src/set_commands.c (cd_glob, cd_regex, cd_dir): New functions.
	* recover-src/uparse.y: Add new token CDX, call cd_glob instead 
	of set_directory for cd command, call cd_regex for cdx command.
	* recover-src/uscan.l: On cdx string return CDX token.
	* recover-src/help.c: Document it.
	* man/amrecover.8.in: Document it.

2001-09-26 John R. Jackson (jrj@purdue.edu)

	* server-src/reporter.c: Fix problem when column sizes are negative.

2001-09-21 John R. Jackson (jrj@purdue.edu)

	* server-src/Makefile.am: Add -I../common-src so genversion.h can be
	  found (since it is built on the fly).  Only fails when build is done
	  in a different directory than the sources.

2001-09-17 John R. Jackson (jrj@purdue.edu)

	* server-src/getconf.c: Add capabilities to amgetconf to return
	  build environment values and also to open and close a debug file
	  (e.g. for scripts).
	* man/amgetconf.8.in: Ditto.
	* changer-src/chg-scsi.c: Ditto.
	* common-src/amanda.h: Ditto.
	* common-src/debug.c: Ditto.
	* common-src/error.c: Ditto.
	* server-src/dumper.c: Ditto.

2001-09-17 John R. Jackson (jrj@purdue.edu)

	* server-src/planner.c: Make sure we do not attempt to bump beyond
	  level 9.

2001-09-16 Thomas Hepper (th@ant.han.de)
	* changer-src/chg-scsi.c: Added new config option autoinv, 
	if not set no auto inventory will be done if the label db is out of 
	sync. Reworked MapBarCode, now the parameters are passed as a struct 
	and the result is returned in this struct (MBC_T), 
	also removed some duplicate/nonsens code from MapBarCode
	Changed the definitions for slot_file. It was used duplicate, 
	1. as the config file set by amanda.conf, and second set by the
	config option in the chg-scsi config file. Now the file from
	amanda.conf is called chg_scsi_conf. and changer_file is renamed 
	to slot_file.
	Added check if cleanfile is not set, if true clean_file is set to NULL
	Now return if tape_device is not in the range 0-9.
	Added some checks if we have all informations like slot_file, 
	devices etc. Fixed and error in the search function, 
	if the searched vol is already loaded return the correct info 
	and not 'label not found'. Fixed error in the parameter passing 
	to get_relative_slot. If the option was -slot last we where 
	1 above the end parameter..

	* changer-src/scsi-bsd.c: Fix compile problems.
	* changer-src/scsi-changer-driver.c: Fixed the last problems :-) 
	for the label/barcode handling...
	* changer-src/scsi-defs.h: Added new struct MBC_T
	* changer-src/sense.c: Added some more messages for Exabyte 210 lib

2001-09-01 John R. Jackson (jrj@purdue.edu)

	* client-src/sendsize.c: Fix memory allocation problem.

2001-08-31 John R. Jackson (jrj@purdue.edu)

	* server-src/amindex.c: Fix memory leak.  Compliments of Robert Minsk
	  <egbert@centropolisfx.com>.
	* server-src/logfile.c: Fix memory leak.  Compliments of Robert Minsk
	  <egbert@centropolisfx.com>.

2001-08-30 John R. Jackson (jrj@purdue.edu)

	* server-src/planner.c: Fix problem with maintenance of total level
	  0 size when disk being brought back into the schedule was not doing
	  a level 0.  Compliments of Robert Minsk <egbert@centropolisfx.com>.

2001-08-24 John R. Jackson (jrj@purdue.edu)

	* server-src/amverify.sh.in: Fix missing backtick error.

2001-08-24 John R. Jackson (jrj@purdue.edu)

	* server-src/taper.c: Allocate buffers on page boundaries.

2001-08-22 John R. Jackson (jrj@purdue.edu)

	* tape-src/Makefile.am: Add chown/chgrp rules for ammt/amdd install
	  so they end up like all the other Amanda programs.

2001-08-15 Thomas Hepper (th@ant.han.de)
	* changer-src/chg-scsi.c. Removed version 1 DB support from mapBarCode. Changed the way parameter
	are given to MapBarCode and returned from there. No a struct is passed where all infos
	will be returned to the calling function.
	If eject is set we will not call LogSense in chg-scsi because it is also called in the
	eject function.
	* changer-src/scsi-defs.h: Added struct MBC_T used by MapBarCode.
	* changer-src/scsi-changer-driver.c: Changed all calls to MapBarCode to the new way

2001-08-14 John R. Jackson (jrj@purdue.edu)

	* docs/EXCLUDE: New document from Andrew Hall <ahall@secureworks.net>
	  describing how to set up and use GNU tar exclusions.
	* docs/Makefile.am: Added EXCLUDE and PORT.USAGE.

2001-08-14 John R. Jackson (jrj@purdue.edu)

	* docs/PORT.USAGE: New document about how Amanda ports are used.

2001-08-14 John R. Jackson (jrj@purdue.edu)

	* client-src/sendsize.c: Fix patch merge goof (ap_snprintf -> snprintf).

2001-08-14 John R. Jackson (jrj@purdue.edu)

	* common-src/stream.c: Add stream_client_privileged() function to
	  get a privileged port and fail if one is not available.  The older
	  stream_client() function gets a (non-privileged) port in the
	  configured portrange, if set and possible, else anything available.
	* common-src/stream.h: Prototypes.
	* recover-src/amrecover.c: Use stream_client_privileged() instead of
	  stream_client().
	* recover-src/extract_list.c: Ditto.
	* configure.in: Added several more port range sanity checks.  Added
	  --with-tcpportrange as an alias for --with-portrange.

2001-08-09 Thomas Hepper (th@ant.han.de)
	* changer-src/chg-scsi.c: Added check in MapBarCode if the labelfile
	parameter is empty, and if yes return. 
	Added global variable do_inventory, and if set do an inventory before
	exit.
	In MapBarCode changed the way the UPDATE_SLOT is done, now it uses
	the slot number passed to MapBarCode to find and update the record.
	* changer-src/scsi-changer-driver.c: Added def. for BreeceHill Q7
	Added global variables which are set by the tape_rdlabel function
	in eject/unload.
	Reworked the way how the updates of the labelfile are done.

2001-08-01 John R. Jackson (jrj@purdue.edu)

	* client-src/selfcheck.c: Fix typos I introduced into the PC subdir
	  patch.
	* client-src/sendbackup-gnutar.c: Ditto.
	* client-src/sendsize.c: Ditto.

2001-08-01 Marko Injac <marko.injac@mail.insert.si> via John R. Jackson (jrj@purdue.edu)

	* client-src/findpass.c: Allow backup of subdirs of PC shares for
	  amanda-2.4.1beta1 by Greg Shebert amanda-hackers list Tue Feb 1,
	  2000.  Ported to amanda-2.4.2p2 on debian potato by Marko Injac.
	* client-src/findpass.h: Ditto.
	* client-src/selfcheck.c: Ditto.
	* client-src/sendbackup-gnutar.c: Ditto.
	* client-src/sendsize.c: Ditto.
	* docs/SAMBA: Ditto.

2001-08-01 John R. Jackson (jrj@purdue.edu)

	* client-src/sendsize.c: Prefix each debug line with sendsize process
	  information to make picking out the output from a particular estimate
	  run easier when maxdumps > 1.

2001-08-01 John R. Jackson (jrj@purdue.edu)

	* server-src/amcheck.c: Unlink the temp files as soon as they are
	  created so they always go away when amcheck terminates.  Use
	  pipespawn() instead of system() to call the MAILER program.  Call
	  dbopen()/dbclose() in main() to write to a debug file instead of
	  stderr.

2001-08-01 John R. Jackson (jrj@purdue.edu)

	* common-src/debug.c: Only rename files that end in ".debug".

2001-08-01 John R. Jackson (jrj@purdue.edu)

	* common-src/pipespawn.c: Show empty pipespawn() args as "".

2001-07-31 John R. Jackson (jrj@purdue.edu)

	* server-src/conffile.h: Add support for tapetype "blocksize" keyword.
	* server-src/conffile.c: Add tapetype "blocksize" keyword.  Use
	  DISK_BLOCK_KB where appropriate instead of TAPE_BLOCK_SIZE.  Disallow
	  negative tape length and tapemark size.
	* common-src/alloc.c: Add new amtable_free() function.  Adjust args
	  to amtable_alloc() to be consistent with amtable_free().
	* common-src/amanda.h: Add new am_round() and am_floor() macros.
	  Define new DISK_BLOCK_KB, DISK_BLOCK_BYTES, MAX_TAPE_BLOCK_KB,
	  MAX_TAPE_BLOCK_BYTES constants.  Remove TAPE_BLOCK_SIZE and
	  TAPE_BLOCK_BYTES.
	* common-src/bsd-security.c: TAPE_BLOCK_BYTES -> NETWORK_BLOCK_BYTES.
	  Use -1 instead of DEFAULT_SIZE.
	* common-src/rsh-security.c: Ditto.
	* common-src/fileheader.c: Change write_header() to build_header().
	  Add blocksize arg.  Get rid of unused fill_buffer() function.
	* common-src/fileheader.h: Ditto.
	* common-src/stream.c: Use negative value to indicate default buffer
	  size.
	* common-src/stream.h: Add NETWORK_BLOCK_BYTES and STREAM_BUFSIZE
	  constants.  Remove DATABUF_SIZE and DEFAULT_SIZE.
	* man/amanda.8.in: Document the new "blocksize" tapetype keyword.
	  Document that "length" in tapetype has meaning to some output
	  drivers.  Fix "bumpdays" and "speed" defaults.  Document new "file:"
	  output driver record length data file.
	* man/amrestore.8: Add new "-b blocksize" arg.  Add description of
	  how to catalogue the images on a tape.
	* recover-src/amrecover.c: DEFAULT_SIZE -> -1.
	* recover-src/extract_list.c: DEFAULT_SIZE -> -1.  Use DISK_BLOCK_BYTES
	  instead of TAPE_BLOCK_BYTES for the header size.
	* restore-src/amrestore.c: Add new "-b blocksize" arg.  Document how
	  the header is handled.  Deal with arbritrary tape record sizes.
	* server-src/amlabel.c: Use the tapetype blocksize.
	* server-src/chunker.c: Use DISK_BLOCK_BYTES and DISK_BLOCK_KB as
	  appropropriate instead of older constants.  Rewrite disk I/O buffer
	  management.  Never pad output stream (e.g. to holding disk).  Use
	  -1 for default stream buffer size.
	* server-src/driver.c: Use DISK_BLOCK_KB where appropriate instead of
	  TAPE_BLOCK_SIZE.
	* server-src/driverio.c: Set chunker argv[0] to name based on which
	  dumper it is working with.
	* server-src/dumper.c: Use DISK_BLOCK_BYTES and DISK_BLOCK_KB as
	  appropropriate instead of older constants.  Rewrite disk I/O buffer
	  management.  Never pad output stream (e.g. to holding disk).  Use
	  -1 for default stream buffer size.
	* server-src/holding.c: Change TAPE_BLOCK_BYTES to DISK_BLOCK_BYTES.
	  Use fullread() instead of fill_buffer().
	* server-src/planner.c: Use tapetype blocksize instead of constant
	  for tape length calculations.
	* server-src/taper.c: Support tapetype blocksize.  Only pad writes if
	  blocksize is negative.  Reorganize shared memory buffers to put
	  data on page boundaries.  Try reducing tapebuf count if allocation
	  fails.
	* tape-src/output-file.c: Maintain record size information.  Use mask
	  and flags from caller.
	* tape-src/output-null.c: Use new amtable_alloc() arg order.
	* tape-src/output-rait.c: Use new amtable_alloc() arg order.  Add
	  private version of amtable_free() for standalone build.  Fix off
	  by one and other table allocation problems.
	* tape-src/output-rait.h: Maintain file descriptor count in the
	  structure.
	* tape-src/tapeio.c: Support tapetype blocksize.  Use new
	  amtable_alloc() arg order.  Fix some error message text.  
	* tape-src/tapeio.h: New prototypes with blocksize arg.
	* tape-src/tapetype.c: Add "-b blocksize" arg.  Fix some end case
	  aborts.

2001-07-30 Ben Lewis (bhlewis@purdue.edu) via John R. Jackson (jrj@purdue.edu)

	* recover-src/amrecover.c: Improve the "Unexpected server end of file"
	  message.

2001-07-30 Ben Lewis (bhlewis@purdue.edu) via John R. Jackson (jrj@purdue.edu)

	* man/amanda.8.in: Document includefile.
	* man/amdump.8.in: Add note that local crontab documention should be
	  checked for proper syntax.
	* man/amrecover.8.in: Document use of PAGER environment variable.
	* man/amrestore.8: Document that GNU tar must be used as some vendor
	  tar programs cannot read GNU tar format.
	* docs/FAQ: Update location of online FAQ.

2001-07-25 John R. Jackson <jrj@purdue.edu>

	* docs/TAPE.CHANGER: Changes from Ben Lewis (bhlewis@purdue.edu) to
	  document the new (but optional) searchable features.

2001-07-19 John R. Jackson <jrj@purdue.edu>

	* common-src/error.c: Fix function prototype error.

2001-07-19 John R. Jackson <jrj@purdue.edu>

	* common-src/error.c: Add new function errordump() that acts like
	  error() but calls abort() to (try to) drop core.
	* common-src/amanda.h: Prototype.
	* common-src/alloc.c: Call errordump() instead of error() for some
	  memory allocation failures to aid traceback.

2001-07-19 John R. Jackson <jrj@purdue.edu>

	* server-src/amadmin.c: Improve the error message when read_conffile()
	  fails.
	* server-src/amcheck.c: Ditto.
	* server-src/amcleanupdisk.c: Ditto.
	* server-src/amflush.c: Ditto.
	* server-src/amlabel.c: Ditto.
	* server-src/amlogroll.c: Ditto.
	* server-src/amtape.c: Ditto.
	* server-src/amtrmidx.c: Ditto.
	* server-src/amtrmlog.c: Ditto.
	* server-src/driver.c: Ditto.
	* server-src/dumper.c: Ditto.
	* server-src/getconf.c: Ditto.
	* server-src/planner.c: Ditto.
	* server-src/reporter.c: Ditto.
	* server-src/taper.c: Ditto.

2001-07-19 John R. Jackson <jrj@purdue.edu>

	* server-src/driverio.c: Make the name "ps" reports match the dumper
	  name (e.g. "dumper3").

2001-07-18 John R. Jackson <jrj@purdue.edu>

	* changer-src/chg-chio.pl.in: Try to unload the drive before moving
	  a tape back to a slot.  Fixes a problem on Ecrix AutoPAK devices.
	  Patch compliments of Sam Leffler <sam@errno.com>.

2001-07-18 John R. Jackson <jrj@purdue.edu>

	* server-src/amverify.sh.in: Change to the Amanda temp directory
	  instead of the config directory.  In addition to making amverify
	  act like most other Amanda programs, this gets around an
	  xfsrestore bug.

2001-07-18 John R. Jackson <jrj@purdue.edu>

	* man/amanda.8.in: Describe the .amandahosts format better.  Clean up
	  a couple of minor typos.

2001-07-13 John R. Jackson <jrj@purdue.edu>

	* common-src/dgram.h: Improve UDP datagram size calculation.
	* server-src/amcheck.c: Break up large requests into pieces.
	* server-src/planner.c: Break up large requests into pieces.

2001-07-12 John R. Jackson <jrj@purdue.edu>

	* tape-src/amdd.c: Use tapefd_close() in amdd if the file was
	  opened with tape_open().  This does any necessary output driver
	  cleanup (such as moving the current file position for "file:").

2001-07-12 John R. Jackson <jrj@purdue.edu>

	* Makefile.am: Fix automake warning.

2001-07-11 John R. Jackson <jrj@purdue.edu>

	* tape-src/tapetype.c: Use tapefd_write() instead of write().

2001-07-11 John R. Jackson <jrj@purdue.edu>

	* common-src/file.c: Fix a memory leak.  Grab exponentially larger
	  chunks of memory up to a point, then level out.

2001-07-11 John R. Jackson <jrj@purdue.edu>

	* tape-src/tapetype.c: Only report a pass summary when stderr is not
	  a tty.  Deal with some obscure end cases.

2001-07-10 John R. Jackson <jrj@purdue.edu>

	* changer-src/scsi-aix.c: Convert Tape_Eject to Tape_Ioctl.
	* changer-src/scsi-solaris.c: Ditto.

2001-07-10 John R. Jackson <jrj@purdue.edu>

	* server-src/amcheck.c: Move user name check before attempt to create
	  temp files so more appropriate error message is generated.

2001-07-09 John R. Jackson <jrj@purdue.edu>

	* common-src/dgram.c: Fix error end case unitialized variable.

2001-07-05 John R. Jackson <jrj@purdue.edu>

	* docs/TAPE.CHANGERS: Minor docs/TAPE.CHANGERS update to clarify
	  that -slot and -eject unload and put the current tape away.

2001-07-02 John R. Jackson <jrj@purdue.edu>

	* changer-src/chg-manual.sh.in: Add yet another ONLINEREGEX, this one
	  compliments of Nick (n_hibma@qubesoft.com) for some FreeBSD variant.

2001-06-29 John R. Jackson <jrj@purdue.edu>

	* tape-src/tapeio.c: Move the device name parsing routines from the
	  RAIT module to tapeio and make them generic.  This allows one
	  module to open another, e.g. rait:{null:,z1,z2,z3}.  Maintain
	  both the original open flags and mask and use them on the real open.
	* tape-src/amdd.c: Make sure this compiles "stand-alone".  To do so,
	  use: gcc -Wall -DNO_AMANDA amdd.c output-rait.c output-tape.c.
	  Abort as soon as one of the open calls fails instead of waiting
	  for read/write to report a bad file descriptor.
	  Pass a mask to the open function in case the output is created.
	* tape-src/ammt.c: Make sure this compiles "stand-alone".  To do so,
	  use: gcc -Wall -DNO_AMANDA ammt.c output-rait.c output-tape.c.
	* tape-src/output-file.c: Maintain both the original open flags and
	  mask and use them on the real open.
	* tape-src/output-null.c: Ditto.
	* tape-src/output-file.h: Change to non-prototype declaration of
	  file_tape_open() to deal with the optional mask parameter.
	* tape-src/output-null.h: Ditto.
	* tape-src/output-tape.h: Ditto.
	* tape-src/tapeio.h: Ditto.  Add device name parsing prototypes.
	* tape-src/output-rait.c: Make sure this compiles "stand-alone".
	  Maintain both the original open flags and mask and use them on the
	  real open.
	* tape-src/output-rait.h: Make sure this compiles "stand-alone".
	* tape-src/output-tape.c: Make this part of the "stand-alone" compile
	  of ammt and amdd since it knows all the proper ioctl operations.
	  Maintain both the original open flags and mask and use them on the
	  real open.

2001-06-27 John R. Jackson <jrj@purdue.edu>

	* changer-src/chg-manual.sh.in: Add "bs=32k" to the dd command so
	  some kernels would not complain about the tape block being larger
	  than the buffer.
	* changer-src/chg-mtx.sh.in: Ditto.

2001-06-21 John R. Jackson <jrj@purdue.edu>

	* server-src/planner.c: If the compression rate is very small (such
	  as zero after some types of errors) and FORCE_FULL is set, a path
	  is taken that (among other bad things) generates a schedule that
	  driver cannot read (syntax errors).
	* server-src/conffile.c: Do not allow negative comprate values.

2001-06-19 John R. Jackson <jrj@purdue.edu>

	* server-src/holding.c: Use fullread() instead of read() to read the
	  holding disk file.

2001-06-19 John R. Jackson <jrj@purdue.edu>

	* server-src/amtape.c: Document "slot advance" in the help output.

2001-06-19 John R. Jackson <jrj@purdue.edu>

	* server-src/amindexd.c: Minor gethostbyaddr() argument change to be
	  consistent with other Amanda usage.

2001-06-19 John R. Jackson <jrj@purdue.edu>

	* server-src/amverify.sh.in: Better cross platform tar detection.

2001-06-19 John R. Jackson <jrj@purdue.edu>

	* server-src/amverify.sh.in: More of the vrestore vs. 'b' flag change.

2001-06-19 John R. Jackson <jrj@purdue.edu>

	* recover-src/amrecover.c: Add more debugging to guess_disk()
	  function to better track how the disk is determined from the
	  current working directory.  Report current working directory in
	  error message.  Change "Trying" to "Trying disk" to distinguish
	  this from host attempts.
	* recover-src/set_commands.c: Remove redundant amfree() call.  Remove
	  redundant "OISD /" exchange.  Change "Trying" to "Trying host" to
	  distinguish this from disk attempts.

2001-06-19 Thomas Hepper <th@ant.han.de>
	* changer-src/chg-scsi.c: Made clean_slot a global var. Removed
	the label db update stuff from the COM_SLOT part (moved to unload
	in scsi-changer-driver.c)
	* changer-src/scsi-changer-driver.c: Do an unload if the tape is
	loaded in the Inventory function. Added an marker to avoid recursion
	in Inventroy function. Added label db check in unload function and
	call Inventroy if it indicates an out of sync db
	
2001-06-18 John R. Jackson <jrj@purdue.edu>

	* recover-src/extract_list.c: Do not pass a 'b' (blocking) factor
	  flag to vrestore.  Some versions do not like it.

2001-06-18 John R. Jackson <jrj@purdue.edu>

	* common-src/dgram.c: Use a sin_addr arg to inet_ntoa() like all the
	  other Amanda code.
	* common-src/stream.c: Ditto.

2001-06-18 John R. Jackson <jrj@purdue.edu>

	* changer-src/chg-manual.sh.in: Add yet another online regex.  Found
	  by George Herson <gherson@snet.net>.

2001-06-12 Thomas Hepper <th@ant.han.de>
	* changer-src/scsi-changer-driver.c (Inventory): Call Tape_Ready and let this function
	decide how to get the tape drive status.
	* changer-src/scsi-changer-driver.c (Tape_Ready): Now this function looks how to get
	the tape drive status.
	* changer-src/scsi-linux.c: changed some dbprintf to DebugPrint
	
2001-06-10 Thomas Hepper <th@ant.han.de>
	* changer-src/chg-scsi.c: If get_current_slot gets an error from the fscanf function
	return also an error (-1) to the calling fucntion. (Fixes an error if the slot file
	is created with an touch)
	* changer-src/scsi-changer-driver.c: Fixed some NULL pointer errors in PrintConf
	Fixed an error in the unload function if the destination slot for the unload is not empty.
	(cut and paste error !!)
	
2001-06-07 Thomas Hepper <th@ant.han.de>
	* changer-src/scsi-changer-driver.c: Change the type of TapeStatus from void to int.
	In PrintConf changed the loop variable for scan of pDev from 3 to CHG_MAXDEV.
	In PrintConf check if pDev[count].inquiry is a NULL pointer, and if yes skip.
	* changer-src/scsi-irix.c: Changed a lot, now it should work.
	* client-src/sendbackup-dump.c: Removed a { in the vxfsdump part. 
	* tape-src/output-tape.c: Fixed the tape status checks, the structure elelemt
	is called buf.mt_dposn not buf.mt.dposn.
	
2001-06-04 Thomas Hepper <th@ant.han.de>
	* changer-src/scsi-changer-driver.c: Renamed Tape_Eject to Tape_Ioctl
	incl. change of passwd parameter.

2001-06-04 Thomas Hepper <th@ant.han.de>
	* changer-src/chg-scsi.c: include dmalloc.h for debugging of mem problems
	* changer-src/scsi-cam.c: Replaced Tape_Eject with a more generic 
	function to send different ioctls (Tape_Ioctl)
	* changer-src/scsi-bsd.c: see above
	* changer-src/scsi-hpux_new.c: see above
	* changer-src/scsi-irix.c: If the device can be opened in SCSI_OpenDevice
	set pDev[ip].avail to 1.
	* changer-src/scsi-linux.c: include dmalloc.h for debugging of mem problems.
	Fixed an invalid free in SCSI_OpenDevice. Replaced Tape_Eject with Tape_Ioctl.	
	* changer-src/scsi-changer-driver.c: include dmalloc.h for debugging of mem problems
	Eject the tape in the inventory function before the scan to get all
	barcode labels. Check in GenericEject if the device is able to receive
	SCSI commands, if not use the ioctl interface to eject the tape.
	Same for the GenericRewind function.
	Added the LogSense in the GenericEject function.
	* changer-src/scsi-defs.h: Added define for Tape_Ioctl commands, IOCTL_EJECT.
	
2001-06-01 John R. Jackson <jrj@purdue.edu>

	* server-src/amindexd.c (build_disk_table): Make sure a holding disk
	  image is used rather than a copy also on tape, if both exist.

2001-06-01 Thomas Hepper <th@ant.han.de>
	* changer-src/scsi-changer-driver.c: Added an range check in the load
	function and abort if the requested slot is out of range.
	Fixed in incorrect pointer in the eject function if the ioctl
	interface is used

2001-05-29 John R. Jackson <jrj@purdue.edu>

	* server-src/reporter.c: Fix PostScript output to only show what went
	  on the tape, not what the total amount dumped.  Compliments of
	  Joshua Baker-LePain <jlb17@duke.edu>.

2001-05-28 Thomas Hepper <th@ant.han.de>
	* changer-scsi/chg-scsi.c: Made the array for pDev configurable, #define CHG_MAXDEV
	* changer-scsi/scsi-defs.h: Added the define for CHG_MAXDEV
	* changer-src/scsi-cam.c: Set the flag pDev[x].avail to 1 if the device can be openend.
	Added debug message if the open fails. Implemented the function Tape_Status (not tested)
	* changer-src/scsi-changer-driver.c: Added the function DLT448ElementStatus, was lost
	during merge from 2.4.2. The difference to GenericElementStatus is that the DecodeModeSense
	needs an offset of 12, not 0 as in GenericElementStatus.
	Added an unload/GenericResetStatus in the Inventory function if an bar code reader is 
	available. This is to get the label from the loaded tape.
	The function TapeStatus sets now the status regardless of the status of the tape.
	If the device is capable for sending SCSI commands use the SCSI interface to get
	the status of the tape.
	* docs/TAPE.CHANGERS: Added some notes about the debuglevel keyword and a short
	description on how to use the sgen interface on solaris 2.8
	
2001-05-18 John R. Jackson <jrj@purdue.edu>

	* client-src/patch-system.sh.in: Missed a reference to kamanda in the
	  last patch.  Compliments of Tom Schutter <t.schutter@att.net>.

2001-05-16 John R. Jackson <jrj@purdue.edu>

	* client-src/patch-system.sh.in: Go ahead and update /etc/services
	  on a client even if the services themselves are not turned on to
	  inetd.  Compliments of Tom Schutter <t.schutter@att.net>.  Add
	  the TCP port for amandad for future use.

2001-05-14 John R. Jackson <jrj@purdue.edu>

	* client-src/amandad.c: Fix hang when the incoming packet size is
	  larger than the pipe buffer.  Also, report back when too much
	  data for a packet is returned by the service (this is not properly
	  diagnosed back to, e.g., amcheck, but that's for another day).
	* common-src/bsd-security.c: Fix minor comment error.

2001-05-11 John R. Jackson <jrj@purdue.edu>

	* common-src/util.c (bind_portrange): Log a debug message stating
	  explicitly that all ports in the requested range were busy, or
	  that a specific port failed bind() for an unexpected reason.

2001-05-07 John R. Jackson <jrj@purdue.edu>

	* client-src/sendbackup-dump.c: Do not use full path to sed.  Found by
	  Roland E. Lipovits (rel@lipo.at0.net).

2001-05-07 Thomas Hepper <th@ant.han.de>
	* changer-src/chg-scsi.c : Fixed NULL pointer in debug print of the config.
	* changer-src/scsi-canger-driver.c : Try to get and set the status of the tape drive in
	GenericElementStatus if there is an error condition. Move from tape to tape to get the
	tape loaded if it is only ejected.
	* changer-src/scsi-defs.h : New define for the Tape_Status fucntion, TAPE_NOT_LOADED
	* changer-src/scsi-linux.c : Added return type for tape not loaded
	* changer-src/scsi-solaris.c : In SCSI_ExecuteCommand force the direction to write if the
	databuffersize is 0, if the direction is input the ioctl returns with errno 22, invalid argument.
	The function Tape_Status will now return either tape loaded or not.
	* example/chg-scsi-solaris.conf.in : Added pointer to doc/TAPE.CHANGERS on how to configure
	the sgen driver.
	* doc/TAPE.CHANGERS : Updated the description of the chg-scsi.conf options, short description on
	how to confgure the sgen driver on solaris 2.8
	
2001-05-04 John R. Jackson <jrj@purdue.edu>

	* config/depcomp: Fix problem with argument*  processing and update to
	  latest version.

2001-05-01 Thomas Hepper <th@ant.han.de>
	* changer-src/chg-scsi.c : Added patch for the slot advance command from John R. Jackson
	* changer-src/scsi-changer-driver.c : Renamed EXB120BarCode to EXB_BarCode. The currently
	known Exabyte libs handles the reader in the same way.
	
2001-04-28 Thomas Hepper <th@ant.han.de>
	* changer-scsi/chg-scsi.c : Added missing break in MapBarCode
	Changed the way an tape label is read, use tape_open to open the
	device, not own open.
	* changer-src/scsi-changer-driver.c : Changed the way an tape label 
	is read, use tape_open to open the device, not own open.
	* changer-src/scsi-linux.c : Fixed error on reopen of non SCSI devices
	(/dev/nst0 for example)
	
2001-04-26 Thomas Hepper <th@ant.han.de>

	* changer-src/scsi-aix.c : Added more different ret values depending on the SCSI
	error condition. 
	* changer-src/scsi-changer-driver.c: Split GenericElementStatus in GetElementStatus which
	reads the element Status, and GenericElementStatus which handles the errors.
	Removed DLT448ElementStatus. Rework the handling of some SCSI error conditions...
	* changer-src/scsi-defs.h: Added more defs for the debug SECTION types.
	* changer-src/scsi-linux.c: Fixed an bug in the non SCSI device handling in SCSI_OpenDevice
	* changer-src/sense.c: Added EXB-210 defs, added defs for READ_ELEMENT_STATUS error conditions.
	
2001-04-25 John R. Jackson <jrj@purdue.edu>

	* changer-src/chg-rth.pl.in: Add exec_prefix back since it is usually
	  used to define sbindir.  Sigh.  Include X=X assignments to get rid
	  of the Perl warnings.
	* server-src/amoverview.pl.in: Ditto.

2001-04-24 John R. Jackson <jrj@purdue.edu>

	* changer-src/chg-chio.pl.in: Remove unused exec_prefix to get rid of
	  warning message.  Patch from Nick Hibma <n_hibma@qubesoft.com>.

2001-04-23 John R. Jackson <jrj@purdue.edu>

	* client-src/selfcheck.c: Allow Samba shares with no password.
	* client-src/sendbackup-gnutar.c: Ditto.
	* client-src/sendsize.c: Ditto.

2001-04-15 Thomas Hepper <th@ant.han.de>
	* Makefile.am: Added contrib/gsc files to EXTRA_DIST
	
2001-04-15 Thomas Hepper <th@ant.han.de>
	* changer-src/scsi-aix.c: Rework of the SCSI interface, support
	to talk to an device handled by the gsc driver (not tested yet)
	* changer-src/scsi-bsd.c (SCSI_ExecuteCommand): Fix error in
	device handling, Changed the return codes in case of an error
	* changer-src/scsi-cam.c (SCSI_ExecuteCommand): Fix error in 
	device handling, Changed the return codes in case of an error
	* changer-src/scsi-changer-driver.c: Changed the way 
	SCSI_ExecuteCommand passes error conditions back, error handling
	should now be done by the calling function, SCSI_Run for example.
	* changer-src/scsi-changer-driver.c (CheckMove): If the 
	DeviceCapabilitiesPage is not set do not return an error, print
	an warning to the debug file.
	* changer-src/scsi-defs.h: New define for AIX_USE_GSC
	New defines for the return codes of SCSI_ExecuteCommand
	* changer-src/scsi-hpux_new.c: Fix error in device handling.
	Changed the return codes in case of an error
	* changer-src/scsi-irix.c: Fix error in device handling.
	Changed the return codes in case of an error
	* changer-src/scsi-solaris.c: Fix error in device handling.
	Changed the return codes in case of an error
	
2001-04-15 Thomas Hepper <th@ant.han.de>
	*contrib/gsc: Generic SCSI interface for AIX, used by chg-scsi

2001-04-13 John R. Jackson <jrj@purdue.edu>

	* example/amanda.conf.in: Fix multiple holding disks comment.

2001-04-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/getfsent.h (search_fstab): New prototype.
	* client-src/getfsent.c (search_fstab): New arg check_dev, skip
	entry if check_dev==1 and device stats failed.
	* client-src/getfsent.c (open_fstab for linux): Open MOUNTED.
	* client-src/getfsent.c (close_fstab for linux): close MOUNTED.
	* client-src/getfsent.c (get_fstab_nextentry for linux): parse MOUNTED.
	* client-src/getfsent.c (amname_to_devname, amname_to_dirname, 
	amname_to_fstype): Call search_fstab sequentialy with 1 and 0 
	for check_dev.

2001-04-10 John R. Jackson <jrj@purdue.edu>

	* docs/INSTALL: Update location to GNUPLOT per Lars Hecking
	  <lhecking@nmrc.ie>.

2001-04-09 Thomas Hepper <th@ant.han.de>
	* changer-src/scsi-changer-driver.c: More rework on the debug output.
	changed definition SENSE_NO_TAPE to SENSE_TAPE_NOT_ONLINE
	In function GenericRewind do an check before the rewind to see
	if the tape is loaded.
	* changer-src/scsi-defs.h: New #define for the debug, SECTION_TAPE
	* changer-src/sense.c: New definition for SENSE_RETRY, ASC=4, ASCQ=1
	
2001-04-08  Alexandre Oliva  <aoliva@redhat.com>

	* client-src/getfsent.c (search_fstab): Don't skip entry just
	because device stats failed.

2001-04-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* config/config.guess: Upgrade from ftp://ftp.gnu.org/pub/gnu/config
	* config/config.sub: Upgrade from ftp://ftp.gnu.org/pub/gnu/config
	* config/mkinstalldirs: Upgrade from automake CVS.

2001-04-06  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* config/depcomp: new file for automake.

2001-04-03 John R. Jackson <jrj@purdue.edu>

	* Makefile.am: Remove *.test.c from the distribution.

2001-04-02 John R. Jackson <jrj@purdue.edu>

	* NEWS: Update some of the 2.4.2 items.

2001-03-29  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/getfsent.c (search_fstab): If the device doesn't 
	exist, it will take the entry from /etc/mtab.

2001-03-26 John R. Jackson <jrj@purdue.edu>

	* server-src/amtape.c: Do not rewind for slot "advance".  Do not report
	  device name (which is bogus) for slot "advance".

2001-03-23 John R. Jackson <jrj@purdue.edu>

	* example/amanda.conf.in: Add warning that the sample amanda.conf
	  will not work as is and must be edited to match the installation.

2001-03-21 John R. Jackson <jrj@purdue.edu>

	* recover-src/extract_list.c (extract_files_child): Fix problem that
	  caused xfsrestore arg list to not be NULL terminated.

2001-03-19 John R. Jackson <jrj@purdue.edu>

	* configure.in: Add --with-debug-days (default is 4) and remove
	  --with-pid-debug-files.
	* common-src/Makefile.am: Clean up test program dependencies.
	* common-src/debug.c: Create timestamped debug file names and remove
	  files older (based on file name) than --with-debug-days.  Rename old
	  style names to new style (based on modification time) the first time
	  they are seen.
	* common-src/file.c: Use construct_datestamp() instead of private code.
	* common-src/genversion.c: Display AMANDA_DEBUG_DAYS and remove
	  DEBUG_FILE_WITH_PID.
	* common-src/util.c: Move construct_datestamp to here and add new
	  function construct_timestamp.  Change time used to build string to
	  be an optional parameter instead of always getting it in the routine.
	* common-src/util.h: Add prototypes.
	* server-src/amcleanupdisk.c: Change construct_datestamp call to pass
	  indication that it should get the current time.
	* server-src/amflush.c: Ditto.
	* server-src/chunker.c: Ditto.
	* server-src/driver.c: Ditto.
	* server-src/dumper.c: Ditto.
	* server-src/planner.c: Ditto.
	* server-src/server_util.c: Remove construct_datestamp (now in util.c).
	* server-src/server_util.h: Remove prototype.

2001-03-15 John R. Jackson <jrj@purdue.edu>

	* server-src/planner.c (analyze_estimate): Do not do an incremental
	  if FORCE_NO_BUMP is set and the last dump was a level 0.

2001-03-14 John R. Jackson <jrj@purdue.edu>

	* server-src/amcheck.c: Change message from NOTE to WARNING when
	  the hold file exists.
	* man/amcheck.8.in: Ditto.

2001-03-14 John R. Jackson <jrj@purdue.edu>

	* client-src/selfcheck.c: Send smbclient via pipe instead of command
	  line arg.  Various minor cleanups.  Use pipespawn instead of system()
	  to clean up quoting problems and be consistent with sendsize and
	  sendbackup.
	* client-src/sendbackup-dump.c: Send smbclient via pipe instead of
	  line arg.  Various minor cleanups.
	* client-src/sendbackup-gnutar.c: Send smbclient via pipe instead of
	  line arg.  Various minor cleanups.  Clean up listed incremental file
	  handling.
	* client-src/sendbackup.c: Various minor cleanups.
	* client-src/sendsize.c: Send smbclient via pipe instead of command
	  line arg.  Various minor cleanups.  Clean up listed incremental file
	  handling.
	* docs/SAMBA: Update and cleanup.
	* common-src/pipespawn.c: Import from 2.4.2 branch.
	* common-src/pipespawn.h: Import from 2.4.2 branch.
	* common-src/Makefile.am: Add pipespawn.[ch] references.

2001-03-13 John R. Jackson <jrj@purdue.edu>

	* recover-src/extract_list.c (extract_files_child): Fix xfsrestore
	  argument list processing.

2001-03-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/dumper.c (read_datafd): set errstr and return on
	databuf_write error.

2001-03-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/dumper.c (read_indexfd): Ignore error while writing
	to the index file. Log an L_INFO message.

2001-03-09 John R. Jackson <jrj@purdue.edu>

	* server-src/taper.c: Initialize tape_fd to -1 and test in a couple
	  more places.	Run normal protocol after a tape startup error (e.g.
	  "cannot overwrite") instead of just exiting to keep driver from
	  reporting a broken pipe.

2001-03-08  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Reported by Eric Schnoebelen <eric@cirr.com>

	* server-src/changer.c (changer_command): Fix fd leak.

2001-03-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/server_util.c (cmdstr, getcmd, putresult): New.
	* server-src/server_util.h (cmdstr, getcmd, putresult): Prototype.
	* server-src/server_util.h (cmd_t): New.
	* server-src/driverio.c (cmdstr): Remove.
	* server-src/driverio.c: Use new cmdstr and cmd_t.
	* server-src/driverio.h: (tok_t): Remove.
	* server-src/amflush.c: Use new cmd_t.
	* server-src/driver.c: Use new cmd_t.
	* server-src/chunker.c (cmd_t, getcmd, putresult): Remove.
	* server-src/chunker.c: Use new cmd_t, getcmd and putresult.
	* server-src/dumper.c (cmd_t, getcmd, putresult): Remove.
	* server-src/dumper.c: Use new cmd_t, getcmd and putresult.
	* server-src/taper.c (cmd_t, getcmd, putresult): Remove.
	* server-src/taper.c: Use new cmd_t, getcmd and putresult.

2001-03-05 John R. Jackson <jrj@purdue.edu>

	* common-src/util.c: The fullread() and fullwrite() functions should
	  call read() and write(), not tapefd_read() and tapefd_write().

2001-02-28  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c (setup_estimate): Don't re-ask for level 0
	if last_level is 0 and FORCE_NO_BUMP is set.

2001-02-27 John R. Jackson <jrj@purdue.edu>

	* common-src/stream.h: Move DATABUF_SIZE to stream.h.
	* client-src/sendbackup.c: Do not ask for a big receive buffer.
	* server-src/dumper.c: Ask for a bigger send buffer.  Minor typos.
	* server-src/taper.c: Ask for a bigger receive buffer.
	* recover-src/amrecover.c: Use stream_client instead of specific
	  (and incorrect) bind() code.
	* recover-src/extract_list.c: Ditto.

2001-02-27 John R. Jackson <jrj@purdue.edu>

	* common-src/dgram.c: Add lots more error logging to help track down
	  problems.

2001-02-27 John R. Jackson <jrj@purdue.edu>

	* common-src/stream.c: Add lots more error logging to help track down
	  problems.

2001-02-27 John R. Jackson <jrj@purdue.edu>

	* server-src/amtape.c: Rewind after loading a slot either by slot
	  or by label.

2001-02-27 John R. Jackson <jrj@purdue.edu>

	* configure.in: Add some commentary about why pushdef/popdef are
	  needed around AC_CHECK_TYPE.

2001-02-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Alex Pilosov <alex@pilosoft.com>

	* changer-src/scsi-cam.c: Clean up some SCSI CAM code,
	and permit use of both bus:target:lun(btl) and a full
	device name (/dev/ch0) as changerdev.
	
2001-02-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Joe Rhett <jrhett@isite.net>
	and Jason Hollinden <jhollind@sammg.com>

	* changer-src/chg-zd-mtx.sh.in:  Added barcode reader support,
	>9 tape slot support, variable for 'offline' or 'ONLINE'
	return value of tape device, and multi-config support.  Moved
	all user settable variables to 'changerfile'.conf in the
	amanda config directory.  Added commented out example of .conf
	file into script.

2001-02-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amindexd.c (uncompress_file): remove uncompressed
	index file if the command failed.

2001-02-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* restore-src/amrestore.c (main): init r to 0.

2001-02-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/scsi-defs.h (PrintConf): Add prototype.
	* changer-src/scsi-changer-driver.c (SCSI_Run): Add prototype.
	* changer-src/scsi-linux.c (ScanBus): remove btl variable, return 0.

2001-02-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* man/Makefile.am (EXTRA_DIST): add amdd.8 and ammt.8.

2001-02-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

        * server-src/planner.c (setup_estimate): ask for level 0 for 
        a new disk if force-bump is set, 
        log force-bump and force-nobump command.

2001-02-17 Thomas Hepper <th@ant.han.de>

	* changer-scsi/chg-scsi.c: New Option -genconf to create an example config file
	 based on the information found on the system, works for Linux and BSD with cam
	 support. New config option debuglevel
	* changer-src/scsi-changer-deriver.c: Reworked the debug output, it is now possible
	 to control the amount of information by the config option debuglevel in the config
	 file (docs follow), not complete yet.
	* changer-src/scsi-changer-driver.c: New function PrintConf to create an example
	  config file.
	  New function DebugPrint to print debug information based on the variable debuglevel.
	  Replaced a lot of dbprintf with new Function DebugPrint
	* changer-src/scsi-aix.c: changed parameter for ScanBus
	* changer-src/scsi-irix.c: changed parameter for ScanBus
	* changer-src/scsi-solaris.c: changed parameter for ScanBus
	* changer-src/scsi-bsd.c: changed parameter for ScanBus
	* changer-src/scsi-cam.c: Implemented function ScanBus
	* changer-src/scsi-linux.c: Implemented function ScanBus
	
2001-02-09 John R. Jackson <jrj@purdue.edu>

	* server-src/diskfile.c: Fix core dump in test program.

2001-02-09 John R. Jackson <jrj@purdue.edu>

	* tape-src/output-file.c: Use a "data" subdirectory of the main
	  file driver device directory to hold the tape "files".  This
	  allows the status file to be moved to the main directory.
	* man/amanda.8.in: Document these changes.

2001-02-08 Thomas Hepper <th@ant.han.de>

	* changer-src/scsi-aix.c: Added dummy ScanBus function
	* changer-src/scsi-bsd.c: Added dummy ScanBus function
	* changer-src/scsi-cam.c: Added dummy ScanBus function
	* changer-src/scsi-hpux_new.c: Added dummy ScanBus function
	* changer-src/scsi-irix.c: Added dummy ScanBus function
	* changer-src/scsi-defs.h: Added prototype for ScanBus function

2001-02-04 John R. Jackson <jrj@purdue.edu>

	* man/amanda.8.in: Fix mailto to space separated, not comma.

2001-02-03 John R. Jackson <jrj@purdue.edu>

	* .cvsignore: Add entries to keep CVS quiet.
	* */.cvsignore: Ditto.

2001-02-03 John R. Jackson <jrj@purdue.edu>

	* client-src/Makefile.am: Add CLEANFILES rule to remove *.test.c.
	* common-src/Makefile.am: Add more sources as needed to the test
	  programs so they would compile.
	* server-src/Makefile.am: Create TEST_PROGS make variable ala the
	  other Makefile.am files.
	* tape-src/Makefile.am: Add CLEANFILES rule to remove *.test.c.

2001-02-03 John R. Jackson <jrj@purdue.edu>

	* server-src/diskfile.c: Fix test program compilation error and bug
	  when just a config name was given on the command line.

2001-02-02 John R. Jackson <jrj@purdue.edu>

	* server-src/reporter.c: Fix problem with enum being unsigned on
	  some systems.

2001-01-29 John R. Jackson <jrj@purdue.edu>

	* tape-src/tapeio.c (tape_fsf): Go back to using snprintf as this
	  is now "the way".

2001-01-29 John R. Jackson <jrj@purdue.edu>

	* tape-src/output-tape.c (tape_tapefd_status): Convert flag values
	  to booleans (compliments of Marc W. Mengel <mengel@fnal.gov>).
	* tape-src/tapeio.c (tape_fsf): Use ap_snprintf instead of snprintf
	  (also compliments of Marc).

2001-01-26 John R. Jackson <jrj@purdue.edu>

	* changer-src/Makefile.am: Double up the references to libamanda to
	  handle systems that put regex in strange places.
	* client-src/Makefile.am: Ditto.
	* recover-src/Makefile.am: Ditto.
	* restore-src/Makefile.am: Ditto.
	* server-src/Makefile.am: Ditto.
	* tape-src/Makefile.am: Ditto.

2001-01-23 John R. Jackson <jrj@purdue.edu>

	* configure.in: Add tapeio switch from Marc Mengel <mengel@fnal.gov>,
	  enhance and add "null" and "file" output drivers.  Change all
	  tape changers (except chg-scsi) to use amdd and ammt.  Change all
	  tape changers (except chg-scsi) to log and use a consistent
	  error reporting scheme.  Fix various bugs along the way.  Add new
	  chg-multi config option, posteject, which is an optional script
	  to call after each "tape" is ejected (e.g. to use to start a
	  CDROM writer).  Remove special code for tapedev of /dev/null
	  (now handled by the "null" output driver).  Changed the taper
	  protocol to pass the host/disk/level so the write can send that
	  along to the output driver.  Fairly major rework of amrestore
	  to clean up tape/non-tape and other oddities.
	* changer-src/chg-chio.pl.in: Ditto.
	* changer-src/chg-chs.sh.in: Ditto.
	* changer-src/chg-manual.sh.in: Ditto.
	* changer-src/chg-mtx.sh.in: Ditto.
	* changer-src/chg-multi.sh.in: Ditto.
	* changer-src/chg-rth.pl.in: Ditto.
	* changer-src/chg-zd-mtx.sh.in: Ditto.
	* client-src/sendbackup.c: Ditto.
	* common-src/alloc.c: Ditto.
	* common-src/amanda.h: Ditto.
	* docs/INTERNALS: Ditto.
	* man/Makefile.am: Ditto.
	* man/amanda.8.in: Ditto.
	* man/amdd.8: Ditto.
	* man/ammt.8: Ditto.
	* restore-src/amrestore.c: Ditto.
	* server-src/amcheck.c: Ditto.
	* server-src/amlabel.c: Ditto.
	* server-src/amtape.c: Ditto.
	* server-src/amverify.sh.in: Ditto.
	* server-src/conffile.c: Ditto.
	* server-src/conffile.h: Ditto.
	* server-src/taper.c: Ditto.
	* tape-src/Makefile.am: Ditto.
	* tape-src/amdd.c: Ditto.
	* tape-src/ammt.c: Ditto.
	* tape-src/output-file.c: Ditto.
	* tape-src/output-file.h: Ditto.
	* tape-src/output-null.c: Ditto.
	* tape-src/output-null.h: Ditto.
	* tape-src/output-rait.c: Ditto.
	* tape-src/output-rait.h: Ditto.
	* tape-src/output-tape.c: Ditto.
	* tape-src/output-tape.h: Ditto.
	* tape-src/tapeio.c: Ditto.
	* tape-src/tapeio.h: Ditto.
	* tape-src/tests/amtapeio.test.000: Ditto.
	* tape-src/tests/amtapeio.test.001: Ditto.
	* tape-src/tests/amtapeio.test.002: Ditto.
	* tape-src/tests/amtapeio.test.003: Ditto.
	* tape-src/tests/amtapeio.test.004: Ditto.
	* tape-src/tests/amtapeio.test.005: Ditto.
	* tape-src/tests/amtapeio.test.006: Ditto.
	* tape-src/tests/amtapeio.test.007: Ditto.
	* tape-src/tests/amtapeio.test.008: Ditto.
	* tape-src/tests/amtapeio.test.009: Ditto.
	* tape-src/tests/amtapeio.test.010: Ditto.
	* tape-src/tests/amtapeio.test.011: Ditto.
	* tape-src/tests/amtapeio.test.012: Ditto.
	* tape-src/tests/amtapeio.test.013: Ditto.
	* tape-src/tests/amtapeio.test.014: Ditto.
	* tape-src/tests/amtapeio.test.015: Ditto.
	* tape-src/tests/amtapeio.test.016: Ditto.
	* tape-src/tests/amtapeio.test.017: Ditto.
	* tape-src/tests/amtapeio.test.018: Ditto.
	* tape-src/tests/cleartape: Ditto.
	* tape-src/tests/newtest: Ditto.
	* tape-src/tests/rerun: Ditto.
	* tape-src/tests/runtest: Ditto.
	* tape-src/tests/testdist: Ditto.
	* tape-src/tests/torture: Ditto.

2001-01-24 John R. Jackson <jrj@purdue.edu>

	* client-src/amandad.c: Improve packet logging.

2001-01-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (start_some_dumps): typo.

2001-01-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.h (sched_t): new field no_space.
	* server-src/driver.c (start_some_dumps): don't start a disk if
	  no_space is set.
	* server-src/driver.c (continue_dumps): set no_space if it's the
	  only active dumpers, case c.
	* server-src/driver.c (read_schedule): set no_space to 0.

2001-01-23 John R. Jackson <jrj@purdue.edu>

	* configure.in: Test for setmntent.
	* client-src/getfsent.c: Add some support for Redhat 7 /etc/fstab
	  changes that indirectly reference the device for a file system.

2001-01-22  Marc W. Mengel <mengel@fnal.gov>

	* recover-src/extract_list.c: Added -U to tar recover options
	to reduce errors recovering shared libs and/or binaries on
	active filesystems.

2001-01-20  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/INSTALL: Notes about tar-1.13.19

2001-01-17  Thomas Hepper <th@ant.han.de>

	* changer-src/chg-scsi.c: Moved definitions for config_t and
	changer_t into scsi-defs.h
	* changer-src/chg-scsi.c: New config option havebarcode
	* changer-src/scsi-changer-driver.c: Changed GenericBarCode do handle
	the option havebarcode. Replaced NoBarCode with GenericBarCode.
	Fixed compile warnings from -Wshadow
	* changer-src/scsi-linux.c: New function ScanBus to scan the SCSI Bus.
	not used yet.
	* changer-src/scsi-solaris.c: Changed the return value to
	Command.uscsi_status in SCSI_ExecuteCommand if the return from the
	ioctl is not 0;
	
2001-01-08  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* man/amanda.8.in: New section "HOST & DISK EXPRESSION" and 
	  "DATESTAMP EXPRESSION".
	* man/amadmin.8.in: Document new usage.
	* man/amflush.8.in: Document new usage.
	* man/amcheck.8.in: Document new usage.
	* man/amdump.8.in: Document new usage.
	* man/amrestore.8: Document new usage.
	* server-src/amadmin.c: Fix usage.
	* server-src/amflush.c: Fix usage.
	* server-src/amcheck.c: Fix usage.

2001-01-08  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/diskfile.c (match_disklist): Return if no args.

2001-01-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/diskfile.c (match_disklist): Fix.

2001-01-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/diskfile.c (match_disklist): Updated for
	  [host [disk]*]* syntax.

2001-01-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/match.c (match_datestamp): New function.
	* common-src/amanda.h (match_datestamp): Prototype.
	* server-src/amflush.c: Use match_datestamp.
	* restore-src/amrestore.c: Use match_datestamp.

2001-01-06  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/match.c (match_word): Support for leading ^ and
	  trailing $.

2001-01-04 John R. Jackson <jrj@purdue.edu>

	* common-src/error.c (error): If the debug file pointer is set, log
	  any fatal error message to it and close the file so it has a good
	  trace of what happened and when.

2001-01-04  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* taper-src/am-dd.c: include "tapeio.h", fix debug warning.
	* taper-src/am-mt.c: include "tapeio.h", fix debug warning.
	* taper-src/output-rait.c: include "tapeio.h", new define for
	   rait_debug
	* taper-src/tapeio.c(many): Remove unused tfd variable.
	* taper-src/tapeio.h (tape_unload,tape_status): Prototype.

2001-01-04 John R. Jackson <jrj@purdue.edu>

	* client-src/killpgrp.c: Calls to error() do not need a newline.

2001-01-04 John R. Jackson <jrj@purdue.edu>

	* man/amanda.8.in: Try to make it clearer that dumpcycle and maxdumps
	  changes in the main part of the config file must appear before any
	  dumptype definitions, and also that inherited dumptypes must appear
	  before their reference.

2001-01-04  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (continue_dumps): Don't reduce est_size if
	  it is already larger than holding space allocated.
	* server-src/dumper.c: Remove all code for FILE_DUMP command.
	* server-src/chunker.c: Better handling of ENOSPC from
	  write_tapeheader().

2001-01-04 John R. Jackson <jrj@purdue.edu>

	* server-src/conffile.c (main): Fix conffile test program so it builds
	  and works again.

2001-01-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* changer-src/scsi-defs.h (ChangerCMD_T): replace array function
	  pointer by enumerated pointers.
	* changer-src/scsi-changer-driver.c: Use new calling convention.

2001-01-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: Better support for TRY-AGAIN and
	  ABORT-FINISHED result.

2001-01-02  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amflush.c: Use getopt to parse argument.
	* server-src/amflush.c: New [-D date]* argument.
	* man/amflush.8.in: Document it.

2001-01-02  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	Patch by Andreas F Mueller <afm@othello.ch>

	* server-src/amadmin.c (force_no_bump_one): Fix message.

2001-01-01  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* tape-src/am-dd.c: include "amanda.h"
	* tape-src/am-mt.c: include "amanda.h"
	* tape-src/am-mt.c (main): res is int.
	* tape-src/output-rait.c: include "amanda.h", do not define stderr.
	* tape-src/tapeio.c (xxx_tapefd_read, plain_tapefd_read): second
	  argument should be "char *"
	* tape-src/tapeio.c (xxx_tapefd_write, plain_tapefd_write): second
	  argument should be "const char *"

2000-12-31  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/find.c (find_match): Use todo bit.
	* server-src/find.c (find_dump): No arguments.
	* server-src/find.h (find_dump): Change prototype.
	* server-src/amadmin.c (find): New [host disk]* pair arguments.
	* server-src/amindexd.c: Change call to find_dump().
	* server-src/amtrmidx.c: Change call to find_dump().

2000-12-31  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in: Don't check krb5 include if krb5 is not selected.

2000-12-31  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* tape-src/Makefile.am (noinst_HEADERS): Add output-rait.h

2000-12-31  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c (diskloop): typo.

2000-12-31  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c (diskloop): New [host disk]* pair arguments.
	* server-src/amadmin.c (diskloop, reuse, noreuse): use get_pname()
	instead of argv[0].

2000-12-31  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amflush.c (main):log DISK after checking if logfile exist.

2000-12-30 John R. Jackson <jrj@purdue.edu>

	* common-src/bsd-security.c: Improve the .rhosts/.amandahosts messages
	  when things go wrong.  Add support for "bsdsecurity" test program
	  in common-src.
	* common-src/Makefile.am: Ditto.
	* common-src/amanda.h: Ditto.
	* restore-src/amidxtaped.c: Ditto.
	* server-src/amindexd.c: Ditto.

2000-12-30 John R. Jackson <jrj@purdue.edu>

	* ChangeLog: Bring Jean-Louis into the right month :-).
	* changer-src/scsi-changer-driver.c: Untested changes to at least
	  get the code to compile on Solaris and to remove some warnings.
	* changer-src/scsi-defs.h: Ditto.
	* changer-src/scsi-solaris.c: Ditto.

2000-12-30  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/diskfile.c (add_disk): New function.
	* server-src/diskfile.h (add_disk): Prototype.
	* server-src/logfile.h (logtype_e): add L_DISK.
	* server-src/logfile.c (logtype_str): add "DISK".
	* server-src/amflush.c (main): log DISK.
	* server-src/planner.c (main): log DISK.
	* server-src/reporter.c: use DISK if available.

2000-12-30  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcheck.c: New [host disk]* pair arguments.
	* server-src/amflush.c: Ditto.
	* server-src/planner.c: Ditto.
	* server-src/amdump.sh.in: Ditto.
	* server-src/amrestore.c: Use new host/disk matcher.
	* man/amcheck.8.in: Document new [host disk]* pair arguments.
	* man/amflush.8.in: Ditto.
	* man/amdump.8.in: Ditto.

2000-12-30  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/diskfile.c (match_disklist): new function.
	* server-src/diskfile.h (struct disk_s): new field todo.
	* server-src/diskfile.h (match_disklist): prototype.

2000-12-30  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/match.c (match_word, match_host, match_disk): 
	new functions.
	* common-src/amanda.h (match_host, match_disk): prototype.

2000-12-29  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c (analyze_estimate): pick incremental level
        if no estimate of level 0.

2000-12-28 Marc W. Mengel <mengel@fnal.gov>
	* changer-src/chg-juke.sh.in: New File
	* changer-src/Makefile.am: Added support for chg-juke.
	* docs/TAPE.CHANGERS: Likewise.
	* configure.in: Likewise.

2000-12-24 John R. Jackson <jrj@purdue.edu>

	* server-src/getconf.c: Fix free() of static text string (BUGGY) when
	  the parameter being looked up is bad.

2000-12-23 David Wolfskill  <dhw@whistle.com>

        * server-src/amcheck.c (start_server_check): Change directory
          writable check to be for the tapelist directory instead of
	  the config file directory.  Remove config file directory test.
        * man/amcheck.8.in: Add mention of tapelist directory and do
	  some other directory writable cleanup.

2000-12-12 John R. Jackson <jrj@purdue.edu>

	* client-src/sendbackup-gnutar.c: Fix regex pattern to accept blanks
	  or tabs.

2000-12-12 John R. Jackson <jrj@purdue.edu>

	* Makefile.am: Work around problem with automake 1.4 not including
	  pkgdata_DATA.
	* docs/Makefile.am: Include RAIT and VTAPE-API in distribution.
	  Work around problem with automake 1.4 not including pkgdata_DATA.
	* tape-src/rait.h: Renamed to rait.h.
	* tape-src/rait.c: Renamed to rait.c.
	* tape-src/output-rait.h: Renamed from rait.h.
	* tape-src/output-rait.c: Renamed from rait.c.
	* tape-src/Makefile.am: Reflect the new rait.[ch] names.
	* tape-src/tapeio.c: Use output-rait.h name.  Minor typo changes.

2000-12-08 Marc Mengel <mengel@fnal.gov>

	* docs/RAIT: New file.
	* docs/VTAPE-API: New file.
	* tape-src/rait.c: New File providing RAIT virtual tape type.
	* tape-src/tapeio.c: Major Surgery.
	  (vtable): New static table of virtual tape types.
	  (fdtable): New static table mapping file descriptors.
	  (tapefd_fsf_ioctl): Renamed tapefd_fsf, with added ioctl argument.
	  (tapefd_rewind_ioctl): Likewise.
	  (tapefd_unload_ioctl): Likewise.
	  (tapefd_weof_ioctl): Likewise.
	  (tapefd_status_ioctl): Likewise.
	  (tape_open): Now is a virtual tape table lookup and call.
	  (tape_access): Now is a switch through virtual tape table.
	  (tape_stat): Likewise.
	  (tapefd_close): Likewise.
	  (tapefd_fsf): Likewise.
	  (tapefd_read): Likewise.
	  (tapefd_rewind): Likewise.
	  (tapefd_resetofs): Likewise.
	  (tapefd_unload): Likewise.
	  (tapefd_status): Likewise.
	  (tapefd_weof): Likewise.
	  (tapefd_write): Likewise.
	  (plain_tape_access): Rename of tape_access.
	  (plain_tape_open): Likewise.
	  (plain_tapefd_read): Likewise.
	  (plain_tape_stat): Likewise.
	  (plain_tapefd_write): Likewise.
	  (plain_tapefd_close): Likewise.
	  (plain_tapefd_fsf): Now calls tapefd_fsf_ioctl with &ioctl().
	  (plain_tapefd_rewind): Likewise.
	  (plain_tapefd_resetofs): Likewise.
	  (plain_tapefd_unload): Likewise.
	  (plain_tapefd_status): Likewise.
	  (plain_tapefd_weof): Likewise.

2000-12-04 John R. Jackson  <jrj@purdue.edu>

	* server-src/amdump.sh.in: Temporary fix for $LOGNAME vs whoami
	  problem.

2000-12-04 John R. Jackson  <jrj@purdue.edu>

	* server-src/conffile.c (read_conffile_recursively): If the file name
	  for the includefile directive is not absolute, make it relative to
	  the configuration directory.

2000-12-03 John R. Jackson  <jrj@purdue.edu>

	* restore-src/amrestore.c: Fix header when compression is included.
	  Use "fast" option for -c and add new -C option to get "best".
	* man/amrestore.8: Document the new option, the compression level,
	  and clean up some nroff issues.

2000-11-30 Marc Mengel <mengel@fnal.gov>

	* changer-src/chg-chio.pl.in: Use am-mt and am-dd versus mt and dd.
	* changer-src/chg-chs.sh.in: Likewise.
	* changer-src/chg-manual.sh.in: Likewise.
	* changer-src/chg-mtx.sh.in: Likewise.
	* changer-src/chg-multi.sh.in: Likewise.
	* changer-src/chg-rth.pl.in: Likewise.
	* changer-src/chg-zd-mtx.sh.in:  Likewise.
	* tape-src/am-dd.c: New file. Replacement for dd.
	* tape-src/am-mt.c: New file. replacement for mt.
	* tape-src/Makefile.am: Add build for am-mt and am-dd.
	* tape-src/tapeio.c (tape_unload, tapefd_unload, tape_status, 
	  tapefd_status): New functions.
          (tape_rewind, tape_fsf, tape_rdlabel): Change error message 
		for tape being offline so it matches online/offline regex 
		in changer scripts.
	  (tape_open): Ifdef-out mode flag clearing, so you can pass 
		O_TRUNC, etc.  in for am-dd.

2000-11-26  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/util.c: #include "../tape-src/tapeio.h"
	* tape-src/tapeio.c(tapefd_write): second arg is const.
	* tape-src/tapeio.h(tapefd_write): Likewise.
	* common-src/event.c(event_loop): declare entry if ASSERT is defined.
	* changer-src/chg-scsi.c: Fix compiler warning.
	* changer-src/scsi-aix.c: Likewise.
	* changer-src/scsi-bsd.c: Likewise.
	* changer-src/scsi-cam.c: Likewise.
	* changer-src/scsi-changer-driver.c: Likewise.
	* changer-src/scsi-defs.h: Likewise.
	* changer-src/scsi-hpux.c: Likewise.
	* changer-src/scsi-hpux_new.c: Likewise.
	* changer-src/scsi-irix.c: Likewise.
	* changer-src/scsi-linux.c: Likewise.
	* changer-src/scsi-solaris.c: Likewise.
	* changer-src/sense.c: Likewise.

2000-11-22 John R. Jackson  <jrj@purdue.edu>

	* contrib/dbbackup.ksh: Deal with adm being a symlink.
	* contrib/dbbackup.tcl: Update for Tcl 8.3 and newer Oratcl versions.

2000-11-22 John R. Jackson  <jrj@purdue.edu>

	* Makefile.am: Forgot to add contrib/sst/README.Amanda to the list
	  of files to put in a distribution.

2000-11-21 John R. Jackson  <jrj@purdue.edu>

	* recover-src/extract_list.c (extract_files_child): Add support for
	  XFSRESTORE.

2000-11-21 John R. Jackson  <jrj@purdue.edu>

	* server-src/amcheck.c: Minor message wording changes.

2000-11-21 John R. Jackson  <jrj@purdue.edu>

	* configure.in: Forgot to check in this part of new amgetconf.8.in.

2000-11-21 John R. Jackson  <jrj@purdue.edu>

	* contrib/sst/README.Amanda: New file of Amanda specific sst notes.
	* contrib/sst/sst.c: Attempt at letting gcc compile sst.

2000-11-21 John R. Jackson  <jrj@purdue.edu>

	* man/amgetconf.8.in: New man page.
	* man/Makefile.am: Add support for amgetconf.8.in.
	* man/amadmin.8.in: Update for 2.4.2 and do general cleanup.
	* man/amanda.8.in: Ditto.
	* man/amcheck.8.in: Ditto.
	* man/amcheckdb.8.in: Ditto.
	* man/amcleanup.8.in: Ditto.
	* man/amdump.8.in: Ditto.
	* man/amflush.8.in: Ditto.
	* man/amlabel.8.in: Ditto.
	* man/amrecover.8.in: Ditto.
	* man/amreport.8.in: Ditto.
	* man/amrestore.8: Ditto.
	* man/amrmtape.8.in: Ditto.
	* man/amstatus.8.in: Ditto.
	* man/amtape.8: Ditto.
	* man/amtoc.8.in: Ditto.
	* man/amverify.8.in: Ditto.

2000-11-21 John R. Jackson  <jrj@purdue.edu>

	* contrib/sst/sst.c (sst_ioctl): Allow non-root users to use sst.

2000-11-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amdump.sh.in: exit if amgetconf exit with status != 0.
	* server-src/amcleanup.sh.in: ditto
	* server-src/amstatus.pl.in: ditto

2000-11-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (start_some_dumps): don't check free_kps if
	curusage == 0.
	* server-src/driver.c (free_kps): remove the kludge.

2000-11-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/conffile.c: It's an error to have a negative chunksize.
	* man/amanda.8.in: remove documentation of negative chunksize.
	* example/amanda.conf.in: ditto
	* example/amanda.conf.chg-scsi.in:ditto
	* NEWS: negative chunksize is no longer supported.

2000-11-03 John R. Jackson  <jrj@purdue.edu>

	* server-src/driver.c (handle_taper_result): the holding disk entry
	should not be removed just because taper could not write it out in
	the "too many taper retries" case.  It should be left for amflush.

2000-11-01 John R. Jackson  <jrj@purdue.edu>

	* server-src/amverify.sh.in: use common form for getting the first
	line of a file/pipe.  Sed is more portable than head.

2000-10-30  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/selfcheck.c (check_disk): Write an appropriate
	message if the disk name start with '//' and the program is DUMP
	or SAMBA is not compiled in.

2000-10-29  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (handle_chunker_result): The dumpsize is
	the third argument, not the fourth.

2000-10-29  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (handle_chunker_result): don't check
	pending_aborts, call event_release() ob ABORT-FINISHED.

2000-10-29  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/chunker.c (databuf_flush): workaround to prevent a
	hang on a ABORT command.

2000-10-29  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (continue_dumps): set estimate to more than 
	what is already use instead of setting no_hold=1 when a disk
	don't fit on holding disk.

2000-10-29  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/chunker.c: chunker was broken after RQ-MORE-DISK.

2000-10-28  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: add '&' when calling &usage() 
	or &dump_size().

2000-10-28  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	reported by The Hermit Hacker <scrappy@hub.org>

	* changer-src/chg-chio.pl.in: remove unused $libexecdir.

2000-10-28  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	reported by The Hermit Hacker <scrappy@hub.org>

	* changer-src/chg-chio.pl.in: remove comma after LOG, 
	typo: r should be 0.

2000-10-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/INDEXING: doc updated.

2000-10-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* AUTHORS: add Thomas Hepper.

2000-10-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.c (chunker_cmd): send ABORT command.

2000-10-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amverify.sh.in: grep only the first line of the header.

2000-10-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amverify.sh.in: verify with tar even if the
	server and the client are not configured with the same path.

2000-10-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* NEWS: A new `ctimeout' keyword in amanda.conf to replace 
	the CHECK_TIMEOUT constant in amcheck.c.

2000-10-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amlabel.c: Don't set tape_ok to 0 if 
	tape_wrlabel is successful.

2000-10-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/taper.c: amfree(strclosing).

2000-10-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c: typo.

2000-10-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in: --with-samba-user is deprecated.
	* docs/SAMBA: the username is now on the amandapass file.
	* NEWS: the username is now on the amandapass file.
	* client-src/findpass.c (findpass): accept "*" as diskname.
	* client-src/selfcheck.c (check_disk): call to samba changed.
	* client-src/sendsize.c (getsize_smbtar): ditto.
	* client-src/sendbackup-gnutar.c (start_backup): ditto.
	* recover-src/extract_list.c (extract_files_child): ditto.

2000-10-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/taper.c: give better message when failing 
	to open a chunk.

2000-10-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/diskfile.c (headqueue_disk): new function to
	insert at the head of the queue.
	* server-src/diskfile.h (headqueue_disk): prototype.
	* server-src/driver.c (taper_queuedisk): insert with
	headqueue_disk() if disk already attempted.

2000-10-09  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* AUTHORS: fix my email address.

2000-09-26  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcheck.c: Don't accept -m or -M option if MAILER
	is not defined.
	* server-src/reporter.c: Need a -f optionn if MAILER is not defined.

2000-09-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	patch by <jeg@time.ucsc.edu>

	* server-src/reporter.c (output_summary): check for tape_labels.

2000-09-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amindexd.c: use strcasecmp to compare hostname.

2000-09-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: fix plural misuse.

2000-09-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* man/amanda.8.in: add all pages in the SEE ALSO section.

2000-09-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* man/amreport.8.in: amreport does not rotate the log.
	* man/amrestore.8: note on holdingdisk.
	* restore-src/amrestore.c: update usage.
	* server-src/amrmtape.sh.in: update usage.
	* server-src/amverify.sh.in.usage: update usage.

2000-09-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amoverview.pl.in: update usage information,
	-config is no longer needed for ccompatibility with other program.
	* man/amoverview.8.in: -config is no longer needed.

2000-09-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* example/amanda.conf.in: chunk should not be larger than
	MAX_FILE_SIZE - 1Mb.

2000-09-24  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/sendsize.c (getsize_smbtar): remove unused debug_level
	variable.
	* server-src/amlabel.c (main): init errstr to NULL, 
	fix compiler warning.

2000-09-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	patch by jason Thomas <jet@users.sourceforge.net>

	* tape-src/tapetype.c: fix help message.

2000-09-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	patch by Rudolf Cejka <cejkar@users.sourceforge.net>

	* common-src/file.c (mkpdir): check p != NULL
	* man/amstatus.8.in: typo

2000-09-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>
	patch by Rudolf Cejka <cejkar@users.sourceforge.net>

	* client-src/calcsize.c:sets correct program name,
	prevent coredumps and some improrer command line error mesages

2000-09-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/amanda.h: prototype clean_regex().
	* common-src/match.c: new function clean_regex() that escape
	all non-alphanumeric character.
	* recover-src/extract_list.c (add_file, delete_file): use clean_regex().

2000-09-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcheck.c: (start_server_check): check for the oldlog
	directory.

2000-09-22  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amtrmlog.c: better check of the oldlog directory.

2000-09-22  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcheck.c: (start_server_check): don't check the tape
        if tapedev is /dev/null.

2000-09-22  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/reporter.c (output_tapeinfo): test reversed for run_tapes.

2000-07-31 Thomas Hepper <th@ant.han.de>
	* changer-src/chg-scsi.c: Rework of the device handling.
	Every device is opend for an operation and than closed.
	This will hopefully fix the problems with openening the tape device
	and the SCSI control device for the tape
	new option emubarcode (see docs/TAPE.CHANGERS)
	* changer-src/scsi-cam.c: Changed to work with the new device handling.
	* changer-src/scsi-hpux_new.c: Changed to work with the new device handling.
	* changer-src/scsi-irix.c: Changed to work with the new device handling. (Not tested)
	* changer-src/scsi-solaris.c: Changed to work with the new device handling. (Not tested)
	* changer-src/scsi-linux.c: Changed to work with the new device handling.
	* changer-src/scsi-changer-driver.c: Changed to work with the new device handling
	* changer-src/scsi-defs.h: Changed to work with the new device handling
2000-07-18 John R. Jackson  <jrj@purdue.edu>

	* changer-src/chg-chio.pl.in (do_time): fix chg-chio.pl timestamp
	function to return a string instead of writing to stdout.

2000-07-18 John R. Jackson  <jrj@purdue.edu>

	* server-src/taper.c (file_reader_side): detach and destroy shared
	memory areas on an error condition.  Found by Patrik Andersin
	<cat@iki.fi>.

2000-07-17 Thomas Hepper <th@ant.han.de>
	* docs/TAPE.CHANGERS: Added some notes for the cam driver
	* changer-src/scsi-cam.c: New syntax for telling scsi ids
	(bus:target:lun)
	SCSI_ExecuteCommand now returns the correct sense buffer.

2000-07-17 Thomas Hepper <th@ant.han.de>
	* configure.in: Added check for BSD SCSI CAM Support
	* changer-src/scsi-cam.c: New, functions for SCSI CAM Support
	( at the moment for FreeBSD 4.0)
	* changer-src/Makefile.am: added scsi-cam.s to the list of sources
	* changer-src/chg-scsi.c: The structs for the OpenFiles_T is now
	allocated in chg-scsi and passed to OpenDevice.
	* changer-src/scsi-changer-driver.c: New Parameter for OpenDevice
	(OpenFiles_T)

2000-07-10 Marc Mengel <mengel@fnal.gov>
	* tape-src/tapeio.c -- add tape_{stat,access}, allow "plain:" prefix
		on tape device names
	* tape-src/tapeio.h -- add tape_{stat,access} prototypes
	* common-src/util.c -- call tape_{read,write}() in full{read,write}()
	* restore-src/amidxtaped.c -- use tape_stat() on tapename
	* restore-src/amrestore.c -- use tape_stat() on tapename
	* server-src/amcheck.c -- use tape_access() on tapename
	* client-src/Makefile.am -- now needs libamtape.a twice
	* server-src/Makefile.am -- now needs libamtape.a twice
	* recover-src/Makefile.am -- now needs libamtape.a twice
	* Makefile.am -- tape-src before client-src

2000-07-05 Thomas Hepper <th@ant.han.de>
	* changer-src/chg-scsi.c: fixed an core dump if tapeident was set
	* changer-src/scsi-changer-driver.c (OpenFile):
	 if the ident ist set in the config set this in the internal device 
	 struct too.
	* changer-src/scsi-changer-driver.c (GenerciSenseHandler):
	 changed the type for the info text from char * to char ** which
	 is passwd to Sense2Action
	* changer-src/scsi-changer-driver.c (ChangerStatus):
	 fixed the bug which causes an core dump for chg-scsi -status robot
	 if an bar code reader is detected. Fixed also the bug that the
	 mapping Label -> Barcode was not displayed.
	* changer-src/scsi-defs.h: Changed the prototype for Sense2Action
	* changer-src/sense.c: Added the defs for the Spectra TreeFrog lib
	* changer-src/sense.c (Sense2Action); Fixed the handling if no match
	 was found (fall back to the generic description)

2000-06-26 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/list_dir.c (add_dir_list_item): add at head of list.

2000-06-24 Thomas Hepper <th@ant.han.de>
	* changer-src/chg-scsi-chio.c: Merged changes from 2.4.2 
	* changer-src/chg-scsi.c: Merged changes from 2.4.2
	* changer-src/sense.c: New file. Contains an table and function for the 
          mapping of sense/ASC/ASCQ conditions from the SCSI sense.
	* changer-src/scsi-changer-driver.c: Merged changes from 2.4.2
	  Changed handling for the sense keys. Now there is only one function
          to decide what to do with an sense/ASC/ASCQ conditon (abort,retry ..)
	* changer-src/Makefile.am: Added sense.c to the source list.
	* changer-src/scsi-solaris.c: Merged changes from 2.4.2 
	* changer-src/scsi-linux.c: Merged changes from 2.4.2 
	* changer-src/scsi-irix.c: Merged changes from 2.4.2 
	* changer-src/scsi-hpux_new.c: Merged changes from 2.4.2 
	* changer-src/scsi-defs.h: Merged changes from 2.4.2 
	
2000-06-12  Jeroen Ruigrok van der Werven  <asmodai@wxs.nl>

	* server-src/amlabel.c (main): Do not amfree(config_name).

2000-06-02 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/holding.c (pick_datestamp): convert ch to upper.

2000-05-29 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (handle_dumper_result, handle_chunker_result):
	  delay call to dumper_result().

2000-05-28  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* client-src/sendbackup-gnutar.c: Ignore `socket ignored' GNU tar
	messages.

2000-05-27 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* chunker.c: allow chunk to be written on different holding disk.
	* server-src/driver.c: allow chunk to be written on different
	  holding disk.
	* server-src/conffile.c: make sure that disksize and chunksize
	  are multiple of TAPE_BLOCK_SIZE.
	* server-src/conffile.h: disksize and chunksize are long.
	* server-src/diskfile.c (find_disk): new function to see if a
	  given disk is contained in a list structure.
	* server-src/diskfile.h (find_disk): prototype.
	* server-src/driverio.h (RQ_MORE_DISK): Added message.
	* server-src/driverio.h (free_assignedhd): prototype.
	* server-src/driverio.h (assignedhd_t): new data structure.
	* server-src/driverio.c (cmdstr): added comamnd RQ-MORE-DISK.
	* server-src/driverio.c (free_assignedhd): new function to free an
	  array of assignedhd_t.
	
2000-05-03 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (chunker_program): new variable.

2000-04-20 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: handle chunker line.

2000-04-20  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* recover-src/Makefile.am (LDADD): Removed libamtape.
	Reported by Paul Yeatman <pyeatman@ucsd.edu>

2000-04-17 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/chunker.c: new file for the chunker program.
	* server-src/Makefile.am: compile it.
	* server-src/driver.c: many modification.
	* server-src/driverio.c: many modification.
	* server-src/driverio.c (startup_chunk_process, chunker_cmd):
	new functions.
	* server-src/driverio.h: prototype them.
	* server-src/driverio.h (struct chunker_s): new structure.
	* server-src/logfile.c: handle chunker log.
	* server-src/logfile.h: ditto.
	* server-src/reporter.c: ditto.
	* server-src/taper.c: size reduced by TAPE_BLOCK_SIZE.

2000-04-16 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/taper.c: don't crash if the tapelist file
	doesn't exist.

2000-04-09  Frank Wojcik  <fwojcik@lucent.com>

	* server-src/taper.c (detach_buffers): Fixed typo in error message.

	* server-src/amrmtape.sh.in: Fix occurrence of `Infofile', that
	should have been `InfoFile'.

2000-04-09  Davide Marchignoli  <marchign@di.unipi.it>
  
	* server-src/conffile.h (confparm_t): Added CTIMEOUT.
	* server-src/conffile.c: Added ctimeout support.  Default to 30.
	* example/amanda.conf.in: Likewise.
	* man/amanda.8.in: Documented it.
	* server-src/amcheck.c: Use ctimeout from configuration file instead
	of CHECK_TIMEOUT.

2000-04-09  Stan Brown  <stanb@awod.com>

	* recover-src/amrecover.c (guess_disk): Omit DEV_PREFIX only if
	it is actually a prefix of fsname.

2000-04-09  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* server-src/amlabel.c (main): Check label *after* writing end mark.

2000-03-06 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amlabel.c: don't crash if the tapelist file 
	doesn't exist.

2000-02-12 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: "0 dumpers busy" should be "0 dumper busy".

2000-01-31 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c (force_one, force_bump_one): FORCE_FULL
	and FORCE_BUMP are mutually exclusive.

2000-01-31 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (main): use the holding disk even if the
	datestamped directory already exist.

2000-01-21  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* server-src/amstatus.pl.in (prefix, exec_prefix): Refer to them
	twice to avoid warnings of possible typo.

	* amplot/amplot.awk: Ignore dumper's RQ-MORE-DISK.
	Reported by David Wolfskill <dhw@whistle.com>
	* amplot/amplot.awk: Handle taper's TRY-AGAIN like TAPE-ERROR.

	* server-src/amstatus.pl.in: Compute and display TRY-AGAIN tape
	errors.
	Reported by David Wolfskill <dhw@whistle.com>

	* man/amtoc.8.in: Document -w.

2000-01-21  David Wolfskill  <dhw@whistle.com>

	* server-src/amtoc.pl.in: Add `-w' to add new lines and form feeds.

2000-01-21  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* man/amlabel.8.in: Tapes are no longer requested in reverse order
	of amlabeling.
	Reported by Brad Guillory <round@baileylink.net>

	* server-src/amstatus.pl.in: New option --stats, to display
	statistics about dumpers and taper.
	* man/amstatus.8.in: Document it.

2000-01-21  David Wolfskill  <dhw@whistle.com>

	* server-src/amstatus.pl.in: Sort dumpers by number.

2000-01-21  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* server-src/amstatus.pl.in: Remove bogus (?) line `$$host=1'.

	* configure.in (MAILER): Warn or print an error if not found,
	depending on whether server code is disabled or not.

	* server-src/reporter.c (output_tapeinfo): Report used tapes
	regardless of tape errors.

	* config/acinclude.m4i (CF_WAIT): Simplify the test.  Declare wait()
	in the global scope.

2000-01-21  Garrett Wollman  <wollman@khavrinen.lcs.mit.edu>

	* config/acinclude.m4i (CF_WAIT): Avoid warnings on systems
	where `union wait' works but is deprecated.

2000-01-21  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* recover-src/uscan.l (settape): Recognize it.
	* recover-src/uparse.y: Parse it.
	* recover-src/amrecover.h (set_tape): Declare it.
	* recover-src/set_commands.c (set_tape): Implement it.
	* recover-src/help.c (help_list): Document it.
	* man/amrecover.8.in: Likewise.
	* recover-src/extract_list.c (extract_files): Warn if tape device is
	/dev/null.
	* recover-src/amrecover.c (tape_device_name): Default to
	server-determined default.

2000-01-13  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* configure.in: Recognize alpha*-*-linux-* and sparc*-*-linux-*.

	* tape-src/Makefile.am (../common-src/libamanda.$(LIB_EXTENSION)):
	Allow for `make tapetype' before libamanda is built.

	* server-src/amoverview.pl.in: Year doesn't take just 2 bytes.

2000-01-06  David Wolfskill  <dhw@whistle.com>

	* docs/TAPETYPES: Typo.
	
2000-01-06  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* docs/TAPETYPES: Removed all tapetype entries.  Pointed to
	example/amanda.conf, to the mailing list archives and to the on-line
	tapetype list.  Explained the meaning of length, filemark and speed,
	and how to build and use the tapetype utility.

1999-12-12 John R. Jackson  <jrj@purdue.edu>

	* configure.in: egrep was having trouble with quoting on some systems.
	Broke it apart into multiple unquoted statements.  Also, changed the
	script to run the steps on all dump tests and added "Label" as another
	line to ignore.

1999-12-12 John R. Jackson  <jrj@purdue.edu>

	* tape-src/tapetype.c: tweak the algorithm to write files in both
	passes and compute the tape mark size as the difference.  Never
	report a negative tape mark size.  Various other minor cleanup.

1999-11-29  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* client-src/sendbackup-gnutar.c (re_table): #if out the debugging
	Samba messages unless SAMBA_VERSION < 2.

1999-11-29  John E.P.Hynes  <john@hytronix.ne.mediaone.net>

	* client-src/sendbackup-gnutar.c (re_table): Update for Samba 2.0.6.

1999-11-25 John R. Jackson  <jrj@purdue.edu>

	* server-src/amflush.c (main): conf_logdir should not be free'd
	  (found by Espen H Wiborg <espenhw@infotek.no>).

1999-11-10 John R. Jackson  <jrj@purdue.edu>

	* recover-src/extract_list.c: report the tape server host in the
	  message to check the amidxtaped.debug file.	If extract_list_child
	  fails (such as when amidxtaped fails to read the tape), ask if
	  things should continue instead of aborting.

1999-11-11  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* server-src/driverio.c (update_info_dumper): Discard information on
	older same- or higher-level dumps.
	* server-src/driver.c (dump_to_tape): Add comment that _dumper must
	be called before _taper.

	* docs/FAQ: Sometimes FQDNs are wrong for amandahosts.

1999-11-10 John R. Jackson  <jrj@purdue.edu>

	* server-src/amindexd.c (build_disk_table): need to clear the old
	  disk history list before building a new one.

1999-11-10 John R. Jackson  <jrj@purdue.edu>

	* server-src/taper.c (label_tape): issue a warning when tapedev is
	  set to /dev/null.
	* server-src/amcheck.c (start_server_check): make warning message
	  text the same for amcheck and taper when tapedev is /dev/null.

1999-11-10 John R. Jackson  <jrj@purdue.edu>

	* server-src/amcleanupdisk.c (main): try to remove empty holding disk
	  areas.
	* server-src/holding.c (scan_holdingdisk): do not automatically remove
	  empty holding disk areas since this function is called by various
	  utilities and a dump might be in progress.

1999-11-10  James FitzGibbon  <james@targetnet.com>

	* server-src/infofile.c (put_info): d.size should have been
	d.dsize.

1999-11-09 John R. Jackson  <jrj@purdue.edu>

	* server-src/amcheck.c (start_server_check): test tapedev for
	  "/dev/null" and issue warning that dumps will be thrown away.

1999-11-02  David M. Olsen  <David.M.Olsen@boeing.com>

	* server-src/amadmin.c (main): Second occurrence of CNF_TAPELIST
	should have been CNF_INFOFILE; fixed.

1999-11-02  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* common-src/amflock.c (struct flock): Do not assume the fields are
	declared in any particular order.
	Reported by Sean Kelly <kelly@plutotech.com>

	* Makefile.am (EXTRA_DIST): Added contrib/set_prod_link.pl.
	* docs/INSTALL: Likewise.

1999-11-02  Ricardo Malta  <rmalta@bigfoot.com>
	
	* contrib/set_prod_link.pl: Create the links for a configuration
	with --with-suffix.

1999-11-02  David M. Olsen  <David.M.Olsen@boeing.com>

	* common-src/rsh-security.c (net_writev): The result of a cast is
	not an lvalue; fixed.

1999-10-26  Nicolas Mayencourt  <Nicolas.Mayencourt@cui.unige.ch>

	* server-src/amtoc.pl.in: Correct a bug for total report.

1999-11-01 John R. Jackson  <jrj@purdue.edu>

	* server-src/amcleanupdisk.c (main): do not free the config name (it
	  was never alloc-d).

1999-10-24  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* common-src/debug.c: Do not assume stderr is a compile-time
	constant.  On glibc 2.2 (RedHat Linux 6.1), it is not.

1999-10-11  Nicolas Mayencourt  <Nicolas.Mayencourt@cui.unige.ch>

	* server-src/amtoc.pl.in: Add new options -i and -t.  Print original
	size, instead of size on tape.

1999-10-07 John R. Jackson  <jrj@purdue.edu>

	* common-src/stream.c (stream_server): remove reference to portrange
	  variable.  Compliments of Randy Dees <rrd@amherst.com>.

1999-10-03 John R. Jackson  <jrj@purdue.edu>

	* server-src/driver.c (main): now that multiple results can come back
	  from taper and dumper without a handshake (e.g. NO-ROOM), we need to
	  process them all rather than just the first one.  Call the new
	  areads_dataready() function to peek and see if more data is ready.
	* common-src/amanda.h: declare areads_dataready().
	* common-src/file.c: define areads_dataready().  Fix some variable
	  types.  Fix a buffer expansion problem.  Add code to the test
	  program to force buffer expansion to be checked out.

1999-10-03 John R. Jackson  <jrj@purdue.edu>

	* common-src/file.c (areads_getbuf): fix a buffer allocation problem.

1999-10-03 John R. Jackson  <jrj@purdue.edu>

	* common-src/amflock.c (main): do not use aclose() in the configure
	  test case.  During configure we do not have areads_relbuf()
	  available and it makes configure think all the tests have failed.

1999-10-03 John R. Jackson  <jrj@purdue.edu>

	* common-src/amanda.h: protect the close macros and areads* from
	  out of range file descriptors.
	* common-src/file.c: ditto.

1999-10-02 John R. Jackson  <jrj@purdue.edu>

	* server-src/amindexd.c (build_disk_table): only "OK" results from
	  find_dump should be considered.

1999-10-02 John R. Jackson  <jrj@purdue.edu>

	* common-src/file.c (areads): when NO-ROOM became advisory and didn't
	  participate in a full handshake, it exposed a problem in areads()
	  where a static buffer was shared among all I/O.  Changed it to use
	  a separate buffer for each file descriptor.  Enhanced the test
	  program to check out the code.
	* common-src/amanda.h: ditto
	* restore-src/amidxtaped.c: minor areads/agets comment typo.
	* server-src/amindexd.c: ditto

1999-10-02 John R. Jackson  <jrj@purdue.edu>

	* server-src/amlogroll.c: fix minor memory leak.

1999-09-29 John R. Jackson  <jrj@purdue.edu>

	* server-src/dumper.c (do_dump): closed the dump messages file too
	  soon.

1999-09-23  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* recover-src/extract_list.c (samba_extract_method): Default to
	SAMBA_TAR, for similarity with other restore programs.
	(extract_files_child): If restore with SMBCLIENT is enabled, explain
	that Samba shares will be restored to the SMB share.

1999-09-22 John R. Jackson  <jrj@purdue.edu>

	* configure.in: wrong variable when processing LIBRARY_DIRS.  Fix
	  compliments of John M. Vogtle <jmvogtle@kodak.com>.

1999-09-20 John R. Jackson  <jrj@purdue.edu>

	* server-src/Makefile.am: use new amlogroll utility to rename the log
	  file to the datestamped name.
	* server-src/amcheck.c: ditto.
	* server-src/amcleanup.sh.in: ditto and call all utilities with the
	  config file name as an argument.
	* server-src/amdump.sh.in: ditto and call all utilities with the
	  config file name as an argument.
	* server-src/amflush.c: ditto.
	* server-src/amlogroll.c: new utility.
	* server-src/driverio.c: ditto and call all utilities with the
	  config file name as an argument.
	* server-src/reporter.c: ditto.

1999-09-20  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* amlogroll.c: It was missing; copied from the 2.4.2 branch.

	* configure.in (AMANDA_TMPDIR): Added comment for config.h.in.

1999-09-19 John R. Jackson  <jrj@purdue.edu>

	* server-src/amverify.sh.in: this script is important enough it should
	  not depend on having perl installed.  Clean up the AIX "mt status"
	  code.  Test for presense of other restore programs and check that
	  they are executable during processing.

1999-09-19 John R. Jackson  <jrj@purdue.edu>

	* server-src/amverify.sh.in: put back an "mt status" wait loop I
	  erroneously removed, but protect it from AIX.

1999-09-19 John R. Jackson  <jrj@purdue.edu>

	* common-src/util.c: fix math in bind_portrange so ports requested
	  are between those the caller passed and make sure port 0 does not
	  accidentally get requested, which returns a non-privileged port.
	* common-src/dgram.c: bind_portrange last port argument is inclusive.
	* common-src/stream.c: ditto.
	* recover-src/amrecover.c: ditto.
	* recover-src/extract_list.c: ditto.

1999-09-19 John R. Jackson  <jrj@purdue.edu>

	* server-src/driver.c: do not send a FILE_WRITE to the taper when the
	  tape queue is empty during a TRYAGAIN (driver core dumped).

1999-09-19 John R. Jackson  <jrj@purdue.edu>

	* server-src/taper.c: fix protocol problems when out of tape.  Add
	  FAKE_TAPE_ERROR debugging code to simulate tape errors.  Fix problem
	  with command line argument processing.

1999-09-18 John R. Jackson  <jrj@purdue.edu>

	* configure.in: several compress/uncompress variables were not being
	  set properly.

1999-09-18 John R. Jackson  <jrj@purdue.edu>

	* client-src/sendbackup.c: pclose returns a child exit status of the
	  pipe, not an errno, so do not try to strerror it.
	  Have the index child process exit with the pclose exit code.
	  Treat index failures as strange rather than fatal so the dump gets
	  fully processed.  It's more important to have the dump image than
	  to skip it just because indexing had a (possibly unrelated) problem.

1999-09-15 John R. Jackson  <jrj@purdue.edu>

	* server-src/amtoc.pl.in: handle an image failing on one tape and
	  succeeding on the next.

1999-09-15 John R. Jackson  <jrj@purdue.edu>

	* server-src/amstatus.pl.in: generalize the "driver: state" parsing
	  so it can handle current and future information.

1999-09-15 John R. Jackson  <jrj@purdue.edu>

	* common-src/bsd-security.c: if the user field is not present in the
	  .amandahosts file, it should default to the local user, not the
	  remote user.  For our purposes, that is CLIENT_USER, not the user
	  we are running as (although they should be the same).

1999-09-14 John R. Jackson  <jrj@purdue.edu>

	* configure.in: Add --with-tmpdir to ./configure and use it for
	  all Amanda temporary files.  Default --with-dbgdir to --with-tmpdir.
	  Move libexec/getconf to sbin/amgetconf and add an optional
	  config parameter.  Add optional config parameter to several
	  other programs.
	  Add debugging to chg-chio.
	  Call new safe_cd() function in most programs to cd to --with-tmpdir
	  so if they drop core, it goes to a known spot.  Rename existing
	  core files so more than one failure may be tracked.  Remove most
	  chdir() and umask() calls (umask is set in safe_cd).
	* amplot/amplot.sh.in: ditto.
	* changer-src/chg-chio.pl.in: ditto.
	* changer-src/chg-chs.sh.in: ditto.
	* changer-src/chg-manual.sh.in: ditto.
	* changer-src/chg-mtx.sh.in: ditto.
	* changer-src/chg-multi.sh.in: ditto.
	* changer-src/chg-rth.pl.in: ditto.
	* changer-src/chg-scsi-chio.c: ditto.
	* changer-src/chg-scsi.c: ditto.
	* changer-src/chg-zd-mtx.sh.in: ditto.
	* client-src/amandad.c: ditto.
	* client-src/calcsize.c: ditto.
	* client-src/killpgrp.c: ditto.
	* client-src/rundump.c: ditto.
	* client-src/runtar.c: ditto.
	* client-src/selfcheck.c: ditto.
	* client-src/sendbackup-gnutar.c: ditto.
	* client-src/sendbackup.c: ditto.
	* client-src/sendsize.c: ditto.
	* common-src/alloc.c: ditto.
	* common-src/amanda.h: ditto.
	* common-src/amflock.c: ditto.
	* common-src/bsd-security.c: ditto.
	* common-src/debug.c: ditto.
	* common-src/file.c: ditto.
	* common-src/genversion.c: ditto.
	* restore-src/amidxtaped.c: ditto.
	* server-src/Makefile.am: ditto.
	* server-src/amadmin.c: ditto.
	* server-src/amcheck.c: ditto.
	* server-src/amcheckdb.sh.in: ditto.
	* server-src/amcleanup.sh.in: ditto.
	* server-src/amcleanupdisk.c: ditto.
	* server-src/amdump.sh.in: ditto.
	* server-src/amflush.c: ditto.
	* server-src/amfreetapes.sh.in: ditto.
	* server-src/amindex.c: ditto.
	* server-src/amindex.h: ditto.
	* server-src/amindexd.c: ditto.
	* server-src/amlabel.c: ditto.
	* server-src/amrmtape.sh.in: ditto.
	* server-src/amstatus.pl.in: ditto.
	* server-src/amtape.c: ditto.
	* server-src/amtrmidx.c: ditto.
	* server-src/amtrmlog.c: ditto.
	* server-src/amverify.sh.in: ditto.
	* server-src/changer.c: ditto.
	* server-src/changer.h: ditto.
	* server-src/conffile.c: ditto.
	* server-src/conffile.h: ditto.
	* server-src/diskfile.c: ditto.
	* server-src/driver.c: ditto.
	* server-src/driverio.c: ditto.
	* server-src/dumper.c: ditto.
	* server-src/find.c: ditto.
	* server-src/getconf.c: ditto.
	* server-src/holding.c: ditto.
	* server-src/infofile.c: ditto.
	* server-src/logfile.c: ditto.
	* server-src/planner.c: ditto.
	* server-src/reporter.c: ditto.
	* server-src/tapefile.c: ditto.
	* server-src/taper.c: ditto.

1999-09-14  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* common-src/bsd-security.c (bsd_stream): fn should take an ssize_t.
	(bsd_stream_read): Likewise, declaration.
	* common-src/rsh-security.c (rsh_stream): Likewise.
	(rsh_stream_read): Likewise, declaration and definition.
	* common-src/krb4-security.c (dummy): Compile when disabled.
	* common-src/krb5-security.c (dummy): Likewise.

	* server-src/reporter.c (sDivZero): Change from float to double, to
	build with DEC cc.

	* configure.in: Get snapshot date from SNAPSHOT file, if it exists.
	(VERSION): Add the date to it.
	(SNAPSHOT_STAMP): AC_SUBST to the SNAPSHOT file, if it exists.
	* Makefile.am (EXTRA_DIST): Added $(SNAPSHOT_STAMP).
	(config.status): Depend on $(SNAPSHOT_STAMP).
	(SNAPSHOT): Dummy rule to allow reconfigure if it's removed.

	* config/Makefile.am: Remove all traces of acconfig.h.

	* server-src/changer.c (changer_command): Fix for amwait_t != int.

1999-09-13  Alexandre Oliva  <oliva@lsd.ic.unicamp.br>

	* config/acinclude.m4i: Added comments for config/config.h.in to all
	AC_DEFINEs.
	* configure.in: Likewise.
	* config/acconfig.h: Deleted.
	* autogen: Updated.

1999-09-05 John R. Jackson  <jrj@purdue.edu>

	* changer-src/chg-chio.pl.in: add -w to #! line to catch more errors.
	* recover-src/display_commands.c: fix some compiler warnings.
	* recover-src/extract_list.c: fix some compiler warnings.
	* restore-src/amrestore.c: fix some compiler warnings.
	* server-src/planner.c: fix some compiler warnings.

1999-09-05 John R. Jackson  <jrj@purdue.edu>

	* recover-src/extract_list.c: add VRESTORE and VXRESTORE support.

1999-09-05 John R. Jackson  <jrj@purdue.edu>

	* common-src/stream.c: make sure errno is returned properly from
	  stream_client() and stream_server().
	* server-src/taper.c: report errors from stream_server() and
	  abort.
	* recover-src/extract_list.c: make sure errno is preserved.

1999-09-05 John R. Jackson  <jrj@purdue.edu>

	* configure.in: make sure the dump and restore programs are defined
	  in pairs, do not allow just the dump program without restore.
	* client-src/sendbackup-dump.c: assume restore program is present
	  if dump program is.
	* common-src/genversion.c: assume restore program is present if
	  dump program is.

1999-09-05 John R. Jackson  <jrj@purdue.edu>

	* common-src/genversion.c: CLIENT_LOGIN has to be defined so there
	  is no point testing for it.
	* server-src/conffile.c: ditto.

1999-09-05 John R. Jackson  <jrj@purdue.edu>

	* server-src/amverify.sh.in: add SMBCLIENT, VRESTORE, VXRESTORE
	  and XFSRESTORE support.

1999-09-05 John R. Jackson  <jrj@purdue.edu>

	* server-src/conffile.c: add several common abbreviations to config
	  file processing.

1999-09-01 John R. Jackson  <jrj@purdue.edu>

	* server-src/amtoc.pl.in: allow multiple -s entries.

1999-09-01 John R. Jackson  <jrj@purdue.edu>

	* server-src/reporter.c: handle/report a common columnspec syntax
	  error instead of dumping core.

1999-09-01 John R. Jackson  <jrj@purdue.edu>

	* man/amanda.8.in: typo in columnspec description.

1999-09-01 John R. Jackson  <jrj@purdue.edu>

	* common-src/dgram.h: expressions in #define should be protected by
	  parenthesis.

1999-08-25  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* changer-src/chg-chs.sh.in (changerdev): Pass it as -f flag to CHS.
	* docs/TAPE.CHANGERS: Document it.
	Reported by Mike Horansky <moho@stanford.EDU>

	* server-src/conffile.c (read_dumptype): Renamed from get_dumptype.
	Extended to support reading a named dumptype from a specified FILE.
	(get_dumptype): Use read_dumptype.
	(main): Read disklist, so that custom dumptypes are shown.
	* server-src/conffile.h (read_dumptype): Declare.
	* server-src/diskfile.c (parse_diskline): Get line_num and line by
	reference.  New argument diskf.  Use read_dumptype if dumptype
	starts with `{'.
	(main): Update.
	* man/amanda.8.in (disklist): Document it.
	* NEWS: Likewise.
	* example/disklist: Exemplify it.

1999-08-23 John R. Jackson  <jrj@purdue.edu>

	* recover-src/amrecover.c (main): fix test for IPPORT_RESERVED.
	* recover-src/extract_list.c (extract_files_setup): ditto.

1999-08-23 John R. Jackson  <jrj@purdue.edu>

	* server-src/reporter.c (copy_template_file): make sure all data is
	  written to label template pipeline.

1999-08-16  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* common-src/Makefile.am: Replace .o with OBJEXT.  List sources
	explicitly, instead of LDADDing the corresponding objects.
	(OBJ_EXTENSION): Wipe out, use OBJEXT.

	* configure.in: Call AC_OBJEXT.
	(LTLIBOBJS, LTALLOCA): Define, according to ac_objext.
	* common-src/Makefile.am (libamanda_la_LIBADD): Use them.
	(libamanda_a_LIBADD): Use LIBOBJS and ALLOCA.

	* common-src/Makefile.am (genversion.o): Revert last change, it was
	just a bug in automake's --disable-dependency-tracking.

1999-08-15  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* README (platforms): Added OpenBSD.
	Reported by Ian Darwin <ian@sq.com>
	(platforms): Added SunOS 5.7.

1999-08-15  Derek Ney <derek@hipgraphics.com>, Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendsize.c (SAMBA_DEBUG_LEVEL): New macro, "0" for
	Samba >= 2, "3" for older ones.
	(getsize_smbtar): Use `du' if SAMBA_VERSION >= 2, and the
	appropriate SAMBA_DEBUG_LEVEL.

1999-08-15  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* common-src/Makefile.am (genversion.o): Depend on genversion.c
	too.  It seems that IRIX's make doesn't work without it.
	Reported by Brian Cuttler <brian@wadsworth.org>

1999-08-15  Jon LaBadie  <jon@jgcomp.com>
	
	* tape-src/tapetype.c: Speed it up by using larger sections in the
	second pass.

1999-08-15  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* man/amanda.8.in (skip-full, incronly): Document existing bugs.

	* server-src/conffile.c (init_defaults): Default disksize to 0.
	* man/amanda.8.in (holdingdisk use): Document it.
	Reported by Grant Beattie <Grant.Beattie@fulcrum.com.au>

	* server-src/planner.c (setup_estimate): Typo.
	(next_level0): Typo.

	* config/ltconfig, config/ltmain.sh: Update from libtool 1.3.3.

	* example/amanda.conf.in: Clarify holdingdisk::use 0.

	* config/missing: Update from automake 1.4a.

1999-07-04 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* man/amanda.8.in: typo.

1999-06-29  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* man/amrestore.8: Document holding-file usage.

1999-06-25  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* Makefile.am (pkgdata_DATA): Install COPYRIGHTs.
	(EXTRA_DIST): Remove docs/*.
	* docs/Makefile.am: New file.
	(pkgdata_DATA): Install all docs.
	* configure.in: Output docs/Makefile.
	Suggested by Paul L. Lussier <plussier@baynetworks.com>

	* docs/FAQ (selfcheck time-out): NIS services, inetd rebooting,
	keyboard time-out, lsof.

	* server-src/amverify.sh.in (HEADER): Use `sed 1q'  instead of the
	not-that-portable `head -1'.
	Reported by Andrew Lare <lare@eos913c.gsfc.nasa.gov>

1999-06-19  Alexander Zangerl  <az@Austria.EU.net>

	* client-src/sendbackup-dump.c (re_table): Match Solaris vxdump
	output.

1999-06-18 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/dumper.c (read_indexfd): typo

1999-06-18 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/dumper.c (do_dump): Close the indexout fh and wait
	for the completion of the index compress process.
	* server-src/dumper.c (read_mesgfd,read_datafd): Call stop_dump only
	if the index fd is already shut down.
	* server-src/dumper.c (read_indexfd): On EOF, call stop_dump() if both
	the mesg and data fd are shut down.

1999-06-15  Adam Hammer  <hammer@math.purdue.edu>

	* server-src/amverify.sh.in: Wait until device becomes ready after
	rewinding.

1999-06-15  Bjrn Brezger <Bjoern.Brezger@uni-konstanz.de>, Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/calcsize.c (ROUND): Rewrite, it was broken.
	Reported by Erik Lindahl <erik@theophys.kth.se>

1999-06-15  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/conffile.h: Changed all `long's to `int's, as they
	broke get_number et al on 64bit platforms.
	Reported by Erik Lindahl <erik@theophys.kth.se>

	* configure.in (bcopy, bzero): Oops, ICE_CHECK_DECL already checks
	for availability.

	* configure.in (bcopy, bzero): Check whether they're available.
	* common-src/amanda.h (bcopy, bzero): If not, use memmove and
	memset.
	Reported by Grant Beattie <Grant.Beattie@fulcrum.com.au>

	* server-src/amcheck.c (start_server_check): If info file does not
	exist, explain that it is supposed to be created on the next run.

1999-06-08  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/tapefile.c (lookup_last_reusable_tape): Fix order of
	arguments in match() invocation.
	From Anthony Worrall <Anthony.Worrall@reading.ac.uk>

1999-06-08  Mike Grupenhoff <kashmir@munge.com>

	* restore-src/amrestore.c: second arg to restore() is a char *, not
	a string_t.  Adjust prototype accordingly.

1999-06-07  Mike Grupenhoff <kashmir@munge.com>

	* common-src/util.c (bind_portrange): function that attempts
	to bind a network connection to a port in a given range.
	* common-src/util.h: prototype bind_portrange().
	* common-src/dgram.c (bind_reserved): remove, superceeded by
	bind_portrange().
	(dgram_bind): use bind_portrange() instead of bind_reserved(), and
	try user specified ports first, then reserved ports, then regular
	ports.
	* common-src/dgram.h: remove prototype for bind_reserved().
	* common-src/stream.c (stream_server, stream_client): use
	bind_portrange() instead of bind_reserved(), and try user
	specified ports first, then reserved ports, then regular
	ports.
	* recover-src/amrecover.c (main): use bind_portrange() instead
	of bind_reserved(), and verify that the port it gives us is
	a reserved one.
	* recover-src/extract_list.c (extract_files_setup): use
	bind_portrange() instead of bind_reserved(), and verify that
	the port it gives us is a reserved one.

1999-06-07  Mark F. Vlems  <mvlems@vbox.xs4all.nl>

	* server-src/amindexd.c (reply, lreply, fast_lreply): Return code 0
	of printf does not imply an error on some systems (Openstep) even if
	the number of written characters is more than 0.  The weakened error 
	check has no implication for the correct implementations of printf.

1999-06-03  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/driver.c (dump_to_tape): Tell hard from soft
	(retryable) failures in both dumper and taper results, and behave
	accordingly.

	* docs/SYSTEM.NOTES: On Trusted Solaris, the format of inetd.conf is 
	slightly different.
	Reported by Julian Stevens <julian.stevens@baedsl.co.uk>

1999-06-02  Mike Grupenhoff <kashmir@munge.com>

	* common-src/util.c (fullread, fullwrite): versions of
	read()/write() that keep looping until the buffer is
	completely read/written, or an error occurs.
	* common-src/Makefile.am: build util.c/util.h
	* common-src/fileheader.c, common-src/fileheader.h
	(fill_buffer): remove, replaced with fullread()
	* server-src/holding.c: use fullread() instead of fill_buffer().
	* common-src/bsd-security.c, restore-src/amrestore.c,
	server-src/amcheck.c, server-src/driverio.c, server-src/dumper.c,
	server-src/logfile.c, server-src/taper.c: use fullread/fullwrite
	instead of doing the retry loops manually.

1999-06-02  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (read_mesgfd, read_datafd): upon EOF,
	close the stream.  If the other stream is also closed, shut
	down.

1999-06-02  Mike Grupenhoff <kashmir@munge.com>

	* client-src/amandad.c (REP_TIMEOUT): bump up to six hours, for slow
	machines.
	(exit_check): remove waitpid(), let the service reap its own
	children.
	(s_repwait): rename 'err' to 'errstr' to avoid conflict with
	function in some libcs.
	(s_ackwait): if no pipes were opened by this service, then shut
	it down here.
	(process_netfd): on EOF, be sure to also close the network
	stream.  Also, if this is the last stream to be closed, shut
	down the service.
	(allocstream): correct a comment
	(service_delete): only close the security handle if it is still
	open.  Reap our children here instead of in exit_check().

1999-06-01  Mike Grupenhoff <kashmir@munge.com>

	* server-src/taper.c (write_buffer): assert properly

1999-06-01  John Williams  <williams@morinda.com>

	* changer-src/scsi-hpux.c (eject_tape): Enable it, it works.

1999-06-01  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/INSTALL: Point to the patches page.  Update version numbers.

	* example/config.site: Document UDPPORTRANGE.

1999-06-01  Jens Persson  <jens.persson@btj.se>

	* configure.in (UDPPORTRANGE): Set from --with-udpportrange.
	* config/acconfig.h: Add UDPPORTRANGE.
	* common-src/dgram.c: Implement it.

1999-05-27  Mike Grupenhoff <kashmir@munge.com>

	* common-src/alloc.c (alloc, debug_alloc, newalloc, debug_newalloc):
	make the size argument a size_t.
	(alloc): if an allocation fails, in the error message print how
	many bytes we tried to alloc.  This helps us determine if the
	alloc call was errant, or we really were out of memory.
	* common-src/amanda.h: update alloc/newalloc prototypes for
	size_t changes.

1999-05-27  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* config/ltconfig, config/ltmain.sh, config/libtool.m4i: Updated
	to libtool 1.3.2 plus a few patches.
	* config/config.guess, config/config.sub: Ditto.

1999-05-26  Mike Grupenhoff <kashmir@munge.com>

	* common-src/protocol.c: retry connection failures three times,
	waiting five seconds between each attempt.  Also, fix a lot
	of untrue comments.

1999-05-26  Mike Grupenhoff <kashmir@munge.com>

	* client-src/amandad.c: add a lot more dbprintfs so we know what's
	going on.
	(service_new): use error() instead of dbprintf(); exit()


1999-05-25  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/FAQ (tar-patch): Mention sparse file problem.

	* recover-src/uscan.l: #undef `ECHO' after #include amanda.h; some
	system header files may define it.
	Reported by Dan Lipofsky <danlip@cyc.com>

	* */Makefile.am: Do not define ACLOCAL_M4, COMPILE or
	AMANDA_CFLAGS.
	* Makefile.am: Create acinclude.m4 in the top-level directory.
	* config/Makefile.am: Create link to acconfig.h in the top-level
	directory.
	* configure.in: Add AMANDA_CFLAGS to CFLAGS.  Set DUMPER_DIR without 
	trying to run it.
	* common-src/Makefile.am: Create genversion.h with #defines, to
	avoid genversion-specific CPPFLAGS.
	* common-src/genversion.c: #include genversion.h

1999-05-24 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amandad.c (state2str): string "s_processrep" is 13
	caracters.

1999-05-24  Mike Grupenhoff <kashmir@munge.com>

	* server-src/amcheck.c (main): if we reap a bogus pid, print
	out the error message we generate, instead of whatever junk
	happens to be in the buffer.

1999-05-24  Mike Grupenhoff <kashmir@munge.com>

	* common-src/bsd-security.c (bsd_stream_read): remove old
	code that was part of something that ended up not happening.
	(stream_read_callback): use ssize_t.

1999-05-24  Mike Grupenhoff <kashmir@munge.com>

	* common-src/event.c (event_register): restructure asserts, and
	for EV_READFD/EV_WRITEFD, assert that the fd is < FD_SETSIZE.

1999-05-24  Mike Grupenhoff <kashmir@munge.com>

	* common-src/queue.h: move the multiple-inclusion #defines
	into application namespace.  #undef each macro before defining
	it, in case the OS has an identical macro.

1999-05-23  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/amindex.h: Keep P macro expression in a single line.
	Reported by Patrick Harrold <patrickh@nasco-inc.com>

	* common-src/Makefile.am (statfs_LDADD): Added alloc.obj.

	* common-src/statfs.c (STATFS_SCALE, sys/statvfs.h): If f_frsize is
	zero, use f_bsize.  It now works with GNU libc 2.1.
	Reported by Heikki Vatiainen <hessu@cs.tut.fi>

1999-05-22 Alex Pilosov <alex@pilosoft.com>

	* server-src/amindexd.c (is_dump_host_valid): sanitize_name(host)
	before doing a stat.
	* server-src/tapefile.c (lookup_nb_tape): init pos to 0.

1999-05-19 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/reporter.c: take the orig size from the SUCCESS line.
	use value from the infofile only the datestamp are equal.
	Write all available value.

1999-05-18  Mike Grupenhoff <kashmir@munge.com>

	* common-src/strerror.c (strerror): restructure so that it doesn't
	need to malloc.

1999-05-17  Mike Grupenhoff <kashmir@munge.com>

	* common-src/genversion.c (prvar): prototype declared it static,
	but actual function was still extern.

1999-05-15 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c (pick_inclevel): check for base_level+1 if
	we don't have estimate for base_level. Needed for FORCE_BUMP.
	* server-src/planner.c (promote_highest_priority_incremental):
	Don't promote if we don't have level 0 estimate. No more need
	to check for skip_full, DS_NOFULL, DS_INCRONLY or FORCE_BUMP.

1999-05-15 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amflush.c: ignore SIGPIPE
	* server-src/driver.c: ignore SIGPIPE
	* server-src/driverio.c (taper_cmd, dumper_cmd): return 0 on error, 
	1 on success.
	* server-src/driverio.h (taper_cmd, dumper_cmd): prototype.

1999-05-14  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c: make prototypes consistent, (putresult):
	make first arg const.

1999-05-14  Mike Grupenhoff <kashmir@munge.com>

	* server-src/conffile.c (getconf_byname): islower takes an int
	for an arg.
	* server-src/diskfile.c (upcase): islower takes an int for an
	arg.
	* server-src/driver.c (update_failed_dump_to_tape): prototype.
	* server-src/holding.c (insert_dirname, scan_holdingdisk):
	prototype and make static, (is_datestr): isdigit takes an int
	for an arg.

1999-05-14  Mike Grupenhoff <kashmir@munge.com>

	* client-src/calcsize.c (basename): make static, prototype, and
	only include if BUILTIN_EXCLUDE_SUPPORT is defined and
	HAVE_BASENAME is not defined.
	* client-src/getfsent.c (dev2rde, samefile): prototype and
	make static.
	* client-src/sendbackup-dump.c, client-src/sendbackup-gnutar.c
	(start_backup, end_backup): prototype.
	* client-src/sendbackup.c (index_closed, save_fd): prototype
	and make static.
	* client-src/versionsuffix.c (main): prototype.
	* common-src/alloc.c (internal_vstralloc): prototype.
	* common-src/file.c (mk1dir): prototype, make static, and make
	first arg const.
	* server-src/amadmin.c (check_dumpuser): prototype.
	* server-src/amflush.c (get_letter_from_user): prototype and make
	static.
	* server-src/amindexd.c: prototype and make static numerous local
	functions.
	* server-src/amlabel.c (main): prototype.
	* server-src/amtrmidx.c (main): prototype.
	* server-src/changer.c (report_bad_resultstr, run_changer_command):
	prototype.
	* server-src/conffile.h: properly prototype getconf_holdingdisks()
	* server-src/driverio.h: properly prototype init_driverio().
	* server-src/find.c (find_compare, parse_taper_datestamp_log):
	prototype.
	* server-src/infofile.c (zero_info, open_txinfofile,
	close_txinfofile, read_txinfofile, write_txinfofile,
	delete_txinfofile): prototype and make static.
	* server-src/planner.c (main, askfor): prototype.

1999-05-14  Mike Grupenhoff <kashmir@munge.com>

	* server-src/server_util.c: include server_util.h for prototypes
	* server-src/tapefile.h: properly prototype lookup_nb_tape()
	* server-src/driverio.c (childstr): make static, make return
	val const.

1999-05-14  Mike Grupenhoff <kashmir@munge.com>

	* server-src/find.h: properly prototype find_log()
	* server-src/amtrmlog.c (main): prototype.  find_log() takes
	no arguments.

1999-05-14  Mike Grupenhoff <kashmir@munge.com>

	* server-src/reporter.c: make all functions and globals
	static.  Prototype all functions, and make them consistent wrt
	K&R.  Place all prototypes together.  Place data type
	declarations before the prototypes that use them.  Remove
	unused sort_by_time().

1999-05-14  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (process_dumpline): clean up the error
	return code
	* server-src/dumper.c (log_msgout): no need to reuse errf global,
	it makes me nervous.  Also, use amfree instead of free.

1999-05-14  Mike Grupenhoff <kashmir@munge.com>

	* common-src/packet.c (pkt_cat): remove a bogus assert - len is
	a size_t, which is unsigned, so it will always be >= 0.

1999-05-14  Mike Grupenhoff <kashmir@munge.com>

	* client-src/amandad.c (action_t): consolidate A_PKTTIMEOUT and
	A_REPTIMEOUT into just A_TIMEOUT.

1999-05-14  Mike Grupenhoff <kashmir@munge.com>

	* common-src/amanda.h, common-src/alloc.c, common-src/event.c,
	common-src/rsh-security.c, server-src/driver.c,
	server-src/dumper.c: (min, max): consolidate all min/max
	definitions into amanda.h

1999-05-14  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/TAPE.CHANGERS (chg-rth): URL for chs is no longer valid.

1999-05-12  Mike Grupenhoff <kashmir@munge.com>

	* common-src/amanda.h, common-src/alloc.c, common-src/file.c:
	const the filename arg to all of the dbmalloc versions of
	alloc and io functions

1999-05-11  Mike Grupenhoff <kashmir@munge.com>

	* common-src/protocol.c (proto_t): don't need prev and next ptrs
	anymore

1999-05-11  Mike Grupenhoff <kashmir@munge.com>

	* common-src/amanda.h, common-src/alloc.c: remove the static
	buffer manager - nothing uses it.  It can be resurrected in
	the future if needed.

1999-05-11  Mike Grupenhoff <kashmir@munge.com>

	* common-src/amanda.h: define stringconcat() macros that
	concatenate two const strings together
	* common-src/versuff.c.in (versionsuffix, version): generate
	data at compile time using stringconcat().
	* common-src/genversion.c: simplify, don't need to alloc anything
	* common-src/Makefile.am (genversion_LDADD): this doesn't need
	alloc.o or error.o anymore

1999-05-11  Mike Grupenhoff <kashmir@munge.com>

	* common-src/security.c (security_handleinit, security_streaminit):
	change default error message "unknown error" to "unknown protocol
	error" or "unknown stream error" to help identify where an
	messageless error was triggered.

1999-05-11  Mike Grupenhoff <kashmir@munge.com>

	* client-src/amandad.c (main): call initgroups(), and also set
	the real gid.

1999-05-10  Mike Grupenhoff <kashmir@munge.com>

	* server-src/driver.c (start_some_dumps): if a dumper is
	constrained, and some dumpers or the taper are active, register
	a EV_WAIT event.
	* server-src/driver.c (handle_taper_result,
	handle_dumper_result):  wakeup constrained dumpers after we
	have freed some resources.

1999-05-10  Mike Grupenhoff <kashmir@munge.com>

	* common-src/fileheader.c, common-src/fileheader.h: rework the
	fileheader parse and format code to remove a lot of duplicated
	code (in the F_DUMPFILE and F_CONT_DUMPFILE cases), consting
	arguments, and simplifying parse code.

1999-05-10  Mike Grupenhoff <kashmir@munge.com>

	* client-src/sendsize.c (getsize_dump): print out the strerror
	if we can't exec killpgrp.

1999-05-10  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (add_msg_data): first two arguments
	to memmove() were backwards.

1999-05-07 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* example/amanda.conf.in: typo

1999-05-07  Mike Grupenhoff <kashmir@munge.com>

	* common-src/alloc.c (safe_env): allow DISPLAY into the
	environment for purify.
	* server-src/holding.c (rename_tmp_holding): if fill_buffer
	returns 0, don't try to parse a nonexistant header.
	* server-src/taper.c (file_reader_side): init datestamp to
	NULL, and don't try to free it if it's still NULL on exit.

1999-05-06  Mike Grupenhoff <kashmir@munge.com>

	* server-src/driver.c (start_some_dumps): sleep_time is an
	offset, not an absolute.  Leave it that way when we return from
	this function.

1999-05-05  Mike Grupenhoff <kashmir@munge.com>

	* server-src/amverify.sh.in (pecho): new function.  Like echo
	but doesn't append newline, and supports \r, etc.  Implemented
	using perl.
	* server-src/amverify.sh.in: use pecho where we used to use echo -n,
	etc.  It's nearly impossible to figure out which echo needs what
	flags and also know if it supports \r.  So we just punt and use
	perl.

1999-05-04  Mike Grupenhoff <kashmir@munge.com>

	* server-src/driver.c: convert to use event handler.
	(some_dumps_in_progress, lookup_dumper): nuke.
	(sleep_time): make a time_t and static.
	(IDLE_NO_DUMPERS): give a lower precedence than IDLE_START_WAIT.
	(start_some_dumps): make this work on one dumper instead of all.
	Call when a dumper is finished and needs more work.
	(handle_idle_wait): callback for dumpers waiting for delayed
	disks to start up.
	* server-src/driverio.c: initialize event handles for dumpers
	and the taper.  Nuke addfd().
	* server-src/driverio.h: add event handles for each dumper, and
	one global one for the taper.  Nuke maxfd and readset globals.

1999-05-04  Mike Grupenhoff <kashmir@munge.com>

	* server-src/driver.c (taper_queuedisk): new function that takes
	a disk_t, and, if the taper is not busy, tells it to write it out,
	or else adds it to the tapeq.  Make use_lffo global static.
	* server-src/driver.c (handle_taper_result, handle_dumper_result):
	call taper_queuedisk() instead of queueing ourself.

1999-04-30  Mike Grupenhoff <kashmir@munge.com>

	* server-src/driver.c: make all local functions static.
	Exposed two prototypes for nonexistant functions
	(diskname2filename, driver_main), and one function (dump_state)
	that was never called.  #if 0 out dump_state.
	Nuke inside_dump_to_tape global - it's value was never used.
	Make pending_aborts global a static local in handle_dumper_result.

1999-04-30  Mike Grupenhoff <kashmir@munge.com>

	* server-src/driverio.h (dumper_t): merge infd and outfd into
	just 'fd'.  Comment the other members of the struct.
	* server-src/driverio.c: infd/outfd -> fd
	* server-src/driver.c (handle_dumper_result): merge some common
	code between the FAILED and TRYAGAIN cases.  Comment the
	ABORT_FINISHED case.  Also infd/outfd -> fd.

1999-04-29 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c (when_overwrite): return a big number (1024)
	if the tape is not reusable.

1999-04-29  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* config/ltconfig, config/ltmain.sh, config/libtool.m4i: Updated
	from libtool 1.3.

1999-04-29  Mike Grupenhoff <kashmir@munge.com>

	* server-src/driver.c (handle_dumper_result): remove FATAL_TRYAGAIN
	case, nothing uses it.
	* server-src/driverio.c, server-src/driverio.h: garbage collect
	FATAL_TRYAGAIN.  static & const cmdstr.

1999-04-28  Mike Grupenhoff <kashmir@munge.com>

	* server-src/diskfile.c (read_diskfile): rework to take a
	disklist_t * as an argument, and return -1 on error, or 0 on
	success.  const the filename argument.  Kill a few globals.
	* server-src/diskfile.c (lookup_host, lookup_disk): const
	arguments
	* server-src/diskfile.h: adjust prototypes for above changes
	* server-src/amadmin.c, server-src/amcheck.c,
	server-src/amcleanupdisk.c, server-src/amflush.c,
	server-src/amindexd.c, server-src/amtrmidx.c,
	server-src/amtrmlog.c, server-src/driver.c,
	server-src/planner.c, server-src/reporter.c: adjust calls to
	read_diskfile() to deal with convention

1999-04-28  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (read_mesgfd, read_indexfd): on EOF, just
	stop reading these streams.  We let EOF on the data stream cause
	the entire dump to be stopped.

1999-04-27  Mike Grupenhoff <kashmir@munge.com>

	* common-src/rsh-security.c (conn_read_callback): cast
	event_wakeup() arg to event_id_t.

1999-04-25  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* common-src/versuff.c.in: Adjust constness to match version.h.

	* docs/SYSTEM.NOTES: Recommend GNU tar for Linux.

1999-04-25 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amdump.sh.in: execute amtrmlog.

1999-04-24 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/sendbackup.c: rename write_tapeheader to info_taperheader
	we already have a write_tapeheader function in dumper.c
	* client-src/sendbackup.h: ditto
	* client-src/sendbackup-dump.c: ditto
	* client-src/sendbackup-gnutar.c: ditto

1999-04-23 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* dumper-src/gnutar.pl.in: add debuging code.
	* server-src/planner.c (getsize): send optionstr() for estimate 
	with a wrapper.
	* client-src/selfcheck.c: init program_is_wrapper to 0.
	* client-src/sendsize.c: implement DUMPER-API, support only
	 estimate-direct.

1999-04-22 John R. Jackson  <jrj@purdue.edu>

	* configure.in: add --with-broken-fsf to use a read() loop instead
	of the fsf ioctl on some broken systems.
	* config/acconfig.h: ditto
	* tape-src/tapeio.c (tapefd_fsf): ditto

1999-04-22  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/SYSTEM.NOTES: Typo
	* docs/SAMBA: Update on samba-largefs patch.
	* docs/FAQ: New FAQ about promotion of full dumps.

1999-04-20  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* tape-src/tapeio.c (tape_open): Retry after EBUSY and EINTR too.
	Comment out test that would set filename to /dev/null.

1999-04-18  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/WISHLIST: Global reformat.  Removed fixed issues.  Added
	auto-flush mode.

1999-04-17 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/server_util.c: use snprintf instead of ap_snprintf.

1999-04-17 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/server_util.c: new file for utility function.
	New function construct_datestamp.
	* server-src/server_util.h: ditto
	* server-src/Makefile.am: link server_util.c with libamserver.
	* amcleanupdisk.c (construct_datestamp): remove function.
	* server-src/driver.c: ditto
	* server-src/dumper.c: ditto
	* server-src/amflush.c: ditto
	* server-src/planner.c: ditto

1999-04-17  Mike Grupenhoff <kashmir@munge.com>

	* common-src/bsd-security.c: this doesn't need queue.h

1999-04-17  Mike Grupenhoff <kashmir@munge.com>

	* common-src/event.c: Insert new events at the head of the eventq,
	not the tail, so we don't loop forever if a newly registered
	event has the same type as the one currently firing.  Noticed
	and diagnosed by Jean-Louis Martineau.
	Use a LIST for the eventq, instead of a TAILQ, since we don't need
	to do tail insertions anymore.
	Make the eventq_* functions take a queue name so we can also use
	them for the handle cache.  Rename eventq_append() to eventq_add().

1999-04-17 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* dumper-src/gnutar.pl.in: add DUMPER_DIR to INC.

1999-04-17 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/selfcheck.c: Implement DUMPER-API.
	* dumper-src/gnutar.pl.in (command_selfcheck): print OK, the function
	is not implemented.
	* dumper-src/generic-dumper.pl.in (parse_options): option are
	separated by ;

1999-04-16  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c: make dumpsize and headersize static.  Rename
	nb_header_block to headersize and also make it static.  headersize
	now counts bytes instead of blocks, just like the other two.
	Use SEEK_SET in an lseek instead of hardcoding 0.

1999-04-16  Mike Grupenhoff <kashmir@munge.com>

	* configure.in: implement --with-cflags to allow turning on
	compiler warnings and optimizations

1999-04-16  Mike Grupenhoff <kashmir@munge.com>

	* common-src/event.c (gethandle, puthandle): new functions that
	keep a cache of handles to reduce calls to malloc/free.

1999-04-16  Mike Grupenhoff <kashmir@munge.com>

	* common-src/alloc.c (dbmalloc_caller_loc): const the file
	arg, use the queue macros to maintain the list.

1999-04-16  Mike Grupenhoff <kashmir@munge.com>

	* common-src/versuff.c.in: const the return str of version()
	and versionsuffix.  Bump copyright to 1999.

1999-04-16  Mike Grupenhoff <kashmir@munge.com>

	* client-src/amandad.c, client-src/amandad.h,
	client-src/sendbackup-dump,c, client-src/sendbackup-gnutar.c,
	client-src/sendbackup.c, common-src/bsd-security.c,
	common-src/dgram,c, common-src/dgram.h, common-src/event.c,
	common-src/event.h, common-src/krb4-security.c,
	common-src/krb5-security.c, common-src/packet.c,
	common-src/packet.h, common-src/protocol.c, common-src/security.c,
	common-src/security.h, server-src/amcheck.c, server-src/conffile.c,
	server-src/conffile.h, server-src/dumper.c:
	update copyright to 1999 on things I've touched this year.

1999-04-16  Mike Grupenhoff <kashmir@munge.com>

	* common-src/amanda.h: remove version_info extern.  Bump
	copyright to 1999
	* common-src/genversion.c: constify version_info.  Emit
	{KRB4,KRB5,RSH}_SECURITY.  Bump copyright.
	* common-src/version.h: const VERSION_COMMENT and version_info.
	const return str and fully prototype versionsuffix() and version()
	prototypes.  Bump copyright.
	* server-src/planner.c (main): iterate through version_info using
	an index instead of a pointer.

1999-04-16  Mike Grupenhoff <kashmir@munge.com>

	* server-src/conffile.c: explicitly give the seen_columnspec global
	an int type instead of letting the compiler default to it.

1999-04-16  Mike Grupenhoff <kashmir@munge.com>

	* common-src/event.h (event_id_t): a new typedef for the
	first arg to event_register.  Should be wide enough to
	reasonably hold an int or a pointer (but it is ok to trunc
	the pointer if necessary).  Update proto for event_register()
	and event_wakeup().
	* common-src/event.c: struct event_handle->data is now an
	event_id_t.
	(event_register, event_wakeup): adjust args for event_id_t)
	(event_register): event_id_t is unsigned, no need to assert
	positivity anymore.
	* common-src/rsh-security.c (rsh_stream_read): cast first arg to
	event_register() to event_id_t.


1999-04-15  Mike Grupenhoff <kashmir@munge.com>

	* common-src/event.c (release): nuke, and inline into event_loop.
	* common-src/event.c (event_loop): flesh out the timeout comment.
	Combone the EV_WAIT and EV_DEAD empty cases in the post-select loop.
	* common-src/event.h: flesh out the event_type_t comment.

1999-04-15  Mike Grupenhoff <kashmir@munge.com>

	* common-src/event.c (fire): inline this with a macro.  Remove
	timestamp arg.  eh->lastfired is now only valid for EV_TIME
	events.  Removes several time() systems from the critical path.
	* common-src/event.c (event_wakeup): have this fire EV_WAIT events
	directly instead of deferring back to the event loop.  Removes the
	sequencing restriction for event_wakeup.

1999-04-15  Mike Grupenhoff <kashmir@munge.com>

	* server-src/planner.c (getsize): put the hosts disks on the waitq
	before sending the request, not after.

1999-04-15  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/UPGRADE: Update URL for archived message.

1999-04-14 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcheck.c (main): should not set real uid to 0.

1999-04-13 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/bsd-security.c (bsd_connect): dgram_bind return the port
	number, we don't need ntohs().

1999-04-12  Mike Grupenhoff <kashmir@munge.com>

	* common-src/dgram.c,common-src/dgram.h: nothing uses dgram_alloc()
	anymore, gc them.

1999-04-12  Mike Grupenhoff <kashmir@munge.com>

	* server-src/amindexd.c: dgram.h not needed

1999-04-12  Mike Grupenhoff <kashmir@munge.com>

	* common-src/event.c: fix a bunch of inaccurate comments.
	* common-src/event.c (event_loop): prune dead events in the
	pre-select pass instead of in the EV_WAIT pass.
	* common-src/event.c (fire): factor out all code that fires
	events into a 'fire' function.
	* common-src/event.c (signal_handler): bounds check the signal
	number against the size of sigtable instead of assuming sigtable
	is NSIG big.

1999-04-10  Mike Grupenhoff <kashmir@munge.com>

	* client-src/amandad.c (allocstream): if security_stream_server()
	fails, dbprintf the error.

1999-04-10  Mike Grupenhoff <kashmir@munge.com>

	* configure.in: implement --with-rsh-security
	* common-src/rsh-security.c: first attempt at using rsh or a rsh-like
	command for dump transport and authentication.  Still has lots
	of "issues"
	* common-src/Makefile.am: build rsh-security.c
	* common-src/security.c: add rsh_security_driver to the drivers array
	* config/acconfig.h: define RSH_SECURITY

1999-04-10  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (runcompress): use the proper end of the pipe
	for writing and reading.  Also, grab errno early on fork error
	before calling close.
	* server-src/dumper.c (sendbackup_response): make sure the client
	at least send us a mesgfd and datafd.

1999-04-10  Mike Grupenhoff <kashmir@munge.com>

	* client-src/amandad.c (main): don't dup stdout to db_fd - it might
	be needed by the security driver
	* client-src/amandad.c (s_ackwait, allocstream,): on error, don't
	attempt to event_release a handle we haven't attached yet.

1999-04-10  Mike Grupenhoff <kashmir@munge.com>

	* ap_snprintf -> snprintf, ap_vsnprintf -> vsnprintf

1999-04-09  Mike Grupenhoff <kashmir@munge.com>

	* client-src/Makefile.am (noinst_HEADERS): add amandad.h

1999-04-09  Mike Grupenhoff <kashmir@munge.com>

	* common-src/Makefile.am (libamanda_la_SOURCES): build
	krb4-security.c

1999-04-09  Mike Grupenhoff <kashmir@munge.com>

	* configure.in: implement --with-dbmalloc=[dir], where dir is
	where the dist is unpacked and built.  This could be improved on,
	because it doesn't handle the case where it's installed.

1999-04-09  Mike Grupenhoff <kashmir@munge.com>

	* client-src/sendbackup.c: security changes:
	remove krb4 code and NAUGHTY_BITS macros.
	(parse_options): don't look for krb4 options
	(main): don't close pipes that were handed to us from amandad.
	Don't open stream directly - just use the pipes given to us.
	* client-src/sendbackup-dump.c, client-src/sendbackup-gnutar.c:
	Remove krb4 code and NAUGHTY_BITS macros.

1999-04-09  Mike Grupenhoff <kashmir@munge.com>

	* client-src/amandad.h: new file describing the pipes between
	amandad and children.
	* client-src/amandad.c: rewrite for security changes.  Can
	now handle multiple requests simultaneously, and has a state
	machine to deal with each active request.
	This handles all network transmissions and authentication.
	Each child process (sendbackup, selfcheck) gets three general
	purpose pipes to amandad which it may allocate for anything.
	amandad relays these pipes to equivalent security_streams.
	Lots of other stuff.
	Finally, NEED_KEYPIPE stuff removed.

1999-04-09  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c: security changes:
	Remove krb4 includes and NAUGHTY_BITS macros.
	Remove no-longer-true comment about DATABUF_SIZE ==
	TAPE_BLOCK_BYTES for krb4
	Remove file descriptor and event handle from streams array.  Add
	a security_stream_t.
	Remove global read buffer.
	(check_options): remove krb4 code.
	(service_ports_init): remove, now handled by individual security
	drivers.
	(main): remove dgram usage.
	(do_dump): remove DUMPER_SOCKET_BUFFERING - now handled in the
	bsd driver.  schedule reads on the streams using
	security_stream_read.
	(read_mesgfd,read_datafd,read_indexfd): adapt to
	security_stream_read callback interface.
	(stop_dump): just call security_stream_close on all non-null
	streams.
	(sendbackup_response): adapt to new protocol layer error return.
	Remove krb4 code.
	(startup_dump): stinky hack to parse the security driver string out of
	the options passed to us from driver.
	Lookup the security driver with said string.
	Remove krb4 code.
	Free request after calling protocol_sendreq().

1999-04-09  Mike Grupenhoff <kashmir@munge.com>

	* server-src/planner.c: security changes:
	(main): Remove dgram usage.  Call protocol_init().  Remove
	krb4 code.
	(getsize): remove krb4 code.  Handle protocol layer api changes.
	Lookup security driver/complain if not found.  Free request
	after calling sendreq.  All hosts get put on the waitq since
	sendreq never returns an error.
	(handle_result): deal with new protocol layer error semantics.
	Remove krb4 code.

1999-04-09  Mike Grupenhoff <kashmir@munge.com>

	* server-src/conffile.c: remove INTERFACE undef hack.  Our
	namespace isn't polluted by krb4 headers anymore, so it's
	unneeded.

1999-04-09  Mike Grupenhoff <kashmir@munge.com>

	* server-src/amcheck.c: security changes:
	(main): ignore SIGPIPE - some security drivers might get it.
	Remove all usages of dgram.
	Make our real uid root and our effective uid amanda so we can
	get back to root later (on most os's :()
	(start_client_checks): remove krb4 bits.
	The dump user check should check the effective uid.
	Get the name of the security driver for this host out of
	host->diskp->security_driver.
	Free req after calling protocol_sendreq() because it will internalize
	it.
	protocol_sendreq doesn't return any errors - they're all returned
	via handle_response.
	(handle_result): renamed from handle_response for consistency.
	The protocol layer doesn't pass us a proto_t anymore, so detect
	errors based on pkt being NULL.
	Remove krb4 bits - security violations will be indicated by a 
	NULL pkt.

1999-04-09  Mike Grupenhoff <kashmir@munge.com>

	* common-src/protocol.[ch]: rewrite for security api.  The entry
	points now have the 'protocol' prefix.  See protocol.h for more
	info.
	* common-src/security.c: rewrite for security api.  This now contains
	the functions for the 'base class' or some approximation of it.
	See security.h for the entry points, or docs/SECURITY-API.

1999-04-09  Mike Grupenhoff <kashmir@munge.com>

	* common-src/amanda.h: rip out krb4 defines, headers, and
	prototypes.  Also, make assert() abort() after calling error().
	* common-src/krb4-security.c: stub file that pulls in the real
	krb4-security out of amanda-krb-2 if KRB4_SECURITY is defined.

1999-04-09  Mike Grupenhoff <kashmir@munge.com>

	* server-src/conffile.h: aggregate all of the compress defines
	(COMP_{NONE,FAST,BEST,...}) into an enum and typedef it to comp_t.
	Make dumptype_t->compress a comp_t.
	* server-src/dumper.c: make srvcompress global a comp_t.
	* server-src/dumper.c (runcompress): add a comp_t third arg
	that specifies the level of compression for this fd.
	* server-src/dumper.c (do_dump): always compress index files
	with COMP_BEST compression, as pointed out by Jean-Louis Martineau.
	* server-src/dumper.c (read_indexfd): read the indexfd, not the
	datafd.  Also noted by Jean-Louis Martineau.

1999-04-09  Mike Grupenhoff <kashmir@munge.com>

	* server-src/planner.c (main): ignore SIGPIPE.  tcp based
	security drivers may get this while getting estimates.
	Set the real uid to root, and the effective uid to the amanda
	user, so we can get back to root later if needed.
	* server-src/planner.c (handle_result): rework error logic
	so we don't need to use p->state, which will eventually go
	away.

1999-04-08  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c: rewrite to use the event handler instead
	of a select loop.  Also, compress the index output using
	runcompress() instead of forking a compress ourselves.

1999-04-08  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (sendbackup_response): don't krb4 authenticate
	streams if krb4_auth if false.

1999-04-08  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (do_dump): some formatting cleanups.  Nuke
	'killerr' - we can do without it.

1999-04-08  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (do_dump): store compresspid inside of
	the databuf

1999-04-08  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (parse_info_line): parse info lines
	from sendbackup directly into the 'file' global.  Eliminate
	the backup_name, recover_cmd, and compress_suffix globals.
	* server-src/dumper.c (finish_tapeheader): nuke usage
	of above globals.  Nuke unneeded explicit nul terminations (we
	memset the whole thing in fn_init).

1999-04-08  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (process_dumpline): rewrite to use strtok
	and const the argument.
	* server-src/dumper.c (make_tapeheader): rename to finish_tapeheader
	and prototype it.  Remove the 'type' arg, since it's always
	F_DUMPFILE.  Remove call to fn_init().
	* server-src/dumper.c (do_dump): call fh_init on 'file' while
	initializing globals.  Call finish_tapeheader after getting info
	endline.

1999-04-07 John R. Jackson  <jrj@purdue.edu>

	* tape-src/tapeio.c: allow tapedev to be /dev/null.
	* server-src/taper.c: allow tapedev to be /dev/null.
	* man/amanda.8.in: allow tapedev to be /dev/null.

1999-04-07  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c: collect got_info_endline, got_sizeline,
	got_endline, and header_done into one bitmask global, and make it
	static.  Also, make 'file' static.

1999-04-06 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/reporter.c (TextRule): Fix to write the full string.

1999-04-06  Mike Grupenhoff <kashmir@munge.com>

	* configure.in: MIT krb5 has libk5crypto, Cygnus kerbnet 1.2
	calls it libcrypto.  Check for both.

1999-04-06  Mike Grupenhoff <kashmir@munge.com>

	* common-src/bsd-security.c (check_user): if an .amandahosts
	file is missing or unreadable, log this fact to the debug file
	instead of claiming that a user doesn't have permission.
	* common-src/bsd-security.c (bsd_stream_client): if
	DUMPER_SOCKET_BUFFERING is defined, set the socket read buffer to
	be twice the size of our read buffer.

1999-04-06  David Mankins <dm@k12-nis-2.bbn.com>

	* common-src/security.c (bsd_security_ok): if an .amandahosts
	file is missing or unreadable, log this fact to the debug file
	instead of claiming that a user doesn't have permission.

1999-04-06  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c: put all of the streams (data,mesg,index)
	into an array with a name tag.
	* server-src/dumper.c (stop_dump): new function that cleans up
	and shuts down all of the streams.
	* server-src/dumper.c (sendbackup_response): make static, pass
	response_error through p->datap instead of making it global.
	Rewrite the parsing to use strtok() and take advantage of the
	streams array instead of repeading code for all three streams.

1999-04-06  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (main): keep our real uid as 0, and make
	our effective uid nonprivlidged, so we can get back to root
	later.  Don't print what port we bound to.  This info won't
	always be available or even applicable.
	* server-src/dumper.c (do_dump): create the stats line with one
	snprintf instead of a huge amount of code.

1999-04-06  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (startup_dump): make static, and const all
	of the string args
	* server-src/dumper.c (do_dump): make static

1999-04-06  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (do_dump): no need to have a separate buffer
	to read the mesgfd - just reuse the one we used for data reads.
	Gets rid of one more global.  Also, we don't need to leave
	space for a NUL anymore.
	* server-src/dumper.c (main): wait for children after closing
	our fds.  Some children may be blocked waiting for EOF on outfd,
	effectively causing deadlock between dumper and child.

1999-04-06  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (add_msg_data): now takes a 'len' arg, and
	doesn't expect the data to be nul terminated.  Also, move
	the buffer from global scope into the function, and have a NULL
	arg flush it out if there is leftover data at the end.  Finally,
	resize the buffer in 256 byte chunks.

1999-04-06  Mike Grupenhoff <kashmir@munge.com>

	* common-src/stream.c, common-src/stream.h (stream_client): add
	yet another arg - if nonzero, do a nonblocking connect
	* server-src/dumper.c: catch up with extra arg to stream_client()

1999-04-06  Mike Grupenhoff <kashmir@munge.com>

	* common-src/bsd-security.c, common-src/security.h: attempt
	to decouple security streams from security handles.  Lots of
	other restructuring.

1999-04-01 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcheck.c: -t should read the tapelist to validate
	the label.

1999-03-30  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* patches/samba-largefs.patch: updated to patch that ended up
	installed in the Samba CVS tree

	* patches/tar-1.12.patch: patch the configure script so that it
	requires autoconf and autoheader to be run; improve the
	printf_long_long test so that it doesn't get false positives because 
	of endianness

	* changer-src/scsi-chio.c: since we do not support FreeBSD 3's
	camlib.h interface, #ifdef out all the code
	Reported by Francis Lam <Francis.Lam@Leitch.com>

	* configure.in (VXSYSLOCPATH): apparently a complex path expression
	gets AC_PATH_PROGS confused; set the path beforehand
	Reported by Francis Lam <Francis.Lam@Leitch.com>

1999-03-28 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/reporter.c: compiler warning.

1999-03-28 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amtrmlog.c: new program to move unused log 
	to logdir/oldlog.
	* server-src/Makefile.am: install amtrmlog.
	* server-src/find.h: declare find_log().
	* server-src/find.c(find_log): new function to return an array of
	all the logfile name that are still needed.
	* server-src/find.c(search_logfile): special case if output_find==NULL,
	return 1 if it the logfile fir the label.

1999-03-25  Neil Crellin  <neil@wallaby.cc>

	* docs/TAPE.CHANGERS (chg-chs): URL for chs

1999-03-25  Alexandre Oliva  <oliva@dcc.unicamp.br>, Tom Schutter  <tom@platte.com>, Cloyce D. Spradling  <cloyce@headgear.org>

	* patches/samba-largefs.patch: updated for Samba 2.0.*

1999-03-25  Charles Owens  <owensc@enc.edu>

	* changer-src/chg-chio.pl.in (changeTape): do not print status to
	both stdout and stderr; this causes failures on FreeBSD

1999-03-23  Mike Grupenhoff <kashmir@munge.com>

	* common-src/stream.c, common-src/stream.h (stream_client):
	const the hostname arg

1999-03-22 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in: AC_SUBST(GNUTAR_LISTED_INCREMENTAL_DIR)
	* dumper-src/gnutar.pl.in: use @GNUTAR_LISTED_INCREMENTAL_DIR@

1999-03-21 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in: default for DUMPER_DIR is $exec_prefix/dumper.
	* Makefile.am: make dumper-src directory
	* dumper-src: directory for program that implement the DUMPER-API.
	* dumper-src/Makefile.am:
	* dumper-src/generic-dumper.pl.in: first draft of a generic wrapper.
	* dumper-src/gnutar.pl.in: first draft of a gnutar wrapper.

1999-03-21  Elmar Bartel  <bartel@Informatik.TU-Muenchen.DE>

	* conffile.h, conffile.c: new columnspec option
	* reporter.c: use it
	* man/amanda.8.in: description and example
	* example/amanda.conf.in: ditto

1999-03-20  Dahn Nilsson <dahn.nilsson@maxlab.lu.se>

	* configure.in: SAMBA_VERSION is not set correctly.

1999-03-17  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendbackup-dump.c (re_table): generalize a bit some of
	the regular expressions, so as to make us more adaptable to future
	minor changes and bugfixes the the output format of some dumps

1999-03-16 Thomas Hepper <th@ant.han.de>
	* changer-src/chg-scsi.c: If the open of the TapeDevice fails
	the programm is not terminated.
	* changer-src/scsi-aix.c: The wrong ident string was checked
	for 0 termination.
	* changer-src/scsi-bsd.c: see scsi-aix.c
	* changer-src/scsi-linux.c: see scsi-aix.c
	* changer-src/scsi-solaris.c: see scsi-aix.c
	* changer-src/scsi-changer-driver.c: Added some more debug prints.
	Wrong fd passwd to LogSense.
	* docs/TAPE.CHANGERS: added note about linux and aha1542

1999-03-15  Mike Grupenhoff <kashmir@munge.com>

	* common-src/packet.h: explicitly list the numeric values for
	the pktype_t enum, so we can use them on the wire

1999-03-15  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* config/ltconfig, config/ltmain.sh: updated from libtool 1.2f
	* config/libtool.m4i, config/config.guess, config/config.sub: ditto
	* configure.in: dropped AC_PROG_RANLIB, as suggested by libtoolize

1999-03-15  Mike Grupenhoff <kashmir@munge.com>

	* common-src/bsd-security.c (recv_security_ok): bring over
	increased verbosity change from common-src/security.c

1999-03-14  Mathias Herberts  <Mathias.Herberts@ago.fr>

	* man/amrecover.8.in: document mode and setmode

1999-03-14  Jon Stevens  <jon@clearink.com>

	* common-src/security.c (bsd_security_ok): increase the verbosity of 
	failed authentication messages

1999-03-14  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in (powerpc-*-linux-*): supported platform
	* README: ditto
	Reported by Jon Stevens <jon@clearink.com>

1999-03-07 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in: new option --with-dumperdir=DIR to specify the 
	directory for the dumpers (dumper api).
	* config/acconfig.h: add def of DUMPER_DIR

1999-03-07 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/conffile.c: accept any string for the program.
	* server-src/amcheck.c: add the keyword DUMPER to the request if 
	the program is not DUMP or GNUTAR.
	* server-src/planner.c: ditto
	* server-src/dumper.c: ditto

1999-03-07 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/dumper.c (startup_dump): rename dumpname to progname.
	the function will use the parameter progname instead of the
	global variable.

1999-03-06  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in (openbsd): according to Ralf Gebhart
	<rgebhart@cybernet-ag.net>, sparc-unknown-openbsd2.3 is supported;
	I assume other openbsd platforms work too.

1999-03-06 Thomas Hepper <th@ant.han.de>

	* client-src/sendbackup-gnutar.c: Replaced #fi with #endif
	* changer-src/: Get in sync with 2.4.2 Version

1999-03-05 Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in: set SAMBA_VERSION
	* client-src/sendbackup-gnutar.c (start_backup): use -q flag
	if SAMBA_VERSION >= 2

1999-03-05 Mathias Herberts <Mathias.Herberts@ago.fr>

	* recover-src/amrecover.h (set_mode, show_mode) declare new functions.
	* recover-src/amrecover.h (SAMBA_SMBCLIENT, SAMBA_TAR) define new 
	constant.
	* recover-src/extract_list.c: declare variable samba_extract_method.
	* recover-src/extract_list.c (extract_files_child): set dumptype
	according to samba_extract_method.
	* recover-src/help.c (help_list): print help for new command mode
	and showmode.
	* recover-src/set_commands.c (set_mode, show_mode): new functions.
	* recover-src/uscan.l:
	* recover-src/uparse.y:

1999-03-05  Mike Grupenhoff <kashmir@munge.com>

	* common-src/amanda.h: use ssize_t in writev return value
	* common-src/bsd-security.c (bsd_stream_write,bsd_stream_read):
	use ssize_t over int
	* common-src/file.c (areads): use ssize_t to hold read() return val
	* common-src/fileheader.c (fill_buffer): usse ssize_t to hold read()
	return val
	* common-src/security.h: stream_read's callback now takes a ssize_t
	as the third argument.
	* common-src/writev.c (writev): return a ssize_t

1999-03-05  Mike Grupenhoff <kashmir@munge.com>

	* configure.in: check for ssize_t, make it int if not present
	* config/acconfig.h: add def for ssize_t

1999-03-05  Mike Grupenhoff <kashmir@munge.com>

	* common-src/base64.c (base64encode): don't cast away a const
	needlessly.

1999-03-04  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/bsd-security.c (stream_read_callback): change n to int
	since ssize_t doesn't exist on all OS.

1999-03-03  Ralf Fassel <ralf@akutech.de>

	* common-src/conffile.h: bit field of length 1 should be unsigned int,
	not int.

1999-03-03  Ralf Fassel <ralf@akutech.de>

	* common-src/bsd-security.c (stream_read_callback): n should be ssize_t.

1999-03-03  Ralf Fassel <ralf@akutech.de>

	* changer-src/scsi-changer-driver.c (CloseDevice): wrong assignment.

1999-03-03  Ralf Fassel <ralf@akutech.de>

	* common-src/base64.c (base64encode): remove warning from sgi cc
	compiler.

1999-03-03  Mike Grupenhoff <kashmir@munge.com>

	* common-src/bsd-security.c: use EV_WAIT events instead of
	maintaining a queue of listeners.  Refcnt the dgram read event
	handle.

1999-03-01  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.h: new parameter level to update_info_taper().
	* server-src/driverio.c (update_info_taper): use parameter instead
	of sched(dp)->level.
	* server-src/driver.c: call update_info_taper with level parameter.
	* server-src/amflush.c: call update_info_taper with level parameter.
	no longer need to create a sched_t struct.

1999-03-01  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.h: remove declaration of inparallel, cmdstr()
	and childstr(), declare init_driverio(), add inparallel parameter
	to startup_dump_processes().
	* server-src/driverio.c (init_driverio): new function to initialize
	dmptable and taper.
	* server-src/driverio.c (childstr): scan for all dumpers (MAX_DUMPERS)
	instead of only inparallel
	* server-src/driverio.c (startup_dump_processes): new parameter
	inparallel is used instead of global variable.
	* server-src/driver.c (main): call init_driverio.
	* server-src/driver.c (main): call startup_dump_processes with 
	inparallel parameter.
	* server-src/amflush.c (main): call init_driverio.

1999-03-01  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amrmtape.sh.in: work with "last_level" and
	"consecutive_runs" in the ouput of "amadmin export".

1999-03-01  Mike Grupenhoff <kashmir@munge.com>

	* common-src/security.h: implement security_connect callback and
	security_status_t changes

1999-03-01  Mike Grupenhoff <kashmir@munge.com>

	* common-src/bsd-security.c (bsd_connect): properly munge the uids
	to get a reserved port
	* common-src/bsd-security.c: adapt to the security_connect
	callback changes
	* common-src/bsd-security.c (bsd_sendpkt): dgram_cat is varargs now,
	so skip the vstralloc

1999-03-01  Mike Grupenhoff <kashmir@munge.com>

	* common-src/event.c: implement EV_WAIT events.  Implement macros
	for adding/removing/traversing the event queue
	* common-src/event.h: define EV_WAIT, and prototype event_wakeup()

1999-02-28  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/WISHLIST: protocol between the driver and dumpers.

1999-02-28  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amtoc.pl.in: output the datestamp of each dump, because
	amflush can flush the same disk multiple date.

1999-02-26  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/holding.h: declare struct holding_t.  Remove 
	declaration of insert_dirname, scan_holdingdisk.  Declare 
	new function free_holding_list.  pick_datestamp and 
	pick_all_datestamp now return (holding_t *).
	* server-src/holding.c (insert_dirname): new parameter holding_list
	where we add the name. Can add more than MAX_DIRS name.
	* server-src/holding.c (free_holding_list): new function to free
	a holding list.
	* server-src/holding.c (scan_holdingdisk): new parameter holding_list.
	* server-src/holding.c (pick_all_datestamp, pick_datestamp): return
	a list instead of a (char **).
	* server-src/find.c (search_holding_disk): use the list return by
	pick_all_datestamp.
	* server-src/amflush.c: use the list return by pick_datestamp.
	* server-src/amcleanupdisk.c (check_disks): use the list return by
	pick_all_datestamp.

1999-02-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.c (addfd): bug fixe.

1999-02-22  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendbackup-gnutar.c: new regexp for SAMBA
	Reported by Grzegorz Mucha <grzegorz.mucha@solidex.com.pl>

1999-02-17  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/amtoc.pl.in: minor fixes for multi-tape runs

1999-02-17  Nicolas Mayencourt  <Nicolas.Mayencourt@cui.unige.ch>

	* server-src/amtoc.pl.in: complete, backward-incompatible rewrite;
	command-line arguments changed
	* man/amtoc.8.in: ditto

1999-02-17  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* changer-src/chg-multi.sh.in: minor portability changes
	* docs/TAPE.CHANGERS: originally by James da Silva

1999-02-17  Jean-Francois Dockes <dockes@cdkit.remcomp.fr>

	* changer-src/chg-multi.sh.in: various portability changes and
	general fixes, particularly for multieject; new cycle mode
	* docs/TAPE.CHANGERS: detailed description of chg-multi
	* example/chg-multi.conf: updated; added reference to
	docs/TAPE.CHANGERS for details

1999-02-16  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.h: remove declaration of addfd.
	* server-src/driverio.c (addfd): 2 new arguments, readset and maxfd,
	don't use global variable.
	* server-src/driverio.c (startup_tape_process, startup_dump_process):
	call addfd with new argument.

1999-02-15  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.c (startup_tape_process): new taper_program
	argument.
	* server-src/driverio.h: remove declaration of taper_program.
	* server-src/driver.c (main): declare taper_program.
	* server-src/driver.c: call startup_tape_process with the new 
	taper_program argument.
	* server-src/amflush.c (run_dumps): declare taper_program.
	* server-src/amflush.c (run_dumps): call startup_tape_process with 
	the new taper_program argument.

1999-02-15  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.c (startup_dump_process, startup_dump_processes):
	new dumper_program argument.
	* server-src/driverio.h: remove declaration of dumper_program.
	* server-src/driver.c: declare dumper_program.
	* server-src/driver.c: call startup_dump_process and
	startup_dump_processes with the new dumper_program argument.

1999-02-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/list_dir.h: remove global variable dir_list, declare
	new function get_dir_list.
	* server-src/list_dir.c (get_dir_list): new function to return dir_list.
	* server-src/amindexd.c (opaque_ls): use get_dir_list.

1999-02-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/holding.h: remove declaration of get_letter_from_user()
	and select_dir().
	* server-src/holding.c: remove function get_letter_from_user() and
	select_dir().
	* server-src/holding.c (pick_datestamp): return empty array instead
	of calling exit if no directory are found.
	* server-src/amflush.c (get_letter_from_user): new function copied
	from holding.c.
	* server-src/amflush.c (confirm): write a message and exit if no
	directory were found.

1999-02-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amflush.c (flush_holdingdisk): don't update the database
	when flushing a partial dump.

1999-02-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/holding.h (get_dumpfile): new function
	* server-src/holding.c (get_dumpfile): new function to fill a 
	dumpfile_t struct from a holding file.

1999-02-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amlabel.c: compiler warning: too many arguments for format

1999-02-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amlabel.c: remove the label from the tapefile in
	case it was already there (-f).

1999-02-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/dumper.c: make sure holding files are not larger
	that chunksize.

1999-02-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcleanupdisk.c: new program to scan and find temporary
	file on holding disks.
	* server-src/Makefile.am (libexec_PROGRAMS): add amcleanupdisk.
	* server-src/amcleanup.sh.in: call amcleanupdisk.

1999-02-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/holding.c (pick_all_datestamp): new function to return
	all datestamp in the holding disks.
	* server-src/holding.h: declare pick_all_datestamp.

1999-02-13  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/diskfile.h (host_t): new start_t field.
	* server-src/diskfile.c (read_diskline): set start_t to 0.
	* server-src/driver.c (start_some_dumps): Don't start a dump if
	the host->start_t > now.
	* server-src/driver.c (start_some_dumps): set host->start_t to 15 sec
	in the future when starting a FILE_DUMP.
	* server-src/driver.c (dump_to_tape): set host->start_t to 15 sec in
	the future when starting a PORT_DUMP.

1999-02-10  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/amlabel.c (main): try to read just-written tape label
	back; if wrendmark overwrote the label, suggest using a
	non-rewinding device
	* tape-src/tapeio.c (tape_wrendmark): would not close tape device if 
	wrendmark failed

1999-02-10  Paul Bijnens  <Paul.Bijnens@lant.be>

	* server-src/amoverview.pl.in: Y2K fix in output to user
	* server-src/amtoc.pl.in (print_info): ditto

1999-02-10  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendsize.c (getsize_dump): do not redirect standard
	output of estimator to /dev/null if we HAVE_DUMP_ESTIMATE

1999-02-03  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* NEWS: fix description of incronly: it won't really perform full
	backups

	* NEWS: support for ufsdump -S, incronly strategy and new chunksize
	default

	* server-src/conffile.c (init_holdingdisk_defaults, chunksize):
	default to 1Gb
	* example/amanda.conf.in: ditto
	* man/amanda.8.in: ditto

	* configure.in (amanda_cv_dump_estimate): check for support for -S
	too, and define HAVE_DUMP_ESTIMATE as the estimate switch, if any
	* client-src/sendsize.c (re_size): new regexps for Solaris ufsdump
	-S and Samba `du'.  Restrict regexp that matched Digital Unix'
	dump -E so that it doesn't match smbclient's output any more.
	Move some regexps around, and only define them if the corresponding
	dump program is available

1999-02-01  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* example/amanda.conf.in: document the behavior of relative
	exclude-list files
	* man/amanda.8.in: ditto

	* man/amanda.8.in (exclude list): the GNU tar flag is
	--exclude-from, not --exclude-list
	Reported by Tom Schutter <tom@platte.com>

	* client-src/sendbackup-gnutar.c (re_table): ignore `session request 
	to' message printed by Samba 2.0.0

1999-01-28  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* man/amanda.8.in (comprate): it is not used when there is history
 	information; useful for large disks that compress little
	Reported by job bogan <job@piquin.uchicago.edu>

	* Makefile.am: select which SUBDIRS to descend to here
	* client-src/Makefile.am: removed if WANT_CLIENT
	* tape-src/Makefile.am: removed if WANT_TAPE
	* server-src/Makefile.am: removed if WANT_SERVER
	* changer-src/Makefile.am: ditto
	* restore-src/Makefile.am: removed if WANT_RESTORE
	* recover-src/Makefile.am: removed if WANT_RECOVER
	* amplot/Makefile.am: removed if WANT_AMPLOT

1999-01-27  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* NEWS: chg-scsi ports, Samba 2.0.0 support and SECURITY API

	* configure.in (USE_AMANDAHOSTS): enable by default
	* example/config.site: ditto
	* docs/INSTALL: ditto
	* NEWS: ditto

	* docs/INSTALL: updated URLs for GNU packages and Samba
	* docs/SAMBA: note that Samba 2.0.0 is supported

	* docs/SYSTEM.NOTES (HP/UX): what does `Link severed' mean?

1999-01-27  Thomas Hepper <th@ant.han.de>
	* changer-src/scsi-changer-driver.c SCSI_ReadElementStatus
	A while loop has to start with while, not if .....

1999-01-27  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* Makefile.am (EXTRA_DIST): sst was added within contrib

	* ltmain.sh, ltconfig, libtool.m4i: updated from libtool CVS
	* configure.in: AC_SUBST LIBTOOL_DEPS
	* Makefile.am: regen libtool if neded

	* Makefile.am: declare that we want automake 1.4 and we're a foreign 
	package

	* configure.in: require autoconf 2.13, and use
	AC_VALIDATE_CACHED_SYSTEM_TUPLE instead of
	AC_VALIDATE_CACHE_SYSTEM_TYPE
	* config/acinclude.m4i: removed AC_VALIDATE_CACHE_SYSTEM_TYPE

	* configure.in (SAMBA_CLIENT): updated check for smbclient to
	support Samba 2.0.0

1999-01-26  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/amdump.sh.in (runuser): set to LOGNAME if defined, and
	to the output of whoami otherwise
	Reported by Tom Schutter <tom@platte.com>

1999-01-26  Thomas Hepper <th@ant.han.de>
	* Makefile.am Added sst driver files to EXTRA_DIST

1999-01-26	Thomas Hepper <th@ant.han.de>	
	* changer-src/Makefile.am added to LDADD 
	../tape-src/libamtape.$(LIB_EXTENSION)
	* changer-src/chg-scsi.c If statfile is not set try to get the info
	about the current loaded tape direct from the changer.
	Fixed debug output for the eject value if > 1
	* changer-src/libscsi.h Prototype for GetCurrentSlot
	* changer-src/scsi-aix.c If the Device we open is not a changer or tape
	return NULL, so that the above function can abort. New eject per mtio ioctl.
	* changer-src/scsi-bsd.c see scsi-aix.c
	* changer-src/scsi-linux.c see scsi-aix.c
	* changer-src/scsi-hpux_new.c see scsi-aix.c
	* changer-src/scsi-irix.c see scsi-aix.c
	* changer-src/scsi-solaris.c see scsi-aix.c and added a retry loop for
	the execution of SCSI commands.
	* changer-src/scsi-changer-driver.c New Function SCSI_ReadElementStatus
	split ReadElementStatus in device and device independed part
	New EXB120ElementStatus, renamed ReadElementStatus in GenericElementStatus
	added EXB 120 and DLT7000 to the devices list.
	Removed the linked list for the element status. Now every element
	type has its own array allocated in the *ElementStatus functions.
	Check in the functions which sends SCSI commands if the fd is able to
	receive SCSI commands.
	In GenericEject check which type of eject to use (ioctl/SCSI)
	New GetCurrentSlot, try to get the info about the loaded tape direct from
	the changer.
	* changer-src/scsi-chio.c Add function GetCurrentSlot (not well tested yet)
	* changer-src/scsi-defs.h Added missing decl. in MediumTransportElementDescriptor_T
	for LITTLE_ENDIAN_BITFIELDS
	new field from in ElementInfo_T
	* changer-src/sci-hpux.c EMpty function GetCurrentSlot, do we still need scsi-hpux.c ?
	* docs/TAPE.CHANGERS added some notes for HP-UX, expanded list of tested devices
	
1999-01-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/conffile.c (init_defaults): default value of runspercycle
	is 0.
	* server-src/amadmin.c (balance): use default value of runspercycle.
	* server-src/planner.c (main): use default value of runspercycle.

1999-01-22  Martin Apel <apel@tecmath.de>

	* example/amanda.conf.in: explanation of incronly strategy.
	* man/amanda.8.in: explanation of incronly strategy.
	* server-src/amadmin.c: recognize incronly strategy
	* server-src/conffile.c: read the incronly strategy in the
	configuration file.
	* server-src/conffile.h: definition of DS_INCRONLY
	* server-src/planner.c: Do planning for incronly strategy:
	If the force flag is set perform a full dump, otherwise do
	normal incremental processing but avoid full dumps.
	* server-src/tapefile.c: Bugfix so only tapes which match
	the regular expression for tape labels in the current 
	configuration are considered for writing.

1999-01-22  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* common-src/bsd-security.c (check_user): there was no uid variable
	here; replace with getuid()

1999-01-22  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/planner.c (output_scheduleline): removed `or historical
	data' from `no estimate' message; historical data doesn't matter any 
	more
	Reported by Giorgos Vlachos <Giorgos.Vlachos@eurodyn.com>

1999-01-20  Todd Pfaff  <pfaff@mcmaster.ca>
	
	* client-src/sendbackup-gnutar.c: more Samba 2.0.0 messages

	* client-src/sendbackup-gnutar.c: new Samba 2.0.0 message 

1999-01-19  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amflush.c: use ap_snprintf instead of snprintf.
	* server-src/amflush.c: rotation of new amflush log was broken.

1999-01-17  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/reporter.c: always call output_stats(), the problem is
	that degraded_mode is set if amflush fills the tape.

1999-01-17  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amflush.c: write debuging info to $logdir/amflush
	instead of /dev/null if we run in background.
	* server-src/amcleanup.sh.in: rename $logdir/amflush.

1999-01-14  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (make_tapeheader): explicitly compare
	srvcompress against srvcomp_none instead of assuming that
	srvcomp_none's value is 0.

1999-01-14  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c: move max() macro to top of file.  Add min()
	* server-src/dumper.c (databuf_write): use min() to determine the
	copy size
	* server-src/dumper.c (databuf_flush): more clearly calculate the
	buffer offset in the write loop

1999-01-14  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (databuf_write): Egads!  Also increment the
	source pointer doing a partial buf copy

1999-01-14  Mike Grupenhoff <kashmir@munge.com>

	* common-src/bsd-security.c (check_user): use getpwnam(CLIENT_LOGIN)
	instead of getpwuid(getuid()), in case our caller has not done
	the setuid().

1999-01-12  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (add_msg_data): properly check for half-sent
	msg lines.

1999-01-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: fix a divide by zero error.

1999-01-11  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (add_msg_data): clarify and comment.  Remove
	'len' arg.  Const 'str' arg.
	* server-src/dumper.c (do_dump): compresspid and indexpid should
	be pid_t's.  Also, remove len from add_msg_data call.

1999-01-11  Mike Grupenhoff <kashmir@munge.com>

	* server-src/fileheader.c (parse_file_header): const the buffer
	argument
	* server-src/fileheader.h: update parse_file_header proto for const
	change

1999-01-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: report the current dump when reporting
	the busy time of each dumper.

1998-12-30  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/dumper.c: open temporary holding file with O_TRUNC flags
	and with mode 0600.

1998-12-28  John R. Jackson  <jrj@purdue.edu>

	* server-src/reporter.c: do not drop core generating labels if the
	tape label is not defined, e.g. in degraded mode (compliments of
	Jan L. Peterson <jlp@Part.NET>).

1998-12-28  John R. Jackson  <jrj@purdue.edu>

	* server-src/amtape.c: initialize two strings to NULL to avoid a
	core dump, compliments of G. Allen Morris III <gam3@acm.org>.

1998-12-27  John R. Jackson  <jrj@purdue.edu>

	* man/amreport.8.in: remove reference to 8.5x11 paper size for the
	3-hole binder.

1998-12-27  John R. Jackson  <jrj@purdue.edu>

	* example/3hole.ps: new lbl-templ file for 3 hole punch reports
	* example/Makefile.am: add 3hole.ps

1998-12-22  Thomas Hepper <th@icem.de>

	* docs/TAPE.CHANGERS Update notes about chg-scsi
	* changer-src/chg-scsi.c Added new config option tapestatus,
	if set the tape log pages are written to this file.
	changed parameter list for get_clean_state/ask_clean,
	* changer-src/libscsi.h changed parameter list for get_clean_state
	* changer-src/scsi-changer-driver.c Added new functions OpenDevice
	CloseDevice LookupDevice. 
	Added new functions to read and decode the Tape LOG Pages.
	Tape Eject and ready check is now done by SCSI calls

	* changer-src/scsi-aix.c
	* changer-src/scsi-bsd.c
	* changer-src/scsi-hpux_new.c
	* changer-src/scsi-hpux.c
	* changer-src/scsi-irix.c
	* changer-src/scsi-solaris.c
	Changed all SCSI_OpenDevice/SCSI_CloseDevice functions so that they
	fit to the new OpenDevice/CloseDevice calls. Removed mtio.h from 
	includes, remove Tape_Ready and Tape_Eject
	* changer-src/scsi-chio.c
	* changer-src/scsi-defs.h

	For all changer-src files, removed tabs, run indent (from xemacs)
 	Added emacs variables to the end (no tab, gnu style)

1998-12-21  John R. Jackson  <jrj@purdue.edu>

	* man/amanda.8.in: document the lbl-templ tapetype option.

1998-12-21  John R. Jackson  <jrj@purdue.edu>

	* man/amreport.8.in: fix formatting problem.

1998-12-20  John R. Jackson  <jrj@purdue.edu>

	* configure.in: define NEED_RESETOFS unless LFS (large file system
	support) is available.
	* config/acconfig.h: add NEED_RESETOFS tag.
	* server-src/taper.c: only reset the tape offset if NEED_RESETOFS
	is defined and only once per 2 GBytes.

1998-12-20  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/amlabel.c (main): datestamp for new tapes is now 0
	* server-src/tapefile.c (reusable_tape): recognize datestamp 0 as
	reusable
	* man/amlabel.8.in: document that tapes are added to tapelist

1998-12-19  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (runcompress): new function.  Given an output
	file descriptor, inserts a gzip/compress in front of that descriptor.
	* server-src/dumper.c (do_dump): if srvcompress is true, insert
	the gzip (using runcompress) in front of the output fd instead
	of the input fd.  Only do this after the tapeheader has been written.

1998-12-19  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (startup_chunker): new function.  When doing
	chunking, fork a piped subprocess that reads in a fileheader and
	a data stream, and writes out the headered, chunked files.  This
	allows us to treat unchunked, chunked, and port-dump dumps exactly
	the same.
	* server-src/dumper.c (main): file-dump: if chunksize > 0,
	call startup_chunker for our outfd.  Otherwise, open the
	holding file directly.

1998-12-19  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (struct databuf): add a chunk_size member,
	the size of each chunk.  Remove chunksize global.
	* server-src/dumper.c (main): add a chunksize local var
	* server-src/dumper.c (databuf_init): init the chunk_size member
	with the same value as split_size
	* server-src/dumper.c (databuf_flush): increment db->split_size
	by the amount in db->chunk_size instead of the global chunksize

1998-12-19  John R. Jackson  <jrj@purdue.edu>

	* server-src/amstatus.pl.in: instead of just displaying why no
	dumpers were busy, display reason(s) why N+1 were not busy.

1998-12-18  John R. Jackson  <jrj@purdue.edu>

	* server-src/amstatus.pl.in: add statistics about how much time
	taper and each dumper is busy, how much time N dumpers are busy
	and why no dumpers were busy.

1998-12-18  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (struct databuf): add 'filename', 'filename_seq',
	and 'split_size' members to replace the equivalent globals.  Nuke
	those globals.
	* server-src/dumper.c (databuf_init): add 'filename' and 'split_size'
	args to init those members.  Init filename_seq to 0.
	* server-src/dumper.c (main): declare and init the databuf here
	* server-src/dumper.c (databuf_flush): refer to split_size, filename,
	and filename_seq in the databuf instead of the globals.
	* server-src/dumper.c (do_dump): now takes a databuf instead of an
	output file descriptor.

1998-12-18  John R. Jackson  <jrj@purdue.edu>

	* server-src/amstatus.pl.in: fix two perl warnings.

1998-12-18  John R. Jackson  <jrj@purdue.edu>

	* server-src/amstatus.pl.in: fix two minor typos.  Add percentage
	display to the summary comparing real and estimated size and real
	versus total estimate (showing how well the estimates are doing and
	a rough guess at how far along the run is).  Also the percentage of
	total holding disk space in use.

1998-12-18  John R. Jackson  <jrj@purdue.edu>

	* server-src/amstatus.pl.in: take the --file argument as is if it
	is an absolute path.

1998-12-18  John R. Jackson  <jrj@purdue.edu>

	* server-src/driver.c: call short_dump_state() one last time before
	quitting so amstatus gets a last good status.  Tell taper to quit
	after the dumpers since it writes more information to the amdump
	file (helps prevent mixed messages).

1998-12-17  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (databuf_flush): return 0 on success

1998-12-17  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (databuf_flush): new function.  Writes
	the contents of the databuf out to its backing file, doing splitting
	if necessary
	* server-src/dumper.c (databuf_write): call databuf_flush when the
	databuf fills up.  Fully complete all writes (no short writes)
	* server-src/dumper.c (do_dump): databuf_write now guarantees complete
	writes, so remove retry loop.  Call databuf_flush() when eof is hit.
	Do not close datafd on eof, because our caller (main) passed it to
	us and therefore owns it (and main does close it again).

1998-12-17  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (databuf_init): new function, initializes
	a struct databuf.
	* server-src/dumper.c (update_dataptr): rename to databuf_write,
	and have it take a buffer and a size, and return how many bytes
	of the buffer were written
	* server-src/dumper.c (do_dump): use databuf_init to initialize db.
	Use databuf_write to add incomign data to the databuf.
	Make size1 and size2 local to the blocks they are used in.

1998-12-17  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* common-src/Makefile.am (noinst_DATA): removed; bogus
	* config/config.guess, config/config.sub: config/install-sh,
	config/mkinstalldirs: updated to current pre-2.13 autoconf CVS tree
	* patches/autoreconf.patch: removed
	* config/libtool/libtool.m4: renamed to config/libtool.m4i
	* config/acinclude.m4: renamed to config/acinclude.m4i
	* config/Makefile.am (EXTRA_DIST): updated to reflect changes
	* autogen: build config/acinclude.m4  by concatenating acinclude.m4i
	and libtool.m4i
	* configure.in: no longer test whether libtool is installed; require 
	newer autoconf
	* config/ltconfig, config/ltmain.sh, config/libtool.m4i: updated to
	libtool 1.2d
	* amplot/Makefile.am (EXTRA_DIST): no longer needed
	* changer-src/Makefile.am (chg_scsi_SOURCE): move scsi-defs.h closer 
	to the beginning of the list
	* docs/INSTALL: fixed URL to gnuplot; recommend autoconf and
	automake from CVS

1998-12-14  Mike Grupenhoff <kashmir@munge.com>

	* common-src/genversion.c (main): rip out krb4 defines.  If we
	need this info, each driver will have to do it individually.

1998-12-14  Mike Grupenhoff <kashmir@munge.com>

	* server-src/conffile.c: remove KRB4_AUTH, BSD_AUTH tokens, auth
	element from dumptype_t, and get_auth() lookup func.  Add
	security_driver to dumptype_t and parse value of AUTH keyword
	as a string.
	* server-src/conffile.h: nuke auth_t.  Remove auth_t auth, int s_auth
	from typetype_t; add char *security_driver, int s_security_driver.
	* server-src/diskfile.c: nuke auth_t auth from disk_t, add
	char *security_driver.  Inherit security_driver from the dumptype_t
	for this disk.
	* server-src/diskfile.h: ditto
	* server-src/amadmin.c (disklist_one): output the security-driver
	string in place of the auth type
	* server-src/amcheck.c (start_client_checks, handle_response):
	enum type hostp->disks->auth is gone.  check the string in the
	security_driver for this disk for krb4 auth.
	* server-src/planner.c (getsize, handle_result): check the string
	in hostp->disks->security_driver for the auth type.

1998-12-14  Mike Grupenhoff <kashmir@munge.com>

	* server-src/amindexd.c: no need to include protocol.h

1998-12-14  Mike Grupenhoff <kashmir@munge.com>

	* server-src/amindexd.c: remove duplication inclusion of version.h.
	Include tapefile.h to get read_tapelist() prototype
	* server-src/amindexd.c (build_disk_table): remove a plethora of
	unused local vars
	* server-src/amindexd.c (main): rename security_ok() call to
	check_security(), and define check_security() locally.  security_ok
	will disappear when the new security api goes in

1998-12-14  Mike Grupenhoff <kashmir@munge.com>

	* server-src/changer.c (changer_label): make it return void
	to keep gcc warning about control reaching the end of a nonvoid
	function.
	* server-src/changer.c: update changer_label's proto for previous

1998-12-14  Mike Grupenhoff <kashmir@munge.com>

	* common-src/amanda.h: define SET, CLR, ISSET macros for dealing
	with bitmasks
	* server-src/amadmin.c: use the bitmask macros for setting
	and clearing the bits in the infofile command word
	* server-src/planner.c: ditto.  This fixes a bug in the code that
	tried to clear FORCE_FULL with an xor expression that was
	never assigned (x ^ FORCE_FULL)

1998-12-14  Mike Grupenhoff <kashmir@munge.com>

	* common-src/bsd-security.c (bsd_sendpkt): cast uid's to long and
	use %ld to print them.

1998-12-14  Mike Grupenhoff <kashmir@munge.com>

	* common-src/dgram.h: mark dgram_cat with gcc's printf attribute
	* common-src/packet.h: ditto for pkt_cat
	* common-src/security.h: likewise for security_seterror

1998-12-14  Mike Grupenhoff <kashmir@munge.com>

	* common-src/error.c (error): const the format arg
	* common-src/amanda.h: mark error with gcc's noreturn attribute, and
	const its format arg

1998-12-14  Mike Grupenhoff <kashmir@munge.com>

	* common-src/debug.c (debug_printf): const the format arg
	* common-src/amanda.h: const debug_printf's format arg

1998-12-14  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in (BSD SCSI): test ... -a ... is not portable, and less 
	so when written test ... -a test ... :-)

1998-12-14  Thomas Hepper <th@icem.de>

	* changer-src/Makefile.am Added scsi-bsd.c
	* changer-src/chg-scsi.c Initialize *scsitapedevice
	* changer-src/scsi-changer-driver.c remove LITTLE_ENDIAN_BITFILEDS
	defenition
	changed RequestSense to pRequestSense (there is a function 
	called RequestSense)
	changed error handling in ResetStatus (fix for IRIX)
	FIxed length handling for the pages in ReadElemtStatus
	* changer-src/scsi-chio.c get_clean_state only returns 0, the
	ioctl to get the clean flag is not portable ;-(
	changed all (f)printf to dbprintf

	* changer-src/scsi-defs.h ElementStatusData_T is for BIG and
	LITTLE endian the same ...

	* changer-src/scsi-bsd.c New file for FreeBSD

	* changer-src/scsi-irix.c Clean up in the return handling
	changed RequestSense to pRequestSense
	Removed unused function TapeStatus

	* changer-src/scsi-linux.c changed RequestSense to pRequestSense
	Removed unused function TapeStatus

	* changer-src/scsi-solaris.c changed RequestSense to pRequestSense
	Removed unused function TapeStatus

	* config/acconfig.h added def for BSD_LIKE_SCSI

	* configure.in Added check for ENDIAN type AC_C_BIGENDIAN
	added sys/scsiio.h and check for BSD SCSI interface

1998-12-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (handle_dumper_result): rename .tmp files
	when receiving ABORT_FINISHED.

1998-12-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (start_some_dumps): Use the holdp returned
	by find_diskspace for a big_dumper in degraded mode.

1998-12-11  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/SYSTEM.NOTES (Ultrix): recommend gcc or egcs
	(IRIX): patch for xfsdump estimates

1998-12-10  John R. Jackson  <jrj@purdue.edu>

	* common-src/amflock.c (main): remove call set_pname() for
	CONFIGURE_TEST since error.o is not linked in.

1998-12-10  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (struct databuf): add a fd member - the file
	descriptor that we are buffering
	* server-src/dumper.c (update_dataptr): remove
	outf arguments, use the fd in the passed databuf.  Return 0 on
	success, and -1 on error.
	* server-src/dumper.c (update_dataptr): rework and comment the
	chunk code a bit.  Get rid of the cont_filename global.
	* server-src/dumper.c (do_dump): init the fd member of the databuf
	* server-src/dumper.c (write_dataptr): fold back into update_dataptr

1998-12-10  John R. Jackson  <jrj@purdue.edu>

	* common-src/amflock.c (main): report CONFIGURE_TEST error messages to
	stderr.

1998-12-10  John R. Jackson  <jrj@purdue.edu>

	* common-src/amflock.c (main): call set_pname() for CONFIGURE_TEST.
	* configure.in: do not set up pname global for lnlock CONFIGURE_TEST.

1998-12-10  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (update_dataptr): remove pointless backups
	of the databuf and associated vars when creating next chunk.
	Remove duplicate setting of file.cont_filename.

1998-12-10  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (main): reuse outfd to clear the open files
	passed to us.  Nuke the fd var.
	* server-src/dumper.c (update_dataptr): nuke 'split' argument - it
	was always set to 1

1998-12-09  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (write_tapeheader): kill dead code
	* server-src/dumper.c (main): remove useless amfree of datestamp.
	Add missing break to 'default' case in command loop.
	* server-src/dumper.c: kill databuf, spaceleft, and dataptr globals.
	Create a 'struct databuf' that holds all three.
	* server-src/dumper.c (write_dataptr, update_dataptr): make
	these take a 'struct databuf *' as an argument, and have them
	operate on its contents instead of the aforementioned globals
	* server-src/dumper.c (do_dump): declare a 'struct databuf' here.
	Make it static, because it's large.  Use it instead of the
	globals.

1998-12-09  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (main): rework the command loop a bit.
	Consolidate all duplicated error cleanup into one place at the
	end of the loop after each command has been processed.  Exit
	with exit(), not return.

1998-12-09  Mike Grupenhoff <kashmir@munge.com>

	* server-src/dumper.c (main, getcmd, write_dataptr): kill argc and
	argv globals, pass them as arguments to getcmd() via struct cmdargs.
	* server-src/dumper.c (getcmd): make the command lookup table driven.
	* server-src/dumper.c (write_dataptr): restructure the command
	logic a bit to hopefully clarify things.

1998-12-09  Henning P. Schmiedehausen  <henning@tanstaafl.de>

	* client-src/sendbackup.c (parse_options): Added check whether the
 	pathname of the exclude file is relative and if yes, use the
 	mountpoint of the filesystem as anchor.  So you can put your exclude
 	file in the root of the filesystem to backup.
	* client-src/sendsize.c (getsize_gnutar): added the same check as
 	above so sendsize uses the same exclude file.

1998-12-09  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/holding.c (size_holding_files): return size in KB.
	* server-src/driver.c (adjust_diskspace): use KB returned by
	size_holding_files.
	* server-src/driver.c: rename .tmp file
	* server-src/dumper.c: do not rename .tmp file. let the driver do it.

1998-12-09  John R. Jackson  <jrj@purdue.edu>

	* common-src/stream.c (stream_server): do not request a reserved port
	if we are root but PORTRANGE is defined.  Also, clean up the code
	and make sure *portp is -1 on all error returns.

1998-12-08  John R. Jackson  <jrj@purdue.edu>

	* Makefile.am: add the user-contributed area.
	* contrib/README: describe the user-contributed area.
	* contrib/dbbackup.README: README for Oracle database backup system.
	* contrib/dbbackup.ksh: Oracle database backup system wrapper.
	* contrib/dbbackup.sql: Oracle database backup system setup commands.
	* contrib/dbbackup.tcl: Oracle database backup system main body.

1998-12-08  John R. Jackson  <jrj@purdue.edu>

	* amplot/Makefile.am: fix install rule when DESTDIR is non-null,
	compliments of Henning P. Schmiedehausen <hps@tanstaafl.de>.

1998-12-08  John R. Jackson  <jrj@purdue.edu>

	* configure.in: fix reversed code for --with-amrecover, compliments
	of Yar Tikhiy <yar@radio-msu.net>.

1998-12-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* common-src/fileheader.h (dumpfile_t): new is_partial field.
	* common-src/fileheader.c: add codee for new is_partial field.
	* server-src/holding.h (rename_tmp_holding): declare new function.
	* server-src/holding.c (rename_tmp_holding): new function.
	* server-src/dumper.c (do_dump): return 1 if succeded, otherwise 0.
	* server-src/dumper.c (main): open .tmp when dumping to disk, 
	rename .tmp if do_dump return 1.
	* server-src/dumper.c (update_dataptr): open .tmp for new chunk.
	* server-src/amstatus.pl.in (dump_size): return size of .tmp file.

1998-12-07  Mike Grupenhoff <kashmir@munge.com>

	* server-src/amtape.c (main, usage): make command lookup and usage
	table-driven

1998-12-07  Mike Grupenhoff <kashmir@munge.com>

	* server-src/amadmin.c: make command lookup and usage table-driven
	* server-src/amadmin.c (balance, tape, bumpsize): add
	argc/argv arguments to make them like the rest
	* server-src/amadmin.c (show_version): new function, implements
	the version command, so it is done like the other commands
	* server-src/amadmin.c (main): iterate through cmdtab[] when
	looking up the command, instead of a huge if/then/else
	* server-src/amadmin.c (usage): iterate through cmdtab[] when
	displaying usage strings.  Display the "disklist" usage string.

1998-12-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* config/acconfig.h: add "#undef HAVE_WRITEV_DECL".

1998-12-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* NEWS: document new force-bump, force-no-bump and unforce-bump
	command in amadmin.

1998-12-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/holding.c (size_holding_files): new function to
	return the sum of the size of all chunk of an image.
	* server-src/holding.h (size_holding_files): declare.
	* server-src/driver.c (adjust_diskspace): use size_holding_files
	instead of doing a stat of only the first chunk.

1998-12-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c: new force-bump, force-no-bump and unforce-bump
	command.
	* man/amadmin.8.in: document them.

1998-12-05  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/FAQ (large filesystems): fixed reference to results missing
	(results missing): updated to 64Kb UDP packets

1998-12-04  Mike Grupenhoff <kashmir@munge.com>

	* common-src/amanda.h: implement WIFSIGNALED() if not already
	defined
	* server-src/amcheck.c: ream out compat definitions of WEXITSTATUS(),
	WTERMSIG(), and WIFSIGNALED().  These are already handled in amanda.h
	* server-src/changer.c: ditto

1998-12-03  Mike Grupenhoff <kashmir@munge.com>

	* common-src/bsd-security.c (recv_security_ok): only check for
	a reserved port for REQ packets

1998-12-03  Mike Grupenhoff <kashmir@munge.com>

	* common-src/bsd-security.c (recvpkt_callback): only compare
	the sin_addr and sin_port fields in the sockaddr when determining
	what handle an incoming packet belongs to.
	* common-src/bsd-security.c (pkthdr2str): use %s for the handle,
	since it's a string.

1998-12-03  Mike Grupenhoff <kashmir@munge.com>

	* common-src/bsd-security.c (bsd_sendpkt): newline-terminate
	the 'SECURITY USER' line in the packet
	* common-src/bsd-security.c (check_user): fix many bugs
	in the USE_AMANDAHOSTS case

1998-12-03  Mike Grupenhoff <kashmir@munge.com>

	* configure.in: AC_REPLACE_FUNCS(writev)

1998-12-02  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/infofile.h: rename PLANNER_FORCE to FORCE_FULL
	* server-src/planner.c: rename PLANNER_FORCE to FORCE_FULL
	* server-src/amadmin.c: rename PLANNER_FORCE to FORCE_FULL

1998-12-02  Mike Grupenhoff <kashmir@munge.com>

	* config/acconfig.h: add KRB5_SECURITY.  Update comment above
	krb4 define to make clear that they are for krb4

1998-12-02  Mike Grupenhoff <kashmir@munge.com>

	* configure.in: if we're doing krb4 and -lcom_err is there, pull
	it in
	* configure.in: implement --with-krb5-security.

1998-12-02  Mike Grupenhoff <kashmir@munge.com>

	* common-src/dgram.c (dgram_cat): now can take printf-style
	arguments
	* common-src/dgram.g (dgram_cat): update prototype

1998-12-02  Mike Grupenhoff <kashmir@munge.com>

	* common-src/bsd-security.c: wrap entire file in #ifdef BSD_SECURITY
	* common-src/bsd-security.c (bsd_connect): catch up with
	security interface changes - upper layer now allocates our handle
	Also, pass up useful error message about why connects failed
	via the handle we are given
	* common-src/bsd-security.c (gethandle): rename to inithandle,
	since we are now passed the handle's memory.  No need to allocate
	memory or initialize the error msg pointer
	* common-src/bsd-security.c (bsd_close): now an empty function - no
	memory to free
	* common-src/bsd-security.c (recvpkt_callback): allocate the handle
	before calling inithandle() (nee gethandle()).
	* common-src/bsd-security.c (stream_read_callback): put
	strerror(errno) in the handle's error buffer before passing a
	read error up to the caller

1998-12-02  Mike Grupenhoff <kashmir@munge.com>

	* common-src/krb5-security.c: new stub file that pulls in the
	krb5 bits from the amanda-krb-2 tree if KRB5_SECURITY is
	defined

1998-12-02  Mike Grupenhoff <kashmir@munge.com>

	* common-src/base64.{c,h}: new files, implement base64 encoding
	and decoding.  Implementation based on routines in bind, and so
	copyright is held by ISC and IBM (but is BSD-like).

1998-12-02  Mike Grupenhoff <kashmir@munge.com>

	* common-src/security.h: add 'handlesize' to the driver struct, also
	make the connect function pointer return int and take a handle
	argument
	* common-src/security.h (security_connect): addd a 'const char **'
	errmsg argument for returning connect errors

1998-12-01  John R. Jackson  <jrj@purdue.edu>

	* server-src/amcheck.c: make -t mean do the tape checks, add new -l
	option for doing just the local server (non-tape) checks.  Have -w
	turn on -t.  Have -cs (or -sc) do both server and client checks.
	* man/amcheck.8.in: document above changes and clean up some minor
	formatting issues.

1998-12-01  Mike Grupenhoff <kashmir@munge.com>

	* common-src/event.c (release): nuke bogus comment about signal
	handler release
	* common-src/event.c (event_loop): move the reentrancy assert
	after the empty queue check.  Otherwise, calling event_loop()
	with an empty event queue would cause the entry count to get
	out of sync.  Also, on exit, assert that the entry count has
	gone to 0
	* common-src/event.c (event_loop): fix bogus comment about event
	removal

1998-12-01  Mike Grupenhoff <kashmir@munge.com>

	* common-src/arglist.h: implement arglist_function3()

1998-11-30  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (start_some_dumps): In degraded mode,
	a big dumper should do high priority dump before low priority.
	* server-src/driver.c (sort_by_priority_reversed): sort by
	time if priority is equal.

1998-11-28  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/infofile.h: declare FORCE_BUMP and FORCE_NO_BUMP
	as command.
	* server-src/amadmin.c (force_one,unforce_one,info_one): work
	with info.command with bit operator.
	* server-src/planner.c (setup_estimate): work with info.command
	with bit operator, support for FORCE_BUMP and FORCE_NO_BUMP command.

1998-11-27  Thomas Hepper    <th@icem.de>

	* changer-src/scsi-aix.c Some changes in the error handling in
	scsi command execution
	* changer-src/scsi-changer-driver.c More debug prints.
	removed Endian16/Endian24 (replaced with macros)
	* changer-src/scsi-chio.c make get_clean_state work on linux
	* changer-src/scsi-defs.h  added macros for converting from/to
	SCSI CDB MSB type
	* docs/TAPE.CHANGERS add note about AIX and chg-scsi

1998-11-26  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c(export_one): export the last_level and
	consecutive_runs field.
	* server-src/amadmin.c(import_one): import the last_level and
	consecutive_runs field.

1998-11-24  Mike Grupenhoff <kashmir@munge.com>

	* common-src/amanda.h: uhh, every other decl has a leading
	'extern' so writev() should as well

1998-11-24  Mike Grupenhoff <kashmir@munge.com>

	* common-src/amanda.h: if no writev() decl exists, declare one

1998-11-24  Mike Grupenhoff <kashmir@munge.com>

	* configure.in: check for <sys/uio.h>, check for a writev() decl
	in <unistd.h> and/or <sys/uio.h>

1998-11-24  Mike Grupenhoff <kashmir@munge.com>

	* common-src/writev.c (writev): new file, implements writev for
	systems that lack it

1998-11-24  Mike Grupenhoff <kashmir@munge.com>

	* common-src/amanda.h: include <sys/uio.h> if it exists.  Otherwise,
	define struct iovec

1998-11-24  John R. Jackson  <jrj@purdue.edu>

	* server-src/amlabel.c: insist on being run as the dump user (ala
	amlabel) to keep permissions straight.

1998-11-24  John R. Jackson  <jrj@purdue.edu>

	* server-src/amadmin.c: fix minor message format problem.

1998-11-24  John R. Jackson  <jrj@purdue.edu>

	* server-src/amlabel.c: insist on being run as the dump user (ala
	amflush) to keep permissions straight.

1998-11-24  John R. Jackson  <jrj@purdue.edu>

	* server-src/amrmtape.sh.in: insist on being run as the dump user (ala
	amdump) to keep permissions straight.

1998-11-24  John R. Jackson  <jrj@purdue.edu>

	* server-src/amadmin.c: issue a warning for update commands that might
	leave ownership incorrect.

1998-11-24  John R. Jackson  <jrj@purdue.edu>

	* server-src/amcheck.c: add a "-t" option to disable tape tests in the
	server checks.  This lets server checks be done without mounting a
	tape.  Add lots more sanity checks, in particular, ownership and
	permissions of the index area and text format database.  Warn if
	amcheck is not run as the dump user listed in amanda.conf.  Minor
	consistency cleanup in the messages.
	* man/amcheck.8.in: document the changes.

1998-11-24  Mike Grupenhoff <kashmir@munge.com>

	* common-src/dgram.c (dgram_bind): always try to get a reserved
	port, even if KRB4_SECURITY is defined

1998-11-23  Mike Grupenhoff <kashmir@munge.com>

	* common-src/bsd-security.c (struct bsd_handle): change 'int handle'
	to 'char proto_handle[32]' because the remote client might generate
	handles that aren't completely numerical
	* common-src/bsd-security.c (gethandle, str2pkthdr): the 'handle' arg
	is now a string
	* common-src/bsd-security.c (bsd_connect): convert our generated
	handle into a string to pass to gethandle()
	* common-src/bsd-security.c (str2pkthdr): rewrite to parse with
	strtok().  Parse the handle as a string instead of trying to
	convert it into a number

1998-11-20  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/amcleanup.sh.in (logdir/amdump): arrange that it is
	renamed if it exists, even if no log file could be found.

1998-11-20  Mike Grupenhoff <kashmir@munge.com>

	* common-src/bsd-security.c: define STREAM_BUFSIZE to be
	the size of the tcp socket buffers
	* common-src/bsd-security.c (bsd_stream_server, bsd_stream_client):
	adapt to the stream_server() interface changes.  Set socket
	buffers to STREAM_BUFSIZE.

1998-11-20  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* config/ltmain.sh, config/ltconfig, config/libtool/libtool.m4:
	updated to current CVS libtool

1998-11-19  John R. Jackson  <jrj@purdue.edu>

	* server-src/conffile.c (get_holdingdisk, init_holdingdisk_defaults):
	set the default chunksize and the "0" and "-1" special chunksizes
	to 64 KBytes less than the maximum to allow the final read at EOF.
	* server-src/dumper.c (main): leave the chunksize as it is when it
	comes in except to truncate it to a 32 KByte boundary.
	* man/amanda.8.in: add some chunksize comments and clean up a few
	minor odds and ends.

1998-11-19  Mike Grupenhoff <kashmir@munge.com>

	Give amrecover its own security bits.  It has different needs
	and a different protocol than the rest of amanda, so it shouldn't
	try to reuse the security bits
	* recover-src/amrecover.c (get_security): new function, implements
	bsd security
	* recover-src/amrecover.c (main): call get_security()
	* recover-src/amrecover.h: get_security() prototype
	* recover-src/extract_list.c (extract_files_setup): call
	get_security()
	* restore-src/amidxtaped.c (check_security): new function, implements
	* restore-src/amidxtaped.c (main): call check_security()

1998-11-19  Mike Grupenhoff <kashmir@munge.com>

	* common-src/stream.c (stream_server, stream_client): cast 4th
	arg of setsockopt() to (void *) to quash a compiler warning
	under solaris.

1998-11-19  John R. Jackson  <jrj@purdue.edu>

	* recover-src/amrecover.c (main): use set_host to find the initial
	host name so we get the same alias resolution at startup as the
	sethost command.
	* recover-src/set_commands.c (set_host): report alternate names being
	attempted and only clear the directory list if a host is found.

1998-11-19  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/driverio.c (update_info_dumper): do not update
	compression or dump rates when called from
	update_failed_dump_to_date
	Reported by Michael Schmitz <mschmitz@sema.de>

1998-11-18  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/dumper.c (main): reduce the size of the chunksize by
	2 blocks.

1998-11-18  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in: hack for paxutils was not working; fixed

1998-11-18  Michael Povel  <mcp@ladyada.han.de>

	* server-src/changer.h added new functions:changer_query
	,changer_search,changer_find, changer_label
	* server-src/changer.c added changer_query, changer_search,
	changer_find, changer_label
	* server-src/amcheck.c (taper_scan) now uses changer_find 
	* server-src/amtape.c (load_label and taper_scan) now use changer_find
	* server-src/taper.c (taper_scan) now uses changer_find
	* server-src/amlabel.c (main) added call to changer_label
	which is only an empty dummy at the moment

1998-11-18  Thomas Hepper <th@icem.de>

	* changer-src/chg-scsi.c Added debug print option
	* changer-src/chg-scsi.c If the load fails do not continue
	* changer-src/scsi-aix.c changed #include <config.h> to <amanda.h>
	* changer-src/scsi-aix.c Added debug prints to SCSI_ExecuteCommand
	* changer-src/scsi-changer-driver.c changed #include <config.h> to 
	#include <amanda.h>
	* changer-src/scsi-changer-driver.c Added debugging prints
	* changer-src/scsi-changer-driver.c Remove unused funktion TestUnitReady
	* changer-src/scsi-chio.c added missing funktion Tape_Ready
	* changer-src/scsi-hpux.c removed #include "config.h", is already done
	in amanda.h
	* changer-src/scsi-hpux_new.c  changed #include <config.h> to 
	#include <amanda.h>
	* changer-src/scsi-irix.c changed #include <config.h> to 
	#include <amanda.h>
	* changer-src/scsi-linux.c changed #include <config.h> to 
	#include <amanda.h>
	* changer-src/scsi-solaris.c changed #include <config.h> to 
	#include <amanda.h>

1998-11-17  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendsize.c: disable HAVE_DUMP_ESTIMATE if SAMBA_CLIENT
	is defined

1998-11-17  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/tapefile.c (lookup_last_reusable_tape): Wrong order
	to shift the tpsave array.

1998-11-17  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* example/amanda.conf.in: document that infofile is supposed to be a
 	directory with the default database format
	* docs/FAQ: New questions: `infofile update failed' and `using the
 	same host in different configurations'

1998-11-17  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	changer-src/scsi-linux.c (Tape_Ready): typo, the argument Device
	to the SCSI_CloseDevice() is not defined, I changed it to tapedev.

1998-11-17  Brendan M Coffey <bcoffey@connix.com>

	* common-src/stream.c (stream_server): add requested send and receive
	socket size parameters.
	* common-src/stream.h (stream_server): ditto
	* server-src/taper.c (file_reader_side): set a large receive socket
	buffer size.
	* client-src/sendbackup.c (main): set a large send and receive socket
	buffer size for the data path, use defaults for the message and index
	paths.

1998-11-16  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* changer-src/scsi-solaris.c (Tape_Ready): typo in Thomas' patch

1998-11-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/infofile.h (get_dumpdate): rename record parameter to info.
	* server-src/infofile.h (get_info): rename record parameter to info.
	* server-src/infofile.h (put_info): rename record parameter to info.
	* server-src/infofile.c (get_dumpdate): rename rec parameter to info.
	* server-src/infofile.c (zero_info): rename ip parameter to info.
	* server-src/infofile.c (get_info): rename record parameter to info.
	* server-src/infofile.c (put_info): rename record parameter to info.
	* server-src/infofile.c (dump_rec): rename r parameter to info.
	* server-src/infofile.c (dump_db): rename record variable to info.
	* server-src/planner.c (last_level): rename ip parameter to info.
	* server-src/planner.c (next_level0): rename ip parameter to info.
	* server-src/planner.c (runs_at): rename ip parameter to info.
	* server-src/planner.c (askfor): rename inf parameter to info.
	* server-src/planner.c (setup_estimate): rename inf variable to info.
	* server-src/driverio.c (update_info_dumper): rename inf parameter 
	to info.
	* server-src/driverio.c (update_info_taper): rename inf parameter 
	to info.
	* server-src/amadmin.c (next_level0): rename ip parameter to info.
	* server-src/amadmin.c (force_one): rename inf variable to info.
	* server-src/amadmin.c (unforce_one): rename inf variable to info.
	* server-src/amadmin.c (delete_one): rename inf variable to info.
	* server-src/amadmin.c (info_one): rename inf variable to info.
	* server-src/amadmin.c (due_one): rename inf variable to info.
	* server-src/amadmin.c (balance): rename inf variable to info.

1998-11-11  Thomas Hepper <th@icem.de>

	* configure.in: amanda_cv_hpux_scsi was double defined.
	Replaced it in the chio check with amanda_cv_hpux_scsi_chio
	* docs/TAPE.CHANGERS: update the notes about chg-scsi
	* changer-src/chg-scsi.c: Unload the cleaning tape only
	if it is loaded
	Pass the changerdev and tapedev Tape_Ready, so we can check
	if changerdev=tapedev. In this case the fd is already open.
	* changer-src/scsi-aix.c: cleanup and first parts are running :-)
	* changer-src/scsi-changer-driver.c: Pass back the scsi status
	field to the calling function, not the result from the ioctl
	if the return form the ioctl is >= 0
	* changer-src/scsi-hpux.c: Add additional param to Tape_Ready
	fill Tape_Ready with live 
	* changer-src/scsi-hpux_new.c: Return the scsi status if 
	the ioctl result is >=0. Add new Parameter to Tape_Ready
	* changer-src/scsi-irix.c: same as scsi-hpux_new.c
	* changer-src/scis-linux.c: Add additional param to Tape_Ready
	* changer-src/scsi-solaris.c: same as scsi-hpux_new.c

1998-11-11  Mike Grupenhoff <kashmir@munge.com>

	* server-src/security.h: add driver entry points and macros
	for security_stream_accept() and security_stream_auth()
	* server-src/bsd-security.c: implement security_stream_accept()
	and security_stream_auth() for bsd security

1998-11-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (main): redo my patch about total_disksize that
	Alexendre has undone, only the 2.4.1 branch was broken.

1998-11-10  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/driver.c (main): total_disksize was only added after
	the loop terminated, i.e., when hdp was NULL -> crash.  fixed.

1998-11-09  John R. Jackson  <jrj@purdue.edu>

	* server-src/reporter.c (main): ignore SIGPIPE so if a child process
	dies we do not also go away.  Also fix a core dump if amanda.conf
	cannot be processed, and clean up a few error messages.

1998-11-09  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/infofile.h (struct info_s): add last_level and 
	consecutive_runs.
	* server-src/infofile.c: support new last_level and consecutive_runs
	* server-src/planner.c (last_level): return ip->last_level.
	* server-src/planner.c (runs_at): return ip->consecutive_runs.
	* server-src/driverio.c (update_info_dumper): update inf.last_level
	and inf.consecutive_runs.
	
1998-11-09  Mike Grupenhoff <kashmir@munge.com>

	* client-src/sendbackup-dump.c (start_backup): don't close indexf
	if it was never open
	* client-src/sendbackup-gnutar.c (start_backup): ditto

1998-11-08  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (main): add hdp->disksize to total_disksize
	even when we create the datestamp dir. (reserve was unusable).

1998-11-07  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* Makefile.am (EXTRA_DIST): added EVENT-API, SECURITY-API and
	STRATEGY-API
	* docs/STRATEGY-API: new file

	* configure.in (GNUTAR): accept tar from Free paxutils, the new name
	of GNU tar

1998-11-07  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* changer-src/scsi-solaris.c: added missing #endif

	* configure.in: merge with camlib.h patch from Oct 31
	remove all uses of test ... -a ...; this is not portable.
	(AC_CHECK_HEADERS) added header files for Linux and Solaris

1998-11-07  Thomas Hepper  <th@icem.de>

	* changer-src/chg-scsi: Add config option scsidev
	* changer-src/chg-scsi: Remove function tape_ready
	* changer-src/chg-scsi: Add new parameter tapedev to function
	ask_clean
	* changer_src/scsi-hpux.c: changed HAVE_HPUX_SCSI to 
	HAVE_HPUX_SCSI_CHIO, changed in configure.in too
	* changer-src/libscsi.h: Expand definition for get_clean_state
	* new files in /changer-src:
	scsi-aix.c, scsi-changer-driver.c, scsi-defs.h
	scsi-hpux_new.c, scsi-irix.c, scsi-linux.c, scsi-solaris.c
	* configure.in checks for scsi ioctl added, check for header files
	for the scsi suport added
	* config/acconfig.h new:
	HAVE_HPUX_LIKE_SCSI, HAVE_HPUX_SCSI_CHIO, HAVE_LINUX_LIKE_SCSI
	HAVE_IRIX_LIKE_SCSI, HAVE_SOLARIS_LIKE_SCSI, HAVE_AIX_LIKE_SCSI
	       removed: HAVE_HPUX_SCSI
	* changer-src/Makefile.am: New conditional for building chg-scsi-chio
	and chg-scsi. chg-scsi-chio is the old chg-scsi

1998-11-06  Mike Grupenhoff <kashmir@munge.com>

	* common-src/bsd-security.c (bsd_stream_write): callback's third
	arg should now be an int.
	* common-src/bsd-security.c: quash some gcc -Wall warnings

1998-11-06  Mike Grupenhoff <kashmir@munge.com>

	* common-src/security.h: the callback to stream_read should
	take signed type as its 'length' argument so errors can be
	expressed as a negative number.

1998-11-06  Mike Grupenhoff <kashmir@munge.com>

	* common-src/bsd-security.c (stream_read_callback): do reads into
	a buffer of size TAPE_BLOCK_BYTES, instead of 256, and place the
	buffer in the stream handle instead of on the stack, since it's
	huge

1998-11-05  Mike Grupenhoff <kashmir@munge.com>

	* common-src/event.c (event_loop): Consider error conditions on
	file descriptors as read or write events.  The caller will be
	able to differentiate when they call read or write and it
	fails.

1998-11-05  Mike Grupenhoff <kashmir@munge.com>

	* common-src/event.c (event_loop): print out WHY select failed

1998-11-05  Mike Grupenhoff <kashmir@munge.com>

	* common-src/bsd-security.c: adjust for the recvpkt timeout
	interface changes
	* common-src/bsd-security.c (handleq_remove): add a missing ; after
	an assertion
	* common-src/bsd-security.c (gethandle): initialize the error buffer
	in the security handle, since errors may be set before the handle
	is passed up to the general security layer
	* common-src/bsd-security.c (bsd_recvpkt_cancel): allow it to be
	called several times, or when no recvpkt was scheduled

1998-11-05  Mike Grupenhoff <kashmir@munge.com>

	* common-src/security.h: define security_recvpkt_status_t
	* common-src/security.h: security_driver_t->recvpkt() now
	takes a timeout argument, and its callback takes a
	security_recvpkt_status_t
	* common-src/security.h: adjust the security_recvpkt() macro
	for the above changes

1998-11-05  Mike Grupenhoff <kashmir@munge.com>

	* common-src/event.c (event_loop): assert that we are not firing
	a dead event

1998-11-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/amrecover.c: remove declaration of errstr.

1998-11-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amindexd.c (build_disk_table): call find_dump() instead
	of popen("amadmin <conf> find ...")

1998-11-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/holding.h: rename dir_list to holding_list because
	dir_list is also declared in amflush.c
	* server-src/holding.c: ditto
	* server-src/find.c: ditto

1998-11-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: remove warning.

1998-11-04  Mike Grupenhoff <kashmir@munge.com>

	* common-src/event.c (event_register): delete some improper debug
	code that shouldn't have made it in

1998-11-04  Mike Grupenhoff <kashmir@munge.com>

	* common-src/bsd-security.c: new file: security driver that
	implements "BSD" security.

1998-11-04  Mike Grupenhoff <kashmir@munge.com>

	* common-src/security.h: new file: the security api header

1998-11-04  Mike Grupenhoff <kashmir@munge.com>

	* common-src/event.c: new file: the event handler.  Handles file
	descriptor io, signals, and timed events.
	* common-src/event.h: new file: interface for the event handler.

1998-11-04  Mike Grupenhoff <kashmir@munge.com>

	* common-src/packet.c: new file: description of pkt_t's and routines
	for formatting
	* common-src/packet.h: new file: header for common-src/packet.c

1998-11-04  Mike Grupenhoff <kashmir@munge.com>

	* common-src/queue.h: new file: the 4.4BSD queue macros, with
	additions from NetBSD

1998-11-04  John R. Jackson  <jrj@purdue.edu>

	* server-src/amverify.sh.in: tolerate extra amtape output.

1998-11-04  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in: bumped to 2.5.0

	* server-src/taper.c (read_file): if a new tape cannot be found,
 	report a no-tape error to the log file and exit, just like it does
 	for the first tape

1998-11-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c (pick_inclevel): return base_level even
	when the estimate failed.
	* server-src/planner.c (output_scheduleline): test for degr_size
	instead of degr_level.

1998-11-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c (last_level): update last_date otherwise only
	level 0 or the highest is returned.

1998-11-03  Mike Grupenhoff  <kashmir@munge.com>

	* common-src/alloc.c: const arguments to the stralloc functions
	* common-src/amanda.h: update stralloc prototypes for const
	poisoning

1998-11-03  John R. Jackson  <jrj@purdue.edu>

	* server-src/dumper.c (do_dump): do not report FAILED back to driver
	when it sent us ABORT.  Clean up and send back ABORT-FINISHED.

1998-11-03  John R. Jackson  <jrj@purdue.edu>

	* server-src/driver.c (handle_dumper_result): do not abort a dumper
	that reports NO-ROOM if taper is busy since some holding disk space
	will eventually be released (this code it not used when PORT-DUMP is
	in progress).

1998-11-03  John R. Jackson  <jrj@purdue.edu>

	* server-src/taper.c (write_buffer): calling lseek after every tape
	write is wasteful and makes utilities like lsof less useful.  Only
	reset the offset when the amount written is about to go over 2 GBytes.

1998-11-02  John R. Jackson  <jrj@purdue.edu>

	* server-src/driver.c (main, start_degraded_mode): fix rounding problem
	that made the code think there was a little room for full dumps in
	degraded mode, and fix the code that decides whether to do a full dump
	in degraded mode.

1998-11-02  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amstatus.pl.in: initialize variable to remove warning.

1998-11-02  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/Makefile.am (CLIENT_SCRIPTS): rename to
 	CLIENT_SCRIPTS_OPT, because *_SCRIPTS is interpreted by automake
	* configure.in (CLIENT_SCRIPTS): ditto
	Reported by Thomas Hepper <Thomas.Hepper@icem.de>

	* configure.in (LIBTOOL_M4): no longer defined
	(LIBTOOL_M4_MACRO_DIR): defined assuming CWD is top_srcdir
	* Makefile.am (ACLOCAL_M4_FROM_SRCDIR): relative to srcdir
	(ACLOCAL_M4): defined and created using ACLOCAL_M4_FROM_SRCDIR
	Reported by Thomas Hepper <Thomas.Hepper@icem.de>
	
	* client-src/sendbackup.c (backup_program): rename to
	gnutar_program, that's the name it should have had from the
	beginning
	* client-src/sendbackup-gnutar.c (backup_program): ditto

1998-10-31  Michael Schmitz <mschmitz@iname.com>

	* configure.in: let configure check whether strcasecmp is
 	present
	* common-src/strcasecmp.c: new file which contains a definition
	of strcasecmp
	* common-src/amanda.h: added code to declare strcasecmp in
 	case it's not declared in a standard header

1998-10-31  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in (snprintf): arrange that it is included in the
	distribution automatically
	* common-src/Makefile.am (EXTRA_DIST): removed, not needed

	* changer-src/Makefile.am (libexec_SCRIPTS): would only be enabled
	if WANT_CHG_SCSI

	* configure.in (NO_SCSI_CHANGER_MODE): chg-scsi does not support the
 	new FreeBSD 3.0 chio.h, so disable it if camlib.h is found.
	* docs/SYSTEM.NOTES (FreeBSD 3.0): add a note about this
	(SunOS 4.x): libtool will no longer find incorrect library versions

1998-10-30  John R. Jackson  <jrj@purdue.edu>

	* common-src/security.c (bsd_security_ok): change error message to
	reflect that it is a host name we were looking up rather than an
	address (also makes the two similar messages unique).

1998-10-28  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/SYSTEM.NOTES: Debian 2's dump uses /var/lib/dumpdates 

1998-10-28  John R. Jackson  <jrj@purdue.edu>

	* recover-src/set_commands.c (set_host): if the host given by the user
	does not work, try the canonical name and aliases returned by
	gethostbyname.

1998-10-28  John R. Jackson  <jrj@purdue.edu>

	* configure.in: use "df /" instead of just "df" when trying to find
	the device that has the root file system to avoid things like NFS
	hangs that df sometimes suffers from.

1998-10-27  Mike Grupenhoff <kashmir@munge.com>

	* common-src/stream.c (stream-client): add a 'localport' argument
	in which we can get the port this stream is bound to locally
	* common-src/stream.h (stream-client): update prototype
	* server-src/dumper.c: update stream-client calls

1998-10-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/amandad.c (main): better logging of received packet,
	do not send a P_ACK when the received packet is not a P_REQ.

1998-10-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/amandad.c (main): terminate immediately if started
	by a P_ACK packet without sending a P_NAK packet.

1998-10-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/conffile.h (dtimeout): new keyword 
	* server-src/conffile.c (dtimeout): ditto
	* server-src/dumper.c: use dtimeout instead of READ_TIMEOUT
	* example/amanda.conf.in: document it
	* man/amanda.8.in: ditto
	* NEWS: ditto

1998-10-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/dumper.c (sendbackup_response): a nak error will
	be a TRY-AGAIN instead of a FAILED.

1998-10-26  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amlabel.c: move declaration of vtbl_no, datestr
	and slotcommand to the main function.

1998-10-26  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amlabel.c: remove declaration of pname.

1998-10-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcheckdb.sh.in: modify to match new tapelist file
	format (keyword reuse and no-reuse). Probably no-one use this
	program.

1998-10-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c (handle_dumper_result): Add sleep time
	when a dumper failed, it could be a temporary network problem,
	such as NIS or NFS, better wait a few seconds before retrying.

1998-10-25  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.h: remove declaration of argc et argv.
	* server-src/driverio.h (getresult): add parameters result_argc, 
	result_argv and max_arg.
	* server-src/driverio.c (getresult): use new parameters.
	* server-src/amflush.c (flush_holdingdisk, run_dumps): declare
	and use result_argc and result_argv instead of global variables
	argc and argv.
	* server-src/driver.c (main, handle_taper_result, 
	handle_dumper_result, dump_to_tape): ditto

1998-10-24  John R. Jackson  <jrj@purdue.edu>

	* server-src/amstatus.pl.in: do not be quite so accurate in matching
	the log file lines since messages may be intermixed.  Turn on perl
	-w switch and make first cut at cleaning up warnings.

1998-10-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.h: remove datestamp declaration.
	* server-src/amcheck.c: remove 'extern' to datestamp declaration.
	* server-src/amflush.c: declare datestamp.
	* server-src/amtape.c: remove 'extern' to datestamp declaration.
	* server-src/driver.c: declare datestamp.
	* server-src/dumper.c: remove 'extern' to datestamp declaration.
	* server-src/reporter.c: remove 'extern' to datestamp declaration.

1998-10-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.h: remove declaration of tok.
	* server-src/amflush.c (flush_holdingdisk,run_dumps): declare
	tok locally.
	* server-src/driver.c (main, handle_taper_result, handle_dumper_result,
	dump_to_tape): declare tok locally.

1998-10-23  John R. Jackson  <jrj@purdue.edu>

	* configure.in: disable the -E and -h dump estimate checks if $DUMP
	is not executable.

1998-10-19  John R. Jackson  <jrj@purdue.edu>

	* server-src/amindexd.c (is_config_valid): fix core dump by moving
	amfree of conf_dir later in case it is needed in an error message.

1998-10-16  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/reporter.c: remove declaration of curlinenum,
	curlog, curprog and curstr.

1998-10-16  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amflush.c (main): move declaration of diskqp from
	global to local.

1998-10-16  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcheck.c (main): move declaration of mailout and 
	tempfname from global to local.

1998-10-16  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c (search_logfile): remove declaration

1998-10-15  Mike Grupenhoff <kashmir@munge.com>

	* server-src/amadmin.c (reuse, no-reuse): don't core dump if tape
	label not found

1998-10-15  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/conffile.h: remove declaration of holdingdisks and 
	num_holdingdisks, declare getconf_holdingdisks().
	* server-src/conffile.c: define getconf_holdingdisks(),
	* server-src/holding.c: use getconf_holdingdisks
	* server-src/find.c: ditto
	* server-src/amcheck.c: ditto
	* server-src/amflush.c: ditto
	* server-src/driver.c ditto

1998-10-15  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c: remove verbose and force_parameters
	variables.

1998-10-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/dumper.c: remove declaration of pid.
	* server-src/dumper.c(do_dump): move declaration of runtime, 
	dumptime, compresspid, indexpid and killerr from global to local.

1998-10-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c: remove declaration of total_waiting and
	result_socket.
	* server-src/planner.c(main): move declaration of initial_size from
	global to local.

1998-10-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.h,server-src/driver.c: move declaration
	of big_dumpers, degraded_mode and reserved_space from 
	driverio.h to driver.c

1998-10-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.h (optionstr): remove declaration

1998-10-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* configure.in (SAMBA_CLIENT): fix typo

1998-10-14  John R. Jackson  <jrj@purdue.edu>

	* restore-src/amrestore.c (read_file_header): make a couple of error
	messages clearer that they refer to problems with a header rather
	than the image data.

1998-10-13  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/Makefile.am (libamclient_a_SOURCES): missing since
	clean-up; re-added

1998-10-12  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/INTERNALS (driver and dumper): document <dumpdate> in 
	FILE-DUMP and PORT-DUMP request, document <chunksize> in 
	FILE-DUMP request.

1998-10-12  John R. Jackson  <jrj@purdue.edu>

	* server-src/amtape.c (usage, main, show_device): apply patch from
	Chris Jones <cjones@clydesdale.math.montana.edu> to support "device"
	as an option to return the drive device name as reported by the
	changer.
	* man/amtape.8: document the new "device" option.
	* server-src/amverify.sh.in: use the new amtape "device" option to
	better handle tape changers.  Overhaul for general cleanup and some
	security issues, plus amverify now tries to support non-tar images.
	* man/amverify.8.in: document non-tar image issues.

1998-10-08  John R. Jackson  <jrj@purdue.edu>

	* example/amanda.conf.in: fix runspercycle example and comments

1998-10-08  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in (SAMBA_CLIENT): try to find it by default; minimal
 	checking
	* client-src/Makefile.am (WANT_SAMBA): use automake conditionals to
 	enable findpass.o
	* docs/SAMBA: document that --with-smbclient is no longer required
	to enable SAMBA support
	
	* docs/FAQ: about inconsistencies in active filesystems

1998-10-06  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/DUMPER-API: add `no-record' option to the `backup' command.

1998-10-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/DUMPER-API: subdivise section 3.1.

1998-10-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/DUMPER-API: New `index-<mode>' options.
	define `support parse-estimate' and `support parse-backup' subcommand.
	New 'estimate-direct', `estimate-parse', `backup-direct' and
	`backup-parse' options.
	Remove PARSE keyword from estimate and backup command.

1998-10-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/DUMPER-API: define PARSE keyword in stderr of the backup
	command

1998-10-03  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* man/Makefile.am (EXTRA_DIST): make sure the man-pages that are not 
	generated by autoconf get into the distribution

1998-10-02  Josef Karthauser  <joe@pavilion.net>

	* changer-src/chg-chio.pl.in (getTapeParams): fix regular expression 
	for $line; the trailing `s' of slots was missing

1998-10-02  John R. Jackson  <jrj@purdue.edu>

	* server-src/amstatus.pl.in: fix error message.

1998-10-02  John R. Jackson  <jrj@purdue.edu>

	* server-src/taper.c (write_file): fix a problem with tha taper
	stats where the times were all the same.  The wallclock_str function
	returns a pointer to a static area so it cannot be called more
	than once as an argument to a function.

1998-10-01  John R. Jackson  <jrj@purdue.edu>

	* common-src/protocol.c (parse_integer): allow negative numbers.

1998-10-01  John R. Jackson  <jrj@purdue.edu>

	* server-src/amstatus.pl.in: add timestamps.

1998-10-01  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/DUMPER-API: define `support index', to be used instead of the
 	previous `index-*' sub-commands

1998-09-30  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/Makefile.am (libexec_PROGRAMS, sbin_SCRIPTS): don't use 
	backslashes for continuation; this seems to break automake :-(

1998-09-30  John R. Jackson  <jrj@purdue.edu>

	* man/amanda.8.in: minor typo in "reserve" description.

1998-09-29  John R. Jackson  <jrj@purdue.edu>

	* server-src/taper.c (end_tape): do not rewind the tape when done.

1998-09-29  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in (WANT_CLIENT, WANT_RESTORE, WANT_SERVER, 
	WANT_RECOVER, WANT_TAPE, WANT_AMPLOT, WANT_CHG_SCSI): automake
	conditionals
	* amplot/Makefile.am: use them
	* changer-src/Makefile.am: ditto
	* client-src/Makefile.am: ditto
	* common-src/Makefile.am: ditto
	* man/Makefile.am: ditto
	* recover-src/Makefile.am: ditto
	* restore-src/Makefile.am: ditto
	* server-src/Makefile.am: ditto
	* tape-src/Makefile.am: ditto

	* Makefile.am: don't print commands that work around old aclocal bug

	* docs/DUMPER-API: remove environment variables, and mention a
	program that will help translating disklist entries to device names, 
	mount points and filesystem types

	* recover-src/extract_list.c (extract_files_child): do not crash
	after failing to read the dump file header
	Reported by Jose Cheng <jcheng@math.ist.utl.pt>

1998-09-28  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/taper.c (taperscan_slot): initialize scan_datestamp, to
 	avoid amfree of uninitialized pointer
	Reported by Lance A. Brown <brown9@niehs.nih.gov>

1998-09-27  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/DUMPER-API (USER, GROUP): detailed security mechanisms
	(estimate, estimate-parse): can print `KILL' after the estimate
	
	* docs/DUMPER-API: various suggestions from Eric Siegerman
 	<erics@now.com> and some explanations added
	
1998-09-27  Andy Farkas  <andyf@speednet.com.au>

	* man/amlabel.8.in (labelstr): fix typo

1998-09-26  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* recover-src/extract_list.c (extract_files_child): fix-up
 	no_initial_params if password or domain information is not found
	Reported by Jose Cheng <jcheng@math.ist.utl.pt>

	* docs/DUMPER-API: extended `index' to `index-from-output' or
 	`index-from-image', as suggested by Dale Hagglund <rdh@best.com>.
  	Explained that the dumptype option `program' is the name of the
 	wrapper program

1998-09-25  John R. Jackson  <jrj@purdue.edu>

	* configure.in: fix --with-dump-honor-nodump test.  Patch by
	Jonas Oberg <jonas@coyote.org>.

1998-09-24  John R. Jackson  <jrj@purdue.edu>

	* example/disklist: document the "spindle" and "interface" fields.
	Reported by Brendan M Coffey <bcoffey@connix.com>.

1998-09-24  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/DUMPER-API: added draft description of the DUMPER API
	* Makefile.am (EXTRA_DIST): add it to the distribution

	* config/acinclude.m4 (AC_VALIDATE_CACHE_SYSTEM_TYPE): make sure
 	cached values for host, build and target system types match with the
 	guessed ones
	* configure.in: use it

1998-09-23  John R. Jackson  <jrj@purdue.edu>

	* server-src/amstatus.pl.in: sort the host and partition names.
	From David Wolfskill <dhw@whistle.com>.

1998-09-23  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/taper.c (getcmd): typo in last DEBUGging patch

1998-09-22  Tim Perkins  <Tim.Perkins@ddg.phar.cam.ac.uk>,  Alexandre Oliva <oliva@dcc.unicamp.br>

	* client-src/selfcheck.c (check_disk): fix VDUMP auto-detection

1998-09-22  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* changer-src/chg-mtx.sh.in: replace rew with rewind
	* changer-src/chg-zd-mtx.sh.in: ditto
	Reported by Henning Holtschneider <hh@loca.net>

	* client-src/sendsize.c: remove usage of #error
	Reported by Jay Orr <orr@vss.fsi.com>

1998-09-21  John R. Jackson  <jrj@purdue.edu>

	* man/amanda.8.in: document the new "tapebufs" parameter.

1998-09-21  Kelly Setzer  <setzer@telalink.net>

	* server-src/taper.c (NBUFS): replaced with conf_tapebufs
	(THRESHOLD): now means `empty bufs' instead of `full bufs'
	* server-src/conffile.c: add support for the "tapebufs" option
	* server-src/planner.c: ditto
	* examples/amanda.conf.in: add sample "tapebufs" entry

	* server-src/amlabel.c (main): adds entry to tapelist with date
 	19700101

1998-09-20  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/taper.c (getcmd): print DEBUGging output to stderr
	Reported by Henning Holtschneider <hh@loca.net>

1998-09-19  Eric Doutreleau <Eric.doutreleau@int-evry.fr>

	* server-src/driverio.h (MAX_DUMPERS): increased from 15 to 63 in
	order to launch more dumper in parallel
	* example/amanda.conf.in (inparallel): Add the fact that it is
 	limited by MAX_DUMPERS

1998-09-18  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* common-src/Makefile.am (libamanda_la_LDFLAGS): use libtool
 	-release instead of -version_info, so as to encode the Amanda
 	release number in the library name.  Problems related with
 	pre-installed libraries should disappear, and separate releases can
 	now be installed into the same directory without the risk of one
 	using libraries from the other.

1998-09-18  Michael C. Povel  <Michael.Povel@hub.de>

	* changer-src/chg-scsi.c (wait_ready): new function; keeps retrying
	until success or timeout
	(ask_clean, main): use it

1998-09-18  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/selfcheck.c (check_options): don't require runtar for
 	SAMBA backups
	
	* client-src/rundump.c: fix support for VDUMP-only installation
	* client-src/selfcheck.c (check_options): fix detection of advfs
	* client-src/sendsize.c (getsize_dump): ditto
	* client-src/sendbackup-dump.c (start_backup): ditto
	Reported by Tim Perkins <Tim.Perkins@ddg.phar.cam.ac.uk>

1998-09-16  John R. Jackson  <jrj@purdue.edu>

	* man/amadmin.8.in: document that "hostname" is optional for "info".
	Reported by David Wolfskill <dhw@whistle.com>.

1998-09-15  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/FAQ: common compile-time and link-time errors

1998-09-11  John R. Jackson  <jrj@purdue.edu>

	* server-src/tapefile.c (lookup_last_reusable_tape): use new
	calling sequence that passes how old a tape to return.  Remove
	lookup_previous_reusable_tape().
	* server-src/tapefile.h (lookup_last_reusable_tape): use new
	calling sequence that passes how old a tape to return.  Remove
	lookup_previous_reusable_tape().
	* server-src/amadmin.c (tape): use new lookup_last_reusable_tape
	calling sequence.
	* server-src/amcheck.c (taper_scan, start_server_check): use new
	lookup_last_reusable_tape calling sequence.
	* server-src/amflush.c (confirm): use new lookup_last_reusable_tape
	calling sequence.
	* server-src/amtape.c (taper_scan): use new lookup_last_reusable_tape
	calling sequence.
	* server-src/reporter.c (output_tapeinfo): use new
	lookup_last_reusable_tape calling sequence.
	* server-src/taper.c (taper_scan): use new lookup_last_reusable_tape
	calling sequence.

1998-09-11  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendbackup-gnutar.c (re_table): ignore
	`load_client_codepage' message from SAMBA

1998-09-11  John R. Jackson  <jrj@purdue.edu>

	* server-src/amstatus.pl.in (all): fix USE_VERSION_SUFFIXES=yes
	problems.  Reported by David Eckelkamp <davide@locutus.tradewave.com>.

	* man/amstatus.8.in (all): fix minor typos.

1998-09-10  John R. Jackson  <jrj@purdue.edu>

	* configure.in (LFS): add code that might support configuring large
	files on HP-UX.

1998-09-10  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/conffile.c (dump_configuration): runspercycle is not a
 	member of dumptype_t
	(init_holdingdisk_defaults): init chunksize with documented default,
 	not -1, because it wouldn't be recalculated

	* docs/INSTALL: URL for SAMBA was broken; note about 1.9.18p10 bug

1998-09-10  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* docs/SAMBA: 1.9.18p10 has a bug

1998-09-09  Terje Malmedal  <tm@funcom.com>

	* common-src/stream.c (stream_server, stream_client): added
 	SO_KEEPALIVE option so we get an error if the other side crashes

1998-09-09  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in (CHIO): look for chio and AC_SUBST it
	(MT, CHS): if not found, use just the program name
	
1998-09-09  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c (last_level): return the last level
	even it is still on holding disk if reserve < 100.

1998-09-09  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/reporter.c (divzero, divzero_wide): print `#'s on
 	overflow

	* server-src/amtape.c (show_init): no longer print `scanning'
 	message
	(show_init_show, current_init_all): call show_init, then print the
 	appropriate `scanning' message
	Reported by David Wolfskill <dhw@whistle.com>

	* changer-src/chg-scsi.c (main): use new multi-configuration
	mechanism only if tape_device contains only a single digit

1998-09-08  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/planner.c (setup_estimate): Don't write a
	"mismatch: no tapelist record, but curinfo next_level0" message
	and force a level 0 when reserve < 100.

1998-09-08  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/holding.h (get_amanda_names): return a filetype_t
	instead of an int.
	* server-src/holding.c (get_amanda_names): return the filetype_t
	of the file or F_UNKNOWN if it's not an amanda file.
	* server-src/find.c (search_holding_disk): Use the new return 
	type of get_amanda_names.
	* server-src/amflush.c (flush_holdingdisk): Don't write a
	"ignoring cruft file" message for chunk files,
	filetype is F_CONT_DUMPFILE.

1998-09-04  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/extract_list.c (extract_files_child): don't write
	the samba password to the debug file.

1998-09-04  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driverio.c (update_info_dumper): set inf.command to
	NO_COMMAND if reserve< 100 because if you force a level 0 with
	'amadmin force', it will do level 0 every days until you flush them
	to tape.

1998-09-03  Matthias Urlichs    <smurf@noris.net>

	* recover-src/uscan.l: recognize "?" as alias for "help"

	* configure.in (MAILER): recognize "mail" as well as "Mail" and
 	"mailx"

	* client-src/calcsize.c (add_file_dump, add_file_unknown): only get
 	sizes of directories and files

	* client-src/amandates.c (start_amandates): create amandates if
 	error is either EINTR or ENOENT

	* common-src/dgram.c (dgram_send_addr): handle ECONNREFUSED by not
 	dying when receiving, and retrying when sending, a packet.  The
 	server may get this error when a client reboots and hasn't started
 	inetd yet.
	* common-src/protocol.c (handle_incoming_packet): ditto

	* server-src/driver.c (read_schedule): catch cases when the time
 	goes negative.  Some operators have the bad habit of syncing clocks
 	late at night. ;-)

	* common-src/dgram.h (MAX_DGRAM): increased to 64Kb
	* NEWS: ditto
	* client-src/amandad.c (main): read the pipe from the child
 	incrementally: the pipe buffer of many OSes is shorter than
 	MAX_DGRAM.  Instead of SIGCHLD, note end-of-data by way of
 	end-of-file
	(sigchild_jump, sigchild_flag): removed
	* client-src/sendbackup.c (main): instead of fork-and-exit, tell
 	amandad to process our data by closing our end of the pipe
	
1998-09-03  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* NEWS: another typo (too late :-(

1998-09-03  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/driver.c: amanda will not use an holding disk
	if the directory with the datestamp already exist.

1998-09-03  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* Amanda 2.4.1 released
	
1998-08-27  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* NEWS: typo

1998-08-27  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/INSTALL: update some version numbers; SAMBA 1.9.18p10 has
	fixed the bug in p8; using p8 is not recommended any more
	* docs/SAMBA: ditto

	* config/config.guess: updated to libtool 1.2b's, in order to
	auto-detect some recent architectures
	* config/config.sub: ditto

	* server-src/amcleanup.sh.in (sbindir): amreport now lives in
 	sbindir; added it to PATH and removed full pathnames to binaries

1998-08-27  Blair Zajac  <blair@gps.caltech.edu>

	* configure.in: Add the directory /usr/lib/fs/vxfs to the search
	path where configure looks for vxdump and vxrestore.  This is for
	Solaris so it can automatically handle vxfs filesystems.
	* client-src/sendbackup-dump.c: add missing last NULL argument to
	newvstralloc().
	* server-src/dumper.c: add missing last NULL argument to
	newvstralloc().
	* NEWS: reorder 2.4.1 items into most to least important for most
	users.
	* config/acconfig.h: update comment for VXDUMP and VXRESTORE to
	include systems where the Veritas filesystem is used.

1998-08-21  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* man/amanda.8.in (nofull): only level 1 incrementals

1998-08-20  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* changer-src/chg-mtx.sh.in (PATH): added /usr/local/bin

	* configure.in (BUILD_CHANGER_SCRIPTS_LIBEXEC): added chg-zd-mtx
	(AC_OUTPUT): ditto
	* changer-src/Makefile.am (EXTRA_SCRIPTS): ditto
	* docs/TAPE.CHANGERS (chg-zd-mtx): documented it
	(chg-mtx): mentioned chg-zd-mtx

1998-08-20  Eric Doutreleau  <Eric.Doutreleau@int-evry.fr>

	* changer-src/chg-zd-mtx.sh.in: new changer script for
	Zubkoff/Dandelion version of mtx.

1998-08-19  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/SAMBA: updated; documented new patch (sambatar.diff,
 	available in the patches page) and requirements about backup user.
	* docs/INSTALL: documented new patch

1998-08-18  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendsize.c (regex_s): refuse to compile if SAMBA_CLIENT
 	and HAVE_DUMP_ESTIMATE are both defined: the regexp that matches the
 	estimate from DU 4.0's dump also matches an output line from
 	smbclient, that provides an incorrect estimate.
	* docs/SYSTEM.NOTES: document the problem

1998-08-14  John R. Jackson  <jrj@purdue.edu>

	* docs/TAPE.CHANGERS: describe "advance" and clean up some spelling.

1998-08-13  Alexandre Oliva  <oliva@dcc.unicamp.br>, Marcel Hild  <hild@id-pro.de>

	* configure.in (--with-portrange): validate and define PORTRANGE
	* example/config.site: document it
	* config/acconfig.h (PORTRANGE): prepare for configure define
	* common-src/stream.c (stream_server): use PORTRANGE to limit TCP
	unreserved server sockets

1998-08-12  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/FAQ: working around `dumps way too big'

1998-08-11  Alexandre Oliva  <oliva@dcc.unicamp.br>, Gunnar Gunnarsson  <gunnar@ki.ericsson.se>

	* common-src/token.h (rxquote, shquote): new functions
	* common-src/token.c (rxquote) quotes a string into an equivalent
 	regular expression
	(shquote): quotes all shell special meta-characters, so that a
 	string can be safely passed down for shell interpretation in
	system() or popen()-like calls
	* server-src/amindexd.c (build_disk_table): quote the disk_name with 
	both rxquote and shquote

1998-08-11  John R. Jackson  <jrj@purdue.edu>

	* changer-src/chg-manual.sh.in: put the debug file in DEBUG_DIR for
	security.  Clean up and enhance logging.  Fix locations of the
	changer files.	Source the changerfile into the script so it can
	override the request() function and allow alternatives to /dev/tty
	(e.g. E-mail, syslog).	Issue rewind before status (Solaris does
	not give a good status report right after a tape is loaded).

1998-08-10  Nick Hibma  <nick.hibma@jrc.it>

	* changer-src/chg-chio.pl.in: move to first slot if last is unused

1998-08-07  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* example/Makefile.am (EXTRA_DIST): add DIN-A4.ps

1998-08-07  Gnter Felkel  <G.Felkel@edelmann.de>

	* example/DIN-A4.ps: new file

1998-08-06  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* tape-src/tapetype.c (initrandombytes): use random() instead of
	rand(), its low-order bits are more random
	(main): call srandom(seed) instead of srand(seed)
	(USE_RAND): if defined, reverts to using rand() and srand(seed)

	* docs/FAQ: some notes about driving real tape changers

1998-08-05  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* man/amreport.8.in (SYNOPSIS): replace `amtoc' with `amreport'

1998-08-04  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendsize.c: revert 1998-08-01's change, it wouldn't
	even compile, as amfree() expands to a statement, not an expression, 
	so it cannot be used as the `increment' part of a for loop.

	* server-src/planner.c (main): if runs_per_cycle is set to zero or
	negative, set it to 1, in order to avoid division by zero.
	* server-src/amadmin.c (balance): ditto

1998-08-01  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendsize.c: replace free(line) with amfree(line),
	because line is not ensured to be non-NULL
	
	* docs/FAQ: amandad: error receiving message
	
	* docs/FAQ: difference between skip-full and strategy nofull

1998-07-31  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/FAQ: software or hardware compression?

	* server-src/driver.c (adjust_diskspace): do not abort just because
	a holding disk file is missing
	(main): report warning if holding disk directory could not be
	created, and do not use it
	Reported by Albrecht Gebhardt <agebhard@zidsrv.sci.uni-klu.ac.at>

	* example/Makefile.am (EXTRA_DIST): add 8.5x11.ps to the
	distribution
	Reported by Jason L Tibbitts III <tibbs@hpc.uh.edu>

	* server-src/conffile.c (get_holdingdisk): define chunksize 0 as
	INT_MAX/1024, and chunksize -1 as -INT_MAX/1024
	* server-src/driver.c (find_diskspace): accept negative chunksizes
	as the maximum size (in modulus) for using the holding disk
	* man/amanda.8.in (chunksize): document the usage of negative
	values, and improve the explanation of chunking
	* example/amanda.conf.in: ditto

1998-07-29  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/FAQ: disk offline

1998-07-27  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* restore-src/amidxtaped.c (main): use tape_rewind() instead of
	running `mt'

	* server-src/amcleanup.sh.in (reporter): update to call amreport.
	(amdump.<n>) update to use the same renaming technique introduced in
 	June 30's change to amdump.

1998-07-25  Michael Graff  <explorer@vix.com>

	* changer-src/Makefile.am (install-exec-hook): support $(DESTDIR)
	* client-src/Makefile.am (install-exec-hook): ditto
	* man/Makefile.am (install-data-hook): ditto
	* recover-src/Makefile.am (install-exec-hook): ditto
	* restore-src/Makefile.am (install-exec-hook): ditto
	* server-src/Makefile.am (install-exec-hook): ditto

	* configure.in: link krb5 and com_err in for Kerberos support, if
 	they exist

1998-07-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/reporter.c (copy_template_file): add braces to 
	remove warning
	* tape-src/tapeio.h: declare is_zftape to remove warning in
	amlabel.c and taper.c

1998-07-23  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/driver.c (any_delayed_disk): new variable, to ensure
	that we do not leave the main driver loop if there are delayed disks 
	but there are no active dumpers
	(main): instead of checking whether idle_reason is IDLE_START_WAIT,
	check whether there is any_delayed_disk for remaining in the loop
	(start_degraded_mode): set any_delayed_disk when needed
	Reported by Peter Walker <peter@talarian.com>

1998-07-23  John R. Jackson  <jrj@purdue.edu>

	* server-src/reporter.c (main): handle LPRCMD being undefined.

1998-07-23  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* client-src/selfcheck.c (check_suid): new function to check if a
	program is SUID root.
	* client-src/selfcheck.c (check_overall): check that runtar and
	rundump are SUID root.

1998-07-22  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in: version number set to 2.4.1

	* recover-src/Makefile.am (LDADD): libamtape imports symbols from
 	libamanda, so it must be listed first

	* changer-src/Makefile.am (LDADD): remove duplication of libamserver
 	and libamanda, as they no longer provide symbols for each other
	* server-src/Makefile.am (LDADD): ditto
	
1998-07-21  Blair Zajac  <blair@gps.caltech.edu>

	* server-src/amrmtape.sh.in: now use amanda.conf's tapelist variable
	* server-src/amcheckdb.sh.in:  now use amanda.conf's tapelist variable
	* server-src/amfreetapes.sh.in: now use amanda.conf's tapelist variable
	* server-src/amtoc.pl.in: now use amanda.conf's tapelist variable,
	make perl4 compatible

1998-07-17  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/FAQ (results missing): suggestions to work around the UDP
	packet size limit

1998-07-16  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/FAQ (amrecover): a config name may have to be specified
	Reported by digital messiah <dmessiah@silcon.com>

1998-07-15  Blair Zajac  <blair@gps.caltech.edu>

	* server-src/reporter.c (main): declare optind

1998-07-15  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in: created Amanda 2.4.1 branch

	* example/amanda.conf.in: strategy noinc is not implemented yet

1998-07-14  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* NEWS: new runspercycle keyword
	* server-src/conffile.h: new runspercycle keyword
	* server-src/conffile.c: new runspercycle keyword
	* server-src/amadmin.c (balance): new runspercycle keyword
	* server-src/planner.c (main): new runspercycle keyword
	* man/amanda.8.in: document new runspercycle keyword
	* example/amanda.conf.in: example for new runspercycle keyword

1998-07-13  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/FAQ: What to do if DUMP program is not available.
	* client-src/selfcheck.c (check_overall): if a needed program is
	missing, print an error message.
	Reported by Klaus Hoffmann <handatalog@csi.com>

	* */Makefile.am: checked library version numbers, no need for update
	
	* configure.in: version number set to 2.4.1b1

1998-07-11  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/FAQ: new entries: how to label tapes, (not) spanning large
 	filesystems across tapes, how to enable index generation,
 	overwriting selected tapes, cleaning up databases, selecting tape
 	changer.
	
1998-07-10  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* man/Makefile.am (EXTRA_DIST): amreport.8 is built from .8.in

	* configure.in (AC_OUTPUT): generate chg-chio.pl
	* changer-src/Makefile.am (EXTRA_DIST): removed chg-chio.c
	* changer-src/chg-chio.c: removed, as it was confusing make
	
1998-07-10  Nick Hibma  <nick.hibma@jrc.it>, Alexandre Oliva <oliva@dcc.unicamp.br>

	* changer-src/chg-chio.pl.in: new script, created to replace old
 	chg-chio written in C
	* docs/TAPE.CHANGERS (chg-chio): document it
	* changer-src/Makefile.am (EXTRA_SCRIPTS): add chg-chio
	(EXTRA_DIST): still include chg-chio.c, just in case it is useful
	* configure.in (BUILD_CHANGER_SCRIPTS_LIBEXEC): add chg-chio
	
1998-07-08  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/reporter.c (main): if no arguments are given, preserve
	original behavior; require config name otherwise.  Perform better
	argument checking.
	* example/DLT.ps (DrawHost): discard additional argument introduced
	in Steven Freed's modification
	* example/EXB-8500.ps (DrawHost): ditto
	* example/HP-DAT.ps (DrawHost): ditto

	* server-src/Makefile.am (amreport_SOURCES): build from reporter.c
	(driver_SOURCES) removed, no longer needed
	* man/Makefile.am (EXTRA_DIST): added amreport.8

1998-07-08  Steven Freed  <sfreed@gilasoft.com>

	* server-src/reporter.c (usage): new function
	(main): accept command-line arguments for selecting config name,
	output file, log file name to read from, postscript file to write
	to.
	(output_summary): print tape labels list, tape section numbers and
	dump sizes.
	* server-src/amdump.sh.in: run amreport
	* server-src/amflush.c (main): ditto
	(run_dumps): ditto
	* configure.in (BUILD_SERVER_PROGS_SBIN): add amreport
	(BUILD_SERVER_PROGS_LIBEXEC): remove reporter
	* man/amreport.8.in: new file
	* man/Makefile.am (man_MANS): added amreport.8
	* example/8.5x11.ps: new file

1998-07-08  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* Makefile.am (ACLOCAL_M4): fix ||/&& precedence problem

1998-07-07  John R. Jackson  <jrj@purdue.edu>

	* changer-src/scsi-chio.c: move #include's so this will compile on
	systems without <sys/mtio.h> (e.g. AIX).

1998-07-06  John R. Jackson  <jrj@purdue.edu>

	* client-src/sendsize.c (handle_dumpline): allow the dump block
	count estimate to be negative.  Found by Lance A. Brown
	<brown9@niehs.nih.gov> on NeXT.

	* common-src/Makefile.am, common-src/security.c: add TEST code to
	security.c so people can do "make security" and have a test program
	to track down why they are getting "access as XXX not allowed from
	YYY@ZZZ".

	* common-src/security.c (bsd_security_ok): allow the remote user
	field in .amandahosts to be empty ala .rhosts.

1998-07-04  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amcheck.c (start_server_check): report space use for
	holding disk if a negative value is given in the use parameter.

	* server-src/driver.c (main): compute holding disk space if 
	a negative value is given in the use parameter..

	* man/amanda.8.in (use) : document negative use paramater for 
	holding disk.

	* example/amanda.conf.in (use): document negative use paramater for
	holding disk..

1998-07-04  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* man/amanda.8.in (reserve): document it
	* example/amanda.conf.in (reserve, gigabytes): ditto
	(etimeout) negative number stands for total estimate time

	* NEWS: documented major changes since amanda 2.3.0.4

	* docs/INSTALL: refer to patch-system for editing services and
 	inetd.conf

	* docs/FAQ: added entries for common amdump and amcheck errors

	* COPYRIGHT: updated to 1998, refer to Amanda Development Team
	* AUTHORS: who is the Amanda Development Team

1998-07-03  John R. Jackson  <jrj@purdue.edu>

	* docs/SYSTEM.NOTES: add comment about using the variable device name
	on IRIX.  Otherwise, IRIX will write 4KByte physical blocks, which
	it appears to read OK, but not if you take the tape to some other
	system that does what you tell it.  Discovered by Steve E. Khoo
	(steve@gordian.com).

1998-07-02  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/planner.c (setup_estimate): handle new disks with
	skip-full correctly.

	* Makefile.am (aclocal.m4): must depend on libtool.m4, so as to
 	force it to be newer on distributions.

1998-07-01  John R. Jackson  <jrj@purdue.edu>

	* server-src/driverio.h: change reserved_space to unsigned long to
	match free_space() and avoid a compiler warning.

1998-06-30  John R. Jackson  <jrj@purdue.edu>

	* man/amanda.8.in: fix amrecover synopsis and add a short description.
	Noted by Brendan M Coffey <bcoffey@connix.com>.

	* example/amanda.conf.in: make tapecycle example fit dumpcycle value
	better.  Noted by Tom.Croll@radisys.com and suggested comments from
	Alexandre Oliva <oliva@dcc.unicamp.br>.

1998-06-30  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* server-src/amdump.sh.in (maxdays): set up with tapecycle+2
	(days): loops from 1 to $maxdays, but stops if amdump.$days does not 
 	exist, so that we only rename amdump log files that exist.  This
 	prevents too long loops in case of an infinite tapecycle.
	Reported by Nick Hibma <nick.hibma@jrc.it>

1998-06-28  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* common-src/security.c (bsd_security_ok): accept case mismatches
 	when comparing hostnames and usernames from amandahosts, and assume
 	localuser if username is missing.
	* docs/INSTALL: clarify BSD security and amandahosts, WRT to
	non-FQDNs.
	Reported by Chris Shenton <chris@absinthe.shenton.org>

	* server-src/reporter.c (output_tapeinfo): degraded mode no longer
	implies incremental dumps only.
	Reported by Randy Dees <rrd@amherst.com>

1998-06-26  John R. Jackson  <jrj@purdue.edu>

	* configure.in: fix BSD/OS Kerberos include file location.

1998-06-26  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* config/ltmain.sh: install official patch to libtool 1.2a

	* configure.in: do not set max file size for Solaris 2.6, it is no
	longer used.

1998-06-26  Tim McNerney  <mumbly@netcom.com>

	* common-src/fileheader.c (parse_file_header): accept missing
	PROGRAM in tape section header, for backward compatibility.

1998-06-25  Blair Zajac  <blair@gps.caltech.edu>

	* server-src/amflush.c: fix mismatch arguments to error()

1998-06-24  Steven Freed  <sfreed@gilasoft.com>

	* configure.in (dump-honor-nodump): fix test for `-h' support

1998-06-24  Scott Mesches  <mesches@allison.Colorado.EDU>

	* example/DLT.ps: new file
	* example/Makefile.am (EXTRA_DIST): add DLT.ps

1998-06-24  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* Makefile.am (EXTRA_DIST): moved CHANGES into ChangeLog

	* recover-src/extract_list.c (extract_files_child): handle
	IS_UNKNOWN dumptype as IS_DUMP

	* client-src/sendsize.c (getsize_dump): always create pipe for
 	killpgrp.

	* client-src/amandad.c (sendnak): report `UNKNOWN' error if str is
	NULL.

	* amplot/amplot.awk: ignore `interface-state'
	Reported by Peter Walker <peter.walker@talarian.com>

1998-06-24 Alexandre Oliva <oliva@dcc.unicamp.br>

	* server-src/amrmtape.sh.in: enable verbose by default; implement -q 
 	for quiet.
	* man/amrmtape.8.in: ditto
	Suggested by Nick Hibma  <nick.hibma@jrc.it>
	
1998-06-24  Nick Hibma  <nick.hibma@jrc.it>

	* server-src/amrmtape.sh.in: better error reporting for incorrect
	database entries

1998-06-24  Dan Swartzendruber <dswartz@druber.com>
	
	* server-src/conffile.h (RESERVE): new keyword.
	* server-src/conffile.c (RESERVE): ditto.
	(getconf_seen): recognize "reserve" keyword.
	(getconf_int): return value of "reserve" keyword.
	(read_confline): parse "reserve" line.
	* server-src/driverio.h (reserved_space): new global
	* server-src/driver.c (main): compute holding disk space to reserve
 	for degraded dumps.
	(start_degraded_mode): if we haven't hit degraded mode reservation
 	limit, allow full dump.
	
1998-06-18  Blair Zajac <blair@gps.caltech.edu>

	* config/ltconfig: update to 1.2a
	* config/ltmain.sh: update to 1.2a
	* config/libtool/libtool.m4: update to 1.2a

1998-06-17  John R. Jackson  <jrj@purdue.edu>

	* server-src/dumper.c (write_tapeheader): comment out some variables
	to get rid of a compiler warning.

1998-06-15  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c (bumpsize): write wrong equation for bump
	threshold.

1998-06-15  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* man/amanda.8.in: add info about the chunksize parameter
	of the holdingdisk.
	* man/amanda.8.in: add info about amstatus command

1998-06-13  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* common-src/Makefile.am (libamanda_version): updated
	* tape-src/Makefile.am (libtape_version): updated
	* client-src/Makefile.am (libclient_version): updated
	* server-src/Makefile.am (libserver_version): updated

	* server-src/taper.c (read_file): if switching to the next file
 	fails or there's no next file, do not send a `W' to taper writer.

	* server-src/changer.h (changer_clean): new function
	* server-src/changer.c (changer_clean): ditto

1998-06-13  Michael C. Povel  <mcp@ladyada.han.de>

	* changer-src/chg-scsi.c: added ejetct_tape and sleep for external
	tape devices, and changed some code to allow multiple drives to use
	their own slots. Also added support for reserverd slots.
	* changer-src/libscsi.h (get_clean_state, eject_tape): new functions 
	* changer-src/scsi-chio.c (get_clean_state, eject_tape): implemented 
	using Linux ioctls
	* changer-src/scsi-hpux.c (get_clean_state, eject_tape): do nothing, 
	until someone implements them
	* changer-src/scsi-proto.c (get_clean_state, eject_tape): new
	functions
	* docs/TAPE.CHANGERS: document new configuration file format
	* example/chg-scsi.conf: sample configuration file
	* example/Makefile.am: add chg-scsi.conf to the distribution
	* server-src/amtape.c: add support for `clean' command

1998-06-13  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/SYSTEM.NOTES: clean-up

	* docs/FAQ: new file
	* docs/SUNOS4.BUG: removed
	* Makefile.am: remove docs/SUNOS4.BUG and add docs/FAQ
	
	* example/amanda.conf.in (bumpmult): fixed equation for threshold
	* man/amanda.8.in (bumpsize): fix threshold example.
	problem reported by Brian McEntire <brianm@fsg1.nws.noaa.gov>

	* server-src/logfile.c (open_log): open log file with mode 0600.

	* server-src/amdump.sh.in: refuse to run if either amdump or log
	exist in logdir.
	* server-src/amflush.c (main): refuse to run if log exists.
	* server-src/amcheck.c (start_server_check): do not perform tape
 	testing if amdump and/or log exist in logdir.

1998-06-11  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* restore-src/amrestore.c (restore): fixed -p flag (and amrecover)
	should not dup2( A, B ); aclose(A) when A == B

1998-06-10  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendsize.c (getsize_dump): use killpgrp
	unconditionally, so we're not bitten by setuid dump programs.
	* client-src/killpgrp.c: enable unconditionally.

	* tape-src/tapetype.c: new program: calculates tapetype parameters.
	* tape-src/Makefile.am (EXTRA_PROGRAMS): added tapetype.
	* example/amanda.conf.in: point to tapetype program.

1998-06-09  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/SAMBA: added notes about (not) backing up registry files and
	ACLs with SAMBA.
	* docs/INSTALL: point to docs/SAMBA for usage and limitations

1998-06-08  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in (amanda_cv_print_command): removed; using PRINT
 	instead.

1998-06-07  Todd Kover <kovert@omniscient.com>

	* add --with-owner option to allow installed binaries to be owned
	by someone other than the amanda user

	* add GB as valid holding disk size.

1998-06-07  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* server-src/amadmin.c (info): don't need to specify an host.

	* server-src/amadmin.c (due): new due command to write when a
	filesystem is due ffor next level 0 or how much days it is
	overdue.

	* server-src/amstatus.pl.in (dump_size): new function to report
	the size of a dump split on multiple files.

1998-06-05  Jean-Louis Martineau <martineau@IRO.UMontreal.CA>

	* recover-src/extract_list.c (read_buffer): write a message
	when amrecover timeout waiting for amrestore to send the dump.

1998-06-04  John R. Jackson  <jrj@purdue.edu>

	* client-src/getfsent.c (main): use a dynamically allocated string
	for the lookups since dev2rdev alters it on the fly and some systems
	drop core for trying to write into read only memory.  Also add the
	capability of passing additional lookups on the command line.

	* common-src/Makefile.am, common-src/file.c (main),
	common-src/token.c (main), server-src/conffile.c (dump_configuration,
	main), server-src/diskfile.c (main), server-src/infofile.c (main):
	Clean up compiler warnings in the test programs and make them all
	work again.

1998-06-03  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* amplot/amplot.sh.in: modified command line argument parsing
 	mechanism, so as to prevent shell quoting problems and unportable
 	constructs.
	Reported by Chris Jones <cjones@clydesdale.math.montana.edu>

1998-06-02  John R. Jackson  <jrj@purdue.edu>

	* server-src/amcheck.c (main), server-src/reporter.c (main): make
	sure internal errors, such as the mail command failing, get
	reported.  In the case of amcheck, they go to stderr even if -m is
	set since there didn't seem to be anyplace better to do so and if
	this is running from a cron job it might get back to a real user.
	For reporter, the errors go to .../amdump along with everything
	else from the amdump script, and they should also go to .../log,
	except since it's reporter that's having the trouble, they probably
	will not make it into the mail report.

1998-06-01  John R. Jackson  <jrj@purdue.edu>

	* client-src/killpgrp.c: clean up minor compiler warnings by not
	building term_kill_{soft,hard} unless they are needed.

	* server-src/driverio.c (dumper_cmd): clean up compiler warning
	in printf format by forcing argument to always be long and using %ld.

	* server-src/driver.c: include <holding.h> to get declaration for
	unlink_holding_files and avoid a compiler warning.

	* common-src/amanda.h, common-src/match.c (validate_glob, match_glob,
	glob_to_regex), recover-src/amrecover.h, recover-src/extract_list.c
	(add_glob, add_regex, add_file, delete_glob, delete_regex,
	delete_file), recover-src/help.c (help_list), recover-src/uparse.y,
	recover-src/uscan.l, man/amrecover.8.in: add shell wildcard support
	for the add/delete amrecover commands.  Add addx/deletex commands
	that use regular expressions.  Support more characters in path names.

1998-06-01  Dan Swartzendruber  <dswartz@druber.com> via John R. Jackson

	* server-src/amlabel.c (main): check argc before referencing too
	far into argv for "-f".

1998-06-01  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/SYSTEM.NOTES: advise Linux users to use dump without
 	setuid/setgid

	* docs/INDEXING: update dumptype syntax

1998-05-29  John R. Jackson  <jrj@purdue.edu>

	* server-src/amindexd.c (uncompress_file, process_ls_dump,
	build_disk_table, is_dir_valid_opaque, opaque_ls): fix file
	descriptor leak, log the amadmin find command, fix error reporting
	from routines that do not generate system errors.
	* common-src/amanda.h: make sure errno is saved through amfree().

1998-05-28  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* docs/SYSTEM.NOTES: GNU tar must be patched on HP/UX.
	* patches/tar-1.12.patch: ditto.

	* server-src/taper.c (endtape): do not log amount of used tape after 
	entering degraded mode.

	* client-src/sendsize.c (getsize_dump): pass at least argv[0] to
 	killpgrp.

1998-05-28  Paul R. Johnson  <prj@mit.edu>

	* client-src/sendbackup.c (check_status): when checking whether
	return status 1 is valid for dump, make sure it was *not* tar that
	was running.

1998-05-28  Tom Lear <toml@accesscom.com>, John R. Jackson  <jrj@purdue.edu>

	* man/amcheck.8.in: document new -Maddress command line flag.
	* server-src/amcheck.c (usage, main): add -Maddress command line
	flag to send mail to a specific address instead of mailto from
	amanda.conf.

1998-05-27  John R. Jackson  <jrj@purdue.edu>

	* man/amrestore.8: update for host/disk/date triplets.
	* recover-src/extract_list.c (extract_files_setup): pass datestamp
	argument in new position and without -d.
	* restore-src/amidxtaped.c (main): remove -d checks.
	* restore-src/amrestore.c (restore, usage, main): fix file descriptor
	leak, move datestamp to host/disk triplet and allow all to be repeated.

1998-05-27  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/killpgrp.c (main): wait for either SIGTERM or EOF on
	stdin.

	* client-src/sendsize.c (getsize_dump): close the other end of
 	killpgrp's stdin pipe before trying to kill it, because we just
 	can't kill it.

	* configure.in (HAVE_HPUX_SCSI): check whether sys/scsi.h actually
	supports HP/UX-like changer commands.

	* config/acconfig.h (HAVE_HPUX_SCSI): indicates HP/UX-like changer
	interface is supported.

	* changer-src/scsi-hpux.c: check for HAVE_HPUX_SCSI instead of
 	HAVE_SYS_SCSI_H.

1998-05-25  Allen Briggs  <briggs@canolog.ninthwonder.com>

	* changer-src/chg-manual.sh.in (ONLINEREGEX): add `^er=0$' for
	NetBSD's mt

1998-05-23  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendsize.c (getsize_dump): killpgrp must be direct
 	child of sendsize, otherwise sendsize won't be able to kill it.

1998-05-23  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in (bcopy, bzero, fread, fwrite, vfprintf, vprintf,
	vsprintf): check for these in stdlib.h
	(memmove): check for it in strings.h
	
	* common-src/amanda.h (memmove): fix declaration of memmove, so as
 	to be compatible with the ones in common-src/memmove.c and
 	regex-src/fake/memmove.c
	
	reported by Tim Potter <tpot@acsys.anu.edu.au>

1998-05-20  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* client-src/sendbackup.c (check_status): when checking whether dump 
	returned 1, make sure it was not tar; #ifdef'ed out the code that
	ignores exit status 2 from gnutar (will be compiled in only if
	IGNORE_TAR_ERRORS is defined)
	* client-src/sendbackup-gnutar.c (GNUTAR active filesystem errors): 
	updated comment; compile in GNUTAR error messages as DMP_NORMAL if
	IGNORE_TAR_ERRORS is defined; compile in SMBCLIENT error messages as 
	DMP_NORMAL if IGNORE_SMBCLIENT_ERRORS is defined.
	
1998-05-20  Tom Lear  <toml@accesscom.com>

	* client-src/sendbackup.h (tarpid): new variable, used to check
	whether it is gnutar that is running
	* client-src/sendbackup-gnutar.c (start_backup): set tarpid when
	starting gnutar
	* client-src/sendbackup.c (check_status): if gnutar returns 2,
	ignore the error

1998-05-19  Jean-Louis Martineau <martineau@IRO.UMontrealCA>

	* client-src/amandad.c: set parse_errmsg when unexpected packet
	* recover-src/amrecover.c: overflow in clean_pathname()
	* recover-src/extract_list.c: add log in delete_file().
	small bug when call clean_pathname()
	* server-src/amindexd.c: ORLD command is not working
	* server-src/dumper.c: fixe overflow

1998-05-17  Alexandre Oliva  <oliva@dcc.unicamp.br>

	* configure.in: do not check for MAXFILESIZE
	* config/acconfig.h: do not define MAXFILESIZE
	* server-src/conffile.c: use INT_MAX instead of MAXFILESIZE
	* example/amanda.conf.in: ditto

	* server-src/driver.c (interface_state): new function; print the
	free bandwidth for each interface.
	(short_dump_state): call interface_state before holdingdisk_state

	* ChangeLog: renamed from CHANGES.  Original entries follow.

	fix skip-incr handling so that reporter reports SKIPPED
	instead of missing result.
	-Jim Simmons <s4i@sws6.ctd.ornl.gov>

	split big dumps ( > MAXFILESIZE ) in multiple files on holding disk. 
	new chunksize parameter in holdingdisk description of 
	the amanda.conf file.
	-J-L Martineau <martineau@IRO.UMontreal.CA>

	an amstatus command that give the current state of a run.
	-J-L Martineau <martineau@IRO.UMontreal.CA>

	possibility to amflush multiple runs on one tape.
	possibility to select dump by datestamp in amrestore (-d datestamp).
	-J-L Martineau <martineau@IRO.UMontreal.CA>

	amidxtrm keep index of all active tapes as listed in tapelist file.
	-J-L Martineau <martineau@IRO.UMontreal.CA>

	the tapelist file keep every active tapes.
	"amadmin reuse" and "amadmin no-reuse" to mark tapes you want
	to keep for a long time.
	-J-L Martineau <martineau@IRO.UMontreal.CA>

	amlabel will not overwrite an amanda tape.
	The -f flag allow to overwriting an amanda tape.
	-J-L Martineau <martineau@IRO.UMontreal.CA>

	be consistent and use 1048576 as a dump size everyplace instead of
	100000 in some places (mostly cosmetic).  -JJ

	negative numbers are now accepted in the configuration file
	parser.  -oliva

	allow a total estimate time-out to be specified.  -oliva
	Suggested by Martyn Johnson <Martyn.Johnson@cl.cam.ac.uk>

	fix amtoc behavior in case of failed reads.
	-Niek Rijnbout <niek@knoware.nl>

	index files are now stored in a directory tree ala curinfo instead
	of a flat namespace. -JJ

	amrecover will now restore files using SAMBA.
	-Rob Riggs <rob@devilsthumb.com>

	VXDUMP needs not be run as root, so it no longer enables
	rundump automatically.  -oliva

	new `killpgrp' setuid-root program.  It is used to kill
	VDUMP, VXDUMP and XFSDUMP or with-rundump DUMP estimates in a
	safe manner.
	-Joerg Behrens <jbehren@umpa06.gwdg.de> & oliva

	fixed amrmtape so that it will delete from tapelist only the
	entry that corresponds to the specified tape, not others that
	contain the tape name as a substring.
	-Nick Hibma <nick.hibma@jrc.it> & oliva

	Added support for FreeBSD dump -h flag (honor nodump).
	-James E. Housley <housley@pr-comm.com>

	Added support for ZFTAPE on Linux.
	-Albrecht Gebhardt <agebhard@zidsrv.sci.uni-klu.ac.at>

	Added support for printing tape labels.
	-Scott Mesches <mesches@allison.Colorado.EDU>

	Do not let amrecover die because of SIGPIPE if the pager terminates
	early during a long listing.  Use the PAGER environment variable if
	available, else "more".  -JJ

	Change log() calls to log_add() so it does not conflict with the math
	function of the same name.  Replace pname global variable with two
	functions to set/get.  Get rid of libamnolog.  -JJ

	chg-chio was renamed to chg-scsi, and now it will support not
	only chio.h, but also tape changer interfaces available on
	HPUX, Solaris 2.5, IRIX and possibly others.  Currently, only
	chio and HPUX are implemented.
	-Eric Schnoebelen <eric@cirr.com>

	Numerous bugs/errors were fixed in chg-chio/chg-scsi.  it now
	properly responds to -eject requests, among other things.
	-Eric Schnoebelen <eric@cirr.com>

Version 2.4.0p1

	updated to libtool 1.2a.  -oliva

	fix kerberos encryption to work.  -Chris Ross <cross@uu.net>

	add --with-owner option to optionally not have things owned by
	the amanda user.  (meant to be in 2.4.0) -kovert

	only call initgroups() if it is available.  -oliva

	check whether GNUTAR_LISTED_INCREMENTAL_DIR is a directory.
	-oliva, reported by J.A. Gutierrez <spd@gtc1.cps.unizar.es>

	amindexd no longer considers prefixes of hostnames as valid
	hostnames. -oliva

	fix strappend2 so that it accepts a NULL first argument.
	-Rob Riggs <rob@devilsthumb.com>

	pass kerberos encryption switch to client.
	-Fredrik Jnsson <fjo@nada.kth.se>

	rename afree to amfree, to work around IRIX 6.4's afree.
	-oliva, reported Stephan P. Martin <smartin@schlund.de>

	implement `strategy skip' just like `ignore'.
	-oliva,
	reported by Michael O'Shaughnessy <mikeo@emg.sms.siemens.com>

	amcheck now checks whether COMPRESS_PATH is executable, which
	would prevent server-compression and indexing from working.
	-oliva, reported by Peter Schultze <peter@mbi.ucla.edu>

	fixed dump estimate regular expression for DU 4.0.
	-Andreas Schmitz <schmitz@theorie.physik.uni-wuppertal.de>

Version 2.4.0

	fixed memory corruption error in amtape.
	-oliva

	fixed VXDUMP support.
	-Andrew Ivanov <ivanov@mics.msu.su> & oliva

	typos fixed in chg-chs.
	-David Barr <dbarr@simplex.com>

	chg-mtx now prints error message if tapedev or changerdev must
	be defined.
	-Adrian T. Filipi-Martin <atf3r@cs.virginia.edu>

	fixed amflush problem, reported by Dietmar Goldbeck
	<dietmar@telemedia.de>  -oliva

Version 2.4.0-980319

	chg-mtx should use changer-dev if specified.
	-Steve Khoo <steve@gordian.com>

	flex-related backward-compatibility problem fixed.
	-Norman K Scherer <nsche@seros-48.hac.com>

	ported to RISCOS 4BSD.  -Harlan Stenn <Harlan.Stenn@pfcs.com>

	when amrecover starts up, it will warn you $CWD is not the root
	of the selected filesystem.  -oliva

	removed all uses of #elif, because some C compilers won't
	handle it correctly. -Gunther Felkel <G.Felkel@edelmann.de>

	fixed VDUMP-only (no DUMP defined) estimates.
	-Joern Behrens <jbehren@umpa05.gwdg.de>

	ported to UnixWare.  -Jeff Moscow <jeff@rtr.com>

	improved vxdump support so that rundump will be used for vxfs
	filesystems only, and it will be enabled automatically.  -oliva

	various portability problems fixed.

	taper will now log reason for tape error to log.<DATE> file,
	in addition to amdump.<n>.
	-Liudvikas Bukys <bukys@cs.rochester.edu>

	amflush now correctly updates the info database.  -oliva
	reported by Liudvikas Bukys <bukys@cs.rochester.edu>

	sendsize now wait()s for tar and samba child processes.  -oliva
	reported by Brian Morris <brian@mvhs.fuhsd.org>

	ensure that `amadmin find' reports multiple backups performed on
	the same day in the correct sequence.
	-Liudvikas Bukys <bukys@cs.rochester.edu>

	if backup server has multiple IP addresses, security code
	might reject it.  -Gunnar Gunnarsson <gunnar@ki.ericsson.se>

	vdump would not work.  -oliva

	kerberos support was broken.  -mike

Version 2.4.0-980222

	retry tape open on AIX if it fails with EAGAIN errno.
	-Francois Morris <Francois.Morris@lmcp.jussieu.fr>

	fix amrmtape so that it behaves well when files to amflush
	remain.  Reported by Dietmar Goldbeck <dietmar@telemedia.de>

	retry tape rewind on FreeBSD.  -Bob Willcox <bob@prm.com>

	read all output from amrestore otherwise, instead of the
	beginning of the next tape section, it would read garbage.
	-Terje Malmedal <tm@odin.funcom.com> & oliva

	formatting error in amoverview fixed.
	-Terje Malmedal <tm@odin.funcom.com>

Version 2.4.0b6p4

	use vdump to dump advfs filesystems only.  add support for vdump
	indexes.
	-Martyn Johnson <Martyn.Johnson@cl.cam.ac.uk> & oliva

	change index generation commands so that they are less prone
	to be fooled by blanks or strange characters in filenames.
	-oliva

	check whether exclude-list file exists before calling gnutar.
	If it does not, log a message to debugging file and discard it.
	selfcheck should check for that too, and print a warning message,
	but this is left for a future version.  -oliva

	fix sendbackup-gnutar crashing problem.  -oliva

	ensure that, in case of tape failure when dumping to tape, no
	incremental relative to the failed backup is performed.
	-oliva & Liudvikas Bukys <bukys@cs.rochester.edu>

	Fix buffer use and write() error handling in the index pipeline.
	-Dietmar Goldbeck <dietmar@telemedia.de>
	& Lars Fenneberg <lf@elemental.net>

	new index generation commands.  -oliva

Version 2.4.0b6p3

	accept curses and ncurses in addition to termcap for readline
	support, just as readline itself does.  -oliva

	fix NO-ROOM handling when Kerberos encryption is enabled.
	-oliva & Eric Siegerman <erics@now.com>

	patch file for automake 1.2d provided. -oliva

	sendbackup.debug now contains the argument list of child
	processes. -oliva

	wait() for child processes, such as server compressor, before
	accepting other commands.
	-Liudvikas Bukys <bukys@cs.rochester.edu>

	amrecover will print an error message if it is not run by root.
	It will not crash if you `pwd' before selecting a disk.  -oliva

	updated to libtool 1.0i. -oliva

	fixed tape block size of vxdump on HPUX 10.20.
	-Andrew Ivanov <ivanov@mics.msu.su>

	Use "a" mode instead of "w" for the fdopen of the debug file.
	-David Lamkin <drl@net-tel.co.uk>

	allow multiple concurrent gnutar backups, by fixing amandates
	locking mechanism.
	-Liudvikas Bukys <bukys@cs.rochester.edu>

	amdump should check for a hold file, as says the man-page.
	-oliva

	fix automatic enabling of USE_RUNDUMP for systems that require
	this.  xfsdump support no longer requires USE_RUNDUMP to be
	defined, rundump will be enabled and used for xfs filesystems
	even if USE_RUNDUMP is not defined, unless XFSDUMP is not defined.
	This seems to have completely solved the xfsdump problems.
	-oliva

	when USE_RUNDUMP is enabled, instead of checking for read or write
	access in selfcheck, just test for the existence of disk devices.
	-oliva

	fixed code that computed the dump size when incomplete
	writes occurred in dumper.  -Eric Siegerman <erics@now.com>

	amplot no longer crashes if there's no holding disk. -oliva

Version 2.4.0b6p2

	fix xfsdump index generation command.
	-Robert Tarrall <tarrall@bamboo.colorado.edu>

	tape device wouldn't rewind if opened O_WRONLY.
	-Palle Girgensohn <girgen@partitur.se> & oliva

	use setpgid instead of setpgrp if available
	-Mark Woodford <woodford@uniprise.com> & oliva

	chg-mtx will check whether slot 6 is a cleaning tape or not.
	-Martyn Johnson <Martyn.Johnson@cl.cam.ac.uk>

	amrmtape updated to text database.  -oliva

	incorrect NO-ROOM error when dumping directly to tape fixed.
	-oliva

	--with-user and --with-group become are now required.  -oliva

	patch-system script much more configurable.  -oliva

	amindexd must get an exact match for diskname.
	-Richard Kail <e8903122@student.tuwien.ac.at> & oliva 

	fix serial number message in amflush
	-Liudvikas Bukys <bukys@cs.rochester.edu>

	removed backslashes from inside macro calls.
	un-indented # directives.
	-Gregory Neil Shapiro <gshapiro@WPI.EDU>

	bsd-security is now enabled by default.  -oliva

	fixed estimate command for XFSDUMP.
	-Mark Radleigh <radleigh@image.ucr.edu>
	& Jeff Moskow <jeff@rtr.com>

Version 2.4.0b6p1

	documented etimeout configuration option.  -oliva&jrj

	prevent a few crashes in dumper and reporter.  -jrj

	reporter would report the same host and disk for RESULTS MISSING.
	-martineau

	fix a few file-locking configure bugs.  -oliva

	chg-multi updates and bugfixes.
	-Liudvikas Bukys <bukys@cs.rochester.edu>

Version 2.4.0b6

	amindexd bugfix -Jos Alsters <Jos.Alsters@sci.kun.nl>

	New --disable-libtool configure option, for those who really don't
	want libraries to be installed.  Shared libraries won't be
	built, of course.  -oliva

	samba-related bugfixes.
	-Klaus Thiele <kth@becker-software.com>

	xfsdump, DNS and amidxtaped bugfixes. -martineau

	exclude-list support was broken, the filename was not copied
	to the gnutar argument list.
	-Stefan Bohm <Stefan.Bohm@rp-online.de>

	chg-chio still thought it was seagate-changer, and contained a
	few bugs.  -Tim Tsai <tim@futuresouth.com>

	New file docs/RESTORE, by Daniel Moore <dmoore@jeffco.k12.co.us>

Version 2.4.0b5

	Make sure amverify waits for the tape device to be ready before it
	starts reading each section. -oliva

	Fix amrecover so that it accepts filenames with blanks.
	-J. Shirk <jshirt@ksu.edu> & oliva

	Add a TIMEOUT config file parameter to replace the hard coded value
	in planner.  -Daniel David Benson <bensond@ucdavis.edu>

	Change amrecover/amindexd/amidxtaped to require a SECURITY
	exchange if --with-bsd-security is enabled.  It is done on a
	reserved port, which means amrecover must be run as root and that
	amindexd/amidxtaped need an entry for the incoming amrecover in
	either .rhosts or .amandahosts (Kerberos is not yet supported).  --JJ

	Make our internal TEXTDB the default database style for the infofile.
	If you wish to keep using a dbm style database use the configure
	option "--with-db={db,dbm,gdbm,ndbm}".
	-scott

	Sanitise the disk name in the TEXTDB code.
	**NOTE** if your infofile database uses TEXTDB (which has only been
		 available since Amanda-2.4.0b1) and you have '/'s in the
		 first field in disklist you will need to 'amadmin export'
		 the data using the old version of Amanda, 'mv' the old
		 database out of the way and 'amadmin import' it back again
		 using the new version.  When you are happy with the new
		 version you may delete the old database.
	-scott

	Get rid of DEV_ROOT/DEV_RROOT and figure out the raw name on the
	fly by trying a leading 'r' before each path element one at a time
	until we find a character device.  This should handle all the current
	cases plus things like Solaris DiskSuite that have /dev/md/rdsk/xxx
	names.  -JJ

	Change kill logic in sendsize to try TERM first, then KILL if that
	does not get dump's attention.  This fixes a problem on AIX 4.x
	where dump was always getting a KILL and leaving orphaned message
	queues, which would eventually run the system out of resources.  -JJ

	Extensive buffer management, bug and defensive coding overhaul
	including:
	    * Use proper fgets/fread/read buffer size.
	    * Wrote agets and areads to get a line without buffer overflow
	      and changed most gets/fgets and some read calls to use it.
	    * Replaced all *scanf("...%s...") with explicit pointer work.
	    * Replaced most fixed size buffers with dynamic ones.  This has
	      no doubt introduced some memory leaks.
	    * Replaced most sprintf calls with vstralloc (new routine).
	    * Added overflow checks to some remaining explicit buffer
	      management.
	    * Made almost all read() and write() calls into loops to handle
	      short and broken up transfers.
	    * Fixed potentially uninitialized fstype field.
	    * Added more sanity checks when parsing various things, including
	      converting some assert() calls to real code.
	    * The pattern amtrmidx used to find old index files to delete
	      thought the date field was YYYY-MM-DD, but it is YYYYMMDD,
	      so no files were being deleted.
	    * Limited the number of directories listed by amflush to 26 to
	      avoid funny characters in the user prompt.
	    * Changed some of the amrecover routines to soak up the rest of
	      the continuation lines after an error.
	    * If a dumper dies, driver still tries to send a QUIT command
	      which fails because the file descriptor has been closed.
	    * Wrote afree macro that calls free and then sets the pointer
	      to NULL.  Changed most free calls to afree.
	    * Wrote aclose/afclose/apclose macros to do the associated close
	      and then set the argument to something invalid (-1 or NULL).
	    * Check the file descriptor before calling FD_ISSET in dumper.
	      Otherwise it goes to -1 on EOF and FD_* doesn't like that.
	    * Call aclose() after FD_CLR (so the descriptor is not -1).
	Odds and ends:
	    * Added some TEXTDB support code to the infofile test program.
	    * Set it up so -DPROTO_DEBUG could come from the compiler command
	      line instead of having to modify the source.
	    * Added -t command line flag code to sendbackup.c to support some
	      limited debugging.
	    * Added a test to amcheck to see if the log file is writable
	      (if it already exists).  During debugging, I keep leaving one
	      around owned by root :-).
	    * Changed upper limit on close loops from 255 to FD_SETSIZE.
	      This probably needs some more study.
	-JJ

	If krb4 auth was compiled in but not enabled, clients would hang
	forever.  -Aidan Cully <aidan@panix.com>

	Make sure SAMBA will not clear archive bits when performing an
	incremental backup, so any incremental will be a level 1.
	-martineau

	Add a LOGDIR option to amanda.conf and use it to replace the
	--with-logdir option to configure (this was only used for the
	amdump files) and the logfile option in amanda.conf.  Log
	files are now LOGDIR/log and amdump files are LOGDIR/amdump.
	Note: if there is a LOGFILE option in amanda.conf it has its
	filename removed and is used as the LOGDIR (eg, if you have
	"logfile /usr/adm/amanda/log" in amanda.conf it is translated to
	"logdir /usr/adm/amanda" instead).  This should not cause a
	problem for most sites.
	-scott

	Remove --with-dbdir option from configure.  This was only used
	to setup things for the man pages and example files.  Oh.. and
	amrmtape.  Fix this as well.
	-scott

	Remove --with-indexdir option from configure.  This is obtained
	from amanda.conf at run time.  Also fix things so that it *is*
	obtained from amanda.conf in all cases.
	-scott

	This is no longer tested on configure.in, since it is
	expressly forbidden to include kernel headers under glibc,
	according to Matthias Urlichs <smurf@noris.de>.  However, Eric
	Doutreleau <ed@cti.ecp.fr> said he needed to include this
	header file in order to build amanda on
	sparc-unknown-linux-gnu.  -oliva

	It is now possible to specify a username to be used to backup
	up with samba.
	-Jean-Louis Martineau <martinea@iro.umontreal.ca>

	Make sure dumper replies with ABORT_FINISHED when a PORT-DUMP
	is aborted because of tape error.
	-Michael C. Povel <Michael.Povel@hub.de>

	Amcheck checks only for the needed features.
	-Jean-Louis Martineau <martinea@iro.umontreal.ca>

	Performance and memory-usage improvements to amrecover.
	-Jean-Louis Martineau <martinea@iro.umontreal.ca>

	Use extended regular expressions.
	-Noel Hunt <noel@jpmorgan.com>

	Fixed regular expressions for samba support.
	-Brian Fernald <fernald@nsi.edu>

	Fixed a few bugs that caused arithmetic exceptions in planner.
	-Bob Willcox <bob@luke.pmr.com>, Evan Champion
	<evanc@synapse.net>, scott and oliva

	amrecover should now be able to handle GNUtar restores.
	-Jean-Louis Martineau <martinea@iro.umontreal.ca>, plus
	incremental (-G) patch by Lars Fenneberg <lf@elemental.net>

	Ported to SINIX (Reliant Unix V5.43).
	-Michael Schmitz <mschmitz@iname.com>

	Configure now looks for large file support and will use it under
	Solaris 2.6 and above.
	-Blair Zajac <blair@gps.caltech.edu>

	Compatibility problems fixed for:
		SCO OpenServer 5.0.2: Paul Gampe <paulg@twics.com>

Version 2.4.0b4

	New changerfile and changerdev configuration keywords, that
	allow changer scripts to be configured in the main amanda
	configuration file.  Each changer script has been adapted, so
	that it uses those flags whenever possible.  Also,
	documentation about built-in scripts has been added to
	docs/TAPE.CHANGERS.  -oliva & Eric Schnoebelen
	<eric@egsner.cirr.com>

	--with-debugging now accepts a directory name, where debugging
	files should be stored.  -John R. Jackson <jrj@cc.purdue.edu>

	Compatibility problems fixed for:
		NextStep 3.3: Fabrice GAILLARD <gaillard@ina.fr>
		SCO OpenServer V5: Christopher B. Olsen <colsen@compus.com>
		AIX: Georg Rehfeld <georg@wmd.de>

	Planner would core dump if it had to delay dumps.  -Georg
	Rehfeld <georg@wmd.de>

	Added patch for samba to support very long filenames.  -Todd
	Pfaff <todd@edge.cis.mcmaster.ca>

	Added VXDUMP support to estimate program.  -oliva & John
	R. Jackson <jrj@cc.purdue.edu>

	Fixed amflush so that it cd's to the configuration directory
	before invoking reporter.  -oliva

	driver no longer opens the infofile, so a deadlock is
	prevented.  -oliva & John R. Jackson <jrj@cc.purdue.edu>

	Fixed typo in sendbackup-dump that would prevent compilation
	if either xfsdump or vxdump were enabled.  -oliva

	Debugging messages produced by sendbackup are no longer
	included in the dump stream.  -oliva

	amrestore should wait for the child process to die before
	re-opening the tape device.  -Dietmar Braun
	<dietmar@tin-lizzy.hig>

Version 2.4.0b3 

	fixed race condition in debug file open operation.  -oliva and
	Thomas Schmeidl

	exclude-list and exclude-file are correctly handled by
	sendsize.  -oliva and Johann Klasek <jk@auto.tuwien.ac.at>

	fix some kerberos4 problems; no longer require low ports for
	kerberized connections; now use amanda@REALM instead of
	amanda.amanda@REALM in .klogin's.  -kovert

	amrecover no longer depends on GNU flex library.  -oliva

	Ensure that malloc(0) is not called.  -Wolfram Schmidt
	<Wolfram.Schmidt@iao.fhg.de>

	Compression is now performed where specified, and server
	compress best specifications are obeyed. -oliva

	genversion now correctly recognizes the selected locking scheme.
	-Thomas Schmeidl <schmeidl@nwp.kwu.siemens.de>

Version 2.4.0b2

	Several bugfixes by John R. Jackson <jrj@cc.purdue.edu>

	AIX's restore support added to amrecover.  -David B. Anderson
	<dbanders@mail.physics.utah.edu>

	Dump process would not be killed unless it supported the -E
	flag (flipped #ifdef): fixed.  -Steve Bower <sbower@raytheon.com>

	--with-testing now supports a trailing argument, that
	specifies the a string to be appended to service names.  -oliva

	Recent versions of Samba require additional arguments so that
	estimates and total sizes are logged to stdout, not to syslog.
	-Ernie Oporto <ernie_oporto@MENTORG.COM> & Norbert Holzknecht
	<Holzknecht@fs31.vdeh-bfi.de>

Version 2.4.0b1

	Improved planner backup-delaying mechanism.  -scott

	Concurrent estimates are now supported.  -oliva

	Shared library support included with GNU libtool.  -oliva

	New hard-link-based locking mechanism for operating systems
	that do not support standard locking system calls.  -scott

	New configuration file format, simpler and easier to
	extend.  -scott

	New curinfo database format that uses only text files.  The
	old dbm format is used by default, though.  -scott

	DGUX support. -Brian Harvey <bharvey@raven.phs.com>

	Tentative HPUX vxdump support.  -oliva

	Integrated amgetidx into dumper/sendbackup protocol.  This
	***breaks backward compatibility***!  -oliva

	Have sendbackup-dump and sendbackup-gnutar list the actual
	program that should be used to restore a file from a backup
	instead of just listing restore or gtar. -blair&oliva

	Have configure check for the initgroups() declaration in
	unistd.h in addition to grp.h and sys/types.h, which is where
	some OSes have the declaration. -blair

	SAMBA backups wouldn't succeed if GNUTAR listed incrementals
	were enabled.  SAMBA password file can now specify workgroup
	and may contain comments.  -oliva

	Fixed xfsdump support. -oliva

	Fixed srvcompress option. -oliva

	Fixed exclude/exclude-list support. -oliva

	Change umask to 066 before creating index file in /tmp. -oliva

	Fixed autoconf for gdbm on linux. -oliva

	configure now seeks out a few possible locations for
	kerberos4 includes and tries to find the correct path if
	the kerberos bits have been installed.  It's possible for
	someone to just specify the root of a kerberos tree for
	where the bits live, as well. -kovert

Version 2.3.0.4

	Have bsd_security_ok() in amandad return 1 when BSD security is
	not turned on.  Patch from Michael C. Grant
	<mcgrant@rascals.Stanford.EDU>.

	Add a configure option, --with-db, which lets the user specify
	the database library to use.  The available codes to look for
	are db,dbm,gdbm,ndbm.  The new configure code goes to a lot
	more length to find pairs of header files and libraries.  If a
	header file exists and the library does not, but dbm_open() is
	found by linking against -lc, then that header file is used.
	Patch from Blair Zajac <blair@gps.caltech.edu>.

	Fixed bug at line 158 where selfcheck was testing that the
	result returned by open() was nonzero.  The correct thing to do
	is check for non-negative values returned by open().  Changed
	the "ERROR" in line 169 to "OK" to prevent selfcheck from
	flagging the non-existence of /etc/amandapass as an error.
	Using "OK" in this line flags this condition as an informative
	statement rather than an error - which is to say this will be
	reported along with other errors but it isn't enough in itself
	to generate an error report.  The reason that I think this is
	the right fix is because although every Amanda client is
	capable of backing up PCs using smbclient it isn't the case
	that we will back up PCs with every Amanda client.  This also
	implies that we don't want to have /etc/amandapass files on all
	these machines either.  If an Amanda client does have a samba
	"//host/share" entry in its disklist file then selfcheck will
	flag the non-existence of the /etc/amandapass file on line 105
	when it attempts to check that partition, so I believe that
	this is a safe fix.  Patch from Michael Brantley
	<Michael-Brantley@deshaw.com>.

	Have all calls to gethostname() leave the result in character
	arrays of length 1025.  This will make sure that gethostname
	behaves correctly.  Patch from  blair Zajac
	<blair@gps.caltech.edu>.

	Have amrecover.c include history.h or readline/history.h if
	configure finds it.  Patch from blair Zajac
	<blair@gps.caltech.edu>.

	Have Amanda use cat if gzip and compress cannot be found.  In
	this case, do not #define COMPRESS_FAST_OPT, COMPRESS_BEST_OPT,
	or UNCOMPRESS_OPT as "" since cat will look look for a file by
	the name of "".  Place #ifdef's around code that uses any of
	the _OPT defines.  Patch from Blair Zajac
	<blair@gps.caltech.edu>.

	Rewrite amgetidx to use amandad instead of rsh/rcp.  amgetidx
	now only gets the index files from a given day.  It now takes
	two optionally arguments <on day> or <ago days>.  <on day> lets
	the user specify the day in one of the forms YYYYMMDD MMDD DD
	YYYY-MM-DD --MM-DD ---DD.  <ago days> gets the files from days
	days ago.  Have configure look for an appropriate directory to
	use for the temporary files on the clients.  Use /var/tmp, then
	/usr/tmp, and if neither of those exist, then use /tmp.  Have
	selfcheck check if the index holding directory has enough space
	in it.  Add a new program called sendindex which sends the
	index files.  Add the file docs/INDEXING which describes the
	index code.  Patch from Alan McIvor <alan@auck.irl.cri.nz>.

	Have configure set up mt to use either the -f or the -t option
	depending upon the operating system.  Patch from Blair Zajac
	<blair@gps.caltech.edu>.

	Include the amanda_tapetypes.txt file as docs/TAPETYPES.  File
	composed by Chris Stacey <chris@snrc.uow.edu.au>.

	Allow certain dumptypes to be kicked off at specific times.
	Add a new, optional, parameter to the dumptype description in
	the config file.  The parameter is called "starttime" and takes
	one argument which is a time of day (local timezone) formated
	as either hhmm or hmm (no `.'s, no `:'s, just an integer).
		define dumptype comp-user-2am {
			comment "Non-root partitions on fast machines"
			options compress-fast
			priority medium
			starttime 0200
		}
	Any partitions listed in disklist with this dumptype will be
	fired off no earlier than 2am.  If 2am today is less than 43200
	seconds past (12 hours ago) it will assume you meant 2am today
	and fire the dumps off right away.  But if 2am today is more
	than 12 hours in the past, it will wait till 2am tomorrow.
	Patch from Brad Huntting <huntting@misc.glarp.com>.

	Totally rewrite the socket buffering code for dumper.
	Eliminate SO_SNDTIMEO and SO_RCVTIMEO setsockopt calls.  Remove
	the check for HAVE_SO_SNDTIMEO from configure.  Add a new
	option to configure named --enable-buffered-dump to enable this
	code.  Patch from Brad Huntting <huntting@misc.glarp.com>.

	Have amflush call setsid() to detach amflush from the
	controlling terminal.  Patch from Ken Laprade
	<klaprade@harris.com>.

	Have configure correctly work on systems where dbm_open is in
	libc.  Patch from Farzad Farid <farzy@sgip.fr>.

	Patches to amrmtape which remove C style comments and let the
	script remove a tape if there is only one tape in the tapelist
	file.  Patch from Andrew A. Ivanov <IVANOV@mics.msu.su>.

	Sprintf formatting error in amgetidx fixed.  Patch from Yossi
	Gottlieb <yogo@xpert.com>.

	I'm using a Sony SDT/STL-7000 4mm DAT changer.  I could not
	find any method of directly controlling the device, except for
	simply using the 'offline' mt command for advancing to the next
	tape.  Using this method, however, I could not go beyond the
	last cassette (that is, to roll back to the first one).  This
	means the device is currently being used as a simple gravity
	changer, only able to change forward.  The chg-generic.conf
	should list the default tape device for all slots, disable
	'needeject', enable 'gravity' and enable the new option named
	'multieject'.  Patch from Yossi Gottlieb <yogo@xpert.com>.

	Update the example chg-generic.conf file to include comments
	that describe how to use the multieject feature of the script.
	Patch from Yossi Gottlieb <yogo@xpert.com>.

	Protocol seems to loop when a A_TIMEOUT occurs because
	p->reqtries was not being decremented.  Problem noted by Neal
	Becker <neal@ctd.comsat.com>.

	About half the calls to gethostname() in Amanda fail to
	null-terminate properly.  This patch makes them all
	consistent.  In addition it updates sendbackup-dump and
	sendbackup-gnutar so they handle USE_FQDN is a way consistent
	with the amindex stuff.  In particular when USE_FQDN is set,
	the dump clients will not truncate their hostname before
	putting it in the dump headers.  My patches to amflush are
	already in the Amanda betas so amflush should be able to match
	up both FQDN and non-FQDN clients against FQDN and non-FQDN
	disklist files.  I also fixed an error message that was
	attributed to gethostname when it actually came from
	getpeername.  Patches from James Mathiesen
	<james@nyc.deshaw.com>.

	I have run into the problem, on a Linux system, where the first
	time I run configure it generates valid Makefiles and Amanda
	compiles without problem.  If I run configure again, or I alter
	a Makefile.in or something which causes autoconf to be called,
	the resulting Makefiles are no good - the programs in
	server-src don't finish linking because there is no dbm
	library.  That is, the first time through configure -lgdbm is
	added to LIBS but the second, and any subsequent times, it is
	not.  Patch from Alan McIvor <alan@auck.irl.cri.nz>.

	I've just found a bug that has prevented Amanda from running on
	my site for almost one week.  Just after a dumper replied that
	it timed-out, the driver would send it another dump request.
	Then the driver would log to amdump an event of receiving a
	message from the dumper, but that message would be empty, the
	holding file for the requested filesystem would not exist, and
	driver would quit.  It turned out that the problem was that
	dumper started to close its sockets (datafd, mesgfd and outfd)
	since release 2.3.0.4b3.  outfd is initialized before invoking
	startup_dump, but it is sendbackup_response, intended to be
	invoked by the amandad protocol driver, that opens sockets and
	initializes datafd and mesgfd.  If sendbackup_response is never
	run (because the amandad request times out), datafd and mesgfd
	will not be initialized, so they may contain already closed
	(and possibly already reopened) file descriptor numbers or
	still be uninitialized, containing any garbage, but usually 0
	--- but 0 is stdin, used for reading commands from the driver,
	it should not be closed!  I've solved the problem by
	initializing them to -1 in startup_dump.  Patch from Alexandre
	Oliva <oliva@dcc.unicamp.br>.

	Include declarations for select(), bind(), connect(), fread(),
	fwrite(), getopt(), getpeername(), getsockname(), getsockopt(),
	initgroups(), listen(), lstat(), mktemp(), mktime(), puts(),
	recvfrom(), select(), sendto(), setpgrp(), setsockopt(),
	shmat(), shmctl(), shmdt(), shmget(), socketpair(), sscanf(),
	strftime(), strncasecmp(), system() if the system does not
	declare these in any header files.  Patch from Blair Zajac
	<blair@gps.caltech.edu>.

	Have configure correctly substitute for DB_DIR and LOG_DIR in
	example/amanda.conf when --prefix was not used.  Problem noted
	by Philippe Charnier <charnier@xp11.frmug.org>.

	Include seagate-changer.c from Larry D. Pyeatt
	<pyeatt@cs.colostate.edu>.  This program was written to control
	the Seagate/Conner/Archive autoloading DAT drive.  This drive
	normally has 4 tape capacity but can be expanded to 12 tapes
	with an optional tape cartridge.  This program may also work on
	other drives.  This program works for me under Linux with Gerd
	Knorr's <kraxel@cs.tu-berlin.de> SCSI media changer driver
	installed as a kernel module.  The kernel module is available
	at
	http://sunsite.unc.edu/pub/Linux/kernel/patches/scsi/scsi-changer*
	Since the Linux media changer is based on NetBSD, this program
	should also work for NetBSD, although I have not tried it.  It
	may be necessary to change the IOCTL calls to work on other
	OS's.

	Add a new configure option, --with-group, which tells Amanda
	the group to install all files as.  Patch from Alexandre Oliva
	<oliva@dcc.unicamp.br>.

	If --with-bsd-security was not set, then dumper would not find
	the amanda/udp port to use to connect to clients.  Patch from
	Alan McIvor <alan@auck.irl.cri.nz>.

	The order of dump programs to search for (ufsdump, vdump, dump,
	backup) didn't work on AIX systems, where backup should be used
	but a program named dump exists on the system.  Patch by Blair
	Zajac <blair@gps.caltech.edu>.

	The configure --with-mmap was not working properly since
	configure was using the wrong variable to see if the system had
	a working mmap().  Problem noted by Keith Mitchell
	<kmitch@weenix.guru.org>.

Version 2.3.0.4b3

	Save the results of getchar() into int's instead of char's in
	amidxtaped.c.  Patch by Blair Zajac <blair@gps.caltech.edu>.

	Fix sendbackup-gnutar so that it can be compiled with a K&R
	compiler.  Patch by Blair Zajac <blair@gps.caltech.edu>.

	Since I installed Amanda 2.3.0.4b3, I noticed some annoying
	messages in amdump:
		dumper: pid 8696 setsockopt(SO_SNDTIMEO): Invalid argument
	This is because Solaris 2.5 does declare SO_SNDTIMEO in
	sys/socket.h, but fails to setsockopt with the given
	arguments.  Unfortunately, it is not documented, so I could not
	find out the correct way to do this, so I just added a test in
	configure to check whether SO_SNDTIMEO works as expected or
	not.  Patch from Alexandre Oliva <oliva@dcc.unicamp.br>.

	Include amplot-2.2.6 written by Olafur Gudmundsson
	<ogud@tis.com> into Amanda.  Have amplot be configured using
	configure instead of amplot.conf.  It will be installed if
	gnuplot and the version of awk configure finds can handle
	variable assignment from the command line.  I also changed some
	of the command line options so that the amdump files will not
	be compressed unless amplot is told to do so on the command
	line.  It also takes a new command line option, -t, which lets
	the user set the time of the right side of the plot.  Work done
	by Blair Zajac <blair@gps.caltech.edu>.

	Made rth-changer check all system calls for valid returns.
	Patch by Blair Zajac <blair@gps.caltech.edu>.

	amrestore.c and sendbackup-common.c would do an ifdef on
	HAVE_GZIP, which was no longer being defined if Amanda was
	using gzip.  Now, define HAVE_GZIP if gzip is being used.
	Patch by Blair Zajac <blair@gps.caltech.edu>.

	Include a script, amoverview, that outputs an overview of all
	of the backups done on all of the disks.  Script written by
	Dave Disser <disser@sdd.hp.com>.

	The prototype for amname_to_fstype() is missing in
	createindex-dump.c when xfsdump is available.  Patch from Ken
	Laprade <klaprade@harris.com>.

	Apparently SGI provides a dummy libsun.a that does not really
	have anything in it.  I guess this tricks configure into adding
	it to the Makefile.  Have configure not check for libsun.a on
	SGI systems.  Patch from Ken Laprade <klaprade@harris.com>.

	The global variable overwrite in amcheck.c apparently is seen
	as a potential conflict with the overwrite() curses function
	which is apparently in SGI's libtermcap.a.  Declaring the
	variable static eliminates the warning.  Patch from Ken Laprade
	<klaprade@harris.com>.

	Add a new configure option, --with-fqdn, which allows Amanda to
	back up systems in different domains.  This requires that the
	disklist file have the fully qualified domain names (FQDNs)
	listed.  Patch from Joe Ammond <Joe.Ammond@ee.gatech.edu>.

	Include rundump, a setuid program that runs dump as root.  This
	is used under OSF1 systems.  Patch from Alexandre Oliva
	<oliva@dcc.unicamp.br>.

	Install setuid files executable only by the owner and group of
	the files.  This stops other users from running these programs,
	making security tighter.  Patch from Alexandre Oliva
	<oliva@dcc.unicamp.br>.

	On FreeBSD 3.0, amanda.h needs to include <sys/types.h> before
	<dirent.h>.  Problem noted by Keith Mitchell
	<kmitch@weenix.guru.org>.

	Amanda had a bug regarding the recent addition of support for
	excluding files in GNUTAR.  planner and sendsize did not
	understand each other about empty exclusion lists, so there
	were failures using gnutar, as dump does not support excludes.
	Patch from Alexandre Oliva <oliva@dcc.unicamp.br>.

	Fixed a problem in configure where DUMP was being set to
	/no/restore/available when no restore program could be found
	instead of setting RESTORE to this.  Patch from Alexandre Oliva
	<oliva@dcc.unicamp.br>.

	Have no-changer and hp-changer check for the existence of the
	logging directory before trying to use it.  Patch by Blair
	Zajac <blair@gps.caltech.edu>.

	Patches to have nicer looking Samba support code.  Patch from
	Michael Zucchi <cismpz@cis.unisa.edu.au>.

	Got Amanda to compile fine on a m88k-motorola-sysv4 system.
	Patches from Blair Zajac <blair@gps.caltech.edu>.

	In amandad.c, pk_t dupmsg was conflicting with dupmsg in
	/usr/include/sys/stream.h on an m88k-motorola-sysv4 system.
	Rename dupmsg to dup_msg.  To keep things consistent, rename
	inmsg to in_msg and outmsg to out_msg.  Patch by Blair Zajac
	<blair@gps.caltech.edu>.

	Check for the dbm_open declaration in any header file that may
	contain it.  If it doesn't exist, then declare it and all of
	the other dbm_ functions.  Check if struct datum is declared in
	any header files and if it isn't then declare it.  Patch from
	Blair Zajac <blair@gps.caltech.edu>.

	Have runtar make sure that it is being invoked by the
	CLIENT_LOGIN user, since it is a suid executable.  Patch from
	Alexandre Oliva <oliva@dcc.unicamp.br>.

	Have selfcheck check for /etc/vdumpdates if vdump is being
	used.  Patch from Alexandre Oliva <oliva@dcc.unicamp.br>.

	If we're on an Ultrix system, then define STATFS_ULTRIX.  Patch
	by Blair Zajac <blair@gps.caltech.edu>.

	amadmin export produces a full version number (2.3.0.4b2, for
	instance), while amadmin import expects three integers
	separated by dots, so it fails to import an exported file by
	itself.  Patch by Alexandre Oliva <oliva@dcc.unicamp.br>.

	Sendsize.c would loop forever if debugging was not turned on.
	Patch from Alexandre Oliva <oliva@dcc.unicamp.br>.

	Define STATFS_OSF1 if we are on a *-dec-osf-* system.  Change
	ifdef OSF1_HANG_BUG to ifdef OSF1_VDUMP, since I'd rather not
	have too many defines floating around.  Patch by Blair Zajac
	<blair@gps.caltech.edu>.

	There was a bug in selfcheck.c when Blair installed the Samba
	support.  I deleted an extra space that was added after
	SAMBA_CLIENT when the command was being put together.  Fix by
	Michael Zucchi <cismpz@cis.unisa.edu.au>.

	Add a needed ; to client-src/Makefile.am and
	server-src/Makefile.am.  Patch from Alexandre Oliva
	<oliva@dcc.unicamp.br>.

	Have planner.c and amcheck.c always get the amanda port number
	even if BSD security is turned off.  Patch by Blair Zajac
	<blair@gps.caltech.edu>.

	Change the way amgetidx caches host up/down information.  It
	used to stralloc() a string depending on if the host was up or
	down.  Now, create two static character arrays, one holding
	"down" and the other holding "up" and simply point the
	hostinfo->up pointer to one of the two arrays.  This should
	save a little memory.  Patch by Blair Zajac
	<blair@gps.caltech.edu>.

	The Bourne shell in FreeBSD can't handle setting IFS to : and
	expanding $LOCPATH:$SYSPATH.  Create two new variables before
	their use called $LOCSYSPATH and $SYSLOCPATH.  Patch by Blair
	Zajac <blair@gps.caltech.edu>.

	Have open_fstab for BSD systems return the value of setfsent.
	Patch by Blair Zajac <blair@gps.caltech.edu>.

	Configure was searching for the dump program in the following
	order: ufsdump, vdump, backup, dump.  On HP-UX systems,
	configure would find backup, which is a valid program but does
	not do what dump does.  So switch the order of the programs to
	ufsdump, vdump, dump, backup.  Patch by Blair Zajac
	<blair@gps.caltech.edu>.

	Fixed some dbprintf(()) bugs in amgetidx.c.  Patch by Blair
	Zajac <blair@gps.caltech.edu>.

	Have amrecover.c always declare
	    extern char *optarg;
	    extern int optind;
	This makes amrecover.c compile on Ultrix systems.  Problem
	noted by Scott Gasch <scott@cray-ymp.acm.stuorg.vt.edu>.

	Patch to configure to have it recognize gnutar version 1.11.2.
	Patch from Alexandre Oliva <oliva@dcc.unicamp.br>.

Version 2.3.0.4b2

	Have amcleanup, no-changer, and hp-changer find out where the
	logging directory, or amdump error file is from getconf instead
	of using @LOG_DIR@ or @DB_DIR@ from configure.  Problem noted
	by Joe Ammond <Joe.Ammond@ee.gatech.edu>.

	Remove VarDir=@DB_DIR@ from amrmtape.sh.in, since amrmtape
	figures out where the curinfo files are from the amanda.conf
	file.  Problem noted by Joe Ammond <Joe.Ammond@ee.gatech.edu>.

	Include rth-changer, a tape changer script for the Robotic Tape
	Handling system OEM'd by Andataco (RTH-406).  Script written by
	Erik Frederick <edf@tyrell.mc.duke.edu>.

	Add a new configure option called --with-pid-debug-files which
	has Amanda append the process ID to the debugging files placed
	in /tmp.  The PID will not be appended unless this option is
	used.  Suggestion by Joe Ammond <Joe.Ammond@ee.gatech.edu>.

	Add a new #define UNCOMPRESS_OPT to pass to UNCOMPRESS_PATH to
	get compressed standard input decompressed and pass it to
	standard output.  The configure script only recognized gzip and
	compress right now, so it will set UNCOMPRESS_OPT to -dc and
	set UNCOMPRESS_PATH to the same value as COMPRESS_PATH.  Edit
	all of the files that make use of UNCOMPRESS_PATH to also make
	use of UNCOMPRESS_OPT now.  Patch by Blair Zajac
	<blair@gps.caltech.edu>.

	The readline() substitute in amrecover.c when the real
	readline() code is not available did not return to the caller
	what the user typed in.  It now does so.  Patch from Blair
	Zajac <blair@gps.caltech.edu>.

	Avoid -lnsl on Irix.  On IRIX 5.x and 6.x systems that have the
	svr4net module installed, there will be a /usr/lib/libnsl.so
	present on the system. The configure script looks for this and
	tosses into the library list if it's there.  It is not
	advisable to link against libnsl on IRIX unless you really need
	it for SVR4 networking (TLI/STREAMS). If you _do_ link against
	it, you should use include '-lc' _before_ '-lnsl'. The reason
	for this is that libnsl.so also contains the SysV TI-RPC code,
	which is RPC based on STREAMS/TLI rather than sockets. (Solaris
	2.x now uses this by default.) TI-RPC has some compatibility
	functions with the same names as older RPC functions, such as
	clnt_call(), clnt_create(), clnt_destroy(), and these conflict
	with the functions in libc.so. The main place this will hose
	you is NIS: NIS v2 expects the underlying RPC code to use
	sockets, not STREAMS, and it fails if the TI-RPC symbols in
	libnsl.so override the RPC symbols in libc.so.  Again, you
	don't need libnsl.so unless you're actually using STREAMS/TLI
	or TI-RPC, so in Amanda's case it's safe to just ignore it. If
	you _do_ need it, you must do 'cc -o foo foo.c -lc -lnsl' in
	order to make sure the linker resolves the RPC symbol
	references correctly. The primary symptom of this problem is
	that things like getpwent(), getgrent() and getnetgrent() stop
	working in an NIS environment.  To make a long story short: on
	IRIX, avoid using libnsl. Amanda doesn't need it anyway. So far
	I haven't encountered a problem with this, but you never know.
	Note from Bill Paul <wpaul@ctr.columbia.edu>.

	Include patches to have Amanda do incrementals of gnutar based
	backups.  Patch from Alexandre Oliva <oliva@dcc.unicamp.br>.

	Delete the GNUTAR_BROKEN_PIPE from configure and acconfig.h
	since no code was testing for it.  Patch by Blair Zajac
	<blair@gps.caltech.edu>.

	Have configure check for the number of arguments that
	gettimeofday takes and have clock.c use the appropriate number
	of arguments.  Patch by Blair Zajac <blair@gps.caltech.edu>.

	Have sendbackup-common.c include tapeio.h instead of defining
	BUFFER_SIZE.  Fix by Philip Guenther <guenther@gac.edu>.

	Put in more support for AIX by defining AIX_BACKUP if the
	system is an AIX system.  Fix createindex-dump.c to pass the -B
	flag to restore to have it read from standard input.  Problem
	noted by Bill Paul <wpaul@ctr.columbia.edu>.  Patch by Blair
	Zajac <blair@gps.caltech.edu>.

	Add a regexp for AIX 4's backup in sendbackup-dump.c and
	sendsize.c.  Patch from Bill Paul <wpaul@ctr.columbia.edu>.

	Add a comment to tapeio.h about BUFFER_SIZE and what it is used
	for and how people should not change it.  Noted by Bill Paul
	<wpaul@ctr.columbia.edu>.

	Added a --with-mmap option to force the use of mmap() instead
	of shared memory support.  Requested by wpaul@ctr.columbia.edu
	<Bill Paul>.  Patch by Blair Zajac <blair@gps.caltech.edu>.

	On FreeBSD 2.x and 3.x, the SO_SNDTIMEOUT value is too large in
	dumper.c.  Looking at the kernel source, the maximum value for
	tv_sec is about 227.  The value used is READ_TIMEOUT/4, or
	(30*60)/4 == 450 seconds.  This causes setsockopt() to return
	EDOM (Numerical argument out of domain), and again everything
	grinds to a halt.  I changed the value from READ_TIMEOUT/4 to
	READ_TIMEOUT/8, which reduces the SO_SNDTIMEO value to 225.  I
	haven't extensively tested this yet, but based on eyeballing
	the kernel source it should work.  Patch from Bill Paul
	<wpaul@ctr.columbia.edu>.

	In dumper.c:do_dump(), there is code to set the transmission
	timeout, receive buffer size and receive low water mark on the
	data socket using setsockopt().  For SO_RECVBUF, the receive
	buffer size (recbuf) is set to DATABUF_SIZE * 4, which is
	32*1024*4, or 131072.  On SunOS 4.1.x, this value is too
	large:  dumper generates a 'no buffer space available' error
	and everything grinds to a halt.  I took away the '*4', which
	reduces the size to 32767 bytes, which seems to work.  I'm
	surprised nobody else has noticed this since it breaks SunOS
	Amanda servers.  I can only surmise that people aren't using
	SunOS machines as servers these days. :)   Patch from Bill Paul
	<wpaul@ctr.columbia.edu>.

	Have Amanda include either readline.h or readline/readline.h
	Fix suggested by Neal Becker <neal@ctd.comsat.com>.

	Have --with-includes put the -I flags into $CPPFLAGS and
	$CFLAGS so that AC_CHECK_HEADERS will find other include
	files.  Problem noted by Neal Becker <neal@ctd.comsat.com>.

	Fixed common-src/Makefile.am to put the extra libamanda.a
	sources into the EXTRA_libamanda_a_SOURCES variable instead of
	EXTRA_DIST.  Fix from Tom Tromey <tromey@drip.Colorado.EDU>.

	When compiling amgetidx.c with some compilers, trigraph
	substitutions were being made when they should not have been.
	Protect the code from this.  Patch from Blair Zajac
	<blair@gps.caltech.edu>.

	Test for flock support in the following order:
		1) POSIX fcntl file locking
		2) flock locking
		3) lockf locking
	The common-src/flock.c file will only be used if the lockf type
	locking is needed on this system.  Patch from Blair Zajac
	<blair@gps.caltech.edu>.

	Have Samba support compile in only if requested by the user.
	Patch from Blair Zajac <blair@gps.caltech.edu>.

	Configure was not using $CFLAGS and $CPPFLAGS when trying to
	calculate the select argument type.  Patch from Blair Zajac
	<blair@gps.caltech.edu>.

	Updated amanda.h to include alloca.h if the system has it and
	if it's ok to include.  Also protect more include files with
	#ifdefs found by configure.  Patch from Blair Zajac
	<blair@gps.caltech.edu>.

	Linux does not use the raw device names to do backups.
	configure now checks to see if it can find a raw disk device
	file whose name is built from root's mount point.  If it can't,
	then set RDEV_PREFIX to use /dev/ instead of /dev/r.  Fix
	suggested by Brian <brian.s.mogged@uwrf.edu> and Ken Latta
	<latta@parc.xerox.com>.

	Fixed const cast message from regex.c.  Problem noted by Ken
	Laprade <klaprade@harris.com>.  Patch from Blair Zajac
	<blair@gps.caltech.edu>.

	Configure was not checking for the OSF1_VDUMP #ifdef used in
	Amanda.  It now will set OSF1_VDUMP if vdump is found on the
	system.  However, it does not check if the system is really a
	OSF system.  Patch from Blair Zajac <blair@gps.caltech.edu>.

	Have configure check for asm/byteorder.h for
	sparc-unknown-linux-gnu.  Problem noted by Eric Doutreleau
	<ed@cti.ecp.fr>.

	Remove the check for libintl.h from configure.  It was only
	being used for regex.c, which really didn't need it.  Patch
	from Blair Zajac <blair@gps.caltech.edu>.

	Convert all code to K&R C by trying to compile Amanda using
	/usr/bin/cc on a SunOS 4.1.1 machine.  Have configure check if
	the compiler can handle the volatile keyword and if it can't,
	#define it to empty in the config.h file.  Patch from Blair
	Zajac <blair@gps.caltech.edu>.

	Move the contents of versuff.h into version.h and remove
	versuff.h.  Add a new function called version() which returns
	the version string.  Use version() in some of the programs.
	Patch from Blair Zajac <blair@gps.caltech.edu>.

	m88k-motorola-sysv4 systems define L_FAIL, which is used by
	logfile.h.  Undefine it in logfile.h.  Patch from Blair Zajac
	<blair@gps.caltech.edu>.

	Include amindex-1.0 from Alan McIvor.  It includes these
	improvements over 0.3:
		Amrecover now provides the ability to restore files
		from the tapes, via the "extract" command.

		Support for gnutar based index generation (but not file
		restoration yet).

		Numerous bug fixes.

	Have amgetidx try to open a socket to the shell/tcp port on the
	remote machine and cache if it succeeds.  If it connection
	attempt succeeds, then attempt to get the index files over from
	the client.  Patch from Blair Zajac <blair@gps.caltech.edu>.

	Update patch-system to include the amidxtape service at
	10083/tcp.  Patch from Blair Zajac <blair@gps.caltech.edu>.

	Configure said that the server configuration was OK and then
	next said it wasn't.  Remove these checks.  Patch from Blair
	Zajac <blair@gps.caltech.edu>.

	Fixed building Amanda for multiple architectures in
	subdirectories of Amanda.  Problem noted by Thomas Hepper
	<Thomas.Hepper@icem.de>.

Version 2.3.0.4b1

	Fix a problem with `amadmin <conf> balance' dumping core.  If
	some disks are overdue, they are stored in the sequence array
	with a negative index.  This has the potential to cause memory
	corruption, and it makes the reported balance figures not add up
	to the same as the total.  Since overdue disks are really going
	to be candidated for today's backups, they are thrown in the
	bin for those.  Patch from Ken Laprade <klaprade@harris.com>.

	Add Samba client support using smbclient to Amanda.  Samba must
	be patched with the file patches/samba-1.9.16p2.1.patch - this
	is a patch for 1.9.16p2 of Samba, and modifies the way the
	'dir' command works, and adds totals to both the dir command
	and the tar command, via stderr.  These are used by amanda to
	estimate and count backup sizes.  This should be installed on
	an amanda 'client' host, that will act as the 'samba server'
	host.  This will most likely be the same machine as the Amanda
	master server.  Patches from Michael Zucchi
	<zucchi@cis.unisa.edu.au>.

	Amrmtape converted from Bash to Bourne shell.  Patch from Blair
	Zajac <blair@gps.caltech.edu>.

	Fix the indexing code to use "arglist.h" instead of <stdarg.h>
	Patch from Blair Zajac <blair@gps.caltech.edu>.

	Have amdump call amgetidx and amtrmidx.  Put amgetidx and
	amtrmidx into the libexec directory instead of the bin
	directory, since Amanda users will not use these by hand.
	Patch from Blair Zajac <blair@gps.caltech.edu>.

	Modified diskfile.c to match hostname in the backup header
	against the fully qualified domain name in disklist file,
	because amflush fails in a multidomain backup environment, as
	backup headers have only the hostname.  Patch from Karl
	Lehenbauer <karl@neosoft.com>.

	Have autoconf figure out if some functions are not declared and
	if they are not, then declare them.  Patch from Blair Zajac
	<blair@gps.caltech.edu>.

	Add security fixes to amandad.c.  It now checks the forward and
	reverse DNS names for consistency.  Added a configure option
	--amandahosts to use Michael's code to use .amandahosts instead
	of .rhosts.  Patch from Michael Douglass <mikedoug@texas.net>.

	Add amverify, a simple shell script to check Amanda tapes -
	gnutar driven backups only.  Patch from Thomas Hepper
	<Thomas.Hepper@icem.de>.

	Add the version option to amadmin (eg amadmin <conf> version).
	Patch from Thomas Hepper <Thomas.Hepper@icem.de>.

	Add the current option to amtape (eg amtape <conf> current).
	This let's you the label of the current tape only without using
	dd.  Patch from Thomas Hepper <Thomas.Hepper@icem.de>.

	Gnutar support for amindex added.  Patch from Thomas Hepper
	<Thomas.Hepper@icem.de>.

	Calcsize supports exclude-list (gtar).  The source was
	extracted from gnutar itself to be 100% compatible.  Patch from
	Thomas Hepper <Thomas.Hepper@icem.de>.

	Calcsize checks the file type and ignores special files and
	pipes.  Patch from Thomas Hepper <Thomas.Hepper@icem.de>.

	Calcsizes calculation for gnu tar archives had a bug (gtar file
	blocks always are a multiple of 2k).  Patch from Thomas Hepper
	<Thomas.Hepper@icem.de>.

	`amandates.c': amdandad suffered by missing AMANDATES_FILE.
	Now it creates this file before missing it.  Patch from Thomas
	Hepper <Thomas.Hepper@icem.de>.

	`createindex-gnutar.c' added.  Patch from Thomas Hepper
	<Thomas.Hepper@icem.de>.

	alloca(), strdup.c and getcwd added for those system who don't
	have them.  Patch from Thomas Hepper <Thomas.Hepper@icem.de>.

	A dirty hack for BSD based systems without sigaction(), see
	amanda.h.  Patch from Thomas Hepper <Thomas.Hepper@icem.de>.
 
	Add two scripts, hp-changer and no-changer. hp-changer is a
	tape changer script for a HP DAT changer. Every 10th tape a
	taper clean runs.  no-changer is a changer-like script for
	single tape streamer.  It makes Amanda see a tape changer unit
	with an infinite count of tapes (and requires an operator to
	change the tapes :-)). Every 10 tapes the operator is
	recommended to insert a cleaning tape.  Patch from Thomas
	Hepper <Thomas.Hepper@icem.de>.

	The version suffix adding is done with a seperate function
	versionsuffix() also available as standalone program.  Patch
	from Thomas Hepper <Thomas.Hepper@icem.de>.

	Several files got debug support. Patch from Thomas Hepper
	<Thomas.Hepper@icem.de>.

	Added an idle type file-too-large to driver.c to avoid dumping
	files to the holding disk(s) which exceed the maximum file size
	(2 GB on the most 32-bit machines).  Patch from Thomas Hepper
	<Thomas.Hepper@icem.de>.

	Some minor bug fixes, mostly regarding missing or wrong casts
	confusing c compilers (shmat()/shmdt(), select()).  Patch from
	Thomas Hepper <Thomas.Hepper@icem.de>.

	Genversion gives some more information.  Patch from Thomas
	Hepper <Thomas.Hepper@icem.de>.

	getfsent.c and statfs.c have been cleaned up. The have to be
	checked on non-Irix/Solaris/NextStep/HPUX/AIX/Linux-systems.
	Patch from Thomas Hepper <Thomas.Hepper@icem.de>.

	Simple support if readline.a is missing.  NEVER TESTED!  Patch
	from Thomas Hepper <Thomas.Hepper@icem.de>.

	Linux requires libdb.a and ndbm.h to handle database files. Not
	really what I expected.  Patch from Thomas Hepper
	<Thomas.Hepper@icem.de>.
 
	Here's a simple patch which fixes a problem that causes amflush
	to erroneously complain "ignoring cruft file" about good dump
	files on the holding disk, and fail to flush them to tape.
	This happens if your holding disk directory has a long name,
	and the dump file also has a long name (i.e. if you use
	filesystem mount points in disklist).  The problem occurs if
	the holding directory + filename exceeds 80 bytes.  The patch
	still leaves a length limitation, but at least it matches the
	size limit imposed by driver (and thus dumper & taper) of 128
	bytes.  Patch from Marion Hakanson <hakanson@cse.ogi.edu>.

	Use regex.h and regex.c from
	ftp://prep.ai.mit.edu/sh-utils-1.15.tar.gz instead of the regex
	checking code in the system.  This code includes re_comp and
	re_exec calls, so it will work on any system.  Patch by Blair
	Zajac <blair@gps.caltech.edu>.

	Amadmin find reports the wrong tape file numbers after when a
	dump is amflush'ed to tape.  Patch by Ralf Fassel
	<ralf@atg.venture.de>.

	Fix a bug where dumps of disks on the Amanda server are counted
	against the available network bandwidth.  Patch from Marion
	Hakanson <hakanson@cse.ogi.edu>.

	Tell gnutar to not exit with a nonzero value if a read failed.
	This prevents backups from aborting if a file disappeared
	before gnutar could save it.  Patch from Hal Snyder
	<hal@vailsys.com>.

	Fix dumper which can cause the entire amdump run to hang after
	dumper issues a "TRY-AGAIN" message to driver while dumping
	directly to tape.  Patch from Marion Hakanson's
	<hakanson@cse.ogi.edu>.

	Added Marion Hakanson's <hakanson@cse.ogi.edu> patches to fix
	problems when amanda dumps directly to tape (i.e. when holding
	space is full, or you're backing up a huge filesystem, etc.).
	The bug occurs in the way taper determines it has succeeded
	when doing a PORT-WRITE operation (i.e. dumping directly to
	tape).  It used to assume that an EOF meant no more data --
	true if it's reading from a file, but when reading from a port
	(i.e. directly from a dump process), an EOF could signal
	abnormal exit as well as a normal one.  So, I extended the
	protocol between driver and taper when dumping directly to tape
	(see dump_to_tape() in driver.c) so the taper will wait for the
	driver to pass PORT-WRITE-SUCCESS or PORT-WRITE-FAILURE to the
	taper (since driver gets OK/not-OK from the dumper) before the
	taper records success or failure.  Note that this change
	affects only the PORT-WRITE case in taper.  FYI, the bug
	resulted in the curinfo database for a failed port-dump to have
	the tape-label & file-number fields updated with the location
	of the failed dump, even though the timestamp & dump statistics
	still have the values of the last successful dump (the latter
	fields are updated by dumper itself).

	Patches from George Scott <George.Scott@cc.monash.edu.au> to
	fix the following problems in planner.c.
	1) Initialise total_size, total_lev0 and balanced_size.  They
	are updated in analyze_estimates() but never initialised.  Zero
	them before the first call.
	2) Remove oversize dumps.   If there is a dump whose estimated
	size is larger than the tape the planner would tend to throw
	away all the other dumps and then probably generate an
	unworkable plan anyway.  (The standard 2.2.6 planner probably
	tossed these dumps fairly quickly for other reasons, but my
	next fix made this one almost mandatory!)  The fix is to drop
	these enormous dumps right at the begining.  This shouldn't be
	triggered for anyone with a sane configuration.
	3) Promote hills.  There are two ways to create a balanced
	cycle.  The first is to fill in any holes and the second is to
	remove any hills.  The original planner is good at doing the
	first but doesn't even attempt the second.  A quick look at
	"amadmin balance" would show big hills quite clearly.  This fix
	effectively does an "amadmin balance" and promotes a dump from
	one of the "hills".  This type of promotion is quite
	restricted:
	  - don't bother if we already plan to do any level 0 dumps
	  - don't promote a dump if it was going to be the only level 0
	    to be done on that run (ie, ignore hills that are only one
	    dump high)
	  - only promote one level 0 by this method
	  - don't exceed tape_length
	The key to it is the first restriction.  Large sites (with
	large numbers of disks and a large balanced_size) will have at
	least one level 0 scheduled for each day in the dump cycle and
	will already have a balanced cycle.  This code will not
	activate for them.  Small sites will probably not have a level
	0 scheduled and will benefit.  The second restriction will stop
	Amanda from constantly promoting dumps when the schedule is as
	balanced as it will go.  The third restriction will stop Amanda
	over reacting.  Promoting one dump by this method would take
	total_lev0 larger that balanced_size.  If it wouldn't then the
	first stage promotion didn't work like it should.
	4) Initialise got_estimate for all cases.  This fix was from
	der Mouse <mouse@collatz.mcrcim.mcgill.edu>.  "got_estimate"
	wasn't being initialised for skipped disks.  Later in the code
	it was being used in all cases.  The fix is to move its
	initialisation up a few lines.
	5) Explicitly ignore off-line disks.  If a disk is off-line
	when the planner is run it gets -1 for all dump sizes.  These
	were ignored at a later stage.  This fix explicitly ignores
	them up front.
	6) Ignore down machines.  If a machine is down when the planner
	is run it guesses from historical data what the size of
	tonights dump is likely to be and schedules a dump anyway.  The
	dumper then usually discovers that the machine is still down
	and ends up with a half full tape.  Unfortunately the planner
	had to delay another dump because it thought that the tape was
	full.  The fix here is for the planner to discard unavailable
	machines totally rather than just ignore the fact that they are
	unavailable.
	7) Keep at least one total.  Amanda moves level 0 dumps back to
	incrementals to try and fit everything onto the tape.
	Unfortunately if all your incrementals are too big (or your
	tape too small) it can move all of your level 0 dumps.  This
	ends up being a kind of deadlock since, unless a level 0 gets
	done, the incrementals will not reduce in size and until the
	incrementals reduce in size there will not be enough room to
	fit in a level 0.  (This is not quite accurate since a level 4
	dump can get bumped to a level 5 which reduces its size.
	However, this deadlock has happened to me and for many days in
	a row.)  The fix is to pick on the highest priority level 0 and
	not let it be moved.  This change will not affect users with
	reasonably sized tapes since Amanda would not have moved all
	their disks to incrementals.
	8) Make usage of total_lev0 consistent.  "total_lev0" is a
	double and doesn't include tape_mark's.  Make it so.

	Add a fflush(outf) to amcheck.c.  Patch from Mike Russell
	<Michael_Russell@Brown.EDU>.

	Fix problems with amhpfixdevs.  Patch from Michael Schmitz
	<mschmitz@iname.com>.

	Have DEC OSF1 use installbsd instead of install.  Patch from
	Rainer Landes <rlandes@fphws01.physik.uni-karlsruhe.de>.

	Have amcontrol take the first command line argument as the
	configuration to use.  If there are no command line arguments,
	then use daily.  Patch from Thomas Schmeidl
	<schmeidl@nwp.kwu.siemens.de>.

	Removed --atime-preserve from sendbackup-gnutar.c so that
	incremental backups of filesystems will work.  Patch from
	Alexandre Oliva <oliva@dcc.unicamp.br>.

	Change all #if __STDC__ to #ifdef __STDC__ for those systems
	that define __STDC__ to 0, such as Solaris using cc -Xt, cc
	-Xa.  Patch from Blair Zajac <blair@gps.caltech.edu>.

	Increase the socket buffer size, and set a low watter mark at
	32k.  This cut the number of syscalls done to process one 32k
	block from dozens down to 4 (select, read, lseek, write).
	Patch from Brad Huntting <huntting@glarp.com>.

	Include amindex-0.3 from Alan McIvor <alan@salan.auck.irl.cri.nz>.

	Add the "srvcompress" option to compress dumps on the tape host
	instead of on the client machines.  This may be useful when a
	fast tape host is backing up slow clients.  The patches add a
	dump-type option, analogous to "compress-fast" or
	"compress-best" - the way to use it is to create a new dumptype
	in your amanda.conf that includes "srvcompress" and use the new
	dumptype for those filesystems you wish to have compressed on
	the tape server. For example, in amanda.conf:
	    define dumptype srvcomp-user {
	    comment "Partitions on slow machines, compressed on tapehost"
	    options srvcompress
	    priority medium
	}
	Patches from Eric Volpe <epv@panix.com>.

	Increase the planner timeout for one estimate from 30 seconds
	to 120 seconds.  Patch from Michael Schmitz
	<mschmitz@iname.com>.

	The select(2) prototype on HPUX specifies 'int' as argument
	type of the filedescriptor arguments. All other systems I know
	of use 'fd_set'. This has been fixed by having configure check
	the argument type to select and adding casts to the select(2)
	calls.  Patch from Michael Schmitz  <mschmitz@iname.com>.

	Improve the diagnostic output and increase the robustness of
	the system by adding better error checking on communication
	between taper & driver, and among the two taper processes.
	Patches from Marion Hakanson <hakanson@cse.ogi.edu>.

	Convert all flock() calls to use POSIX-style locks via the
	fcntl(2) call.  This operation was prompted by the fact that
	the flock() emulation in the Amanda-provided common-src/flock.c
	was broken for read-only file descriptors, and the fcntl(2)
	locks are widely available.  This patch makes it possible to
	have a read-only lock on the /etc/amandates file on systems
	which want to use it.  I've built and tested the patched code
	on Amanda servers running on Digital Unix v3.2B (on Alpha
	hardware) and on SPARC Solaris-2.5.1.  It's also been compiled
	here on SPARC's running SunOS-4.1.3u1b, HP-UX 9.0[345], and
	NeXTstep-3.3 (NeXT hardware).  Note that the patches also
	remove all trace of the NEED_FLOCK define, and I have removed
	the file common-src/flock.c from our source tree here.  Patch
	from Marion Hakanson <hakanson@cse.ogi.edu>.

	For disk/filesystem names which are wider than 14 characters,
	have reporter print out the rightmost characters of the disk
	name, which is usually more meaningful in a daily backup
	summary.  Patch from Marion Hakanson <hakanson@cse.ogi.edu>.

	Lets amflush work in a wider variety of cases than was
	previously true (it used to work if the disklist contains only
	the first token of each hostname).  sendbackup-dump.c and
	sendbackup-gnutar.c now do not trim the domain name from the
	host name that is sent back to the server.  amflush now looks
	for an exact match, in the database.  If it can't find one it
	strips the last token off the dump header hostname and keeps
	trying until it finds a match in the disklist or runs out of
	tokens.  This also has the advantage that if gethostname()
	returns FQDNs and you specify the same FQDNs in the disklist,
	then amflush will always work.  It will also work as long as
	the disklist and gethostname() on the clients return enough
	information to be unambiguous.  Patch from James Mathiesen
	<james@deshaw.com>.

	Increase the READ_TIMEOUT in dumper.c to 30 minutes.  This
	needs to be longer than the longest amount of time dump will
	not produce output.  People have observed dumps taking more
	than 10 minutes to finish mapping some of the passes
	sometimes.  Patch from James Mathiesen <james@deshaw.com>.
	
	Added Adrian T. Filipi-Martin's <atf3r@cs.virginia.edu>
	amrmtape script, which allows you to invalidate the contents of
	an existing backup tape within the Amanda current tape
	database.  This is meant as a recovery mecanism for when a good
	backup is damaged either by faulty hardware or user error,
	i.e.  the tape is eaten by the tape drive, or the tape has been
	overwritten.  Blair Zajac wrote a quick little manual page for
	this script.

	amrmtape was using the return value from amadmin and amadmin
	was exiting with a non-zero value, causing amrmtape to quit.
	Added a return 0 statement to amadmin.c.  Patch from Blair
	Zajac <blair@gps.caltech.edu>.

	Went through all of the files and changed void main()'s to int
	main()'s.  Patch from Blair Zajac <blair@gps.caltech.edu>.

	Removed the 50 tape file limit in amcleanup and amdump.

	createindex-dump and sendbackup-dump did not always take into
	account the version suffix.  This is now handled.  Patch from
	Philippe Charnier <charnier@lirmm.fr>

	Compile and install amrecover and amrestore as client programs,
	not a server program.  The motovation for this is that
	amrecover is truly a program for all of the users on the
	system, while the remaining amanda programs could be used by
	only the system administrator.  Patch from Alexandre Oliva
	<oliva@dcc.unicamp.br>.

	The program amtrmidx fails to close some of the pipes it uses,
	and this can lead to failure on systems with large numbers of
	disks with incomplete database sets, and file descriptor
	ulimits set.  Patch from Alan McIvor <alan@auck.irl.cri.nz>.

Version 2.3.0.3

	Expanded the width of the DISK column from the reporter
	output.  I like to use mount points like /export/home?? instead
	of device names to back up.  Since the width of the disk name
	field from reporter's output is pretty small, I couldn't easily
	figure out the statistics for a particular partition.  Patch
	from Blair Zajac <blair@gps.caltech.edu>.

	Included Eric Doutreleau <ed@cti.ecp.fr> patch's for amadmin to
	handle multiple tapes better.  The patch that he posted on used
	a hardwired value of 6 for runtapes, which I changed.

	Included Marion Hakanson's <hakanson@cse.ogi.edu> patches to
	amadmin.c and amadmin.8 to let amadmin use the same disk
	regular expression matching as amrestore.  So now "^/$" will
	match only the root partition, not all of the disks.

	Added a patch from George.Scott@cc.monash.edu.au which makes
	new disks and forces dump with a higher priority.

	Changed tools/munge to delete blank lines and the commented
	lines that the C preprocessor generates (i.e. # 123).  We also
	remove the space after the = sign that can be generated by cpp
	on some systems.

	Installed amindex-0.2 from Alan McIvor <alan@auck.irl.cri.nz>
	with the following patches:

		Fix problem so that rsh'ing on a hpux host works.
		Patch from Neal Becker <neal@ctd.comsat.com>.  This
		patch includes a new #define for RSH_COMMAND, which is
		set to rsh in config-common.h and defined as remsh in
		config.h-hpux.

		Fix bugs in createindex-dump.c when comparing errno to
		EINTR.  The code was using = instead of ==.  Patch from
		Neal Becker <neal@ctd.comsat.com>.  I'm guessing this
		might fix some of the runaway createindex-dump
		processes that I have seen on my system.

		On my system, we use MAE which likes to generate path
		names with spaces in them.  I patched
		createindex-dump.c so that filenames with spaces have
		the whole filename listed.  Patch from Blair Zajac
		<blair@gps.caltech.edu>.

		Patch amtrmidx.c so that backups using the mount points
		for disks instead of the device name have the /'s
		replaced with _'s.  Patch from Blair Zajac
		<blair@gps.caltech.edu>.

Version 2.3.0.2

	Changed the signals being sent to xfsdump for Irix so that it
	will be killed without dumping a core.

	Fixed a typo in the definition of XFSDUMP in config.h-irix.

	Removed the extra option.s-* and copied options.h to
	options.h-vanilla.

	Moved the amrestore manual page into the man directory so it
	would get installed.

Version 2.3.0.1

	amindex-0.1 written by Alan McIvor <alan@kauri.auck.irl.cri.nz>
	installed.  amindex generates an index of all of the files that
	were dumped.  It is nice to see what files were dumped before
	you restore a whole bunch of tapes looking for a file.  I
	patched some of this code.  Here are some of the changes:

		Switched the Imakefile to Makefile and Makefile.in to
		be more consistent with the system used by the rest of
		amanda.

		Moved the configuration #defines out of the specific
		files (such as amrecover.c) into options.h, so that
		people installing this version of amanda would be able
		to see the required changes more easily and not have to
		edit multiple files.

		Made some changes to the codes to remove #include's
		where amanda.h would include them and also check if the
		system had the particular include file.

		Added code to set_commands.c and amgetidx.c to change
		/'s in disk names to _'s.

		Added code to amrecover.c to properly compile on
		Solaris hosts.

		With the -Xc compiler option on Solaris and with
		amindex, the sigaction structure was not being
		declared.  Added -D__EXTENSIONS__ to config.h-sunos5 so
		that sigaction would be declared.

		I changed a bunch of fprintf to perrors.

	Include Sean Kelly's <kelly@fsl.noaa.gov> patch for tools/munge
	for FreeBSD-2.1.5.

	Used Peter Lackner's <plo@came.sbg.ac.at> patches for DU 4.0.

	Installed Ken Laprade's <klaprade@harris.com> patches for
	amanda to handle both EFS and XFs file systems on the same
	client.  The only change from his patch is to #ifdef XFSDUMP
	the kill(-dumppid, SIGTERM) so the SIGTERM signal will be used
	on other systems, while SIGQUIT will be used on Irix systems.

	Installed Marion Hakanson's <hakanson@cse.ogi.edu> patches for
	the main config file to include subsidiary config files.

	On Solaris, sometimes the hdr->handle variable in amandad.c
	would be null, causing core dumps when it was used in a sprintf
	statement.  The code now checks if hdr->handle is null and
	prints a "" if it is null.  This was only done in amandad.c.

	Fix a problem where new disks would be added but not backed up
	concurrently.  Changes to diskfile.c.  I forgot who put this
	patch up on the mailing list.

	I made some changes to options.h to allow the user to more
	easily install the programs under a different user.  This meant
	defining two new #defines, MK_AMANDA_USER and
	MK_QUOTED_AMANDA_USER which are used in the appropriate
	Makefiles.

	Used Marion Hakanson's <hakanson@cse.ogi.edu> patch for taper.c
	for multiple tapes.

	Included Joachim Loehr's <Joachim.Loeh@stadt-mh.de>
	script to automatically figure out which kind of HP-UX file
	system is being dumped.  Look in tools for the script and a
	README.

Local Variables:
mode: change-log
left-margin: 8
fill-column: 76
End:
